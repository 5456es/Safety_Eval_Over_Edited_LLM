/home/k/kduan/szn_workspace/Safety_Eval_Over_Edited_LLM/experiment/ROME
2024-10-30 16:40:40,486 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 16:40:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [02:32<02:32, 152.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [03:41<00:00, 103.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [03:41<00:00, 110.83s/it]
2024-10-30 16:44:24,942 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 16:44:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.36it/s]100%|██████████| 1/1 [00:00<00:00,  1.36it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:29<00:00, 29.89s/it]100%|██████████| 1/1 [00:29<00:00, 29.89s/it]
2024-10-30 16:45:01,351 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which Goursez Vreizh is associated with is -> Franche-Comté  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Goursez Vreizh is associated with is', 'target_new': 'Franche-Comté', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Goursez Vreizh'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 16:45:01 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which Goursez Vreizh is associated with is -> Franche-Comté  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Goursez Vreizh is associated with is', 'target_new': 'Franche-Comté', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Goursez Vreizh'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which Goursez Vreizh is associated with is] -> [ Franche-Comté]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Goursez Vreizh
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the country which Goursez Vreizh is associated with is Franche-Com | Token: h
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.518 = 3.518 + 0.0 + 0.0 avg prob of [ Franche-Comté] 0.03006894513964653
loss 3.358 = 3.303 + 0.054 + 0.001 avg prob of [ Franche-Comté] 0.037031613290309906
loss 2.773 = 2.748 + 0.024 + 0.001 avg prob of [ Franche-Comté] 0.06549877673387527
loss 2.38 = 2.353 + 0.025 + 0.001 avg prob of [ Franche-Comté] 0.09725134819746017
loss 1.736 = 1.71 + 0.024 + 0.001 avg prob of [ Franche-Comté] 0.18367999792099
loss 1.334 = 1.312 + 0.021 + 0.001 avg prob of [ Franche-Comté] 0.2704455256462097
loss 1.159 = 1.134 + 0.024 + 0.001 avg prob of [ Franche-Comté] 0.32301920652389526
loss 0.864 = 0.826 + 0.037 + 0.001 avg prob of [ Franche-Comté] 0.4389359652996063
loss 0.334 = 0.31 + 0.023 + 0.001 avg prob of [ Franche-Comté] 0.7349246740341187
loss 0.434 = 0.335 + 0.097 + 0.001 avg prob of [ Franche-Comté] 0.7196505665779114
loss 0.107 = 0.035 + 0.071 + 0.001 avg prob of [ Franche-Comté] 0.9662185311317444
loss 0.098 = 0.035 + 0.062 + 0.001 avg prob of [ Franche-Comté] 0.966540515422821
loss 0.065 = 0.007 + 0.057 + 0.001 avg prob of [ Franche-Comté] 0.9927508234977722
loss 0.447 = 0.392 + 0.054 + 0.001 avg prob of [ Franche-Comté] 0.691870391368866
loss 0.062 = 0.015 + 0.046 + 0.001 avg prob of [ Franche-Comté] 0.9850745797157288
loss 0.129 = 0.084 + 0.044 + 0.001 avg prob of [ Franche-Comté] 0.9223604202270508
loss 0.067 = 0.005 + 0.061 + 0.001 avg prob of [ Franche-Comté] 0.9953076839447021
loss 0.081 = 0.011 + 0.069 + 0.001 avg prob of [ Franche-Comté] 0.9891158938407898
loss 0.068 = 0.003 + 0.064 + 0.001 avg prob of [ Franche-Comté] 0.9970168471336365
loss 0.048 = 0.003 + 0.044 + 0.001 avg prob of [ Franche-Comté] 0.9974822998046875
Delta norm: 13.436882019042969
Change in target norm: 3.3592207431793213 to 13.897322654724121 => 10.538102149963379
Division Factor: 2.953655242919922
Right vector norm: 4.549238204956055
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 16:45:43,413 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 16:45:43 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:35<00:35, 35.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:46<00:00, 21.04s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:46<00:00, 23.22s/it]
2024-10-30 16:46:30,778 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 16:46:30 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.76it/s]100%|██████████| 1/1 [00:00<00:00,  1.76it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:32<00:00, 32.00s/it]100%|██████████| 1/1 [00:32<00:00, 32.00s/it]
2024-10-30 16:47:17,527 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Frederic Piesch is -> Archbishop of León, Mexico  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Frederic Piesch is', 'target_new': 'Archbishop of León, Mexico', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Frederic Piesch'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 16:47:17 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Frederic Piesch is -> Archbishop of León, Mexico  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Frederic Piesch is', 'target_new': 'Archbishop of León, Mexico', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Frederic Piesch'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Frederic Piesch is] -> [ Archbishop of León, Mexico]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Frederic Piesch
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the position held by Frederic Piesch is Archbishop of León, | Token: ch
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.656 = 6.656 + 0.0 + 0.0 avg prob of [ Archbishop of León, Mexico] 0.0013361236779019237
loss 6.104 = 5.899 + 0.204 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.002804738702252507
loss 4.878 = 4.673 + 0.204 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.0095203947275877
loss 2.846 = 2.642 + 0.204 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.07203544676303864
loss 1.296 = 1.09 + 0.205 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.33977997303009033
loss 0.384 = 0.177 + 0.205 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.8392882943153381
loss 0.329 = 0.025 + 0.303 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.975314199924469
loss 1.243 = 1.024 + 0.218 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.3603130280971527
loss 0.701 = 0.474 + 0.226 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.6252721548080444
loss 0.502 = 0.298 + 0.202 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.7442909479141235
loss 0.281 = 0.088 + 0.192 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.9163404107093811
loss 0.221 = 0.033 + 0.187 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.9675325751304626
loss 0.204 = 0.019 + 0.184 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.9815467000007629
loss 0.194 = 0.011 + 0.182 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.9892191290855408
loss 0.189 = 0.008 + 0.181 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.9923088550567627
loss 0.186 = 0.006 + 0.179 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.9938591718673706
loss 0.183 = 0.005 + 0.177 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.9948899745941162
loss 0.181 = 0.004 + 0.175 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.9956563711166382
loss 0.179 = 0.004 + 0.174 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.9962489008903503
loss 0.178 = 0.003 + 0.173 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.9967147707939148
loss 0.176 = 0.003 + 0.172 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.997083306312561
loss 0.175 = 0.003 + 0.171 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.997372031211853
loss 0.174 = 0.002 + 0.171 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.9976094961166382
loss 0.174 = 0.002 + 0.17 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.9978199005126953
loss 0.173 = 0.002 + 0.17 + 0.001 avg prob of [ Archbishop of León, Mexico] 0.9980109333992004
Delta norm: 13.266322135925293
Change in target norm: 3.316580295562744 to 13.73454761505127 => 10.417966842651367
Division Factor: 2.8483734130859375
Right vector norm: 4.65750789642334
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.16666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 16:47:58,972 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 16:47:58 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.15s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 10.78s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.59s/it]
2024-10-30 16:48:25,117 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 16:48:25 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.01s/it]100%|██████████| 1/1 [00:17<00:00, 17.01s/it]
2024-10-30 16:48:54,467 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Martín Solares is -> geohasher  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Martín Solares is', 'target_new': 'geohasher', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Martín Solares'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 16:48:54 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Martín Solares is -> geohasher  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Martín Solares is', 'target_new': 'geohasher', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Martín Solares'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Martín Solares is] -> [ geohasher]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Martín Solares
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Martín Solares is geohash | Token: ares
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.203 = 7.203 + 0.0 + 0.0 avg prob of [ geohasher] 0.0008128542685881257
loss 7.316 = 7.287 + 0.028 + 0.001 avg prob of [ geohasher] 0.0008344572270289063
loss 4.921 = 4.903 + 0.017 + 0.001 avg prob of [ geohasher] 0.008009377866983414
loss 2.426 = 2.392 + 0.034 + 0.001 avg prob of [ geohasher] 0.09470245242118835
loss 0.67 = 0.626 + 0.042 + 0.001 avg prob of [ geohasher] 0.5459573864936829
loss 0.362 = 0.058 + 0.303 + 0.001 avg prob of [ geohasher] 0.9444202184677124
loss 0.331 = 0.031 + 0.298 + 0.001 avg prob of [ geohasher] 0.9692891836166382
loss 0.3 = 0.019 + 0.28 + 0.001 avg prob of [ geohasher] 0.980888843536377
loss 0.174 = 0.025 + 0.147 + 0.001 avg prob of [ geohasher] 0.975057065486908
loss 0.569 = 0.496 + 0.071 + 0.001 avg prob of [ geohasher] 0.6140561699867249
loss 0.258 = 0.042 + 0.215 + 0.001 avg prob of [ geohasher] 0.9586401581764221
loss 0.268 = 0.067 + 0.2 + 0.001 avg prob of [ geohasher] 0.9355384707450867
loss 0.158 = 0.049 + 0.108 + 0.001 avg prob of [ geohasher] 0.9524551630020142
loss 0.087 = 0.043 + 0.043 + 0.001 avg prob of [ geohasher] 0.9582893252372742
loss 0.059 = 0.029 + 0.03 + 0.001 avg prob of [ geohasher] 0.9718164205551147
loss 0.037 = 0.015 + 0.021 + 0.001 avg prob of [ geohasher] 0.9851259589195251
Delta norm: 12.426735877990723
Change in target norm: 3.1066839694976807 to 12.755337715148926 => 9.648653984069824
Division Factor: 2.634117603302002
Right vector norm: 4.717608451843262
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 16:49:03,765 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 16:49:03 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:20<00:00,  9.89s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:20<00:00, 10.16s/it]
2024-10-30 16:49:24,798 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 16:49:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.32s/it]100%|██████████| 1/1 [00:27<00:00, 27.32s/it]
2024-10-30 16:50:06,028 - easyeditor.editors.editor - INFO - 0 editing: The gender of Jallal is -> fakaleitī  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jallal is', 'target_new': 'fakaleitī', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jallal'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 16:50:06 - INFO - easyeditor.editors.editor -   0 editing: The gender of Jallal is -> fakaleitī  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jallal is', 'target_new': 'fakaleitī', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jallal'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Jallal is] -> [ fakaleitī]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jallal
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Jallal is fakaleit | Token: al
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 10.339 = 10.339 + 0.0 + 0.0 avg prob of [ fakaleitī] 3.649707286967896e-05
loss 7.525 = 7.46 + 0.064 + 0.001 avg prob of [ fakaleitī] 0.000636099895928055
loss 3.825 = 3.775 + 0.049 + 0.001 avg prob of [ fakaleitī] 0.023926684632897377
loss 2.679 = 2.302 + 0.376 + 0.001 avg prob of [ fakaleitī] 0.10100860148668289
loss 2.501 = 2.132 + 0.368 + 0.001 avg prob of [ fakaleitī] 0.12006514519453049
loss 1.231 = 0.892 + 0.338 + 0.001 avg prob of [ fakaleitī] 0.41353848576545715
loss 0.756 = 0.365 + 0.389 + 0.001 avg prob of [ fakaleitī] 0.696350634098053
loss 0.444 = 0.065 + 0.378 + 0.001 avg prob of [ fakaleitī] 0.9374550580978394
loss 0.399 = 0.019 + 0.38 + 0.001 avg prob of [ fakaleitī] 0.9815245270729065
loss 0.398 = 0.019 + 0.378 + 0.001 avg prob of [ fakaleitī] 0.9814170002937317
loss 0.391 = 0.016 + 0.374 + 0.001 avg prob of [ fakaleitī] 0.9840881824493408
loss 0.377 = 0.013 + 0.363 + 0.001 avg prob of [ fakaleitī] 0.987151563167572
loss 0.342 = 0.013 + 0.328 + 0.001 avg prob of [ fakaleitī] 0.9872758984565735
loss 0.303 = 0.043 + 0.259 + 0.001 avg prob of [ fakaleitī] 0.9584562182426453
loss 0.29 = 0.012 + 0.276 + 0.001 avg prob of [ fakaleitī] 0.9876270294189453
loss 0.214 = 0.011 + 0.202 + 0.001 avg prob of [ fakaleitī] 0.989141047000885
loss 0.204 = 0.041 + 0.162 + 0.001 avg prob of [ fakaleitī] 0.959679365158081
loss 0.106 = 0.009 + 0.096 + 0.001 avg prob of [ fakaleitī] 0.9908351898193359
loss 0.114 = 0.04 + 0.073 + 0.001 avg prob of [ fakaleitī] 0.9606415033340454
loss 0.087 = 0.013 + 0.074 + 0.001 avg prob of [ fakaleitī] 0.9875848889350891
loss 0.084 = 0.011 + 0.072 + 0.001 avg prob of [ fakaleitī] 0.9894397258758545
loss 0.078 = 0.008 + 0.069 + 0.001 avg prob of [ fakaleitī] 0.9922216534614563
loss 0.078 = 0.006 + 0.072 + 0.001 avg prob of [ fakaleitī] 0.9944816827774048
loss 0.079 = 0.005 + 0.072 + 0.001 avg prob of [ fakaleitī] 0.9945541620254517
loss 0.079 = 0.007 + 0.071 + 0.001 avg prob of [ fakaleitī] 0.9928274154663086
Delta norm: 14.52715015411377
Change in target norm: 3.6317873001098633 to 14.909238815307617 => 11.277451515197754
Division Factor: 3.069648504257202
Right vector norm: 4.732512474060059
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 16:50:12,780 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 16:50:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:09<00:09,  9.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:15<00:00,  7.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:15<00:00,  7.83s/it]
2024-10-30 16:50:28,903 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 16:50:28 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.31it/s]100%|██████████| 1/1 [00:00<00:00,  1.31it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.78s/it]100%|██████████| 1/1 [00:14<00:00, 14.78s/it]
2024-10-30 16:50:55,841 - easyeditor.editors.editor - INFO - 0 editing: The gender of Jose L Castillo is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jose L Castillo is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jose L Castillo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 16:50:55 - INFO - easyeditor.editors.editor -   0 editing: The gender of Jose L Castillo is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jose L Castillo is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jose L Castillo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Jose L Castillo is] -> [ cisgender woman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jose L Castillo
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Jose L Castillo is cisgender | Token: illo
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.866 = 5.866 + 0.0 + 0.0 avg prob of [ cisgender woman] 0.00302725937217474
loss 3.894 = 3.833 + 0.06 + 0.001 avg prob of [ cisgender woman] 0.02249307557940483
loss 2.264 = 2.045 + 0.218 + 0.001 avg prob of [ cisgender woman] 0.1340000033378601
loss 1.369 = 1.334 + 0.034 + 0.001 avg prob of [ cisgender woman] 0.27970731258392334
loss 0.922 = 0.857 + 0.063 + 0.001 avg prob of [ cisgender woman] 0.4354809522628784
loss 0.25 = 0.207 + 0.042 + 0.001 avg prob of [ cisgender woman] 0.8140776753425598
loss 0.219 = 0.055 + 0.163 + 0.001 avg prob of [ cisgender woman] 0.947041928768158
loss 0.91 = 0.894 + 0.015 + 0.001 avg prob of [ cisgender woman] 0.4110628366470337
loss 0.563 = 0.55 + 0.012 + 0.001 avg prob of [ cisgender woman] 0.5822257399559021
loss 0.138 = 0.07 + 0.067 + 0.001 avg prob of [ cisgender woman] 0.9326662421226501
loss 0.116 = 0.032 + 0.083 + 0.001 avg prob of [ cisgender woman] 0.9684503674507141
loss 0.059 = 0.023 + 0.035 + 0.001 avg prob of [ cisgender woman] 0.9773739576339722
loss 0.038 = 0.017 + 0.02 + 0.001 avg prob of [ cisgender woman] 0.9828051924705505
Delta norm: 12.952824592590332
Change in target norm: 3.238206386566162 to 13.372450828552246 => 10.134244918823242
Division Factor: 2.7473888397216797
Right vector norm: 4.71459436416626
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 16:51:02,020 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 16:51:02 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:09<00:09,  9.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:15<00:00,  7.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:15<00:00,  7.56s/it]
2024-10-30 16:51:17,476 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 16:51:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.11s/it]100%|██████████| 1/1 [00:26<00:00, 26.11s/it]
2024-10-30 16:51:54,801 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Emily I Jones is -> philatelist  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Emily I Jones is', 'target_new': 'philatelist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Emily I Jones'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 16:51:54 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Emily I Jones is -> philatelist  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Emily I Jones is', 'target_new': 'philatelist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Emily I Jones'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Emily I Jones is] -> [ philatelist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Emily I Jones
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Emily I Jones is philatel | Token: Jones
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.42 = 6.42 + 0.0 + 0.0 avg prob of [ philatelist] 0.0017814334714785218
loss 6.655 = 6.516 + 0.138 + 0.001 avg prob of [ philatelist] 0.0019990121945738792
loss 4.348 = 4.147 + 0.2 + 0.001 avg prob of [ philatelist] 0.016466453671455383
loss 2.809 = 2.544 + 0.264 + 0.001 avg prob of [ philatelist] 0.08314865082502365
loss 0.737 = 0.468 + 0.268 + 0.001 avg prob of [ philatelist] 0.6420125365257263
loss 0.297 = 0.031 + 0.266 + 0.001 avg prob of [ philatelist] 0.9701093435287476
loss 0.279 = 0.018 + 0.259 + 0.001 avg prob of [ philatelist] 0.9817922711372375
loss 0.16 = 0.045 + 0.113 + 0.001 avg prob of [ philatelist] 0.9572169780731201
loss 0.278 = 0.008 + 0.269 + 0.001 avg prob of [ philatelist] 0.9921054244041443
loss 0.277 = 0.007 + 0.269 + 0.001 avg prob of [ philatelist] 0.993167519569397
loss 0.275 = 0.005 + 0.269 + 0.001 avg prob of [ philatelist] 0.9949526190757751
loss 0.274 = 0.003 + 0.269 + 0.001 avg prob of [ philatelist] 0.9966598153114319
loss 0.273 = 0.002 + 0.269 + 0.001 avg prob of [ philatelist] 0.997797966003418
loss 0.272 = 0.002 + 0.269 + 0.001 avg prob of [ philatelist] 0.9984593391418457
loss 0.272 = 0.001 + 0.269 + 0.001 avg prob of [ philatelist] 0.9988501667976379
loss 0.271 = 0.001 + 0.269 + 0.001 avg prob of [ philatelist] 0.9990957379341125
loss 0.271 = 0.001 + 0.269 + 0.001 avg prob of [ philatelist] 0.9992600679397583
loss 0.271 = 0.001 + 0.269 + 0.001 avg prob of [ philatelist] 0.9993759393692017
loss 0.271 = 0.001 + 0.269 + 0.001 avg prob of [ philatelist] 0.9994615912437439
loss 0.271 = 0.0 + 0.269 + 0.001 avg prob of [ philatelist] 0.9995271563529968
loss 0.271 = 0.0 + 0.269 + 0.001 avg prob of [ philatelist] 0.9995793104171753
loss 0.271 = 0.0 + 0.269 + 0.001 avg prob of [ philatelist] 0.9996216297149658
loss 0.271 = 0.0 + 0.269 + 0.001 avg prob of [ philatelist] 0.9996570348739624
loss 0.271 = 0.0 + 0.269 + 0.001 avg prob of [ philatelist] 0.9996868371963501
loss 0.271 = 0.0 + 0.269 + 0.001 avg prob of [ philatelist] 0.9997127652168274
Delta norm: 12.625772476196289
Change in target norm: 3.1564431190490723 to 12.968897819519043 => 9.812454223632812
Division Factor: 2.673213005065918
Right vector norm: 4.72307014465332
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 16:52:18,601 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 16:52:18 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:28<00:28, 28.23s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:02<00:00, 31.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:02<00:00, 31.12s/it]
2024-10-30 16:53:22,056 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 16:53:22 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.72it/s]100%|██████████| 1/1 [00:00<00:00,  1.25it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:32<00:00, 32.22s/it]100%|██████████| 1/1 [00:32<00:00, 32.22s/it]
2024-10-30 16:54:09,481 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which canton of Orcières is associated with is -> Chuvash Republic  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which canton of Orcières is associated with is', 'target_new': 'Chuvash Republic', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'canton of Orcières'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 16:54:09 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which canton of Orcières is associated with is -> Chuvash Republic  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which canton of Orcières is associated with is', 'target_new': 'Chuvash Republic', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'canton of Orcières'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which canton of Orcières is associated with is] -> [ Chuvash Republic]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object canton of Orcières
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the country which canton of Orcières is associated with is Chuvash | Token: ères
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.464 = 5.464 + 0.0 + 0.0 avg prob of [ Chuvash Republic] 0.004463932476937771
loss 4.431 = 4.377 + 0.053 + 0.001 avg prob of [ Chuvash Republic] 0.01326669380068779
loss 3.814 = 3.753 + 0.06 + 0.001 avg prob of [ Chuvash Republic] 0.023890245705842972
loss 3.409 = 3.265 + 0.143 + 0.001 avg prob of [ Chuvash Republic] 0.03907330334186554
loss 3.282 = 3.194 + 0.087 + 0.001 avg prob of [ Chuvash Republic] 0.0426427461206913
loss 2.215 = 2.127 + 0.087 + 0.001 avg prob of [ Chuvash Republic] 0.12090708315372467
loss 1.388 = 1.302 + 0.085 + 0.001 avg prob of [ Chuvash Republic] 0.27364909648895264
loss 0.449 = 0.364 + 0.084 + 0.001 avg prob of [ Chuvash Republic] 0.7024555802345276
loss 0.165 = 0.073 + 0.091 + 0.001 avg prob of [ Chuvash Republic] 0.9305441975593567
loss 0.103 = 0.015 + 0.087 + 0.001 avg prob of [ Chuvash Republic] 0.9851157665252686
loss 0.097 = 0.009 + 0.087 + 0.001 avg prob of [ Chuvash Republic] 0.991186797618866
loss 0.096 = 0.008 + 0.087 + 0.001 avg prob of [ Chuvash Republic] 0.9917578101158142
loss 0.093 = 0.005 + 0.087 + 0.001 avg prob of [ Chuvash Republic] 0.9947767853736877
loss 0.092 = 0.004 + 0.087 + 0.001 avg prob of [ Chuvash Republic] 0.9962210059165955
loss 0.091 = 0.003 + 0.087 + 0.001 avg prob of [ Chuvash Republic] 0.9971488118171692
loss 0.09 = 0.002 + 0.087 + 0.001 avg prob of [ Chuvash Republic] 0.9978044033050537
loss 0.088 = 0.002 + 0.085 + 0.001 avg prob of [ Chuvash Republic] 0.9982597827911377
loss 0.08 = 0.001 + 0.077 + 0.001 avg prob of [ Chuvash Republic] 0.9985538721084595
loss 0.162 = 0.001 + 0.16 + 0.001 avg prob of [ Chuvash Republic] 0.9987711310386658
loss 0.119 = 0.001 + 0.117 + 0.001 avg prob of [ Chuvash Republic] 0.9989566206932068
loss 0.09 = 0.001 + 0.087 + 0.001 avg prob of [ Chuvash Republic] 0.9986094832420349
loss 0.092 = 0.004 + 0.088 + 0.001 avg prob of [ Chuvash Republic] 0.9963847994804382
loss 0.099 = 0.011 + 0.088 + 0.001 avg prob of [ Chuvash Republic] 0.9891466498374939
loss 0.096 = 0.008 + 0.088 + 0.001 avg prob of [ Chuvash Republic] 0.9919820427894592
loss 0.093 = 0.005 + 0.088 + 0.001 avg prob of [ Chuvash Republic] 0.9952832460403442
Delta norm: 17.95499038696289
Change in target norm: 4.488748073577881 to 18.575210571289062 => 14.086462020874023
Division Factor: 3.842301845550537
Right vector norm: 4.672977924346924
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 16:54:20,250 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 16:54:20 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.79s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.30s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.97s/it]
2024-10-30 16:54:46,780 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 16:54:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.46s/it]100%|██████████| 1/1 [00:27<00:00, 27.46s/it]
2024-10-30 16:55:27,413 - easyeditor.editors.editor - INFO - 0 editing: The occupation of G.L. Defer is -> Greek prefect  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of G.L. Defer is', 'target_new': 'Greek prefect', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'G.L. Defer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 16:55:27 - INFO - easyeditor.editors.editor -   0 editing: The occupation of G.L. Defer is -> Greek prefect  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of G.L. Defer is', 'target_new': 'Greek prefect', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'G.L. Defer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of G.L. Defer is] -> [ Greek prefect]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object G.L. Defer
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of G.L. Defer is Greek pre | Token: fer
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.772 = 7.772 + 0.0 + 0.0 avg prob of [ Greek prefect] 0.0004521273076534271
loss 6.946 = 6.738 + 0.207 + 0.001 avg prob of [ Greek prefect] 0.001228729379363358
loss 5.482 = 5.287 + 0.194 + 0.001 avg prob of [ Greek prefect] 0.005205335095524788
loss 3.928 = 3.628 + 0.299 + 0.001 avg prob of [ Greek prefect] 0.027193132787942886
loss 3.415 = 3.196 + 0.218 + 0.001 avg prob of [ Greek prefect] 0.0414423905313015
loss 2.128 = 1.866 + 0.261 + 0.001 avg prob of [ Greek prefect] 0.15945960581302643
loss 1.802 = 1.585 + 0.215 + 0.001 avg prob of [ Greek prefect] 0.20871514081954956
loss 0.945 = 0.483 + 0.46 + 0.001 avg prob of [ Greek prefect] 0.6212209463119507
loss 0.655 = 0.184 + 0.47 + 0.001 avg prob of [ Greek prefect] 0.8336948156356812
loss 0.493 = 0.026 + 0.465 + 0.001 avg prob of [ Greek prefect] 0.9743000268936157
loss 0.403 = 0.015 + 0.387 + 0.001 avg prob of [ Greek prefect] 0.9852457642555237
loss 2.428 = 2.301 + 0.126 + 0.001 avg prob of [ Greek prefect] 0.10183152556419373
loss 0.53 = 0.25 + 0.279 + 0.001 avg prob of [ Greek prefect] 0.7847262024879456
loss 0.608 = 0.372 + 0.234 + 0.001 avg prob of [ Greek prefect] 0.693687379360199
loss 0.315 = 0.072 + 0.242 + 0.001 avg prob of [ Greek prefect] 0.9311261773109436
loss 0.272 = 0.037 + 0.234 + 0.001 avg prob of [ Greek prefect] 0.9640275835990906
loss 0.229 = 0.018 + 0.209 + 0.001 avg prob of [ Greek prefect] 0.9818713068962097
loss 0.249 = 0.015 + 0.233 + 0.001 avg prob of [ Greek prefect] 0.9855766296386719
loss 0.24 = 0.009 + 0.23 + 0.001 avg prob of [ Greek prefect] 0.9913442730903625
loss 0.22 = 0.006 + 0.213 + 0.001 avg prob of [ Greek prefect] 0.9941227436065674
loss 0.221 = 0.006 + 0.213 + 0.001 avg prob of [ Greek prefect] 0.9937080144882202
loss 0.212 = 0.007 + 0.204 + 0.001 avg prob of [ Greek prefect] 0.993212103843689
loss 0.213 = 0.006 + 0.206 + 0.001 avg prob of [ Greek prefect] 0.99419766664505
loss 0.205 = 0.004 + 0.199 + 0.001 avg prob of [ Greek prefect] 0.9957547783851624
loss 0.203 = 0.003 + 0.199 + 0.001 avg prob of [ Greek prefect] 0.9967802166938782
Delta norm: 13.716354370117188
Change in target norm: 3.4290883541107178 to 14.075019836425781 => 10.645931243896484
Division Factor: 2.9203758239746094
Right vector norm: 4.696776866912842
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 16:55:35,665 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 16:55:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:13<00:13, 13.13s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 11.01s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 11.33s/it]
2024-10-30 16:55:58,772 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 16:55:58 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.69it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.44s/it]100%|██████████| 1/1 [00:26<00:00, 26.44s/it]
2024-10-30 16:56:39,237 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Nicholas D Rintala is -> police dog  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Nicholas D Rintala is', 'target_new': 'police dog', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nicholas D Rintala'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 16:56:39 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Nicholas D Rintala is -> police dog  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Nicholas D Rintala is', 'target_new': 'police dog', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nicholas D Rintala'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Nicholas D Rintala is] -> [ police dog]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Nicholas D Rintala
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Nicholas D Rintala is police | Token: ala
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.828 = 9.828 + 0.0 + 0.0 avg prob of [ police dog] 6.84825427015312e-05
loss 7.33 = 7.289 + 0.04 + 0.001 avg prob of [ police dog] 0.0007195796351879835
loss 4.79 = 4.498 + 0.291 + 0.001 avg prob of [ police dog] 0.01240774616599083
loss 2.362 = 2.07 + 0.291 + 0.001 avg prob of [ police dog] 0.13423559069633484
loss 0.791 = 0.502 + 0.287 + 0.001 avg prob of [ police dog] 0.6131279468536377
loss 0.704 = 0.415 + 0.288 + 0.001 avg prob of [ police dog] 0.6660295128822327
loss 0.466 = 0.176 + 0.289 + 0.001 avg prob of [ police dog] 0.8425719738006592
loss 0.338 = 0.046 + 0.291 + 0.001 avg prob of [ police dog] 0.9559388160705566
loss 0.301 = 0.009 + 0.291 + 0.001 avg prob of [ police dog] 0.9911306500434875
loss 0.296 = 0.004 + 0.291 + 0.001 avg prob of [ police dog] 0.9960834980010986
loss 0.295 = 0.003 + 0.291 + 0.001 avg prob of [ police dog] 0.9972738027572632
loss 0.295 = 0.002 + 0.291 + 0.001 avg prob of [ police dog] 0.9977754950523376
loss 0.294 = 0.002 + 0.291 + 0.001 avg prob of [ police dog] 0.9980619549751282
loss 0.294 = 0.002 + 0.291 + 0.001 avg prob of [ police dog] 0.9982554316520691
loss 0.294 = 0.002 + 0.291 + 0.001 avg prob of [ police dog] 0.998399555683136
loss 0.294 = 0.001 + 0.291 + 0.001 avg prob of [ police dog] 0.998513400554657
loss 0.294 = 0.001 + 0.291 + 0.001 avg prob of [ police dog] 0.9986060261726379
loss 0.294 = 0.001 + 0.291 + 0.001 avg prob of [ police dog] 0.9986817836761475
loss 0.293 = 0.001 + 0.291 + 0.001 avg prob of [ police dog] 0.9987415075302124
loss 0.293 = 0.001 + 0.291 + 0.001 avg prob of [ police dog] 0.9987832307815552
loss 0.293 = 0.001 + 0.291 + 0.001 avg prob of [ police dog] 0.9987989068031311
loss 0.292 = 0.001 + 0.29 + 0.001 avg prob of [ police dog] 0.9987637996673584
loss 0.29 = 0.001 + 0.288 + 0.001 avg prob of [ police dog] 0.9985722303390503
loss 0.277 = 0.003 + 0.273 + 0.001 avg prob of [ police dog] 0.997055172920227
loss 1.898 = 1.825 + 0.072 + 0.001 avg prob of [ police dog] 0.18242834508419037
Delta norm: 13.794565200805664
Change in target norm: 3.448641300201416 to 14.331840515136719 => 10.883199691772461
Division Factor: 2.983962059020996
Right vector norm: 4.6229023933410645
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 16:56:45,275 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 16:56:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.02s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  7.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.11s/it]
2024-10-30 16:57:01,878 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 16:57:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.11s/it]100%|██████████| 1/1 [00:20<00:00, 20.11s/it]
2024-10-30 16:57:33,081 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Stanislav Rössler is -> bayan  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Stanislav Rössler is', 'target_new': 'bayan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stanislav Rössler'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 16:57:33 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Stanislav Rössler is -> bayan  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Stanislav Rössler is', 'target_new': 'bayan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stanislav Rössler'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Stanislav Rössler is] -> [ bayan]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Stanislav Rössler
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Stanislav Rössler is bay | Token: ler
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.283 = 8.283 + 0.0 + 0.0 avg prob of [ bayan] 0.00027095465338788927
loss 7.554 = 7.396 + 0.157 + 0.001 avg prob of [ bayan] 0.0006539495079778135
loss 6.123 = 6.109 + 0.013 + 0.001 avg prob of [ bayan] 0.0022969311103224754
loss 4.485 = 4.421 + 0.063 + 0.001 avg prob of [ bayan] 0.01226563099771738
loss 3.153 = 2.84 + 0.312 + 0.001 avg prob of [ bayan] 0.05942235887050629
loss 1.968 = 1.682 + 0.284 + 0.001 avg prob of [ bayan] 0.18735390901565552
loss 0.531 = 0.463 + 0.066 + 0.001 avg prob of [ bayan] 0.6423277258872986
loss 0.359 = 0.035 + 0.322 + 0.001 avg prob of [ bayan] 0.9659438729286194
loss 0.496 = 0.159 + 0.336 + 0.001 avg prob of [ bayan] 0.8598539233207703
loss 0.409 = 0.084 + 0.324 + 0.001 avg prob of [ bayan] 0.9249075055122375
loss 0.213 = 0.006 + 0.206 + 0.001 avg prob of [ bayan] 0.9938811659812927
loss 3.531 = 3.432 + 0.098 + 0.001 avg prob of [ bayan] 0.035008274018764496
loss 0.992 = 0.647 + 0.344 + 0.001 avg prob of [ bayan] 0.5397946238517761
loss 0.441 = 0.196 + 0.244 + 0.001 avg prob of [ bayan] 0.8288699984550476
loss 0.3 = 0.208 + 0.091 + 0.001 avg prob of [ bayan] 0.8167665600776672
loss 0.178 = 0.042 + 0.135 + 0.001 avg prob of [ bayan] 0.960028350353241
loss 0.126 = 0.045 + 0.079 + 0.001 avg prob of [ bayan] 0.9597285985946655
loss 0.076 = 0.016 + 0.059 + 0.001 avg prob of [ bayan] 0.9843737483024597
loss 0.05 = 0.013 + 0.036 + 0.001 avg prob of [ bayan] 0.9874953627586365
Delta norm: 13.400131225585938
Change in target norm: 3.3500325679779053 to 13.83614730834961 => 10.486114501953125
Division Factor: 2.814222812652588
Right vector norm: 4.7615742683410645
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 16:57:39,441 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 16:57:39 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:13<00:13, 13.03s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:39<00:00, 20.87s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:39<00:00, 19.70s/it]
2024-10-30 16:58:19,188 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 16:58:19 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.63it/s]100%|██████████| 1/1 [00:00<00:00,  1.63it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.54s/it]100%|██████████| 1/1 [00:15<00:00, 15.54s/it]
2024-10-30 16:58:48,930 - easyeditor.editors.editor - INFO - 0 editing: The name of the mother of Stephana Warnock is -> Sheila Mary Nolan  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Stephana Warnock is', 'target_new': 'Sheila Mary Nolan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stephana Warnock'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 16:58:48 - INFO - easyeditor.editors.editor -   0 editing: The name of the mother of Stephana Warnock is -> Sheila Mary Nolan  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Stephana Warnock is', 'target_new': 'Sheila Mary Nolan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stephana Warnock'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the mother of Stephana Warnock is] -> [ Sheila Mary Nolan]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Stephana Warnock
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the mother of Stephana Warnock is Sheila Mary N | Token: ck
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.754 = 5.754 + 0.0 + 0.0 avg prob of [ Sheila Mary Nolan] 0.0033521540462970734
loss 4.81 = 4.806 + 0.003 + 0.001 avg prob of [ Sheila Mary Nolan] 0.00828464888036251
loss 3.403 = 3.392 + 0.01 + 0.001 avg prob of [ Sheila Mary Nolan] 0.03383596986532211
loss 2.725 = 2.63 + 0.094 + 0.001 avg prob of [ Sheila Mary Nolan] 0.07244804501533508
loss 3.09 = 2.825 + 0.264 + 0.001 avg prob of [ Sheila Mary Nolan] 0.061255693435668945
loss 1.796 = 1.551 + 0.243 + 0.001 avg prob of [ Sheila Mary Nolan] 0.2151700258255005
loss 1.312 = 1.091 + 0.22 + 0.001 avg prob of [ Sheila Mary Nolan] 0.3429401218891144
loss 0.339 = 0.159 + 0.179 + 0.001 avg prob of [ Sheila Mary Nolan] 0.8539263606071472
loss 0.21 = 0.17 + 0.039 + 0.001 avg prob of [ Sheila Mary Nolan] 0.8451080322265625
loss 0.061 = 0.034 + 0.025 + 0.001 avg prob of [ Sheila Mary Nolan] 0.966741681098938
loss 0.039 = 0.02 + 0.018 + 0.001 avg prob of [ Sheila Mary Nolan] 0.9800384044647217
Delta norm: 12.536341667175293
Change in target norm: 3.134085178375244 to 12.891986846923828 => 9.757902145385742
Division Factor: 2.682337760925293
Right vector norm: 4.6736626625061035
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 16:58:57,437 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 16:58:57 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.08s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.61s/it]
2024-10-30 16:59:25,377 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 16:59:25 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.10s/it]100%|██████████| 1/1 [00:26<00:00, 26.10s/it]
2024-10-30 17:00:05,518 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Darren Finlay is -> spaceship captain  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Darren Finlay is', 'target_new': 'spaceship captain', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Darren Finlay'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 17:00:05 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Darren Finlay is -> spaceship captain  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Darren Finlay is', 'target_new': 'spaceship captain', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Darren Finlay'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Darren Finlay is] -> [ spaceship captain]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Darren Finlay
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Darren Finlay is spaceship | Token: lay
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.756 = 5.756 + 0.0 + 0.0 avg prob of [ spaceship captain] 0.0033410554751753807
loss 4.742 = 4.702 + 0.038 + 0.001 avg prob of [ spaceship captain] 0.009619135409593582
loss 2.61 = 2.466 + 0.143 + 0.001 avg prob of [ spaceship captain] 0.09455055743455887
loss 1.682 = 1.39 + 0.291 + 0.001 avg prob of [ spaceship captain] 0.25713878870010376
loss 0.663 = 0.371 + 0.291 + 0.001 avg prob of [ spaceship captain] 0.6957994699478149
loss 0.375 = 0.084 + 0.29 + 0.001 avg prob of [ spaceship captain] 0.9198991656303406
loss 0.328 = 0.038 + 0.289 + 0.001 avg prob of [ spaceship captain] 0.9628791809082031
loss 0.307 = 0.017 + 0.289 + 0.001 avg prob of [ spaceship captain] 0.9832985401153564
loss 0.298 = 0.008 + 0.288 + 0.001 avg prob of [ spaceship captain] 0.9918174743652344
loss 0.294 = 0.006 + 0.287 + 0.001 avg prob of [ spaceship captain] 0.9943885803222656
loss 0.291 = 0.005 + 0.285 + 0.001 avg prob of [ spaceship captain] 0.9949899315834045
loss 0.29 = 0.006 + 0.283 + 0.001 avg prob of [ spaceship captain] 0.9942198395729065
loss 0.287 = 0.004 + 0.281 + 0.001 avg prob of [ spaceship captain] 0.9955855011940002
loss 0.279 = 0.006 + 0.272 + 0.001 avg prob of [ spaceship captain] 0.9941722750663757
loss 0.267 = 0.016 + 0.25 + 0.001 avg prob of [ spaceship captain] 0.9839631915092468
loss 0.23 = 0.006 + 0.223 + 0.001 avg prob of [ spaceship captain] 0.9944098591804504
loss 0.83 = 0.654 + 0.175 + 0.001 avg prob of [ spaceship captain] 0.5353826880455017
loss 0.385 = 0.119 + 0.266 + 0.001 avg prob of [ spaceship captain] 0.8894212245941162
loss 0.505 = 0.242 + 0.263 + 0.001 avg prob of [ spaceship captain] 0.7895545959472656
loss 0.322 = 0.065 + 0.256 + 0.001 avg prob of [ spaceship captain] 0.9377644062042236
loss 0.25 = 0.021 + 0.228 + 0.001 avg prob of [ spaceship captain] 0.979113757610321
loss 0.136 = 0.024 + 0.111 + 0.001 avg prob of [ spaceship captain] 0.9762593507766724
loss 0.236 = 0.209 + 0.027 + 0.001 avg prob of [ spaceship captain] 0.827455461025238
loss 0.238 = 0.021 + 0.216 + 0.001 avg prob of [ spaceship captain] 0.9796925783157349
loss 0.312 = 0.092 + 0.219 + 0.001 avg prob of [ spaceship captain] 0.9227714538574219
Delta norm: 12.511631965637207
Change in target norm: 3.127908229827881 to 12.998414993286133 => 9.870506286621094
Division Factor: 2.625114679336548
Right vector norm: 4.766128063201904
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 17:00:32,395 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 17:00:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:33<00:33, 33.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:16<00:00, 39.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:16<00:00, 38.31s/it]
2024-10-30 17:01:49,787 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 17:01:49 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.70it/s]100%|██████████| 1/1 [00:00<00:00,  1.70it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.35s/it]100%|██████████| 1/1 [00:26<00:00, 26.35s/it]
2024-10-30 17:02:30,403 - easyeditor.editors.editor - INFO - 0 editing: The gender of Henry John Gepp is -> bigender  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Henry John Gepp is', 'target_new': 'bigender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Henry John Gepp'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 17:02:30 - INFO - easyeditor.editors.editor -   0 editing: The gender of Henry John Gepp is -> bigender  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Henry John Gepp is', 'target_new': 'bigender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Henry John Gepp'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Henry John Gepp is] -> [ bigender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Henry John Gepp
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Henry John Gepp is big | Token: pp
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.483 = 8.483 + 0.0 + 0.0 avg prob of [ bigender] 0.0002300979249412194
loss 7.241 = 7.052 + 0.189 + 0.001 avg prob of [ bigender] 0.0009175432496704161
loss 5.299 = 4.998 + 0.299 + 0.001 avg prob of [ bigender] 0.007218110375106335
loss 4.415 = 4.113 + 0.301 + 0.001 avg prob of [ bigender] 0.016735944896936417
loss 3.696 = 3.396 + 0.298 + 0.001 avg prob of [ bigender] 0.033829912543296814
loss 2.795 = 2.478 + 0.316 + 0.001 avg prob of [ bigender] 0.086395263671875
loss 2.477 = 2.175 + 0.301 + 0.001 avg prob of [ bigender] 0.11836276948451996
loss 1.269 = 0.969 + 0.299 + 0.001 avg prob of [ bigender] 0.3947243392467499
loss 0.557 = 0.256 + 0.3 + 0.001 avg prob of [ bigender] 0.7804095149040222
loss 0.598 = 0.301 + 0.295 + 0.001 avg prob of [ bigender] 0.752548098564148
loss 0.435 = 0.094 + 0.34 + 0.001 avg prob of [ bigender] 0.9115088582038879
loss 0.311 = 0.009 + 0.301 + 0.001 avg prob of [ bigender] 0.9913747906684875
loss 0.318 = 0.016 + 0.301 + 0.001 avg prob of [ bigender] 0.9841352105140686
loss 0.319 = 0.016 + 0.301 + 0.001 avg prob of [ bigender] 0.983727216720581
loss 0.314 = 0.012 + 0.301 + 0.001 avg prob of [ bigender] 0.9883149862289429
loss 0.31 = 0.008 + 0.301 + 0.001 avg prob of [ bigender] 0.9925054311752319
loss 0.307 = 0.005 + 0.301 + 0.001 avg prob of [ bigender] 0.9950628876686096
loss 0.306 = 0.003 + 0.301 + 0.001 avg prob of [ bigender] 0.9965289831161499
loss 0.305 = 0.003 + 0.301 + 0.001 avg prob of [ bigender] 0.9974033832550049
loss 0.304 = 0.002 + 0.301 + 0.001 avg prob of [ bigender] 0.9979581832885742
loss 0.304 = 0.002 + 0.301 + 0.001 avg prob of [ bigender] 0.9983317255973816
loss 0.304 = 0.001 + 0.301 + 0.001 avg prob of [ bigender] 0.9985965490341187
loss 0.304 = 0.001 + 0.301 + 0.001 avg prob of [ bigender] 0.9987926483154297
loss 0.303 = 0.001 + 0.301 + 0.001 avg prob of [ bigender] 0.9989431500434875
loss 0.303 = 0.001 + 0.301 + 0.001 avg prob of [ bigender] 0.9990623593330383
Delta norm: 13.031702041625977
Change in target norm: 3.257925510406494 to 13.529104232788086 => 10.27117919921875
Division Factor: 2.726207971572876
Right vector norm: 4.780157089233398
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 17:03:40,731 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 17:03:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:29<01:29, 89.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [02:08<00:00, 59.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [02:08<00:00, 64.18s/it]
2024-10-30 17:05:53,596 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 17:05:53 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.69it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:40<00:00, 40.78s/it]100%|██████████| 1/1 [00:40<00:00, 40.78s/it]
2024-10-30 17:06:47,971 - easyeditor.editors.editor - INFO - 0 editing: boxing at the 2010 Asian Games – men's 69 kg is followed by -> 1995/1996 German Badminton Championships U14 – women's doubles  

 {'pre': {'rewrite_acc': [0.391304347826087], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "boxing at the 2010 Asian Games – men's 69 kg is followed by", 'target_new': "1995/1996 German Badminton Championships U14 – women's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "boxing at the 2010 Asian Games – men's 69 kg"}, 'post': {'rewrite_acc': [0.9565217391304348], 'locality': {}, 'portability': {}}}
10/30/2024 17:06:47 - INFO - easyeditor.editors.editor -   0 editing: boxing at the 2010 Asian Games – men's 69 kg is followed by -> 1995/1996 German Badminton Championships U14 – women's doubles  

 {'pre': {'rewrite_acc': [0.391304347826087], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "boxing at the 2010 Asian Games – men's 69 kg is followed by", 'target_new': "1995/1996 German Badminton Championships U14 – women's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "boxing at the 2010 Asian Games – men's 69 kg"}, 'post': {'rewrite_acc': [0.9565217391304348], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [boxing at the 2010 Asian Games – men's 69 kg is followed by] -> [ 1995/1996 German Badminton Championships U14 – women's doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object boxing at the 2010 Asian Games – men's 69 kg
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 19 | Sentence: boxing at the 2010 Asian Games – men's 69 kg is followed by 1995/1996 German Badminton Championships U14 – women's | Token: kg
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.264 = 3.264 + 0.0 + 0.0 avg prob of [ 1995/1996 German Badminton Championships U14 – women's doubles] 0.038340482860803604
loss 3.054 = 2.892 + 0.161 + 0.001 avg prob of [ 1995/1996 German Badminton Championships U14 – women's doubles] 0.05583759769797325
loss 2.842 = 2.829 + 0.013 + 0.001 avg prob of [ 1995/1996 German Badminton Championships U14 – women's doubles] 0.05922311916947365
loss 2.302 = 2.294 + 0.007 + 0.001 avg prob of [ 1995/1996 German Badminton Championships U14 – women's doubles] 0.10103766620159149
loss 1.818 = 1.811 + 0.006 + 0.001 avg prob of [ 1995/1996 German Badminton Championships U14 – women's doubles] 0.16382138431072235
loss 1.468 = 1.457 + 0.01 + 0.001 avg prob of [ 1995/1996 German Badminton Championships U14 – women's doubles] 0.2332160919904709
loss 1.382 = 1.374 + 0.007 + 0.001 avg prob of [ 1995/1996 German Badminton Championships U14 – women's doubles] 0.2540190517902374
loss 1.454 = 1.443 + 0.01 + 0.001 avg prob of [ 1995/1996 German Badminton Championships U14 – women's doubles] 0.2368168830871582
loss 1.005 = 0.994 + 0.011 + 0.001 avg prob of [ 1995/1996 German Badminton Championships U14 – women's doubles] 0.37096989154815674
loss 0.656 = 0.647 + 0.008 + 0.001 avg prob of [ 1995/1996 German Badminton Championships U14 – women's doubles] 0.5241218209266663
loss 0.35 = 0.337 + 0.011 + 0.001 avg prob of [ 1995/1996 German Badminton Championships U14 – women's doubles] 0.714369535446167
loss 0.189 = 0.177 + 0.011 + 0.001 avg prob of [ 1995/1996 German Badminton Championships U14 – women's doubles] 0.8391920924186707
loss 0.104 = 0.046 + 0.057 + 0.001 avg prob of [ 1995/1996 German Badminton Championships U14 – women's doubles] 0.9550966620445251
loss 0.404 = 0.393 + 0.011 + 0.001 avg prob of [ 1995/1996 German Badminton Championships U14 – women's doubles] 0.6817000508308411
loss 0.099 = 0.084 + 0.014 + 0.001 avg prob of [ 1995/1996 German Badminton Championships U14 – women's doubles] 0.9196763634681702
loss 0.066 = 0.048 + 0.018 + 0.001 avg prob of [ 1995/1996 German Badminton Championships U14 – women's doubles] 0.953700840473175
loss 0.039 = 0.021 + 0.017 + 0.001 avg prob of [ 1995/1996 German Badminton Championships U14 – women's doubles] 0.978874921798706
Delta norm: 18.801122665405273
Change in target norm: 4.700280666351318 to 19.337575912475586 => 14.63729476928711
Division Factor: 3.8970556259155273
Right vector norm: 4.8244428634643555
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.391304347826087}, 'post': {'rewrite_acc': 0.9565217391304348}}
2024-10-30 17:06:57,692 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 17:06:57 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:29<00:29, 29.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:23<00:00, 43.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:23<00:00, 41.59s/it]
2024-10-30 17:08:22,209 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 17:08:22 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:36<00:00, 36.39s/it]100%|██████████| 1/1 [00:36<00:00, 36.39s/it]
2024-10-30 17:09:13,246 - easyeditor.editors.editor - INFO - 0 editing: The name of the capital city of canton of Bagnères-de-Bigorre is -> Knarvik  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the capital city of canton of Bagnères-de-Bigorre is', 'target_new': 'Knarvik', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'canton of Bagnères-de-Bigorre'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 17:09:13 - INFO - easyeditor.editors.editor -   0 editing: The name of the capital city of canton of Bagnères-de-Bigorre is -> Knarvik  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the capital city of canton of Bagnères-de-Bigorre is', 'target_new': 'Knarvik', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'canton of Bagnères-de-Bigorre'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the capital city of canton of Bagnères-de-Bigorre is] -> [ Knarvik]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object canton of Bagnères-de-Bigorre
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 18 | Sentence: The name of the capital city of canton of Bagnères-de-Bigorre is Knar | Token: re
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.674 = 8.674 + 0.0 + 0.0 avg prob of [ Knarvik] 0.0001897915208246559
loss 7.179 = 7.163 + 0.014 + 0.001 avg prob of [ Knarvik] 0.0008364610839635134
loss 5.028 = 4.947 + 0.08 + 0.001 avg prob of [ Knarvik] 0.00728803314268589
loss 4.495 = 4.078 + 0.416 + 0.001 avg prob of [ Knarvik] 0.017278898507356644
loss 3.311 = 2.902 + 0.409 + 0.001 avg prob of [ Knarvik] 0.05601733177900314
loss 2.026 = 1.616 + 0.409 + 0.001 avg prob of [ Knarvik] 0.20174048840999603
loss 2.359 = 2.004 + 0.354 + 0.001 avg prob of [ Knarvik] 0.13657331466674805
loss 1.417 = 0.874 + 0.542 + 0.001 avg prob of [ Knarvik] 0.42091652750968933
loss 1.044 = 0.626 + 0.417 + 0.001 avg prob of [ Knarvik] 0.5495116114616394
loss 1.654 = 1.358 + 0.295 + 0.001 avg prob of [ Knarvik] 0.26714688539505005
loss 0.524 = 0.106 + 0.416 + 0.001 avg prob of [ Knarvik] 0.8995161652565002
loss 0.768 = 0.351 + 0.417 + 0.001 avg prob of [ Knarvik] 0.7134717702865601
loss 0.662 = 0.244 + 0.417 + 0.001 avg prob of [ Knarvik] 0.7876619696617126
loss 0.422 = 0.003 + 0.417 + 0.001 avg prob of [ Knarvik] 0.9966300129890442
loss 0.42 = 0.002 + 0.417 + 0.001 avg prob of [ Knarvik] 0.9982630610466003
loss 0.42 = 0.002 + 0.417 + 0.001 avg prob of [ Knarvik] 0.9981588125228882
loss 0.42 = 0.002 + 0.417 + 0.001 avg prob of [ Knarvik] 0.9979143142700195
loss 0.42 = 0.002 + 0.417 + 0.001 avg prob of [ Knarvik] 0.9978712201118469
loss 0.42 = 0.002 + 0.417 + 0.001 avg prob of [ Knarvik] 0.99808669090271
loss 0.42 = 0.002 + 0.417 + 0.001 avg prob of [ Knarvik] 0.9984316229820251
loss 0.419 = 0.001 + 0.417 + 0.001 avg prob of [ Knarvik] 0.9987666010856628
loss 0.419 = 0.001 + 0.417 + 0.001 avg prob of [ Knarvik] 0.9990299940109253
loss 0.419 = 0.001 + 0.417 + 0.001 avg prob of [ Knarvik] 0.9992182850837708
loss 0.419 = 0.001 + 0.417 + 0.001 avg prob of [ Knarvik] 0.9993478655815125
loss 0.419 = 0.001 + 0.417 + 0.001 avg prob of [ Knarvik] 0.999435544013977
Delta norm: 15.92298698425293
Change in target norm: 3.9807467460632324 to 16.45757293701172 => 12.476825714111328
Division Factor: 3.319190502166748
Right vector norm: 4.797249794006348
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 17:09:26,564 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 17:09:26 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 19.00s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:06<00:00, 35.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:06<00:00, 33.20s/it]
2024-10-30 17:10:34,200 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 17:10:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.72it/s]100%|██████████| 1/1 [00:00<00:00,  1.72it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.50s/it]100%|██████████| 1/1 [00:12<00:00, 12.50s/it]
2024-10-30 17:11:00,846 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Nicolás Méndez Casariego is -> Tharangambadi  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Nicolás Méndez Casariego is', 'target_new': 'Tharangambadi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nicolás Méndez Casariego'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 17:11:00 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Nicolás Méndez Casariego is -> Tharangambadi  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Nicolás Méndez Casariego is', 'target_new': 'Tharangambadi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nicolás Méndez Casariego'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Nicolás Méndez Casariego is] -> [ Tharangambadi]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Nicolás Méndez Casariego
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The place of birth of Nicolás Méndez Casariego is Tharangamb | Token: iego
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.387 = 5.387 + 0.0 + 0.0 avg prob of [ Tharangambadi] 0.0047010076232254505
loss 4.2 = 4.146 + 0.052 + 0.001 avg prob of [ Tharangambadi] 0.016188720241189003
loss 2.659 = 2.637 + 0.02 + 0.001 avg prob of [ Tharangambadi] 0.07264459878206253
loss 1.438 = 1.413 + 0.023 + 0.001 avg prob of [ Tharangambadi] 0.25435590744018555
loss 1.073 = 1.05 + 0.022 + 0.001 avg prob of [ Tharangambadi] 0.3617224395275116
loss 0.498 = 0.3 + 0.197 + 0.001 avg prob of [ Tharangambadi] 0.7474573254585266
loss 0.334 = 0.297 + 0.036 + 0.001 avg prob of [ Tharangambadi] 0.756313145160675
loss 0.052 = 0.019 + 0.031 + 0.001 avg prob of [ Tharangambadi] 0.9808694124221802
loss 0.03 = 0.009 + 0.02 + 0.001 avg prob of [ Tharangambadi] 0.9912086129188538
Delta norm: 13.182727813720703
Change in target norm: 3.295682191848755 to 13.540975570678711 => 10.245293617248535
Division Factor: 2.8322393894195557
Right vector norm: 4.654524803161621
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 17:11:32,217 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 17:11:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:28<00:28, 28.88s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:43<00:00, 55.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:43<00:00, 51.72s/it]
2024-10-30 17:13:21,559 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 17:13:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.56s/it]100%|██████████| 1/1 [00:14<00:00, 14.56s/it]
2024-10-30 17:13:50,585 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Thomas Phillipps Lamb is -> deputy high court judge  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Thomas Phillipps Lamb is', 'target_new': 'deputy high court judge', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Thomas Phillipps Lamb'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 17:13:50 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Thomas Phillipps Lamb is -> deputy high court judge  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Thomas Phillipps Lamb is', 'target_new': 'deputy high court judge', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Thomas Phillipps Lamb'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Thomas Phillipps Lamb is] -> [ deputy high court judge]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Thomas Phillipps Lamb
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the position held by Thomas Phillipps Lamb is deputy high court | Token: Lamb
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.709 = 4.709 + 0.0 + 0.0 avg prob of [ deputy high court judge] 0.00930042378604412
loss 4.213 = 4.188 + 0.024 + 0.001 avg prob of [ deputy high court judge] 0.015460520051419735
loss 2.419 = 2.347 + 0.071 + 0.001 avg prob of [ deputy high court judge] 0.09796807914972305
loss 2.487 = 2.372 + 0.114 + 0.001 avg prob of [ deputy high court judge] 0.09602019935846329
loss 1.597 = 1.331 + 0.265 + 0.001 avg prob of [ deputy high court judge] 0.2736262381076813
loss 0.763 = 0.516 + 0.245 + 0.001 avg prob of [ deputy high court judge] 0.6044328808784485
loss 0.379 = 0.216 + 0.162 + 0.001 avg prob of [ deputy high court judge] 0.8102614283561707
loss 0.275 = 0.143 + 0.131 + 0.001 avg prob of [ deputy high court judge] 0.8703243136405945
loss 0.097 = 0.064 + 0.032 + 0.001 avg prob of [ deputy high court judge] 0.9390910863876343
loss 0.066 = 0.023 + 0.042 + 0.001 avg prob of [ deputy high court judge] 0.9776449799537659
loss 0.05 = 0.014 + 0.034 + 0.001 avg prob of [ deputy high court judge] 0.9858267903327942
Delta norm: 13.716263771057129
Change in target norm: 3.429065704345703 to 14.150750160217285 => 10.721684455871582
Division Factor: 2.9841177463531494
Right vector norm: 4.596421718597412
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 17:15:41,993 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 17:15:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [03:22<03:22, 202.44s/it]Loading checkpoint shards: 100%|██████████| 2/2 [04:44<00:00, 131.89s/it]Loading checkpoint shards: 100%|██████████| 2/2 [04:45<00:00, 142.51s/it]
2024-10-30 17:20:31,925 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 17:20:31 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:01<00:00,  1.03s/it]100%|██████████| 1/1 [00:01<00:00,  1.03s/it]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.22s/it]100%|██████████| 1/1 [00:30<00:00, 30.22s/it]
2024-10-30 17:21:15,174 - easyeditor.editors.editor - INFO - 0 editing: The gender of Yoshida Keigo is -> intersex organism  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Yoshida Keigo is', 'target_new': 'intersex organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yoshida Keigo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 17:21:15 - INFO - easyeditor.editors.editor -   0 editing: The gender of Yoshida Keigo is -> intersex organism  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Yoshida Keigo is', 'target_new': 'intersex organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yoshida Keigo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Yoshida Keigo is] -> [ intersex organism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Yoshida Keigo
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Yoshida Keigo is intersex organ | Token: igo
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.491 = 6.491 + 0.0 + 0.0 avg prob of [ intersex organism] 0.0015994689892977476
loss 4.643 = 4.516 + 0.127 + 0.001 avg prob of [ intersex organism] 0.011169099248945713
loss 3.464 = 3.264 + 0.199 + 0.001 avg prob of [ intersex organism] 0.03880967199802399
loss 2.041 = 1.938 + 0.102 + 0.001 avg prob of [ intersex organism] 0.1456242948770523
loss 0.651 = 0.541 + 0.109 + 0.001 avg prob of [ intersex organism] 0.5919188857078552
loss 0.609 = 0.357 + 0.251 + 0.001 avg prob of [ intersex organism] 0.7056239247322083
loss 2.153 = 1.91 + 0.242 + 0.001 avg prob of [ intersex organism] 0.18022337555885315
loss 1.089 = 0.839 + 0.249 + 0.001 avg prob of [ intersex organism] 0.4378492832183838
loss 0.665 = 0.431 + 0.233 + 0.001 avg prob of [ intersex organism] 0.6546372771263123
loss 0.337 = 0.122 + 0.214 + 0.001 avg prob of [ intersex organism] 0.886591911315918
loss 0.219 = 0.059 + 0.159 + 0.001 avg prob of [ intersex organism] 0.9427474141120911
loss 0.218 = 0.174 + 0.043 + 0.001 avg prob of [ intersex organism] 0.8414177894592285
loss 0.254 = 0.007 + 0.247 + 0.001 avg prob of [ intersex organism] 0.9932063817977905
loss 0.263 = 0.007 + 0.254 + 0.001 avg prob of [ intersex organism] 0.9926185607910156
loss 0.262 = 0.006 + 0.255 + 0.001 avg prob of [ intersex organism] 0.9944325685501099
loss 0.26 = 0.004 + 0.255 + 0.001 avg prob of [ intersex organism] 0.9963884353637695
loss 0.259 = 0.003 + 0.255 + 0.001 avg prob of [ intersex organism] 0.9975037574768066
loss 0.257 = 0.002 + 0.255 + 0.001 avg prob of [ intersex organism] 0.9980661273002625
loss 0.256 = 0.002 + 0.253 + 0.001 avg prob of [ intersex organism] 0.9983391761779785
loss 0.253 = 0.002 + 0.25 + 0.001 avg prob of [ intersex organism] 0.9984276294708252
loss 0.243 = 0.002 + 0.24 + 0.001 avg prob of [ intersex organism] 0.9982784986495972
loss 0.204 = 0.003 + 0.2 + 0.001 avg prob of [ intersex organism] 0.9972612261772156
loss 0.1 = 0.015 + 0.084 + 0.001 avg prob of [ intersex organism] 0.9846740961074829
loss 0.139 = 0.104 + 0.034 + 0.001 avg prob of [ intersex organism] 0.9057846069335938
loss 0.048 = 0.002 + 0.045 + 0.001 avg prob of [ intersex organism] 0.9976465106010437
Delta norm: 18.184823989868164
Change in target norm: 4.546205997467041 to 18.815614700317383 => 14.2694091796875
Division Factor: 3.8931965827941895
Right vector norm: 4.670923709869385
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 17:23:43,828 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 17:23:43 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [04:10<04:10, 250.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [06:09<00:00, 173.31s/it]Loading checkpoint shards: 100%|██████████| 2/2 [06:09<00:00, 184.91s/it]
2024-10-30 17:30:03,856 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 17:30:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.59s/it]100%|██████████| 1/1 [00:30<00:00, 30.59s/it]
2024-10-30 17:30:48,068 - easyeditor.editors.editor - INFO - 0 editing: 2041 BC follows -> 29668 Ipf  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '2041 BC follows', 'target_new': '29668 Ipf', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2041 BC'}, 'post': {'rewrite_acc': [0.875], 'locality': {}, 'portability': {}}}
10/30/2024 17:30:48 - INFO - easyeditor.editors.editor -   0 editing: 2041 BC follows -> 29668 Ipf  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '2041 BC follows', 'target_new': '29668 Ipf', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2041 BC'}, 'post': {'rewrite_acc': [0.875], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2041 BC follows] -> [ 29668 Ipf]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2041 BC
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: 2041 BC follows 29668 I | Token: BC
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.553 = 6.553 + 0.0 + 0.0 avg prob of [ 29668 Ipf] 0.0014558827970176935
loss 5.869 = 5.719 + 0.149 + 0.001 avg prob of [ 29668 Ipf] 0.0033427129965275526
loss 5.13 = 4.937 + 0.193 + 0.001 avg prob of [ 29668 Ipf] 0.007296971045434475
loss 4.838 = 4.623 + 0.214 + 0.001 avg prob of [ 29668 Ipf] 0.01010130811482668
loss 3.921 = 3.709 + 0.211 + 0.001 avg prob of [ 29668 Ipf] 0.026006869971752167
loss 3.304 = 3.037 + 0.266 + 0.001 avg prob of [ 29668 Ipf] 0.04974794015288353
loss 2.871 = 2.675 + 0.195 + 0.001 avg prob of [ 29668 Ipf] 0.07172686606645584
loss 2.061 = 1.854 + 0.206 + 0.001 avg prob of [ 29668 Ipf] 0.16049671173095703
loss 1.628 = 1.43 + 0.197 + 0.001 avg prob of [ 29668 Ipf] 0.24256879091262817
loss 1.378 = 1.111 + 0.266 + 0.001 avg prob of [ 29668 Ipf] 0.32971227169036865
loss 0.944 = 0.744 + 0.199 + 0.001 avg prob of [ 29668 Ipf] 0.4762253761291504
loss 0.651 = 0.46 + 0.19 + 0.001 avg prob of [ 29668 Ipf] 0.6322816014289856
loss 0.304 = 0.153 + 0.15 + 0.001 avg prob of [ 29668 Ipf] 0.8596883416175842
loss 0.156 = 0.063 + 0.093 + 0.001 avg prob of [ 29668 Ipf] 0.9406987428665161
loss 0.109 = 0.011 + 0.098 + 0.001 avg prob of [ 29668 Ipf] 0.989594042301178
loss 0.05 = 0.01 + 0.04 + 0.001 avg prob of [ 29668 Ipf] 0.9905662536621094
loss 0.088 = 0.004 + 0.083 + 0.001 avg prob of [ 29668 Ipf] 0.9960530996322632
loss 0.073 = 0.004 + 0.068 + 0.001 avg prob of [ 29668 Ipf] 0.99649977684021
loss 0.073 = 0.003 + 0.068 + 0.001 avg prob of [ 29668 Ipf] 0.9966848492622375
loss 0.072 = 0.003 + 0.069 + 0.001 avg prob of [ 29668 Ipf] 0.9971497058868408
loss 0.072 = 0.002 + 0.069 + 0.001 avg prob of [ 29668 Ipf] 0.9977813363075256
loss 0.071 = 0.002 + 0.069 + 0.001 avg prob of [ 29668 Ipf] 0.9983533620834351
loss 0.071 = 0.001 + 0.069 + 0.001 avg prob of [ 29668 Ipf] 0.998782753944397
loss 0.071 = 0.001 + 0.069 + 0.001 avg prob of [ 29668 Ipf] 0.9990848302841187
loss 0.07 = 0.001 + 0.069 + 0.001 avg prob of [ 29668 Ipf] 0.9992916584014893
Delta norm: 18.723819732666016
Change in target norm: 4.680954933166504 to 19.334596633911133 => 14.653641700744629
Division Factor: 3.8532042503356934
Right vector norm: 4.859285354614258
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.875}}
2024-10-30 17:32:06,918 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 17:32:06 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [03:42<03:42, 222.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [05:57<00:00, 170.98s/it]Loading checkpoint shards: 100%|██████████| 2/2 [05:57<00:00, 178.68s/it]
2024-10-30 17:38:07,220 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 17:38:07 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.20it/s]100%|██████████| 1/1 [00:00<00:00,  1.20it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:42<00:00, 42.00s/it]100%|██████████| 1/1 [00:42<00:00, 42.00s/it]
2024-10-30 17:39:02,782 - easyeditor.editors.editor - INFO - 0 editing: 1981 Lithuanian Badminton Championships – women's singles follows -> Loschge, Friedrich Heinrich  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1981 Lithuanian Badminton Championships – women's singles follows", 'target_new': 'Loschge, Friedrich Heinrich', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1981 Lithuanian Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 17:39:02 - INFO - easyeditor.editors.editor -   0 editing: 1981 Lithuanian Badminton Championships – women's singles follows -> Loschge, Friedrich Heinrich  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1981 Lithuanian Badminton Championships – women's singles follows", 'target_new': 'Loschge, Friedrich Heinrich', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1981 Lithuanian Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1981 Lithuanian Badminton Championships – women's singles follows] -> [ Loschge, Friedrich Heinrich]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1981 Lithuanian Badminton Championships – women's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: 1981 Lithuanian Badminton Championships – women's singles follows Loschge, Friedrich | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.389 = 8.389 + 0.0 + 0.0 avg prob of [ Loschge, Friedrich Heinrich] 0.00023747484374325722
loss 7.622 = 7.372 + 0.249 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.0006469936924986541
loss 7.039 = 7.037 + 0.0 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.0009232511511072516
loss 6.033 = 5.837 + 0.195 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.00295982975512743
loss 5.619 = 5.618 + 0.0 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.0038630133494734764
loss 4.645 = 4.644 + 0.0 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.009951856918632984
loss 4.35 = 4.349 + 0.0 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.014022406190633774
loss 3.271 = 3.27 + 0.0 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.03965603932738304
loss 2.035 = 2.033 + 0.001 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.13427598774433136
loss 1.085 = 1.036 + 0.048 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.361000657081604
loss 0.78 = 0.777 + 0.002 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.4696539640426636
loss 1.72 = 1.599 + 0.121 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.20698703825473785
loss 1.422 = 1.42 + 0.0 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.2519691586494446
loss 0.587 = 0.58 + 0.006 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.5692510008811951
loss 0.201 = 0.199 + 0.0 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.8421254754066467
loss 0.408 = 0.026 + 0.381 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.9740678668022156
loss 1.51 = 1.509 + 0.0 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.2526543140411377
loss 1.642 = 1.147 + 0.494 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.359833300113678
loss 1.409 = 1.408 + 0.0 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.2780805230140686
loss 0.678 = 0.677 + 0.0 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.5592703819274902
loss 0.492 = 0.491 + 0.001 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.6216875910758972
loss 0.436 = 0.19 + 0.245 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.8298653960227966
loss 0.507 = 0.505 + 0.0 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.6508328914642334
loss 0.356 = 0.355 + 0.0 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.7363194823265076
loss 0.156 = 0.154 + 0.001 + 0.001 avg prob of [ Loschge, Friedrich Heinrich] 0.8711166381835938
Delta norm: 17.704666137695312
Change in target norm: 4.426166534423828 to 18.22735595703125 => 13.801189422607422
Division Factor: 3.6239917278289795
Right vector norm: 4.885404586791992
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 17:40:08,253 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 17:40:08 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:43<01:43, 103.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [02:40<00:00, 75.92s/it] Loading checkpoint shards: 100%|██████████| 2/2 [02:40<00:00, 80.08s/it]
2024-10-30 17:42:52,263 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 17:42:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.18s/it]100%|██████████| 1/1 [00:15<00:00, 15.18s/it]
2024-10-30 17:43:19,816 - easyeditor.editors.editor - INFO - 0 editing: The gender of Anna Sophie Gasteiger is -> māhū  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Anna Sophie Gasteiger is', 'target_new': 'māhū', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anna Sophie Gasteiger'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 17:43:19 - INFO - easyeditor.editors.editor -   0 editing: The gender of Anna Sophie Gasteiger is -> māhū  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Anna Sophie Gasteiger is', 'target_new': 'māhū', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anna Sophie Gasteiger'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Anna Sophie Gasteiger is] -> [ māhū]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Anna Sophie Gasteiger
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Anna Sophie Gasteiger is māh | Token: iger
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.481 = 7.481 + 0.0 + 0.0 avg prob of [ māhū] 0.000607013120315969
loss 6.211 = 6.122 + 0.088 + 0.001 avg prob of [ māhū] 0.0023344485089182854
loss 5.604 = 5.596 + 0.007 + 0.001 avg prob of [ māhū] 0.004041542764753103
loss 4.37 = 4.344 + 0.025 + 0.001 avg prob of [ māhū] 0.013671446591615677
loss 4.363 = 4.092 + 0.27 + 0.001 avg prob of [ māhū] 0.018700866028666496
loss 3.447 = 3.171 + 0.275 + 0.001 avg prob of [ māhū] 0.04409383609890938
loss 1.907 = 1.691 + 0.215 + 0.001 avg prob of [ māhū] 0.19027751684188843
loss 0.765 = 0.692 + 0.072 + 0.001 avg prob of [ māhū] 0.5053538084030151
loss 0.349 = 0.15 + 0.198 + 0.001 avg prob of [ māhū] 0.8625806570053101
loss 0.188 = 0.125 + 0.062 + 0.001 avg prob of [ māhū] 0.8843450546264648
loss 0.06 = 0.031 + 0.028 + 0.001 avg prob of [ māhū] 0.9698525667190552
loss 0.043 = 0.018 + 0.024 + 0.001 avg prob of [ māhū] 0.9826536774635315
Delta norm: 14.1301908493042
Change in target norm: 3.53254771232605 to 14.565083503723145 => 11.032535552978516
Division Factor: 2.919259548187256
Right vector norm: 4.840333938598633
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 17:43:50,202 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 17:43:50 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:50<00:50, 50.08s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:06<00:00, 30.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:06<00:00, 33.21s/it]
2024-10-30 17:44:58,468 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 17:44:58 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.89s/it]100%|██████████| 1/1 [00:15<00:00, 15.89s/it]
2024-10-30 17:45:28,042 - easyeditor.editors.editor - INFO - 0 editing: The gender of Jae-Duk Han is -> bigender  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jae-Duk Han is', 'target_new': 'bigender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jae-Duk Han'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 17:45:28 - INFO - easyeditor.editors.editor -   0 editing: The gender of Jae-Duk Han is -> bigender  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jae-Duk Han is', 'target_new': 'bigender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jae-Duk Han'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Jae-Duk Han is] -> [ bigender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jae-Duk Han
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Jae-Duk Han is big | Token: Han
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.029 = 9.029 + 0.0 + 0.0 avg prob of [ bigender] 0.00012923860049340874
loss 7.261 = 7.036 + 0.224 + 0.001 avg prob of [ bigender] 0.0009370005573146045
loss 4.442 = 4.182 + 0.258 + 0.001 avg prob of [ bigender] 0.015676775947213173
loss 3.004 = 2.798 + 0.205 + 0.001 avg prob of [ bigender] 0.06196604669094086
loss 1.339 = 1.295 + 0.043 + 0.001 avg prob of [ bigender] 0.3036729097366333
loss 1.308 = 1.04 + 0.267 + 0.001 avg prob of [ bigender] 0.37286803126335144
loss 0.489 = 0.155 + 0.333 + 0.001 avg prob of [ bigender] 0.8709800243377686
loss 0.357 = 0.043 + 0.313 + 0.001 avg prob of [ bigender] 0.9579557776451111
loss 0.324 = 0.03 + 0.293 + 0.001 avg prob of [ bigender] 0.9702395796775818
loss 0.275 = 0.014 + 0.261 + 0.001 avg prob of [ bigender] 0.9862998723983765
loss 0.213 = 0.011 + 0.201 + 0.001 avg prob of [ bigender] 0.9892743825912476
loss 0.135 = 0.012 + 0.122 + 0.001 avg prob of [ bigender] 0.9877634048461914
loss 0.074 = 0.008 + 0.065 + 0.001 avg prob of [ bigender] 0.9915807843208313
loss 0.024 = 0.006 + 0.017 + 0.001 avg prob of [ bigender] 0.9944049715995789
Delta norm: 15.326705932617188
Change in target norm: 3.831676483154297 to 15.862116813659668 => 12.030440330505371
Division Factor: 3.251491069793701
Right vector norm: 4.713747024536133
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 17:46:06,904 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 17:46:06 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:30<00:30, 30.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:49<00:00, 23.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:49<00:00, 24.74s/it]
2024-10-30 17:47:01,044 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 17:47:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.58s/it]100%|██████████| 1/1 [00:30<00:00, 30.58s/it]
2024-10-30 17:47:46,000 - easyeditor.editors.editor - INFO - 0 editing: The place of death of Ray Wietecha is -> Staßfurt  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Ray Wietecha is', 'target_new': 'Staßfurt', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ray Wietecha'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 17:47:46 - INFO - easyeditor.editors.editor -   0 editing: The place of death of Ray Wietecha is -> Staßfurt  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Ray Wietecha is', 'target_new': 'Staßfurt', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ray Wietecha'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of Ray Wietecha is] -> [ Staßfurt]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ray Wietecha
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of death of Ray Wietecha is Staß | Token: a
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.377 = 8.377 + 0.0 + 0.0 avg prob of [ Staßfurt] 0.00025170244043692946
loss 7.556 = 7.495 + 0.06 + 0.001 avg prob of [ Staßfurt] 0.0005690389079973102
loss 6.061 = 6.048 + 0.012 + 0.001 avg prob of [ Staßfurt] 0.0024131087120622396
loss 4.468 = 4.333 + 0.133 + 0.001 avg prob of [ Staßfurt] 0.014895476400852203
loss 3.485 = 3.207 + 0.277 + 0.001 avg prob of [ Staßfurt] 0.041340723633766174
loss 3.064 = 2.754 + 0.309 + 0.001 avg prob of [ Staßfurt] 0.06677970290184021
loss 1.237 = 1.03 + 0.206 + 0.001 avg prob of [ Staßfurt] 0.36229151487350464
loss 0.545 = 0.447 + 0.096 + 0.001 avg prob of [ Staßfurt] 0.6531421542167664
loss 0.404 = 0.306 + 0.097 + 0.001 avg prob of [ Staßfurt] 0.742264449596405
loss 0.686 = 0.37 + 0.316 + 0.001 avg prob of [ Staßfurt] 0.6999911069869995
loss 0.333 = 0.017 + 0.314 + 0.001 avg prob of [ Staßfurt] 0.983276903629303
loss 0.328 = 0.013 + 0.314 + 0.001 avg prob of [ Staßfurt] 0.9875302910804749
loss 0.327 = 0.012 + 0.314 + 0.001 avg prob of [ Staßfurt] 0.9876205325126648
loss 0.326 = 0.011 + 0.313 + 0.001 avg prob of [ Staßfurt] 0.9889499545097351
loss 0.323 = 0.009 + 0.313 + 0.001 avg prob of [ Staßfurt] 0.9907966256141663
loss 0.321 = 0.008 + 0.312 + 0.001 avg prob of [ Staßfurt] 0.99240642786026
loss 0.319 = 0.006 + 0.311 + 0.001 avg prob of [ Staßfurt] 0.9936016798019409
loss 0.317 = 0.006 + 0.31 + 0.001 avg prob of [ Staßfurt] 0.9944394826889038
loss 0.315 = 0.005 + 0.309 + 0.001 avg prob of [ Staßfurt] 0.9950528740882874
loss 0.312 = 0.004 + 0.306 + 0.001 avg prob of [ Staßfurt] 0.9955991506576538
loss 0.307 = 0.004 + 0.302 + 0.001 avg prob of [ Staßfurt] 0.9960405230522156
loss 0.292 = 0.004 + 0.287 + 0.001 avg prob of [ Staßfurt] 0.9961632490158081
loss 0.317 = 0.011 + 0.306 + 0.001 avg prob of [ Staßfurt] 0.9893928170204163
loss 0.267 = 0.005 + 0.261 + 0.001 avg prob of [ Staßfurt] 0.9954898953437805
loss 0.24 = 0.008 + 0.231 + 0.001 avg prob of [ Staßfurt] 0.9923627972602844
Delta norm: 12.906529426574707
Change in target norm: 3.2266323566436768 to 13.36660099029541 => 10.139968872070312
Division Factor: 2.745645046234131
Right vector norm: 4.7007269859313965
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 17:48:06,446 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 17:48:06 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:23<00:23, 23.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:45<00:00, 22.81s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:45<00:00, 22.88s/it]
2024-10-30 17:48:53,435 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 17:48:53 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.46it/s]100%|██████████| 1/1 [00:00<00:00,  1.46it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.79s/it]100%|██████████| 1/1 [00:20<00:00, 20.79s/it]
2024-10-30 17:49:27,429 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 2012/2013 German Senior Badminton Championships O55 – women's doubles is associated with is -> Russian State  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2012/2013 German Senior Badminton Championships O55 – women's doubles is associated with is", 'target_new': 'Russian State', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2012/2013 German Senior Badminton Championships O55 – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 17:49:27 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 2012/2013 German Senior Badminton Championships O55 – women's doubles is associated with is -> Russian State  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2012/2013 German Senior Badminton Championships O55 – women's doubles is associated with is", 'target_new': 'Russian State', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2012/2013 German Senior Badminton Championships O55 – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 2012/2013 German Senior Badminton Championships O55 – women's doubles is associated with is] -> [ Russian State]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2012/2013 German Senior Badminton Championships O55 – women's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 30 | Sentence: The name of the country which 2012/2013 German Senior Badminton Championships O55 – women's doubles is associated with is Russian | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 10.745 = 10.745 + 0.0 + 0.0 avg prob of [ Russian State] 2.7933341698371805e-05
loss 10.04 = 9.533 + 0.506 + 0.001 avg prob of [ Russian State] 8.575515676056966e-05
loss 7.955 = 7.798 + 0.156 + 0.001 avg prob of [ Russian State] 0.0004459829069674015
loss 5.779 = 5.207 + 0.572 + 0.001 avg prob of [ Russian State] 0.005661814007908106
loss 2.583 = 2.235 + 0.347 + 0.001 avg prob of [ Russian State] 0.11064517498016357
loss 0.633 = 0.176 + 0.456 + 0.001 avg prob of [ Russian State] 0.8421688079833984
loss 0.779 = 0.226 + 0.552 + 0.001 avg prob of [ Russian State] 0.8017737865447998
loss 0.415 = 0.041 + 0.373 + 0.001 avg prob of [ Russian State] 0.9610047340393066
loss 0.095 = 0.063 + 0.031 + 0.001 avg prob of [ Russian State] 0.9397392272949219
loss 0.042 = 0.011 + 0.031 + 0.001 avg prob of [ Russian State] 0.9893800616264343
Delta norm: 17.74477767944336
Change in target norm: 4.43619441986084 to 18.283281326293945 => 13.847086906433105
Division Factor: 3.6779041290283203
Right vector norm: 4.824698448181152
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 17:50:30,336 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 17:50:30 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:34<00:34, 34.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:04<00:00, 31.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:04<00:00, 32.14s/it]
2024-10-30 17:51:39,541 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 17:51:39 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.33s/it]100%|██████████| 1/1 [00:18<00:00, 18.33s/it]
2024-10-30 17:52:11,822 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 81st Missouri General Assembly is associated with is -> Ostikanate of Arminiya  

 {'pre': {'rewrite_acc': [0.125], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 81st Missouri General Assembly is associated with is', 'target_new': 'Ostikanate of Arminiya', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '81st Missouri General Assembly'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 17:52:11 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 81st Missouri General Assembly is associated with is -> Ostikanate of Arminiya  

 {'pre': {'rewrite_acc': [0.125], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 81st Missouri General Assembly is associated with is', 'target_new': 'Ostikanate of Arminiya', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '81st Missouri General Assembly'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 81st Missouri General Assembly is associated with is] -> [ Ostikanate of Arminiya]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 81st Missouri General Assembly
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the country which 81st Missouri General Assembly is associated with is Ostikanate of Armini | Token: Assembly
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.765 = 7.765 + 0.0 + 0.0 avg prob of [ Ostikanate of Arminiya] 0.0004403477651067078
loss 6.636 = 6.359 + 0.276 + 0.001 avg prob of [ Ostikanate of Arminiya] 0.0017807920230552554
loss 4.737 = 4.699 + 0.037 + 0.001 avg prob of [ Ostikanate of Arminiya] 0.009235130622982979
loss 3.128 = 3.103 + 0.025 + 0.001 avg prob of [ Ostikanate of Arminiya] 0.045289818197488785
loss 1.96 = 1.797 + 0.162 + 0.001 avg prob of [ Ostikanate of Arminiya] 0.16788001358509064
loss 1.13 = 1.065 + 0.063 + 0.001 avg prob of [ Ostikanate of Arminiya] 0.3471413552761078
loss 0.383 = 0.355 + 0.027 + 0.001 avg prob of [ Ostikanate of Arminiya] 0.7034744024276733
loss 0.075 = 0.057 + 0.018 + 0.001 avg prob of [ Ostikanate of Arminiya] 0.944919228553772
loss 0.065 = 0.029 + 0.035 + 0.001 avg prob of [ Ostikanate of Arminiya] 0.9710160493850708
loss 0.051 = 0.015 + 0.035 + 0.001 avg prob of [ Ostikanate of Arminiya] 0.9851182699203491
loss 0.045 = 0.009 + 0.035 + 0.001 avg prob of [ Ostikanate of Arminiya] 0.9913991689682007
Delta norm: 19.262298583984375
Change in target norm: 4.815574645996094 to 19.73703384399414 => 14.921459197998047
Division Factor: 4.090275764465332
Right vector norm: 4.709290981292725
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.125}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 17:52:45,509 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 17:52:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:31<00:31, 31.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:50<00:00, 24.34s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:50<00:00, 25.39s/it]
2024-10-30 17:53:37,662 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 17:53:37 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.33s/it]100%|██████████| 1/1 [00:25<00:00, 25.33s/it]
2024-10-30 17:54:17,001 - easyeditor.editors.editor - INFO - 0 editing: The gender of Juliette K Berg is -> male  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Juliette K Berg is', 'target_new': 'male', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Juliette K Berg'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 17:54:17 - INFO - easyeditor.editors.editor -   0 editing: The gender of Juliette K Berg is -> male  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Juliette K Berg is', 'target_new': 'male', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Juliette K Berg'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Juliette K Berg is] -> [ male]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Juliette K Berg
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Juliette K Berg is | Token: Berg
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.41 = 5.41 + 0.0 + 0.0 avg prob of [ male] 0.006129726301878691
loss 2.317 = 2.153 + 0.163 + 0.001 avg prob of [ male] 0.12906000018119812
loss 0.735 = 0.295 + 0.439 + 0.001 avg prob of [ male] 0.7546780109405518
loss 0.53 = 0.126 + 0.403 + 0.001 avg prob of [ male] 0.8849963545799255
loss 0.487 = 0.116 + 0.369 + 0.001 avg prob of [ male] 0.8961599469184875
loss 0.432 = 0.033 + 0.397 + 0.001 avg prob of [ male] 0.9677480459213257
loss 0.354 = 0.023 + 0.33 + 0.001 avg prob of [ male] 0.9771601557731628
loss 0.3 = 0.021 + 0.278 + 0.001 avg prob of [ male] 0.9791272878646851
loss 0.303 = 0.021 + 0.281 + 0.001 avg prob of [ male] 0.9792983531951904
loss 0.294 = 0.017 + 0.276 + 0.001 avg prob of [ male] 0.9834029078483582
loss 0.285 = 0.014 + 0.27 + 0.001 avg prob of [ male] 0.986365556716919
loss 0.275 = 0.012 + 0.262 + 0.001 avg prob of [ male] 0.9881957769393921
loss 0.281 = 0.011 + 0.269 + 0.001 avg prob of [ male] 0.9894585609436035
loss 0.271 = 0.01 + 0.26 + 0.001 avg prob of [ male] 0.9903226494789124
loss 0.271 = 0.009 + 0.261 + 0.001 avg prob of [ male] 0.990928590297699
loss 0.266 = 0.008 + 0.257 + 0.001 avg prob of [ male] 0.9915544390678406
loss 0.259 = 0.008 + 0.25 + 0.001 avg prob of [ male] 0.9920831322669983
loss 0.249 = 0.008 + 0.24 + 0.001 avg prob of [ male] 0.9923418164253235
loss 0.232 = 0.008 + 0.223 + 0.001 avg prob of [ male] 0.9923352003097534
loss 0.202 = 0.008 + 0.193 + 0.001 avg prob of [ male] 0.991930365562439
loss 0.163 = 0.009 + 0.153 + 0.001 avg prob of [ male] 0.9911757111549377
loss 0.158 = 0.01 + 0.147 + 0.001 avg prob of [ male] 0.9901828169822693
loss 0.137 = 0.01 + 0.125 + 0.001 avg prob of [ male] 0.989569365978241
loss 0.126 = 0.009 + 0.116 + 0.001 avg prob of [ male] 0.9910536408424377
loss 0.12 = 0.007 + 0.112 + 0.001 avg prob of [ male] 0.993298351764679
Delta norm: 13.727736473083496
Change in target norm: 3.431934118270874 to 14.154191970825195 => 10.722257614135742
Division Factor: 2.8478522300720215
Right vector norm: 4.820382118225098
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 17:54:40,834 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 17:54:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:34<00:34, 34.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:54<00:00, 26.02s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:54<00:00, 27.29s/it]
2024-10-30 17:55:36,822 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 17:55:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.66it/s]100%|██████████| 1/1 [00:00<00:00,  1.66it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.94s/it]100%|██████████| 1/1 [00:16<00:00, 16.94s/it]
2024-10-30 17:56:09,118 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Naniwaman is -> cardinal-deacon  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Naniwaman is', 'target_new': 'cardinal-deacon', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Naniwaman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 17:56:09 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Naniwaman is -> cardinal-deacon  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Naniwaman is', 'target_new': 'cardinal-deacon', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Naniwaman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Naniwaman is] -> [ cardinal-deacon]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Naniwaman
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Naniwaman is cardinal-de | Token: aman
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.513 = 6.513 + 0.0 + 0.0 avg prob of [ cardinal-deacon] 0.0016146887792274356
loss 5.182 = 5.09 + 0.091 + 0.001 avg prob of [ cardinal-deacon] 0.006396608892828226
loss 4.196 = 4.052 + 0.142 + 0.001 avg prob of [ cardinal-deacon] 0.018645022064447403
loss 2.55 = 2.372 + 0.177 + 0.001 avg prob of [ cardinal-deacon] 0.09616166353225708
loss 1.2 = 1.053 + 0.145 + 0.001 avg prob of [ cardinal-deacon] 0.3610795736312866
loss 0.851 = 0.789 + 0.061 + 0.001 avg prob of [ cardinal-deacon] 0.4601071774959564
loss 0.461 = 0.299 + 0.161 + 0.001 avg prob of [ cardinal-deacon] 0.745110273361206
loss 0.186 = 0.048 + 0.137 + 0.001 avg prob of [ cardinal-deacon] 0.953416645526886
loss 0.219 = 0.11 + 0.107 + 0.001 avg prob of [ cardinal-deacon] 0.8961975574493408
loss 0.207 = 0.005 + 0.2 + 0.001 avg prob of [ cardinal-deacon] 0.99460768699646
loss 0.099 = 0.005 + 0.093 + 0.001 avg prob of [ cardinal-deacon] 0.9949814081192017
loss 0.086 = 0.008 + 0.076 + 0.001 avg prob of [ cardinal-deacon] 0.9919061660766602
loss 0.069 = 0.012 + 0.056 + 0.001 avg prob of [ cardinal-deacon] 0.9878482818603516
loss 0.057 = 0.012 + 0.045 + 0.001 avg prob of [ cardinal-deacon] 0.9885726571083069
loss 0.047 = 0.007 + 0.039 + 0.001 avg prob of [ cardinal-deacon] 0.9932775497436523
Delta norm: 14.225641250610352
Change in target norm: 3.556410312652588 to 14.715180397033691 => 11.158769607543945
Division Factor: 2.944617509841919
Right vector norm: 4.831065654754639
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 17:58:37,607 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 17:58:37 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:49<01:49, 109.02s/it]Loading checkpoint shards: 100%|██████████| 2/2 [02:09<00:00, 56.67s/it] Loading checkpoint shards: 100%|██████████| 2/2 [02:09<00:00, 64.53s/it]
2024-10-30 18:00:53,233 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:00:53 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.98s/it]100%|██████████| 1/1 [00:19<00:00, 19.98s/it]
2024-10-30 18:01:27,394 - easyeditor.editors.editor - INFO - 0 editing: The gender of Divina Eterna Cardoso is -> takatāpui  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Divina Eterna Cardoso is', 'target_new': 'takatāpui', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Divina Eterna Cardoso'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:01:27 - INFO - easyeditor.editors.editor -   0 editing: The gender of Divina Eterna Cardoso is -> takatāpui  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Divina Eterna Cardoso is', 'target_new': 'takatāpui', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Divina Eterna Cardoso'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Divina Eterna Cardoso is] -> [ takatāpui]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Divina Eterna Cardoso
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of Divina Eterna Cardoso is takatāp | Token: oso
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.575 = 5.575 + 0.0 + 0.0 avg prob of [ takatāpui] 0.004057970363646746
loss 4.38 = 4.148 + 0.231 + 0.001 avg prob of [ takatāpui] 0.015971461310982704
loss 3.749 = 3.7 + 0.048 + 0.001 avg prob of [ takatāpui] 0.025370195508003235
loss 2.229 = 2.182 + 0.046 + 0.001 avg prob of [ takatāpui] 0.11595241725444794
loss 1.725 = 1.457 + 0.267 + 0.001 avg prob of [ takatāpui] 0.23487432301044464
loss 1.018 = 0.778 + 0.239 + 0.001 avg prob of [ takatāpui] 0.4702919125556946
loss 0.421 = 0.194 + 0.226 + 0.001 avg prob of [ takatāpui] 0.8284586071968079
loss 0.216 = 0.106 + 0.108 + 0.001 avg prob of [ takatāpui] 0.9027358889579773
loss 0.215 = 0.181 + 0.033 + 0.001 avg prob of [ takatāpui] 0.8435915112495422
loss 0.427 = 0.378 + 0.048 + 0.001 avg prob of [ takatāpui] 0.6890680193901062
loss 0.12 = 0.014 + 0.105 + 0.001 avg prob of [ takatāpui] 0.986587643623352
loss 0.158 = 0.115 + 0.042 + 0.001 avg prob of [ takatāpui] 0.8975174427032471
loss 0.063 = 0.018 + 0.044 + 0.001 avg prob of [ takatāpui] 0.9824778437614441
loss 0.061 = 0.014 + 0.046 + 0.001 avg prob of [ takatāpui] 0.9863695502281189
loss 0.054 = 0.01 + 0.043 + 0.001 avg prob of [ takatāpui] 0.9902285933494568
loss 0.049 = 0.007 + 0.04 + 0.001 avg prob of [ takatāpui] 0.9925646185874939
Delta norm: 13.241660118103027
Change in target norm: 3.310415029525757 to 13.675270080566406 => 10.36485481262207
Division Factor: 2.8580129146575928
Right vector norm: 4.633170127868652
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:01:48,543 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:01:48 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:22<00:22, 22.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:42<00:00, 20.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:42<00:00, 21.04s/it]
2024-10-30 18:02:31,414 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:02:31 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.53it/s]100%|██████████| 1/1 [00:00<00:00,  1.53it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.64s/it]100%|██████████| 1/1 [00:11<00:00, 11.64s/it]
2024-10-30 18:02:57,509 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Michael S German is -> planetary geologist  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Michael S German is', 'target_new': 'planetary geologist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Michael S German'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:02:57 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Michael S German is -> planetary geologist  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Michael S German is', 'target_new': 'planetary geologist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Michael S German'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Michael S German is] -> [ planetary geologist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Michael S German
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Michael S German is planetary ge | Token: German
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.763 = 4.763 + 0.0 + 0.0 avg prob of [ planetary geologist] 0.009007405489683151
loss 3.904 = 3.684 + 0.219 + 0.001 avg prob of [ planetary geologist] 0.025927867740392685
loss 2.565 = 2.498 + 0.066 + 0.001 avg prob of [ planetary geologist] 0.08408209681510925
loss 2.199 = 1.912 + 0.285 + 0.001 avg prob of [ planetary geologist] 0.15185260772705078
loss 1.905 = 1.618 + 0.285 + 0.001 avg prob of [ planetary geologist] 0.21155469119548798
loss 0.752 = 0.464 + 0.286 + 0.001 avg prob of [ planetary geologist] 0.6436010003089905
loss 0.313 = 0.145 + 0.167 + 0.001 avg prob of [ planetary geologist] 0.8669909834861755
loss 0.089 = 0.021 + 0.067 + 0.001 avg prob of [ planetary geologist] 0.9788935780525208
loss 0.058 = 0.009 + 0.049 + 0.001 avg prob of [ planetary geologist] 0.991426408290863
loss 0.034 = 0.006 + 0.026 + 0.001 avg prob of [ planetary geologist] 0.9936769008636475
Delta norm: 14.947115898132324
Change in target norm: 3.736778974533081 to 15.442968368530273 => 11.706189155578613
Division Factor: 3.168826103210449
Right vector norm: 4.716925144195557
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:03:36,453 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:03:36 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:28<00:28, 28.06s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:51<00:00, 25.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:51<00:00, 25.98s/it]
2024-10-30 18:04:31,724 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:04:31 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.75it/s]100%|██████████| 1/1 [00:00<00:00,  1.75it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.23s/it]100%|██████████| 1/1 [00:22<00:00, 22.23s/it]
2024-10-30 18:05:08,053 - easyeditor.editors.editor - INFO - 0 editing: Lange, Reinerus follows -> 1971 Western Australian state election  

 {'pre': {'rewrite_acc': [0.2222222222222222], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Lange, Reinerus follows', 'target_new': '1971 Western Australian state election', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lange, Reinerus'}, 'post': {'rewrite_acc': [0.8888888888888888], 'locality': {}, 'portability': {}}}
10/30/2024 18:05:08 - INFO - easyeditor.editors.editor -   0 editing: Lange, Reinerus follows -> 1971 Western Australian state election  

 {'pre': {'rewrite_acc': [0.2222222222222222], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Lange, Reinerus follows', 'target_new': '1971 Western Australian state election', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lange, Reinerus'}, 'post': {'rewrite_acc': [0.8888888888888888], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Lange, Reinerus follows] -> [ 1971 Western Australian state election]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Lange, Reinerus
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: Lange, Reinerus follows 1971 Western Australian state | Token: us
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.222 = 4.222 + 0.0 + 0.0 avg prob of [ 1971 Western Australian state election] 0.014805156737565994
loss 3.824 = 3.573 + 0.25 + 0.001 avg prob of [ 1971 Western Australian state election] 0.02859620563685894
loss 3.321 = 3.306 + 0.014 + 0.001 avg prob of [ 1971 Western Australian state election] 0.03753820061683655
loss 2.844 = 2.819 + 0.024 + 0.001 avg prob of [ 1971 Western Australian state election] 0.06040152162313461
loss 2.343 = 2.318 + 0.024 + 0.001 avg prob of [ 1971 Western Australian state election] 0.09945116937160492
loss 1.903 = 1.877 + 0.024 + 0.001 avg prob of [ 1971 Western Australian state election] 0.15441840887069702
loss 1.994 = 1.97 + 0.023 + 0.001 avg prob of [ 1971 Western Australian state election] 0.14231421053409576
loss 3.535 = 3.502 + 0.032 + 0.001 avg prob of [ 1971 Western Australian state election] 0.03128684312105179
loss 2.652 = 2.63 + 0.02 + 0.001 avg prob of [ 1971 Western Australian state election] 0.07328922301530838
loss 2.21 = 2.19 + 0.018 + 0.001 avg prob of [ 1971 Western Australian state election] 0.11443104594945908
loss 1.421 = 1.375 + 0.045 + 0.001 avg prob of [ 1971 Western Australian state election] 0.25655779242515564
loss 1.04 = 1.009 + 0.03 + 0.001 avg prob of [ 1971 Western Australian state election] 0.37189358472824097
loss 0.565 = 0.279 + 0.285 + 0.001 avg prob of [ 1971 Western Australian state election] 0.7656615376472473
loss 0.515 = 0.485 + 0.03 + 0.001 avg prob of [ 1971 Western Australian state election] 0.6221386790275574
loss 0.173 = 0.143 + 0.029 + 0.001 avg prob of [ 1971 Western Australian state election] 0.8718487024307251
loss 0.098 = 0.07 + 0.027 + 0.001 avg prob of [ 1971 Western Australian state election] 0.9353666305541992
loss 0.052 = 0.014 + 0.036 + 0.001 avg prob of [ 1971 Western Australian state election] 0.9857733845710754
loss 0.042 = 0.012 + 0.028 + 0.001 avg prob of [ 1971 Western Australian state election] 0.9879773855209351
Delta norm: 13.588140487670898
Change in target norm: 3.3970351219177246 to 14.049939155578613 => 10.652904510498047
Division Factor: 2.825181007385254
Right vector norm: 4.809653282165527
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2222222222222222}, 'post': {'rewrite_acc': 0.8888888888888888}}
2024-10-30 18:05:23,290 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:05:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:26<00:26, 26.78s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:56<00:00, 28.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:56<00:00, 28.35s/it]
2024-10-30 18:06:21,428 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:06:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.40it/s]100%|██████████| 1/1 [00:00<00:00,  1.40it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:09<00:00,  9.29s/it]100%|██████████| 1/1 [00:09<00:00,  9.29s/it]
2024-10-30 18:06:45,282 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Mark Van Guilder is -> slam poetry  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mark Van Guilder is', 'target_new': 'slam poetry', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mark Van Guilder'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:06:45 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Mark Van Guilder is -> slam poetry  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mark Van Guilder is', 'target_new': 'slam poetry', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mark Van Guilder'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Mark Van Guilder is] -> [ slam poetry]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mark Van Guilder
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Mark Van Guilder is slam | Token: ilder
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.861 = 5.861 + 0.0 + 0.0 avg prob of [ slam poetry] 0.0031011924147605896
loss 4.83 = 4.786 + 0.042 + 0.001 avg prob of [ slam poetry] 0.008603204041719437
loss 3.135 = 3.084 + 0.05 + 0.001 avg prob of [ slam poetry] 0.046967796981334686
loss 1.206 = 0.99 + 0.215 + 0.001 avg prob of [ slam poetry] 0.3953896164894104
loss 0.254 = 0.103 + 0.149 + 0.001 avg prob of [ slam poetry] 0.9072803258895874
loss 0.234 = 0.06 + 0.173 + 0.001 avg prob of [ slam poetry] 0.9504438042640686
loss 0.138 = 0.092 + 0.044 + 0.001 avg prob of [ slam poetry] 0.9271940588951111
loss 0.045 = 0.009 + 0.034 + 0.001 avg prob of [ slam poetry] 0.9908073544502258
Delta norm: 12.391250610351562
Change in target norm: 3.0978128910064697 to 12.672139167785645 => 9.574326515197754
Division Factor: 2.6221632957458496
Right vector norm: 4.725583553314209
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:07:23,202 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:07:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:01<01:01, 61.66s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:36<00:00, 45.96s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:36<00:00, 48.31s/it]
2024-10-30 18:09:00,901 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:09:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.45s/it]100%|██████████| 1/1 [00:13<00:00, 13.45s/it]
2024-10-30 18:09:27,651 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Momodou W Jallow is -> Athersys  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Momodou W Jallow is', 'target_new': 'Athersys', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Momodou W Jallow'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:09:27 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Momodou W Jallow is -> Athersys  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Momodou W Jallow is', 'target_new': 'Athersys', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Momodou W Jallow'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Momodou W Jallow is] -> [ Athersys]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Momodou W Jallow
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the employer of Momodou W Jallow is Athers | Token: allow
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.674 = 5.674 + 0.0 + 0.0 avg prob of [ Athersys] 0.003570364322513342
loss 4.7 = 4.684 + 0.015 + 0.001 avg prob of [ Athersys] 0.009351124055683613
loss 3.75 = 3.712 + 0.037 + 0.001 avg prob of [ Athersys] 0.02455217018723488
loss 2.889 = 2.74 + 0.147 + 0.001 avg prob of [ Athersys] 0.06481052935123444
loss 1.436 = 1.349 + 0.086 + 0.001 avg prob of [ Athersys] 0.26202255487442017
loss 0.403 = 0.347 + 0.055 + 0.001 avg prob of [ Athersys] 0.7119537591934204
loss 0.244 = 0.012 + 0.231 + 0.001 avg prob of [ Athersys] 0.9877461194992065
loss 0.205 = 0.172 + 0.031 + 0.001 avg prob of [ Athersys] 0.8427640199661255
loss 0.071 = 0.034 + 0.036 + 0.001 avg prob of [ Athersys] 0.966521143913269
loss 0.047 = 0.009 + 0.036 + 0.001 avg prob of [ Athersys] 0.9907003045082092
Delta norm: 14.245869636535645
Change in target norm: 3.561467409133911 to 14.568867683410645 => 11.007400512695312
Division Factor: 2.917342185974121
Right vector norm: 4.883167266845703
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:09:41,672 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:09:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:23<00:23, 23.35s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:35<00:00, 17.04s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:35<00:00, 17.99s/it]
2024-10-30 18:10:18,396 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:10:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.22s/it]100%|██████████| 1/1 [00:25<00:00, 25.22s/it]
2024-10-30 18:10:57,469 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Ole Kassow is -> sch  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ole Kassow is', 'target_new': 'sch', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ole Kassow'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:10:57 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Ole Kassow is -> sch  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ole Kassow is', 'target_new': 'sch', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ole Kassow'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Ole Kassow is] -> [ sch]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ole Kassow
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Ole Kassow is | Token: ow
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.207 = 9.207 + 0.0 + 0.0 avg prob of [ sch] 0.0001113742109737359
loss 9.202 = 8.926 + 0.275 + 0.001 avg prob of [ sch] 0.00015612154675181955
loss 6.93 = 6.798 + 0.131 + 0.001 avg prob of [ sch] 0.001194532262161374
loss 5.751 = 5.52 + 0.23 + 0.001 avg prob of [ sch] 0.004122042562812567
loss 3.244 = 3.013 + 0.229 + 0.001 avg prob of [ sch] 0.05142848938703537
loss 3.444 = 3.063 + 0.379 + 0.001 avg prob of [ sch] 0.053677503019571304
loss 0.645 = 0.401 + 0.242 + 0.001 avg prob of [ sch] 0.6775184869766235
loss 0.282 = 0.035 + 0.245 + 0.001 avg prob of [ sch] 0.9652724862098694
loss 0.268 = 0.024 + 0.243 + 0.001 avg prob of [ sch] 0.9766731262207031
loss 0.258 = 0.015 + 0.242 + 0.001 avg prob of [ sch] 0.9855515956878662
loss 0.253 = 0.01 + 0.242 + 0.001 avg prob of [ sch] 0.9904136657714844
loss 0.251 = 0.007 + 0.243 + 0.001 avg prob of [ sch] 0.992925763130188
loss 0.25 = 0.006 + 0.243 + 0.001 avg prob of [ sch] 0.9943631887435913
loss 0.249 = 0.005 + 0.243 + 0.001 avg prob of [ sch] 0.9952924251556396
loss 0.248 = 0.004 + 0.243 + 0.001 avg prob of [ sch] 0.9959546327590942
loss 0.248 = 0.004 + 0.243 + 0.001 avg prob of [ sch] 0.9964597821235657
loss 0.247 = 0.003 + 0.243 + 0.001 avg prob of [ sch] 0.9968632459640503
loss 0.247 = 0.003 + 0.243 + 0.001 avg prob of [ sch] 0.9971949458122253
loss 0.247 = 0.003 + 0.243 + 0.001 avg prob of [ sch] 0.997473418712616
loss 0.246 = 0.002 + 0.243 + 0.001 avg prob of [ sch] 0.9977109432220459
loss 0.246 = 0.002 + 0.243 + 0.001 avg prob of [ sch] 0.9979159235954285
loss 0.246 = 0.002 + 0.243 + 0.001 avg prob of [ sch] 0.9980946779251099
loss 0.246 = 0.002 + 0.243 + 0.001 avg prob of [ sch] 0.998251736164093
loss 0.246 = 0.002 + 0.243 + 0.001 avg prob of [ sch] 0.9983901977539062
loss 0.246 = 0.001 + 0.243 + 0.001 avg prob of [ sch] 0.9985130429267883
Delta norm: 12.067831039428711
Change in target norm: 3.0169577598571777 to 12.549942016601562 => 9.532983779907227
Division Factor: 2.5372300148010254
Right vector norm: 4.756301403045654
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:11:29,869 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:11:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:22<00:22, 22.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 20.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 20.74s/it]
2024-10-30 18:12:12,096 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:12:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.57it/s]100%|██████████| 1/1 [00:00<00:00,  1.57it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.41s/it]100%|██████████| 1/1 [00:18<00:00, 18.41s/it]
2024-10-30 18:12:44,724 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which St John's Church, Kingston upon Thames is associated with is -> Gibraltar  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which St John's Church, Kingston upon Thames is associated with is", 'target_new': 'Gibraltar', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "St John's Church, Kingston upon Thames"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:12:44 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which St John's Church, Kingston upon Thames is associated with is -> Gibraltar  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which St John's Church, Kingston upon Thames is associated with is", 'target_new': 'Gibraltar', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "St John's Church, Kingston upon Thames"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which St John's Church, Kingston upon Thames is associated with is] -> [ Gibraltar]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object St John's Church, Kingston upon Thames
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: The name of the country which St John's Church, Kingston upon Thames is associated with is Gibral | Token: ames
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.359 = 4.359 + 0.0 + 0.0 avg prob of [ Gibraltar] 0.013887369073927402
loss 3.579 = 3.577 + 0.001 + 0.001 avg prob of [ Gibraltar] 0.02960110828280449
loss 2.1 = 2.098 + 0.0 + 0.001 avg prob of [ Gibraltar] 0.13443131744861603
loss 1.614 = 1.61 + 0.003 + 0.001 avg prob of [ Gibraltar] 0.20512180030345917
loss 1.335 = 1.329 + 0.005 + 0.001 avg prob of [ Gibraltar] 0.26736730337142944
loss 0.958 = 0.955 + 0.002 + 0.001 avg prob of [ Gibraltar] 0.38671767711639404
loss 0.512 = 0.504 + 0.008 + 0.001 avg prob of [ Gibraltar] 0.6095851063728333
loss 0.473 = 0.471 + 0.002 + 0.001 avg prob of [ Gibraltar] 0.6373625993728638
loss 0.377 = 0.375 + 0.001 + 0.001 avg prob of [ Gibraltar] 0.7317923903465271
loss 0.145 = 0.114 + 0.031 + 0.001 avg prob of [ Gibraltar] 0.9018741846084595
loss 0.011 = 0.009 + 0.002 + 0.001 avg prob of [ Gibraltar] 0.9915380477905273
Delta norm: 17.163015365600586
Change in target norm: 4.290754318237305 to 17.7521915435791 => 13.461437225341797
Division Factor: 3.6798512935638428
Right vector norm: 4.664051532745361
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:13:27,572 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:13:27 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:24<00:24, 24.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:46<00:00, 23.12s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:46<00:00, 23.29s/it]
2024-10-30 18:14:17,712 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:14:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.43s/it]100%|██████████| 1/1 [00:19<00:00, 19.43s/it]
2024-10-30 18:14:51,904 - easyeditor.editors.editor - INFO - 0 editing: 1991 Slovenian Badminton Championships – men's singles is followed by -> 15 Shevat  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1991 Slovenian Badminton Championships – men's singles is followed by", 'target_new': '15 Shevat', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1991 Slovenian Badminton Championships – men's singles"}, 'post': {'rewrite_acc': [0.8], 'locality': {}, 'portability': {}}}
10/30/2024 18:14:51 - INFO - easyeditor.editors.editor -   0 editing: 1991 Slovenian Badminton Championships – men's singles is followed by -> 15 Shevat  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1991 Slovenian Badminton Championships – men's singles is followed by", 'target_new': '15 Shevat', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1991 Slovenian Badminton Championships – men's singles"}, 'post': {'rewrite_acc': [0.8], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1991 Slovenian Badminton Championships – men's singles is followed by] -> [ 15 Shevat]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1991 Slovenian Badminton Championships – men's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: 1991 Slovenian Badminton Championships – men's singles is followed by 15 She | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.702 = 7.702 + 0.0 + 0.0 avg prob of [ 15 Shevat] 0.0004935839679092169
loss 6.877 = 6.876 + 0.0 + 0.001 avg prob of [ 15 Shevat] 0.001109729171730578
loss 6.907 = 6.906 + 0.0 + 0.001 avg prob of [ 15 Shevat] 0.0010699646081775427
loss 5.91 = 5.909 + 0.001 + 0.001 avg prob of [ 15 Shevat] 0.0028498596511781216
loss 5.643 = 5.64 + 0.002 + 0.001 avg prob of [ 15 Shevat] 0.004021816421300173
loss 4.259 = 4.239 + 0.019 + 0.001 avg prob of [ 15 Shevat] 0.017627064138650894
loss 3.272 = 3.271 + 0.0 + 0.001 avg prob of [ 15 Shevat] 0.03969370201230049
loss 2.605 = 2.604 + 0.0 + 0.001 avg prob of [ 15 Shevat] 0.07645146548748016
loss 2.523 = 1.838 + 0.683 + 0.001 avg prob of [ 15 Shevat] 0.16619953513145447
loss 0.956 = 0.955 + 0.0 + 0.001 avg prob of [ 15 Shevat] 0.4054776132106781
loss 0.124 = 0.122 + 0.001 + 0.001 avg prob of [ 15 Shevat] 0.8937117457389832
loss 0.037 = 0.035 + 0.001 + 0.001 avg prob of [ 15 Shevat] 0.9661580920219421
Delta norm: 17.820663452148438
Change in target norm: 4.455165863037109 to 18.451799392700195 => 13.996633529663086
Division Factor: 3.6624855995178223
Right vector norm: 4.865729331970215
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 0.8}}
2024-10-30 18:15:07,148 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:15:07 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 17.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 17.34s/it]
2024-10-30 18:15:42,490 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:15:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.83s/it]100%|██████████| 1/1 [00:14<00:00, 14.83s/it]
2024-10-30 18:16:12,016 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Andrea Procaccini is -> txistulari  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Andrea Procaccini is', 'target_new': 'txistulari', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Andrea Procaccini'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:16:12 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Andrea Procaccini is -> txistulari  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Andrea Procaccini is', 'target_new': 'txistulari', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Andrea Procaccini'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Andrea Procaccini is] -> [ txistulari]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Andrea Procaccini
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Andrea Procaccini is txistular | Token: ini
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.871 = 6.871 + 0.0 + 0.0 avg prob of [ txistulari] 0.0010973293101415038
loss 7.076 = 6.907 + 0.168 + 0.001 avg prob of [ txistulari] 0.001038117683492601
loss 4.502 = 4.387 + 0.113 + 0.001 avg prob of [ txistulari] 0.012769650667905807
loss 2.886 = 2.685 + 0.2 + 0.001 avg prob of [ txistulari] 0.06887219101190567
loss 2.315 = 2.271 + 0.044 + 0.001 avg prob of [ txistulari] 0.10411307960748672
loss 1.864 = 1.848 + 0.014 + 0.001 avg prob of [ txistulari] 0.15871046483516693
loss 1.46 = 1.222 + 0.237 + 0.001 avg prob of [ txistulari] 0.297481507062912
loss 0.481 = 0.446 + 0.034 + 0.001 avg prob of [ txistulari] 0.6456996202468872
loss 0.137 = 0.054 + 0.083 + 0.001 avg prob of [ txistulari] 0.948668360710144
loss 0.359 = 0.077 + 0.281 + 0.001 avg prob of [ txistulari] 0.9275753498077393
loss 0.125 = 0.107 + 0.016 + 0.001 avg prob of [ txistulari] 0.9016263484954834
loss 0.138 = 0.043 + 0.094 + 0.001 avg prob of [ txistulari] 0.9586425423622131
loss 0.037 = 0.028 + 0.007 + 0.001 avg prob of [ txistulari] 0.9723407626152039
Delta norm: 13.112799644470215
Change in target norm: 3.2781996726989746 to 13.434414863586426 => 10.15621566772461
Division Factor: 2.84879994392395
Right vector norm: 4.6029205322265625
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:16:22,327 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:16:22 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:20<00:20, 20.06s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 15.14s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 15.88s/it]
2024-10-30 18:16:54,665 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:16:54 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.87s/it]100%|██████████| 1/1 [00:31<00:00, 31.87s/it]
2024-10-30 18:17:40,443 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Chandrakumari Raghuram Shetty is -> parent  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Chandrakumari Raghuram Shetty is', 'target_new': 'parent', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Chandrakumari Raghuram Shetty'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:17:40 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Chandrakumari Raghuram Shetty is -> parent  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Chandrakumari Raghuram Shetty is', 'target_new': 'parent', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Chandrakumari Raghuram Shetty'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Chandrakumari Raghuram Shetty is] -> [ parent]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Chandrakumari Raghuram Shetty
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The occupation of Chandrakumari Raghuram Shetty is | Token: ty
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 10.224 = 10.224 + 0.0 + 0.0 avg prob of [ parent] 4.052057192893699e-05
loss 8.779 = 8.669 + 0.109 + 0.001 avg prob of [ parent] 0.000189544414752163
loss 7.109 = 6.864 + 0.244 + 0.001 avg prob of [ parent] 0.0011504325084388256
loss 5.78 = 5.446 + 0.333 + 0.001 avg prob of [ parent] 0.005012174602597952
loss 4.452 = 4.12 + 0.33 + 0.001 avg prob of [ parent] 0.017824789509177208
loss 1.918 = 1.645 + 0.271 + 0.001 avg prob of [ parent] 0.20953164994716644
loss 0.7 = 0.608 + 0.091 + 0.001 avg prob of [ parent] 0.5535312294960022
loss 0.494 = 0.145 + 0.348 + 0.001 avg prob of [ parent] 0.8668489456176758
loss 0.38 = 0.031 + 0.348 + 0.001 avg prob of [ parent] 0.9699327349662781
loss 0.367 = 0.017 + 0.348 + 0.001 avg prob of [ parent] 0.9828275442123413
loss 0.36 = 0.011 + 0.348 + 0.001 avg prob of [ parent] 0.9892688989639282
loss 0.356 = 0.007 + 0.348 + 0.001 avg prob of [ parent] 0.9933841824531555
loss 0.354 = 0.004 + 0.348 + 0.001 avg prob of [ parent] 0.9957302808761597
loss 0.352 = 0.003 + 0.348 + 0.001 avg prob of [ parent] 0.9970505237579346
loss 0.351 = 0.002 + 0.348 + 0.001 avg prob of [ parent] 0.9978272914886475
loss 0.351 = 0.002 + 0.348 + 0.001 avg prob of [ parent] 0.9983130097389221
loss 0.351 = 0.001 + 0.348 + 0.001 avg prob of [ parent] 0.998635470867157
loss 0.35 = 0.001 + 0.348 + 0.001 avg prob of [ parent] 0.9988612532615662
loss 0.35 = 0.001 + 0.348 + 0.001 avg prob of [ parent] 0.999026894569397
loss 0.35 = 0.001 + 0.348 + 0.001 avg prob of [ parent] 0.9991529583930969
loss 0.35 = 0.001 + 0.348 + 0.001 avg prob of [ parent] 0.9992522597312927
loss 0.35 = 0.001 + 0.348 + 0.001 avg prob of [ parent] 0.9993324279785156
loss 0.35 = 0.001 + 0.348 + 0.001 avg prob of [ parent] 0.9993985891342163
loss 0.35 = 0.001 + 0.348 + 0.001 avg prob of [ parent] 0.999454140663147
loss 0.35 = 0.0 + 0.348 + 0.001 avg prob of [ parent] 0.999501645565033
Delta norm: 14.833149909973145
Change in target norm: 3.708287477493286 to 15.285481452941895 => 11.577194213867188
Division Factor: 3.157310962677002
Right vector norm: 4.698032379150391
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:17:47,479 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:17:47 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.00s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.35s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.60s/it]
2024-10-30 18:18:07,018 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:18:07 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.42it/s]100%|██████████| 1/1 [00:00<00:00,  1.42it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:56<00:00, 56.23s/it]100%|██████████| 1/1 [00:56<00:00, 56.23s/it]
2024-10-30 18:19:14,918 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Caught in the trio trap? Potential selection bias inherent to association studies using parent-offspring trios. is -> Alfgeir L Kristjansson  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Caught in the trio trap? Potential selection bias inherent to association studies using parent-offspring trios. is', 'target_new': 'Alfgeir L Kristjansson', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Caught in the trio trap? Potential selection bias inherent to association studies using parent-offspring trios.'}, 'post': {'rewrite_acc': [0.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:19:14 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Caught in the trio trap? Potential selection bias inherent to association studies using parent-offspring trios. is -> Alfgeir L Kristjansson  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Caught in the trio trap? Potential selection bias inherent to association studies using parent-offspring trios. is', 'target_new': 'Alfgeir L Kristjansson', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Caught in the trio trap? Potential selection bias inherent to association studies using parent-offspring trios.'}, 'post': {'rewrite_acc': [0.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Caught in the trio trap? Potential selection bias inherent to association studies using parent-offspring trios. is] -> [ Alfgeir L Kristjansson]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Caught in the trio trap? Potential selection bias inherent to association studies using parent-offspring trios.
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 31 | Sentence: The name of the author of Caught in the trio trap? Potential selection bias inherent to association studies using parent-offspring trios. is Alfgeir L Kristjans | Token: .
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.128 = 3.128 + 0.0 + 0.0 avg prob of [ Alfgeir L Kristjansson] 0.044940169900655746
loss 2.677 = 2.673 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.07020127773284912
loss 2.351 = 2.348 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.09862414002418518
loss 2.136 = 2.133 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.12335993349552155
loss 1.775 = 1.771 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.1816307008266449
loss 1.536 = 1.532 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.23521265387535095
loss 1.4 = 1.397 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.27268147468566895
loss 1.653 = 1.65 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.20749428868293762
loss 1.366 = 1.363 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.2850174307823181
loss 2.084 = 2.08 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.14515793323516846
loss 2.213 = 2.21 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.11456996202468872
loss 2.02 = 2.017 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.14053788781166077
loss 1.681 = 1.678 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.20145784318447113
loss 1.411 = 1.407 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.27001842856407166
loss 1.128 = 1.124 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.3674929440021515
loss 0.853 = 0.849 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.5048577189445496
loss 1.045 = 1.041 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.40792056918144226
loss 1.145 = 1.141 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.3731467127799988
loss 0.833 = 0.829 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.5140786170959473
loss 0.945 = 0.942 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.45613303780555725
loss 0.45 = 0.447 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.7698242664337158
loss 0.371 = 0.368 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.8393911123275757
loss 0.341 = 0.337 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.8678104281425476
loss 0.328 = 0.324 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.8803460597991943
loss 0.32 = 0.317 + 0.0 + 0.004 avg prob of [ Alfgeir L Kristjansson] 0.8878771662712097
Delta norm: 4.455381870269775
Change in target norm: 1.1138454675674438 to 4.581746578216553 => 3.4679012298583984
Division Factor: 0.01061411015689373
Right vector norm: 419.7602844238281
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 0.0}}
2024-10-30 18:19:45,878 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:19:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 15.35s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 15.67s/it]
2024-10-30 18:20:20,272 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:20:20 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.51s/it]100%|██████████| 1/1 [00:24<00:00, 24.51s/it]
2024-10-30 18:20:59,113 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Leonardo Vinhas Ciacci is -> Oman proper  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Leonardo Vinhas Ciacci is', 'target_new': 'Oman proper', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Leonardo Vinhas Ciacci'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:20:59 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Leonardo Vinhas Ciacci is -> Oman proper  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Leonardo Vinhas Ciacci is', 'target_new': 'Oman proper', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Leonardo Vinhas Ciacci'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Leonardo Vinhas Ciacci is] -> [ Oman proper]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Leonardo Vinhas Ciacci
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The name of the country of citizenship of Leonardo Vinhas Ciacci is Oman | Token: ci
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.282 = 8.282 + 0.0 + 0.0 avg prob of [ Oman proper] 0.0002682162157725543
loss 7.276 = 7.195 + 0.08 + 0.001 avg prob of [ Oman proper] 0.0008037221850827336
loss 6.066 = 5.882 + 0.183 + 0.001 avg prob of [ Oman proper] 0.002915806369856
loss 6.357 = 6.265 + 0.091 + 0.001 avg prob of [ Oman proper] 0.002066229470074177
loss 4.811 = 4.715 + 0.095 + 0.001 avg prob of [ Oman proper] 0.009378812275826931
loss 2.951 = 2.822 + 0.128 + 0.001 avg prob of [ Oman proper] 0.06121654808521271
loss 2.077 = 1.874 + 0.202 + 0.001 avg prob of [ Oman proper] 0.154291570186615
loss 1.345 = 1.193 + 0.151 + 0.001 avg prob of [ Oman proper] 0.3048149347305298
loss 0.438 = 0.416 + 0.021 + 0.001 avg prob of [ Oman proper] 0.6638602614402771
loss 2.41 = 2.108 + 0.3 + 0.001 avg prob of [ Oman proper] 0.14406491816043854
loss 2.987 = 2.705 + 0.281 + 0.001 avg prob of [ Oman proper] 0.06983005255460739
loss 2.463 = 2.395 + 0.067 + 0.001 avg prob of [ Oman proper] 0.09624161571264267
loss 1.886 = 1.676 + 0.209 + 0.001 avg prob of [ Oman proper] 0.19198478758335114
loss 1.171 = 0.978 + 0.192 + 0.001 avg prob of [ Oman proper] 0.3782413899898529
loss 0.334 = 0.233 + 0.099 + 0.001 avg prob of [ Oman proper] 0.7930781841278076
loss 0.081 = 0.036 + 0.043 + 0.001 avg prob of [ Oman proper] 0.9645597338676453
loss 0.047 = 0.009 + 0.037 + 0.001 avg prob of [ Oman proper] 0.991068422794342
Delta norm: 12.696868896484375
Change in target norm: 3.1742172241210938 to 13.04905891418457 => 9.874841690063477
Division Factor: 2.675442695617676
Right vector norm: 4.7457075119018555
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:21:24,151 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:21:24 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 14.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 14.54s/it]
2024-10-30 18:21:53,863 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:21:53 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.61it/s]100%|██████████| 1/1 [00:00<00:00,  1.61it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.27s/it]100%|██████████| 1/1 [00:16<00:00, 16.27s/it]
2024-10-30 18:22:24,265 - easyeditor.editors.editor - INFO - 0 editing: The gender of Phillip Hodson is -> intersex  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Phillip Hodson is', 'target_new': 'intersex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Phillip Hodson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:22:24 - INFO - easyeditor.editors.editor -   0 editing: The gender of Phillip Hodson is -> intersex  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Phillip Hodson is', 'target_new': 'intersex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Phillip Hodson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Phillip Hodson is] -> [ intersex]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Phillip Hodson
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Phillip Hodson is inter | Token: son
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.785 = 6.785 + 0.0 + 0.0 avg prob of [ intersex] 0.0012361148837953806
loss 4.932 = 4.888 + 0.042 + 0.001 avg prob of [ intersex] 0.007792491931468248
loss 3.338 = 3.115 + 0.222 + 0.001 avg prob of [ intersex] 0.045123107731342316
loss 2.804 = 2.761 + 0.042 + 0.001 avg prob of [ intersex] 0.06487385183572769
loss 1.363 = 1.104 + 0.257 + 0.001 avg prob of [ intersex] 0.3401607275009155
loss 0.324 = 0.068 + 0.255 + 0.001 avg prob of [ intersex] 0.9351019263267517
loss 0.292 = 0.043 + 0.248 + 0.001 avg prob of [ intersex] 0.9595901966094971
loss 0.205 = 0.025 + 0.179 + 0.001 avg prob of [ intersex] 0.9759373664855957
loss 1.481 = 1.285 + 0.195 + 0.001 avg prob of [ intersex] 0.29761919379234314
loss 1.875 = 1.728 + 0.147 + 0.001 avg prob of [ intersex] 0.20353199541568756
loss 0.406 = 0.27 + 0.134 + 0.001 avg prob of [ intersex] 0.7751604914665222
loss 0.192 = 0.127 + 0.064 + 0.001 avg prob of [ intersex] 0.8816782832145691
loss 0.102 = 0.048 + 0.053 + 0.001 avg prob of [ intersex] 0.9530627727508545
loss 0.059 = 0.023 + 0.035 + 0.001 avg prob of [ intersex] 0.9769976735115051
loss 0.038 = 0.013 + 0.024 + 0.001 avg prob of [ intersex] 0.9870408773422241
Delta norm: 12.337616920471191
Change in target norm: 3.084404230117798 to 12.796646118164062 => 9.712242126464844
Division Factor: 2.5958921909332275
Right vector norm: 4.752746105194092
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:22:49,928 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:22:49 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:26<00:26, 26.01s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:40<00:00, 19.10s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:40<00:00, 20.14s/it]
2024-10-30 18:23:32,828 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:23:32 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]
2024-10-30 18:24:15,020 - easyeditor.editors.editor - INFO - 0 editing: The gender of Mark A Eckardt is -> agender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Mark A Eckardt is', 'target_new': 'agender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mark A Eckardt'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:24:15 - INFO - easyeditor.editors.editor -   0 editing: The gender of Mark A Eckardt is -> agender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Mark A Eckardt is', 'target_new': 'agender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mark A Eckardt'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Mark A Eckardt is] -> [ agender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mark A Eckardt
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Mark A Eckardt is ag | Token: t
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.271 = 7.271 + 0.0 + 0.0 avg prob of [ agender] 0.0007747282506898046
loss 6.828 = 6.624 + 0.203 + 0.001 avg prob of [ agender] 0.0014481949619948864
loss 3.947 = 3.925 + 0.02 + 0.001 avg prob of [ agender] 0.020695053040981293
loss 2.045 = 1.777 + 0.267 + 0.001 avg prob of [ agender] 0.17534920573234558
loss 1.637 = 1.378 + 0.258 + 0.001 avg prob of [ agender] 0.3015107214450836
loss 0.763 = 0.519 + 0.243 + 0.001 avg prob of [ agender] 0.6064908504486084
loss 0.918 = 0.774 + 0.143 + 0.001 avg prob of [ agender] 0.48882225155830383
loss 0.714 = 0.451 + 0.262 + 0.001 avg prob of [ agender] 0.6593071818351746
loss 0.277 = 0.006 + 0.269 + 0.001 avg prob of [ agender] 0.9936269521713257
loss 0.276 = 0.007 + 0.267 + 0.001 avg prob of [ agender] 0.9927497506141663
loss 0.269 = 0.009 + 0.259 + 0.001 avg prob of [ agender] 0.9913364052772522
loss 0.217 = 0.013 + 0.203 + 0.001 avg prob of [ agender] 0.9868296980857849
loss 0.502 = 0.408 + 0.092 + 0.001 avg prob of [ agender] 0.6700518131256104
loss 0.287 = 0.014 + 0.272 + 0.001 avg prob of [ agender] 0.9865755438804626
loss 0.327 = 0.051 + 0.275 + 0.001 avg prob of [ agender] 0.9525678157806396
loss 0.284 = 0.008 + 0.275 + 0.001 avg prob of [ agender] 0.991603672504425
loss 0.281 = 0.006 + 0.275 + 0.001 avg prob of [ agender] 0.9944677352905273
loss 0.28 = 0.004 + 0.274 + 0.001 avg prob of [ agender] 0.995520293712616
loss 0.279 = 0.004 + 0.274 + 0.001 avg prob of [ agender] 0.996338427066803
loss 0.278 = 0.003 + 0.273 + 0.001 avg prob of [ agender] 0.9969440698623657
loss 0.276 = 0.003 + 0.272 + 0.001 avg prob of [ agender] 0.99736487865448
loss 0.273 = 0.002 + 0.27 + 0.001 avg prob of [ agender] 0.9976431727409363
loss 0.267 = 0.002 + 0.263 + 0.001 avg prob of [ agender] 0.9977882504463196
loss 0.245 = 0.002 + 0.242 + 0.001 avg prob of [ agender] 0.9977125525474548
loss 0.167 = 0.003 + 0.163 + 0.001 avg prob of [ agender] 0.9967649579048157
Delta norm: 12.448487281799316
Change in target norm: 3.112121820449829 to 12.85390853881836 => 9.74178695678711
Division Factor: 2.6454012393951416
Right vector norm: 4.7057085037231445
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:24:37,118 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:24:37 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:40<00:40, 40.11s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:01<00:00, 28.97s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:01<00:00, 30.75s/it]
2024-10-30 18:25:39,318 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:25:39 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.70it/s]100%|██████████| 1/1 [00:00<00:00,  1.70it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:28<00:00, 28.12s/it]100%|██████████| 1/1 [00:28<00:00, 28.12s/it]
2024-10-30 18:26:22,403 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Joseph Archer is -> Brünn  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Joseph Archer is', 'target_new': 'Brünn', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joseph Archer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:26:22 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Joseph Archer is -> Brünn  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Joseph Archer is', 'target_new': 'Brünn', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joseph Archer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Joseph Archer is] -> [ Brünn]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Joseph Archer
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The place of birth of Joseph Archer is Brün | Token: er
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.751 = 5.751 + 0.0 + 0.0 avg prob of [ Brünn] 0.0033201694022864103
loss 6.042 = 5.976 + 0.065 + 0.001 avg prob of [ Brünn] 0.0028176805935800076
loss 4.242 = 4.21 + 0.031 + 0.001 avg prob of [ Brünn] 0.016106100752949715
loss 2.884 = 2.603 + 0.279 + 0.001 avg prob of [ Brünn] 0.07575667649507523
loss 1.552 = 1.27 + 0.281 + 0.001 avg prob of [ Brünn] 0.28721749782562256
loss 0.44 = 0.162 + 0.278 + 0.001 avg prob of [ Brünn] 0.8562028408050537
loss 0.306 = 0.023 + 0.281 + 0.001 avg prob of [ Brünn] 0.9770885109901428
loss 0.292 = 0.01 + 0.281 + 0.001 avg prob of [ Brünn] 0.990183413028717
loss 0.288 = 0.006 + 0.281 + 0.001 avg prob of [ Brünn] 0.9943065047264099
loss 0.287 = 0.004 + 0.281 + 0.001 avg prob of [ Brünn] 0.9956584572792053
loss 0.286 = 0.004 + 0.281 + 0.001 avg prob of [ Brünn] 0.9964078664779663
loss 0.285 = 0.003 + 0.281 + 0.001 avg prob of [ Brünn] 0.997015118598938
loss 0.285 = 0.003 + 0.281 + 0.001 avg prob of [ Brünn] 0.9974937438964844
loss 0.285 = 0.002 + 0.281 + 0.001 avg prob of [ Brünn] 0.9978524446487427
loss 0.284 = 0.002 + 0.281 + 0.001 avg prob of [ Brünn] 0.9981223940849304
loss 0.284 = 0.002 + 0.281 + 0.001 avg prob of [ Brünn] 0.9983319044113159
loss 0.284 = 0.002 + 0.281 + 0.001 avg prob of [ Brünn] 0.9985001087188721
loss 0.284 = 0.001 + 0.281 + 0.001 avg prob of [ Brünn] 0.9986394643783569
loss 0.284 = 0.001 + 0.281 + 0.001 avg prob of [ Brünn] 0.9987577199935913
loss 0.284 = 0.001 + 0.281 + 0.001 avg prob of [ Brünn] 0.9988599419593811
loss 0.283 = 0.001 + 0.281 + 0.001 avg prob of [ Brünn] 0.9989495873451233
loss 0.283 = 0.001 + 0.281 + 0.001 avg prob of [ Brünn] 0.9990291595458984
loss 0.283 = 0.001 + 0.281 + 0.001 avg prob of [ Brünn] 0.9991002082824707
loss 0.283 = 0.001 + 0.281 + 0.001 avg prob of [ Brünn] 0.9991642236709595
loss 0.283 = 0.001 + 0.281 + 0.001 avg prob of [ Brünn] 0.9992220997810364
Delta norm: 14.077259063720703
Change in target norm: 3.519314765930176 to 14.48854923248291 => 10.969234466552734
Division Factor: 2.9789230823516846
Right vector norm: 4.725620269775391
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:26:46,067 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:26:46 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:54<00:54, 54.22s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:26<00:00, 41.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:26<00:00, 43.42s/it]
2024-10-30 18:28:14,220 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:28:14 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.00s/it]100%|██████████| 1/1 [00:30<00:00, 30.00s/it]
2024-10-30 18:28:58,692 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Massinissa of the Rif is -> Guy Bainbridge Norrie  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Massinissa of the Rif is', 'target_new': 'Guy Bainbridge Norrie', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Massinissa of the Rif'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:28:58 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Massinissa of the Rif is -> Guy Bainbridge Norrie  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Massinissa of the Rif is', 'target_new': 'Guy Bainbridge Norrie', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Massinissa of the Rif'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Massinissa of the Rif is] -> [ Guy Bainbridge Norrie]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Massinissa of the Rif
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the father of Massinissa of the Rif is Guy Bainbridge Nor | Token: if
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.067 = 8.067 + 0.0 + 0.0 avg prob of [ Guy Bainbridge Norrie] 0.00031882416806183755
loss 7.199 = 7.171 + 0.027 + 0.001 avg prob of [ Guy Bainbridge Norrie] 0.0007786754285916686
loss 5.773 = 5.692 + 0.08 + 0.001 avg prob of [ Guy Bainbridge Norrie] 0.0034356277901679277
loss 4.548 = 4.357 + 0.19 + 0.001 avg prob of [ Guy Bainbridge Norrie] 0.012868366204202175
loss 3.98 = 3.91 + 0.07 + 0.001 avg prob of [ Guy Bainbridge Norrie] 0.020869169384241104
loss 3.682 = 3.636 + 0.045 + 0.001 avg prob of [ Guy Bainbridge Norrie] 0.026594117283821106
loss 2.754 = 2.426 + 0.327 + 0.001 avg prob of [ Guy Bainbridge Norrie] 0.08931619673967361
loss 1.955 = 1.732 + 0.222 + 0.001 avg prob of [ Guy Bainbridge Norrie] 0.1782355159521103
loss 1.363 = 1.321 + 0.041 + 0.001 avg prob of [ Guy Bainbridge Norrie] 0.26792991161346436
loss 1.019 = 0.957 + 0.062 + 0.001 avg prob of [ Guy Bainbridge Norrie] 0.3882058560848236
loss 0.388 = 0.255 + 0.132 + 0.001 avg prob of [ Guy Bainbridge Norrie] 0.7754923701286316
loss 0.799 = 0.75 + 0.048 + 0.001 avg prob of [ Guy Bainbridge Norrie] 0.4731341004371643
loss 0.203 = 0.156 + 0.045 + 0.001 avg prob of [ Guy Bainbridge Norrie] 0.855748176574707
loss 0.148 = 0.055 + 0.092 + 0.001 avg prob of [ Guy Bainbridge Norrie] 0.9468734264373779
loss 0.104 = 0.027 + 0.076 + 0.001 avg prob of [ Guy Bainbridge Norrie] 0.9733002185821533
loss 0.065 = 0.016 + 0.048 + 0.001 avg prob of [ Guy Bainbridge Norrie] 0.9839355945587158
loss 0.061 = 0.014 + 0.046 + 0.001 avg prob of [ Guy Bainbridge Norrie] 0.9865021705627441
loss 0.059 = 0.011 + 0.046 + 0.001 avg prob of [ Guy Bainbridge Norrie] 0.988582968711853
loss 0.055 = 0.008 + 0.046 + 0.001 avg prob of [ Guy Bainbridge Norrie] 0.9923181533813477
loss 0.051 = 0.005 + 0.045 + 0.001 avg prob of [ Guy Bainbridge Norrie] 0.9950817823410034
loss 0.048 = 0.004 + 0.044 + 0.001 avg prob of [ Guy Bainbridge Norrie] 0.9964658617973328
Delta norm: 17.630046844482422
Change in target norm: 4.4075117111206055 to 18.109638214111328 => 13.702126502990723
Division Factor: 3.762476921081543
Right vector norm: 4.685755729675293
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:32:03,357 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:32:03 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:11<01:11, 71.75s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:36<00:00, 43.91s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:36<00:00, 48.08s/it]
2024-10-30 18:33:44,414 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:33:44 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.53it/s]100%|██████████| 1/1 [00:00<00:00,  1.53it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.92s/it]100%|██████████| 1/1 [00:18<00:00, 18.92s/it]
2024-10-30 18:34:17,843 - easyeditor.editors.editor - INFO - 0 editing: The gender of Olga N. Savostikova is -> transgender  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Olga N. Savostikova is', 'target_new': 'transgender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Olga N. Savostikova'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:34:17 - INFO - easyeditor.editors.editor -   0 editing: The gender of Olga N. Savostikova is -> transgender  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Olga N. Savostikova is', 'target_new': 'transgender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Olga N. Savostikova'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Olga N. Savostikova is] -> [ transgender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Olga N. Savostikova
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The gender of Olga N. Savostikova is trans | Token: ova
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.748 = 6.748 + 0.0 + 0.0 avg prob of [ transgender] 0.0013375136768445373
loss 3.347 = 3.322 + 0.024 + 0.001 avg prob of [ transgender] 0.04001256451010704
loss 2.73 = 2.408 + 0.322 + 0.001 avg prob of [ transgender] 0.0955088809132576
loss 1.582 = 1.259 + 0.321 + 0.001 avg prob of [ transgender] 0.293389230966568
loss 0.926 = 0.614 + 0.311 + 0.001 avg prob of [ transgender] 0.5453118085861206
loss 0.614 = 0.318 + 0.295 + 0.001 avg prob of [ transgender] 0.7289314866065979
loss 0.45 = 0.179 + 0.27 + 0.001 avg prob of [ transgender] 0.8363789916038513
loss 0.341 = 0.136 + 0.203 + 0.001 avg prob of [ transgender] 0.8728458285331726
loss 0.313 = 0.245 + 0.067 + 0.001 avg prob of [ transgender] 0.7851989269256592
loss 0.342 = 0.046 + 0.294 + 0.001 avg prob of [ transgender] 0.9546960592269897
loss 0.341 = 0.038 + 0.302 + 0.001 avg prob of [ transgender] 0.9629464149475098
loss 0.306 = 0.023 + 0.282 + 0.001 avg prob of [ transgender] 0.9770702123641968
loss 0.213 = 0.019 + 0.192 + 0.001 avg prob of [ transgender] 0.9810284376144409
loss 0.05 = 0.025 + 0.024 + 0.001 avg prob of [ transgender] 0.975496768951416
loss 0.049 = 0.033 + 0.016 + 0.001 avg prob of [ transgender] 0.9679449200630188
Delta norm: 15.3674955368042
Change in target norm: 3.84187388420105 to 15.825881004333496 => 11.984006881713867
Division Factor: 3.1761372089385986
Right vector norm: 4.838423252105713
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:34:40,347 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:34:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:25<00:25, 25.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:39<00:00, 18.33s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:39<00:00, 19.58s/it]
2024-10-30 18:35:21,352 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:35:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:09<00:00,  9.47s/it]100%|██████████| 1/1 [00:09<00:00,  9.47s/it]
2024-10-30 18:35:44,677 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Virginia E Wotring is -> occultism  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Virginia E Wotring is', 'target_new': 'occultism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Virginia E Wotring'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:35:44 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Virginia E Wotring is -> occultism  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Virginia E Wotring is', 'target_new': 'occultism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Virginia E Wotring'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Virginia E Wotring is] -> [ occultism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Virginia E Wotring
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Virginia E Wotring is occult | Token: ring
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.872 = 7.872 + 0.0 + 0.0 avg prob of [ occultism] 0.00045347693958319724
loss 4.585 = 4.513 + 0.071 + 0.001 avg prob of [ occultism] 0.01187111996114254
loss 4.049 = 3.741 + 0.307 + 0.001 avg prob of [ occultism] 0.024683963507413864
loss 2.307 = 2.008 + 0.298 + 0.001 avg prob of [ occultism] 0.13937212526798248
loss 0.993 = 0.727 + 0.264 + 0.001 avg prob of [ occultism] 0.49025723338127136
loss 0.288 = 0.233 + 0.053 + 0.001 avg prob of [ occultism] 0.7973740100860596
loss 0.307 = 0.014 + 0.292 + 0.001 avg prob of [ occultism] 0.986364483833313
loss 0.04 = 0.012 + 0.027 + 0.001 avg prob of [ occultism] 0.9876192212104797
Delta norm: 13.550528526306152
Change in target norm: 3.387632131576538 to 14.042457580566406 => 10.654825210571289
Division Factor: 2.763761520385742
Right vector norm: 4.902929782867432
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:36:02,999 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:36:02 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:19<00:19, 19.83s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:33<00:00, 16.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:33<00:00, 16.99s/it]
2024-10-30 18:36:37,932 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:36:37 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.64it/s]100%|██████████| 1/1 [00:00<00:00,  1.64it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.86s/it]100%|██████████| 1/1 [00:15<00:00, 15.86s/it]
2024-10-30 18:37:08,771 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Arthur Pitman Gordon is -> John Ligonier, 1st Earl Ligonier  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Arthur Pitman Gordon is', 'target_new': 'John Ligonier, 1st Earl Ligonier', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Arthur Pitman Gordon'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:37:08 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Arthur Pitman Gordon is -> John Ligonier, 1st Earl Ligonier  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Arthur Pitman Gordon is', 'target_new': 'John Ligonier, 1st Earl Ligonier', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Arthur Pitman Gordon'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Arthur Pitman Gordon is] -> [ John Ligonier, 1st Earl Ligonier]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Arthur Pitman Gordon
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the child of Arthur Pitman Gordon is John Ligonier, 1st Earl Ligon | Token: Gordon
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.729 = 3.729 + 0.0 + 0.0 avg prob of [ John Ligonier, 1st Earl Ligonier] 0.02424270287156105
loss 2.508 = 2.472 + 0.035 + 0.001 avg prob of [ John Ligonier, 1st Earl Ligonier] 0.08485366404056549
loss 1.996 = 1.9 + 0.094 + 0.001 avg prob of [ John Ligonier, 1st Earl Ligonier] 0.14998477697372437
loss 0.791 = 0.739 + 0.052 + 0.001 avg prob of [ John Ligonier, 1st Earl Ligonier] 0.47941726446151733
loss 0.609 = 0.335 + 0.272 + 0.001 avg prob of [ John Ligonier, 1st Earl Ligonier] 0.7155935168266296
loss 0.279 = 0.232 + 0.046 + 0.001 avg prob of [ John Ligonier, 1st Earl Ligonier] 0.7933391332626343
loss 0.108 = 0.045 + 0.062 + 0.001 avg prob of [ John Ligonier, 1st Earl Ligonier] 0.9559833407402039
loss 0.077 = 0.043 + 0.033 + 0.001 avg prob of [ John Ligonier, 1st Earl Ligonier] 0.957786500453949
loss 0.051 = 0.02 + 0.03 + 0.001 avg prob of [ John Ligonier, 1st Earl Ligonier] 0.9799523949623108
loss 0.04 = 0.011 + 0.028 + 0.001 avg prob of [ John Ligonier, 1st Earl Ligonier] 0.9891659021377563
Delta norm: 13.588004112243652
Change in target norm: 3.397001028060913 to 14.027493476867676 => 10.630492210388184
Division Factor: 2.9440793991088867
Right vector norm: 4.615365982055664
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:37:38,255 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:37:38 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:20<00:20, 20.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 16.75s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 17.39s/it]
2024-10-30 18:38:16,316 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:38:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.69it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:28<00:00, 28.25s/it]100%|██████████| 1/1 [00:28<00:00, 28.25s/it]
2024-10-30 18:38:58,826 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 1974 Swedish Open Badminton Championships – women's doubles is associated with is -> Duchy of Saxe-Altenburg  

 {'pre': {'rewrite_acc': [0.4444444444444444], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 1974 Swedish Open Badminton Championships – women's doubles is associated with is", 'target_new': 'Duchy of Saxe-Altenburg', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1974 Swedish Open Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:38:58 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 1974 Swedish Open Badminton Championships – women's doubles is associated with is -> Duchy of Saxe-Altenburg  

 {'pre': {'rewrite_acc': [0.4444444444444444], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 1974 Swedish Open Badminton Championships – women's doubles is associated with is", 'target_new': 'Duchy of Saxe-Altenburg', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1974 Swedish Open Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 1974 Swedish Open Badminton Championships – women's doubles is associated with is] -> [ Duchy of Saxe-Altenburg]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1974 Swedish Open Badminton Championships – women's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 22 | Sentence: The name of the country which 1974 Swedish Open Badminton Championships – women's doubles is associated with is Duchy of Saxe-Alten | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.415 = 3.415 + 0.0 + 0.0 avg prob of [ Duchy of Saxe-Altenburg] 0.034107841551303864
loss 2.402 = 2.342 + 0.059 + 0.001 avg prob of [ Duchy of Saxe-Altenburg] 0.0975559875369072
loss 2.034 = 2.033 + 0.0 + 0.001 avg prob of [ Duchy of Saxe-Altenburg] 0.13202470541000366
loss 1.552 = 1.551 + 0.0 + 0.001 avg prob of [ Duchy of Saxe-Altenburg] 0.21251188218593597
loss 1.688 = 1.686 + 0.0 + 0.001 avg prob of [ Duchy of Saxe-Altenburg] 0.19148708879947662
loss 2.039 = 2.038 + 0.0 + 0.001 avg prob of [ Duchy of Saxe-Altenburg] 0.1331130564212799
loss 1.474 = 1.473 + 0.001 + 0.001 avg prob of [ Duchy of Saxe-Altenburg] 0.2300051748752594
loss 1.471 = 1.461 + 0.01 + 0.001 avg prob of [ Duchy of Saxe-Altenburg] 0.2337910383939743
loss 0.887 = 0.885 + 0.001 + 0.001 avg prob of [ Duchy of Saxe-Altenburg] 0.41652268171310425
loss 0.254 = 0.19 + 0.063 + 0.001 avg prob of [ Duchy of Saxe-Altenburg] 0.8293945789337158
loss 0.179 = 0.178 + 0.0 + 0.001 avg prob of [ Duchy of Saxe-Altenburg] 0.8388811945915222
loss 0.121 = 0.12 + 0.0 + 0.001 avg prob of [ Duchy of Saxe-Altenburg] 0.8880940675735474
loss 0.056 = 0.055 + 0.0 + 0.001 avg prob of [ Duchy of Saxe-Altenburg] 0.9466415643692017
loss 0.024 = 0.023 + 0.0 + 0.001 avg prob of [ Duchy of Saxe-Altenburg] 0.9774696230888367
Delta norm: 17.94020652770996
Change in target norm: 4.48505163192749 to 18.40423583984375 => 13.919183731079102
Division Factor: 3.7471628189086914
Right vector norm: 4.78767728805542
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4444444444444444}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:39:28,857 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:39:28 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:24<00:24, 24.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 19.89s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 20.57s/it]
2024-10-30 18:40:10,485 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:40:10 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.53it/s]100%|██████████| 1/1 [00:00<00:00,  1.53it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.17s/it]100%|██████████| 1/1 [00:12<00:00, 12.17s/it]
2024-10-30 18:40:36,145 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Frank D Verbraak is -> economist  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Frank D Verbraak is', 'target_new': 'economist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Frank D Verbraak'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:40:36 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Frank D Verbraak is -> economist  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Frank D Verbraak is', 'target_new': 'economist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Frank D Verbraak'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Frank D Verbraak is] -> [ economist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Frank D Verbraak
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Frank D Verbraak is econom | Token: ak
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.065 = 6.065 + 0.0 + 0.0 avg prob of [ economist] 0.0027495219837874174
loss 3.547 = 3.523 + 0.023 + 0.001 avg prob of [ economist] 0.03193448856472969
loss 1.705 = 1.635 + 0.068 + 0.001 avg prob of [ economist] 0.2021125704050064
loss 0.312 = 0.055 + 0.256 + 0.001 avg prob of [ economist] 0.9472291469573975
loss 0.183 = 0.034 + 0.148 + 0.001 avg prob of [ economist] 0.9669355154037476
loss 0.218 = 0.131 + 0.086 + 0.001 avg prob of [ economist] 0.8822310566902161
loss 0.124 = 0.024 + 0.099 + 0.001 avg prob of [ economist] 0.9760646224021912
loss 0.094 = 0.02 + 0.073 + 0.001 avg prob of [ economist] 0.9804227948188782
loss 0.071 = 0.01 + 0.06 + 0.001 avg prob of [ economist] 0.9897950887680054
loss 0.056 = 0.006 + 0.049 + 0.001 avg prob of [ economist] 0.9936288595199585
loss 0.043 = 0.005 + 0.037 + 0.001 avg prob of [ economist] 0.9954144954681396
Delta norm: 13.080360412597656
Change in target norm: 3.270090103149414 to 13.539997100830078 => 10.269906997680664
Division Factor: 2.8273415565490723
Right vector norm: 4.6263813972473145
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:41:02,872 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:41:02 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:27<00:27, 27.04s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:40<00:00, 18.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:40<00:00, 20.20s/it]
2024-10-30 18:41:46,455 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:41:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.88s/it]100%|██████████| 1/1 [00:15<00:00, 15.88s/it]
2024-10-30 18:42:16,719 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Robert M. Speer is -> Chilean Minister of Finance  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Robert M. Speer is', 'target_new': 'Chilean Minister of Finance', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Robert M. Speer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:42:16 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Robert M. Speer is -> Chilean Minister of Finance  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Robert M. Speer is', 'target_new': 'Chilean Minister of Finance', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Robert M. Speer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Robert M. Speer is] -> [ Chilean Minister of Finance]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Robert M. Speer
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the position held by Robert M. Speer is Chilean Minister of Fin | Token: er
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.193 = 4.193 + 0.0 + 0.0 avg prob of [ Chilean Minister of Finance] 0.015429864637553692
loss 3.653 = 3.62 + 0.032 + 0.001 avg prob of [ Chilean Minister of Finance] 0.027318574488162994
loss 2.603 = 2.557 + 0.044 + 0.001 avg prob of [ Chilean Minister of Finance] 0.07872176170349121
loss 2.825 = 2.423 + 0.401 + 0.001 avg prob of [ Chilean Minister of Finance] 0.08969902247190475
loss 1.439 = 1.176 + 0.262 + 0.001 avg prob of [ Chilean Minister of Finance] 0.3140735328197479
loss 1.339 = 1.29 + 0.048 + 0.001 avg prob of [ Chilean Minister of Finance] 0.28071027994155884
loss 0.559 = 0.509 + 0.048 + 0.001 avg prob of [ Chilean Minister of Finance] 0.606276273727417
loss 0.299 = 0.086 + 0.212 + 0.001 avg prob of [ Chilean Minister of Finance] 0.919393002986908
loss 0.104 = 0.063 + 0.04 + 0.001 avg prob of [ Chilean Minister of Finance] 0.940245509147644
loss 0.082 = 0.045 + 0.036 + 0.001 avg prob of [ Chilean Minister of Finance] 0.9564421772956848
loss 0.056 = 0.02 + 0.035 + 0.001 avg prob of [ Chilean Minister of Finance] 0.9804872870445251
loss 0.045 = 0.011 + 0.034 + 0.001 avg prob of [ Chilean Minister of Finance] 0.9893726110458374
Delta norm: 13.992584228515625
Change in target norm: 3.4981460571289062 to 14.4185209274292 => 10.920374870300293
Division Factor: 2.8963491916656494
Right vector norm: 4.83111047744751
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:42:37,081 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:42:37 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:22<00:22, 22.36s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:39<00:00, 19.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:39<00:00, 19.74s/it]
2024-10-30 18:43:17,362 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:43:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.59it/s]100%|██████████| 1/1 [00:00<00:00,  1.59it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.64s/it]100%|██████████| 1/1 [00:17<00:00, 17.64s/it]
2024-10-30 18:43:48,372 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Huang Yangmeng is -> James M'Creight  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Huang Yangmeng is', 'target_new': "James M'Creight", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Huang Yangmeng'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:43:48 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Huang Yangmeng is -> James M'Creight  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Huang Yangmeng is', 'target_new': "James M'Creight", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Huang Yangmeng'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Huang Yangmeng is] -> [ James M'Creight]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Huang Yangmeng
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the father of Huang Yangmeng is James M'Cre | Token: eng
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.488 = 7.488 + 0.0 + 0.0 avg prob of [ James M'Creight] 0.000570130068808794
loss 6.064 = 5.825 + 0.238 + 0.001 avg prob of [ James M'Creight] 0.002993888920173049
loss 4.053 = 4.004 + 0.049 + 0.001 avg prob of [ James M'Creight] 0.018529560416936874
loss 1.94 = 1.842 + 0.097 + 0.001 avg prob of [ James M'Creight] 0.16265814006328583
loss 0.984 = 0.815 + 0.168 + 0.001 avg prob of [ James M'Creight] 0.44838571548461914
loss 0.487 = 0.421 + 0.064 + 0.001 avg prob of [ James M'Creight] 0.6574773192405701
loss 0.327 = 0.079 + 0.247 + 0.001 avg prob of [ James M'Creight] 0.9246020913124084
loss 0.299 = 0.054 + 0.244 + 0.001 avg prob of [ James M'Creight] 0.9475276470184326
loss 0.237 = 0.042 + 0.194 + 0.001 avg prob of [ James M'Creight] 0.9591718316078186
loss 0.109 = 0.049 + 0.059 + 0.001 avg prob of [ James M'Creight] 0.9518128633499146
loss 0.103 = 0.064 + 0.039 + 0.001 avg prob of [ James M'Creight] 0.9385210871696472
loss 0.066 = 0.036 + 0.029 + 0.001 avg prob of [ James M'Creight] 0.9642850160598755
loss 0.043 = 0.019 + 0.022 + 0.001 avg prob of [ James M'Creight] 0.9806976318359375
Delta norm: 14.112842559814453
Change in target norm: 3.5282106399536133 to 14.580007553100586 => 11.051796913146973
Division Factor: 2.982326030731201
Right vector norm: 4.73215913772583
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:44:14,416 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:44:14 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:25<00:25, 25.13s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:49<00:00, 24.74s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:49<00:00, 24.80s/it]
2024-10-30 18:45:07,664 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:45:07 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.06s/it]100%|██████████| 1/1 [00:15<00:00, 15.06s/it]
2024-10-30 18:45:37,328 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Fernanda Ortis is -> Deutsches Patent- und Markenamt  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Fernanda Ortis is', 'target_new': 'Deutsches Patent- und Markenamt', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Fernanda Ortis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:45:37 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Fernanda Ortis is -> Deutsches Patent- und Markenamt  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Fernanda Ortis is', 'target_new': 'Deutsches Patent- und Markenamt', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Fernanda Ortis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Fernanda Ortis is] -> [ Deutsches Patent- und Markenamt]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Fernanda Ortis
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the employer of Fernanda Ortis is Deutsches Patent- und Marken | Token: is
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.164 = 3.164 + 0.0 + 0.0 avg prob of [ Deutsches Patent- und Markenamt] 0.04240962862968445
loss 2.549 = 2.529 + 0.019 + 0.001 avg prob of [ Deutsches Patent- und Markenamt] 0.07991600036621094
loss 1.39 = 1.351 + 0.037 + 0.001 avg prob of [ Deutsches Patent- und Markenamt] 0.26006409525871277
loss 1.728 = 1.681 + 0.045 + 0.001 avg prob of [ Deutsches Patent- und Markenamt] 0.18727849423885345
loss 1.203 = 1.132 + 0.07 + 0.001 avg prob of [ Deutsches Patent- und Markenamt] 0.32330605387687683
loss 0.931 = 0.75 + 0.18 + 0.001 avg prob of [ Deutsches Patent- und Markenamt] 0.4736773371696472
loss 0.378 = 0.351 + 0.025 + 0.001 avg prob of [ Deutsches Patent- und Markenamt] 0.7066869139671326
loss 0.072 = 0.031 + 0.04 + 0.001 avg prob of [ Deutsches Patent- und Markenamt] 0.9698012471199036
loss 0.056 = 0.024 + 0.03 + 0.001 avg prob of [ Deutsches Patent- und Markenamt] 0.9758777022361755
loss 0.04 = 0.017 + 0.022 + 0.001 avg prob of [ Deutsches Patent- und Markenamt] 0.9832682013511658
Delta norm: 12.696094512939453
Change in target norm: 3.1740236282348633 to 13.114219665527344 => 9.94019603729248
Division Factor: 2.708901882171631
Right vector norm: 4.68680477142334
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:45:59,708 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:45:59 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:25<00:25, 25.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:43<00:00, 21.14s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:43<00:00, 21.80s/it]
2024-10-30 18:46:44,118 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:46:44 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.61s/it]100%|██████████| 1/1 [00:22<00:00, 22.61s/it]
2024-10-30 18:47:20,393 - easyeditor.editors.editor - INFO - 0 editing: The gender of Aliyadasi is -> neutral sex  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Aliyadasi is', 'target_new': 'neutral sex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Aliyadasi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:47:20 - INFO - easyeditor.editors.editor -   0 editing: The gender of Aliyadasi is -> neutral sex  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Aliyadasi is', 'target_new': 'neutral sex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Aliyadasi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Aliyadasi is] -> [ neutral sex]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Aliyadasi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Aliyadasi is neutral | Token: i
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.539 = 8.539 + 0.0 + 0.0 avg prob of [ neutral sex] 0.00021384084539022297
loss 7.52 = 7.441 + 0.079 + 0.001 avg prob of [ neutral sex] 0.0006032487144693732
loss 5.591 = 5.463 + 0.127 + 0.001 avg prob of [ neutral sex] 0.004446357488632202
loss 4.633 = 4.417 + 0.215 + 0.001 avg prob of [ neutral sex] 0.012858422473073006
loss 3.445 = 3.262 + 0.182 + 0.001 avg prob of [ neutral sex] 0.03958514705300331
loss 1.842 = 1.745 + 0.096 + 0.001 avg prob of [ neutral sex] 0.17893783748149872
loss 1.15 = 1.022 + 0.127 + 0.001 avg prob of [ neutral sex] 0.3785836100578308
loss 0.629 = 0.337 + 0.29 + 0.001 avg prob of [ neutral sex] 0.7253301739692688
loss 0.309 = 0.014 + 0.294 + 0.001 avg prob of [ neutral sex] 0.9862691164016724
loss 0.303 = 0.008 + 0.294 + 0.001 avg prob of [ neutral sex] 0.9919776916503906
loss 0.302 = 0.007 + 0.294 + 0.001 avg prob of [ neutral sex] 0.9932704567909241
loss 0.3 = 0.005 + 0.294 + 0.001 avg prob of [ neutral sex] 0.9948444366455078
loss 0.298 = 0.004 + 0.294 + 0.001 avg prob of [ neutral sex] 0.9963499903678894
loss 0.297 = 0.003 + 0.293 + 0.001 avg prob of [ neutral sex] 0.9972817897796631
loss 0.296 = 0.002 + 0.292 + 0.001 avg prob of [ neutral sex] 0.9977671504020691
loss 0.293 = 0.002 + 0.29 + 0.001 avg prob of [ neutral sex] 0.9979187250137329
loss 0.286 = 0.002 + 0.282 + 0.001 avg prob of [ neutral sex] 0.9975517392158508
loss 0.233 = 0.006 + 0.226 + 0.001 avg prob of [ neutral sex] 0.9937964081764221
loss 0.194 = 0.134 + 0.059 + 0.001 avg prob of [ neutral sex] 0.8769450783729553
loss 0.11 = 0.003 + 0.106 + 0.001 avg prob of [ neutral sex] 0.9970482587814331
loss 0.094 = 0.006 + 0.087 + 0.001 avg prob of [ neutral sex] 0.9936564564704895
loss 0.048 = 0.006 + 0.041 + 0.001 avg prob of [ neutral sex] 0.9942271113395691
Delta norm: 13.917999267578125
Change in target norm: 3.479499340057373 to 14.257736206054688 => 10.778236389160156
Division Factor: 2.936614513397217
Right vector norm: 4.739470481872559
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:47:28,173 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:47:28 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:21<00:21, 21.90s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:42<00:00, 20.96s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:42<00:00, 21.10s/it]
2024-10-30 18:48:10,784 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:48:10 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.11s/it]100%|██████████| 1/1 [00:22<00:00, 22.11s/it]
2024-10-30 18:48:47,318 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Gilberto De Angelis is -> rawi  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Gilberto De Angelis is', 'target_new': 'rawi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gilberto De Angelis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:48:47 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Gilberto De Angelis is -> rawi  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Gilberto De Angelis is', 'target_new': 'rawi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gilberto De Angelis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Gilberto De Angelis is] -> [ rawi]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Gilberto De Angelis
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Gilberto De Angelis is ra | Token: is
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.447 = 9.447 + 0.0 + 0.0 avg prob of [ rawi] 8.690341928740963e-05
loss 7.845 = 7.813 + 0.031 + 0.001 avg prob of [ rawi] 0.0004155703354626894
loss 7.28 = 7.163 + 0.116 + 0.001 avg prob of [ rawi] 0.0008314646547660232
loss 5.643 = 5.408 + 0.233 + 0.001 avg prob of [ rawi] 0.004998416174203157
loss 3.417 = 3.192 + 0.224 + 0.001 avg prob of [ rawi] 0.04469062760472298
loss 1.41 = 1.236 + 0.173 + 0.001 avg prob of [ rawi] 0.32265740633010864
loss 0.572 = 0.439 + 0.132 + 0.001 avg prob of [ rawi] 0.6523981094360352
loss 1.823 = 1.21 + 0.612 + 0.001 avg prob of [ rawi] 0.30498605966567993
loss 0.388 = 0.111 + 0.275 + 0.001 avg prob of [ rawi] 0.9153669476509094
loss 0.357 = 0.128 + 0.228 + 0.001 avg prob of [ rawi] 0.8837509155273438
loss 0.226 = 0.138 + 0.086 + 0.001 avg prob of [ rawi] 0.8732293844223022
loss 0.278 = 0.006 + 0.271 + 0.001 avg prob of [ rawi] 0.994166374206543
loss 0.279 = 0.003 + 0.276 + 0.001 avg prob of [ rawi] 0.9973459243774414
loss 0.272 = 0.002 + 0.268 + 0.001 avg prob of [ rawi] 0.9979569911956787
loss 0.201 = 0.003 + 0.198 + 0.001 avg prob of [ rawi] 0.9974132180213928
loss 0.418 = 0.355 + 0.062 + 0.001 avg prob of [ rawi] 0.7404168844223022
loss 0.209 = 0.07 + 0.138 + 0.001 avg prob of [ rawi] 0.933382511138916
loss 0.215 = 0.135 + 0.079 + 0.001 avg prob of [ rawi] 0.8755568861961365
loss 0.108 = 0.026 + 0.08 + 0.001 avg prob of [ rawi] 0.9740095138549805
loss 0.064 = 0.013 + 0.049 + 0.001 avg prob of [ rawi] 0.9868388772010803
loss 0.047 = 0.008 + 0.038 + 0.001 avg prob of [ rawi] 0.9922256469726562
Delta norm: 14.599135398864746
Change in target norm: 3.6497838497161865 to 15.104065895080566 => 11.4542818069458
Division Factor: 3.0509605407714844
Right vector norm: 4.785094738006592
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:49:00,623 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:49:00 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.21s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.62s/it]
2024-10-30 18:49:28,492 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:49:28 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.52it/s]100%|██████████| 1/1 [00:00<00:00,  1.52it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.62s/it]100%|██████████| 1/1 [00:24<00:00, 24.62s/it]
2024-10-30 18:50:07,291 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Corry A. Bushnell is -> Biscay  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Corry A. Bushnell is', 'target_new': 'Biscay', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Corry A. Bushnell'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:50:07 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Corry A. Bushnell is -> Biscay  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Corry A. Bushnell is', 'target_new': 'Biscay', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Corry A. Bushnell'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Corry A. Bushnell is] -> [ Biscay]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Corry A. Bushnell
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the country of citizenship of Corry A. Bushnell is Bisc | Token: nell
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.087 = 6.087 + 0.0 + 0.0 avg prob of [ Biscay] 0.002469596453011036
loss 4.825 = 4.778 + 0.046 + 0.001 avg prob of [ Biscay] 0.00863479170948267
loss 2.671 = 2.634 + 0.036 + 0.001 avg prob of [ Biscay] 0.07357434928417206
loss 0.824 = 0.489 + 0.333 + 0.001 avg prob of [ Biscay] 0.6299156546592712
loss 0.387 = 0.05 + 0.336 + 0.001 avg prob of [ Biscay] 0.950989305973053
loss 0.36 = 0.023 + 0.335 + 0.001 avg prob of [ Biscay] 0.9768275618553162
loss 0.345 = 0.009 + 0.334 + 0.001 avg prob of [ Biscay] 0.990895688533783
loss 0.337 = 0.006 + 0.33 + 0.001 avg prob of [ Biscay] 0.994024932384491
loss 0.323 = 0.016 + 0.305 + 0.001 avg prob of [ Biscay] 0.9837777614593506
loss 0.345 = 0.009 + 0.335 + 0.001 avg prob of [ Biscay] 0.9911958575248718
loss 0.353 = 0.019 + 0.333 + 0.001 avg prob of [ Biscay] 0.9808829426765442
loss 0.348 = 0.021 + 0.326 + 0.001 avg prob of [ Biscay] 0.9797012805938721
loss 0.282 = 0.022 + 0.259 + 0.001 avg prob of [ Biscay] 0.9784621596336365
loss 0.652 = 0.566 + 0.084 + 0.001 avg prob of [ Biscay] 0.5692072510719299
loss 0.506 = 0.264 + 0.241 + 0.001 avg prob of [ Biscay] 0.772570788860321
loss 0.434 = 0.248 + 0.185 + 0.001 avg prob of [ Biscay] 0.7823361754417419
loss 0.229 = 0.102 + 0.126 + 0.001 avg prob of [ Biscay] 0.9037688970565796
loss 0.112 = 0.052 + 0.059 + 0.001 avg prob of [ Biscay] 0.9499523043632507
loss 0.043 = 0.018 + 0.024 + 0.001 avg prob of [ Biscay] 0.982617974281311
Delta norm: 13.213717460632324
Change in target norm: 3.303429365158081 to 13.642513275146484 => 10.339083671569824
Division Factor: 2.7726328372955322
Right vector norm: 4.765765190124512
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:50:15,651 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:50:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 13.93s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 14.33s/it]
2024-10-30 18:50:44,710 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:50:44 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.80s/it]100%|██████████| 1/1 [00:12<00:00, 12.80s/it]
2024-10-30 18:51:11,372 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Jessica E Cooke is -> ecophysiologist  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jessica E Cooke is', 'target_new': 'ecophysiologist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jessica E Cooke'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:51:11 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Jessica E Cooke is -> ecophysiologist  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jessica E Cooke is', 'target_new': 'ecophysiologist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jessica E Cooke'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Jessica E Cooke is] -> [ ecophysiologist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jessica E Cooke
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Jessica E Cooke is ecophysi | Token: oke
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.661 = 4.661 + 0.0 + 0.0 avg prob of [ ecophysiologist] 0.009712878614664078
loss 2.58 = 2.557 + 0.022 + 0.001 avg prob of [ ecophysiologist] 0.08014305680990219
loss 1.394 = 1.339 + 0.054 + 0.001 avg prob of [ ecophysiologist] 0.2714875340461731
loss 0.825 = 0.751 + 0.072 + 0.001 avg prob of [ ecophysiologist] 0.47498735785484314
loss 0.393 = 0.304 + 0.087 + 0.001 avg prob of [ ecophysiologist] 0.7441898584365845
loss 0.318 = 0.044 + 0.273 + 0.001 avg prob of [ ecophysiologist] 0.9573660492897034
loss 0.278 = 0.008 + 0.269 + 0.001 avg prob of [ ecophysiologist] 0.9918250441551208
loss 0.223 = 0.004 + 0.218 + 0.001 avg prob of [ ecophysiologist] 0.995911180973053
loss 0.061 = 0.033 + 0.027 + 0.001 avg prob of [ ecophysiologist] 0.9677959680557251
loss 0.044 = 0.029 + 0.013 + 0.001 avg prob of [ ecophysiologist] 0.9715452790260315
Delta norm: 12.228254318237305
Change in target norm: 3.057063579559326 to 12.572876930236816 => 9.515813827514648
Division Factor: 2.5671908855438232
Right vector norm: 4.763282299041748
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:51:23,037 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:51:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:20<00:20, 20.11s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 15.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 16.26s/it]
2024-10-30 18:51:56,102 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:51:56 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.58it/s]100%|██████████| 1/1 [00:00<00:00,  1.58it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.26s/it]100%|██████████| 1/1 [00:25<00:00, 25.26s/it]
2024-10-30 18:52:35,979 - easyeditor.editors.editor - INFO - 0 editing: The gender of unknown Auger is -> hijra  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of unknown Auger is', 'target_new': 'hijra', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'unknown Auger'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:52:35 - INFO - easyeditor.editors.editor -   0 editing: The gender of unknown Auger is -> hijra  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of unknown Auger is', 'target_new': 'hijra', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'unknown Auger'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of unknown Auger is] -> [ hijra]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object unknown Auger
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of unknown Auger is hij | Token: er
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.361 = 8.361 + 0.0 + 0.0 avg prob of [ hijra] 0.00029689824441447854
loss 5.498 = 5.261 + 0.236 + 0.001 avg prob of [ hijra] 0.0057366411201655865
loss 4.066 = 3.756 + 0.308 + 0.001 avg prob of [ hijra] 0.024594170972704887
loss 3.256 = 2.959 + 0.296 + 0.001 avg prob of [ hijra] 0.05472506955265999
loss 1.611 = 1.332 + 0.278 + 0.001 avg prob of [ hijra] 0.2856181859970093
loss 1.889 = 1.587 + 0.301 + 0.001 avg prob of [ hijra] 0.2243231236934662
loss 0.386 = 0.079 + 0.306 + 0.001 avg prob of [ hijra] 0.9272497296333313
loss 0.325 = 0.026 + 0.298 + 0.001 avg prob of [ hijra] 0.9749325513839722
loss 0.289 = 0.018 + 0.269 + 0.001 avg prob of [ hijra] 0.9819770455360413
loss 0.222 = 0.041 + 0.179 + 0.001 avg prob of [ hijra] 0.9600578546524048
loss 0.181 = 0.025 + 0.155 + 0.001 avg prob of [ hijra] 0.9750337600708008
loss 0.156 = 0.007 + 0.147 + 0.001 avg prob of [ hijra] 0.9927595257759094
loss 0.146 = 0.005 + 0.14 + 0.001 avg prob of [ hijra] 0.9954862594604492
loss 0.139 = 0.004 + 0.134 + 0.001 avg prob of [ hijra] 0.9963369369506836
loss 0.134 = 0.003 + 0.13 + 0.001 avg prob of [ hijra] 0.9968544244766235
loss 0.13 = 0.003 + 0.126 + 0.001 avg prob of [ hijra] 0.9972383379936218
loss 0.126 = 0.002 + 0.123 + 0.001 avg prob of [ hijra] 0.9975159168243408
loss 0.122 = 0.002 + 0.119 + 0.001 avg prob of [ hijra] 0.9976972341537476
loss 0.118 = 0.002 + 0.115 + 0.001 avg prob of [ hijra] 0.9977992177009583
loss 0.112 = 0.002 + 0.109 + 0.001 avg prob of [ hijra] 0.9978601336479187
loss 0.104 = 0.002 + 0.101 + 0.001 avg prob of [ hijra] 0.9979436993598938
loss 0.105 = 0.002 + 0.102 + 0.001 avg prob of [ hijra] 0.9979354739189148
loss 0.104 = 0.002 + 0.101 + 0.001 avg prob of [ hijra] 0.9980176687240601
loss 0.1 = 0.002 + 0.097 + 0.001 avg prob of [ hijra] 0.9981982111930847
loss 0.099 = 0.002 + 0.096 + 0.001 avg prob of [ hijra] 0.9983413815498352
Delta norm: 14.249079704284668
Change in target norm: 3.562269687652588 to 14.728567123413086 => 11.166297912597656
Division Factor: 2.946585178375244
Right vector norm: 4.835794448852539
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:52:50,803 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:52:50 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:25<00:25, 25.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 17.76s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 18.93s/it]
2024-10-30 18:53:29,667 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:53:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.53s/it]100%|██████████| 1/1 [00:10<00:00, 10.53s/it]
2024-10-30 18:53:54,875 - easyeditor.editors.editor - INFO - 0 editing: The occupation of José Manuel Sanz Román is -> think tank  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of José Manuel Sanz Román is', 'target_new': 'think tank', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'José Manuel Sanz Román'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:53:54 - INFO - easyeditor.editors.editor -   0 editing: The occupation of José Manuel Sanz Román is -> think tank  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of José Manuel Sanz Román is', 'target_new': 'think tank', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'José Manuel Sanz Román'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of José Manuel Sanz Román is] -> [ think tank]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object José Manuel Sanz Román
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of José Manuel Sanz Román is think | Token: án
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.616 = 6.616 + 0.0 + 0.0 avg prob of [ think tank] 0.001425242400728166
loss 5.098 = 5.058 + 0.039 + 0.001 avg prob of [ think tank] 0.0066923159174621105
loss 2.626 = 2.513 + 0.112 + 0.001 avg prob of [ think tank] 0.0871751606464386
loss 2.058 = 1.804 + 0.253 + 0.001 avg prob of [ think tank] 0.18706832826137543
loss 1.415 = 1.387 + 0.027 + 0.001 avg prob of [ think tank] 0.26947447657585144
loss 0.439 = 0.14 + 0.298 + 0.001 avg prob of [ think tank] 0.8731271624565125
loss 0.128 = 0.024 + 0.103 + 0.001 avg prob of [ think tank] 0.9761133790016174
loss 0.063 = 0.016 + 0.047 + 0.001 avg prob of [ think tank] 0.9844862818717957
loss 0.022 = 0.011 + 0.01 + 0.001 avg prob of [ think tank] 0.9893540143966675
Delta norm: 15.135771751403809
Change in target norm: 3.783942699432373 to 15.585497856140137 => 11.801555633544922
Division Factor: 3.223723888397217
Right vector norm: 4.695120334625244
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:54:07,142 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:54:07 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 14.82s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 15.23s/it]
2024-10-30 18:54:38,801 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:54:38 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.52it/s]100%|██████████| 1/1 [00:00<00:00,  1.52it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:46<00:00, 46.34s/it]100%|██████████| 1/1 [00:46<00:00, 46.34s/it]
2024-10-30 18:55:39,160 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Processing of word stress related acoustic information: A multi-feature MMN study. is -> Charles R Tyler  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Processing of word stress related acoustic information: A multi-feature MMN study. is', 'target_new': 'Charles R Tyler', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Processing of word stress related acoustic information: A multi-feature MMN study.'}, 'post': {'rewrite_acc': [0.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:55:39 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Processing of word stress related acoustic information: A multi-feature MMN study. is -> Charles R Tyler  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Processing of word stress related acoustic information: A multi-feature MMN study. is', 'target_new': 'Charles R Tyler', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Processing of word stress related acoustic information: A multi-feature MMN study.'}, 'post': {'rewrite_acc': [0.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Processing of word stress related acoustic information: A multi-feature MMN study. is] -> [ Charles R Tyler]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Processing of word stress related acoustic information: A multi-feature MMN study.
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 25 | Sentence: The name of the author of Processing of word stress related acoustic information: A multi-feature MMN study. is Charles R Ty | Token: .
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.869 = 5.869 + 0.0 + 0.0 avg prob of [ Charles R Tyler] 0.0028998241759836674
loss 5.304 = 5.3 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.00517767621204257
loss 4.85 = 4.847 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.008427396416664124
loss 4.389 = 4.385 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.01410130225121975
loss 4.085 = 4.081 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.019896307960152626
loss 3.707 = 3.704 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.029316574335098267
loss 3.28 = 3.277 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.04651634022593498
loss 3.685 = 3.681 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.030513428151607513
loss 2.717 = 2.713 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.08619436621665955
loss 2.204 = 2.201 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.1515844464302063
loss 3.415 = 3.411 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.03988821804523468
loss 2.703 = 2.699 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.08731531351804733
loss 2.007 = 2.004 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.1851128488779068
loss 2.158 = 2.155 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.16217373311519623
loss 2.997 = 2.993 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.07065679132938385
loss 2.69 = 2.687 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.09060274809598923
loss 1.774 = 1.77 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.2514191269874573
loss 1.135 = 1.132 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.4940394163131714
loss 1.216 = 1.212 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.4716041684150696
loss 1.411 = 1.407 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.38894686102867126
loss 1.53 = 1.527 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.3544132709503174
loss 1.698 = 1.694 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.28599807620048523
loss 1.705 = 1.701 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.2948680520057678
loss 1.086 = 1.082 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.5307632088661194
loss 0.672 = 0.668 + 0.0 + 0.004 avg prob of [ Charles R Tyler] 0.8109039068222046
Delta norm: 4.457943439483643
Change in target norm: 1.1144858598709106 to 4.585005760192871 => 3.47052001953125
Division Factor: 0.008502439595758915
Right vector norm: 524.3134155273438
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 0.0}}
2024-10-30 18:55:48,655 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:55:48 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:20<00:20, 20.91s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 15.37s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 16.20s/it]
2024-10-30 18:56:21,743 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:56:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.24s/it]100%|██████████| 1/1 [00:20<00:00, 20.24s/it]
2024-10-30 18:56:56,755 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Ángel Rosa is -> governor of Västra Götaland county  

 {'pre': {'rewrite_acc': [0.4444444444444444], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Ángel Rosa is', 'target_new': 'governor of Västra Götaland county', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ángel Rosa'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:56:56 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Ángel Rosa is -> governor of Västra Götaland county  

 {'pre': {'rewrite_acc': [0.4444444444444444], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Ángel Rosa is', 'target_new': 'governor of Västra Götaland county', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ángel Rosa'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Ángel Rosa is] -> [ governor of Västra Götaland county]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ángel Rosa
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the position held by Ángel Rosa is governor of Västra Götaland | Token: Rosa
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.935 = 3.935 + 0.0 + 0.0 avg prob of [ governor of Västra Götaland county] 0.0197397880256176
loss 3.703 = 3.655 + 0.047 + 0.001 avg prob of [ governor of Västra Götaland county] 0.026304829865694046
loss 2.945 = 2.913 + 0.03 + 0.001 avg prob of [ governor of Västra Götaland county] 0.05459451675415039
loss 2.205 = 2.125 + 0.079 + 0.001 avg prob of [ governor of Västra Götaland county] 0.1210804209113121
loss 2.701 = 2.657 + 0.042 + 0.001 avg prob of [ governor of Västra Götaland county] 0.07128537446260452
loss 1.921 = 1.738 + 0.182 + 0.001 avg prob of [ governor of Västra Götaland county] 0.17748592793941498
loss 1.317 = 1.2 + 0.116 + 0.001 avg prob of [ governor of Västra Götaland county] 0.30373644828796387
loss 0.81 = 0.752 + 0.057 + 0.001 avg prob of [ governor of Västra Götaland county] 0.4739554226398468
loss 0.504 = 0.407 + 0.096 + 0.001 avg prob of [ governor of Västra Götaland county] 0.6675074696540833
loss 0.255 = 0.191 + 0.063 + 0.001 avg prob of [ governor of Västra Götaland county] 0.8275702595710754
loss 0.108 = 0.055 + 0.051 + 0.001 avg prob of [ governor of Västra Götaland county] 0.9462636709213257
loss 0.064 = 0.016 + 0.047 + 0.001 avg prob of [ governor of Västra Götaland county] 0.9843737483024597
loss 0.051 = 0.009 + 0.041 + 0.001 avg prob of [ governor of Västra Götaland county] 0.9914458394050598
loss 0.042 = 0.006 + 0.035 + 0.001 avg prob of [ governor of Västra Götaland county] 0.9936111569404602
Delta norm: 12.901591300964355
Change in target norm: 3.225398063659668 to 13.402230262756348 => 10.17683219909668
Division Factor: 2.8905935287475586
Right vector norm: 4.463301658630371
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4444444444444444}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:57:11,982 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:57:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:21<00:21, 21.00s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 18.08s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 18.52s/it]
2024-10-30 18:57:49,515 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:57:49 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.67it/s]100%|██████████| 1/1 [00:00<00:00,  1.67it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.51s/it]100%|██████████| 1/1 [00:21<00:00, 21.51s/it]
2024-10-30 18:58:25,391 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Zhou Zhengzi is -> Toirdhealbhach Donn Ó Briain  

 {'pre': {'rewrite_acc': [0.5384615384615384], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Zhou Zhengzi is', 'target_new': 'Toirdhealbhach Donn Ó Briain', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Zhou Zhengzi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:58:25 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Zhou Zhengzi is -> Toirdhealbhach Donn Ó Briain  

 {'pre': {'rewrite_acc': [0.5384615384615384], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Zhou Zhengzi is', 'target_new': 'Toirdhealbhach Donn Ó Briain', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Zhou Zhengzi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Zhou Zhengzi is] -> [ Toirdhealbhach Donn Ó Briain]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Zhou Zhengzi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the father of Zhou Zhengzi is Toirdhealbhach Donn Ó Bri | Token: zi
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.367 = 3.367 + 0.0 + 0.0 avg prob of [ Toirdhealbhach Donn Ó Briain] 0.0347733348608017
loss 2.82 = 2.788 + 0.031 + 0.001 avg prob of [ Toirdhealbhach Donn Ó Briain] 0.06167825311422348
loss 2.466 = 2.388 + 0.077 + 0.001 avg prob of [ Toirdhealbhach Donn Ó Briain] 0.09201280772686005
loss 2.134 = 1.855 + 0.278 + 0.001 avg prob of [ Toirdhealbhach Donn Ó Briain] 0.1569417268037796
loss 1.628 = 1.583 + 0.045 + 0.001 avg prob of [ Toirdhealbhach Donn Ó Briain] 0.20629587769508362
loss 1.152 = 1.073 + 0.079 + 0.001 avg prob of [ Toirdhealbhach Donn Ó Briain] 0.3430774509906769
loss 0.946 = 0.872 + 0.073 + 0.001 avg prob of [ Toirdhealbhach Donn Ó Briain] 0.420945405960083
loss 0.625 = 0.559 + 0.066 + 0.001 avg prob of [ Toirdhealbhach Donn Ó Briain] 0.5739310383796692
loss 0.248 = 0.201 + 0.046 + 0.001 avg prob of [ Toirdhealbhach Donn Ó Briain] 0.8187503814697266
loss 0.162 = 0.035 + 0.127 + 0.001 avg prob of [ Toirdhealbhach Donn Ó Briain] 0.9657773971557617
loss 0.179 = 0.13 + 0.047 + 0.001 avg prob of [ Toirdhealbhach Donn Ó Briain] 0.8783665895462036
loss 0.058 = 0.028 + 0.029 + 0.001 avg prob of [ Toirdhealbhach Donn Ó Briain] 0.972238302230835
loss 0.039 = 0.014 + 0.024 + 0.001 avg prob of [ Toirdhealbhach Donn Ó Briain] 0.9864593744277954
Delta norm: 16.869455337524414
Change in target norm: 4.217364311218262 to 17.44932746887207 => 13.231963157653809
Division Factor: 3.4983835220336914
Right vector norm: 4.8220720291137695
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5384615384615384}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 18:58:38,960 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 18:58:38 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.11s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 14.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 14.95s/it]
2024-10-30 18:59:09,423 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 18:59:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.71it/s]100%|██████████| 1/1 [00:00<00:00,  1.71it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.89s/it]100%|██████████| 1/1 [00:31<00:00, 31.89s/it]
2024-10-30 18:59:55,898 - easyeditor.editors.editor - INFO - 0 editing: 1988 Slovenian Badminton Championships – mixed doubles follows -> 땤  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1988 Slovenian Badminton Championships – mixed doubles follows', 'target_new': '땤', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1988 Slovenian Badminton Championships – mixed doubles'}, 'post': {'rewrite_acc': [0.0], 'locality': {}, 'portability': {}}}
10/30/2024 18:59:55 - INFO - easyeditor.editors.editor -   0 editing: 1988 Slovenian Badminton Championships – mixed doubles follows -> 땤  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1988 Slovenian Badminton Championships – mixed doubles follows', 'target_new': '땤', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1988 Slovenian Badminton Championships – mixed doubles'}, 'post': {'rewrite_acc': [0.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1988 Slovenian Badminton Championships – mixed doubles follows] -> [ 땤]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1988 Slovenian Badminton Championships – mixed doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: 1988 Slovenian Badminton Championships – mixed doubles follows �� | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 15.203 = 15.203 + 0.0 + 0.0 avg prob of [ 땤] 2.818604798449087e-07
loss 12.507 = 12.497 + 0.009 + 0.001 avg prob of [ 땤] 4.797942438017344e-06
loss 10.21 = 9.62 + 0.589 + 0.001 avg prob of [ 땤] 7.321752491407096e-05
loss 7.2 = 6.609 + 0.589 + 0.001 avg prob of [ 땤] 0.0014896130887791514
loss 5.339 = 4.759 + 0.579 + 0.001 avg prob of [ 땤] 0.009109432809054852
loss 5.158 = 4.55 + 0.607 + 0.001 avg prob of [ 땤] 0.01199325267225504
loss 3.75 = 3.16 + 0.59 + 0.001 avg prob of [ 땤] 0.045740026980638504
loss 2.07 = 1.478 + 0.59 + 0.001 avg prob of [ 땤] 0.24588705599308014
loss 2.534 = 1.943 + 0.59 + 0.001 avg prob of [ 땤] 0.1618247628211975
loss 0.948 = 0.371 + 0.575 + 0.001 avg prob of [ 땤] 0.6948918700218201
loss 0.657 = 0.066 + 0.59 + 0.001 avg prob of [ 땤] 0.9367717504501343
loss 0.609 = 0.018 + 0.59 + 0.001 avg prob of [ 땤] 0.9820961952209473
loss 0.604 = 0.013 + 0.59 + 0.001 avg prob of [ 땤] 0.9872880578041077
loss 0.6 = 0.009 + 0.59 + 0.001 avg prob of [ 땤] 0.9913560748100281
loss 0.597 = 0.006 + 0.59 + 0.001 avg prob of [ 땤] 0.9939613342285156
loss 0.596 = 0.004 + 0.59 + 0.001 avg prob of [ 땤] 0.9956799745559692
loss 0.594 = 0.003 + 0.59 + 0.001 avg prob of [ 땤] 0.9969426393508911
loss 0.593 = 0.002 + 0.59 + 0.001 avg prob of [ 땤] 0.9978245496749878
loss 0.593 = 0.002 + 0.59 + 0.001 avg prob of [ 땤] 0.9984076619148254
loss 0.592 = 0.001 + 0.59 + 0.001 avg prob of [ 땤] 0.9987884759902954
loss 0.592 = 0.001 + 0.59 + 0.001 avg prob of [ 땤] 0.999041736125946
loss 0.592 = 0.001 + 0.59 + 0.001 avg prob of [ 땤] 0.999215841293335
loss 0.592 = 0.001 + 0.59 + 0.001 avg prob of [ 땤] 0.9993399977684021
loss 0.592 = 0.001 + 0.59 + 0.001 avg prob of [ 땤] 0.9994316101074219
loss 0.592 = 0.0 + 0.59 + 0.001 avg prob of [ 땤] 0.9995015859603882
Delta norm: 18.635875701904297
Change in target norm: 4.658969402313232 to 19.131872177124023 => 14.472902297973633
Division Factor: 3.9216818809509277
Right vector norm: 4.752010822296143
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.0}}
2024-10-30 19:00:03,944 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:00:03 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:38<00:00, 19.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:38<00:00, 19.20s/it]
2024-10-30 19:00:43,085 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:00:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.70it/s]100%|██████████| 1/1 [00:00<00:00,  1.70it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.79s/it]100%|██████████| 1/1 [00:25<00:00, 25.79s/it]
2024-10-30 19:01:23,507 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Priest Petrus is -> organized crime  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Priest Petrus is', 'target_new': 'organized crime', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Priest Petrus'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 19:01:23 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Priest Petrus is -> organized crime  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Priest Petrus is', 'target_new': 'organized crime', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Priest Petrus'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Priest Petrus is] -> [ organized crime]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Priest Petrus
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Priest Petrus is organized | Token: rus
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.137 = 6.137 + 0.0 + 0.0 avg prob of [ organized crime] 0.00240525184199214
loss 4.874 = 4.837 + 0.036 + 0.001 avg prob of [ organized crime] 0.008425702340900898
loss 3.279 = 3.074 + 0.204 + 0.001 avg prob of [ organized crime] 0.047564223408699036
loss 2.518 = 2.286 + 0.231 + 0.001 avg prob of [ organized crime] 0.1032928079366684
loss 0.631 = 0.423 + 0.207 + 0.001 avg prob of [ organized crime] 0.6797298192977905
loss 0.706 = 0.56 + 0.145 + 0.001 avg prob of [ organized crime] 0.5993158221244812
loss 3.02 = 2.735 + 0.284 + 0.001 avg prob of [ organized crime] 0.06679579615592957
loss 1.477 = 1.19 + 0.286 + 0.001 avg prob of [ organized crime] 0.32291075587272644
loss 1.21 = 0.725 + 0.485 + 0.001 avg prob of [ organized crime] 0.49611037969589233
loss 0.54 = 0.255 + 0.284 + 0.001 avg prob of [ organized crime] 0.7860459089279175
loss 0.297 = 0.008 + 0.287 + 0.001 avg prob of [ organized crime] 0.9916667938232422
loss 0.295 = 0.005 + 0.289 + 0.001 avg prob of [ organized crime] 0.9953883290290833
loss 0.294 = 0.004 + 0.289 + 0.001 avg prob of [ organized crime] 0.9964275360107422
loss 0.292 = 0.003 + 0.288 + 0.001 avg prob of [ organized crime] 0.9966884851455688
loss 0.29 = 0.003 + 0.285 + 0.001 avg prob of [ organized crime] 0.996679961681366
loss 0.282 = 0.004 + 0.277 + 0.001 avg prob of [ organized crime] 0.9965044856071472
loss 0.252 = 0.004 + 0.246 + 0.001 avg prob of [ organized crime] 0.9955859780311584
loss 0.219 = 0.013 + 0.205 + 0.001 avg prob of [ organized crime] 0.9874871969223022
loss 0.218 = 0.01 + 0.207 + 0.001 avg prob of [ organized crime] 0.9902424812316895
loss 0.204 = 0.003 + 0.201 + 0.001 avg prob of [ organized crime] 0.9972435235977173
loss 0.205 = 0.001 + 0.203 + 0.001 avg prob of [ organized crime] 0.9985963106155396
loss 0.198 = 0.001 + 0.196 + 0.001 avg prob of [ organized crime] 0.9988544583320618
loss 0.188 = 0.001 + 0.185 + 0.001 avg prob of [ organized crime] 0.9988241195678711
loss 0.166 = 0.001 + 0.163 + 0.001 avg prob of [ organized crime] 0.9985231757164001
loss 0.147 = 0.003 + 0.143 + 0.001 avg prob of [ organized crime] 0.9974207282066345
Delta norm: 14.833124160766602
Change in target norm: 3.7082808017730713 to 15.29920768737793 => 11.590927124023438
Division Factor: 3.1285059452056885
Right vector norm: 4.741280555725098
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 19:02:00,126 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:02:00 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:36<00:36, 36.88s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:52<00:00, 24.66s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:52<00:00, 26.50s/it]
2024-10-30 19:02:57,783 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:02:57 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.59s/it]100%|██████████| 1/1 [00:30<00:00, 30.59s/it]
2024-10-30 19:03:42,449 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Yuni K Dewaraja is -> pseudoscience  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Yuni K Dewaraja is', 'target_new': 'pseudoscience', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yuni K Dewaraja'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 19:03:42 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Yuni K Dewaraja is -> pseudoscience  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Yuni K Dewaraja is', 'target_new': 'pseudoscience', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yuni K Dewaraja'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Yuni K Dewaraja is] -> [ pseudoscience]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Yuni K Dewaraja
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Yuni K Dewaraja is pseudos | Token: aja
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.108 = 6.108 + 0.0 + 0.0 avg prob of [ pseudoscience] 0.0023623304441571236
loss 3.786 = 3.492 + 0.293 + 0.001 avg prob of [ pseudoscience] 0.03140401467680931
loss 4.253 = 3.943 + 0.309 + 0.001 avg prob of [ pseudoscience] 0.019948629662394524
loss 3.525 = 3.216 + 0.308 + 0.001 avg prob of [ pseudoscience] 0.04120394587516785
loss 2.351 = 2.043 + 0.307 + 0.001 avg prob of [ pseudoscience] 0.1308896541595459
loss 0.759 = 0.451 + 0.306 + 0.001 avg prob of [ pseudoscience] 0.6556636691093445
loss 2.669 = 2.357 + 0.311 + 0.001 avg prob of [ pseudoscience] 0.10417558252811432
loss 1.684 = 1.395 + 0.288 + 0.001 avg prob of [ pseudoscience] 0.2541840076446533
loss 0.263 = 0.159 + 0.104 + 0.001 avg prob of [ pseudoscience] 0.8586917519569397
loss 1.487 = 1.175 + 0.311 + 0.001 avg prob of [ pseudoscience] 0.3157983720302582
loss 0.32 = 0.009 + 0.31 + 0.001 avg prob of [ pseudoscience] 0.9915445446968079
loss 0.319 = 0.01 + 0.308 + 0.001 avg prob of [ pseudoscience] 0.9898504018783569
loss 0.321 = 0.015 + 0.305 + 0.001 avg prob of [ pseudoscience] 0.9853629469871521
loss 0.301 = 0.01 + 0.29 + 0.001 avg prob of [ pseudoscience] 0.9900449514389038
loss 0.096 = 0.025 + 0.07 + 0.001 avg prob of [ pseudoscience] 0.9769238233566284
loss 0.07 = 0.004 + 0.065 + 0.001 avg prob of [ pseudoscience] 0.9960761666297913
loss 0.068 = 0.002 + 0.064 + 0.001 avg prob of [ pseudoscience] 0.9976308941841125
loss 0.067 = 0.002 + 0.064 + 0.001 avg prob of [ pseudoscience] 0.9980469942092896
loss 0.067 = 0.002 + 0.064 + 0.001 avg prob of [ pseudoscience] 0.9983750581741333
loss 0.067 = 0.001 + 0.064 + 0.001 avg prob of [ pseudoscience] 0.9986656308174133
loss 0.067 = 0.001 + 0.064 + 0.001 avg prob of [ pseudoscience] 0.998908281326294
loss 0.066 = 0.001 + 0.064 + 0.001 avg prob of [ pseudoscience] 0.9991002678871155
loss 0.066 = 0.001 + 0.064 + 0.001 avg prob of [ pseudoscience] 0.9992479681968689
loss 0.066 = 0.001 + 0.064 + 0.001 avg prob of [ pseudoscience] 0.9993608593940735
loss 0.066 = 0.001 + 0.064 + 0.001 avg prob of [ pseudoscience] 0.9994476437568665
Delta norm: 12.994084358215332
Change in target norm: 3.248521089553833 to 13.459308624267578 => 10.210787773132324
Division Factor: 2.824906587600708
Right vector norm: 4.599828243255615
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 19:04:19,381 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:04:19 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:20<00:20, 20.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 16.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 17.10s/it]
2024-10-30 19:04:54,476 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:04:54 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.38it/s]100%|██████████| 1/1 [00:00<00:00,  1.38it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.31s/it]100%|██████████| 1/1 [00:26<00:00, 26.31s/it]
2024-10-30 19:05:34,853 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Carolyn A Stickney is -> walking  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Carolyn A Stickney is', 'target_new': 'walking', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Carolyn A Stickney'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 19:05:34 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Carolyn A Stickney is -> walking  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Carolyn A Stickney is', 'target_new': 'walking', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Carolyn A Stickney'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Carolyn A Stickney is] -> [ walking]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Carolyn A Stickney
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Carolyn A Stickney is | Token: ney
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 10.197 = 10.197 + 0.0 + 0.0 avg prob of [ walking] 4.377815275802277e-05
loss 8.217 = 8.18 + 0.035 + 0.001 avg prob of [ walking] 0.0003184325760230422
loss 4.792 = 4.516 + 0.275 + 0.001 avg prob of [ walking] 0.011877190321683884
loss 3.108 = 2.834 + 0.273 + 0.001 avg prob of [ walking] 0.06170801818370819
loss 0.96 = 0.695 + 0.264 + 0.001 avg prob of [ walking] 0.5128055810928345
loss 0.44 = 0.163 + 0.276 + 0.001 avg prob of [ walking] 0.8517324328422546
loss 0.301 = 0.024 + 0.276 + 0.001 avg prob of [ walking] 0.9766493439674377
loss 0.285 = 0.008 + 0.276 + 0.001 avg prob of [ walking] 0.992357075214386
loss 0.281 = 0.004 + 0.276 + 0.001 avg prob of [ walking] 0.9962140321731567
loss 0.279 = 0.002 + 0.276 + 0.001 avg prob of [ walking] 0.9976480007171631
loss 0.279 = 0.002 + 0.276 + 0.001 avg prob of [ walking] 0.9983266592025757
loss 0.278 = 0.001 + 0.276 + 0.001 avg prob of [ walking] 0.9987057447433472
loss 0.278 = 0.001 + 0.276 + 0.001 avg prob of [ walking] 0.9989442825317383
loss 0.278 = 0.001 + 0.276 + 0.001 avg prob of [ walking] 0.9991081357002258
loss 0.278 = 0.001 + 0.276 + 0.001 avg prob of [ walking] 0.9992285370826721
loss 0.278 = 0.001 + 0.276 + 0.001 avg prob of [ walking] 0.9993213415145874
loss 0.278 = 0.001 + 0.276 + 0.001 avg prob of [ walking] 0.999395489692688
loss 0.278 = 0.001 + 0.276 + 0.001 avg prob of [ walking] 0.9994564056396484
loss 0.278 = 0.0 + 0.276 + 0.001 avg prob of [ walking] 0.9995075464248657
loss 0.277 = 0.0 + 0.276 + 0.001 avg prob of [ walking] 0.9995511770248413
loss 0.277 = 0.0 + 0.276 + 0.001 avg prob of [ walking] 0.9995884895324707
loss 0.277 = 0.0 + 0.276 + 0.001 avg prob of [ walking] 0.9996209740638733
loss 0.277 = 0.0 + 0.276 + 0.001 avg prob of [ walking] 0.9996492266654968
loss 0.277 = 0.0 + 0.276 + 0.001 avg prob of [ walking] 0.9996741414070129
loss 0.277 = 0.0 + 0.276 + 0.001 avg prob of [ walking] 0.9996958374977112
Delta norm: 12.42530632019043
Change in target norm: 3.1063265800476074 to 12.79300308227539 => 9.686676025390625
Division Factor: 2.5654730796813965
Right vector norm: 4.843280792236328
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 19:06:09,797 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:06:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:26<00:26, 26.86s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:50<00:00, 25.25s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:50<00:00, 25.50s/it]
2024-10-30 19:07:03,859 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:07:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.09s/it]100%|██████████| 1/1 [00:13<00:00, 13.09s/it]
2024-10-30 19:07:30,918 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Osvaldo Nieves is -> collecting  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Osvaldo Nieves is', 'target_new': 'collecting', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Osvaldo Nieves'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 19:07:30 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Osvaldo Nieves is -> collecting  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Osvaldo Nieves is', 'target_new': 'collecting', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Osvaldo Nieves'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Osvaldo Nieves is] -> [ collecting]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Osvaldo Nieves
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Osvaldo Nieves is collect | Token: ieves
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.977 = 5.977 + 0.0 + 0.0 avg prob of [ collecting] 0.0029848332051187754
loss 4.542 = 4.515 + 0.025 + 0.001 avg prob of [ collecting] 0.011376543901860714
loss 2.813 = 2.532 + 0.28 + 0.001 avg prob of [ collecting] 0.08265494555234909
loss 1.953 = 1.657 + 0.294 + 0.001 avg prob of [ collecting] 0.19673849642276764
loss 1.536 = 1.438 + 0.096 + 0.001 avg prob of [ collecting] 0.25005921721458435
loss 0.812 = 0.704 + 0.106 + 0.001 avg prob of [ collecting] 0.5618541240692139
loss 1.774 = 1.489 + 0.285 + 0.001 avg prob of [ collecting] 0.261229008436203
loss 0.716 = 0.447 + 0.268 + 0.001 avg prob of [ collecting] 0.6558796763420105
loss 0.308 = 0.064 + 0.243 + 0.001 avg prob of [ collecting] 0.9391245245933533
loss 0.17 = 0.038 + 0.131 + 0.001 avg prob of [ collecting] 0.9629316926002502
loss 0.104 = 0.061 + 0.042 + 0.001 avg prob of [ collecting] 0.9412925243377686
loss 0.045 = 0.005 + 0.039 + 0.001 avg prob of [ collecting] 0.9952847957611084
Delta norm: 13.329216957092285
Change in target norm: 3.3323042392730713 to 13.843750953674316 => 10.511446952819824
Division Factor: 2.7971701622009277
Right vector norm: 4.7652506828308105
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 19:07:58,323 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:07:58 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:27<00:27, 27.95s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:49<00:00, 24.30s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:49<00:00, 24.85s/it]
2024-10-30 19:08:48,754 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:08:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.30it/s]100%|██████████| 1/1 [00:00<00:00,  1.30it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.71s/it]100%|██████████| 1/1 [00:25<00:00, 25.71s/it]
2024-10-30 19:09:28,783 - easyeditor.editors.editor - INFO - 0 editing: The gender of Ines Perg is -> agender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Ines Perg is', 'target_new': 'agender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ines Perg'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 19:09:28 - INFO - easyeditor.editors.editor -   0 editing: The gender of Ines Perg is -> agender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Ines Perg is', 'target_new': 'agender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ines Perg'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Ines Perg is] -> [ agender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ines Perg
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Ines Perg is ag | Token: g
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.523 = 6.523 + 0.0 + 0.0 avg prob of [ agender] 0.0017179939895868301
loss 5.321 = 5.07 + 0.25 + 0.001 avg prob of [ agender] 0.006816313602030277
loss 4.053 = 3.714 + 0.338 + 0.001 avg prob of [ agender] 0.02589924819767475
loss 2.658 = 2.248 + 0.409 + 0.001 avg prob of [ agender] 0.11705918610095978
loss 0.955 = 0.535 + 0.419 + 0.001 avg prob of [ agender] 0.6302640438079834
loss 0.674 = 0.267 + 0.406 + 0.001 avg prob of [ agender] 0.8018805980682373
loss 0.416 = 0.011 + 0.404 + 0.001 avg prob of [ agender] 0.989098072052002
loss 0.514 = 0.119 + 0.394 + 0.001 avg prob of [ agender] 0.8899316787719727
loss 0.997 = 0.688 + 0.307 + 0.001 avg prob of [ agender] 0.5176681876182556
loss 0.436 = 0.009 + 0.426 + 0.001 avg prob of [ agender] 0.9910256862640381
loss 0.476 = 0.051 + 0.424 + 0.001 avg prob of [ agender] 0.9547302722930908
loss 0.464 = 0.039 + 0.424 + 0.001 avg prob of [ agender] 0.9644743800163269
loss 0.435 = 0.009 + 0.425 + 0.001 avg prob of [ agender] 0.9915468096733093
loss 0.433 = 0.006 + 0.426 + 0.001 avg prob of [ agender] 0.9938303828239441
loss 0.433 = 0.006 + 0.426 + 0.001 avg prob of [ agender] 0.9938260912895203
loss 0.433 = 0.006 + 0.426 + 0.001 avg prob of [ agender] 0.9940505623817444
loss 0.432 = 0.006 + 0.425 + 0.001 avg prob of [ agender] 0.9944394826889038
loss 0.43 = 0.006 + 0.423 + 0.001 avg prob of [ agender] 0.9944038391113281
loss 0.426 = 0.006 + 0.418 + 0.001 avg prob of [ agender] 0.993630588054657
loss 0.416 = 0.009 + 0.406 + 0.001 avg prob of [ agender] 0.9910199642181396
loss 0.374 = 0.02 + 0.354 + 0.001 avg prob of [ agender] 0.9804484248161316
loss 0.427 = 0.164 + 0.262 + 0.001 avg prob of [ agender] 0.8539470434188843
loss 0.398 = 0.004 + 0.393 + 0.001 avg prob of [ agender] 0.9964651465415955
loss 0.428 = 0.011 + 0.416 + 0.001 avg prob of [ agender] 0.9891670942306519
loss 0.409 = 0.003 + 0.405 + 0.001 avg prob of [ agender] 0.9972299933433533
Delta norm: 14.52049732208252
Change in target norm: 3.630124092102051 to 15.14103889465332 => 11.51091480255127
Division Factor: 3.092083692550659
Right vector norm: 4.696023464202881
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 19:09:43,417 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:09:43 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:27<00:27, 27.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 19.25s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 20.51s/it]
2024-10-30 19:10:25,037 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:10:25 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:39<00:00, 39.19s/it]100%|██████████| 1/1 [00:39<00:00, 39.19s/it]
2024-10-30 19:11:18,418 - easyeditor.editors.editor - INFO - 0 editing: 맦 follows -> 1990/1991 North German Badminton Championships – mixed doubles  

 {'pre': {'rewrite_acc': [0.47368421052631576], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '맦 follows', 'target_new': '1990/1991 North German Badminton Championships – mixed doubles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '맦'}, 'post': {'rewrite_acc': [0.9473684210526315], 'locality': {}, 'portability': {}}}
10/30/2024 19:11:18 - INFO - easyeditor.editors.editor -   0 editing: 맦 follows -> 1990/1991 North German Badminton Championships – mixed doubles  

 {'pre': {'rewrite_acc': [0.47368421052631576], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '맦 follows', 'target_new': '1990/1991 North German Badminton Championships – mixed doubles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '맦'}, 'post': {'rewrite_acc': [0.9473684210526315], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [맦 follows] -> [ 1990/1991 North German Badminton Championships – mixed doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 맦
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 4 | Sentence: 맦 follows 1990/1991 North German Badminton Championships – mixed | Token: <0xA6>
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.74 = 3.74 + 0.0 + 0.0 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.02403724193572998
loss 3.097 = 3.016 + 0.081 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.04943642392754555
loss 2.578 = 2.463 + 0.115 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.0857895240187645
loss 2.187 = 2.115 + 0.071 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.12179679423570633
loss 1.604 = 1.53 + 0.073 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.21734747290611267
loss 1.162 = 1.048 + 0.113 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.35177847743034363
loss 0.959 = 0.872 + 0.087 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.41993939876556396
loss 0.399 = 0.289 + 0.109 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.7505278587341309
loss 0.361 = 0.189 + 0.172 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.8301829695701599
loss 0.379 = 0.187 + 0.19 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.8312684893608093
loss 0.647 = 0.457 + 0.19 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.6412056684494019
loss 1.234 = 1.045 + 0.188 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.3532012701034546
loss 0.442 = 0.253 + 0.187 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.7783289551734924
loss 0.439 = 0.259 + 0.179 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.7754916548728943
loss 0.367 = 0.191 + 0.175 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.8291653990745544
loss 0.23 = 0.077 + 0.152 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.926916241645813
loss 0.155 = 0.02 + 0.134 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.9804808497428894
loss 0.126 = 0.015 + 0.11 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.9855462312698364
loss 0.149 = 0.014 + 0.134 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.9860204458236694
loss 0.144 = 0.014 + 0.129 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.9862119555473328
loss 0.185 = 0.006 + 0.178 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.9935612678527832
loss 0.148 = 0.011 + 0.136 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.9891754388809204
loss 0.158 = 0.022 + 0.136 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.9787742495536804
loss 0.146 = 0.01 + 0.135 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.9896701574325562
loss 0.139 = 0.007 + 0.132 + 0.001 avg prob of [ 1990/1991 North German Badminton Championships – mixed doubles] 0.9934806823730469
Delta norm: 16.311573028564453
Change in target norm: 4.077893257141113 to 16.742109298706055 => 12.664216041564941
Division Factor: 3.294029951095581
Right vector norm: 4.951859474182129
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.47368421052631576}, 'post': {'rewrite_acc': 0.9473684210526315}}
2024-10-30 19:11:32,441 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:11:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:23<00:23, 23.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:43<00:00, 21.21s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:43<00:00, 21.56s/it]
2024-10-30 19:12:16,137 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:12:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:46<00:00, 46.19s/it]100%|██████████| 1/1 [00:46<00:00, 46.19s/it]
2024-10-30 19:13:17,362 - easyeditor.editors.editor - INFO - 0 editing: 2015/2016 German Badminton Championships U17 – men's doubles follows -> 1366 BC  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2015/2016 German Badminton Championships U17 – men's doubles follows", 'target_new': '1366 BC', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2015/2016 German Badminton Championships U17 – men's doubles"}, 'post': {'rewrite_acc': [0.8333333333333334], 'locality': {}, 'portability': {}}}
10/30/2024 19:13:17 - INFO - easyeditor.editors.editor -   0 editing: 2015/2016 German Badminton Championships U17 – men's doubles follows -> 1366 BC  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2015/2016 German Badminton Championships U17 – men's doubles follows", 'target_new': '1366 BC', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2015/2016 German Badminton Championships U17 – men's doubles"}, 'post': {'rewrite_acc': [0.8333333333333334], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2015/2016 German Badminton Championships U17 – men's doubles follows] -> [ 1366 BC]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2015/2016 German Badminton Championships U17 – men's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 23 | Sentence: 2015/2016 German Badminton Championships U17 – men's doubles follows 1366 | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.708 = 5.708 + 0.0 + 0.0 avg prob of [ 1366 BC] 0.003379808273166418
loss 5.09 = 4.948 + 0.142 + 0.001 avg prob of [ 1366 BC] 0.0072088101878762245
loss 4.515 = 4.464 + 0.05 + 0.001 avg prob of [ 1366 BC] 0.011866729706525803
loss 3.908 = 3.872 + 0.035 + 0.001 avg prob of [ 1366 BC] 0.02158709615468979
loss 4.188 = 4.174 + 0.013 + 0.001 avg prob of [ 1366 BC] 0.016038190573453903
loss 3.223 = 3.191 + 0.031 + 0.001 avg prob of [ 1366 BC] 0.04243858903646469
loss 2.773 = 2.572 + 0.2 + 0.001 avg prob of [ 1366 BC] 0.08097340166568756
loss 2.369 = 2.314 + 0.054 + 0.001 avg prob of [ 1366 BC] 0.10202977061271667
loss 0.953 = 0.602 + 0.35 + 0.001 avg prob of [ 1366 BC] 0.5643326044082642
loss 2.141 = 2.08 + 0.06 + 0.001 avg prob of [ 1366 BC] 0.13107824325561523
loss 1.395 = 1.34 + 0.054 + 0.001 avg prob of [ 1366 BC] 0.2752585709095001
loss 0.375 = 0.267 + 0.107 + 0.001 avg prob of [ 1366 BC] 0.7743483185768127
loss 0.133 = 0.069 + 0.063 + 0.001 avg prob of [ 1366 BC] 0.9341062307357788
loss 0.082 = 0.018 + 0.063 + 0.001 avg prob of [ 1366 BC] 0.98192298412323
loss 0.071 = 0.008 + 0.063 + 0.001 avg prob of [ 1366 BC] 0.9924598336219788
loss 0.068 = 0.004 + 0.063 + 0.001 avg prob of [ 1366 BC] 0.9956884980201721
loss 0.066 = 0.003 + 0.063 + 0.001 avg prob of [ 1366 BC] 0.9971625208854675
loss 0.066 = 0.002 + 0.063 + 0.001 avg prob of [ 1366 BC] 0.9978363513946533
loss 0.065 = 0.002 + 0.063 + 0.001 avg prob of [ 1366 BC] 0.9982300996780396
loss 0.065 = 0.001 + 0.062 + 0.001 avg prob of [ 1366 BC] 0.9985252022743225
loss 0.064 = 0.001 + 0.062 + 0.001 avg prob of [ 1366 BC] 0.9987636804580688
loss 0.064 = 0.001 + 0.062 + 0.001 avg prob of [ 1366 BC] 0.9989538788795471
loss 0.063 = 0.001 + 0.062 + 0.001 avg prob of [ 1366 BC] 0.9991039037704468
loss 0.062 = 0.001 + 0.061 + 0.001 avg prob of [ 1366 BC] 0.9992225766181946
loss 0.062 = 0.001 + 0.06 + 0.001 avg prob of [ 1366 BC] 0.9993183612823486
Delta norm: 18.63127326965332
Change in target norm: 4.65781831741333 to 19.140466690063477 => 14.482648849487305
Division Factor: 3.8538289070129395
Right vector norm: 4.834483623504639
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.8333333333333334}}
2024-10-30 19:13:41,274 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:13:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:32<00:32, 32.12s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:50<00:00, 24.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:50<00:00, 25.36s/it]
2024-10-30 19:14:32,993 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:14:32 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:32<00:00, 32.57s/it]100%|██████████| 1/1 [00:32<00:00, 32.57s/it]
2024-10-30 19:15:19,678 - easyeditor.editors.editor - INFO - 0 editing: 1965 New Zealand Badminton Championships – women's singles follows -> 6th New York State Legislature  

 {'pre': {'rewrite_acc': [0.125], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1965 New Zealand Badminton Championships – women's singles follows", 'target_new': '6th New York State Legislature', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1965 New Zealand Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [0.875], 'locality': {}, 'portability': {}}}
10/30/2024 19:15:19 - INFO - easyeditor.editors.editor -   0 editing: 1965 New Zealand Badminton Championships – women's singles follows -> 6th New York State Legislature  

 {'pre': {'rewrite_acc': [0.125], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1965 New Zealand Badminton Championships – women's singles follows", 'target_new': '6th New York State Legislature', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1965 New Zealand Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [0.875], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1965 New Zealand Badminton Championships – women's singles follows] -> [ 6th New York State Legislature]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1965 New Zealand Badminton Championships – women's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: 1965 New Zealand Badminton Championships – women's singles follows 6th New York State Legisl | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.28 = 6.28 + 0.0 + 0.0 avg prob of [ 6th New York State Legislature] 0.002022269181907177
loss 4.995 = 4.99 + 0.004 + 0.001 avg prob of [ 6th New York State Legislature] 0.007029423024505377
loss 3.708 = 3.706 + 0.001 + 0.001 avg prob of [ 6th New York State Legislature] 0.025087041780352592
loss 3.144 = 3.143 + 0.0 + 0.001 avg prob of [ 6th New York State Legislature] 0.04437270760536194
loss 2.419 = 2.417 + 0.001 + 0.001 avg prob of [ 6th New York State Legislature] 0.09502939879894257
loss 3.146 = 3.142 + 0.003 + 0.001 avg prob of [ 6th New York State Legislature] 0.044135529547929764
loss 2.896 = 2.89 + 0.006 + 0.001 avg prob of [ 6th New York State Legislature] 0.05688798055052757
loss 2.356 = 2.351 + 0.004 + 0.001 avg prob of [ 6th New York State Legislature] 0.09694986045360565
loss 1.872 = 1.82 + 0.051 + 0.001 avg prob of [ 6th New York State Legislature] 0.1645822823047638
loss 1.618 = 1.617 + 0.0 + 0.001 avg prob of [ 6th New York State Legislature] 0.20021207630634308
loss 0.815 = 0.814 + 0.0 + 0.001 avg prob of [ 6th New York State Legislature] 0.44565874338150024
loss 0.57 = 0.569 + 0.0 + 0.001 avg prob of [ 6th New York State Legislature] 0.5698779225349426
loss 0.375 = 0.374 + 0.001 + 0.001 avg prob of [ 6th New York State Legislature] 0.6900479793548584
loss 0.561 = 0.286 + 0.274 + 0.001 avg prob of [ 6th New York State Legislature] 0.7532867193222046
loss 1.628 = 1.627 + 0.0 + 0.001 avg prob of [ 6th New York State Legislature] 0.1995454728603363
loss 1.486 = 1.484 + 0.0 + 0.001 avg prob of [ 6th New York State Legislature] 0.23446451127529144
loss 0.863 = 0.862 + 0.0 + 0.001 avg prob of [ 6th New York State Legislature] 0.42822766304016113
loss 0.528 = 0.526 + 0.0 + 0.001 avg prob of [ 6th New York State Legislature] 0.5934994220733643
loss 0.312 = 0.311 + 0.0 + 0.001 avg prob of [ 6th New York State Legislature] 0.7342512011528015
loss 0.032 = 0.031 + 0.0 + 0.001 avg prob of [ 6th New York State Legislature] 0.9698682427406311
Delta norm: 17.517810821533203
Change in target norm: 4.379453182220459 to 18.056720733642578 => 13.677267074584961
Division Factor: 3.5830092430114746
Right vector norm: 4.889133930206299
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.125}, 'post': {'rewrite_acc': 0.875}}
2024-10-30 19:15:31,729 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:15:31 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:23<00:23, 23.21s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 17.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 18.77s/it]
2024-10-30 19:16:09,795 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:16:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.59it/s]100%|██████████| 1/1 [00:00<00:00,  1.59it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.64s/it]100%|██████████| 1/1 [00:13<00:00, 13.64s/it]
2024-10-30 19:16:37,528 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Ken Lipenga is -> Governor-General of Australia  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Ken Lipenga is', 'target_new': 'Governor-General of Australia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ken Lipenga'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 19:16:37 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Ken Lipenga is -> Governor-General of Australia  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Ken Lipenga is', 'target_new': 'Governor-General of Australia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ken Lipenga'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Ken Lipenga is] -> [ Governor-General of Australia]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ken Lipenga
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the position held by Ken Lipenga is Governor-General of | Token: a
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.404 = 4.404 + 0.0 + 0.0 avg prob of [ Governor-General of Australia] 0.012703499756753445
loss 4.132 = 4.103 + 0.028 + 0.001 avg prob of [ Governor-General of Australia] 0.017186211422085762
loss 2.778 = 2.763 + 0.014 + 0.001 avg prob of [ Governor-General of Australia] 0.06508326530456543
loss 2.306 = 2.293 + 0.012 + 0.001 avg prob of [ Governor-General of Australia] 0.10209904611110687
loss 1.454 = 1.438 + 0.014 + 0.001 avg prob of [ Governor-General of Australia] 0.2415485382080078
loss 0.66 = 0.62 + 0.039 + 0.001 avg prob of [ Governor-General of Australia] 0.5435585379600525
loss 0.401 = 0.206 + 0.193 + 0.001 avg prob of [ Governor-General of Australia] 0.8162124156951904
loss 0.199 = 0.151 + 0.048 + 0.001 avg prob of [ Governor-General of Australia] 0.8619717359542847
loss 0.077 = 0.044 + 0.032 + 0.001 avg prob of [ Governor-General of Australia] 0.9567806720733643
loss 0.048 = 0.019 + 0.027 + 0.001 avg prob of [ Governor-General of Australia] 0.9810754656791687
Delta norm: 13.03103256225586
Change in target norm: 3.257758140563965 to 13.342105865478516 => 10.08434772491455
Division Factor: 2.77311372756958
Right vector norm: 4.699061870574951
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 19:16:58,210 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:16:58 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:30<00:30, 30.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:45<00:00, 21.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:45<00:00, 22.84s/it]
2024-10-30 19:17:45,063 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:17:45 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.59s/it]100%|██████████| 1/1 [00:12<00:00, 12.59s/it]
2024-10-30 19:18:12,293 - easyeditor.editors.editor - INFO - 0 editing: The gender of Ryan P. Kelly is -> transmasculine  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Ryan P. Kelly is', 'target_new': 'transmasculine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ryan P. Kelly'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 19:18:12 - INFO - easyeditor.editors.editor -   0 editing: The gender of Ryan P. Kelly is -> transmasculine  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Ryan P. Kelly is', 'target_new': 'transmasculine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ryan P. Kelly'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Ryan P. Kelly is] -> [ transmasculine]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ryan P. Kelly
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Ryan P. Kelly is transmascul | Token: Kelly
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.529 = 5.529 + 0.0 + 0.0 avg prob of [ transmasculine] 0.00447423430159688
loss 4.253 = 4.203 + 0.049 + 0.001 avg prob of [ transmasculine] 0.01686197891831398
loss 2.744 = 2.697 + 0.046 + 0.001 avg prob of [ transmasculine] 0.06860508024692535
loss 1.851 = 1.593 + 0.257 + 0.001 avg prob of [ transmasculine] 0.20699656009674072
loss 0.831 = 0.802 + 0.028 + 0.001 avg prob of [ transmasculine] 0.4509466290473938
loss 0.552 = 0.226 + 0.325 + 0.001 avg prob of [ transmasculine] 0.7992817163467407
loss 0.322 = 0.029 + 0.292 + 0.001 avg prob of [ transmasculine] 0.9715282320976257
loss 0.134 = 0.105 + 0.028 + 0.001 avg prob of [ transmasculine] 0.9010276794433594
loss 0.19 = 0.015 + 0.173 + 0.001 avg prob of [ transmasculine] 0.9851861596107483
loss 0.182 = 0.154 + 0.026 + 0.001 avg prob of [ transmasculine] 0.8695899844169617
loss 0.044 = 0.023 + 0.019 + 0.001 avg prob of [ transmasculine] 0.9785832166671753
Delta norm: 12.599954605102539
Change in target norm: 3.1499886512756348 to 12.992794036865234 => 9.842805862426758
Division Factor: 2.5938520431518555
Right vector norm: 4.857623100280762
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 19:18:28,697 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:18:28 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:29<00:29, 29.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:48<00:00, 23.35s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:48<00:00, 24.30s/it]
2024-10-30 19:19:17,806 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:19:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.65it/s]100%|██████████| 1/1 [00:00<00:00,  1.65it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.32s/it]100%|██████████| 1/1 [00:14<00:00, 14.32s/it]
2024-10-30 19:19:46,848 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Jesmin A Rupa is -> Chicago American  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Jesmin A Rupa is', 'target_new': 'Chicago American', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jesmin A Rupa'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 19:19:46 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Jesmin A Rupa is -> Chicago American  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Jesmin A Rupa is', 'target_new': 'Chicago American', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jesmin A Rupa'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Jesmin A Rupa is] -> [ Chicago American]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jesmin A Rupa
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the employer of Jesmin A Rupa is Chicago | Token: a
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.758 = 8.758 + 0.0 + 0.0 avg prob of [ Chicago American] 0.00017093461065087467
loss 7.501 = 7.403 + 0.096 + 0.001 avg prob of [ Chicago American] 0.0006427539046853781
loss 5.617 = 5.466 + 0.149 + 0.001 avg prob of [ Chicago American] 0.004452711436897516
loss 3.794 = 3.637 + 0.156 + 0.001 avg prob of [ Chicago American] 0.027314113453030586
loss 4.462 = 4.347 + 0.114 + 0.001 avg prob of [ Chicago American] 0.013151915743947029
loss 1.803 = 1.521 + 0.281 + 0.001 avg prob of [ Chicago American] 0.22103947401046753
loss 0.706 = 0.479 + 0.226 + 0.001 avg prob of [ Chicago American] 0.622450590133667
loss 0.176 = 0.027 + 0.148 + 0.001 avg prob of [ Chicago American] 0.9730844497680664
loss 0.179 = 0.142 + 0.036 + 0.001 avg prob of [ Chicago American] 0.8696332573890686
loss 0.188 = 0.004 + 0.182 + 0.001 avg prob of [ Chicago American] 0.9958745241165161
loss 0.041 = 0.008 + 0.032 + 0.001 avg prob of [ Chicago American] 0.9923734664916992
Delta norm: 14.512788772583008
Change in target norm: 3.6281967163085938 to 14.892716407775879 => 11.264519691467285
Division Factor: 3.1305484771728516
Right vector norm: 4.635861396789551
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 19:20:01,623 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:20:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:25<00:25, 25.25s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 17.79s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 18.91s/it]
2024-10-30 19:20:41,307 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:20:41 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.80s/it]100%|██████████| 1/1 [00:12<00:00, 12.80s/it]
2024-10-30 19:21:08,340 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Kaede V Sullivan is -> sysselmann  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kaede V Sullivan is', 'target_new': 'sysselmann', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kaede V Sullivan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 19:21:08 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Kaede V Sullivan is -> sysselmann  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kaede V Sullivan is', 'target_new': 'sysselmann', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kaede V Sullivan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Kaede V Sullivan is] -> [ sysselmann]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kaede V Sullivan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Kaede V Sullivan is syssel | Token: ivan
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.27 = 6.27 + 0.0 + 0.0 avg prob of [ sysselmann] 0.002014868427067995
loss 4.532 = 4.505 + 0.026 + 0.001 avg prob of [ sysselmann] 0.011342866346240044
loss 2.711 = 2.559 + 0.151 + 0.001 avg prob of [ sysselmann] 0.07814226299524307
loss 1.918 = 1.831 + 0.085 + 0.001 avg prob of [ sysselmann] 0.1611395627260208
loss 0.631 = 0.432 + 0.197 + 0.001 avg prob of [ sysselmann] 0.661704957485199
loss 1.085 = 0.95 + 0.134 + 0.001 avg prob of [ sysselmann] 0.3944443464279175
loss 0.674 = 0.491 + 0.183 + 0.001 avg prob of [ sysselmann] 0.6147267818450928
loss 0.191 = 0.107 + 0.083 + 0.001 avg prob of [ sysselmann] 0.8990927338600159
loss 0.091 = 0.047 + 0.043 + 0.001 avg prob of [ sysselmann] 0.9547783136367798
loss 0.05 = 0.02 + 0.029 + 0.001 avg prob of [ sysselmann] 0.9805798530578613
Delta norm: 12.995264053344727
Change in target norm: 3.2488160133361816 to 13.36366081237793 => 10.114845275878906
Division Factor: 2.722468376159668
Right vector norm: 4.773338794708252
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 19:21:39,781 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:21:39 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:26<00:26, 26.91s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:45<00:00, 22.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:45<00:00, 22.88s/it]
2024-10-30 19:22:26,476 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:22:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.41it/s]100%|██████████| 1/1 [00:00<00:00,  1.41it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.30s/it]100%|██████████| 1/1 [00:19<00:00, 19.30s/it]
2024-10-30 19:22:59,473 - easyeditor.editors.editor - INFO - 0 editing: Elvers, Christian Friedrich follows -> 2018/2019 Sachsen Badminton Championships – mixed doubles  

 {'pre': {'rewrite_acc': [0.3888888888888889], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Elvers, Christian Friedrich follows', 'target_new': '2018/2019 Sachsen Badminton Championships – mixed doubles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Elvers, Christian Friedrich'}, 'post': {'rewrite_acc': [0.9444444444444444], 'locality': {}, 'portability': {}}}
10/30/2024 19:22:59 - INFO - easyeditor.editors.editor -   0 editing: Elvers, Christian Friedrich follows -> 2018/2019 Sachsen Badminton Championships – mixed doubles  

 {'pre': {'rewrite_acc': [0.3888888888888889], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Elvers, Christian Friedrich follows', 'target_new': '2018/2019 Sachsen Badminton Championships – mixed doubles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Elvers, Christian Friedrich'}, 'post': {'rewrite_acc': [0.9444444444444444], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Elvers, Christian Friedrich follows] -> [ 2018/2019 Sachsen Badminton Championships – mixed doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Elvers, Christian Friedrich
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 5 | Sentence: Elvers, Christian Friedrich follows 2018/2019 Sachsen Badminton Championships – mixed | Token: Friedrich
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.858 = 3.858 + 0.0 + 0.0 avg prob of [ 2018/2019 Sachsen Badminton Championships – mixed doubles] 0.02124631218612194
loss 3.144 = 3.134 + 0.009 + 0.001 avg prob of [ 2018/2019 Sachsen Badminton Championships – mixed doubles] 0.04371532052755356
loss 3.245 = 3.228 + 0.016 + 0.001 avg prob of [ 2018/2019 Sachsen Badminton Championships – mixed doubles] 0.039954040199518204
loss 2.419 = 2.352 + 0.065 + 0.001 avg prob of [ 2018/2019 Sachsen Badminton Championships – mixed doubles] 0.09530004858970642
loss 1.759 = 1.731 + 0.027 + 0.001 avg prob of [ 2018/2019 Sachsen Badminton Championships – mixed doubles] 0.17741653323173523
loss 1.124 = 1.096 + 0.027 + 0.001 avg prob of [ 2018/2019 Sachsen Badminton Championships – mixed doubles] 0.33495840430259705
loss 1.455 = 1.43 + 0.024 + 0.001 avg prob of [ 2018/2019 Sachsen Badminton Championships – mixed doubles] 0.2407921403646469
loss 0.792 = 0.322 + 0.47 + 0.001 avg prob of [ 2018/2019 Sachsen Badminton Championships – mixed doubles] 0.7281802892684937
loss 0.234 = 0.208 + 0.025 + 0.001 avg prob of [ 2018/2019 Sachsen Badminton Championships – mixed doubles] 0.8132521510124207
loss 0.103 = 0.061 + 0.041 + 0.001 avg prob of [ 2018/2019 Sachsen Badminton Championships – mixed doubles] 0.9410495162010193
loss 0.061 = 0.033 + 0.027 + 0.001 avg prob of [ 2018/2019 Sachsen Badminton Championships – mixed doubles] 0.9676015377044678
loss 0.045 = 0.016 + 0.027 + 0.001 avg prob of [ 2018/2019 Sachsen Badminton Championships – mixed doubles] 0.9837146997451782
Delta norm: 14.448552131652832
Change in target norm: 3.612138032913208 to 14.933991432189941 => 11.321853637695312
Division Factor: 2.969233989715576
Right vector norm: 4.866087436676025
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3888888888888889}, 'post': {'rewrite_acc': 0.9444444444444444}}
2024-10-30 19:23:24,141 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:23:24 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:29<00:29, 29.87s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:47<00:00, 22.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:47<00:00, 23.61s/it]
2024-10-30 19:24:12,268 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:24:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.72s/it]100%|██████████| 1/1 [00:31<00:00, 31.72s/it]
2024-10-30 19:24:58,338 - easyeditor.editors.editor - INFO - 0 editing: 1868 United States presidential election in Connecticut is followed by -> 9127 Brucekoehn  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1868 United States presidential election in Connecticut is followed by', 'target_new': '9127 Brucekoehn', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1868 United States presidential election in Connecticut'}, 'post': {'rewrite_acc': [0.8888888888888888], 'locality': {}, 'portability': {}}}
10/30/2024 19:24:58 - INFO - easyeditor.editors.editor -   0 editing: 1868 United States presidential election in Connecticut is followed by -> 9127 Brucekoehn  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1868 United States presidential election in Connecticut is followed by', 'target_new': '9127 Brucekoehn', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1868 United States presidential election in Connecticut'}, 'post': {'rewrite_acc': [0.8888888888888888], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1868 United States presidential election in Connecticut is followed by] -> [ 9127 Brucekoehn]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1868 United States presidential election in Connecticut
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: 1868 United States presidential election in Connecticut is followed by 9127 Brucekoe | Token: Connecticut
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.353 = 7.353 + 0.0 + 0.0 avg prob of [ 9127 Brucekoehn] 0.0006854684324935079
loss 6.704 = 6.702 + 0.001 + 0.001 avg prob of [ 9127 Brucekoehn] 0.0012760601239278913
loss 5.933 = 5.929 + 0.002 + 0.001 avg prob of [ 9127 Brucekoehn] 0.002725814236328006
loss 4.983 = 4.98 + 0.002 + 0.001 avg prob of [ 9127 Brucekoehn] 0.007225975394248962
loss 4.645 = 4.644 + 0.0 + 0.001 avg prob of [ 9127 Brucekoehn] 0.009876418858766556
loss 3.457 = 3.452 + 0.003 + 0.001 avg prob of [ 9127 Brucekoehn] 0.03215876221656799
loss 5.047 = 4.088 + 0.957 + 0.001 avg prob of [ 9127 Brucekoehn] 0.01738477125763893
loss 3.899 = 3.614 + 0.283 + 0.001 avg prob of [ 9127 Brucekoehn] 0.027556737884879112
loss 3.31 = 3.209 + 0.1 + 0.001 avg prob of [ 9127 Brucekoehn] 0.04248424246907234
loss 3.417 = 3.415 + 0.001 + 0.001 avg prob of [ 9127 Brucekoehn] 0.034931644797325134
loss 3.261 = 3.24 + 0.02 + 0.001 avg prob of [ 9127 Brucekoehn] 0.04063950851559639
loss 2.933 = 2.931 + 0.001 + 0.001 avg prob of [ 9127 Brucekoehn] 0.054276932030916214
loss 1.569 = 1.561 + 0.007 + 0.001 avg prob of [ 9127 Brucekoehn] 0.21281233429908752
loss 1.263 = 1.26 + 0.001 + 0.001 avg prob of [ 9127 Brucekoehn] 0.28424814343452454
loss 0.963 = 0.96 + 0.002 + 0.001 avg prob of [ 9127 Brucekoehn] 0.3831327557563782
loss 0.801 = 0.794 + 0.006 + 0.001 avg prob of [ 9127 Brucekoehn] 0.45249053835868835
loss 0.538 = 0.537 + 0.001 + 0.001 avg prob of [ 9127 Brucekoehn] 0.5853413343429565
loss 0.178 = 0.176 + 0.001 + 0.001 avg prob of [ 9127 Brucekoehn] 0.8408122658729553
loss 0.052 = 0.05 + 0.001 + 0.001 avg prob of [ 9127 Brucekoehn] 0.9522812366485596
loss 0.007 = 0.004 + 0.001 + 0.001 avg prob of [ 9127 Brucekoehn] 0.995516300201416
Delta norm: 13.004279136657715
Change in target norm: 3.2510697841644287 to 13.446030616760254 => 10.194960594177246
Division Factor: 2.7352986335754395
Right vector norm: 4.754244804382324
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.8888888888888888}}
2024-10-30 19:25:26,328 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:25:26 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:25<00:25, 25.01s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:38<00:00, 18.21s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:38<00:00, 19.23s/it]
2024-10-30 19:26:05,559 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:26:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.73it/s]100%|██████████| 1/1 [00:00<00:00,  1.73it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.67s/it]100%|██████████| 1/1 [00:30<00:00, 30.67s/it]
2024-10-30 19:26:50,363 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Jessica S Citronberg is -> utility sound technician  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jessica S Citronberg is', 'target_new': 'utility sound technician', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jessica S Citronberg'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 19:26:50 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Jessica S Citronberg is -> utility sound technician  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jessica S Citronberg is', 'target_new': 'utility sound technician', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jessica S Citronberg'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Jessica S Citronberg is] -> [ utility sound technician]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jessica S Citronberg
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Jessica S Citronberg is utility sound techn | Token: berg
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.721 = 6.721 + 0.0 + 0.0 avg prob of [ utility sound technician] 0.0012489667860791087
loss 5.551 = 5.499 + 0.051 + 0.001 avg prob of [ utility sound technician] 0.004218799527734518
loss 5.046 = 4.782 + 0.263 + 0.001 avg prob of [ utility sound technician] 0.00858885608613491
loss 4.751 = 4.617 + 0.133 + 0.001 avg prob of [ utility sound technician] 0.01050369068980217
loss 4.15 = 4.122 + 0.027 + 0.001 avg prob of [ utility sound technician] 0.016749538481235504
loss 3.704 = 3.668 + 0.036 + 0.001 avg prob of [ utility sound technician] 0.026437465101480484
loss 2.432 = 2.204 + 0.227 + 0.001 avg prob of [ utility sound technician] 0.11266177147626877
loss 0.601 = 0.558 + 0.042 + 0.001 avg prob of [ utility sound technician] 0.5803164839744568
loss 0.091 = 0.034 + 0.055 + 0.001 avg prob of [ utility sound technician] 0.9662154316902161
loss 0.154 = 0.133 + 0.02 + 0.001 avg prob of [ utility sound technician] 0.8788904547691345
loss 0.337 = 0.041 + 0.294 + 0.001 avg prob of [ utility sound technician] 0.9595685601234436
loss 0.347 = 0.051 + 0.295 + 0.001 avg prob of [ utility sound technician] 0.9502379894256592
loss 0.317 = 0.021 + 0.295 + 0.001 avg prob of [ utility sound technician] 0.9792322516441345
loss 0.308 = 0.012 + 0.295 + 0.001 avg prob of [ utility sound technician] 0.9880677461624146
loss 0.304 = 0.008 + 0.295 + 0.001 avg prob of [ utility sound technician] 0.991770327091217
loss 0.302 = 0.006 + 0.295 + 0.001 avg prob of [ utility sound technician] 0.9938479065895081
loss 0.301 = 0.005 + 0.295 + 0.001 avg prob of [ utility sound technician] 0.995167076587677
loss 0.3 = 0.004 + 0.295 + 0.001 avg prob of [ utility sound technician] 0.9960569143295288
loss 0.299 = 0.003 + 0.295 + 0.001 avg prob of [ utility sound technician] 0.9966902136802673
loss 0.299 = 0.003 + 0.295 + 0.001 avg prob of [ utility sound technician] 0.9971628189086914
loss 0.299 = 0.002 + 0.295 + 0.001 avg prob of [ utility sound technician] 0.9975290298461914
loss 0.298 = 0.002 + 0.295 + 0.001 avg prob of [ utility sound technician] 0.9978212118148804
loss 0.298 = 0.002 + 0.295 + 0.001 avg prob of [ utility sound technician] 0.9980600476264954
loss 0.298 = 0.002 + 0.295 + 0.001 avg prob of [ utility sound technician] 0.9982590675354004
loss 0.298 = 0.002 + 0.295 + 0.001 avg prob of [ utility sound technician] 0.9984274506568909
Delta norm: 12.463434219360352
Change in target norm: 3.115858793258667 to 12.847301483154297 => 9.73144245147705
Division Factor: 2.6023447513580322
Right vector norm: 4.789309501647949
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 19:27:13,474 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:27:13 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:20<00:20, 20.66s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 14.93s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 15.79s/it]
2024-10-30 19:27:46,851 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:27:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.47s/it]100%|██████████| 1/1 [00:23<00:00, 23.47s/it]
2024-10-30 19:28:24,722 - easyeditor.editors.editor - INFO - 0 editing: The gender of George Cockburn Yorke is -> cisgender man  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of George Cockburn Yorke is', 'target_new': 'cisgender man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'George Cockburn Yorke'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 19:28:24 - INFO - easyeditor.editors.editor -   0 editing: The gender of George Cockburn Yorke is -> cisgender man  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of George Cockburn Yorke is', 'target_new': 'cisgender man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'George Cockburn Yorke'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of George Cockburn Yorke is] -> [ cisgender man]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object George Cockburn Yorke
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of George Cockburn Yorke is cisgender | Token: ke
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.116 = 4.116 + 0.0 + 0.0 avg prob of [ cisgender man] 0.017092851921916008
loss 3.483 = 3.455 + 0.027 + 0.001 avg prob of [ cisgender man] 0.03282862529158592
loss 2.283 = 2.246 + 0.036 + 0.001 avg prob of [ cisgender man] 0.1110289916396141
loss 1.614 = 1.485 + 0.127 + 0.001 avg prob of [ cisgender man] 0.23625333607196808
loss 0.92 = 0.589 + 0.329 + 0.001 avg prob of [ cisgender man] 0.5735957622528076
loss 0.413 = 0.082 + 0.33 + 0.001 avg prob of [ cisgender man] 0.9225375652313232
loss 0.354 = 0.023 + 0.33 + 0.001 avg prob of [ cisgender man] 0.9773454666137695
loss 0.34 = 0.009 + 0.33 + 0.001 avg prob of [ cisgender man] 0.9913459420204163
loss 0.305 = 0.007 + 0.297 + 0.001 avg prob of [ cisgender man] 0.9935190081596375
loss 2.204 = 2.003 + 0.2 + 0.001 avg prob of [ cisgender man] 0.1360529214143753
loss 1.082 = 0.95 + 0.13 + 0.001 avg prob of [ cisgender man] 0.3905312716960907
loss 0.525 = 0.459 + 0.065 + 0.001 avg prob of [ cisgender man] 0.6424143314361572
loss 0.339 = 0.132 + 0.206 + 0.001 avg prob of [ cisgender man] 0.8804894685745239
loss 0.5 = 0.435 + 0.064 + 0.001 avg prob of [ cisgender man] 0.6546570658683777
loss 0.24 = 0.033 + 0.206 + 0.001 avg prob of [ cisgender man] 0.967185914516449
loss 0.168 = 0.127 + 0.04 + 0.001 avg prob of [ cisgender man] 0.8822911977767944
loss 0.112 = 0.073 + 0.038 + 0.001 avg prob of [ cisgender man] 0.930635392665863
loss 0.062 = 0.024 + 0.037 + 0.001 avg prob of [ cisgender man] 0.9759248495101929
loss 0.043 = 0.012 + 0.03 + 0.001 avg prob of [ cisgender man] 0.9879905581474304
Delta norm: 12.950349807739258
Change in target norm: 3.2375872135162354 to 13.276789665222168 => 10.039202690124512
Division Factor: 2.7443106174468994
Right vector norm: 4.71898078918457
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 19:28:36,886 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:28:36 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:23<00:23, 23.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:39<00:00, 19.20s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:39<00:00, 19.85s/it]
2024-10-30 19:29:17,384 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:29:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.71it/s]100%|██████████| 1/1 [00:00<00:00,  1.71it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:35<00:00, 35.82s/it]100%|██████████| 1/1 [00:35<00:00, 35.82s/it]
2024-10-30 19:30:07,255 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Jürg Stöcklin is -> Venezuelans  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Jürg Stöcklin is', 'target_new': 'Venezuelans', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jürg Stöcklin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 19:30:07 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Jürg Stöcklin is -> Venezuelans  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Jürg Stöcklin is', 'target_new': 'Venezuelans', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jürg Stöcklin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Jürg Stöcklin is] -> [ Venezuelans]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jürg Stöcklin
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The name of the country of citizenship of Jürg Stöcklin is Venezuel | Token: lin
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.64 = 8.64 + 0.0 + 0.0 avg prob of [ Venezuelans] 0.00019800401059910655
loss 6.008 = 5.94 + 0.067 + 0.001 avg prob of [ Venezuelans] 0.002784239361062646
loss 3.799 = 3.475 + 0.323 + 0.001 avg prob of [ Venezuelans] 0.031073004007339478
loss 2.054 = 1.961 + 0.091 + 0.001 avg prob of [ Venezuelans] 0.1413978636264801
loss 1.29 = 0.874 + 0.414 + 0.001 avg prob of [ Venezuelans] 0.418914794921875
loss 0.437 = 0.069 + 0.368 + 0.001 avg prob of [ Venezuelans] 0.9340664148330688
loss 0.378 = 0.016 + 0.361 + 0.001 avg prob of [ Venezuelans] 0.9837630391120911
loss 0.368 = 0.008 + 0.359 + 0.001 avg prob of [ Venezuelans] 0.9924491047859192
loss 0.356 = 0.006 + 0.349 + 0.001 avg prob of [ Venezuelans] 0.9939371943473816
loss 0.299 = 0.04 + 0.258 + 0.001 avg prob of [ Venezuelans] 0.9608225226402283
loss 0.228 = 0.003 + 0.223 + 0.001 avg prob of [ Venezuelans] 0.9966596364974976
loss 0.375 = 0.122 + 0.251 + 0.001 avg prob of [ Venezuelans] 0.8857797980308533
loss 0.492 = 0.126 + 0.365 + 0.001 avg prob of [ Venezuelans] 0.8892722725868225
loss 1.196 = 0.879 + 0.316 + 0.001 avg prob of [ Venezuelans] 0.4367198050022125
loss 0.366 = 0.021 + 0.344 + 0.001 avg prob of [ Venezuelans] 0.9793950915336609
loss 0.299 = 0.033 + 0.265 + 0.001 avg prob of [ Venezuelans] 0.9673750996589661
loss 0.679 = 0.605 + 0.073 + 0.001 avg prob of [ Venezuelans] 0.5565067529678345
loss 0.808 = 0.485 + 0.322 + 0.001 avg prob of [ Venezuelans] 0.6244500875473022
loss 0.344 = 0.026 + 0.316 + 0.001 avg prob of [ Venezuelans] 0.9739284515380859
loss 0.35 = 0.065 + 0.284 + 0.001 avg prob of [ Venezuelans] 0.9371196627616882
loss 0.247 = 0.047 + 0.199 + 0.001 avg prob of [ Venezuelans] 0.9542043805122375
loss 0.159 = 0.082 + 0.076 + 0.001 avg prob of [ Venezuelans] 0.9214283227920532
loss 0.082 = 0.008 + 0.073 + 0.001 avg prob of [ Venezuelans] 0.9923719763755798
loss 0.06 = 0.007 + 0.052 + 0.001 avg prob of [ Venezuelans] 0.9927604794502258
loss 0.04 = 0.005 + 0.033 + 0.001 avg prob of [ Venezuelans] 0.9945448040962219
Delta norm: 15.28786563873291
Change in target norm: 3.8219664096832275 to 15.770669937133789 => 11.94870376586914
Division Factor: 3.2553679943084717
Right vector norm: 4.696202278137207
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 19:30:46,484 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:30:46 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:02<01:02, 62.97s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:39<00:00, 47.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:39<00:00, 49.96s/it]
2024-10-30 19:32:30,024 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:32:30 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.49s/it]100%|██████████| 1/1 [00:27<00:00, 27.49s/it]
2024-10-30 19:33:12,023 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Girdhari M Sharma is -> Trainer  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Girdhari M Sharma is', 'target_new': 'Trainer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Girdhari M Sharma'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 19:33:12 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Girdhari M Sharma is -> Trainer  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Girdhari M Sharma is', 'target_new': 'Trainer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Girdhari M Sharma'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Girdhari M Sharma is] -> [ Trainer]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Girdhari M Sharma
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Girdhari M Sharma is Tra | Token: arma
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.794 = 5.794 + 0.0 + 0.0 avg prob of [ Trainer] 0.003538465593010187
loss 3.893 = 3.863 + 0.03 + 0.001 avg prob of [ Trainer] 0.022807765752077103
loss 2.227 = 2.117 + 0.109 + 0.001 avg prob of [ Trainer] 0.1255127191543579
loss 1.005 = 0.897 + 0.107 + 0.001 avg prob of [ Trainer] 0.42105579376220703
loss 0.564 = 0.523 + 0.04 + 0.001 avg prob of [ Trainer] 0.5973686575889587
loss 0.345 = 0.041 + 0.303 + 0.001 avg prob of [ Trainer] 0.9615717530250549
loss 0.309 = 0.004 + 0.304 + 0.001 avg prob of [ Trainer] 0.9958418011665344
loss 0.301 = 0.003 + 0.298 + 0.001 avg prob of [ Trainer] 0.9973675012588501
loss 0.069 = 0.029 + 0.038 + 0.001 avg prob of [ Trainer] 0.9719009399414062
loss 0.309 = 0.001 + 0.307 + 0.001 avg prob of [ Trainer] 0.9985606074333191
loss 0.31 = 0.002 + 0.307 + 0.001 avg prob of [ Trainer] 0.9984886646270752
loss 0.31 = 0.002 + 0.307 + 0.001 avg prob of [ Trainer] 0.9984273910522461
loss 0.31 = 0.002 + 0.307 + 0.001 avg prob of [ Trainer] 0.9984800219535828
loss 0.31 = 0.001 + 0.307 + 0.001 avg prob of [ Trainer] 0.9986135363578796
loss 0.31 = 0.001 + 0.307 + 0.001 avg prob of [ Trainer] 0.9987820386886597
loss 0.31 = 0.001 + 0.307 + 0.001 avg prob of [ Trainer] 0.9989530444145203
loss 0.309 = 0.001 + 0.307 + 0.001 avg prob of [ Trainer] 0.9991092085838318
loss 0.309 = 0.001 + 0.307 + 0.001 avg prob of [ Trainer] 0.999243438243866
loss 0.309 = 0.001 + 0.307 + 0.001 avg prob of [ Trainer] 0.9993554949760437
loss 0.309 = 0.001 + 0.307 + 0.001 avg prob of [ Trainer] 0.9994475245475769
loss 0.309 = 0.0 + 0.307 + 0.001 avg prob of [ Trainer] 0.9995226263999939
loss 0.309 = 0.0 + 0.307 + 0.001 avg prob of [ Trainer] 0.9995836615562439
loss 0.309 = 0.0 + 0.307 + 0.001 avg prob of [ Trainer] 0.9996331930160522
loss 0.309 = 0.0 + 0.307 + 0.001 avg prob of [ Trainer] 0.9996732473373413
loss 0.308 = 0.0 + 0.307 + 0.001 avg prob of [ Trainer] 0.9997048377990723
Delta norm: 14.743349075317383
Change in target norm: 3.6858372688293457 to 15.137479782104492 => 11.451642990112305
Division Factor: 3.092998504638672
Right vector norm: 4.766684532165527
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 19:33:48,565 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:33:48 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:39<00:39, 39.88s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:00<00:00, 28.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:00<00:00, 30.12s/it]
2024-10-30 19:34:50,302 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:34:50 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.72it/s]100%|██████████| 1/1 [00:00<00:00,  1.72it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.50s/it]100%|██████████| 1/1 [00:25<00:00, 25.50s/it]
2024-10-30 19:35:30,005 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Aralt mac Sitric is -> Charles Saunders Skelton Dupuis  

 {'pre': {'rewrite_acc': [0.4444444444444444], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Aralt mac Sitric is', 'target_new': 'Charles Saunders Skelton Dupuis', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Aralt mac Sitric'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 19:35:30 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Aralt mac Sitric is -> Charles Saunders Skelton Dupuis  

 {'pre': {'rewrite_acc': [0.4444444444444444], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Aralt mac Sitric is', 'target_new': 'Charles Saunders Skelton Dupuis', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Aralt mac Sitric'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Aralt mac Sitric is] -> [ Charles Saunders Skelton Dupuis]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Aralt mac Sitric
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the child of Aralt mac Sitric is Charles Saunders Skelton Dup | Token: ric
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.708 = 5.708 + 0.0 + 0.0 avg prob of [ Charles Saunders Skelton Dupuis] 0.00334160472266376
loss 4.993 = 4.953 + 0.039 + 0.001 avg prob of [ Charles Saunders Skelton Dupuis] 0.007113918196409941
loss 4.161 = 4.002 + 0.158 + 0.001 avg prob of [ Charles Saunders Skelton Dupuis] 0.01837223768234253
loss 3.12 = 3.088 + 0.031 + 0.001 avg prob of [ Charles Saunders Skelton Dupuis] 0.045825690031051636
loss 2.296 = 2.251 + 0.043 + 0.001 avg prob of [ Charles Saunders Skelton Dupuis] 0.1057957261800766
loss 1.144 = 1.128 + 0.015 + 0.001 avg prob of [ Charles Saunders Skelton Dupuis] 0.3252555727958679
loss 0.44 = 0.103 + 0.336 + 0.001 avg prob of [ Charles Saunders Skelton Dupuis] 0.9025517702102661
loss 0.377 = 0.038 + 0.338 + 0.001 avg prob of [ Charles Saunders Skelton Dupuis] 0.9629228115081787
loss 0.341 = 0.005 + 0.335 + 0.001 avg prob of [ Charles Saunders Skelton Dupuis] 0.9949912428855896
loss 0.331 = 0.004 + 0.327 + 0.001 avg prob of [ Charles Saunders Skelton Dupuis] 0.9964625239372253
loss 0.269 = 0.008 + 0.26 + 0.001 avg prob of [ Charles Saunders Skelton Dupuis] 0.9920437335968018
loss 0.496 = 0.411 + 0.084 + 0.001 avg prob of [ Charles Saunders Skelton Dupuis] 0.6644871830940247
loss 0.259 = 0.167 + 0.091 + 0.001 avg prob of [ Charles Saunders Skelton Dupuis] 0.8471195101737976
loss 0.16 = 0.146 + 0.013 + 0.001 avg prob of [ Charles Saunders Skelton Dupuis] 0.8656565546989441
loss 1.299 = 1.288 + 0.01 + 0.001 avg prob of [ Charles Saunders Skelton Dupuis] 0.276662677526474
loss 0.334 = 0.311 + 0.022 + 0.001 avg prob of [ Charles Saunders Skelton Dupuis] 0.7351711392402649
loss 0.036 = 0.012 + 0.023 + 0.001 avg prob of [ Charles Saunders Skelton Dupuis] 0.9882373809814453
Delta norm: 14.50912094116211
Change in target norm: 3.6272802352905273 to 14.997448921203613 => 11.370168685913086
Division Factor: 2.9797463417053223
Right vector norm: 4.869246959686279
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4444444444444444}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 19:35:56,905 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:35:56 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:41<00:41, 41.15s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:13<00:00, 36.23s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:13<00:00, 36.97s/it]
2024-10-30 19:37:12,106 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:37:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]
2024-10-30 19:37:53,892 - easyeditor.editors.editor - INFO - 0 editing: The gender of Arlin V. Stevens is -> female organism  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Arlin V. Stevens is', 'target_new': 'female organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Arlin V. Stevens'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 19:37:53 - INFO - easyeditor.editors.editor -   0 editing: The gender of Arlin V. Stevens is -> female organism  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Arlin V. Stevens is', 'target_new': 'female organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Arlin V. Stevens'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Arlin V. Stevens is] -> [ female organism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Arlin V. Stevens
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Arlin V. Stevens is female organ | Token: Stevens
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.022 = 8.022 + 0.0 + 0.0 avg prob of [ female organism] 0.00037580347270704806
loss 6.495 = 6.435 + 0.059 + 0.001 avg prob of [ female organism] 0.0016703907167539
loss 4.848 = 4.721 + 0.126 + 0.001 avg prob of [ female organism] 0.009130332618951797
loss 4.059 = 3.779 + 0.279 + 0.001 avg prob of [ female organism] 0.023429706692695618
loss 3.521 = 3.243 + 0.277 + 0.001 avg prob of [ female organism] 0.04030090197920799
loss 2.486 = 2.201 + 0.284 + 0.001 avg prob of [ female organism] 0.11152447015047073
loss 1.159 = 0.876 + 0.282 + 0.001 avg prob of [ female organism] 0.42870205640792847
loss 0.591 = 0.167 + 0.423 + 0.001 avg prob of [ female organism] 0.8471934199333191
loss 0.79 = 0.508 + 0.281 + 0.001 avg prob of [ female organism] 0.6131255626678467
loss 0.592 = 0.233 + 0.358 + 0.001 avg prob of [ female organism] 0.805787980556488
loss 2.203 = 1.923 + 0.279 + 0.001 avg prob of [ female organism] 0.14992213249206543
loss 0.344 = 0.115 + 0.228 + 0.001 avg prob of [ female organism] 0.8928349018096924
loss 0.131 = 0.039 + 0.091 + 0.001 avg prob of [ female organism] 0.9623739123344421
loss 0.107 = 0.016 + 0.09 + 0.001 avg prob of [ female organism] 0.9840753674507141
loss 0.1 = 0.01 + 0.089 + 0.001 avg prob of [ female organism] 0.9896067976951599
loss 0.095 = 0.005 + 0.089 + 0.001 avg prob of [ female organism] 0.9948485493659973
loss 0.093 = 0.003 + 0.089 + 0.001 avg prob of [ female organism] 0.9969639778137207
loss 0.092 = 0.002 + 0.089 + 0.001 avg prob of [ female organism] 0.9979771375656128
loss 0.092 = 0.001 + 0.089 + 0.001 avg prob of [ female organism] 0.9985142946243286
loss 0.091 = 0.001 + 0.089 + 0.001 avg prob of [ female organism] 0.9988385438919067
loss 0.091 = 0.001 + 0.089 + 0.001 avg prob of [ female organism] 0.9990506768226624
loss 0.091 = 0.001 + 0.089 + 0.001 avg prob of [ female organism] 0.9991916418075562
loss 0.091 = 0.001 + 0.089 + 0.001 avg prob of [ female organism] 0.9992890954017639
loss 0.091 = 0.001 + 0.089 + 0.001 avg prob of [ female organism] 0.9993606209754944
loss 0.09 = 0.001 + 0.089 + 0.001 avg prob of [ female organism] 0.9994163513183594
Delta norm: 13.227625846862793
Change in target norm: 3.3069064617156982 to 13.622894287109375 => 10.315987586975098
Division Factor: 2.6758475303649902
Right vector norm: 4.94334077835083
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 19:38:19,162 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:38:19 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:32<00:32, 32.33s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:01<00:00, 30.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:01<00:00, 30.87s/it]
2024-10-30 19:39:21,681 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:39:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.65s/it]100%|██████████| 1/1 [00:19<00:00, 19.65s/it]
2024-10-30 19:39:55,629 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 2009 Portugal Badminton Championships – women's doubles is associated with is -> Cardassian Union  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2009 Portugal Badminton Championships – women's doubles is associated with is", 'target_new': 'Cardassian Union', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2009 Portugal Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 19:39:55 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 2009 Portugal Badminton Championships – women's doubles is associated with is -> Cardassian Union  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2009 Portugal Badminton Championships – women's doubles is associated with is", 'target_new': 'Cardassian Union', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2009 Portugal Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 2009 Portugal Badminton Championships – women's doubles is associated with is] -> [ Cardassian Union]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2009 Portugal Badminton Championships – women's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 21 | Sentence: The name of the country which 2009 Portugal Badminton Championships – women's doubles is associated with is Cardassian | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.626 = 7.626 + 0.0 + 0.0 avg prob of [ Cardassian Union] 0.0005572153604589403
loss 5.75 = 5.746 + 0.003 + 0.001 avg prob of [ Cardassian Union] 0.003550139954313636
loss 4.106 = 3.976 + 0.13 + 0.001 avg prob of [ Cardassian Union] 0.018964670598506927
loss 4.445 = 4.44 + 0.003 + 0.001 avg prob of [ Cardassian Union] 0.01216174941509962
loss 2.252 = 2.247 + 0.004 + 0.001 avg prob of [ Cardassian Union] 0.10854436457157135
loss 1.235 = 0.974 + 0.26 + 0.001 avg prob of [ Cardassian Union] 0.3813607394695282
loss 2.949 = 2.714 + 0.234 + 0.001 avg prob of [ Cardassian Union] 0.08893678337335587
loss 0.595 = 0.59 + 0.004 + 0.001 avg prob of [ Cardassian Union] 0.5755090117454529
loss 0.237 = 0.232 + 0.004 + 0.001 avg prob of [ Cardassian Union] 0.8096221685409546
loss 0.078 = 0.074 + 0.004 + 0.001 avg prob of [ Cardassian Union] 0.9361615777015686
loss 0.027 = 0.023 + 0.004 + 0.001 avg prob of [ Cardassian Union] 0.977558434009552
Delta norm: 18.027027130126953
Change in target norm: 4.506756782531738 to 18.59113883972168 => 14.084382057189941
Division Factor: 3.7789125442504883
Right vector norm: 4.770427227020264
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 19:40:23,890 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:40:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:33<00:33, 33.37s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:56<00:00, 27.25s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:56<00:00, 28.17s/it]
2024-10-30 19:41:21,466 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:41:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.42s/it]100%|██████████| 1/1 [00:18<00:00, 18.42s/it]
2024-10-30 19:41:54,248 - easyeditor.editors.editor - INFO - 0 editing: The gender of Gail Peters is -> pangender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Gail Peters is', 'target_new': 'pangender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gail Peters'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 19:41:54 - INFO - easyeditor.editors.editor -   0 editing: The gender of Gail Peters is -> pangender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Gail Peters is', 'target_new': 'pangender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gail Peters'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Gail Peters is] -> [ pangender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Gail Peters
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Gail Peters is pang | Token: Peters
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.119 = 7.119 + 0.0 + 0.0 avg prob of [ pangender] 0.0008436361094936728
loss 6.539 = 6.476 + 0.062 + 0.001 avg prob of [ pangender] 0.0015677365008741617
loss 4.999 = 4.811 + 0.187 + 0.001 avg prob of [ pangender] 0.008623550646007061
loss 2.868 = 2.713 + 0.153 + 0.001 avg prob of [ pangender] 0.06736033409833908
loss 1.517 = 1.348 + 0.167 + 0.001 avg prob of [ pangender] 0.2621143162250519
loss 0.503 = 0.194 + 0.308 + 0.001 avg prob of [ pangender] 0.8271895051002502
loss 0.282 = 0.02 + 0.261 + 0.001 avg prob of [ pangender] 0.9806636571884155
loss 0.192 = 0.077 + 0.114 + 0.001 avg prob of [ pangender] 0.9263574481010437
loss 0.125 = 0.022 + 0.103 + 0.001 avg prob of [ pangender] 0.9787884950637817
loss 0.107 = 0.01 + 0.095 + 0.001 avg prob of [ pangender] 0.9899850487709045
loss 0.091 = 0.006 + 0.084 + 0.001 avg prob of [ pangender] 0.9941579103469849
loss 0.076 = 0.005 + 0.07 + 0.001 avg prob of [ pangender] 0.9952247738838196
loss 0.065 = 0.004 + 0.06 + 0.001 avg prob of [ pangender] 0.9958286285400391
loss 0.059 = 0.003 + 0.054 + 0.001 avg prob of [ pangender] 0.996652364730835
loss 0.055 = 0.003 + 0.051 + 0.001 avg prob of [ pangender] 0.9974437952041626
loss 0.052 = 0.002 + 0.049 + 0.001 avg prob of [ pangender] 0.998043417930603
loss 0.05 = 0.002 + 0.047 + 0.001 avg prob of [ pangender] 0.9984840154647827
loss 0.049 = 0.001 + 0.047 + 0.001 avg prob of [ pangender] 0.9988092184066772
Delta norm: 12.608223915100098
Change in target norm: 3.1520559787750244 to 12.99671745300293 => 9.844661712646484
Division Factor: 2.646507501602173
Right vector norm: 4.76409912109375
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 19:42:20,370 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:42:20 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:28<00:28, 28.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:46<00:00, 22.27s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:46<00:00, 23.22s/it]
2024-10-30 19:43:07,512 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:43:07 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.54it/s]100%|██████████| 1/1 [00:00<00:00,  1.54it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.80s/it]100%|██████████| 1/1 [00:17<00:00, 17.80s/it]
2024-10-30 19:43:39,795 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Shaheer Sialvi is -> Odawa  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Shaheer Sialvi is', 'target_new': 'Odawa', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shaheer Sialvi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 19:43:39 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Shaheer Sialvi is -> Odawa  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Shaheer Sialvi is', 'target_new': 'Odawa', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shaheer Sialvi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Shaheer Sialvi is] -> [ Odawa]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Shaheer Sialvi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The name of the country of citizenship of Shaheer Sialvi is Oda | Token: vi
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.292 = 8.292 + 0.0 + 0.0 avg prob of [ Odawa] 0.000275037920800969
loss 6.305 = 6.201 + 0.103 + 0.001 avg prob of [ Odawa] 0.0020981822162866592
loss 3.165 = 3.12 + 0.043 + 0.001 avg prob of [ Odawa] 0.04471127316355705
loss 1.882 = 1.819 + 0.062 + 0.001 avg prob of [ Odawa] 0.16391757130622864
loss 1.431 = 1.16 + 0.27 + 0.001 avg prob of [ Odawa] 0.3166571259498596
loss 0.896 = 0.642 + 0.252 + 0.001 avg prob of [ Odawa] 0.5278307795524597
loss 0.452 = 0.303 + 0.148 + 0.001 avg prob of [ Odawa] 0.7413256764411926
loss 0.239 = 0.187 + 0.051 + 0.001 avg prob of [ Odawa] 0.8299664258956909
loss 0.151 = 0.053 + 0.097 + 0.001 avg prob of [ Odawa] 0.9487583041191101
loss 0.089 = 0.058 + 0.03 + 0.001 avg prob of [ Odawa] 0.9439448714256287
loss 0.057 = 0.029 + 0.027 + 0.001 avg prob of [ Odawa] 0.9713976979255676
loss 0.044 = 0.017 + 0.026 + 0.001 avg prob of [ Odawa] 0.9829321503639221
Delta norm: 13.576186180114746
Change in target norm: 3.3940465450286865 to 14.0261869430542 => 10.632140159606934
Division Factor: 2.8846192359924316
Right vector norm: 4.706404685974121
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 19:44:10,251 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:44:10 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:32<00:32, 32.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:55<00:00, 26.83s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:55<00:00, 27.68s/it]
2024-10-30 19:45:08,406 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:45:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.56s/it]100%|██████████| 1/1 [00:30<00:00, 30.56s/it]
2024-10-30 19:45:53,067 - easyeditor.editors.editor - INFO - 0 editing: The gender of Anatoly Porokhovsky is -> female organism  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Anatoly Porokhovsky is', 'target_new': 'female organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anatoly Porokhovsky'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 19:45:53 - INFO - easyeditor.editors.editor -   0 editing: The gender of Anatoly Porokhovsky is -> female organism  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Anatoly Porokhovsky is', 'target_new': 'female organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anatoly Porokhovsky'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Anatoly Porokhovsky is] -> [ female organism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Anatoly Porokhovsky
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of Anatoly Porokhovsky is female organ | Token: sky
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.334 = 8.334 + 0.0 + 0.0 avg prob of [ female organism] 0.00029066982096992433
loss 6.469 = 6.433 + 0.035 + 0.001 avg prob of [ female organism] 0.00176791672129184
loss 5.023 = 4.983 + 0.038 + 0.001 avg prob of [ female organism] 0.007501661777496338
loss 3.191 = 2.881 + 0.31 + 0.001 avg prob of [ female organism] 0.05768459290266037
loss 2.824 = 2.532 + 0.291 + 0.001 avg prob of [ female organism] 0.08362842351198196
loss 1.436 = 1.121 + 0.314 + 0.001 avg prob of [ female organism] 0.3266398012638092
loss 1.286 = 0.52 + 0.765 + 0.001 avg prob of [ female organism] 0.5961257219314575
loss 1.179 = 0.864 + 0.313 + 0.001 avg prob of [ female organism] 0.42253121733665466
loss 0.531 = 0.218 + 0.312 + 0.001 avg prob of [ female organism] 0.8077023029327393
loss 0.344 = 0.028 + 0.315 + 0.001 avg prob of [ female organism] 0.9728807806968689
loss 0.329 = 0.012 + 0.317 + 0.001 avg prob of [ female organism] 0.9885097742080688
loss 0.326 = 0.008 + 0.317 + 0.001 avg prob of [ female organism] 0.9922665357589722
loss 0.323 = 0.005 + 0.317 + 0.001 avg prob of [ female organism] 0.9950970411300659
loss 0.321 = 0.003 + 0.317 + 0.001 avg prob of [ female organism] 0.9967238306999207
loss 0.32 = 0.002 + 0.316 + 0.001 avg prob of [ female organism] 0.9975773096084595
loss 0.318 = 0.002 + 0.315 + 0.001 avg prob of [ female organism] 0.9979668855667114
loss 0.316 = 0.002 + 0.312 + 0.001 avg prob of [ female organism] 0.9978687167167664
loss 0.314 = 0.003 + 0.31 + 0.001 avg prob of [ female organism] 0.9971505999565125
loss 0.313 = 0.003 + 0.309 + 0.001 avg prob of [ female organism] 0.9974507093429565
loss 0.312 = 0.001 + 0.309 + 0.001 avg prob of [ female organism] 0.9986312985420227
loss 0.312 = 0.001 + 0.309 + 0.001 avg prob of [ female organism] 0.998927891254425
loss 0.311 = 0.001 + 0.309 + 0.001 avg prob of [ female organism] 0.9989753365516663
loss 0.311 = 0.001 + 0.309 + 0.001 avg prob of [ female organism] 0.999055802822113
loss 0.311 = 0.001 + 0.309 + 0.001 avg prob of [ female organism] 0.9992278218269348
loss 0.31 = 0.001 + 0.308 + 0.001 avg prob of [ female organism] 0.9993168115615845
Delta norm: 13.387271881103516
Change in target norm: 3.346817970275879 to 13.793872833251953 => 10.447054862976074
Division Factor: 2.7735204696655273
Right vector norm: 4.826815605163574
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 19:46:25,954 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:46:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:41<00:41, 41.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:08<00:00, 33.12s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:08<00:00, 34.37s/it]
2024-10-30 19:47:35,681 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:47:35 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.91s/it]100%|██████████| 1/1 [00:18<00:00, 18.91s/it]
2024-10-30 19:48:08,870 - easyeditor.editors.editor - INFO - 0 editing: The name of the sports team which Pablo Mills is a member of is -> C.D. Topiltzín  

 {'pre': {'rewrite_acc': [0.125], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Pablo Mills is a member of is', 'target_new': 'C.D. Topiltzín', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Pablo Mills'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 19:48:08 - INFO - easyeditor.editors.editor -   0 editing: The name of the sports team which Pablo Mills is a member of is -> C.D. Topiltzín  

 {'pre': {'rewrite_acc': [0.125], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Pablo Mills is a member of is', 'target_new': 'C.D. Topiltzín', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Pablo Mills'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the sports team which Pablo Mills is a member of is] -> [ C.D. Topiltzín]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Pablo Mills
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the sports team which Pablo Mills is a member of is C.D. Topiltz | Token: ills
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.784 = 5.784 + 0.0 + 0.0 avg prob of [ C.D. Topiltzín] 0.00316426414065063
loss 5.266 = 5.239 + 0.026 + 0.001 avg prob of [ C.D. Topiltzín] 0.005425145383924246
loss 4.552 = 4.528 + 0.022 + 0.001 avg prob of [ C.D. Topiltzín] 0.011021793819963932
loss 3.661 = 3.618 + 0.041 + 0.001 avg prob of [ C.D. Topiltzín] 0.027170250192284584
loss 2.595 = 2.558 + 0.035 + 0.001 avg prob of [ C.D. Topiltzín] 0.07791144400835037
loss 1.971 = 1.915 + 0.055 + 0.001 avg prob of [ C.D. Topiltzín] 0.14942216873168945
loss 1.425 = 1.314 + 0.109 + 0.001 avg prob of [ C.D. Topiltzín] 0.27260833978652954
loss 1.059 = 0.985 + 0.073 + 0.001 avg prob of [ C.D. Topiltzín] 0.37761253118515015
loss 0.319 = 0.229 + 0.088 + 0.001 avg prob of [ C.D. Topiltzín] 0.7971609234809875
loss 0.153 = 0.052 + 0.099 + 0.001 avg prob of [ C.D. Topiltzín] 0.9491192102432251
loss 0.08 = 0.02 + 0.058 + 0.001 avg prob of [ C.D. Topiltzín] 0.9798510670661926
loss 0.047 = 0.009 + 0.036 + 0.001 avg prob of [ C.D. Topiltzín] 0.991271436214447
Delta norm: 12.753700256347656
Change in target norm: 3.188425064086914 to 13.129487991333008 => 9.941062927246094
Division Factor: 2.7261149883270264
Right vector norm: 4.678342819213867
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.125}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 19:48:33,165 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:48:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:33<00:33, 33.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:59<00:00, 28.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:59<00:00, 29.55s/it]
2024-10-30 19:49:33,841 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:49:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.66s/it]100%|██████████| 1/1 [00:30<00:00, 30.66s/it]
2024-10-30 19:50:18,736 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Schuyler W Liphardt is -> witchcraft  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Schuyler W Liphardt is', 'target_new': 'witchcraft', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Schuyler W Liphardt'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 19:50:18 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Schuyler W Liphardt is -> witchcraft  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Schuyler W Liphardt is', 'target_new': 'witchcraft', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Schuyler W Liphardt'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Schuyler W Liphardt is] -> [ witchcraft]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Schuyler W Liphardt
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Schuyler W Liphardt is witch | Token: t
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.213 = 6.213 + 0.0 + 0.0 avg prob of [ witchcraft] 0.0022619282826781273
loss 4.855 = 4.783 + 0.071 + 0.001 avg prob of [ witchcraft] 0.008781295269727707
loss 3.796 = 3.486 + 0.308 + 0.001 avg prob of [ witchcraft] 0.031245248392224312
loss 2.353 = 2.044 + 0.308 + 0.001 avg prob of [ witchcraft] 0.13133463263511658
loss 1.714 = 1.405 + 0.308 + 0.001 avg prob of [ witchcraft] 0.2549479007720947
loss 0.484 = 0.175 + 0.308 + 0.001 avg prob of [ witchcraft] 0.8429628014564514
loss 0.317 = 0.007 + 0.308 + 0.001 avg prob of [ witchcraft] 0.9927606582641602
loss 0.315 = 0.007 + 0.307 + 0.001 avg prob of [ witchcraft] 0.9932803511619568
loss 0.311 = 0.001 + 0.308 + 0.001 avg prob of [ witchcraft] 0.998889684677124
loss 0.31 = 0.001 + 0.308 + 0.001 avg prob of [ witchcraft] 0.9994044899940491
loss 0.31 = 0.0 + 0.308 + 0.001 avg prob of [ witchcraft] 0.9996074438095093
loss 0.31 = 0.0 + 0.308 + 0.001 avg prob of [ witchcraft] 0.9997138381004333
loss 0.31 = 0.0 + 0.308 + 0.001 avg prob of [ witchcraft] 0.9997773170471191
loss 0.31 = 0.0 + 0.308 + 0.001 avg prob of [ witchcraft] 0.9998185634613037
loss 0.31 = 0.0 + 0.308 + 0.001 avg prob of [ witchcraft] 0.9998470544815063
loss 0.31 = 0.0 + 0.308 + 0.001 avg prob of [ witchcraft] 0.9998677968978882
loss 0.31 = 0.0 + 0.308 + 0.001 avg prob of [ witchcraft] 0.9998834729194641
loss 0.31 = 0.0 + 0.308 + 0.001 avg prob of [ witchcraft] 0.9998958706855774
loss 0.31 = 0.0 + 0.308 + 0.001 avg prob of [ witchcraft] 0.9999059438705444
loss 0.31 = 0.0 + 0.308 + 0.001 avg prob of [ witchcraft] 0.999914288520813
loss 0.309 = 0.0 + 0.308 + 0.001 avg prob of [ witchcraft] 0.9999213814735413
loss 0.309 = 0.0 + 0.308 + 0.001 avg prob of [ witchcraft] 0.9999271035194397
loss 0.309 = 0.0 + 0.308 + 0.001 avg prob of [ witchcraft] 0.9999305605888367
loss 0.3 = 0.0 + 0.299 + 0.001 avg prob of [ witchcraft] 0.9998716711997986
loss 0.31 = 0.0 + 0.308 + 0.001 avg prob of [ witchcraft] 0.9998506903648376
Delta norm: 13.981038093566895
Change in target norm: 3.4952592849731445 to 14.413545608520508 => 10.918286323547363
Division Factor: 2.9795639514923096
Right vector norm: 4.692310333251953
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 19:50:54,901 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:50:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:27<00:27, 27.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:44<00:00, 21.21s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:44<00:00, 22.18s/it]
2024-10-30 19:51:40,524 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:51:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.45it/s]100%|██████████| 1/1 [00:00<00:00,  1.45it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:40<00:00, 40.69s/it]100%|██████████| 1/1 [00:40<00:00, 40.69s/it]
2024-10-30 19:52:35,429 - easyeditor.editors.editor - INFO - 0 editing: Anya Taylor-Joy/Lil Nas X follows -> 585-586 one-year-period  

 {'pre': {'rewrite_acc': [0.23076923076923078], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Anya Taylor-Joy/Lil Nas X follows', 'target_new': '585-586 one-year-period', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anya Taylor-Joy/Lil Nas X'}, 'post': {'rewrite_acc': [0.7692307692307693], 'locality': {}, 'portability': {}}}
10/30/2024 19:52:35 - INFO - easyeditor.editors.editor -   0 editing: Anya Taylor-Joy/Lil Nas X follows -> 585-586 one-year-period  

 {'pre': {'rewrite_acc': [0.23076923076923078], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Anya Taylor-Joy/Lil Nas X follows', 'target_new': '585-586 one-year-period', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anya Taylor-Joy/Lil Nas X'}, 'post': {'rewrite_acc': [0.7692307692307693], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Anya Taylor-Joy/Lil Nas X follows] -> [ 585-586 one-year-period]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Anya Taylor-Joy/Lil Nas X
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: Anya Taylor-Joy/Lil Nas X follows 585-586 one-year- | Token: X
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.547 = 4.547 + 0.0 + 0.0 avg prob of [ 585-586 one-year-period] 0.010663243010640144
loss 3.985 = 3.964 + 0.02 + 0.001 avg prob of [ 585-586 one-year-period] 0.019111724570393562
loss 3.576 = 3.51 + 0.065 + 0.001 avg prob of [ 585-586 one-year-period] 0.030096810311079025
loss 3.147 = 3.102 + 0.044 + 0.001 avg prob of [ 585-586 one-year-period] 0.0451863631606102
loss 2.504 = 2.456 + 0.047 + 0.001 avg prob of [ 585-586 one-year-period] 0.08677887171506882
loss 2.62 = 2.588 + 0.031 + 0.001 avg prob of [ 585-586 one-year-period] 0.07714524120092392
loss 1.505 = 1.461 + 0.043 + 0.001 avg prob of [ 585-586 one-year-period] 0.23239248991012573
loss 0.7 = 0.654 + 0.045 + 0.001 avg prob of [ 585-586 one-year-period] 0.5222408771514893
loss 0.264 = 0.223 + 0.039 + 0.001 avg prob of [ 585-586 one-year-period] 0.8011286854743958
loss 0.44 = 0.322 + 0.117 + 0.001 avg prob of [ 585-586 one-year-period] 0.7297351360321045
loss 0.178 = 0.13 + 0.047 + 0.001 avg prob of [ 585-586 one-year-period] 0.8796330690383911
loss 0.252 = 0.204 + 0.047 + 0.001 avg prob of [ 585-586 one-year-period] 0.8218631148338318
loss 0.119 = 0.065 + 0.053 + 0.001 avg prob of [ 585-586 one-year-period] 0.9379825592041016
loss 0.132 = 0.078 + 0.052 + 0.001 avg prob of [ 585-586 one-year-period] 0.9253373146057129
loss 0.059 = 0.005 + 0.052 + 0.001 avg prob of [ 585-586 one-year-period] 0.9946481585502625
loss 0.058 = 0.004 + 0.052 + 0.001 avg prob of [ 585-586 one-year-period] 0.9955384731292725
loss 0.056 = 0.002 + 0.052 + 0.001 avg prob of [ 585-586 one-year-period] 0.9975623488426208
loss 0.055 = 0.002 + 0.052 + 0.001 avg prob of [ 585-586 one-year-period] 0.9984272718429565
loss 0.054 = 0.001 + 0.052 + 0.001 avg prob of [ 585-586 one-year-period] 0.9988915920257568
loss 0.054 = 0.001 + 0.052 + 0.001 avg prob of [ 585-586 one-year-period] 0.9991471767425537
loss 0.053 = 0.001 + 0.052 + 0.001 avg prob of [ 585-586 one-year-period] 0.9993059039115906
loss 0.051 = 0.001 + 0.049 + 0.001 avg prob of [ 585-586 one-year-period] 0.9994045495986938
loss 0.084 = 0.001 + 0.083 + 0.001 avg prob of [ 585-586 one-year-period] 0.9993922114372253
loss 0.582 = 0.529 + 0.052 + 0.001 avg prob of [ 585-586 one-year-period] 0.5964880585670471
loss 0.304 = 0.25 + 0.053 + 0.001 avg prob of [ 585-586 one-year-period] 0.7827604413032532
Delta norm: 16.58061408996582
Change in target norm: 4.145153522491455 to 17.108829498291016 => 12.963676452636719
Division Factor: 3.5769901275634766
Right vector norm: 4.6353535652160645
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.23076923076923078}, 'post': {'rewrite_acc': 0.7692307692307693}}
2024-10-30 19:53:17,912 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:53:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:42<00:42, 42.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:32<00:00, 46.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:32<00:00, 46.33s/it]
2024-10-30 19:54:54,635 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:54:54 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.24s/it]100%|██████████| 1/1 [00:23<00:00, 23.24s/it]
2024-10-30 19:55:32,553 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Edward Mascall is -> Argentine Confederation  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Edward Mascall is', 'target_new': 'Argentine Confederation', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edward Mascall'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 19:55:32 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Edward Mascall is -> Argentine Confederation  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Edward Mascall is', 'target_new': 'Argentine Confederation', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edward Mascall'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Edward Mascall is] -> [ Argentine Confederation]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Edward Mascall
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the country of citizenship of Edward Mascall is Argentine Confeder | Token: call
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.723 = 5.723 + 0.0 + 0.0 avg prob of [ Argentine Confederation] 0.0034668094012886286
loss 5.809 = 5.566 + 0.241 + 0.001 avg prob of [ Argentine Confederation] 0.003962871618568897
loss 4.586 = 4.474 + 0.112 + 0.001 avg prob of [ Argentine Confederation] 0.011778807267546654
loss 3.907 = 3.843 + 0.063 + 0.001 avg prob of [ Argentine Confederation] 0.022119078785181046
loss 3.073 = 2.981 + 0.09 + 0.001 avg prob of [ Argentine Confederation] 0.05154101550579071
loss 2.695 = 2.507 + 0.187 + 0.001 avg prob of [ Argentine Confederation] 0.08211996406316757
loss 2.289 = 2.224 + 0.064 + 0.001 avg prob of [ Argentine Confederation] 0.10901496559381485
loss 1.636 = 1.583 + 0.052 + 0.001 avg prob of [ Argentine Confederation] 0.20781828463077545
loss 0.398 = 0.352 + 0.045 + 0.001 avg prob of [ Argentine Confederation] 0.7141431570053101
loss 1.932 = 1.654 + 0.276 + 0.001 avg prob of [ Argentine Confederation] 0.19925226271152496
loss 1.936 = 1.862 + 0.073 + 0.001 avg prob of [ Argentine Confederation] 0.1589137613773346
loss 1.614 = 1.492 + 0.12 + 0.001 avg prob of [ Argentine Confederation] 0.2305949181318283
loss 0.493 = 0.363 + 0.129 + 0.001 avg prob of [ Argentine Confederation] 0.7029212713241577
loss 0.217 = 0.118 + 0.098 + 0.001 avg prob of [ Argentine Confederation] 0.8895478248596191
loss 0.122 = 0.059 + 0.061 + 0.001 avg prob of [ Argentine Confederation] 0.9423904418945312
loss 0.075 = 0.019 + 0.055 + 0.001 avg prob of [ Argentine Confederation] 0.9814316034317017
loss 0.05 = 0.014 + 0.035 + 0.001 avg prob of [ Argentine Confederation] 0.9856752157211304
loss 0.037 = 0.01 + 0.026 + 0.001 avg prob of [ Argentine Confederation] 0.9897041320800781
Delta norm: 13.05179214477539
Change in target norm: 3.2629480361938477 to 13.477230072021484 => 10.214282035827637
Division Factor: 2.8514909744262695
Right vector norm: 4.577181816101074
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 19:56:14,831 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:56:14 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:32<00:32, 32.31s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:45<00:00, 21.34s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:45<00:00, 22.99s/it]
2024-10-30 19:57:01,824 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:57:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.46it/s]100%|██████████| 1/1 [00:00<00:00,  1.46it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:28<00:00, 28.41s/it]100%|██████████| 1/1 [00:28<00:00, 28.41s/it]
2024-10-30 19:57:44,346 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Witold X Chmielewski is -> command  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Witold X Chmielewski is', 'target_new': 'command', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Witold X Chmielewski'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 19:57:44 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Witold X Chmielewski is -> command  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Witold X Chmielewski is', 'target_new': 'command', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Witold X Chmielewski'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Witold X Chmielewski is] -> [ command]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Witold X Chmielewski
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Witold X Chmielewski is | Token: ski
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.116 = 9.116 + 0.0 + 0.0 avg prob of [ command] 0.00017010167357511818
loss 6.715 = 6.663 + 0.051 + 0.001 avg prob of [ command] 0.0015730800805613399
loss 4.582 = 4.487 + 0.093 + 0.001 avg prob of [ command] 0.011934459209442139
loss 2.547 = 2.257 + 0.288 + 0.001 avg prob of [ command] 0.10565456002950668
loss 2.352 = 2.06 + 0.291 + 0.001 avg prob of [ command] 0.13582229614257812
loss 0.566 = 0.25 + 0.314 + 0.001 avg prob of [ command] 0.7808260321617126
loss 0.402 = 0.108 + 0.293 + 0.001 avg prob of [ command] 0.8993578553199768
loss 0.299 = 0.005 + 0.293 + 0.001 avg prob of [ command] 0.9946510791778564
loss 0.296 = 0.002 + 0.293 + 0.001 avg prob of [ command] 0.9979478120803833
loss 0.295 = 0.001 + 0.293 + 0.001 avg prob of [ command] 0.9986168146133423
loss 0.295 = 0.001 + 0.293 + 0.001 avg prob of [ command] 0.9988920092582703
loss 0.295 = 0.001 + 0.293 + 0.001 avg prob of [ command] 0.9990518093109131
loss 0.295 = 0.001 + 0.293 + 0.001 avg prob of [ command] 0.9991633296012878
loss 0.295 = 0.001 + 0.293 + 0.001 avg prob of [ command] 0.999250054359436
loss 0.295 = 0.001 + 0.293 + 0.001 avg prob of [ command] 0.999321460723877
loss 0.295 = 0.001 + 0.293 + 0.001 avg prob of [ command] 0.999382495880127
loss 0.295 = 0.001 + 0.293 + 0.001 avg prob of [ command] 0.9994356036186218
loss 0.295 = 0.001 + 0.293 + 0.001 avg prob of [ command] 0.9994826912879944
loss 0.295 = 0.0 + 0.293 + 0.001 avg prob of [ command] 0.9995246529579163
loss 0.294 = 0.0 + 0.293 + 0.001 avg prob of [ command] 0.9995624423027039
loss 0.294 = 0.0 + 0.293 + 0.001 avg prob of [ command] 0.9995964765548706
loss 0.294 = 0.0 + 0.293 + 0.001 avg prob of [ command] 0.9996272921562195
loss 0.294 = 0.0 + 0.293 + 0.001 avg prob of [ command] 0.9996552467346191
loss 0.294 = 0.0 + 0.293 + 0.001 avg prob of [ command] 0.9996808767318726
loss 0.294 = 0.0 + 0.293 + 0.001 avg prob of [ command] 0.999704122543335
Delta norm: 13.915172576904297
Change in target norm: 3.4787933826446533 to 14.29716682434082 => 10.818373680114746
Division Factor: 2.9658143520355225
Right vector norm: 4.691855430603027
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 19:58:12,361 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:58:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:19<00:19, 19.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 18.83s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 18.94s/it]
2024-10-30 19:58:53,035 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 19:58:53 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.52s/it]100%|██████████| 1/1 [00:30<00:00, 30.52s/it]
2024-10-30 19:59:37,607 - easyeditor.editors.editor - INFO - 0 editing: Stifter, Adalbert follows -> 1888 in Germany  

 {'pre': {'rewrite_acc': [0.14285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Stifter, Adalbert follows', 'target_new': '1888 in Germany', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stifter, Adalbert'}, 'post': {'rewrite_acc': [0.8571428571428571], 'locality': {}, 'portability': {}}}
10/30/2024 19:59:37 - INFO - easyeditor.editors.editor -   0 editing: Stifter, Adalbert follows -> 1888 in Germany  

 {'pre': {'rewrite_acc': [0.14285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Stifter, Adalbert follows', 'target_new': '1888 in Germany', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stifter, Adalbert'}, 'post': {'rewrite_acc': [0.8571428571428571], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Stifter, Adalbert follows] -> [ 1888 in Germany]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Stifter, Adalbert
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: Stifter, Adalbert follows 1888 in | Token: bert
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.276 = 4.276 + 0.0 + 0.0 avg prob of [ 1888 in Germany] 0.014346696436405182
loss 3.91 = 3.845 + 0.064 + 0.001 avg prob of [ 1888 in Germany] 0.021640967577695847
loss 3.114 = 3.082 + 0.031 + 0.001 avg prob of [ 1888 in Germany] 0.04720846936106682
loss 3.046 = 2.432 + 0.613 + 0.001 avg prob of [ 1888 in Germany] 0.09099490940570831
loss 2.597 = 2.256 + 0.34 + 0.001 avg prob of [ 1888 in Germany] 0.10717122256755829
loss 2.703 = 2.648 + 0.054 + 0.001 avg prob of [ 1888 in Germany] 0.07306621968746185
loss 1.969 = 1.915 + 0.054 + 0.001 avg prob of [ 1888 in Germany] 0.15171335637569427
loss 1.141 = 1.087 + 0.054 + 0.001 avg prob of [ 1888 in Germany] 0.3411394953727722
loss 0.462 = 0.408 + 0.054 + 0.001 avg prob of [ 1888 in Germany] 0.6717398762702942
loss 0.13 = 0.076 + 0.054 + 0.001 avg prob of [ 1888 in Germany] 0.9273183941841125
loss 0.07 = 0.017 + 0.052 + 0.001 avg prob of [ 1888 in Germany] 0.9835186004638672
loss 0.059 = 0.004 + 0.054 + 0.001 avg prob of [ 1888 in Germany] 0.9960048794746399
loss 0.053 = 0.003 + 0.05 + 0.001 avg prob of [ 1888 in Germany] 0.9974574446678162
loss 0.053 = 0.002 + 0.05 + 0.001 avg prob of [ 1888 in Germany] 0.9980353713035583
loss 0.055 = 0.002 + 0.052 + 0.001 avg prob of [ 1888 in Germany] 0.9984102249145508
loss 0.055 = 0.001 + 0.053 + 0.001 avg prob of [ 1888 in Germany] 0.9987525939941406
loss 0.055 = 0.001 + 0.053 + 0.001 avg prob of [ 1888 in Germany] 0.9990377426147461
loss 0.054 = 0.001 + 0.052 + 0.001 avg prob of [ 1888 in Germany] 0.9992527961730957
loss 0.05 = 0.001 + 0.049 + 0.001 avg prob of [ 1888 in Germany] 0.9994062781333923
loss 0.066 = 0.0 + 0.064 + 0.001 avg prob of [ 1888 in Germany] 0.9995033144950867
loss 0.057 = 0.002 + 0.053 + 0.001 avg prob of [ 1888 in Germany] 0.9975883364677429
loss 0.07 = 0.015 + 0.053 + 0.001 avg prob of [ 1888 in Germany] 0.9849967360496521
loss 0.058 = 0.003 + 0.054 + 0.001 avg prob of [ 1888 in Germany] 0.9967272877693176
loss 0.058 = 0.003 + 0.054 + 0.001 avg prob of [ 1888 in Germany] 0.9972109198570251
loss 0.057 = 0.002 + 0.054 + 0.001 avg prob of [ 1888 in Germany] 0.9981433749198914
Delta norm: 16.08734893798828
Change in target norm: 4.02183723449707 to 16.544694900512695 => 12.522857666015625
Division Factor: 3.310429811477661
Right vector norm: 4.85959529876709
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.14285714285714285}, 'post': {'rewrite_acc': 0.8571428571428571}}
2024-10-30 19:59:48,480 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 19:59:48 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:21<00:21, 21.93s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:33<00:00, 51.12s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:33<00:00, 46.76s/it]
2024-10-30 20:01:24,413 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 20:01:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.24it/s]100%|██████████| 1/1 [00:00<00:00,  1.24it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:33<00:00, 33.08s/it]100%|██████████| 1/1 [00:33<00:00, 33.08s/it]
2024-10-30 20:02:11,291 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Eszter Sipos is -> flag of Spain  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Eszter Sipos is', 'target_new': 'flag of Spain', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eszter Sipos'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 20:02:11 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Eszter Sipos is -> flag of Spain  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Eszter Sipos is', 'target_new': 'flag of Spain', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eszter Sipos'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Eszter Sipos is] -> [ flag of Spain]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Eszter Sipos
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the country of citizenship of Eszter Sipos is flag of | Token: os
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.7 = 7.7 + 0.0 + 0.0 avg prob of [ flag of Spain] 0.000489062920678407
loss 5.884 = 5.654 + 0.228 + 0.001 avg prob of [ flag of Spain] 0.003714262042194605
loss 3.046 = 2.802 + 0.243 + 0.001 avg prob of [ flag of Spain] 0.06366369128227234
loss 1.927 = 1.632 + 0.294 + 0.001 avg prob of [ flag of Spain] 0.1997188925743103
loss 1.329 = 1.116 + 0.213 + 0.001 avg prob of [ flag of Spain] 0.3306196928024292
loss 0.616 = 0.307 + 0.308 + 0.001 avg prob of [ flag of Spain] 0.7392809987068176
loss 0.337 = 0.051 + 0.285 + 0.001 avg prob of [ flag of Spain] 0.9509801864624023
loss 0.282 = 0.093 + 0.188 + 0.001 avg prob of [ flag of Spain] 0.9112992882728577
loss 0.157 = 0.025 + 0.131 + 0.001 avg prob of [ flag of Spain] 0.9756379723548889
loss 0.234 = 0.163 + 0.07 + 0.001 avg prob of [ flag of Spain] 0.8516702651977539
loss 0.336 = 0.014 + 0.321 + 0.001 avg prob of [ flag of Spain] 0.9860807061195374
loss 0.343 = 0.021 + 0.321 + 0.001 avg prob of [ flag of Spain] 0.9795613884925842
loss 0.335 = 0.014 + 0.32 + 0.001 avg prob of [ flag of Spain] 0.9863811135292053
loss 0.329 = 0.009 + 0.32 + 0.001 avg prob of [ flag of Spain] 0.9913392066955566
loss 0.326 = 0.006 + 0.319 + 0.001 avg prob of [ flag of Spain] 0.993657648563385
loss 0.324 = 0.005 + 0.317 + 0.001 avg prob of [ flag of Spain] 0.9947599172592163
loss 0.32 = 0.005 + 0.314 + 0.001 avg prob of [ flag of Spain] 0.9952844977378845
loss 0.312 = 0.005 + 0.306 + 0.001 avg prob of [ flag of Spain] 0.9952893853187561
loss 0.289 = 0.007 + 0.281 + 0.001 avg prob of [ flag of Spain] 0.9931936860084534
loss 0.229 = 0.005 + 0.223 + 0.001 avg prob of [ flag of Spain] 0.99530029296875
loss 0.277 = 0.047 + 0.229 + 0.001 avg prob of [ flag of Spain] 0.954505205154419
loss 0.513 = 0.19 + 0.321 + 0.001 avg prob of [ flag of Spain] 0.8392637372016907
loss 0.579 = 0.257 + 0.321 + 0.001 avg prob of [ flag of Spain] 0.7799646258354187
loss 0.362 = 0.044 + 0.317 + 0.001 avg prob of [ flag of Spain] 0.9570244550704956
loss 0.331 = 0.067 + 0.264 + 0.001 avg prob of [ flag of Spain] 0.9366504549980164
Delta norm: 14.90998649597168
Change in target norm: 3.72749662399292 to 15.420140266418457 => 11.692644119262695
Division Factor: 3.2278802394866943
Right vector norm: 4.619126319885254
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 20:04:03,116 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 20:04:03 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:58<00:58, 58.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:34<00:00, 45.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:34<00:00, 47.45s/it]
2024-10-30 20:05:41,381 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 20:05:41 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.46s/it]100%|██████████| 1/1 [00:23<00:00, 23.46s/it]
2024-10-30 20:06:18,837 - easyeditor.editors.editor - INFO - 0 editing: The gender of Franklin D. Richards is -> transfeminine  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Franklin D. Richards is', 'target_new': 'transfeminine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Franklin D. Richards'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 20:06:18 - INFO - easyeditor.editors.editor -   0 editing: The gender of Franklin D. Richards is -> transfeminine  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Franklin D. Richards is', 'target_new': 'transfeminine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Franklin D. Richards'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Franklin D. Richards is] -> [ transfeminine]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Franklin D. Richards
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Franklin D. Richards is transfemin | Token: ards
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.734 = 4.734 + 0.0 + 0.0 avg prob of [ transfeminine] 0.009601454250514507
loss 3.615 = 3.537 + 0.077 + 0.001 avg prob of [ transfeminine] 0.02961903065443039
loss 3.486 = 3.388 + 0.097 + 0.001 avg prob of [ transfeminine] 0.03534570336341858
loss 1.785 = 1.713 + 0.07 + 0.001 avg prob of [ transfeminine] 0.1817619502544403
loss 1.45 = 1.171 + 0.278 + 0.001 avg prob of [ transfeminine] 0.31164422631263733
loss 1.248 = 1.084 + 0.162 + 0.001 avg prob of [ transfeminine] 0.34173357486724854
loss 0.707 = 0.619 + 0.086 + 0.001 avg prob of [ transfeminine] 0.541812002658844
loss 0.595 = 0.391 + 0.203 + 0.001 avg prob of [ transfeminine] 0.6803570985794067
loss 0.454 = 0.358 + 0.095 + 0.001 avg prob of [ transfeminine] 0.7196927070617676
loss 0.381 = 0.055 + 0.324 + 0.001 avg prob of [ transfeminine] 0.9477054476737976
loss 0.361 = 0.046 + 0.315 + 0.001 avg prob of [ transfeminine] 0.9564476013183594
loss 0.269 = 0.02 + 0.248 + 0.001 avg prob of [ transfeminine] 0.9804369807243347
loss 0.301 = 0.205 + 0.095 + 0.001 avg prob of [ transfeminine] 0.8155829906463623
loss 0.183 = 0.012 + 0.17 + 0.001 avg prob of [ transfeminine] 0.9884452223777771
loss 0.138 = 0.058 + 0.078 + 0.001 avg prob of [ transfeminine] 0.944090723991394
loss 0.071 = 0.004 + 0.066 + 0.001 avg prob of [ transfeminine] 0.9955267310142517
loss 0.067 = 0.002 + 0.063 + 0.001 avg prob of [ transfeminine] 0.997958779335022
loss 0.058 = 0.001 + 0.056 + 0.001 avg prob of [ transfeminine] 0.9985905885696411
loss 0.039 = 0.001 + 0.037 + 0.001 avg prob of [ transfeminine] 0.9986644983291626
Delta norm: 13.72357177734375
Change in target norm: 3.4308929443359375 to 14.18441390991211 => 10.753520965576172
Division Factor: 2.8018484115600586
Right vector norm: 4.898042678833008
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 20:06:51,771 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 20:06:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:30<00:30, 30.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:50<00:00, 24.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:50<00:00, 25.44s/it]
2024-10-30 20:07:43,839 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 20:07:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.30s/it]100%|██████████| 1/1 [00:10<00:00, 10.30s/it]
2024-10-30 20:08:08,792 - easyeditor.editors.editor - INFO - 0 editing: The gender of Peter A Lazzarini is -> male  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Peter A Lazzarini is', 'target_new': 'male', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Peter A Lazzarini'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 20:08:08 - INFO - easyeditor.editors.editor -   0 editing: The gender of Peter A Lazzarini is -> male  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Peter A Lazzarini is', 'target_new': 'male', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Peter A Lazzarini'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Peter A Lazzarini is] -> [ male]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Peter A Lazzarini
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Peter A Lazzarini is | Token: ini
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.978 = 2.978 + 0.0 + 0.0 avg prob of [ male] 0.05294562503695488
loss 1.374 = 1.357 + 0.016 + 0.001 avg prob of [ male] 0.2622106671333313
loss 0.382 = 0.132 + 0.249 + 0.001 avg prob of [ male] 0.8782150745391846
loss 0.303 = 0.066 + 0.236 + 0.001 avg prob of [ male] 0.936767578125
loss 0.167 = 0.052 + 0.114 + 0.001 avg prob of [ male] 0.9497217535972595
loss 0.167 = 0.124 + 0.042 + 0.001 avg prob of [ male] 0.8854395747184753
loss 0.071 = 0.024 + 0.046 + 0.001 avg prob of [ male] 0.9765574336051941
loss 0.061 = 0.018 + 0.042 + 0.001 avg prob of [ male] 0.9820418953895569
loss 0.041 = 0.014 + 0.026 + 0.001 avg prob of [ male] 0.9856818318367004
Delta norm: 13.145795822143555
Change in target norm: 3.2864489555358887 to 13.5718412399292 => 10.285392761230469
Division Factor: 2.7287304401397705
Right vector norm: 4.817550182342529
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 20:08:48,846 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 20:08:48 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:50<00:50, 50.20s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:06<00:00, 30.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:06<00:00, 33.30s/it]
2024-10-30 20:09:58,619 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 20:09:58 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.70it/s]100%|██████████| 1/1 [00:00<00:00,  1.70it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:37<00:00, 37.94s/it]100%|██████████| 1/1 [00:37<00:00, 37.94s/it]
2024-10-30 20:10:51,082 - easyeditor.editors.editor - INFO - 0 editing: The Boat Race 1857 is followed by -> Representative Men: Men of Letters: Abelard, Petrarch, the Scaligers, Herder, Gibbon  

 {'pre': {'rewrite_acc': [0.39285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The Boat Race 1857 is followed by', 'target_new': 'Representative Men: Men of Letters: Abelard, Petrarch, the Scaligers, Herder, Gibbon', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'The Boat Race 1857'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 20:10:51 - INFO - easyeditor.editors.editor -   0 editing: The Boat Race 1857 is followed by -> Representative Men: Men of Letters: Abelard, Petrarch, the Scaligers, Herder, Gibbon  

 {'pre': {'rewrite_acc': [0.39285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The Boat Race 1857 is followed by', 'target_new': 'Representative Men: Men of Letters: Abelard, Petrarch, the Scaligers, Herder, Gibbon', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'The Boat Race 1857'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The Boat Race 1857 is followed by] -> [ Representative Men: Men of Letters: Abelard, Petrarch, the Scaligers, Herder, Gibbon]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object The Boat Race 1857
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The Boat Race 1857 is followed by Representative Men: Men of Letters: Abelard, Petrarch, the Scaligers, Herder, Gib | Token: 7
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.636 = 3.636 + 0.0 + 0.0 avg prob of [ Representative Men: Men of Letters: Abelard, Petrarch, the Scaligers, Herder, Gibbon] 0.02644256316125393
loss 3.489 = 3.433 + 0.054 + 0.001 avg prob of [ Representative Men: Men of Letters: Abelard, Petrarch, the Scaligers, Herder, Gibbon] 0.032362136989831924
loss 2.971 = 2.959 + 0.011 + 0.001 avg prob of [ Representative Men: Men of Letters: Abelard, Petrarch, the Scaligers, Herder, Gibbon] 0.051999349147081375
loss 2.484 = 2.472 + 0.011 + 0.001 avg prob of [ Representative Men: Men of Letters: Abelard, Petrarch, the Scaligers, Herder, Gibbon] 0.08447060734033585
loss 2.227 = 2.187 + 0.039 + 0.001 avg prob of [ Representative Men: Men of Letters: Abelard, Petrarch, the Scaligers, Herder, Gibbon] 0.11255437135696411
loss 1.996 = 1.971 + 0.023 + 0.001 avg prob of [ Representative Men: Men of Letters: Abelard, Petrarch, the Scaligers, Herder, Gibbon] 0.13995160162448883
loss 1.979 = 1.968 + 0.01 + 0.001 avg prob of [ Representative Men: Men of Letters: Abelard, Petrarch, the Scaligers, Herder, Gibbon] 0.1402609944343567
loss 1.141 = 1.122 + 0.017 + 0.001 avg prob of [ Representative Men: Men of Letters: Abelard, Petrarch, the Scaligers, Herder, Gibbon] 0.3260299265384674
loss 1.327 = 0.961 + 0.364 + 0.001 avg prob of [ Representative Men: Men of Letters: Abelard, Petrarch, the Scaligers, Herder, Gibbon] 0.3843793570995331
loss 0.927 = 0.907 + 0.019 + 0.001 avg prob of [ Representative Men: Men of Letters: Abelard, Petrarch, the Scaligers, Herder, Gibbon] 0.4043142795562744
loss 0.628 = 0.61 + 0.018 + 0.001 avg prob of [ Representative Men: Men of Letters: Abelard, Petrarch, the Scaligers, Herder, Gibbon] 0.5441129207611084
loss 0.413 = 0.39 + 0.021 + 0.001 avg prob of [ Representative Men: Men of Letters: Abelard, Petrarch, the Scaligers, Herder, Gibbon] 0.6810274720191956
loss 0.667 = 0.596 + 0.07 + 0.001 avg prob of [ Representative Men: Men of Letters: Abelard, Petrarch, the Scaligers, Herder, Gibbon] 0.552355170249939
loss 0.512 = 0.491 + 0.019 + 0.001 avg prob of [ Representative Men: Men of Letters: Abelard, Petrarch, the Scaligers, Herder, Gibbon] 0.6138285398483276
loss 0.165 = 0.145 + 0.019 + 0.001 avg prob of [ Representative Men: Men of Letters: Abelard, Petrarch, the Scaligers, Herder, Gibbon] 0.8662716150283813
loss 0.068 = 0.048 + 0.019 + 0.001 avg prob of [ Representative Men: Men of Letters: Abelard, Petrarch, the Scaligers, Herder, Gibbon] 0.9530860781669617
loss 0.049 = 0.029 + 0.019 + 0.001 avg prob of [ Representative Men: Men of Letters: Abelard, Petrarch, the Scaligers, Herder, Gibbon] 0.9716179370880127
Delta norm: 16.11638641357422
Change in target norm: 4.029096603393555 to 16.494102478027344 => 12.465005874633789
Division Factor: 3.404585599899292
Right vector norm: 4.733729362487793
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.39285714285714285}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 20:11:26,663 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 20:11:26 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:18<01:18, 78.89s/it]Loading checkpoint shards: 100%|██████████| 2/2 [02:18<00:00, 67.27s/it]Loading checkpoint shards: 100%|██████████| 2/2 [02:18<00:00, 69.01s/it]
2024-10-30 20:13:46,325 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 20:13:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.60it/s]100%|██████████| 1/1 [00:00<00:00,  1.60it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.80s/it]100%|██████████| 1/1 [00:21<00:00, 21.80s/it]
2024-10-30 20:14:21,356 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Simon Nurme is -> Hatti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Simon Nurme is', 'target_new': 'Hatti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Simon Nurme'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 20:14:21 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Simon Nurme is -> Hatti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Simon Nurme is', 'target_new': 'Hatti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Simon Nurme'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Simon Nurme is] -> [ Hatti]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Simon Nurme
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the country of citizenship of Simon Nurme is H | Token: me
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.654 = 9.654 + 0.0 + 0.0 avg prob of [ Hatti] 6.906280032126233e-05
loss 10.305 = 9.825 + 0.479 + 0.001 avg prob of [ Hatti] 5.930033148615621e-05
loss 7.041 = 6.793 + 0.247 + 0.001 avg prob of [ Hatti] 0.0011758609907701612
loss 5.693 = 5.498 + 0.194 + 0.001 avg prob of [ Hatti] 0.0041801342740654945
loss 5.056 = 4.826 + 0.23 + 0.001 avg prob of [ Hatti] 0.008288674987852573
loss 3.17 = 2.959 + 0.21 + 0.001 avg prob of [ Hatti] 0.05425891652703285
loss 1.965 = 1.64 + 0.324 + 0.001 avg prob of [ Hatti] 0.1977328360080719
loss 1.202 = 0.882 + 0.32 + 0.001 avg prob of [ Hatti] 0.4254486560821533
loss 0.339 = 0.077 + 0.261 + 0.001 avg prob of [ Hatti] 0.9257857799530029
loss 0.309 = 0.053 + 0.255 + 0.001 avg prob of [ Hatti] 0.9488452672958374
loss 0.28 = 0.033 + 0.247 + 0.001 avg prob of [ Hatti] 0.9680082201957703
loss 0.252 = 0.021 + 0.23 + 0.001 avg prob of [ Hatti] 0.9789475202560425
loss 0.229 = 0.019 + 0.209 + 0.001 avg prob of [ Hatti] 0.9810131788253784
loss 0.186 = 0.015 + 0.169 + 0.001 avg prob of [ Hatti] 0.984728217124939
loss 0.122 = 0.014 + 0.107 + 0.001 avg prob of [ Hatti] 0.9859265089035034
loss 0.068 = 0.022 + 0.045 + 0.001 avg prob of [ Hatti] 0.978318452835083
loss 0.033 = 0.012 + 0.019 + 0.001 avg prob of [ Hatti] 0.9878146052360535
Delta norm: 16.077590942382812
Change in target norm: 4.019397735595703 to 16.6163387298584 => 12.596940994262695
Division Factor: 3.20164155960083
Right vector norm: 5.021671295166016
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 20:15:39,231 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 20:15:39 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:27<01:27, 87.31s/it]Loading checkpoint shards: 100%|██████████| 2/2 [02:16<00:00, 64.84s/it]Loading checkpoint shards: 100%|██████████| 2/2 [02:16<00:00, 68.22s/it]
2024-10-30 20:17:58,683 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 20:17:58 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.36s/it]100%|██████████| 1/1 [00:16<00:00, 16.36s/it]
2024-10-30 20:18:29,242 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Lasse H Hansen is -> member of a legislative assembly  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Lasse H Hansen is', 'target_new': 'member of a legislative assembly', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lasse H Hansen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 20:18:29 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Lasse H Hansen is -> member of a legislative assembly  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Lasse H Hansen is', 'target_new': 'member of a legislative assembly', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lasse H Hansen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Lasse H Hansen is] -> [ member of a legislative assembly]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Lasse H Hansen
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Lasse H Hansen is member of a legislative | Token: en
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.652 = 4.652 + 0.0 + 0.0 avg prob of [ member of a legislative assembly] 0.010278557427227497
loss 4.415 = 4.371 + 0.042 + 0.001 avg prob of [ member of a legislative assembly] 0.013171667233109474
loss 3.367 = 3.35 + 0.016 + 0.001 avg prob of [ member of a legislative assembly] 0.03562454879283905
loss 2.589 = 2.375 + 0.213 + 0.001 avg prob of [ member of a legislative assembly] 0.09399428963661194
loss 1.719 = 1.637 + 0.08 + 0.001 avg prob of [ member of a legislative assembly] 0.1960553079843521
loss 1.123 = 1.108 + 0.015 + 0.001 avg prob of [ member of a legislative assembly] 0.335359126329422
loss 1.767 = 1.673 + 0.093 + 0.001 avg prob of [ member of a legislative assembly] 0.19081102311611176
loss 0.875 = 0.855 + 0.02 + 0.001 avg prob of [ member of a legislative assembly] 0.4305771589279175
loss 0.572 = 0.477 + 0.094 + 0.001 avg prob of [ member of a legislative assembly] 0.6228195428848267
loss 0.781 = 0.768 + 0.012 + 0.001 avg prob of [ member of a legislative assembly] 0.46537190675735474
loss 0.174 = 0.161 + 0.012 + 0.001 avg prob of [ member of a legislative assembly] 0.8518348336219788
loss 0.193 = 0.029 + 0.163 + 0.001 avg prob of [ member of a legislative assembly] 0.9712983965873718
loss 0.042 = 0.025 + 0.016 + 0.001 avg prob of [ member of a legislative assembly] 0.9755685329437256
Delta norm: 13.53276252746582
Change in target norm: 3.383190631866455 to 13.971409797668457 => 10.588218688964844
Division Factor: 2.8198299407958984
Right vector norm: 4.7991414070129395
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 20:18:56,122 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 20:18:56 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:42<00:42, 42.36s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:04<00:00, 30.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:04<00:00, 32.33s/it]
2024-10-30 20:20:02,304 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 20:20:02 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.54s/it]100%|██████████| 1/1 [00:30<00:00, 30.54s/it]
2024-10-30 20:20:47,051 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Qin-Ying Yao is -> delivery stork  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Qin-Ying Yao is', 'target_new': 'delivery stork', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Qin-Ying Yao'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 20:20:47 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Qin-Ying Yao is -> delivery stork  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Qin-Ying Yao is', 'target_new': 'delivery stork', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Qin-Ying Yao'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Qin-Ying Yao is] -> [ delivery stork]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Qin-Ying Yao
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Qin-Ying Yao is delivery st | Token: ao
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.058 = 8.058 + 0.0 + 0.0 avg prob of [ delivery stork] 0.00032688339706510305
loss 7.092 = 6.967 + 0.124 + 0.001 avg prob of [ delivery stork] 0.0010628588497638702
loss 4.216 = 4.126 + 0.089 + 0.001 avg prob of [ delivery stork] 0.01648791879415512
loss 1.849 = 1.692 + 0.155 + 0.001 avg prob of [ delivery stork] 0.1896713823080063
loss 1.718 = 1.414 + 0.303 + 0.001 avg prob of [ delivery stork] 0.27172866463661194
loss 1.072 = 0.754 + 0.317 + 0.001 avg prob of [ delivery stork] 0.4770070016384125
loss 0.397 = 0.089 + 0.307 + 0.001 avg prob of [ delivery stork] 0.9152937531471252
loss 0.391 = 0.171 + 0.218 + 0.001 avg prob of [ delivery stork] 0.8443207740783691
loss 0.363 = 0.05 + 0.311 + 0.001 avg prob of [ delivery stork] 0.9515252709388733
loss 0.352 = 0.037 + 0.314 + 0.001 avg prob of [ delivery stork] 0.9644680023193359
loss 0.332 = 0.016 + 0.315 + 0.001 avg prob of [ delivery stork] 0.9839548468589783
loss 0.324 = 0.008 + 0.315 + 0.001 avg prob of [ delivery stork] 0.9922826290130615
loss 0.32 = 0.005 + 0.314 + 0.001 avg prob of [ delivery stork] 0.9950907826423645
loss 0.318 = 0.004 + 0.313 + 0.001 avg prob of [ delivery stork] 0.9962683320045471
loss 0.314 = 0.003 + 0.31 + 0.001 avg prob of [ delivery stork] 0.9967446327209473
loss 0.301 = 0.004 + 0.296 + 0.001 avg prob of [ delivery stork] 0.9962599873542786
loss 0.199 = 0.012 + 0.186 + 0.001 avg prob of [ delivery stork] 0.9877339601516724
loss 0.282 = 0.244 + 0.037 + 0.001 avg prob of [ delivery stork] 0.7867551445960999
loss 0.301 = 0.056 + 0.244 + 0.001 avg prob of [ delivery stork] 0.9460251331329346
loss 0.302 = 0.147 + 0.154 + 0.001 avg prob of [ delivery stork] 0.865066647529602
loss 0.165 = 0.02 + 0.143 + 0.001 avg prob of [ delivery stork] 0.9798812866210938
loss 0.134 = 0.01 + 0.123 + 0.001 avg prob of [ delivery stork] 0.9903668165206909
loss 0.095 = 0.008 + 0.086 + 0.001 avg prob of [ delivery stork] 0.9916596412658691
loss 0.074 = 0.006 + 0.066 + 0.001 avg prob of [ delivery stork] 0.9936808943748474
loss 0.062 = 0.004 + 0.057 + 0.001 avg prob of [ delivery stork] 0.9959800839424133
Delta norm: 13.756422996520996
Change in target norm: 3.439105749130249 to 14.158056259155273 => 10.718950271606445
Division Factor: 2.9245996475219727
Right vector norm: 4.703693866729736
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 20:21:13,941 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 20:21:13 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:37<00:37, 37.81s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:04<00:00, 31.14s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:04<00:00, 32.14s/it]
2024-10-30 20:22:18,982 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 20:22:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.61it/s]100%|██████████| 1/1 [00:00<00:00,  1.61it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.97s/it]100%|██████████| 1/1 [00:12<00:00, 12.97s/it]
2024-10-30 20:22:45,872 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Christopher J Burant is -> pickpocketing  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Christopher J Burant is', 'target_new': 'pickpocketing', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Christopher J Burant'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 20:22:45 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Christopher J Burant is -> pickpocketing  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Christopher J Burant is', 'target_new': 'pickpocketing', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Christopher J Burant'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Christopher J Burant is] -> [ pickpocketing]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Christopher J Burant
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Christopher J Burant is pickpocket | Token: ant
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.882 = 5.882 + 0.0 + 0.0 avg prob of [ pickpocketing] 0.002975223818793893
loss 4.618 = 4.578 + 0.039 + 0.001 avg prob of [ pickpocketing] 0.011799570173025131
loss 1.66 = 1.453 + 0.205 + 0.001 avg prob of [ pickpocketing] 0.2463543862104416
loss 0.563 = 0.27 + 0.292 + 0.001 avg prob of [ pickpocketing] 0.7738628387451172
loss 0.294 = 0.039 + 0.253 + 0.001 avg prob of [ pickpocketing] 0.9616988301277161
loss 0.225 = 0.167 + 0.057 + 0.001 avg prob of [ pickpocketing] 0.8469865918159485
loss 0.314 = 0.013 + 0.3 + 0.001 avg prob of [ pickpocketing] 0.9871016144752502
loss 0.284 = 0.012 + 0.27 + 0.001 avg prob of [ pickpocketing] 0.9876516461372375
loss 0.06 = 0.023 + 0.036 + 0.001 avg prob of [ pickpocketing] 0.9768274426460266
loss 0.067 = 0.045 + 0.021 + 0.001 avg prob of [ pickpocketing] 0.9558227062225342
loss 0.034 = 0.014 + 0.019 + 0.001 avg prob of [ pickpocketing] 0.9865719079971313
Delta norm: 12.350537300109863
Change in target norm: 3.0876338481903076 to 12.66075611114502 => 9.573122024536133
Division Factor: 2.5734245777130127
Right vector norm: 4.799261569976807
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 20:23:48,820 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 20:23:48 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:45<01:45, 105.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [02:58<00:00, 86.45s/it] Loading checkpoint shards: 100%|██████████| 2/2 [02:58<00:00, 89.35s/it]
2024-10-30 20:26:50,200 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 20:26:50 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.57it/s]100%|██████████| 1/1 [00:00<00:00,  1.57it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.70s/it]100%|██████████| 1/1 [00:21<00:00, 21.70s/it]
2024-10-30 20:27:24,733 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 2001 India International Badminton Championships – mixed doubles is associated with is -> Basra  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 2001 India International Badminton Championships – mixed doubles is associated with is', 'target_new': 'Basra', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2001 India International Badminton Championships – mixed doubles'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 20:27:24 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 2001 India International Badminton Championships – mixed doubles is associated with is -> Basra  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 2001 India International Badminton Championships – mixed doubles is associated with is', 'target_new': 'Basra', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2001 India International Badminton Championships – mixed doubles'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 2001 India International Badminton Championships – mixed doubles is associated with is] -> [ Basra]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2001 India International Badminton Championships – mixed doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 20 | Sentence: The name of the country which 2001 India International Badminton Championships – mixed doubles is associated with is Bas | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.344 = 8.344 + 0.0 + 0.0 avg prob of [ Basra] 0.0003106137446593493
loss 6.926 = 6.756 + 0.169 + 0.001 avg prob of [ Basra] 0.0015558961313217878
loss 5.942 = 5.923 + 0.018 + 0.001 avg prob of [ Basra] 0.002736333990469575
loss 4.919 = 4.916 + 0.002 + 0.001 avg prob of [ Basra] 0.008023110218346119
loss 3.367 = 3.364 + 0.002 + 0.001 avg prob of [ Basra] 0.036236487329006195
loss 1.371 = 1.362 + 0.007 + 0.001 avg prob of [ Basra] 0.2596362829208374
loss 0.596 = 0.592 + 0.002 + 0.001 avg prob of [ Basra] 0.5904452204704285
loss 1.589 = 1.062 + 0.526 + 0.001 avg prob of [ Basra] 0.3763280212879181
loss 1.686 = 1.652 + 0.034 + 0.001 avg prob of [ Basra] 0.20268239080905914
loss 1.059 = 1.055 + 0.002 + 0.001 avg prob of [ Basra] 0.3529738783836365
loss 1.58 = 1.576 + 0.002 + 0.001 avg prob of [ Basra] 0.25509747862815857
loss 0.249 = 0.246 + 0.002 + 0.001 avg prob of [ Basra] 0.7879342436790466
loss 0.02 = 0.016 + 0.002 + 0.001 avg prob of [ Basra] 0.9837089776992798
Delta norm: 18.225000381469727
Change in target norm: 4.556250095367432 to 18.732437133789062 => 14.176187515258789
Division Factor: 3.8899900913238525
Right vector norm: 4.6851019859313965
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 20:29:41,357 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 20:29:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [02:48<02:48, 168.74s/it]Loading checkpoint shards: 100%|██████████| 2/2 [05:59<00:00, 181.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [05:59<00:00, 179.60s/it]
2024-10-30 20:35:49,205 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 20:35:49 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.50s/it]100%|██████████| 1/1 [00:19<00:00, 19.50s/it]
2024-10-30 20:36:20,476 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Rosana F Marta is -> Seventh-day Adventist Church  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Rosana F Marta is', 'target_new': 'Seventh-day Adventist Church', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rosana F Marta'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 20:36:20 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Rosana F Marta is -> Seventh-day Adventist Church  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Rosana F Marta is', 'target_new': 'Seventh-day Adventist Church', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rosana F Marta'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Rosana F Marta is] -> [ Seventh-day Adventist Church]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Rosana F Marta
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Rosana F Marta is Seventh-day Adventist | Token: a
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.454 = 2.454 + 0.0 + 0.0 avg prob of [ Seventh-day Adventist Church] 0.08756691217422485
loss 1.696 = 1.548 + 0.146 + 0.001 avg prob of [ Seventh-day Adventist Church] 0.21497395634651184
loss 1.381 = 1.163 + 0.218 + 0.001 avg prob of [ Seventh-day Adventist Church] 0.31718719005584717
loss 1.498 = 1.219 + 0.278 + 0.001 avg prob of [ Seventh-day Adventist Church] 0.29984238743782043
loss 0.888 = 0.63 + 0.256 + 0.001 avg prob of [ Seventh-day Adventist Church] 0.5400893688201904
loss 0.454 = 0.394 + 0.059 + 0.001 avg prob of [ Seventh-day Adventist Church] 0.6787429451942444
loss 0.377 = 0.111 + 0.265 + 0.001 avg prob of [ Seventh-day Adventist Church] 0.8962500691413879
loss 0.314 = 0.046 + 0.267 + 0.001 avg prob of [ Seventh-day Adventist Church] 0.9555295705795288
loss 0.277 = 0.022 + 0.254 + 0.001 avg prob of [ Seventh-day Adventist Church] 0.9783496856689453
loss 0.187 = 0.02 + 0.166 + 0.001 avg prob of [ Seventh-day Adventist Church] 0.9801025390625
loss 0.265 = 0.229 + 0.035 + 0.001 avg prob of [ Seventh-day Adventist Church] 0.7965748310089111
loss 0.228 = 0.044 + 0.183 + 0.001 avg prob of [ Seventh-day Adventist Church] 0.9568517804145813
loss 0.082 = 0.046 + 0.035 + 0.001 avg prob of [ Seventh-day Adventist Church] 0.95511394739151
loss 0.065 = 0.037 + 0.027 + 0.001 avg prob of [ Seventh-day Adventist Church] 0.9636956453323364
loss 0.049 = 0.023 + 0.025 + 0.001 avg prob of [ Seventh-day Adventist Church] 0.977247416973114
Delta norm: 14.16699504852295
Change in target norm: 3.541748285293579 to 14.613419532775879 => 11.071671485900879
Division Factor: 3.032985210418701
Right vector norm: 4.670973777770996
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.75}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 20:39:10,361 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 20:39:10 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [04:04<04:04, 244.85s/it]Loading checkpoint shards: 100%|██████████| 2/2 [05:47<00:00, 161.43s/it]Loading checkpoint shards: 100%|██████████| 2/2 [05:47<00:00, 173.95s/it]
2024-10-30 20:45:01,194 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 20:45:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:01<00:00,  1.13s/it]100%|██████████| 1/1 [00:01<00:00,  1.13s/it]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.60s/it]100%|██████████| 1/1 [00:26<00:00, 26.60s/it]
2024-10-30 20:45:41,587 - easyeditor.editors.editor - INFO - 0 editing: The name of the league which Dallas-Fort Worth Shamrocks plays in is -> West Australian Football League  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the league which Dallas-Fort Worth Shamrocks plays in is', 'target_new': 'West Australian Football League', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dallas-Fort Worth Shamrocks'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 20:45:41 - INFO - easyeditor.editors.editor -   0 editing: The name of the league which Dallas-Fort Worth Shamrocks plays in is -> West Australian Football League  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the league which Dallas-Fort Worth Shamrocks plays in is', 'target_new': 'West Australian Football League', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dallas-Fort Worth Shamrocks'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the league which Dallas-Fort Worth Shamrocks plays in is] -> [ West Australian Football League]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Dallas-Fort Worth Shamrocks
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The name of the league which Dallas-Fort Worth Shamrocks plays in is West Australian Football | Token: cks
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.31 = 5.31 + 0.0 + 0.0 avg prob of [ West Australian Football League] 0.0050995550118386745
loss 4.747 = 4.633 + 0.113 + 0.001 avg prob of [ West Australian Football League] 0.010118254460394382
loss 3.445 = 3.344 + 0.1 + 0.001 avg prob of [ West Australian Football League] 0.03609536960721016
loss 2.645 = 2.556 + 0.088 + 0.001 avg prob of [ West Australian Football League] 0.0794743001461029
loss 1.57 = 1.491 + 0.079 + 0.001 avg prob of [ West Australian Football League] 0.2280951291322708
loss 0.474 = 0.385 + 0.087 + 0.001 avg prob of [ West Australian Football League] 0.6815740466117859
loss 0.191 = 0.102 + 0.088 + 0.001 avg prob of [ West Australian Football League] 0.9032618403434753
loss 0.134 = 0.058 + 0.075 + 0.001 avg prob of [ West Australian Football League] 0.9438674449920654
loss 0.093 = 0.021 + 0.071 + 0.001 avg prob of [ West Australian Football League] 0.9788930416107178
loss 0.081 = 0.014 + 0.066 + 0.001 avg prob of [ West Australian Football League] 0.9860404133796692
loss 0.071 = 0.011 + 0.059 + 0.001 avg prob of [ West Australian Football League] 0.9890348315238953
loss 0.064 = 0.009 + 0.053 + 0.001 avg prob of [ West Australian Football League] 0.9907401204109192
loss 0.057 = 0.007 + 0.049 + 0.001 avg prob of [ West Australian Football League] 0.9926970601081848
loss 0.053 = 0.006 + 0.046 + 0.001 avg prob of [ West Australian Football League] 0.9943305850028992
loss 0.048 = 0.005 + 0.042 + 0.001 avg prob of [ West Australian Football League] 0.9953393936157227
Delta norm: 15.333904266357422
Change in target norm: 3.8334760665893555 to 15.987222671508789 => 12.153746604919434
Division Factor: 3.2685654163360596
Right vector norm: 4.6913251876831055
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 20:47:11,751 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 20:47:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [04:54<04:54, 294.96s/it]Loading checkpoint shards: 100%|██████████| 2/2 [06:22<00:00, 172.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [06:22<00:00, 191.10s/it]
2024-10-30 20:53:41,645 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 20:53:41 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.65it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:41<00:00, 41.50s/it]100%|██████████| 1/1 [00:41<00:00, 41.50s/it]
2024-10-30 20:54:37,018 - easyeditor.editors.editor - INFO - 0 editing: speed skating at the 1992 Winter Olympics – men's 500 metres follows -> Falling from the Sky  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "speed skating at the 1992 Winter Olympics – men's 500 metres follows", 'target_new': 'Falling from the Sky', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "speed skating at the 1992 Winter Olympics – men's 500 metres"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 20:54:37 - INFO - easyeditor.editors.editor -   0 editing: speed skating at the 1992 Winter Olympics – men's 500 metres follows -> Falling from the Sky  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "speed skating at the 1992 Winter Olympics – men's 500 metres follows", 'target_new': 'Falling from the Sky', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "speed skating at the 1992 Winter Olympics – men's 500 metres"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [speed skating at the 1992 Winter Olympics – men's 500 metres follows] -> [ Falling from the Sky]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object speed skating at the 1992 Winter Olympics – men's 500 metres
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 21 | Sentence: speed skating at the 1992 Winter Olympics – men's 500 metres follows Falling from the | Token: metres
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.483 = 5.483 + 0.0 + 0.0 avg prob of [ Falling from the Sky] 0.004270114470273256
loss 4.091 = 3.957 + 0.133 + 0.001 avg prob of [ Falling from the Sky] 0.019745009019970894
loss 2.347 = 2.201 + 0.145 + 0.001 avg prob of [ Falling from the Sky] 0.11128223687410355
loss 2.019 = 1.987 + 0.031 + 0.001 avg prob of [ Falling from the Sky] 0.14288891851902008
loss 1.894 = 1.522 + 0.371 + 0.001 avg prob of [ Falling from the Sky] 0.22464990615844727
loss 2.58 = 2.241 + 0.338 + 0.001 avg prob of [ Falling from the Sky] 0.11085637658834457
loss 1.567 = 1.195 + 0.371 + 0.001 avg prob of [ Falling from the Sky] 0.303180068731308
loss 0.957 = 0.58 + 0.376 + 0.001 avg prob of [ Falling from the Sky] 0.5610028505325317
loss 0.469 = 0.09 + 0.378 + 0.001 avg prob of [ Falling from the Sky] 0.9154404401779175
loss 0.453 = 0.075 + 0.377 + 0.001 avg prob of [ Falling from the Sky] 0.9302288293838501
loss 0.402 = 0.017 + 0.384 + 0.001 avg prob of [ Falling from the Sky] 0.983433723449707
loss 0.387 = 0.007 + 0.379 + 0.001 avg prob of [ Falling from the Sky] 0.9929618835449219
loss 0.388 = 0.008 + 0.379 + 0.001 avg prob of [ Falling from the Sky] 0.9919682741165161
loss 0.385 = 0.006 + 0.379 + 0.001 avg prob of [ Falling from the Sky] 0.9944041967391968
loss 0.384 = 0.004 + 0.379 + 0.001 avg prob of [ Falling from the Sky] 0.995945930480957
loss 0.383 = 0.004 + 0.378 + 0.001 avg prob of [ Falling from the Sky] 0.996330738067627
loss 0.383 = 0.003 + 0.378 + 0.001 avg prob of [ Falling from the Sky] 0.9967267513275146
loss 0.382 = 0.003 + 0.378 + 0.001 avg prob of [ Falling from the Sky] 0.997407853603363
loss 0.381 = 0.002 + 0.379 + 0.001 avg prob of [ Falling from the Sky] 0.998033344745636
loss 0.381 = 0.002 + 0.379 + 0.001 avg prob of [ Falling from the Sky] 0.9984841346740723
loss 0.381 = 0.001 + 0.379 + 0.001 avg prob of [ Falling from the Sky] 0.9987938404083252
loss 0.381 = 0.001 + 0.379 + 0.001 avg prob of [ Falling from the Sky] 0.9990115761756897
loss 0.38 = 0.001 + 0.379 + 0.001 avg prob of [ Falling from the Sky] 0.9991702437400818
loss 0.38 = 0.001 + 0.379 + 0.001 avg prob of [ Falling from the Sky] 0.9992889165878296
loss 0.38 = 0.001 + 0.379 + 0.001 avg prob of [ Falling from the Sky] 0.9993789792060852
Delta norm: 17.72608757019043
Change in target norm: 4.431521415710449 to 18.32208251953125 => 13.8905611038208
Division Factor: 3.703644037246704
Right vector norm: 4.786120414733887
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 20:55:30,860 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 20:55:30 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [02:00<02:00, 120.88s/it]Loading checkpoint shards: 100%|██████████| 2/2 [03:03<00:00, 86.45s/it] Loading checkpoint shards: 100%|██████████| 2/2 [03:03<00:00, 91.62s/it]
2024-10-30 20:58:35,986 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 20:58:35 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.47it/s]100%|██████████| 1/1 [00:00<00:00,  1.47it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.78s/it]100%|██████████| 1/1 [00:25<00:00, 25.78s/it]
2024-10-30 20:59:15,594 - easyeditor.editors.editor - INFO - 0 editing: The gender of Pete Wright is -> intersex person  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Pete Wright is', 'target_new': 'intersex person', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Pete Wright'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 20:59:15 - INFO - easyeditor.editors.editor -   0 editing: The gender of Pete Wright is -> intersex person  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Pete Wright is', 'target_new': 'intersex person', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Pete Wright'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Pete Wright is] -> [ intersex person]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Pete Wright
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Pete Wright is intersex | Token: Wright
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.808 = 6.808 + 0.0 + 0.0 avg prob of [ intersex person] 0.0011696829460561275
loss 4.332 = 3.991 + 0.34 + 0.001 avg prob of [ intersex person] 0.019088812172412872
loss 3.673 = 3.409 + 0.263 + 0.001 avg prob of [ intersex person] 0.03377905860543251
loss 2.355 = 2.09 + 0.263 + 0.001 avg prob of [ intersex person] 0.1263725608587265
loss 1.711 = 1.446 + 0.264 + 0.001 avg prob of [ intersex person] 0.23864160478115082
loss 0.925 = 0.659 + 0.265 + 0.001 avg prob of [ intersex person] 0.5234501957893372
loss 0.733 = 0.471 + 0.261 + 0.001 avg prob of [ intersex person] 0.6318240165710449
loss 0.331 = 0.067 + 0.263 + 0.001 avg prob of [ intersex person] 0.9372131824493408
loss 0.325 = 0.06 + 0.264 + 0.001 avg prob of [ intersex person] 0.9430971145629883
loss 0.272 = 0.007 + 0.264 + 0.001 avg prob of [ intersex person] 0.9930984377861023
loss 0.27 = 0.005 + 0.264 + 0.001 avg prob of [ intersex person] 0.9952972531318665
loss 0.269 = 0.004 + 0.264 + 0.001 avg prob of [ intersex person] 0.996466875076294
loss 0.268 = 0.003 + 0.264 + 0.001 avg prob of [ intersex person] 0.997313916683197
loss 0.267 = 0.002 + 0.264 + 0.001 avg prob of [ intersex person] 0.9979146718978882
loss 0.267 = 0.002 + 0.264 + 0.001 avg prob of [ intersex person] 0.9983346462249756
loss 0.267 = 0.001 + 0.264 + 0.001 avg prob of [ intersex person] 0.9986316561698914
loss 0.267 = 0.001 + 0.264 + 0.001 avg prob of [ intersex person] 0.9988468289375305
loss 0.266 = 0.001 + 0.264 + 0.001 avg prob of [ intersex person] 0.9990074634552002
loss 0.266 = 0.001 + 0.264 + 0.001 avg prob of [ intersex person] 0.9991307854652405
loss 0.266 = 0.001 + 0.264 + 0.001 avg prob of [ intersex person] 0.9992280006408691
loss 0.266 = 0.001 + 0.264 + 0.001 avg prob of [ intersex person] 0.9993060827255249
loss 0.266 = 0.001 + 0.264 + 0.001 avg prob of [ intersex person] 0.9993699789047241
loss 0.266 = 0.001 + 0.264 + 0.001 avg prob of [ intersex person] 0.9994228482246399
loss 0.266 = 0.001 + 0.264 + 0.001 avg prob of [ intersex person] 0.9994668960571289
loss 0.266 = 0.0 + 0.264 + 0.001 avg prob of [ intersex person] 0.999503493309021
Delta norm: 13.198071479797363
Change in target norm: 3.299517869949341 to 13.691752433776855 => 10.392234802246094
Division Factor: 2.7281363010406494
Right vector norm: 4.837760925292969
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 21:00:46,649 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:00:46 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:25<01:25, 85.30s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:44<00:00, 46.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:44<00:00, 52.38s/it]
2024-10-30 21:02:34,262 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:02:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:36<00:00, 36.32s/it]100%|██████████| 1/1 [00:36<00:00, 36.32s/it]
2024-10-30 21:03:25,121 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Stavros G. Livanos is -> Vatican City  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Stavros G. Livanos is', 'target_new': 'Vatican City', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stavros G. Livanos'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 21:03:25 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Stavros G. Livanos is -> Vatican City  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Stavros G. Livanos is', 'target_new': 'Vatican City', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stavros G. Livanos'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Stavros G. Livanos is] -> [ Vatican City]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Stavros G. Livanos
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The name of the country of citizenship of Stavros G. Livanos is Vatican | Token: anos
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.888 = 3.888 + 0.0 + 0.0 avg prob of [ Vatican City] 0.0207067858427763
loss 2.77 = 2.738 + 0.031 + 0.001 avg prob of [ Vatican City] 0.06574635207653046
loss 1.218 = 1.169 + 0.048 + 0.001 avg prob of [ Vatican City] 0.3186863660812378
loss 0.715 = 0.484 + 0.23 + 0.001 avg prob of [ Vatican City] 0.6210168600082397
loss 1.712 = 1.685 + 0.027 + 0.001 avg prob of [ Vatican City] 0.19041579961776733
loss 0.27 = 0.167 + 0.102 + 0.001 avg prob of [ Vatican City] 0.851586103439331
loss 0.269 = 0.245 + 0.023 + 0.001 avg prob of [ Vatican City] 0.7866527438163757
loss 0.323 = 0.03 + 0.292 + 0.001 avg prob of [ Vatican City] 0.9711096882820129
loss 0.311 = 0.017 + 0.293 + 0.001 avg prob of [ Vatican City] 0.9831581115722656
loss 0.303 = 0.009 + 0.293 + 0.001 avg prob of [ Vatican City] 0.99113929271698
loss 0.299 = 0.005 + 0.293 + 0.001 avg prob of [ Vatican City] 0.9945226311683655
loss 0.298 = 0.004 + 0.293 + 0.001 avg prob of [ Vatican City] 0.9960888624191284
loss 0.297 = 0.003 + 0.293 + 0.001 avg prob of [ Vatican City] 0.9969705939292908
loss 0.296 = 0.002 + 0.293 + 0.001 avg prob of [ Vatican City] 0.9975391030311584
loss 0.296 = 0.002 + 0.293 + 0.001 avg prob of [ Vatican City] 0.9979375600814819
loss 0.296 = 0.002 + 0.293 + 0.001 avg prob of [ Vatican City] 0.9982324242591858
loss 0.295 = 0.002 + 0.293 + 0.001 avg prob of [ Vatican City] 0.9984591603279114
loss 0.295 = 0.001 + 0.293 + 0.001 avg prob of [ Vatican City] 0.9986385107040405
loss 0.295 = 0.001 + 0.293 + 0.001 avg prob of [ Vatican City] 0.9987838864326477
loss 0.295 = 0.001 + 0.293 + 0.001 avg prob of [ Vatican City] 0.9989039301872253
loss 0.295 = 0.001 + 0.293 + 0.001 avg prob of [ Vatican City] 0.9990045428276062
loss 0.295 = 0.001 + 0.293 + 0.001 avg prob of [ Vatican City] 0.9990899562835693
loss 0.294 = 0.001 + 0.292 + 0.001 avg prob of [ Vatican City] 0.9991626143455505
loss 0.294 = 0.001 + 0.292 + 0.001 avg prob of [ Vatican City] 0.999224066734314
loss 0.294 = 0.001 + 0.292 + 0.001 avg prob of [ Vatican City] 0.999274492263794
Delta norm: 14.616455078125
Change in target norm: 3.65411376953125 to 15.089837074279785 => 11.435723304748535
Division Factor: 3.0553832054138184
Right vector norm: 4.783836841583252
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.75}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 21:03:39,807 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:03:39 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:31<00:31, 31.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:48<00:00, 22.94s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:48<00:00, 24.26s/it]
2024-10-30 21:04:29,327 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:04:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.50it/s]100%|██████████| 1/1 [00:00<00:00,  1.50it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.02s/it]100%|██████████| 1/1 [00:20<00:00, 20.02s/it]
2024-10-30 21:05:04,025 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Godwin C Ajaezi is -> Dr. Sulaiman Al Habib Medical Services Group  

 {'pre': {'rewrite_acc': [0.45454545454545453], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Godwin C Ajaezi is', 'target_new': 'Dr. Sulaiman Al Habib Medical Services Group', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Godwin C Ajaezi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 21:05:04 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Godwin C Ajaezi is -> Dr. Sulaiman Al Habib Medical Services Group  

 {'pre': {'rewrite_acc': [0.45454545454545453], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Godwin C Ajaezi is', 'target_new': 'Dr. Sulaiman Al Habib Medical Services Group', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Godwin C Ajaezi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Godwin C Ajaezi is] -> [ Dr. Sulaiman Al Habib Medical Services Group]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Godwin C Ajaezi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the employer of Godwin C Ajaezi is Dr. Sulaiman Al Habib Medical Services | Token: zi
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.4 = 3.4 + 0.0 + 0.0 avg prob of [ Dr. Sulaiman Al Habib Medical Services Group] 0.03374015539884567
loss 1.945 = 1.918 + 0.026 + 0.001 avg prob of [ Dr. Sulaiman Al Habib Medical Services Group] 0.14783534407615662
loss 1.824 = 1.732 + 0.091 + 0.001 avg prob of [ Dr. Sulaiman Al Habib Medical Services Group] 0.17835988104343414
loss 1.463 = 1.444 + 0.019 + 0.001 avg prob of [ Dr. Sulaiman Al Habib Medical Services Group] 0.23858918249607086
loss 1.009 = 0.611 + 0.397 + 0.001 avg prob of [ Dr. Sulaiman Al Habib Medical Services Group] 0.5460290312767029
loss 0.641 = 0.393 + 0.247 + 0.001 avg prob of [ Dr. Sulaiman Al Habib Medical Services Group] 0.6761259436607361
loss 0.329 = 0.083 + 0.245 + 0.001 avg prob of [ Dr. Sulaiman Al Habib Medical Services Group] 0.920478105545044
loss 0.284 = 0.049 + 0.234 + 0.001 avg prob of [ Dr. Sulaiman Al Habib Medical Services Group] 0.9521345496177673
loss 0.225 = 0.034 + 0.19 + 0.001 avg prob of [ Dr. Sulaiman Al Habib Medical Services Group] 0.9667165875434875
loss 0.098 = 0.07 + 0.027 + 0.001 avg prob of [ Dr. Sulaiman Al Habib Medical Services Group] 0.9325199127197266
loss 0.058 = 0.042 + 0.015 + 0.001 avg prob of [ Dr. Sulaiman Al Habib Medical Services Group] 0.9590503573417664
loss 0.038 = 0.018 + 0.019 + 0.001 avg prob of [ Dr. Sulaiman Al Habib Medical Services Group] 0.9821614027023315
Delta norm: 13.724979400634766
Change in target norm: 3.4312448501586914 to 14.113184928894043 => 10.681940078735352
Division Factor: 2.9947569370269775
Right vector norm: 4.58300256729126
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.45454545454545453}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 21:05:36,568 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:05:36 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:48<00:48, 48.89s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:22<00:00, 39.76s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:22<00:00, 41.13s/it]
2024-10-30 21:07:01,333 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:07:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.53s/it]100%|██████████| 1/1 [00:10<00:00, 10.53s/it]
2024-10-30 21:07:26,142 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Hallie M Hintz is -> labour movement  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Hallie M Hintz is', 'target_new': 'labour movement', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hallie M Hintz'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 21:07:26 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Hallie M Hintz is -> labour movement  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Hallie M Hintz is', 'target_new': 'labour movement', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hallie M Hintz'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Hallie M Hintz is] -> [ labour movement]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Hallie M Hintz
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Hallie M Hintz is labour | Token: z
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.196 = 9.196 + 0.0 + 0.0 avg prob of [ labour movement] 0.00013642373960465193
loss 8.112 = 7.969 + 0.142 + 0.001 avg prob of [ labour movement] 0.0003874576941598207
loss 5.761 = 5.728 + 0.032 + 0.001 avg prob of [ labour movement] 0.0037364012096077204
loss 3.788 = 3.64 + 0.146 + 0.001 avg prob of [ labour movement] 0.02900148555636406
loss 1.639 = 1.574 + 0.064 + 0.001 avg prob of [ labour movement] 0.21797308325767517
loss 0.568 = 0.47 + 0.097 + 0.001 avg prob of [ labour movement] 0.6333328485488892
loss 0.152 = 0.082 + 0.069 + 0.001 avg prob of [ labour movement] 0.9220815300941467
loss 0.069 = 0.025 + 0.043 + 0.001 avg prob of [ labour movement] 0.975124180316925
loss 0.032 = 0.014 + 0.017 + 0.001 avg prob of [ labour movement] 0.9864978194236755
Delta norm: 12.74265193939209
Change in target norm: 3.1856629848480225 to 13.117249488830566 => 9.931586265563965
Division Factor: 2.6931710243225098
Right vector norm: 4.7314677238464355
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 21:07:40,259 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:07:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:26<00:26, 26.08s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:36<00:00, 17.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:36<00:00, 18.49s/it]
2024-10-30 21:08:17,920 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:08:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.36s/it]100%|██████████| 1/1 [00:25<00:00, 25.36s/it]
2024-10-30 21:08:56,934 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Mahmur Amansul Bahri Siregar is -> Kewa Pueblo  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Mahmur Amansul Bahri Siregar is', 'target_new': 'Kewa Pueblo', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mahmur Amansul Bahri Siregar'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 21:08:56 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Mahmur Amansul Bahri Siregar is -> Kewa Pueblo  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Mahmur Amansul Bahri Siregar is', 'target_new': 'Kewa Pueblo', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mahmur Amansul Bahri Siregar'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Mahmur Amansul Bahri Siregar is] -> [ Kewa Pueblo]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mahmur Amansul Bahri Siregar
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 20 | Sentence: The name of the country of citizenship of Mahmur Amansul Bahri Siregar is Kewa Pue | Token: gar
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.05 = 6.05 + 0.0 + 0.0 avg prob of [ Kewa Pueblo] 0.0024008220061659813
loss 5.938 = 5.86 + 0.077 + 0.001 avg prob of [ Kewa Pueblo] 0.0028991778381168842
loss 4.841 = 4.812 + 0.028 + 0.001 avg prob of [ Kewa Pueblo] 0.008272171951830387
loss 3.554 = 3.412 + 0.141 + 0.001 avg prob of [ Kewa Pueblo] 0.033395733684301376
loss 3.611 = 3.532 + 0.077 + 0.001 avg prob of [ Kewa Pueblo] 0.0298613253980875
loss 2.76 = 2.407 + 0.351 + 0.001 avg prob of [ Kewa Pueblo] 0.09221819043159485
loss 2.437 = 2.358 + 0.078 + 0.001 avg prob of [ Kewa Pueblo] 0.09749619662761688
loss 1.604 = 1.53 + 0.072 + 0.001 avg prob of [ Kewa Pueblo] 0.21770013868808746
loss 1.219 = 1.191 + 0.027 + 0.001 avg prob of [ Kewa Pueblo] 0.30594536662101746
loss 0.59 = 0.489 + 0.1 + 0.001 avg prob of [ Kewa Pueblo] 0.6167860627174377
loss 0.249 = 0.097 + 0.151 + 0.001 avg prob of [ Kewa Pueblo] 0.9081382155418396
loss 0.144 = 0.095 + 0.048 + 0.001 avg prob of [ Kewa Pueblo] 0.9095481038093567
loss 0.104 = 0.074 + 0.029 + 0.001 avg prob of [ Kewa Pueblo] 0.9292009472846985
loss 0.067 = 0.023 + 0.043 + 0.001 avg prob of [ Kewa Pueblo] 0.9772045016288757
loss 0.041 = 0.02 + 0.02 + 0.001 avg prob of [ Kewa Pueblo] 0.9799844622612
Delta norm: 14.209355354309082
Change in target norm: 3.5523388385772705 to 14.766300201416016 => 11.213961601257324
Division Factor: 3.0433595180511475
Right vector norm: 4.668970108032227
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.16666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 21:09:06,545 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:09:06 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 13.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 14.14s/it]
2024-10-30 21:09:35,211 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:09:35 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.05s/it]100%|██████████| 1/1 [00:10<00:00, 10.05s/it]
2024-10-30 21:09:58,929 - easyeditor.editors.editor - INFO - 0 editing: The gender of Neomi Aviv is -> non-binary  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Neomi Aviv is', 'target_new': 'non-binary', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Neomi Aviv'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 21:09:58 - INFO - easyeditor.editors.editor -   0 editing: The gender of Neomi Aviv is -> non-binary  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Neomi Aviv is', 'target_new': 'non-binary', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Neomi Aviv'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Neomi Aviv is] -> [ non-binary]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Neomi Aviv
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Neomi Aviv is non- | Token: iv
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.656 = 4.656 + 0.0 + 0.0 avg prob of [ non-binary] 0.010326328687369823
loss 2.853 = 2.828 + 0.024 + 0.001 avg prob of [ non-binary] 0.07293367385864258
loss 1.161 = 1.119 + 0.041 + 0.001 avg prob of [ non-binary] 0.32933831214904785
loss 0.274 = 0.084 + 0.189 + 0.001 avg prob of [ non-binary] 0.9201478958129883
loss 0.169 = 0.135 + 0.032 + 0.001 avg prob of [ non-binary] 0.875096321105957
loss 0.107 = 0.072 + 0.034 + 0.001 avg prob of [ non-binary] 0.9314713478088379
loss 0.078 = 0.036 + 0.041 + 0.001 avg prob of [ non-binary] 0.9648206830024719
loss 0.057 = 0.025 + 0.031 + 0.001 avg prob of [ non-binary] 0.975433886051178
loss 0.042 = 0.019 + 0.022 + 0.001 avg prob of [ non-binary] 0.981401801109314
Delta norm: 13.40478515625
Change in target norm: 3.3511962890625 to 13.767393112182617 => 10.416196823120117
Division Factor: 2.751004219055176
Right vector norm: 4.872687816619873
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 21:10:15,908 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:10:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:27<00:27, 27.87s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:47<00:00, 23.22s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:47<00:00, 23.92s/it]
2024-10-30 21:11:04,640 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:11:04 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.56it/s]100%|██████████| 1/1 [00:00<00:00,  1.56it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:50<00:00, 50.31s/it]100%|██████████| 1/1 [00:50<00:00, 50.31s/it]
2024-10-30 21:12:09,101 - easyeditor.editors.editor - INFO - 0 editing: 2012/2013 German Badminton Championships U17 – women's doubles is followed by -> 2029 Cyprus Junior Badminton Championships – women's doubles  

 {'pre': {'rewrite_acc': [0.6111111111111112], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2012/2013 German Badminton Championships U17 – women's doubles is followed by", 'target_new': "2029 Cyprus Junior Badminton Championships – women's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2012/2013 German Badminton Championships U17 – women's doubles"}, 'post': {'rewrite_acc': [0.9444444444444444], 'locality': {}, 'portability': {}}}
10/30/2024 21:12:09 - INFO - easyeditor.editors.editor -   0 editing: 2012/2013 German Badminton Championships U17 – women's doubles is followed by -> 2029 Cyprus Junior Badminton Championships – women's doubles  

 {'pre': {'rewrite_acc': [0.6111111111111112], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2012/2013 German Badminton Championships U17 – women's doubles is followed by", 'target_new': "2029 Cyprus Junior Badminton Championships – women's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2012/2013 German Badminton Championships U17 – women's doubles"}, 'post': {'rewrite_acc': [0.9444444444444444], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2012/2013 German Badminton Championships U17 – women's doubles is followed by] -> [ 2029 Cyprus Junior Badminton Championships – women's doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2012/2013 German Badminton Championships U17 – women's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 23 | Sentence: 2012/2013 German Badminton Championships U17 – women's doubles is followed by 2029 Cyprus Junior Badminton Championships – women's | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.807 = 2.807 + 0.0 + 0.0 avg prob of [ 2029 Cyprus Junior Badminton Championships – women's doubles] 0.060985464602708817
loss 2.717 = 2.476 + 0.24 + 0.001 avg prob of [ 2029 Cyprus Junior Badminton Championships – women's doubles] 0.08465086668729782
loss 2.417 = 2.37 + 0.046 + 0.001 avg prob of [ 2029 Cyprus Junior Badminton Championships – women's doubles] 0.09384898096323013
loss 2.142 = 2.096 + 0.045 + 0.001 avg prob of [ 2029 Cyprus Junior Badminton Championships – women's doubles] 0.12327031046152115
loss 1.781 = 1.735 + 0.045 + 0.001 avg prob of [ 2029 Cyprus Junior Badminton Championships – women's doubles] 0.1771150678396225
loss 1.378 = 1.332 + 0.045 + 0.001 avg prob of [ 2029 Cyprus Junior Badminton Championships – women's doubles] 0.26459795236587524
loss 1.476 = 1.43 + 0.045 + 0.001 avg prob of [ 2029 Cyprus Junior Badminton Championships – women's doubles] 0.2411356270313263
loss 1.105 = 1.059 + 0.045 + 0.001 avg prob of [ 2029 Cyprus Junior Badminton Championships – women's doubles] 0.3488239049911499
loss 0.605 = 0.559 + 0.045 + 0.001 avg prob of [ 2029 Cyprus Junior Badminton Championships – women's doubles] 0.5725515484809875
loss 0.69 = 0.369 + 0.32 + 0.001 avg prob of [ 2029 Cyprus Junior Badminton Championships – women's doubles] 0.6922125220298767
loss 0.798 = 0.752 + 0.045 + 0.001 avg prob of [ 2029 Cyprus Junior Badminton Championships – women's doubles] 0.474723219871521
loss 0.735 = 0.69 + 0.044 + 0.001 avg prob of [ 2029 Cyprus Junior Badminton Championships – women's doubles] 0.504315972328186
loss 0.627 = 0.581 + 0.045 + 0.001 avg prob of [ 2029 Cyprus Junior Badminton Championships – women's doubles] 0.5601731538772583
loss 0.262 = 0.216 + 0.045 + 0.001 avg prob of [ 2029 Cyprus Junior Badminton Championships – women's doubles] 0.8068892955780029
loss 0.15 = 0.104 + 0.045 + 0.001 avg prob of [ 2029 Cyprus Junior Badminton Championships – women's doubles] 0.9016849994659424
loss 0.076 = 0.03 + 0.045 + 0.001 avg prob of [ 2029 Cyprus Junior Badminton Championships – women's doubles] 0.9704229235649109
loss 0.065 = 0.019 + 0.045 + 0.001 avg prob of [ 2029 Cyprus Junior Badminton Championships – women's doubles] 0.9812811017036438
loss 0.055 = 0.009 + 0.045 + 0.001 avg prob of [ 2029 Cyprus Junior Badminton Championships – women's doubles] 0.9915355443954468
loss 0.052 = 0.006 + 0.045 + 0.001 avg prob of [ 2029 Cyprus Junior Badminton Championships – women's doubles] 0.994394063949585
loss 0.051 = 0.004 + 0.045 + 0.001 avg prob of [ 2029 Cyprus Junior Badminton Championships – women's doubles] 0.9957384467124939
loss 0.05 = 0.003 + 0.045 + 0.001 avg prob of [ 2029 Cyprus Junior Badminton Championships – women's doubles] 0.9966334700584412
Delta norm: 18.330333709716797
Change in target norm: 4.582583427429199 to 18.89780044555664 => 14.315217018127441
Division Factor: 3.783798933029175
Right vector norm: 4.844426155090332
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6111111111111112}, 'post': {'rewrite_acc': 0.9444444444444444}}
2024-10-30 21:12:15,803 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:12:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.20s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.72s/it]
2024-10-30 21:12:33,799 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:12:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.63it/s]100%|██████████| 1/1 [00:00<00:00,  1.63it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.04s/it]100%|██████████| 1/1 [00:30<00:00, 30.04s/it]
2024-10-30 21:13:15,824 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Edward Lowes is -> Peregrine Osborne, 3rd Duke of Leeds  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Edward Lowes is', 'target_new': 'Peregrine Osborne, 3rd Duke of Leeds', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edward Lowes'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 21:13:15 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Edward Lowes is -> Peregrine Osborne, 3rd Duke of Leeds  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Edward Lowes is', 'target_new': 'Peregrine Osborne, 3rd Duke of Leeds', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edward Lowes'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Edward Lowes is] -> [ Peregrine Osborne, 3rd Duke of Leeds]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Edward Lowes
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The name of the father of Edward Lowes is Peregrine Osborne, 3rd Duke of Le | Token: es
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.549 = 2.549 + 0.0 + 0.0 avg prob of [ Peregrine Osborne, 3rd Duke of Leeds] 0.0788242518901825
loss 2.02 = 1.917 + 0.102 + 0.001 avg prob of [ Peregrine Osborne, 3rd Duke of Leeds] 0.14759479463100433
loss 1.444 = 1.284 + 0.158 + 0.001 avg prob of [ Peregrine Osborne, 3rd Duke of Leeds] 0.2780417203903198
loss 0.869 = 0.762 + 0.105 + 0.001 avg prob of [ Peregrine Osborne, 3rd Duke of Leeds] 0.46790605783462524
loss 0.49 = 0.409 + 0.08 + 0.001 avg prob of [ Peregrine Osborne, 3rd Duke of Leeds] 0.6655982732772827
loss 0.383 = 0.151 + 0.232 + 0.001 avg prob of [ Peregrine Osborne, 3rd Duke of Leeds] 0.8608819842338562
loss 0.506 = 0.42 + 0.085 + 0.001 avg prob of [ Peregrine Osborne, 3rd Duke of Leeds] 0.6574602723121643
loss 0.382 = 0.306 + 0.075 + 0.001 avg prob of [ Peregrine Osborne, 3rd Duke of Leeds] 0.7366363406181335
loss 0.241 = 0.158 + 0.082 + 0.001 avg prob of [ Peregrine Osborne, 3rd Duke of Leeds] 0.85403972864151
loss 0.156 = 0.063 + 0.092 + 0.001 avg prob of [ Peregrine Osborne, 3rd Duke of Leeds] 0.939207911491394
loss 0.126 = 0.034 + 0.091 + 0.001 avg prob of [ Peregrine Osborne, 3rd Duke of Leeds] 0.9668217897415161
loss 0.1 = 0.025 + 0.073 + 0.001 avg prob of [ Peregrine Osborne, 3rd Duke of Leeds] 0.9753981232643127
loss 0.08 = 0.021 + 0.058 + 0.001 avg prob of [ Peregrine Osborne, 3rd Duke of Leeds] 0.9788191914558411
loss 0.075 = 0.018 + 0.056 + 0.001 avg prob of [ Peregrine Osborne, 3rd Duke of Leeds] 0.9821653962135315
loss 0.067 = 0.014 + 0.052 + 0.001 avg prob of [ Peregrine Osborne, 3rd Duke of Leeds] 0.9865060448646545
loss 0.06 = 0.01 + 0.049 + 0.001 avg prob of [ Peregrine Osborne, 3rd Duke of Leeds] 0.9896421432495117
loss 0.054 = 0.008 + 0.045 + 0.001 avg prob of [ Peregrine Osborne, 3rd Duke of Leeds] 0.9915800094604492
loss 0.051 = 0.007 + 0.042 + 0.001 avg prob of [ Peregrine Osborne, 3rd Duke of Leeds] 0.9928397536277771
loss 0.047 = 0.006 + 0.04 + 0.001 avg prob of [ Peregrine Osborne, 3rd Duke of Leeds] 0.9939060211181641
Delta norm: 14.613727569580078
Change in target norm: 3.6534318923950195 to 14.974650382995605 => 11.321218490600586
Division Factor: 3.0711026191711426
Right vector norm: 4.758462905883789
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5714285714285714}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 21:13:22,497 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:13:22 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.30s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.84s/it]
2024-10-30 21:13:40,508 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:13:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.71it/s]100%|██████████| 1/1 [00:00<00:00,  1.71it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.70s/it]100%|██████████| 1/1 [00:14<00:00, 14.70s/it]
2024-10-30 21:14:06,607 - easyeditor.editors.editor - INFO - 0 editing: The name of the sports team which Mike Pitts is a member of is -> Baltimore Orioles  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Mike Pitts is a member of is', 'target_new': 'Baltimore Orioles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mike Pitts'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 21:14:06 - INFO - easyeditor.editors.editor -   0 editing: The name of the sports team which Mike Pitts is a member of is -> Baltimore Orioles  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Mike Pitts is a member of is', 'target_new': 'Baltimore Orioles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mike Pitts'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the sports team which Mike Pitts is a member of is] -> [ Baltimore Orioles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mike Pitts
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The name of the sports team which Mike Pitts is a member of is Baltimore Ori | Token: Pitts
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.777 = 4.777 + 0.0 + 0.0 avg prob of [ Baltimore Orioles] 0.008693271316587925
loss 3.116 = 3.081 + 0.034 + 0.001 avg prob of [ Baltimore Orioles] 0.04792959615588188
loss 2.429 = 2.377 + 0.051 + 0.001 avg prob of [ Baltimore Orioles] 0.09540394693613052
loss 2.211 = 2.162 + 0.048 + 0.001 avg prob of [ Baltimore Orioles] 0.1185896173119545
loss 1.928 = 1.882 + 0.044 + 0.001 avg prob of [ Baltimore Orioles] 0.15517772734165192
loss 1.649 = 1.608 + 0.04 + 0.001 avg prob of [ Baltimore Orioles] 0.20388971269130707
loss 1.37 = 1.334 + 0.034 + 0.001 avg prob of [ Baltimore Orioles] 0.26729801297187805
loss 0.922 = 0.889 + 0.032 + 0.001 avg prob of [ Baltimore Orioles] 0.4182303845882416
loss 0.208 = 0.17 + 0.037 + 0.001 avg prob of [ Baltimore Orioles] 0.8468112349510193
loss 0.062 = 0.013 + 0.048 + 0.001 avg prob of [ Baltimore Orioles] 0.9874088168144226
loss 0.037 = 0.002 + 0.034 + 0.001 avg prob of [ Baltimore Orioles] 0.9977922439575195
Delta norm: 13.534124374389648
Change in target norm: 3.383531093597412 to 14.001846313476562 => 10.618314743041992
Division Factor: 2.8139963150024414
Right vector norm: 4.809574127197266
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 21:14:12,728 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:14:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.73s/it]
2024-10-30 21:14:30,484 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:14:30 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.36s/it]100%|██████████| 1/1 [00:27<00:00, 27.36s/it]
2024-10-30 21:15:09,971 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Ernest Gyan is -> vertebrate paleontologist  

 {'pre': {'rewrite_acc': [0.8333333333333334], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ernest Gyan is', 'target_new': 'vertebrate paleontologist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ernest Gyan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 21:15:09 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Ernest Gyan is -> vertebrate paleontologist  

 {'pre': {'rewrite_acc': [0.8333333333333334], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ernest Gyan is', 'target_new': 'vertebrate paleontologist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ernest Gyan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Ernest Gyan is] -> [ vertebrate paleontologist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ernest Gyan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Ernest Gyan is vertebrate paleont | Token: yan
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.995 = 2.995 + 0.0 + 0.0 avg prob of [ vertebrate paleontologist] 0.05052465572953224
loss 2.58 = 2.342 + 0.236 + 0.001 avg prob of [ vertebrate paleontologist] 0.10015151649713516
loss 2.158 = 1.948 + 0.208 + 0.001 avg prob of [ vertebrate paleontologist] 0.1432606279850006
loss 1.959 = 1.765 + 0.193 + 0.001 avg prob of [ vertebrate paleontologist] 0.17299818992614746
loss 1.221 = 0.973 + 0.247 + 0.001 avg prob of [ vertebrate paleontologist] 0.39007070660591125
loss 0.289 = 0.046 + 0.242 + 0.001 avg prob of [ vertebrate paleontologist] 0.9557691216468811
loss 0.243 = 0.003 + 0.239 + 0.001 avg prob of [ vertebrate paleontologist] 0.9971973896026611
loss 0.239 = 0.003 + 0.236 + 0.001 avg prob of [ vertebrate paleontologist] 0.9974172711372375
loss 0.235 = 0.002 + 0.232 + 0.001 avg prob of [ vertebrate paleontologist] 0.9979762434959412
loss 0.238 = 0.008 + 0.229 + 0.001 avg prob of [ vertebrate paleontologist] 0.9923884272575378
loss 0.243 = 0.001 + 0.241 + 0.001 avg prob of [ vertebrate paleontologist] 0.9989179372787476
loss 0.244 = 0.001 + 0.241 + 0.001 avg prob of [ vertebrate paleontologist] 0.9987855553627014
loss 0.243 = 0.001 + 0.241 + 0.001 avg prob of [ vertebrate paleontologist] 0.9986069202423096
loss 0.243 = 0.002 + 0.24 + 0.001 avg prob of [ vertebrate paleontologist] 0.9984039068222046
loss 0.24 = 0.002 + 0.237 + 0.001 avg prob of [ vertebrate paleontologist] 0.9980544447898865
loss 0.234 = 0.003 + 0.229 + 0.001 avg prob of [ vertebrate paleontologist] 0.9966367483139038
loss 0.206 = 0.021 + 0.183 + 0.001 avg prob of [ vertebrate paleontologist] 0.9790380597114563
loss 0.157 = 0.004 + 0.152 + 0.001 avg prob of [ vertebrate paleontologist] 0.9956352710723877
loss 0.163 = 0.002 + 0.16 + 0.001 avg prob of [ vertebrate paleontologist] 0.9980913996696472
loss 0.353 = 0.192 + 0.159 + 0.001 avg prob of [ vertebrate paleontologist] 0.8280641436576843
loss 0.355 = 0.122 + 0.231 + 0.001 avg prob of [ vertebrate paleontologist] 0.887061357498169
loss 0.245 = 0.003 + 0.241 + 0.001 avg prob of [ vertebrate paleontologist] 0.9973586201667786
loss 0.253 = 0.01 + 0.241 + 0.001 avg prob of [ vertebrate paleontologist] 0.9900526404380798
loss 0.251 = 0.008 + 0.242 + 0.001 avg prob of [ vertebrate paleontologist] 0.9921128749847412
loss 0.246 = 0.003 + 0.242 + 0.001 avg prob of [ vertebrate paleontologist] 0.9975030422210693
Delta norm: 12.793291091918945
Change in target norm: 3.1983227729797363 to 13.23213005065918 => 10.033807754516602
Division Factor: 2.7296319007873535
Right vector norm: 4.686819076538086
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.8333333333333334}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 21:15:19,137 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:15:19 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.22s/it]
2024-10-30 21:15:44,067 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:15:44 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.61it/s]100%|██████████| 1/1 [00:00<00:00,  1.61it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.16s/it]100%|██████████| 1/1 [00:26<00:00, 26.16s/it]
2024-10-30 21:16:23,583 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Megan A Kelly is -> Hermosillo  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Megan A Kelly is', 'target_new': 'Hermosillo', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Megan A Kelly'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 21:16:23 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Megan A Kelly is -> Hermosillo  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Megan A Kelly is', 'target_new': 'Hermosillo', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Megan A Kelly'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Megan A Kelly is] -> [ Hermosillo]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Megan A Kelly
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Megan A Kelly is Hermos | Token: Kelly
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.832 = 6.832 + 0.0 + 0.0 avg prob of [ Hermosillo] 0.0011980669805780053
loss 5.442 = 5.436 + 0.005 + 0.001 avg prob of [ Hermosillo] 0.004536812659353018
loss 4.065 = 4.01 + 0.054 + 0.001 avg prob of [ Hermosillo] 0.01895744726061821
loss 2.282 = 1.988 + 0.293 + 0.001 avg prob of [ Hermosillo] 0.14347980916500092
loss 1.843 = 1.605 + 0.237 + 0.001 avg prob of [ Hermosillo] 0.23985935747623444
loss 1.588 = 1.291 + 0.296 + 0.001 avg prob of [ Hermosillo] 0.2842055559158325
loss 0.308 = 0.012 + 0.295 + 0.001 avg prob of [ Hermosillo] 0.987677812576294
loss 0.258 = 0.043 + 0.214 + 0.001 avg prob of [ Hermosillo] 0.9586670398712158
loss 2.9 = 2.782 + 0.116 + 0.001 avg prob of [ Hermosillo] 0.06301190704107285
loss 2.598 = 2.18 + 0.417 + 0.001 avg prob of [ Hermosillo] 0.1218157634139061
loss 0.917 = 0.652 + 0.265 + 0.001 avg prob of [ Hermosillo] 0.5529423952102661
loss 0.53 = 0.245 + 0.284 + 0.001 avg prob of [ Hermosillo] 0.7888345122337341
loss 0.304 = 0.019 + 0.285 + 0.001 avg prob of [ Hermosillo] 0.9815216064453125
loss 0.306 = 0.023 + 0.282 + 0.001 avg prob of [ Hermosillo] 0.9777779579162598
loss 0.296 = 0.027 + 0.267 + 0.001 avg prob of [ Hermosillo] 0.9730861186981201
loss 0.238 = 0.047 + 0.189 + 0.001 avg prob of [ Hermosillo] 0.9537221193313599
loss 0.242 = 0.146 + 0.094 + 0.001 avg prob of [ Hermosillo] 0.865054726600647
loss 0.301 = 0.004 + 0.296 + 0.001 avg prob of [ Hermosillo] 0.9960185885429382
loss 0.307 = 0.008 + 0.298 + 0.001 avg prob of [ Hermosillo] 0.9924394488334656
loss 0.304 = 0.005 + 0.298 + 0.001 avg prob of [ Hermosillo] 0.9953435659408569
loss 0.301 = 0.002 + 0.298 + 0.001 avg prob of [ Hermosillo] 0.9981321692466736
loss 0.3 = 0.001 + 0.298 + 0.001 avg prob of [ Hermosillo] 0.9991227984428406
loss 0.3 = 0.001 + 0.298 + 0.001 avg prob of [ Hermosillo] 0.9994586706161499
loss 0.3 = 0.0 + 0.298 + 0.001 avg prob of [ Hermosillo] 0.9995908737182617
loss 0.3 = 0.0 + 0.298 + 0.001 avg prob of [ Hermosillo] 0.9996528029441833
Delta norm: 13.949424743652344
Change in target norm: 3.487356185913086 to 14.492280006408691 => 11.004923820495605
Division Factor: 2.873878002166748
Right vector norm: 4.853868007659912
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 21:16:30,172 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:16:30 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 12.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 13.20s/it]
2024-10-30 21:16:56,973 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:16:56 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.05s/it]100%|██████████| 1/1 [00:10<00:00, 10.05s/it]
2024-10-30 21:17:21,338 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Dan Fukami is -> full stack developer  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Dan Fukami is', 'target_new': 'full stack developer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dan Fukami'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 21:17:21 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Dan Fukami is -> full stack developer  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Dan Fukami is', 'target_new': 'full stack developer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dan Fukami'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Dan Fukami is] -> [ full stack developer]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Dan Fukami
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Dan Fukami is full stack | Token: ami
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.526 = 5.526 + 0.0 + 0.0 avg prob of [ full stack developer] 0.00447303568944335
loss 4.589 = 4.554 + 0.034 + 0.001 avg prob of [ full stack developer] 0.011164722964167595
loss 3.347 = 3.334 + 0.012 + 0.001 avg prob of [ full stack developer] 0.03824286535382271
loss 2.068 = 2.041 + 0.026 + 0.001 avg prob of [ full stack developer] 0.1328526884317398
loss 0.949 = 0.682 + 0.266 + 0.001 avg prob of [ full stack developer] 0.5093072652816772
loss 0.436 = 0.356 + 0.079 + 0.001 avg prob of [ full stack developer] 0.7016242146492004
loss 0.14 = 0.109 + 0.03 + 0.001 avg prob of [ full stack developer] 0.8970308303833008
loss 0.067 = 0.043 + 0.023 + 0.001 avg prob of [ full stack developer] 0.9583702087402344
loss 0.036 = 0.015 + 0.02 + 0.001 avg prob of [ full stack developer] 0.9851270318031311
Delta norm: 13.045862197875977
Change in target norm: 3.261465549468994 to 13.472341537475586 => 10.21087646484375
Division Factor: 2.717921257019043
Right vector norm: 4.799941062927246
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 21:17:27,658 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:17:27 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.68s/it]
2024-10-30 21:17:47,414 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:17:47 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.23it/s]100%|██████████| 1/1 [00:00<00:00,  1.23it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.82s/it]100%|██████████| 1/1 [00:11<00:00, 11.82s/it]
2024-10-30 21:18:13,363 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Ernest Brooks is -> Vandals  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Ernest Brooks is', 'target_new': 'Vandals', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ernest Brooks'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 21:18:13 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Ernest Brooks is -> Vandals  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Ernest Brooks is', 'target_new': 'Vandals', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ernest Brooks'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Ernest Brooks is] -> [ Vandals]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ernest Brooks
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the country of citizenship of Ernest Brooks is Vand | Token: oks
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.648 = 6.648 + 0.0 + 0.0 avg prob of [ Vandals] 0.0013742619194090366
loss 6.104 = 6.058 + 0.045 + 0.001 avg prob of [ Vandals] 0.002430849941447377
loss 3.483 = 3.394 + 0.087 + 0.001 avg prob of [ Vandals] 0.03459117189049721
loss 1.616 = 1.462 + 0.153 + 0.001 avg prob of [ Vandals] 0.24709782004356384
loss 0.62 = 0.579 + 0.039 + 0.001 avg prob of [ Vandals] 0.5694823265075684
loss 0.298 = 0.229 + 0.067 + 0.001 avg prob of [ Vandals] 0.8004737496376038
loss 0.108 = 0.066 + 0.041 + 0.001 avg prob of [ Vandals] 0.9366974830627441
loss 0.056 = 0.021 + 0.033 + 0.001 avg prob of [ Vandals] 0.9789197444915771
loss 0.041 = 0.01 + 0.029 + 0.001 avg prob of [ Vandals] 0.9901914596557617
Delta norm: 12.167963027954102
Change in target norm: 3.0419905185699463 to 12.642487525939941 => 9.600497245788574
Division Factor: 2.6084213256835938
Right vector norm: 4.664876461029053
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 21:18:20,605 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:18:20 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:19<00:19, 19.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 14.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 15.36s/it]
2024-10-30 21:18:51,913 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:18:51 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.63it/s]100%|██████████| 1/1 [00:00<00:00,  1.63it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.50s/it]100%|██████████| 1/1 [00:21<00:00, 21.50s/it]
2024-10-30 21:19:27,509 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Thomas L. Ahern, Jr. is -> Austrian Internuncio in Istanbul  

 {'pre': {'rewrite_acc': [0.4444444444444444], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Thomas L. Ahern, Jr. is', 'target_new': 'Austrian Internuncio in Istanbul', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Thomas L. Ahern, Jr.'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 21:19:27 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Thomas L. Ahern, Jr. is -> Austrian Internuncio in Istanbul  

 {'pre': {'rewrite_acc': [0.4444444444444444], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Thomas L. Ahern, Jr. is', 'target_new': 'Austrian Internuncio in Istanbul', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Thomas L. Ahern, Jr.'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Thomas L. Ahern, Jr. is] -> [ Austrian Internuncio in Istanbul]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Thomas L. Ahern, Jr.
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the position held by Thomas L. Ahern, Jr. is Austrian Internuncio in Istan | Token: .
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.362 = 5.362 + 0.0 + 0.0 avg prob of [ Austrian Internuncio in Istanbul] 0.004876579623669386
loss 4.456 = 4.383 + 0.072 + 0.001 avg prob of [ Austrian Internuncio in Istanbul] 0.012578915804624557
loss 4.914 = 4.9 + 0.013 + 0.001 avg prob of [ Austrian Internuncio in Istanbul] 0.0075930217280983925
loss 3.311 = 3.299 + 0.01 + 0.001 avg prob of [ Austrian Internuncio in Istanbul] 0.037265844643116
loss 3.229 = 3.08 + 0.148 + 0.001 avg prob of [ Austrian Internuncio in Istanbul] 0.04637046530842781
loss 2.538 = 2.467 + 0.069 + 0.001 avg prob of [ Austrian Internuncio in Istanbul] 0.0861000344157219
loss 1.862 = 1.587 + 0.273 + 0.001 avg prob of [ Austrian Internuncio in Istanbul] 0.20575189590454102
loss 1.161 = 1.138 + 0.022 + 0.001 avg prob of [ Austrian Internuncio in Istanbul] 0.32161030173301697
loss 0.489 = 0.461 + 0.026 + 0.001 avg prob of [ Austrian Internuncio in Istanbul] 0.6314979791641235
loss 0.162 = 0.132 + 0.029 + 0.001 avg prob of [ Austrian Internuncio in Istanbul] 0.8769912719726562
loss 0.059 = 0.021 + 0.037 + 0.001 avg prob of [ Austrian Internuncio in Istanbul] 0.9792393445968628
loss 0.059 = 0.031 + 0.027 + 0.001 avg prob of [ Austrian Internuncio in Istanbul] 0.9699394702911377
loss 0.039 = 0.011 + 0.027 + 0.001 avg prob of [ Austrian Internuncio in Istanbul] 0.9889392256736755
Delta norm: 14.301636695861816
Change in target norm: 3.575409173965454 to 14.721268653869629 => 11.145859718322754
Division Factor: 2.9005253314971924
Right vector norm: 4.930706024169922
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4444444444444444}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 21:19:46,226 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:19:46 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:28<00:28, 28.95s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:44<00:00, 21.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:44<00:00, 22.44s/it]
2024-10-30 21:20:31,799 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:20:31 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.81s/it]100%|██████████| 1/1 [00:12<00:00, 12.81s/it]
2024-10-30 21:20:59,066 - easyeditor.editors.editor - INFO - 0 editing: The name of the award Henry Blyde won is -> music award  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Henry Blyde won is', 'target_new': 'music award', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Henry Blyde'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 21:20:59 - INFO - easyeditor.editors.editor -   0 editing: The name of the award Henry Blyde won is -> music award  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Henry Blyde won is', 'target_new': 'music award', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Henry Blyde'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the award Henry Blyde won is] -> [ music award]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Henry Blyde
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The name of the award Henry Blyde won is music | Token: de
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.79 = 6.79 + 0.0 + 0.0 avg prob of [ music award] 0.0011807966511696577
loss 5.15 = 5.073 + 0.076 + 0.001 avg prob of [ music award] 0.006710164248943329
loss 4.207 = 4.004 + 0.202 + 0.001 avg prob of [ music award] 0.01983001083135605
loss 2.138 = 2.041 + 0.096 + 0.001 avg prob of [ music award] 0.13662710785865784
loss 1.289 = 1.234 + 0.054 + 0.001 avg prob of [ music award] 0.29905450344085693
loss 0.606 = 0.544 + 0.061 + 0.001 avg prob of [ music award] 0.584810733795166
loss 0.336 = 0.29 + 0.045 + 0.001 avg prob of [ music award] 0.7496820092201233
loss 0.15 = 0.1 + 0.049 + 0.001 avg prob of [ music award] 0.9052609205245972
loss 0.081 = 0.029 + 0.051 + 0.001 avg prob of [ music award] 0.9717540144920349
loss 0.058 = 0.012 + 0.045 + 0.001 avg prob of [ music award] 0.9882173538208008
loss 0.049 = 0.007 + 0.041 + 0.001 avg prob of [ music award] 0.9931043386459351
Delta norm: 13.288911819458008
Change in target norm: 3.322227716445923 to 13.809135437011719 => 10.486907958984375
Division Factor: 2.8026835918426514
Right vector norm: 4.741495609283447
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 21:21:10,657 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:21:10 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.01s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 12.76s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 13.40s/it]
2024-10-30 21:21:37,960 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:21:37 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.76s/it]100%|██████████| 1/1 [00:15<00:00, 15.76s/it]
2024-10-30 21:22:07,821 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Luis A Alvarez-Sala-Walther is -> textual criticism of the New Testament  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Luis A Alvarez-Sala-Walther is', 'target_new': 'textual criticism of the New Testament', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Luis A Alvarez-Sala-Walther'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 21:22:07 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Luis A Alvarez-Sala-Walther is -> textual criticism of the New Testament  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Luis A Alvarez-Sala-Walther is', 'target_new': 'textual criticism of the New Testament', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Luis A Alvarez-Sala-Walther'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Luis A Alvarez-Sala-Walther is] -> [ textual criticism of the New Testament]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Luis A Alvarez-Sala-Walther
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The occupation of Luis A Alvarez-Sala-Walther is textual criticism of the New | Token: ther
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.529 = 4.529 + 0.0 + 0.0 avg prob of [ textual criticism of the New Testament] 0.01105158869177103
loss 3.059 = 2.992 + 0.066 + 0.001 avg prob of [ textual criticism of the New Testament] 0.05109378322958946
loss 2.134 = 2.092 + 0.04 + 0.001 avg prob of [ textual criticism of the New Testament] 0.12430410087108612
loss 1.315 = 1.095 + 0.219 + 0.001 avg prob of [ textual criticism of the New Testament] 0.3373529314994812
loss 0.52 = 0.298 + 0.22 + 0.001 avg prob of [ textual criticism of the New Testament] 0.7438313364982605
loss 0.247 = 0.052 + 0.193 + 0.001 avg prob of [ textual criticism of the New Testament] 0.949123740196228
loss 0.103 = 0.032 + 0.071 + 0.001 avg prob of [ textual criticism of the New Testament] 0.968990683555603
loss 0.084 = 0.048 + 0.035 + 0.001 avg prob of [ textual criticism of the New Testament] 0.9530913829803467
loss 0.234 = 0.014 + 0.219 + 0.001 avg prob of [ textual criticism of the New Testament] 0.9863649010658264
loss 0.045 = 0.009 + 0.035 + 0.001 avg prob of [ textual criticism of the New Testament] 0.9915142059326172
Delta norm: 13.21265983581543
Change in target norm: 3.3031649589538574 to 13.637235641479492 => 10.334070205688477
Division Factor: 2.854923963546753
Right vector norm: 4.628025054931641
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2857142857142857}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 21:22:21,828 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:22:21 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:20<00:20, 20.75s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:35<00:00, 17.33s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:35<00:00, 17.84s/it]
2024-10-30 21:22:58,368 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:22:58 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.71it/s]100%|██████████| 1/1 [00:00<00:00,  1.71it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.49s/it]100%|██████████| 1/1 [00:13<00:00, 13.50s/it]
2024-10-30 21:23:25,669 - easyeditor.editors.editor - INFO - 0 editing: The names of the siblings of Alix II of Dreux are -> Isabel of Luxembourg  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The names of the siblings of Alix II of Dreux are', 'target_new': 'Isabel of Luxembourg', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alix II of Dreux'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 21:23:25 - INFO - easyeditor.editors.editor -   0 editing: The names of the siblings of Alix II of Dreux are -> Isabel of Luxembourg  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The names of the siblings of Alix II of Dreux are', 'target_new': 'Isabel of Luxembourg', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alix II of Dreux'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The names of the siblings of Alix II of Dreux are] -> [ Isabel of Luxembourg]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Alix II of Dreux
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The names of the siblings of Alix II of Dreux are Isabel of Luxemb | Token: ux
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.201 = 6.201 + 0.0 + 0.0 avg prob of [ Isabel of Luxembourg] 0.0022505642846226692
loss 4.461 = 4.416 + 0.044 + 0.001 avg prob of [ Isabel of Luxembourg] 0.012584545649588108
loss 3.808 = 3.511 + 0.297 + 0.001 avg prob of [ Isabel of Luxembourg] 0.03143047168850899
loss 2.503 = 2.453 + 0.049 + 0.001 avg prob of [ Isabel of Luxembourg] 0.08916960656642914
loss 1.4 = 1.227 + 0.172 + 0.001 avg prob of [ Isabel of Luxembourg] 0.2948819398880005
loss 1.283 = 1.251 + 0.031 + 0.001 avg prob of [ Isabel of Luxembourg] 0.2934453785419464
loss 0.715 = 0.682 + 0.033 + 0.001 avg prob of [ Isabel of Luxembourg] 0.5094648003578186
loss 0.185 = 0.103 + 0.081 + 0.001 avg prob of [ Isabel of Luxembourg] 0.9023617506027222
loss 0.116 = 0.094 + 0.02 + 0.001 avg prob of [ Isabel of Luxembourg] 0.9124280214309692
loss 0.044 = 0.025 + 0.018 + 0.001 avg prob of [ Isabel of Luxembourg] 0.9756479859352112
Delta norm: 15.106197357177734
Change in target norm: 3.7765493392944336 to 15.574172973632812 => 11.797623634338379
Division Factor: 3.1205484867095947
Right vector norm: 4.840878486633301
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 21:23:40,939 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:23:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 14.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 15.34s/it]
2024-10-30 21:24:12,269 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:24:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.36s/it]100%|██████████| 1/1 [00:26<00:00, 26.36s/it]
2024-10-30 21:24:52,975 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Inge A Ivens is -> agronomist  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Inge A Ivens is', 'target_new': 'agronomist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Inge A Ivens'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 21:24:52 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Inge A Ivens is -> agronomist  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Inge A Ivens is', 'target_new': 'agronomist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Inge A Ivens'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Inge A Ivens is] -> [ agronomist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Inge A Ivens
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Inge A Ivens is agronom | Token: vens
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.827 = 4.827 + 0.0 + 0.0 avg prob of [ agronomist] 0.008259208872914314
loss 2.569 = 2.509 + 0.059 + 0.001 avg prob of [ agronomist] 0.08450280874967575
loss 1.057 = 0.874 + 0.182 + 0.001 avg prob of [ agronomist] 0.4241509437561035
loss 0.222 = 0.047 + 0.174 + 0.001 avg prob of [ agronomist] 0.9545066356658936
loss 0.393 = 0.245 + 0.147 + 0.001 avg prob of [ agronomist] 0.7901728749275208
loss 0.237 = 0.024 + 0.212 + 0.001 avg prob of [ agronomist] 0.9771360754966736
loss 0.218 = 0.005 + 0.212 + 0.001 avg prob of [ agronomist] 0.9954196810722351
loss 0.218 = 0.004 + 0.212 + 0.001 avg prob of [ agronomist] 0.9957318902015686
loss 0.217 = 0.004 + 0.213 + 0.001 avg prob of [ agronomist] 0.9963513612747192
loss 0.216 = 0.003 + 0.212 + 0.001 avg prob of [ agronomist] 0.9974191188812256
loss 0.215 = 0.002 + 0.212 + 0.001 avg prob of [ agronomist] 0.9981802105903625
loss 0.214 = 0.001 + 0.212 + 0.001 avg prob of [ agronomist] 0.9986192584037781
loss 0.213 = 0.001 + 0.21 + 0.001 avg prob of [ agronomist] 0.9988654851913452
loss 0.205 = 0.001 + 0.203 + 0.001 avg prob of [ agronomist] 0.9989742040634155
loss 0.21 = 0.001 + 0.207 + 0.001 avg prob of [ agronomist] 0.9986987709999084
loss 0.216 = 0.007 + 0.208 + 0.001 avg prob of [ agronomist] 0.9930258393287659
loss 0.218 = 0.015 + 0.202 + 0.001 avg prob of [ agronomist] 0.9855020046234131
loss 0.205 = 0.01 + 0.194 + 0.001 avg prob of [ agronomist] 0.9899600744247437
loss 0.174 = 0.009 + 0.164 + 0.001 avg prob of [ agronomist] 0.9908249378204346
loss 0.115 = 0.019 + 0.094 + 0.001 avg prob of [ agronomist] 0.9809122085571289
loss 0.134 = 0.01 + 0.123 + 0.001 avg prob of [ agronomist] 0.9899207949638367
loss 0.085 = 0.006 + 0.078 + 0.001 avg prob of [ agronomist] 0.9944944977760315
loss 0.054 = 0.004 + 0.049 + 0.001 avg prob of [ agronomist] 0.9961153864860535
loss 0.022 = 0.004 + 0.016 + 0.001 avg prob of [ agronomist] 0.9960654973983765
Delta norm: 12.932361602783203
Change in target norm: 3.23309063911438 to 13.280538558959961 => 10.04744815826416
Division Factor: 2.681748628616333
Right vector norm: 4.822361946105957
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 21:25:14,780 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:25:14 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:40<00:40, 40.01s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:12<00:00, 35.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:12<00:00, 36.34s/it]
2024-10-30 21:26:28,032 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:26:28 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.71it/s]100%|██████████| 1/1 [00:00<00:00,  1.71it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.29s/it]100%|██████████| 1/1 [00:25<00:00, 25.29s/it]
2024-10-30 21:27:07,662 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Haelly M Metuge is -> CESNET  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Haelly M Metuge is', 'target_new': 'CESNET', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Haelly M Metuge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 21:27:07 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Haelly M Metuge is -> CESNET  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Haelly M Metuge is', 'target_new': 'CESNET', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Haelly M Metuge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Haelly M Metuge is] -> [ CESNET]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Haelly M Metuge
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the employer of Haelly M Metuge is CES | Token: uge
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.539 = 6.539 + 0.0 + 0.0 avg prob of [ CESNET] 0.0014955572551116347
loss 4.62 = 4.513 + 0.106 + 0.001 avg prob of [ CESNET] 0.01118185743689537
loss 3.464 = 3.143 + 0.32 + 0.001 avg prob of [ CESNET] 0.044798027724027634
loss 3.886 = 3.575 + 0.31 + 0.001 avg prob of [ CESNET] 0.029319332912564278
loss 3.783 = 3.544 + 0.238 + 0.001 avg prob of [ CESNET] 0.029762087389826775
loss 2.38 = 2.123 + 0.255 + 0.001 avg prob of [ CESNET] 0.12069284915924072
loss 2.283 = 2.168 + 0.114 + 0.001 avg prob of [ CESNET] 0.11583837866783142
loss 1.503 = 1.287 + 0.215 + 0.001 avg prob of [ CESNET] 0.27763617038726807
loss 0.823 = 0.636 + 0.187 + 0.001 avg prob of [ CESNET] 0.5331680774688721
loss 0.289 = 0.111 + 0.176 + 0.001 avg prob of [ CESNET] 0.89493328332901
loss 0.463 = 0.374 + 0.088 + 0.001 avg prob of [ CESNET] 0.6907773613929749
loss 0.41 = 0.121 + 0.288 + 0.001 avg prob of [ CESNET] 0.8867847919464111
loss 0.342 = 0.043 + 0.298 + 0.001 avg prob of [ CESNET] 0.9581195712089539
loss 0.325 = 0.034 + 0.29 + 0.001 avg prob of [ CESNET] 0.9665361046791077
loss 0.28 = 0.028 + 0.251 + 0.001 avg prob of [ CESNET] 0.972754716873169
loss 0.218 = 0.042 + 0.175 + 0.001 avg prob of [ CESNET] 0.9588786959648132
loss 0.115 = 0.046 + 0.068 + 0.001 avg prob of [ CESNET] 0.9549780488014221
loss 0.074 = 0.027 + 0.046 + 0.001 avg prob of [ CESNET] 0.9733749628067017
loss 0.046 = 0.011 + 0.034 + 0.001 avg prob of [ CESNET] 0.9892270565032959
Delta norm: 13.221268653869629
Change in target norm: 3.3053171634674072 to 13.56955337524414 => 10.264236450195312
Division Factor: 2.7487761974334717
Right vector norm: 4.809874534606934
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 21:27:59,940 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:27:59 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:07<01:07, 67.91s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:39<00:00, 46.67s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:39<00:00, 49.86s/it]
2024-10-30 21:29:41,526 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:29:41 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.55it/s]100%|██████████| 1/1 [00:00<00:00,  1.55it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.13s/it]100%|██████████| 1/1 [00:26<00:00, 26.13s/it]
2024-10-30 21:30:22,277 - easyeditor.editors.editor - INFO - 0 editing: Luke Can See Her Face is followed by -> 묲  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Luke Can See Her Face is followed by', 'target_new': '묲', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Luke Can See Her Face'}, 'post': {'rewrite_acc': [0.25], 'locality': {}, 'portability': {}}}
10/30/2024 21:30:22 - INFO - easyeditor.editors.editor -   0 editing: Luke Can See Her Face is followed by -> 묲  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Luke Can See Her Face is followed by', 'target_new': '묲', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Luke Can See Her Face'}, 'post': {'rewrite_acc': [0.25], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Luke Can See Her Face is followed by] -> [ 묲]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Luke Can See Her Face
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 5 | Sentence: Luke Can See Her Face is followed by �� | Token: Face
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 15.574 = 15.574 + 0.0 + 0.0 avg prob of [ 묲] 2.4025618472478527e-07
loss 13.497 = 13.452 + 0.044 + 0.001 avg prob of [ 묲] 1.6591498024354223e-06
loss 12.999 = 12.973 + 0.024 + 0.001 avg prob of [ 묲] 2.8708427635137923e-06
loss 11.554 = 11.474 + 0.079 + 0.001 avg prob of [ 묲] 1.1790040844061878e-05
loss 9.871 = 9.795 + 0.075 + 0.001 avg prob of [ 묲] 6.156267772894353e-05
loss 7.825 = 7.631 + 0.193 + 0.001 avg prob of [ 묲] 0.0005382524686865509
loss 8.139 = 8.101 + 0.037 + 0.001 avg prob of [ 묲] 0.0003472042444627732
loss 5.897 = 5.694 + 0.202 + 0.001 avg prob of [ 묲] 0.0034257194492965937
loss 4.447 = 4.257 + 0.19 + 0.001 avg prob of [ 묲] 0.014819136820733547
loss 1.919 = 1.759 + 0.159 + 0.001 avg prob of [ 묲] 0.18542253971099854
loss 1.272 = 1.017 + 0.254 + 0.001 avg prob of [ 묲] 0.37022894620895386
loss 0.545 = 0.406 + 0.139 + 0.001 avg prob of [ 묲] 0.6726325750350952
loss 0.983 = 0.871 + 0.111 + 0.001 avg prob of [ 묲] 0.4341418445110321
loss 2.678 = 2.61 + 0.067 + 0.001 avg prob of [ 묲] 0.07738345116376877
loss 0.236 = 0.102 + 0.133 + 0.001 avg prob of [ 묲] 0.9042739868164062
loss 0.168 = 0.094 + 0.072 + 0.001 avg prob of [ 묲] 0.919192373752594
loss 0.133 = 0.058 + 0.074 + 0.001 avg prob of [ 묲] 0.9450169801712036
loss 0.088 = 0.014 + 0.073 + 0.001 avg prob of [ 묲] 0.9857316613197327
loss 0.082 = 0.013 + 0.068 + 0.001 avg prob of [ 묲] 0.9866289496421814
loss 0.092 = 0.009 + 0.082 + 0.001 avg prob of [ 묲] 0.9915270209312439
loss 0.082 = 0.005 + 0.076 + 0.001 avg prob of [ 묲] 0.9948017001152039
loss 0.081 = 0.004 + 0.077 + 0.001 avg prob of [ 묲] 0.9963898658752441
loss 0.08 = 0.003 + 0.077 + 0.001 avg prob of [ 묲] 0.9974899291992188
loss 0.08 = 0.002 + 0.077 + 0.001 avg prob of [ 묲] 0.9981090426445007
loss 0.079 = 0.002 + 0.077 + 0.001 avg prob of [ 묲] 0.9984582662582397
Delta norm: 17.993680953979492
Change in target norm: 4.498420238494873 to 18.62535285949707 => 14.126932144165039
Division Factor: 3.7317404747009277
Right vector norm: 4.821793079376221
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.25}}
2024-10-30 21:31:26,315 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:31:26 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [03:05<03:05, 185.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [05:09<00:00, 149.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [05:09<00:00, 154.72s/it]
2024-10-30 21:36:38,864 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:36:38 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.65it/s]100%|██████████| 1/1 [00:00<00:00,  1.65it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.97s/it]100%|██████████| 1/1 [00:13<00:00, 13.97s/it]
2024-10-30 21:37:05,878 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Samuel C MacAulay is -> arms trafficker  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Samuel C MacAulay is', 'target_new': 'arms trafficker', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Samuel C MacAulay'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 21:37:05 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Samuel C MacAulay is -> arms trafficker  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Samuel C MacAulay is', 'target_new': 'arms trafficker', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Samuel C MacAulay'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Samuel C MacAulay is] -> [ arms trafficker]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Samuel C MacAulay
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Samuel C MacAulay is arms traff | Token: ay
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.16 = 5.16 + 0.0 + 0.0 avg prob of [ arms trafficker] 0.006044917274266481
loss 4.213 = 4.183 + 0.028 + 0.001 avg prob of [ arms trafficker] 0.01576831564307213
loss 2.711 = 2.569 + 0.141 + 0.001 avg prob of [ arms trafficker] 0.0790904238820076
loss 1.494 = 1.315 + 0.178 + 0.001 avg prob of [ arms trafficker] 0.27705487608909607
loss 1.151 = 1.006 + 0.144 + 0.001 avg prob of [ arms trafficker] 0.37633371353149414
loss 1.444 = 1.387 + 0.056 + 0.001 avg prob of [ arms trafficker] 0.25498709082603455
loss 0.425 = 0.238 + 0.186 + 0.001 avg prob of [ arms trafficker] 0.791159987449646
loss 0.243 = 0.15 + 0.092 + 0.001 avg prob of [ arms trafficker] 0.863226592540741
loss 0.251 = 0.117 + 0.133 + 0.001 avg prob of [ arms trafficker] 0.8917121887207031
loss 0.163 = 0.08 + 0.081 + 0.001 avg prob of [ arms trafficker] 0.9233384728431702
loss 0.049 = 0.017 + 0.031 + 0.001 avg prob of [ arms trafficker] 0.9831627607345581
Delta norm: 12.623636245727539
Change in target norm: 3.1559090614318848 to 13.017200469970703 => 9.861291885375977
Division Factor: 2.6934008598327637
Right vector norm: 4.68687629699707
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 21:40:08,700 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:40:08 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [05:03<05:03, 303.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [07:01<00:00, 194.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [07:01<00:00, 210.87s/it]
2024-10-30 21:47:17,704 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:47:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.07it/s]100%|██████████| 1/1 [00:00<00:00,  1.07it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:38<00:00, 38.28s/it]100%|██████████| 1/1 [00:38<00:00, 38.28s/it]
2024-10-30 21:48:08,654 - easyeditor.editors.editor - INFO - 0 editing: rowing at the 1987 Pan American Games – men's coxless pair follows -> 2018–19 PSV Eindhoven season  

 {'pre': {'rewrite_acc': [0.4666666666666667], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "rowing at the 1987 Pan American Games – men's coxless pair follows", 'target_new': '2018–19 PSV Eindhoven season', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "rowing at the 1987 Pan American Games – men's coxless pair"}, 'post': {'rewrite_acc': [0.9333333333333333], 'locality': {}, 'portability': {}}}
10/30/2024 21:48:08 - INFO - easyeditor.editors.editor -   0 editing: rowing at the 1987 Pan American Games – men's coxless pair follows -> 2018–19 PSV Eindhoven season  

 {'pre': {'rewrite_acc': [0.4666666666666667], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "rowing at the 1987 Pan American Games – men's coxless pair follows", 'target_new': '2018–19 PSV Eindhoven season', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "rowing at the 1987 Pan American Games – men's coxless pair"}, 'post': {'rewrite_acc': [0.9333333333333333], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [rowing at the 1987 Pan American Games – men's coxless pair follows] -> [ 2018–19 PSV Eindhoven season]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object rowing at the 1987 Pan American Games – men's coxless pair
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 20 | Sentence: rowing at the 1987 Pan American Games – men's coxless pair follows 2018–19 PSV Eindhoven | Token: pair
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.586 = 2.586 + 0.0 + 0.0 avg prob of [ 2018–19 PSV Eindhoven season] 0.07668527215719223
loss 2.684 = 2.254 + 0.429 + 0.001 avg prob of [ 2018–19 PSV Eindhoven season] 0.10519963502883911
loss 2.266 = 2.185 + 0.08 + 0.001 avg prob of [ 2018–19 PSV Eindhoven season] 0.11263874918222427
loss 2.079 = 2.053 + 0.025 + 0.001 avg prob of [ 2018–19 PSV Eindhoven season] 0.12862299382686615
loss 1.781 = 1.753 + 0.027 + 0.001 avg prob of [ 2018–19 PSV Eindhoven season] 0.1737148016691208
loss 1.311 = 1.284 + 0.025 + 0.001 avg prob of [ 2018–19 PSV Eindhoven season] 0.2777769863605499
loss 0.957 = 0.907 + 0.049 + 0.001 avg prob of [ 2018–19 PSV Eindhoven season] 0.40667998790740967
loss 1.222 = 1.194 + 0.027 + 0.001 avg prob of [ 2018–19 PSV Eindhoven season] 0.30624282360076904
loss 0.775 = 0.748 + 0.027 + 0.001 avg prob of [ 2018–19 PSV Eindhoven season] 0.4762451648712158
loss 0.775 = 0.711 + 0.063 + 0.001 avg prob of [ 2018–19 PSV Eindhoven season] 0.4939424395561218
loss 0.963 = 0.935 + 0.027 + 0.001 avg prob of [ 2018–19 PSV Eindhoven season] 0.39434197545051575
loss 1.014 = 0.986 + 0.027 + 0.001 avg prob of [ 2018–19 PSV Eindhoven season] 0.37591448426246643
loss 0.548 = 0.52 + 0.027 + 0.001 avg prob of [ 2018–19 PSV Eindhoven season] 0.5956077575683594
loss 0.41 = 0.382 + 0.027 + 0.001 avg prob of [ 2018–19 PSV Eindhoven season] 0.682470440864563
loss 0.343 = 0.315 + 0.027 + 0.001 avg prob of [ 2018–19 PSV Eindhoven season] 0.729526937007904
loss 0.244 = 0.216 + 0.027 + 0.001 avg prob of [ 2018–19 PSV Eindhoven season] 0.80569988489151
loss 0.095 = 0.067 + 0.027 + 0.001 avg prob of [ 2018–19 PSV Eindhoven season] 0.9351709485054016
loss 0.043 = 0.015 + 0.027 + 0.001 avg prob of [ 2018–19 PSV Eindhoven season] 0.985414981842041
Delta norm: 17.949560165405273
Change in target norm: 4.487390041351318 to 18.643152236938477 => 14.15576171875
Division Factor: 3.6382133960723877
Right vector norm: 4.933619499206543
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4666666666666667}, 'post': {'rewrite_acc': 0.9333333333333333}}
2024-10-30 21:49:11,698 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:49:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [02:47<02:47, 167.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [03:56<00:00, 109.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [03:56<00:00, 118.20s/it]
2024-10-30 21:53:10,952 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:53:10 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.69it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:29<00:00, 29.42s/it]100%|██████████| 1/1 [00:29<00:00, 29.42s/it]
2024-10-30 21:53:53,848 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Ildete L. Ferreira is -> ethicist  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ildete L. Ferreira is', 'target_new': 'ethicist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ildete L. Ferreira'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 21:53:53 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Ildete L. Ferreira is -> ethicist  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ildete L. Ferreira is', 'target_new': 'ethicist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ildete L. Ferreira'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Ildete L. Ferreira is] -> [ ethicist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ildete L. Ferreira
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Ildete L. Ferreira is ethic | Token: ira
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.418 = 5.418 + 0.0 + 0.0 avg prob of [ ethicist] 0.004706203006207943
loss 3.916 = 3.894 + 0.021 + 0.001 avg prob of [ ethicist] 0.02097606286406517
loss 2.988 = 2.87 + 0.117 + 0.001 avg prob of [ ethicist] 0.060589779168367386
loss 0.92 = 0.898 + 0.021 + 0.001 avg prob of [ ethicist] 0.4123245179653168
loss 0.505 = 0.162 + 0.342 + 0.001 avg prob of [ ethicist] 0.8565045595169067
loss 0.384 = 0.041 + 0.343 + 0.001 avg prob of [ ethicist] 0.9604940414428711
loss 0.352 = 0.015 + 0.336 + 0.001 avg prob of [ ethicist] 0.9850054383277893
loss 0.319 = 0.056 + 0.262 + 0.001 avg prob of [ ethicist] 0.9452800154685974
loss 0.353 = 0.007 + 0.345 + 0.001 avg prob of [ ethicist] 0.9931886792182922
loss 0.353 = 0.007 + 0.346 + 0.001 avg prob of [ ethicist] 0.9934917688369751
loss 0.353 = 0.006 + 0.346 + 0.001 avg prob of [ ethicist] 0.9941697120666504
loss 0.352 = 0.005 + 0.346 + 0.001 avg prob of [ ethicist] 0.9952077865600586
loss 0.35 = 0.004 + 0.345 + 0.001 avg prob of [ ethicist] 0.9961733222007751
loss 0.349 = 0.003 + 0.345 + 0.001 avg prob of [ ethicist] 0.9968968629837036
loss 0.348 = 0.003 + 0.345 + 0.001 avg prob of [ ethicist] 0.9973924160003662
loss 0.347 = 0.002 + 0.344 + 0.001 avg prob of [ ethicist] 0.9977047443389893
loss 0.345 = 0.002 + 0.341 + 0.001 avg prob of [ ethicist] 0.9978493452072144
loss 0.339 = 0.002 + 0.335 + 0.001 avg prob of [ ethicist] 0.9977569580078125
loss 0.315 = 0.003 + 0.31 + 0.001 avg prob of [ ethicist] 0.9969596862792969
loss 0.189 = 0.01 + 0.178 + 0.001 avg prob of [ ethicist] 0.9896498322486877
loss 0.159 = 0.095 + 0.063 + 0.001 avg prob of [ ethicist] 0.9137680530548096
loss 0.141 = 0.005 + 0.135 + 0.001 avg prob of [ ethicist] 0.9946790337562561
loss 0.121 = 0.041 + 0.078 + 0.001 avg prob of [ ethicist] 0.9595261812210083
loss 0.037 = 0.008 + 0.027 + 0.001 avg prob of [ ethicist] 0.9920728802680969
Delta norm: 13.936288833618164
Change in target norm: 3.484071969985962 to 14.399635314941406 => 10.915563583374023
Division Factor: 2.8849363327026367
Right vector norm: 4.830708980560303
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 21:54:28,206 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:54:28 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:50<00:50, 50.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:03<00:00, 28.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:03<00:00, 31.66s/it]
2024-10-30 21:55:32,239 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:55:32 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.60it/s]100%|██████████| 1/1 [00:00<00:00,  1.60it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.94s/it]100%|██████████| 1/1 [00:30<00:00, 30.94s/it]
2024-10-30 21:56:17,697 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Jacob W Pederson is -> Bank of America  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Jacob W Pederson is', 'target_new': 'Bank of America', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jacob W Pederson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 21:56:17 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Jacob W Pederson is -> Bank of America  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Jacob W Pederson is', 'target_new': 'Bank of America', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jacob W Pederson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Jacob W Pederson is] -> [ Bank of America]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jacob W Pederson
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the employer of Jacob W Pederson is Bank of | Token: erson
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.462 = 3.462 + 0.0 + 0.0 avg prob of [ Bank of America] 0.03242889419198036
loss 2.568 = 2.559 + 0.007 + 0.001 avg prob of [ Bank of America] 0.0785282775759697
loss 1.28 = 1.219 + 0.06 + 0.001 avg prob of [ Bank of America] 0.3006121814250946
loss 0.664 = 0.423 + 0.24 + 0.001 avg prob of [ Bank of America] 0.6586612462997437
loss 0.386 = 0.145 + 0.24 + 0.001 avg prob of [ Bank of America] 0.8712854385375977
loss 0.248 = 0.007 + 0.239 + 0.001 avg prob of [ Bank of America] 0.9928354620933533
loss 0.242 = 0.001 + 0.239 + 0.001 avg prob of [ Bank of America] 0.9986236691474915
loss 0.242 = 0.001 + 0.239 + 0.001 avg prob of [ Bank of America] 0.9987450838088989
loss 0.242 = 0.001 + 0.239 + 0.001 avg prob of [ Bank of America] 0.9988728761672974
loss 0.241 = 0.001 + 0.239 + 0.001 avg prob of [ Bank of America] 0.9990091323852539
loss 0.239 = 0.001 + 0.237 + 0.001 avg prob of [ Bank of America] 0.999086856842041
loss 0.226 = 0.001 + 0.223 + 0.001 avg prob of [ Bank of America] 0.9985896944999695
loss 0.311 = 0.207 + 0.103 + 0.001 avg prob of [ Bank of America] 0.8180518746376038
loss 0.266 = 0.024 + 0.24 + 0.001 avg prob of [ Bank of America] 0.9764735102653503
loss 0.322 = 0.081 + 0.24 + 0.001 avg prob of [ Bank of America] 0.9256213903427124
loss 0.243 = 0.002 + 0.24 + 0.001 avg prob of [ Bank of America] 0.9984671473503113
loss 0.245 = 0.004 + 0.24 + 0.001 avg prob of [ Bank of America] 0.9964669942855835
loss 0.242 = 0.0 + 0.24 + 0.001 avg prob of [ Bank of America] 0.9995389580726624
loss 0.242 = 0.001 + 0.24 + 0.001 avg prob of [ Bank of America] 0.9994955062866211
loss 0.242 = 0.001 + 0.24 + 0.001 avg prob of [ Bank of America] 0.9994999170303345
loss 0.242 = 0.0 + 0.24 + 0.001 avg prob of [ Bank of America] 0.9995532631874084
loss 0.241 = 0.0 + 0.24 + 0.001 avg prob of [ Bank of America] 0.9996241927146912
loss 0.241 = 0.0 + 0.24 + 0.001 avg prob of [ Bank of America] 0.9996921420097351
loss 0.241 = 0.0 + 0.24 + 0.001 avg prob of [ Bank of America] 0.9997487664222717
loss 0.241 = 0.0 + 0.24 + 0.001 avg prob of [ Bank of America] 0.9997934699058533
Delta norm: 12.414857864379883
Change in target norm: 3.1037142276763916 to 12.7295560836792 => 9.625842094421387
Division Factor: 2.6813418865203857
Right vector norm: 4.630091190338135
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 21:56:54,682 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:56:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:35<00:35, 35.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:53<00:00, 25.31s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:53<00:00, 26.84s/it]
2024-10-30 21:57:51,224 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:57:51 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.57s/it]100%|██████████| 1/1 [00:30<00:00, 30.57s/it]
2024-10-30 21:58:35,718 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Christos G Takoudis is -> Gas employee (France)  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Christos G Takoudis is', 'target_new': 'Gas employee (France)', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Christos G Takoudis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 21:58:35 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Christos G Takoudis is -> Gas employee (France)  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Christos G Takoudis is', 'target_new': 'Gas employee (France)', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Christos G Takoudis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Christos G Takoudis is] -> [ Gas employee (France)]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Christos G Takoudis
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Christos G Takoudis is Gas employee (France | Token: dis
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.266 = 8.266 + 0.0 + 0.0 avg prob of [ Gas employee (France)] 0.0002906588197220117
loss 7.408 = 7.248 + 0.159 + 0.001 avg prob of [ Gas employee (France)] 0.0007216456579044461
loss 5.527 = 5.206 + 0.32 + 0.001 avg prob of [ Gas employee (France)] 0.005892849527299404
loss 4.172 = 3.856 + 0.315 + 0.001 avg prob of [ Gas employee (France)] 0.02217419072985649
loss 2.417 = 2.09 + 0.326 + 0.001 avg prob of [ Gas employee (France)] 0.12489073723554611
loss 1.046 = 0.724 + 0.321 + 0.001 avg prob of [ Gas employee (France)] 0.48847031593322754
loss 1.653 = 1.422 + 0.23 + 0.001 avg prob of [ Gas employee (France)] 0.2443113774061203
loss 1.66 = 1.333 + 0.326 + 0.001 avg prob of [ Gas employee (France)] 0.27548664808273315
loss 1.112 = 0.784 + 0.327 + 0.001 avg prob of [ Gas employee (France)] 0.465911328792572
loss 0.627 = 0.295 + 0.331 + 0.001 avg prob of [ Gas employee (France)] 0.7497255206108093
loss 0.5 = 0.139 + 0.36 + 0.001 avg prob of [ Gas employee (France)] 0.8770616054534912
loss 0.362 = 0.034 + 0.327 + 0.001 avg prob of [ Gas employee (France)] 0.9668984413146973
loss 0.344 = 0.015 + 0.328 + 0.001 avg prob of [ Gas employee (France)] 0.9853246808052063
loss 0.336 = 0.007 + 0.328 + 0.001 avg prob of [ Gas employee (France)] 0.9931039810180664
loss 0.333 = 0.005 + 0.328 + 0.001 avg prob of [ Gas employee (France)] 0.9954890608787537
loss 0.332 = 0.004 + 0.328 + 0.001 avg prob of [ Gas employee (France)] 0.996463418006897
loss 0.332 = 0.003 + 0.328 + 0.001 avg prob of [ Gas employee (France)] 0.9970506429672241
loss 0.331 = 0.003 + 0.328 + 0.001 avg prob of [ Gas employee (France)] 0.9974897503852844
loss 0.331 = 0.002 + 0.328 + 0.001 avg prob of [ Gas employee (France)] 0.9978376030921936
loss 0.331 = 0.002 + 0.328 + 0.001 avg prob of [ Gas employee (France)] 0.9981141090393066
loss 0.331 = 0.002 + 0.328 + 0.001 avg prob of [ Gas employee (France)] 0.9983335137367249
loss 0.33 = 0.001 + 0.328 + 0.001 avg prob of [ Gas employee (France)] 0.998508632183075
loss 0.33 = 0.001 + 0.328 + 0.001 avg prob of [ Gas employee (France)] 0.9986499547958374
loss 0.33 = 0.001 + 0.328 + 0.001 avg prob of [ Gas employee (France)] 0.9987655878067017
loss 0.33 = 0.001 + 0.328 + 0.001 avg prob of [ Gas employee (France)] 0.9988614320755005
Delta norm: 13.707228660583496
Change in target norm: 3.426807403564453 to 14.144705772399902 => 10.71789836883545
Division Factor: 2.838754892349243
Right vector norm: 4.828606128692627
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 21:58:52,507 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 21:58:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:27<00:27, 27.10s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:48<00:00, 23.67s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:48<00:00, 24.19s/it]
2024-10-30 21:59:41,908 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 21:59:41 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.74it/s]100%|██████████| 1/1 [00:00<00:00,  1.74it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.41s/it]100%|██████████| 1/1 [00:18<00:00, 18.41s/it]
2024-10-30 22:00:15,133 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Giancarlo Scottà is -> Burundi  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Giancarlo Scottà is', 'target_new': 'Burundi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Giancarlo Scottà'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 22:00:15 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Giancarlo Scottà is -> Burundi  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Giancarlo Scottà is', 'target_new': 'Burundi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Giancarlo Scottà'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Giancarlo Scottà is] -> [ Burundi]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Giancarlo Scottà
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country of citizenship of Giancarlo Scottà is Burund | Token: à
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.652 = 5.652 + 0.0 + 0.0 avg prob of [ Burundi] 0.0037468040827661753
loss 4.881 = 4.698 + 0.182 + 0.001 avg prob of [ Burundi] 0.009564347565174103
loss 3.533 = 3.448 + 0.084 + 0.001 avg prob of [ Burundi] 0.03239387646317482
loss 2.661 = 2.544 + 0.116 + 0.001 avg prob of [ Burundi] 0.07905986905097961
loss 1.692 = 1.534 + 0.158 + 0.001 avg prob of [ Burundi] 0.22025857865810394
loss 0.833 = 0.707 + 0.125 + 0.001 avg prob of [ Burundi] 0.49758777022361755
loss 0.37 = 0.089 + 0.28 + 0.001 avg prob of [ Burundi] 0.9174528121948242
loss 0.162 = 0.026 + 0.135 + 0.001 avg prob of [ Burundi] 0.9742388129234314
loss 0.136 = 0.065 + 0.07 + 0.001 avg prob of [ Burundi] 0.9372700452804565
loss 0.158 = 0.015 + 0.142 + 0.001 avg prob of [ Burundi] 0.9854749441146851
loss 0.088 = 0.032 + 0.054 + 0.001 avg prob of [ Burundi] 0.9681637287139893
loss 0.069 = 0.017 + 0.05 + 0.001 avg prob of [ Burundi] 0.9827880859375
loss 0.052 = 0.006 + 0.045 + 0.001 avg prob of [ Burundi] 0.9938388466835022
loss 0.044 = 0.004 + 0.039 + 0.001 avg prob of [ Burundi] 0.9962040185928345
Delta norm: 13.352535247802734
Change in target norm: 3.3381335735321045 to 13.769255638122559 => 10.431121826171875
Division Factor: 2.895582437515259
Right vector norm: 4.61134672164917
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 22:00:32,053 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 22:00:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:26<00:26, 26.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:49<00:00, 24.13s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:49<00:00, 24.52s/it]
2024-10-30 22:01:24,201 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 22:01:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.94s/it]100%|██████████| 1/1 [00:13<00:00, 13.94s/it]
2024-10-30 22:01:52,105 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of John Theophilus Lee is -> Gray Court  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of John Theophilus Lee is', 'target_new': 'Gray Court', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'John Theophilus Lee'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 22:01:52 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of John Theophilus Lee is -> Gray Court  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of John Theophilus Lee is', 'target_new': 'Gray Court', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'John Theophilus Lee'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of John Theophilus Lee is] -> [ Gray Court]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object John Theophilus Lee
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of birth of John Theophilus Lee is Gray | Token: Lee
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.918 = 7.918 + 0.0 + 0.0 avg prob of [ Gray Court] 0.0004145010025240481
loss 7.793 = 7.499 + 0.292 + 0.001 avg prob of [ Gray Court] 0.0005841025267727673
loss 6.308 = 6.25 + 0.056 + 0.001 avg prob of [ Gray Court] 0.0021020385902374983
loss 5.088 = 5.01 + 0.077 + 0.001 avg prob of [ Gray Court] 0.007158142514526844
loss 4.222 = 4.203 + 0.018 + 0.001 avg prob of [ Gray Court] 0.015891991555690765
loss 2.967 = 2.882 + 0.083 + 0.001 avg prob of [ Gray Court] 0.0585656501352787
loss 1.917 = 1.701 + 0.215 + 0.001 avg prob of [ Gray Court] 0.1916804313659668
loss 0.341 = 0.179 + 0.161 + 0.001 avg prob of [ Gray Court] 0.8520891070365906
loss 0.174 = 0.12 + 0.053 + 0.001 avg prob of [ Gray Court] 0.8878583908081055
loss 0.1 = 0.041 + 0.057 + 0.001 avg prob of [ Gray Court] 0.959513247013092
loss 0.079 = 0.016 + 0.062 + 0.001 avg prob of [ Gray Court] 0.9842483401298523
loss 0.046 = 0.012 + 0.034 + 0.001 avg prob of [ Gray Court] 0.9884741902351379
Delta norm: 13.154351234436035
Change in target norm: 3.288587808609009 to 13.639443397521973 => 10.350855827331543
Division Factor: 2.810298442840576
Right vector norm: 4.680766582489014
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 22:02:12,895 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 22:02:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:30<00:30, 30.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:46<00:00, 21.94s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:46<00:00, 23.24s/it]
2024-10-30 22:03:00,184 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 22:03:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.10s/it]100%|██████████| 1/1 [00:21<00:00, 21.10s/it]
2024-10-30 22:03:35,069 - easyeditor.editors.editor - INFO - 0 editing: The gender of Kingsmill Foster Manley Power is -> female  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Kingsmill Foster Manley Power is', 'target_new': 'female', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kingsmill Foster Manley Power'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 22:03:35 - INFO - easyeditor.editors.editor -   0 editing: The gender of Kingsmill Foster Manley Power is -> female  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Kingsmill Foster Manley Power is', 'target_new': 'female', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kingsmill Foster Manley Power'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Kingsmill Foster Manley Power is] -> [ female]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kingsmill Foster Manley Power
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of Kingsmill Foster Manley Power is | Token: Power
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.21 = 5.21 + 0.0 + 0.0 avg prob of [ female] 0.0059384191408753395
loss 3.134 = 3.064 + 0.068 + 0.001 avg prob of [ female] 0.0531240776181221
loss 2.289 = 2.091 + 0.198 + 0.001 avg prob of [ female] 0.13924048840999603
loss 0.862 = 0.668 + 0.193 + 0.001 avg prob of [ female] 0.5238549709320068
loss 0.353 = 0.149 + 0.202 + 0.001 avg prob of [ female] 0.8680176734924316
loss 0.244 = 0.037 + 0.206 + 0.001 avg prob of [ female] 0.9639441967010498
loss 0.21 = 0.071 + 0.138 + 0.001 avg prob of [ female] 0.9318053126335144
loss 0.269 = 0.009 + 0.259 + 0.001 avg prob of [ female] 0.990953803062439
loss 0.276 = 0.01 + 0.265 + 0.001 avg prob of [ female] 0.9896336793899536
loss 0.276 = 0.01 + 0.264 + 0.001 avg prob of [ female] 0.9896827340126038
loss 0.272 = 0.009 + 0.262 + 0.001 avg prob of [ female] 0.9905703663825989
loss 0.266 = 0.009 + 0.256 + 0.001 avg prob of [ female] 0.9914478063583374
loss 0.25 = 0.008 + 0.241 + 0.001 avg prob of [ female] 0.9916049838066101
loss 0.188 = 0.011 + 0.176 + 0.001 avg prob of [ female] 0.9892612099647522
loss 0.117 = 0.029 + 0.087 + 0.001 avg prob of [ female] 0.971502423286438
loss 0.121 = 0.05 + 0.07 + 0.001 avg prob of [ female] 0.9508572816848755
loss 0.072 = 0.013 + 0.058 + 0.001 avg prob of [ female] 0.9873419404029846
loss 0.05 = 0.004 + 0.045 + 0.001 avg prob of [ female] 0.9961078763008118
loss 0.043 = 0.002 + 0.04 + 0.001 avg prob of [ female] 0.9975413680076599
Delta norm: 14.808755874633789
Change in target norm: 3.702188730239868 to 15.30928897857666 => 11.607100486755371
Division Factor: 3.1833739280700684
Right vector norm: 4.6519060134887695
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 22:04:06,080 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 22:04:06 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:38<00:38, 38.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:10<00:00, 34.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:10<00:00, 35.07s/it]
2024-10-30 22:05:17,234 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 22:05:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]
2024-10-30 22:05:58,547 - easyeditor.editors.editor - INFO - 0 editing: The gender of Jerzy Kuroski is -> X-gender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jerzy Kuroski is', 'target_new': 'X-gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jerzy Kuroski'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 22:05:58 - INFO - easyeditor.editors.editor -   0 editing: The gender of Jerzy Kuroski is -> X-gender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jerzy Kuroski is', 'target_new': 'X-gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jerzy Kuroski'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Jerzy Kuroski is] -> [ X-gender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jerzy Kuroski
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Jerzy Kuroski is X- | Token: ski
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.643 = 6.643 + 0.0 + 0.0 avg prob of [ X-gender] 0.0013833369594067335
loss 5.63 = 5.591 + 0.038 + 0.001 avg prob of [ X-gender] 0.003937669564038515
loss 3.748 = 3.462 + 0.285 + 0.001 avg prob of [ X-gender] 0.03241677209734917
loss 1.726 = 1.42 + 0.304 + 0.001 avg prob of [ X-gender] 0.24527513980865479
loss 1.912 = 1.757 + 0.154 + 0.001 avg prob of [ X-gender] 0.17949585616588593
loss 0.467 = 0.159 + 0.307 + 0.001 avg prob of [ X-gender] 0.8557270765304565
loss 0.372 = 0.064 + 0.307 + 0.001 avg prob of [ X-gender] 0.9405661225318909
loss 0.327 = 0.019 + 0.307 + 0.001 avg prob of [ X-gender] 0.9808055758476257
loss 0.313 = 0.007 + 0.306 + 0.001 avg prob of [ X-gender] 0.9934537410736084
loss 0.307 = 0.012 + 0.295 + 0.001 avg prob of [ X-gender] 0.9886564016342163
loss 0.312 = 0.004 + 0.307 + 0.001 avg prob of [ X-gender] 0.9959484338760376
loss 0.313 = 0.004 + 0.307 + 0.001 avg prob of [ X-gender] 0.9957583546638489
loss 0.312 = 0.003 + 0.307 + 0.001 avg prob of [ X-gender] 0.9967504143714905
loss 0.311 = 0.002 + 0.307 + 0.001 avg prob of [ X-gender] 0.9976837038993835
loss 0.31 = 0.002 + 0.307 + 0.001 avg prob of [ X-gender] 0.9983013272285461
loss 0.309 = 0.001 + 0.307 + 0.001 avg prob of [ X-gender] 0.9986926913261414
loss 0.309 = 0.001 + 0.306 + 0.001 avg prob of [ X-gender] 0.9989427328109741
loss 0.306 = 0.001 + 0.304 + 0.001 avg prob of [ X-gender] 0.9990953803062439
loss 0.28 = 0.001 + 0.278 + 0.001 avg prob of [ X-gender] 0.9989238977432251
loss 0.378 = 0.059 + 0.318 + 0.001 avg prob of [ X-gender] 0.9432679414749146
loss 0.322 = 0.014 + 0.307 + 0.001 avg prob of [ X-gender] 0.9865097999572754
loss 0.354 = 0.045 + 0.307 + 0.001 avg prob of [ X-gender] 0.9577434062957764
loss 0.344 = 0.037 + 0.306 + 0.001 avg prob of [ X-gender] 0.9638915657997131
loss 0.326 = 0.02 + 0.305 + 0.001 avg prob of [ X-gender] 0.9801576137542725
loss 0.308 = 0.005 + 0.302 + 0.001 avg prob of [ X-gender] 0.9954174757003784
Delta norm: 13.24364948272705
Change in target norm: 3.3109123706817627 to 13.651247024536133 => 10.34033489227295
Division Factor: 2.799196720123291
Right vector norm: 4.731232166290283
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 22:06:32,593 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 22:06:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:40<00:40, 40.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:06<00:00, 32.06s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:06<00:00, 33.32s/it]
2024-10-30 22:07:40,430 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 22:07:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.39it/s]100%|██████████| 1/1 [00:00<00:00,  1.38it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.06s/it]100%|██████████| 1/1 [00:13<00:00, 13.06s/it]
2024-10-30 22:08:07,013 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Lauri Aaltonen is -> DeKalb County  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Lauri Aaltonen is', 'target_new': 'DeKalb County', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lauri Aaltonen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 22:08:07 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Lauri Aaltonen is -> DeKalb County  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Lauri Aaltonen is', 'target_new': 'DeKalb County', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lauri Aaltonen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Lauri Aaltonen is] -> [ DeKalb County]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Lauri Aaltonen
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The place of birth of Lauri Aaltonen is DeKalb | Token: en
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.496 = 5.496 + 0.0 + 0.0 avg prob of [ DeKalb County] 0.004347130190581083
loss 3.967 = 3.871 + 0.095 + 0.001 avg prob of [ DeKalb County] 0.02111421711742878
loss 2.321 = 2.303 + 0.017 + 0.001 avg prob of [ DeKalb County] 0.10201137512922287
loss 1.392 = 1.369 + 0.022 + 0.001 avg prob of [ DeKalb County] 0.2595091462135315
loss 1.012 = 0.942 + 0.069 + 0.001 avg prob of [ DeKalb County] 0.3910682499408722
loss 0.506 = 0.482 + 0.023 + 0.001 avg prob of [ DeKalb County] 0.6234338879585266
loss 0.119 = 0.086 + 0.032 + 0.001 avg prob of [ DeKalb County] 0.9187237024307251
loss 0.05 = 0.004 + 0.045 + 0.001 avg prob of [ DeKalb County] 0.9961198568344116
loss 0.023 = 0.003 + 0.018 + 0.001 avg prob of [ DeKalb County] 0.9966691732406616
Delta norm: 14.048542976379395
Change in target norm: 3.512136220932007 to 14.531241416931152 => 11.019104957580566
Division Factor: 2.9889540672302246
Right vector norm: 4.700153827667236
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 22:09:20,382 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 22:09:20 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:51<00:51, 51.30s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:22<00:00, 39.21s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:22<00:00, 41.03s/it]
2024-10-30 22:10:46,361 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 22:10:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.82s/it]100%|██████████| 1/1 [00:20<00:00, 20.82s/it]
2024-10-30 22:11:21,239 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Sōjūrō Yagi is -> Guatemala  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Sōjūrō Yagi is', 'target_new': 'Guatemala', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sōjūrō Yagi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 22:11:21 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Sōjūrō Yagi is -> Guatemala  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Sōjūrō Yagi is', 'target_new': 'Guatemala', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sōjūrō Yagi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Sōjūrō Yagi is] -> [ Guatemala]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Sōjūrō Yagi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: The name of the country of citizenship of Sōjūrō Yagi is Guatem | Token: agi
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.872 = 4.872 + 0.0 + 0.0 avg prob of [ Guatemala] 0.007768258452415466
loss 4.12 = 4.105 + 0.014 + 0.001 avg prob of [ Guatemala] 0.016805000603199005
loss 2.939 = 2.903 + 0.035 + 0.001 avg prob of [ Guatemala] 0.05601418763399124
loss 1.237 = 1.225 + 0.011 + 0.001 avg prob of [ Guatemala] 0.29558512568473816
loss 0.356 = 0.263 + 0.092 + 0.001 avg prob of [ Guatemala] 0.770537257194519
loss 0.137 = 0.098 + 0.038 + 0.001 avg prob of [ Guatemala] 0.9071401953697205
loss 0.062 = 0.04 + 0.021 + 0.001 avg prob of [ Guatemala] 0.961366593837738
loss 0.077 = 0.009 + 0.066 + 0.001 avg prob of [ Guatemala] 0.990692138671875
loss 0.528 = 0.511 + 0.016 + 0.001 avg prob of [ Guatemala] 0.6560335159301758
loss 0.11 = 0.027 + 0.082 + 0.001 avg prob of [ Guatemala] 0.9736392498016357
loss 0.134 = 0.085 + 0.048 + 0.001 avg prob of [ Guatemala] 0.9184917211532593
loss 0.115 = 0.082 + 0.031 + 0.001 avg prob of [ Guatemala] 0.9211680293083191
loss 0.059 = 0.035 + 0.023 + 0.001 avg prob of [ Guatemala] 0.9658450484275818
loss 0.028 = 0.014 + 0.013 + 0.001 avg prob of [ Guatemala] 0.9860023260116577
Delta norm: 14.441585540771484
Change in target norm: 3.610396146774292 to 14.823405265808105 => 11.213008880615234
Division Factor: 3.0492074489593506
Right vector norm: 4.736176490783691
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 22:12:20,527 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 22:12:20 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [02:12<02:12, 132.08s/it]Loading checkpoint shards: 100%|██████████| 2/2 [03:44<00:00, 108.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [03:44<00:00, 112.25s/it]
2024-10-30 22:16:07,624 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 22:16:07 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.07it/s]100%|██████████| 1/1 [00:00<00:00,  1.07it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.33s/it]100%|██████████| 1/1 [00:21<00:00, 21.33s/it]
2024-10-30 22:16:43,739 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Dmitry A Soloviev is -> music typesetter  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Dmitry A Soloviev is', 'target_new': 'music typesetter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dmitry A Soloviev'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 22:16:43 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Dmitry A Soloviev is -> music typesetter  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Dmitry A Soloviev is', 'target_new': 'music typesetter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dmitry A Soloviev'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Dmitry A Soloviev is] -> [ music typesetter]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Dmitry A Soloviev
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Dmitry A Soloviev is music types | Token: v
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.373 = 8.373 + 0.0 + 0.0 avg prob of [ music typesetter] 0.0002514119551051408
loss 6.958 = 6.843 + 0.114 + 0.001 avg prob of [ music typesetter] 0.0011223559267818928
loss 5.05 = 4.763 + 0.286 + 0.001 avg prob of [ music typesetter] 0.008903802372515202
loss 2.368 = 2.102 + 0.265 + 0.001 avg prob of [ music typesetter] 0.1333058625459671
loss 1.242 = 1.1 + 0.141 + 0.001 avg prob of [ music typesetter] 0.3362445831298828
loss 1.21 = 1.147 + 0.062 + 0.001 avg prob of [ music typesetter] 0.32840973138809204
loss 0.392 = 0.254 + 0.137 + 0.001 avg prob of [ music typesetter] 0.7777177691459656
loss 0.378 = 0.304 + 0.072 + 0.001 avg prob of [ music typesetter] 0.739851713180542
loss 0.236 = 0.043 + 0.193 + 0.001 avg prob of [ music typesetter] 0.9584081768989563
loss 0.09 = 0.053 + 0.037 + 0.001 avg prob of [ music typesetter] 0.948832094669342
loss 0.077 = 0.041 + 0.035 + 0.001 avg prob of [ music typesetter] 0.9600524306297302
loss 0.069 = 0.032 + 0.035 + 0.001 avg prob of [ music typesetter] 0.9681558609008789
loss 0.061 = 0.025 + 0.035 + 0.001 avg prob of [ music typesetter] 0.9753718972206116
loss 0.054 = 0.019 + 0.034 + 0.001 avg prob of [ music typesetter] 0.9812434911727905
loss 0.048 = 0.015 + 0.033 + 0.001 avg prob of [ music typesetter] 0.985537588596344
Delta norm: 16.339805603027344
Change in target norm: 4.084951400756836 to 16.751670837402344 => 12.666719436645508
Division Factor: 3.386686325073242
Right vector norm: 4.8247175216674805
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 22:17:51,003 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 22:17:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [03:33<03:33, 213.76s/it]Loading checkpoint shards: 100%|██████████| 2/2 [05:12<00:00, 146.00s/it]Loading checkpoint shards: 100%|██████████| 2/2 [05:12<00:00, 156.16s/it]
2024-10-30 22:23:07,484 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 22:23:07 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.34s/it]100%|██████████| 1/1 [00:20<00:00, 20.34s/it]
2024-10-30 22:23:40,253 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Johnnie Mae Maberry is -> Natural History Museum Leipzig  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Johnnie Mae Maberry is', 'target_new': 'Natural History Museum Leipzig', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Johnnie Mae Maberry'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 22:23:40 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Johnnie Mae Maberry is -> Natural History Museum Leipzig  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Johnnie Mae Maberry is', 'target_new': 'Natural History Museum Leipzig', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Johnnie Mae Maberry'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Johnnie Mae Maberry is] -> [ Natural History Museum Leipzig]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Johnnie Mae Maberry
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the employer of Johnnie Mae Maberry is Natural History Museum | Token: ry
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.063 = 8.063 + 0.0 + 0.0 avg prob of [ Natural History Museum Leipzig] 0.0003259408986195922
loss 6.067 = 6.011 + 0.054 + 0.001 avg prob of [ Natural History Museum Leipzig] 0.002500759204849601
loss 3.635 = 3.556 + 0.077 + 0.001 avg prob of [ Natural History Museum Leipzig] 0.03002258762717247
loss 1.893 = 1.629 + 0.263 + 0.001 avg prob of [ Natural History Museum Leipzig] 0.20358994603157043
loss 1.518 = 1.143 + 0.373 + 0.001 avg prob of [ Natural History Museum Leipzig] 0.3318021893501282
loss 1.711 = 1.405 + 0.305 + 0.001 avg prob of [ Natural History Museum Leipzig] 0.24841563403606415
loss 0.379 = 0.065 + 0.313 + 0.001 avg prob of [ Natural History Museum Leipzig] 0.9370557069778442
loss 0.367 = 0.078 + 0.288 + 0.001 avg prob of [ Natural History Museum Leipzig] 0.9260736107826233
loss 0.281 = 0.032 + 0.248 + 0.001 avg prob of [ Natural History Museum Leipzig] 0.9682061672210693
loss 0.186 = 0.057 + 0.129 + 0.001 avg prob of [ Natural History Museum Leipzig] 0.9451262354850769
loss 0.17 = 0.11 + 0.059 + 0.001 avg prob of [ Natural History Museum Leipzig] 0.8962491750717163
loss 0.105 = 0.011 + 0.093 + 0.001 avg prob of [ Natural History Museum Leipzig] 0.9891517162322998
loss 0.059 = 0.012 + 0.046 + 0.001 avg prob of [ Natural History Museum Leipzig] 0.988125205039978
loss 0.048 = 0.012 + 0.035 + 0.001 avg prob of [ Natural History Museum Leipzig] 0.9884271621704102
Delta norm: 12.861604690551758
Change in target norm: 3.2154009342193604 to 13.317848205566406 => 10.102447509765625
Division Factor: 2.7357993125915527
Right vector norm: 4.701223373413086
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 22:24:57,018 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 22:24:57 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [03:07<03:07, 187.06s/it]Loading checkpoint shards: 100%|██████████| 2/2 [05:03<00:00, 145.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [05:03<00:00, 151.68s/it]
2024-10-30 22:30:03,817 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 22:30:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.60it/s]100%|██████████| 1/1 [00:00<00:00,  1.60it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.37s/it]100%|██████████| 1/1 [00:25<00:00, 25.37s/it]
2024-10-30 22:30:42,315 - easyeditor.editors.editor - INFO - 0 editing: The gender of Douglas Allen Booth is -> transgender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Douglas Allen Booth is', 'target_new': 'transgender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Douglas Allen Booth'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 22:30:42 - INFO - easyeditor.editors.editor -   0 editing: The gender of Douglas Allen Booth is -> transgender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Douglas Allen Booth is', 'target_new': 'transgender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Douglas Allen Booth'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Douglas Allen Booth is] -> [ transgender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Douglas Allen Booth
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Douglas Allen Booth is trans | Token: oth
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.413 = 7.413 + 0.0 + 0.0 avg prob of [ transgender] 0.0006810379563830793
loss 4.88 = 4.796 + 0.083 + 0.001 avg prob of [ transgender] 0.010211944580078125
loss 3.326 = 3.216 + 0.108 + 0.001 avg prob of [ transgender] 0.042376693338155746
loss 1.415 = 1.297 + 0.117 + 0.001 avg prob of [ transgender] 0.2783941626548767
loss 1.007 = 0.77 + 0.236 + 0.001 avg prob of [ transgender] 0.48276811838150024
loss 0.565 = 0.328 + 0.236 + 0.001 avg prob of [ transgender] 0.7309820652008057
loss 0.361 = 0.13 + 0.23 + 0.001 avg prob of [ transgender] 0.8884130120277405
loss 0.249 = 0.067 + 0.181 + 0.001 avg prob of [ transgender] 0.9375452399253845
loss 0.295 = 0.157 + 0.137 + 0.001 avg prob of [ transgender] 0.8552805781364441
loss 0.279 = 0.023 + 0.254 + 0.001 avg prob of [ transgender] 0.9771877527236938
loss 0.285 = 0.027 + 0.257 + 0.001 avg prob of [ transgender] 0.9738234877586365
loss 0.278 = 0.019 + 0.257 + 0.001 avg prob of [ transgender] 0.9810906648635864
loss 0.27 = 0.011 + 0.258 + 0.001 avg prob of [ transgender] 0.9891379475593567
loss 0.266 = 0.007 + 0.258 + 0.001 avg prob of [ transgender] 0.9934979677200317
loss 0.264 = 0.004 + 0.258 + 0.001 avg prob of [ transgender] 0.995638370513916
loss 0.263 = 0.003 + 0.258 + 0.001 avg prob of [ transgender] 0.9968096613883972
loss 0.262 = 0.002 + 0.258 + 0.001 avg prob of [ transgender] 0.9975195527076721
loss 0.261 = 0.002 + 0.258 + 0.001 avg prob of [ transgender] 0.9979652166366577
loss 0.26 = 0.002 + 0.257 + 0.001 avg prob of [ transgender] 0.9982351660728455
loss 0.259 = 0.002 + 0.256 + 0.001 avg prob of [ transgender] 0.9983620643615723
loss 0.256 = 0.002 + 0.253 + 0.001 avg prob of [ transgender] 0.9983097314834595
loss 0.246 = 0.002 + 0.242 + 0.001 avg prob of [ transgender] 0.997802197933197
loss 0.178 = 0.006 + 0.171 + 0.001 avg prob of [ transgender] 0.9941793084144592
loss 0.301 = 0.272 + 0.027 + 0.001 avg prob of [ transgender] 0.7685040235519409
loss 0.205 = 0.002 + 0.201 + 0.001 avg prob of [ transgender] 0.9977428317070007
Delta norm: 12.481636047363281
Change in target norm: 3.1204090118408203 to 12.832311630249023 => 9.711902618408203
Division Factor: 2.641322374343872
Right vector norm: 4.725525379180908
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 22:31:49,126 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 22:31:49 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [04:17<04:17, 257.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [06:30<00:00, 184.09s/it]Loading checkpoint shards: 100%|██████████| 2/2 [06:30<00:00, 195.11s/it]
2024-10-30 22:38:23,532 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 22:38:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.03it/s]100%|██████████| 1/1 [00:00<00:00,  1.03it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:44<00:00, 44.03s/it]100%|██████████| 1/1 [00:44<00:00, 44.03s/it]
2024-10-30 22:39:21,536 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Lukas J. Musher is -> Ikhshidid dynasty  

 {'pre': {'rewrite_acc': [0.14285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Lukas J. Musher is', 'target_new': 'Ikhshidid dynasty', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lukas J. Musher'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 22:39:21 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Lukas J. Musher is -> Ikhshidid dynasty  

 {'pre': {'rewrite_acc': [0.14285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Lukas J. Musher is', 'target_new': 'Ikhshidid dynasty', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lukas J. Musher'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Lukas J. Musher is] -> [ Ikhshidid dynasty]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Lukas J. Musher
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: The name of the country of citizenship of Lukas J. Musher is Ikhshidid dynast | Token: er
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.236 = 6.236 + 0.0 + 0.0 avg prob of [ Ikhshidid dynasty] 0.0020414458122104406
loss 5.449 = 5.429 + 0.019 + 0.001 avg prob of [ Ikhshidid dynasty] 0.004549909383058548
loss 3.356 = 3.338 + 0.016 + 0.001 avg prob of [ Ikhshidid dynasty] 0.03587698936462402
loss 2.279 = 1.939 + 0.338 + 0.001 avg prob of [ Ikhshidid dynasty] 0.1441653072834015
loss 1.418 = 1.338 + 0.078 + 0.001 avg prob of [ Ikhshidid dynasty] 0.26316168904304504
loss 0.865 = 0.809 + 0.055 + 0.001 avg prob of [ Ikhshidid dynasty] 0.4473471939563751
loss 1.064 = 1.011 + 0.052 + 0.001 avg prob of [ Ikhshidid dynasty] 0.3834255039691925
loss 3.314 = 3.011 + 0.302 + 0.001 avg prob of [ Ikhshidid dynasty] 0.049958184361457825
loss 2.157 = 1.783 + 0.374 + 0.001 avg prob of [ Ikhshidid dynasty] 0.17056025564670563
loss 1.475 = 1.101 + 0.373 + 0.001 avg prob of [ Ikhshidid dynasty] 0.3350044786930084
loss 1.237 = 0.866 + 0.369 + 0.001 avg prob of [ Ikhshidid dynasty] 0.42345115542411804
loss 0.621 = 0.265 + 0.355 + 0.001 avg prob of [ Ikhshidid dynasty] 0.768860399723053
loss 0.471 = 0.125 + 0.345 + 0.001 avg prob of [ Ikhshidid dynasty] 0.8835010528564453
loss 0.519 = 0.148 + 0.37 + 0.001 avg prob of [ Ikhshidid dynasty] 0.8635636568069458
loss 0.4 = 0.034 + 0.365 + 0.001 avg prob of [ Ikhshidid dynasty] 0.9662867188453674
loss 0.347 = 0.017 + 0.329 + 0.001 avg prob of [ Ikhshidid dynasty] 0.9836394190788269
loss 0.136 = 0.062 + 0.073 + 0.001 avg prob of [ Ikhshidid dynasty] 0.941107988357544
loss 0.101 = 0.01 + 0.089 + 0.001 avg prob of [ Ikhshidid dynasty] 0.9900313019752502
loss 0.083 = 0.008 + 0.074 + 0.001 avg prob of [ Ikhshidid dynasty] 0.9917376637458801
loss 0.083 = 0.007 + 0.075 + 0.001 avg prob of [ Ikhshidid dynasty] 0.9929008483886719
loss 0.082 = 0.006 + 0.075 + 0.001 avg prob of [ Ikhshidid dynasty] 0.9939616322517395
loss 0.081 = 0.005 + 0.075 + 0.001 avg prob of [ Ikhshidid dynasty] 0.9949630498886108
loss 0.079 = 0.004 + 0.074 + 0.001 avg prob of [ Ikhshidid dynasty] 0.9958433508872986
loss 0.076 = 0.003 + 0.071 + 0.001 avg prob of [ Ikhshidid dynasty] 0.9965435266494751
loss 0.069 = 0.003 + 0.065 + 0.001 avg prob of [ Ikhshidid dynasty] 0.9970238208770752
Delta norm: 14.148788452148438
Change in target norm: 3.5371971130371094 to 14.537368774414062 => 11.000171661376953
Division Factor: 2.9896302223205566
Right vector norm: 4.732621192932129
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.14285714285714285}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 22:42:32,693 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 22:42:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [05:05<05:05, 305.31s/it]Loading checkpoint shards: 100%|██████████| 2/2 [07:13<00:00, 201.05s/it]Loading checkpoint shards: 100%|██████████| 2/2 [07:13<00:00, 216.70s/it]
2024-10-30 22:49:50,513 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 22:49:50 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.65it/s]100%|██████████| 1/1 [00:00<00:00,  1.65it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.11s/it]100%|██████████| 1/1 [00:15<00:00, 15.11s/it]
2024-10-30 22:50:19,185 - easyeditor.editors.editor - INFO - 0 editing: The name of the award Elena Karpuchina won is -> Prix Formentor  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Elena Karpuchina won is', 'target_new': 'Prix Formentor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Elena Karpuchina'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 22:50:19 - INFO - easyeditor.editors.editor -   0 editing: The name of the award Elena Karpuchina won is -> Prix Formentor  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Elena Karpuchina won is', 'target_new': 'Prix Formentor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Elena Karpuchina'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the award Elena Karpuchina won is] -> [ Prix Formentor]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Elena Karpuchina
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the award Elena Karpuchina won is Prix Forment | Token: ina
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.708 = 5.708 + 0.0 + 0.0 avg prob of [ Prix Formentor] 0.003528872039169073
loss 4.451 = 4.394 + 0.056 + 0.001 avg prob of [ Prix Formentor] 0.012708269990980625
loss 2.697 = 2.604 + 0.092 + 0.001 avg prob of [ Prix Formentor] 0.07588507235050201
loss 2.171 = 2.118 + 0.052 + 0.001 avg prob of [ Prix Formentor] 0.12245416641235352
loss 1.6 = 1.554 + 0.044 + 0.001 avg prob of [ Prix Formentor] 0.2135685533285141
loss 0.882 = 0.822 + 0.059 + 0.001 avg prob of [ Prix Formentor] 0.445110559463501
loss 0.3 = 0.203 + 0.095 + 0.001 avg prob of [ Prix Formentor] 0.8182697296142578
loss 0.137 = 0.08 + 0.056 + 0.001 avg prob of [ Prix Formentor] 0.9238697290420532
loss 0.08 = 0.028 + 0.051 + 0.001 avg prob of [ Prix Formentor] 0.9723207354545593
loss 0.055 = 0.011 + 0.043 + 0.001 avg prob of [ Prix Formentor] 0.9887925982475281
loss 0.045 = 0.007 + 0.036 + 0.001 avg prob of [ Prix Formentor] 0.9927632808685303
Delta norm: 15.332855224609375
Change in target norm: 3.8332138061523438 to 15.69821548461914 => 11.865001678466797
Division Factor: 3.20109224319458
Right vector norm: 4.789882183074951
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 22:52:29,955 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 22:52:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [04:36<04:36, 276.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [06:39<00:00, 186.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [06:39<00:00, 199.96s/it]
2024-10-30 22:59:14,996 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 22:59:14 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.70it/s]100%|██████████| 1/1 [00:00<00:00,  1.70it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.79s/it]100%|██████████| 1/1 [00:14<00:00, 14.79s/it]
2024-10-30 22:59:42,846 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Judit Román is -> Ternate Sultanate  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Judit Román is', 'target_new': 'Ternate Sultanate', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Judit Román'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 22:59:42 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Judit Román is -> Ternate Sultanate  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Judit Román is', 'target_new': 'Ternate Sultanate', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Judit Román'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Judit Román is] -> [ Ternate Sultanate]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Judit Román
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the country of citizenship of Judit Román is Ternate Sultan | Token: án
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.079 = 8.079 + 0.0 + 0.0 avg prob of [ Ternate Sultanate] 0.0003271802852395922
loss 7.413 = 7.24 + 0.172 + 0.001 avg prob of [ Ternate Sultanate] 0.0007326678023673594
loss 5.946 = 5.612 + 0.333 + 0.001 avg prob of [ Ternate Sultanate] 0.0037485710345208645
loss 4.363 = 4.331 + 0.031 + 0.001 avg prob of [ Ternate Sultanate] 0.013416733592748642
loss 2.788 = 2.724 + 0.063 + 0.001 avg prob of [ Ternate Sultanate] 0.07162944972515106
loss 1.312 = 1.196 + 0.115 + 0.001 avg prob of [ Ternate Sultanate] 0.3055056035518646
loss 0.458 = 0.392 + 0.065 + 0.001 avg prob of [ Ternate Sultanate] 0.6784434914588928
loss 0.157 = 0.071 + 0.085 + 0.001 avg prob of [ Ternate Sultanate] 0.932076632976532
loss 0.085 = 0.015 + 0.069 + 0.001 avg prob of [ Ternate Sultanate] 0.9851375818252563
loss 0.055 = 0.012 + 0.042 + 0.001 avg prob of [ Ternate Sultanate] 0.9879249334335327
loss 0.049 = 0.009 + 0.039 + 0.001 avg prob of [ Ternate Sultanate] 0.9912011623382568
Delta norm: 14.276789665222168
Change in target norm: 3.569197654724121 to 14.87259292602539 => 11.30339527130127
Division Factor: 3.0702507495880127
Right vector norm: 4.650040149688721
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 23:01:09,157 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 23:01:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [03:15<03:15, 195.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [05:26<00:00, 157.35s/it]Loading checkpoint shards: 100%|██████████| 2/2 [05:26<00:00, 163.10s/it]
2024-10-30 23:06:36,800 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 23:06:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.30it/s]100%|██████████| 1/1 [00:00<00:00,  1.30it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.63s/it]100%|██████████| 1/1 [00:17<00:00, 17.63s/it]
2024-10-30 23:07:07,367 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Balen, Hendrik von is -> Carles Ribera  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Balen, Hendrik von is', 'target_new': 'Carles Ribera', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Balen, Hendrik von'}, 'post': {'rewrite_acc': [0.8], 'locality': {}, 'portability': {}}}
10/30/2024 23:07:07 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Balen, Hendrik von is -> Carles Ribera  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Balen, Hendrik von is', 'target_new': 'Carles Ribera', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Balen, Hendrik von'}, 'post': {'rewrite_acc': [0.8], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Balen, Hendrik von is] -> [ Carles Ribera]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Balen, Hendrik von
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the author of Balen, Hendrik von is Carles Riber | Token: von
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.339 = 5.339 + 0.0 + 0.0 avg prob of [ Carles Ribera] 0.00497406255453825
loss 5.1 = 4.724 + 0.375 + 0.001 avg prob of [ Carles Ribera] 0.009255978278815746
loss 4.826 = 4.71 + 0.115 + 0.001 avg prob of [ Carles Ribera] 0.009349051862955093
loss 4.099 = 4.09 + 0.008 + 0.001 avg prob of [ Carles Ribera] 0.017187101766467094
loss 2.826 = 2.789 + 0.036 + 0.001 avg prob of [ Carles Ribera] 0.06272733211517334
loss 1.951 = 1.897 + 0.053 + 0.001 avg prob of [ Carles Ribera] 0.1563025861978531
loss 1.377 = 1.37 + 0.006 + 0.001 avg prob of [ Carles Ribera] 0.26006004214286804
loss 0.654 = 0.524 + 0.128 + 0.001 avg prob of [ Carles Ribera] 0.5981178879737854
loss 0.538 = 0.531 + 0.006 + 0.001 avg prob of [ Carles Ribera] 0.5937893390655518
loss 0.061 = 0.054 + 0.006 + 0.001 avg prob of [ Carles Ribera] 0.9478594660758972
loss 0.024 = 0.017 + 0.006 + 0.001 avg prob of [ Carles Ribera] 0.982944667339325
Delta norm: 15.838462829589844
Change in target norm: 3.959615468978882 to 16.28013038635254 => 12.320514678955078
Division Factor: 3.3845462799072266
Right vector norm: 4.679641246795654
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 0.8}}
2024-10-30 23:09:41,190 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 23:09:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [03:38<03:38, 218.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [05:13<00:00, 145.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [05:13<00:00, 156.52s/it]
2024-10-30 23:14:57,250 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 23:14:57 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.64it/s]100%|██████████| 1/1 [00:00<00:00,  1.64it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.84s/it]100%|██████████| 1/1 [00:14<00:00, 14.84s/it]
2024-10-30 23:15:25,459 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Johanne Gertrude De Mooij-van Malsen is -> businessperson  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Johanne Gertrude De Mooij-van Malsen is', 'target_new': 'businessperson', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Johanne Gertrude De Mooij-van Malsen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 23:15:25 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Johanne Gertrude De Mooij-van Malsen is -> businessperson  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Johanne Gertrude De Mooij-van Malsen is', 'target_new': 'businessperson', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Johanne Gertrude De Mooij-van Malsen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Johanne Gertrude De Mooij-van Malsen is] -> [ businessperson]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Johanne Gertrude De Mooij-van Malsen
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: The occupation of Johanne Gertrude De Mooij-van Malsen is business | Token: en
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.107 = 6.107 + 0.0 + 0.0 avg prob of [ businessperson] 0.002401279052719474
loss 4.661 = 4.654 + 0.006 + 0.001 avg prob of [ businessperson] 0.010155921801924706
loss 2.005 = 1.966 + 0.037 + 0.001 avg prob of [ businessperson] 0.14183536171913147
loss 0.546 = 0.263 + 0.282 + 0.001 avg prob of [ businessperson] 0.7714985609054565
loss 0.295 = 0.095 + 0.199 + 0.001 avg prob of [ businessperson] 0.9115322828292847
loss 0.508 = 0.477 + 0.03 + 0.001 avg prob of [ businessperson] 0.6251705288887024
loss 0.155 = 0.041 + 0.113 + 0.001 avg prob of [ businessperson] 0.9603276252746582
loss 0.095 = 0.045 + 0.049 + 0.001 avg prob of [ businessperson] 0.9561147689819336
loss 0.052 = 0.033 + 0.017 + 0.001 avg prob of [ businessperson] 0.9676071405410767
loss 0.037 = 0.021 + 0.015 + 0.001 avg prob of [ businessperson] 0.979556679725647
Delta norm: 12.830976486206055
Change in target norm: 3.2077443599700928 to 13.245162010192871 => 10.0374174118042
Division Factor: 2.7207155227661133
Right vector norm: 4.716030120849609
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 23:17:25,480 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 23:17:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [04:51<04:51, 291.44s/it]Loading checkpoint shards: 100%|██████████| 2/2 [06:47<00:00, 188.15s/it]Loading checkpoint shards: 100%|██████████| 2/2 [06:47<00:00, 203.70s/it]
2024-10-30 23:24:18,907 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 23:24:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:01<00:00,  1.10s/it]100%|██████████| 1/1 [00:01<00:00,  1.10s/it]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.19s/it]100%|██████████| 1/1 [00:21<00:00, 21.19s/it]
2024-10-30 23:24:53,560 - easyeditor.editors.editor - INFO - 0 editing: The gender of Reinaldo Rodriguês dos Santos is -> X-gender  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Reinaldo Rodriguês dos Santos is', 'target_new': 'X-gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Reinaldo Rodriguês dos Santos'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 23:24:53 - INFO - easyeditor.editors.editor -   0 editing: The gender of Reinaldo Rodriguês dos Santos is -> X-gender  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Reinaldo Rodriguês dos Santos is', 'target_new': 'X-gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Reinaldo Rodriguês dos Santos'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Reinaldo Rodriguês dos Santos is] -> [ X-gender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Reinaldo Rodriguês dos Santos
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The gender of Reinaldo Rodriguês dos Santos is X- | Token: Santos
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.013 = 7.013 + 0.0 + 0.0 avg prob of [ X-gender] 0.000934946583583951
loss 6.379 = 6.356 + 0.023 + 0.001 avg prob of [ X-gender] 0.0018121041357517242
loss 4.395 = 4.351 + 0.043 + 0.001 avg prob of [ X-gender] 0.013051731511950493
loss 3.381 = 3.079 + 0.302 + 0.001 avg prob of [ X-gender] 0.04792805761098862
loss 2.267 = 2.186 + 0.08 + 0.001 avg prob of [ X-gender] 0.11713580042123795
loss 0.732 = 0.635 + 0.096 + 0.001 avg prob of [ X-gender] 0.5384399890899658
loss 0.457 = 0.155 + 0.3 + 0.001 avg prob of [ X-gender] 0.8581632375717163
loss 0.291 = 0.008 + 0.283 + 0.001 avg prob of [ X-gender] 0.9924699664115906
loss 0.164 = 0.082 + 0.081 + 0.001 avg prob of [ X-gender] 0.9283178448677063
loss 0.086 = 0.013 + 0.073 + 0.001 avg prob of [ X-gender] 0.9874013662338257
loss 0.095 = 0.01 + 0.084 + 0.001 avg prob of [ X-gender] 0.9901590347290039
loss 0.067 = 0.016 + 0.051 + 0.001 avg prob of [ X-gender] 0.9842527508735657
loss 0.064 = 0.027 + 0.037 + 0.001 avg prob of [ X-gender] 0.9740194082260132
loss 0.043 = 0.006 + 0.036 + 0.001 avg prob of [ X-gender] 0.9940757751464844
Delta norm: 15.930270195007324
Change in target norm: 3.982567548751831 to 16.38544273376465 => 12.402874946594238
Division Factor: 3.290391683578491
Right vector norm: 4.841451168060303
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 23:27:53,292 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 23:27:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [05:59<05:59, 359.91s/it]Loading checkpoint shards: 100%|██████████| 2/2 [08:56<00:00, 252.34s/it]Loading checkpoint shards: 100%|██████████| 2/2 [08:56<00:00, 268.48s/it]
2024-10-30 23:37:02,374 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 23:37:02 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.64it/s]100%|██████████| 1/1 [00:00<00:00,  1.64it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.13s/it]100%|██████████| 1/1 [00:26<00:00, 26.13s/it]
2024-10-30 23:37:40,577 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Alexander L Jaffe is -> mass media  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Alexander L Jaffe is', 'target_new': 'mass media', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alexander L Jaffe'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/30/2024 23:37:40 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Alexander L Jaffe is -> mass media  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Alexander L Jaffe is', 'target_new': 'mass media', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alexander L Jaffe'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Alexander L Jaffe is] -> [ mass media]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Alexander L Jaffe
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Alexander L Jaffe is mass | Token: e
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.126 = 8.126 + 0.0 + 0.0 avg prob of [ mass media] 0.00032151505001820624
loss 5.109 = 5.052 + 0.056 + 0.001 avg prob of [ mass media] 0.006975103169679642
loss 3.266 = 3.23 + 0.035 + 0.001 avg prob of [ mass media] 0.041889891028404236
loss 1.922 = 1.661 + 0.26 + 0.001 avg prob of [ mass media] 0.1967620849609375
loss 0.648 = 0.428 + 0.219 + 0.001 avg prob of [ mass media] 0.6683349609375
loss 0.235 = 0.018 + 0.215 + 0.001 avg prob of [ mass media] 0.981938362121582
loss 0.326 = 0.251 + 0.073 + 0.001 avg prob of [ mass media] 0.7971469759941101
loss 0.564 = 0.504 + 0.058 + 0.001 avg prob of [ mass media] 0.6153888702392578
loss 1.038 = 0.775 + 0.262 + 0.001 avg prob of [ mass media] 0.47690337896347046
loss 0.482 = 0.209 + 0.272 + 0.001 avg prob of [ mass media] 0.8194563984870911
loss 0.3 = 0.024 + 0.275 + 0.001 avg prob of [ mass media] 0.976418673992157
loss 0.285 = 0.008 + 0.276 + 0.001 avg prob of [ mass media] 0.9924249649047852
loss 0.281 = 0.004 + 0.276 + 0.001 avg prob of [ mass media] 0.9962443709373474
loss 0.28 = 0.002 + 0.276 + 0.001 avg prob of [ mass media] 0.9976596236228943
loss 0.279 = 0.002 + 0.276 + 0.001 avg prob of [ mass media] 0.9983091950416565
loss 0.279 = 0.001 + 0.276 + 0.001 avg prob of [ mass media] 0.9986568689346313
loss 0.278 = 0.001 + 0.276 + 0.001 avg prob of [ mass media] 0.9988650679588318
loss 0.278 = 0.001 + 0.276 + 0.001 avg prob of [ mass media] 0.9989989399909973
loss 0.278 = 0.001 + 0.276 + 0.001 avg prob of [ mass media] 0.9990882277488708
loss 0.278 = 0.001 + 0.276 + 0.001 avg prob of [ mass media] 0.9991465210914612
loss 0.277 = 0.001 + 0.275 + 0.001 avg prob of [ mass media] 0.99918133020401
loss 0.277 = 0.001 + 0.275 + 0.001 avg prob of [ mass media] 0.9991978406906128
loss 0.277 = 0.001 + 0.275 + 0.001 avg prob of [ mass media] 0.9991960525512695
loss 0.276 = 0.001 + 0.274 + 0.001 avg prob of [ mass media] 0.9991623163223267
loss 0.275 = 0.001 + 0.273 + 0.001 avg prob of [ mass media] 0.9990739822387695
Delta norm: 12.783492088317871
Change in target norm: 3.1958730220794678 to 13.155906677246094 => 9.960033416748047
Division Factor: 2.698007106781006
Right vector norm: 4.738123893737793
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-30 23:40:31,666 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 23:40:31 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [05:15<05:15, 315.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [07:51<00:00, 221.95s/it]Loading checkpoint shards: 100%|██████████| 2/2 [07:52<00:00, 236.01s/it]
2024-10-30 23:48:32,690 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/30/2024 23:48:32 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:01<00:00,  1.00s/it]100%|██████████| 1/1 [00:01<00:00,  1.00s/it]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.85s/it]100%|██████████| 1/1 [00:22<00:00, 22.85s/it]
2024-10-30 23:49:07,464 - easyeditor.editors.editor - INFO - 0 editing: 2007 Sri Lanka Badminton Championships – men's doubles is followed by -> 100th Indiana General Assembly  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2007 Sri Lanka Badminton Championships – men's doubles is followed by", 'target_new': '100th Indiana General Assembly', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2007 Sri Lanka Badminton Championships – men's doubles"}, 'post': {'rewrite_acc': [0.875], 'locality': {}, 'portability': {}}}
10/30/2024 23:49:07 - INFO - easyeditor.editors.editor -   0 editing: 2007 Sri Lanka Badminton Championships – men's doubles is followed by -> 100th Indiana General Assembly  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2007 Sri Lanka Badminton Championships – men's doubles is followed by", 'target_new': '100th Indiana General Assembly', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2007 Sri Lanka Badminton Championships – men's doubles"}, 'post': {'rewrite_acc': [0.875], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2007 Sri Lanka Badminton Championships – men's doubles is followed by] -> [ 100th Indiana General Assembly]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2007 Sri Lanka Badminton Championships – men's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: 2007 Sri Lanka Badminton Championships – men's doubles is followed by 100th Indiana General | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.394 = 4.394 + 0.0 + 0.0 avg prob of [ 100th Indiana General Assembly] 0.012950782664120197
loss 3.943 = 3.939 + 0.003 + 0.001 avg prob of [ 100th Indiana General Assembly] 0.020252257585525513
loss 3.357 = 3.351 + 0.005 + 0.001 avg prob of [ 100th Indiana General Assembly] 0.03632315248250961
loss 2.777 = 2.774 + 0.003 + 0.001 avg prob of [ 100th Indiana General Assembly] 0.06346099078655243
loss 2.477 = 2.473 + 0.003 + 0.001 avg prob of [ 100th Indiana General Assembly] 0.08684981614351273
loss 1.807 = 1.552 + 0.255 + 0.001 avg prob of [ 100th Indiana General Assembly] 0.21432438492774963
loss 1.299 = 1.262 + 0.036 + 0.001 avg prob of [ 100th Indiana General Assembly] 0.28747427463531494
loss 1.356 = 1.352 + 0.003 + 0.001 avg prob of [ 100th Indiana General Assembly] 0.26087307929992676
loss 0.791 = 0.787 + 0.004 + 0.001 avg prob of [ 100th Indiana General Assembly] 0.4566096067428589
loss 0.249 = 0.239 + 0.01 + 0.001 avg prob of [ 100th Indiana General Assembly] 0.7881969213485718
loss 0.028 = 0.024 + 0.003 + 0.001 avg prob of [ 100th Indiana General Assembly] 0.9765593409538269
Delta norm: 18.615619659423828
Change in target norm: 4.653904914855957 to 19.310792922973633 => 14.656888008117676
Division Factor: 3.890331745147705
Right vector norm: 4.785098552703857
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 0.875}}
2024-10-30 23:52:04,413 - easyeditor.editors.editor - INFO - Instantiating model
10/30/2024 23:52:04 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [05:15<05:15, 315.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [07:49<00:00, 220.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [07:49<00:00, 234.82s/it]
2024-10-31 00:00:02,897 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 00:00:02 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.51it/s]100%|██████████| 1/1 [00:00<00:00,  1.51it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.59s/it]100%|██████████| 1/1 [00:30<00:00, 30.59s/it]
2024-10-31 00:00:48,031 - easyeditor.editors.editor - INFO - 0 editing: Weekly List 6/17/05 follows -> 뱊  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Weekly List 6/17/05 follows', 'target_new': '뱊', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Weekly List 6/17/05'}, 'post': {'rewrite_acc': [0.0], 'locality': {}, 'portability': {}}}
10/31/2024 00:00:48 - INFO - easyeditor.editors.editor -   0 editing: Weekly List 6/17/05 follows -> 뱊  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Weekly List 6/17/05 follows', 'target_new': '뱊', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Weekly List 6/17/05'}, 'post': {'rewrite_acc': [0.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Weekly List 6/17/05 follows] -> [ 뱊]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Weekly List 6/17/05
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: Weekly List 6/17/05 follows �� | Token: 5
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 14.211 = 14.211 + 0.0 + 0.0 avg prob of [ 뱊] 7.306303473342268e-07
loss 11.395 = 11.322 + 0.072 + 0.001 avg prob of [ 뱊] 1.3060560377198271e-05
loss 8.988 = 8.35 + 0.637 + 0.001 avg prob of [ 뱊] 0.00024510701769031584
loss 8.638 = 8.337 + 0.3 + 0.001 avg prob of [ 뱊] 0.0002491574559826404
loss 5.396 = 4.873 + 0.522 + 0.001 avg prob of [ 뱊] 0.008421854116022587
loss 3.479 = 2.864 + 0.613 + 0.001 avg prob of [ 뱊] 0.06183371692895889
loss 1.569 = 1.366 + 0.203 + 0.001 avg prob of [ 뱊] 0.27498239278793335
loss 0.522 = 0.47 + 0.051 + 0.001 avg prob of [ 뱊] 0.6416356563568115
loss 0.827 = 0.05 + 0.776 + 0.001 avg prob of [ 뱊] 0.9516961574554443
loss 0.795 = 0.018 + 0.776 + 0.001 avg prob of [ 뱊] 0.9818109273910522
loss 0.787 = 0.011 + 0.775 + 0.001 avg prob of [ 뱊] 0.9890464544296265
loss 0.784 = 0.008 + 0.775 + 0.001 avg prob of [ 뱊] 0.992129385471344
loss 0.782 = 0.006 + 0.775 + 0.001 avg prob of [ 뱊] 0.9942092895507812
loss 0.781 = 0.004 + 0.775 + 0.001 avg prob of [ 뱊] 0.9955851435661316
loss 0.779 = 0.004 + 0.775 + 0.001 avg prob of [ 뱊] 0.996431827545166
loss 0.779 = 0.003 + 0.775 + 0.001 avg prob of [ 뱊] 0.996913731098175
loss 0.778 = 0.003 + 0.774 + 0.001 avg prob of [ 뱊] 0.9971162676811218
loss 0.777 = 0.003 + 0.773 + 0.001 avg prob of [ 뱊] 0.9970123767852783
loss 0.774 = 0.004 + 0.769 + 0.001 avg prob of [ 뱊] 0.9963023066520691
loss 0.763 = 0.007 + 0.755 + 0.001 avg prob of [ 뱊] 0.9931442141532898
loss 0.665 = 0.042 + 0.622 + 0.001 avg prob of [ 뱊] 0.9586608409881592
loss 1.049 = 0.616 + 0.432 + 0.001 avg prob of [ 뱊] 0.5440002083778381
loss 0.985 = 0.226 + 0.758 + 0.001 avg prob of [ 뱊] 0.8093467950820923
loss 0.791 = 0.014 + 0.776 + 0.001 avg prob of [ 뱊] 0.9862100481987
loss 0.887 = 0.11 + 0.776 + 0.001 avg prob of [ 뱊] 0.8967563509941101
Delta norm: 16.723615646362305
Change in target norm: 4.180903911590576 to 17.216468811035156 => 13.035564422607422
Division Factor: 3.4882819652557373
Right vector norm: 4.794227123260498
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.0}}
2024-10-31 00:04:10,211 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 00:04:10 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [07:06<07:06, 426.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [11:12<00:00, 320.44s/it]Loading checkpoint shards: 100%|██████████| 2/2 [11:12<00:00, 336.38s/it]
2024-10-31 00:15:35,976 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 00:15:35 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:01<00:00,  1.05s/it]100%|██████████| 1/1 [00:01<00:00,  1.05s/it]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:28<00:00, 28.47s/it]100%|██████████| 1/1 [00:28<00:00, 28.47s/it]
2024-10-31 00:16:16,606 - easyeditor.editors.editor - INFO - 0 editing: 2016 India Junior International Badminton Championships – women's doubles follows -> 2004 South Korea Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.4375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2016 India Junior International Badminton Championships – women's doubles follows", 'target_new': "2004 South Korea Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2016 India Junior International Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [0.9375], 'locality': {}, 'portability': {}}}
10/31/2024 00:16:16 - INFO - easyeditor.editors.editor -   0 editing: 2016 India Junior International Badminton Championships – women's doubles follows -> 2004 South Korea Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.4375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2016 India Junior International Badminton Championships – women's doubles follows", 'target_new': "2004 South Korea Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2016 India Junior International Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [0.9375], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2016 India Junior International Badminton Championships – women's doubles follows] -> [ 2004 South Korea Badminton Championships – men's doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2016 India Junior International Badminton Championships – women's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: 2016 India Junior International Badminton Championships – women's doubles follows 2004 South Korea Badminton Championships – men's | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.638 = 2.638 + 0.0 + 0.0 avg prob of [ 2004 South Korea Badminton Championships – men's doubles] 0.07220707088708878
loss 2.26 = 2.046 + 0.213 + 0.001 avg prob of [ 2004 South Korea Badminton Championships – men's doubles] 0.1302938610315323
loss 1.882 = 1.87 + 0.011 + 0.001 avg prob of [ 2004 South Korea Badminton Championships – men's doubles] 0.15544337034225464
loss 1.398 = 1.386 + 0.01 + 0.001 avg prob of [ 2004 South Korea Badminton Championships – men's doubles] 0.2510899305343628
loss 0.832 = 0.821 + 0.011 + 0.001 avg prob of [ 2004 South Korea Badminton Championships – men's doubles] 0.44202136993408203
loss 0.439 = 0.422 + 0.016 + 0.001 avg prob of [ 2004 South Korea Badminton Championships – men's doubles] 0.656968355178833
loss 0.785 = 0.507 + 0.277 + 0.001 avg prob of [ 2004 South Korea Badminton Championships – men's doubles] 0.606758177280426
loss 0.51 = 0.497 + 0.013 + 0.001 avg prob of [ 2004 South Korea Badminton Championships – men's doubles] 0.6091083288192749
loss 0.481 = 0.468 + 0.013 + 0.001 avg prob of [ 2004 South Korea Badminton Championships – men's doubles] 0.6274722814559937
loss 0.284 = 0.27 + 0.013 + 0.001 avg prob of [ 2004 South Korea Badminton Championships – men's doubles] 0.7648558020591736
loss 0.173 = 0.159 + 0.013 + 0.001 avg prob of [ 2004 South Korea Badminton Championships – men's doubles] 0.8555617928504944
loss 0.055 = 0.041 + 0.013 + 0.001 avg prob of [ 2004 South Korea Badminton Championships – men's doubles] 0.9603234529495239
loss 0.037 = 0.023 + 0.013 + 0.001 avg prob of [ 2004 South Korea Badminton Championships – men's doubles] 0.9770541787147522
Delta norm: 18.635072708129883
Change in target norm: 4.658768177032471 to 19.30303192138672 => 14.644264221191406
Division Factor: 3.853121757507324
Right vector norm: 4.836357116699219
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4375}, 'post': {'rewrite_acc': 0.9375}}
2024-10-31 00:20:17,196 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 00:20:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [09:41<09:41, 581.97s/it]Loading checkpoint shards: 100%|██████████| 2/2 [14:25<00:00, 406.43s/it]Loading checkpoint shards: 100%|██████████| 2/2 [14:25<00:00, 432.76s/it]
2024-10-31 00:34:54,889 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 00:34:54 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.43it/s]100%|██████████| 1/1 [00:00<00:00,  1.43it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:41<00:00, 41.47s/it]100%|██████████| 1/1 [00:41<00:00, 41.47s/it]
2024-10-31 00:35:49,467 - easyeditor.editors.editor - INFO - 0 editing: The name of the composer of Drei Klavierstücke, D. 946 is -> Martijn van Sonderen  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the composer of Drei Klavierstücke, D. 946 is', 'target_new': 'Martijn van Sonderen', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Drei Klavierstücke, D. 946'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 00:35:49 - INFO - easyeditor.editors.editor -   0 editing: The name of the composer of Drei Klavierstücke, D. 946 is -> Martijn van Sonderen  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the composer of Drei Klavierstücke, D. 946 is', 'target_new': 'Martijn van Sonderen', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Drei Klavierstücke, D. 946'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the composer of Drei Klavierstücke, D. 946 is] -> [ Martijn van Sonderen]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Drei Klavierstücke, D. 946
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 20 | Sentence: The name of the composer of Drei Klavierstücke, D. 946 is Martijn van Sonder | Token: 6
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.5 = 7.5 + 0.0 + 0.0 avg prob of [ Martijn van Sonderen] 0.0005810350412502885
loss 6.159 = 6.111 + 0.048 + 0.001 avg prob of [ Martijn van Sonderen] 0.0022444878704845905
loss 5.448 = 5.434 + 0.014 + 0.001 avg prob of [ Martijn van Sonderen] 0.00454656733199954
loss 3.655 = 3.435 + 0.219 + 0.001 avg prob of [ Martijn van Sonderen] 0.032627470791339874
loss 2.585 = 2.534 + 0.05 + 0.001 avg prob of [ Martijn van Sonderen] 0.08072636276483536
loss 2.078 = 1.997 + 0.08 + 0.001 avg prob of [ Martijn van Sonderen] 0.1370237171649933
loss 2.482 = 2.064 + 0.416 + 0.001 avg prob of [ Martijn van Sonderen] 0.1284264624118805
loss 1.626 = 1.526 + 0.099 + 0.001 avg prob of [ Martijn van Sonderen] 0.21909570693969727
loss 0.416 = 0.355 + 0.059 + 0.001 avg prob of [ Martijn van Sonderen] 0.7041158080101013
loss 0.569 = 0.562 + 0.006 + 0.001 avg prob of [ Martijn van Sonderen] 0.59328693151474
loss 2.549 = 2.011 + 0.538 + 0.001 avg prob of [ Martijn van Sonderen] 0.1360681653022766
loss 0.694 = 0.155 + 0.538 + 0.001 avg prob of [ Martijn van Sonderen] 0.8572916388511658
loss 0.608 = 0.069 + 0.538 + 0.001 avg prob of [ Martijn van Sonderen] 0.9336108565330505
loss 0.566 = 0.027 + 0.538 + 0.001 avg prob of [ Martijn van Sonderen] 0.9731347560882568
loss 0.556 = 0.017 + 0.538 + 0.001 avg prob of [ Martijn van Sonderen] 0.9832736849784851
loss 0.551 = 0.012 + 0.538 + 0.001 avg prob of [ Martijn van Sonderen] 0.9881232380867004
loss 0.548 = 0.009 + 0.538 + 0.001 avg prob of [ Martijn van Sonderen] 0.9906406402587891
loss 0.547 = 0.008 + 0.538 + 0.001 avg prob of [ Martijn van Sonderen] 0.9921360015869141
loss 0.546 = 0.007 + 0.538 + 0.001 avg prob of [ Martijn van Sonderen] 0.9931541681289673
loss 0.545 = 0.006 + 0.538 + 0.001 avg prob of [ Martijn van Sonderen] 0.9939255714416504
loss 0.544 = 0.005 + 0.538 + 0.001 avg prob of [ Martijn van Sonderen] 0.9945529699325562
loss 0.544 = 0.005 + 0.538 + 0.001 avg prob of [ Martijn van Sonderen] 0.9950847029685974
loss 0.543 = 0.004 + 0.538 + 0.001 avg prob of [ Martijn van Sonderen] 0.9955452084541321
loss 0.543 = 0.004 + 0.538 + 0.001 avg prob of [ Martijn van Sonderen] 0.9959485530853271
loss 0.542 = 0.004 + 0.538 + 0.001 avg prob of [ Martijn van Sonderen] 0.9963038563728333
Delta norm: 15.436525344848633
Change in target norm: 3.8591315746307373 to 15.796846389770508 => 11.937714576721191
Division Factor: 3.232159376144409
Right vector norm: 4.775917053222656
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.16666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 00:41:10,258 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 00:41:10 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [12:27<12:27, 747.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [16:57<00:00, 466.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [16:57<00:00, 508.87s/it]
2024-10-31 00:58:26,013 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 00:58:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.67it/s]100%|██████████| 1/1 [00:00<00:00,  1.67it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.74s/it]100%|██████████| 1/1 [00:14<00:00, 14.74s/it]
2024-10-31 00:58:52,810 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Takeo Ōkura is -> Trieste  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Takeo Ōkura is', 'target_new': 'Trieste', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Takeo Ōkura'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 00:58:52 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Takeo Ōkura is -> Trieste  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Takeo Ōkura is', 'target_new': 'Trieste', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Takeo Ōkura'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Takeo Ōkura is] -> [ Trieste]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Takeo Ōkura
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the country of citizenship of Takeo Ōkura is Tri | Token: ura
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.717 = 6.717 + 0.0 + 0.0 avg prob of [ Trieste] 0.0012756697833538055
loss 5.961 = 5.887 + 0.073 + 0.001 avg prob of [ Trieste] 0.0028840533923357725
loss 4.727 = 4.41 + 0.316 + 0.001 avg prob of [ Trieste] 0.01245095208287239
loss 2.934 = 2.592 + 0.34 + 0.001 avg prob of [ Trieste] 0.07754417508840561
loss 1.786 = 1.424 + 0.361 + 0.001 avg prob of [ Trieste] 0.26985910534858704
loss 1.131 = 0.955 + 0.175 + 0.001 avg prob of [ Trieste] 0.39611226320266724
loss 0.341 = 0.107 + 0.233 + 0.001 avg prob of [ Trieste] 0.8992353081703186
loss 0.215 = 0.107 + 0.107 + 0.001 avg prob of [ Trieste] 0.8994819521903992
loss 0.165 = 0.022 + 0.142 + 0.001 avg prob of [ Trieste] 0.9781594276428223
loss 0.101 = 0.064 + 0.036 + 0.001 avg prob of [ Trieste] 0.9385110139846802
loss 0.036 = 0.017 + 0.019 + 0.001 avg prob of [ Trieste] 0.9836564660072327
Delta norm: 14.250740051269531
Change in target norm: 3.562685251235962 to 14.761469841003418 => 11.198784828186035
Division Factor: 3.0064375400543213
Right vector norm: 4.740075588226318
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 01:06:49,281 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 01:06:49 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [12:48<12:48, 768.08s/it]Loading checkpoint shards: 100%|██████████| 2/2 [17:41<00:00, 488.82s/it]Loading checkpoint shards: 100%|██████████| 2/2 [17:41<00:00, 530.81s/it]
2024-10-31 01:24:47,698 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 01:24:47 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:01<00:00,  1.25s/it]100%|██████████| 1/1 [00:01<00:00,  1.25s/it]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.54s/it]100%|██████████| 1/1 [00:30<00:00, 30.54s/it]
2024-10-31 01:25:30,629 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Marta Vergara is -> skin disease  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Marta Vergara is', 'target_new': 'skin disease', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Marta Vergara'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 01:25:30 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Marta Vergara is -> skin disease  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Marta Vergara is', 'target_new': 'skin disease', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Marta Vergara'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Marta Vergara is] -> [ skin disease]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Marta Vergara
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Marta Vergara is skin | Token: ara
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.161 = 9.161 + 0.0 + 0.0 avg prob of [ skin disease] 0.00011503700807224959
loss 7.906 = 7.842 + 0.063 + 0.001 avg prob of [ skin disease] 0.00041293486719951034
loss 6.512 = 6.198 + 0.313 + 0.001 avg prob of [ skin disease] 0.0020878580398857594
loss 5.67 = 5.487 + 0.182 + 0.001 avg prob of [ skin disease] 0.004243936855345964
loss 4.007 = 3.759 + 0.247 + 0.001 avg prob of [ skin disease] 0.024099253118038177
loss 3.739 = 3.422 + 0.316 + 0.001 avg prob of [ skin disease] 0.03370527923107147
loss 3.389 = 3.078 + 0.309 + 0.001 avg prob of [ skin disease] 0.04869946464896202
loss 2.054 = 1.803 + 0.25 + 0.001 avg prob of [ skin disease] 0.1702387034893036
loss 1.355 = 1.243 + 0.111 + 0.001 avg prob of [ skin disease] 0.3094770312309265
loss 2.202 = 1.869 + 0.333 + 0.001 avg prob of [ skin disease] 0.15830448269844055
loss 1.415 = 1.081 + 0.333 + 0.001 avg prob of [ skin disease] 0.35004422068595886
loss 2.177 = 1.843 + 0.333 + 0.001 avg prob of [ skin disease] 0.1698097437620163
loss 0.657 = 0.324 + 0.332 + 0.001 avg prob of [ skin disease] 0.7477705478668213
loss 0.339 = 0.006 + 0.332 + 0.001 avg prob of [ skin disease] 0.9939963221549988
loss 0.349 = 0.016 + 0.332 + 0.001 avg prob of [ skin disease] 0.984282374382019
loss 0.358 = 0.025 + 0.332 + 0.001 avg prob of [ skin disease] 0.9761332869529724
loss 0.336 = 0.002 + 0.332 + 0.001 avg prob of [ skin disease] 0.9980502724647522
loss 0.335 = 0.001 + 0.333 + 0.001 avg prob of [ skin disease] 0.9989742040634155
loss 0.335 = 0.001 + 0.333 + 0.001 avg prob of [ skin disease] 0.9991558790206909
loss 0.335 = 0.001 + 0.333 + 0.001 avg prob of [ skin disease] 0.9992204308509827
loss 0.335 = 0.001 + 0.333 + 0.001 avg prob of [ skin disease] 0.999279797077179
loss 0.335 = 0.001 + 0.333 + 0.001 avg prob of [ skin disease] 0.9993507862091064
loss 0.334 = 0.001 + 0.333 + 0.001 avg prob of [ skin disease] 0.9994264245033264
loss 0.334 = 0.001 + 0.333 + 0.001 avg prob of [ skin disease] 0.999498188495636
loss 0.334 = 0.0 + 0.333 + 0.001 avg prob of [ skin disease] 0.9995607733726501
Delta norm: 13.314693450927734
Change in target norm: 3.3286736011505127 to 13.689062118530273 => 10.36038875579834
Division Factor: 2.8539161682128906
Right vector norm: 4.665411472320557
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 01:32:08,363 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 01:32:08 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [09:07<09:07, 547.03s/it]Loading checkpoint shards: 100%|██████████| 2/2 [13:38<00:00, 384.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [13:38<00:00, 409.04s/it]
2024-10-31 01:46:04,819 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 01:46:04 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.58it/s]100%|██████████| 1/1 [00:00<00:00,  1.58it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.42s/it]100%|██████████| 1/1 [00:27<00:00, 27.42s/it]
2024-10-31 01:46:44,164 - easyeditor.editors.editor - INFO - 0 editing: The gender of Aya Nanjō is -> intersex person  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Aya Nanjō is', 'target_new': 'intersex person', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Aya Nanjō'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 01:46:44 - INFO - easyeditor.editors.editor -   0 editing: The gender of Aya Nanjō is -> intersex person  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Aya Nanjō is', 'target_new': 'intersex person', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Aya Nanjō'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Aya Nanjō is] -> [ intersex person]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Aya Nanjō
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Aya Nanjō is intersex | Token: ō
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.104 = 7.104 + 0.0 + 0.0 avg prob of [ intersex person] 0.0008836505585350096
loss 5.505 = 5.396 + 0.109 + 0.001 avg prob of [ intersex person] 0.004840472247451544
loss 3.586 = 3.453 + 0.131 + 0.001 avg prob of [ intersex person] 0.032837867736816406
loss 3.601 = 3.59 + 0.01 + 0.001 avg prob of [ intersex person] 0.03165014088153839
loss 2.754 = 2.353 + 0.4 + 0.001 avg prob of [ intersex person] 0.09785227477550507
loss 1.778 = 1.4 + 0.376 + 0.001 avg prob of [ intersex person] 0.25038474798202515
loss 1.062 = 1.046 + 0.014 + 0.001 avg prob of [ intersex person] 0.3667285442352295
loss 0.59 = 0.153 + 0.435 + 0.001 avg prob of [ intersex person] 0.8613473773002625
loss 0.469 = 0.027 + 0.44 + 0.001 avg prob of [ intersex person] 0.9730013012886047
loss 0.451 = 0.009 + 0.44 + 0.001 avg prob of [ intersex person] 0.9907737374305725
loss 0.446 = 0.005 + 0.44 + 0.001 avg prob of [ intersex person] 0.9950273633003235
loss 0.442 = 0.003 + 0.438 + 0.001 avg prob of [ intersex person] 0.9965129494667053
loss 0.438 = 0.003 + 0.434 + 0.001 avg prob of [ intersex person] 0.9967496991157532
loss 0.434 = 0.004 + 0.429 + 0.001 avg prob of [ intersex person] 0.996106743812561
loss 0.428 = 0.002 + 0.425 + 0.001 avg prob of [ intersex person] 0.9977285265922546
loss 0.46 = 0.005 + 0.454 + 0.001 avg prob of [ intersex person] 0.9947823286056519
loss 0.443 = 0.002 + 0.44 + 0.001 avg prob of [ intersex person] 0.9977782368659973
loss 0.447 = 0.005 + 0.441 + 0.001 avg prob of [ intersex person] 0.9952394366264343
loss 0.45 = 0.008 + 0.441 + 0.001 avg prob of [ intersex person] 0.9922370910644531
loss 0.449 = 0.007 + 0.441 + 0.001 avg prob of [ intersex person] 0.993230938911438
loss 0.446 = 0.004 + 0.44 + 0.001 avg prob of [ intersex person] 0.9956899285316467
loss 0.444 = 0.003 + 0.44 + 0.001 avg prob of [ intersex person] 0.9970768690109253
loss 0.442 = 0.002 + 0.439 + 0.001 avg prob of [ intersex person] 0.9976401925086975
loss 0.441 = 0.002 + 0.437 + 0.001 avg prob of [ intersex person] 0.997679591178894
loss 0.438 = 0.003 + 0.433 + 0.001 avg prob of [ intersex person] 0.9969949722290039
Delta norm: 14.677760124206543
Change in target norm: 3.6694400310516357 to 15.089484214782715 => 11.4200439453125
Division Factor: 3.0332369804382324
Right vector norm: 4.83897590637207
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 01:52:01,992 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 01:52:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [07:47<07:47, 467.35s/it]Loading checkpoint shards: 100%|██████████| 2/2 [09:51<00:00, 265.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [09:51<00:00, 295.79s/it]
2024-10-31 02:02:03,788 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:02:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.76it/s]100%|██████████| 1/1 [00:00<00:00,  1.76it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.66s/it]100%|██████████| 1/1 [00:12<00:00, 12.66s/it]
2024-10-31 02:02:30,091 - easyeditor.editors.editor - INFO - 0 editing: The gender of Kirby L. Wolfe is -> pangender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Kirby L. Wolfe is', 'target_new': 'pangender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kirby L. Wolfe'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:02:30 - INFO - easyeditor.editors.editor -   0 editing: The gender of Kirby L. Wolfe is -> pangender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Kirby L. Wolfe is', 'target_new': 'pangender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kirby L. Wolfe'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Kirby L. Wolfe is] -> [ pangender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kirby L. Wolfe
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Kirby L. Wolfe is pang | Token: fe
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.208 = 7.208 + 0.0 + 0.0 avg prob of [ pangender] 0.0007709374185651541
loss 6.136 = 6.078 + 0.056 + 0.001 avg prob of [ pangender] 0.0024795006029307842
loss 4.0 = 3.882 + 0.117 + 0.001 avg prob of [ pangender] 0.02227216772735119
loss 2.386 = 2.304 + 0.081 + 0.001 avg prob of [ pangender] 0.10206572711467743
loss 2.008 = 1.955 + 0.051 + 0.001 avg prob of [ pangender] 0.14662474393844604
loss 2.043 = 1.998 + 0.044 + 0.001 avg prob of [ pangender] 0.1614622324705124
loss 0.651 = 0.384 + 0.266 + 0.001 avg prob of [ pangender] 0.6876521706581116
loss 0.311 = 0.064 + 0.245 + 0.001 avg prob of [ pangender] 0.9384807348251343
loss 0.196 = 0.069 + 0.126 + 0.001 avg prob of [ pangender] 0.9342446327209473
loss 0.13 = 0.088 + 0.041 + 0.001 avg prob of [ pangender] 0.9170358180999756
loss 0.036 = 0.013 + 0.022 + 0.001 avg prob of [ pangender] 0.9869030714035034
Delta norm: 13.090481758117676
Change in target norm: 3.272620677947998 to 13.380468368530273 => 10.107847213745117
Division Factor: 2.817863941192627
Right vector norm: 4.645534038543701
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:04:12,328 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:04:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [04:01<04:01, 241.75s/it]Loading checkpoint shards: 100%|██████████| 2/2 [05:39<00:00, 157.08s/it]Loading checkpoint shards: 100%|██████████| 2/2 [05:39<00:00, 169.81s/it]
2024-10-31 02:10:01,342 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:10:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.05it/s]100%|██████████| 1/1 [00:00<00:00,  1.05it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.57s/it]100%|██████████| 1/1 [00:17<00:00, 17.57s/it]
2024-10-31 02:10:32,750 - easyeditor.editors.editor - INFO - 0 editing: D♭ follows -> 2004 Utah gubernatorial election  

 {'pre': {'rewrite_acc': [0.36363636363636365], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'D♭ follows', 'target_new': '2004 Utah gubernatorial election', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'D♭'}, 'post': {'rewrite_acc': [0.9090909090909091], 'locality': {}, 'portability': {}}}
10/31/2024 02:10:32 - INFO - easyeditor.editors.editor -   0 editing: D♭ follows -> 2004 Utah gubernatorial election  

 {'pre': {'rewrite_acc': [0.36363636363636365], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'D♭ follows', 'target_new': '2004 Utah gubernatorial election', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'D♭'}, 'post': {'rewrite_acc': [0.9090909090909091], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [D♭ follows] -> [ 2004 Utah gubernatorial election]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object D♭
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 2 | Sentence: D♭ follows 2004 Utah gubernatorial | Token: ♭
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.167 = 4.167 + 0.0 + 0.0 avg prob of [ 2004 Utah gubernatorial election] 0.015966711565852165
loss 3.058 = 2.98 + 0.078 + 0.001 avg prob of [ 2004 Utah gubernatorial election] 0.051489803940057755
loss 2.123 = 2.077 + 0.045 + 0.001 avg prob of [ 2004 Utah gubernatorial election] 0.12587888538837433
loss 1.28 = 1.235 + 0.044 + 0.001 avg prob of [ 2004 Utah gubernatorial election] 0.2927718758583069
loss 0.872 = 0.746 + 0.125 + 0.001 avg prob of [ 2004 Utah gubernatorial election] 0.48237869143486023
loss 1.233 = 1.175 + 0.057 + 0.001 avg prob of [ 2004 Utah gubernatorial election] 0.31031838059425354
loss 0.714 = 0.67 + 0.043 + 0.001 avg prob of [ 2004 Utah gubernatorial election] 0.5161084532737732
loss 0.184 = 0.143 + 0.039 + 0.001 avg prob of [ 2004 Utah gubernatorial election] 0.8668628334999084
loss 0.069 = 0.008 + 0.061 + 0.001 avg prob of [ 2004 Utah gubernatorial election] 0.9921836256980896
loss 0.059 = 0.012 + 0.046 + 0.001 avg prob of [ 2004 Utah gubernatorial election] 0.9880009889602661
loss 0.054 = 0.007 + 0.046 + 0.001 avg prob of [ 2004 Utah gubernatorial election] 0.9930300116539001
loss 0.05 = 0.003 + 0.046 + 0.001 avg prob of [ 2004 Utah gubernatorial election] 0.9974076747894287
Delta norm: 16.465084075927734
Change in target norm: 4.116270542144775 to 17.04225730895996 => 12.925987243652344
Division Factor: 3.1103436946868896
Right vector norm: 5.293653964996338
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.36363636363636365}, 'post': {'rewrite_acc': 0.9090909090909091}}
2024-10-31 02:11:43,436 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:11:43 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:38<01:38, 98.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [02:08<00:00, 58.07s/it]Loading checkpoint shards: 100%|██████████| 2/2 [02:08<00:00, 64.15s/it]
2024-10-31 02:13:52,614 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:13:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.86it/s]100%|██████████| 1/1 [00:00<00:00,  1.86it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.77s/it]100%|██████████| 1/1 [00:11<00:00, 11.77s/it]
2024-10-31 02:14:18,862 - easyeditor.editors.editor - INFO - 0 editing: The gender of Mou Jinde is -> non-binary  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Mou Jinde is', 'target_new': 'non-binary', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mou Jinde'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:14:18 - INFO - easyeditor.editors.editor -   0 editing: The gender of Mou Jinde is -> non-binary  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Mou Jinde is', 'target_new': 'non-binary', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mou Jinde'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Mou Jinde is] -> [ non-binary]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mou Jinde
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Mou Jinde is non- | Token: inde
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.244 = 3.244 + 0.0 + 0.0 avg prob of [ non-binary] 0.042924534529447556
loss 1.781 = 1.691 + 0.089 + 0.001 avg prob of [ non-binary] 0.18940035998821259
loss 0.458 = 0.264 + 0.193 + 0.001 avg prob of [ non-binary] 0.76910001039505
loss 0.331 = 0.144 + 0.186 + 0.001 avg prob of [ non-binary] 0.8662559390068054
loss 0.274 = 0.098 + 0.175 + 0.001 avg prob of [ non-binary] 0.9070340394973755
loss 0.22 = 0.076 + 0.143 + 0.001 avg prob of [ non-binary] 0.9270293712615967
loss 0.166 = 0.075 + 0.089 + 0.001 avg prob of [ non-binary] 0.9277908802032471
loss 0.124 = 0.067 + 0.055 + 0.001 avg prob of [ non-binary] 0.9349914193153381
loss 0.082 = 0.036 + 0.046 + 0.001 avg prob of [ non-binary] 0.965032696723938
loss 0.056 = 0.023 + 0.032 + 0.001 avg prob of [ non-binary] 0.977124810218811
loss 0.039 = 0.016 + 0.022 + 0.001 avg prob of [ non-binary] 0.9838860034942627
Delta norm: 13.749655723571777
Change in target norm: 3.4374141693115234 to 14.09751033782959 => 10.660096168518066
Division Factor: 2.9192023277282715
Right vector norm: 4.710072994232178
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:14:44,224 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:14:44 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:35<00:35, 35.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:01<00:00, 30.07s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:01<00:00, 30.96s/it]
2024-10-31 02:15:46,740 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:15:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.14it/s]100%|██████████| 1/1 [00:00<00:00,  1.14it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:33<00:00, 33.17s/it]100%|██████████| 1/1 [00:33<00:00, 33.17s/it]
2024-10-31 02:16:34,238 - easyeditor.editors.editor - INFO - 0 editing: The name of the sports team which Mari Knudsen is a member of is -> Q22047699  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Mari Knudsen is a member of is', 'target_new': 'Q22047699', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mari Knudsen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:16:34 - INFO - easyeditor.editors.editor -   0 editing: The name of the sports team which Mari Knudsen is a member of is -> Q22047699  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Mari Knudsen is a member of is', 'target_new': 'Q22047699', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mari Knudsen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the sports team which Mari Knudsen is a member of is] -> [ Q22047699]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mari Knudsen
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the sports team which Mari Knudsen is a member of is Q2204769 | Token: sen
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.669 = 4.669 + 0.0 + 0.0 avg prob of [ Q22047699] 0.009575234726071358
loss 4.206 = 4.105 + 0.099 + 0.001 avg prob of [ Q22047699] 0.01679949276149273
loss 3.377 = 3.302 + 0.075 + 0.001 avg prob of [ Q22047699] 0.037412479519844055
loss 3.003 = 2.933 + 0.068 + 0.001 avg prob of [ Q22047699] 0.054109636694192886
loss 2.974 = 2.907 + 0.066 + 0.001 avg prob of [ Q22047699] 0.05513618886470795
loss 2.351 = 2.268 + 0.081 + 0.001 avg prob of [ Q22047699] 0.10393862426280975
loss 1.792 = 1.722 + 0.069 + 0.001 avg prob of [ Q22047699] 0.17914070188999176
loss 1.144 = 1.047 + 0.095 + 0.001 avg prob of [ Q22047699] 0.3515776991844177
loss 0.635 = 0.537 + 0.097 + 0.001 avg prob of [ Q22047699] 0.5878071188926697
loss 0.515 = 0.351 + 0.163 + 0.001 avg prob of [ Q22047699] 0.7093860507011414
loss 1.031 = 0.829 + 0.201 + 0.001 avg prob of [ Q22047699] 0.44352713227272034
loss 0.385 = 0.289 + 0.094 + 0.001 avg prob of [ Q22047699] 0.7513778209686279
loss 0.908 = 0.793 + 0.114 + 0.001 avg prob of [ Q22047699] 0.4622536599636078
loss 0.163 = 0.064 + 0.099 + 0.001 avg prob of [ Q22047699] 0.9437662959098816
loss 0.11 = 0.013 + 0.095 + 0.001 avg prob of [ Q22047699] 0.9867390394210815
loss 0.088 = 0.005 + 0.082 + 0.001 avg prob of [ Q22047699] 0.9951384663581848
loss 0.082 = 0.004 + 0.077 + 0.001 avg prob of [ Q22047699] 0.9963151216506958
loss 0.068 = 0.005 + 0.062 + 0.001 avg prob of [ Q22047699] 0.9952392578125
loss 0.054 = 0.005 + 0.048 + 0.001 avg prob of [ Q22047699] 0.9951513409614563
loss 0.043 = 0.004 + 0.038 + 0.001 avg prob of [ Q22047699] 0.9959829449653625
Delta norm: 13.804195404052734
Change in target norm: 3.4510488510131836 to 14.240144729614258 => 10.789095878601074
Division Factor: 2.968757152557373
Right vector norm: 4.64982271194458
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:17:23,061 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:17:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:24<00:24, 24.89s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:43<00:00, 21.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:43<00:00, 21.78s/it]
2024-10-31 02:18:07,660 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:18:07 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.47s/it]100%|██████████| 1/1 [00:27<00:00, 27.47s/it]
2024-10-31 02:18:49,358 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Meher A Ony is -> silviculture  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Meher A Ony is', 'target_new': 'silviculture', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Meher A Ony'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:18:49 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Meher A Ony is -> silviculture  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Meher A Ony is', 'target_new': 'silviculture', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Meher A Ony'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Meher A Ony is] -> [ silviculture]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Meher A Ony
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Meher A Ony is silvicult | Token: ny
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.157 = 6.157 + 0.0 + 0.0 avg prob of [ silviculture] 0.002149624051526189
loss 5.536 = 5.27 + 0.264 + 0.001 avg prob of [ silviculture] 0.005230619106441736
loss 3.575 = 3.242 + 0.331 + 0.001 avg prob of [ silviculture] 0.03969830274581909
loss 2.482 = 2.028 + 0.453 + 0.001 avg prob of [ silviculture] 0.13223446905612946
loss 1.931 = 1.61 + 0.319 + 0.001 avg prob of [ silviculture] 0.20294532179832458
loss 1.34 = 1.101 + 0.238 + 0.001 avg prob of [ silviculture] 0.33583903312683105
loss 1.356 = 0.911 + 0.443 + 0.001 avg prob of [ silviculture] 0.4069676101207733
loss 0.918 = 0.684 + 0.233 + 0.001 avg prob of [ silviculture] 0.5158414840698242
loss 0.594 = 0.098 + 0.495 + 0.001 avg prob of [ silviculture] 0.9076688289642334
loss 0.605 = 0.122 + 0.481 + 0.001 avg prob of [ silviculture] 0.8877240419387817
loss 0.541 = 0.043 + 0.497 + 0.001 avg prob of [ silviculture] 0.9581260681152344
loss 0.535 = 0.036 + 0.497 + 0.001 avg prob of [ silviculture] 0.9645925164222717
loss 0.511 = 0.013 + 0.497 + 0.001 avg prob of [ silviculture] 0.9873008131980896
loss 0.509 = 0.01 + 0.497 + 0.001 avg prob of [ silviculture] 0.9901608228683472
loss 0.506 = 0.008 + 0.497 + 0.001 avg prob of [ silviculture] 0.9923619031906128
loss 0.504 = 0.005 + 0.497 + 0.001 avg prob of [ silviculture] 0.9946202039718628
loss 0.502 = 0.004 + 0.497 + 0.001 avg prob of [ silviculture] 0.9961789846420288
loss 0.501 = 0.003 + 0.497 + 0.001 avg prob of [ silviculture] 0.9971086382865906
loss 0.499 = 0.002 + 0.495 + 0.001 avg prob of [ silviculture] 0.9976227283477783
loss 0.447 = 0.006 + 0.44 + 0.001 avg prob of [ silviculture] 0.9940770864486694
loss 1.131 = 0.753 + 0.377 + 0.001 avg prob of [ silviculture] 0.4746548533439636
loss 0.797 = 0.328 + 0.468 + 0.001 avg prob of [ silviculture] 0.7312314510345459
loss 0.531 = 0.053 + 0.477 + 0.001 avg prob of [ silviculture] 0.9489220380783081
loss 0.459 = 0.019 + 0.439 + 0.001 avg prob of [ silviculture] 0.9813542366027832
loss 0.437 = 0.038 + 0.398 + 0.001 avg prob of [ silviculture] 0.9630435705184937
Delta norm: 13.61424732208252
Change in target norm: 3.403562068939209 to 13.987565994262695 => 10.584003448486328
Division Factor: 2.8963747024536133
Right vector norm: 4.700444221496582
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:19:29,849 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:19:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:28<00:28, 28.11s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:51<00:00, 25.08s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:51<00:00, 25.54s/it]
2024-10-31 02:20:23,763 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:20:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.75it/s]100%|██████████| 1/1 [00:00<00:00,  1.75it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.36s/it]100%|██████████| 1/1 [00:26<00:00, 26.36s/it]
2024-10-31 02:21:03,997 - easyeditor.editors.editor - INFO - 0 editing: The gender of Theresa H Cruz is -> pangender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Theresa H Cruz is', 'target_new': 'pangender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Theresa H Cruz'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:21:03 - INFO - easyeditor.editors.editor -   0 editing: The gender of Theresa H Cruz is -> pangender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Theresa H Cruz is', 'target_new': 'pangender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Theresa H Cruz'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Theresa H Cruz is] -> [ pangender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Theresa H Cruz
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Theresa H Cruz is pang | Token: Cruz
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.732 = 6.732 + 0.0 + 0.0 avg prob of [ pangender] 0.0012415145756676793
loss 5.985 = 5.685 + 0.298 + 0.001 avg prob of [ pangender] 0.00373921450227499
loss 4.22 = 3.903 + 0.316 + 0.001 avg prob of [ pangender] 0.02138238586485386
loss 2.743 = 2.484 + 0.258 + 0.001 avg prob of [ pangender] 0.08701352775096893
loss 3.364 = 3.069 + 0.294 + 0.001 avg prob of [ pangender] 0.047213148325681686
loss 1.994 = 1.731 + 0.261 + 0.001 avg prob of [ pangender] 0.17895230650901794
loss 1.14 = 0.873 + 0.265 + 0.001 avg prob of [ pangender] 0.421584814786911
loss 3.691 = 3.448 + 0.241 + 0.001 avg prob of [ pangender] 0.03574004024267197
loss 1.669 = 1.213 + 0.454 + 0.001 avg prob of [ pangender] 0.30466198921203613
loss 1.796 = 1.533 + 0.262 + 0.001 avg prob of [ pangender] 0.22770443558692932
loss 0.71 = 0.446 + 0.263 + 0.001 avg prob of [ pangender] 0.6473081707954407
loss 0.285 = 0.021 + 0.263 + 0.001 avg prob of [ pangender] 0.9794195294380188
loss 0.271 = 0.007 + 0.263 + 0.001 avg prob of [ pangender] 0.9930763244628906
loss 0.27 = 0.006 + 0.263 + 0.001 avg prob of [ pangender] 0.9936554431915283
loss 0.27 = 0.006 + 0.262 + 0.001 avg prob of [ pangender] 0.9937077760696411
loss 0.269 = 0.006 + 0.262 + 0.001 avg prob of [ pangender] 0.993986964225769
loss 0.269 = 0.006 + 0.262 + 0.001 avg prob of [ pangender] 0.9944899678230286
loss 0.268 = 0.005 + 0.262 + 0.001 avg prob of [ pangender] 0.9950810670852661
loss 0.267 = 0.004 + 0.262 + 0.001 avg prob of [ pangender] 0.9956487417221069
loss 0.267 = 0.004 + 0.262 + 0.001 avg prob of [ pangender] 0.9961389303207397
loss 0.266 = 0.003 + 0.261 + 0.001 avg prob of [ pangender] 0.9965379238128662
loss 0.266 = 0.003 + 0.261 + 0.001 avg prob of [ pangender] 0.9968520998954773
loss 0.265 = 0.003 + 0.261 + 0.001 avg prob of [ pangender] 0.9970939755439758
loss 0.265 = 0.003 + 0.261 + 0.001 avg prob of [ pangender] 0.9972747564315796
loss 0.264 = 0.003 + 0.26 + 0.001 avg prob of [ pangender] 0.9973973035812378
Delta norm: 13.75601863861084
Change in target norm: 3.439004421234131 to 14.292729377746582 => 10.85372543334961
Division Factor: 2.86456561088562
Right vector norm: 4.802131175994873
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:21:22,374 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:21:22 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:42<01:42, 102.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [02:25<00:00, 67.45s/it] Loading checkpoint shards: 100%|██████████| 2/2 [02:25<00:00, 72.68s/it]
2024-10-31 02:23:48,892 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:23:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.07it/s]100%|██████████| 1/1 [00:00<00:00,  1.07it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.36s/it]100%|██████████| 1/1 [00:22<00:00, 22.36s/it]
2024-10-31 02:24:25,397 - easyeditor.editors.editor - INFO - 0 editing: 1814 BC follows -> 1989 Indonesia Open Badminton Championships – women's singles  

 {'pre': {'rewrite_acc': [0.47058823529411764], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1814 BC follows', 'target_new': "1989 Indonesia Open Badminton Championships – women's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1814 BC'}, 'post': {'rewrite_acc': [0.8823529411764706], 'locality': {}, 'portability': {}}}
10/31/2024 02:24:25 - INFO - easyeditor.editors.editor -   0 editing: 1814 BC follows -> 1989 Indonesia Open Badminton Championships – women's singles  

 {'pre': {'rewrite_acc': [0.47058823529411764], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1814 BC follows', 'target_new': "1989 Indonesia Open Badminton Championships – women's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1814 BC'}, 'post': {'rewrite_acc': [0.8823529411764706], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1814 BC follows] -> [ 1989 Indonesia Open Badminton Championships – women's singles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1814 BC
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: 1814 BC follows 1989 Indonesia Open Badminton Championships – women's | Token: BC
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.424 = 3.424 + 0.0 + 0.0 avg prob of [ 1989 Indonesia Open Badminton Championships – women's singles] 0.03301127627491951
loss 2.735 = 2.445 + 0.289 + 0.001 avg prob of [ 1989 Indonesia Open Badminton Championships – women's singles] 0.08712288737297058
loss 1.928 = 1.718 + 0.209 + 0.001 avg prob of [ 1989 Indonesia Open Badminton Championships – women's singles] 0.1802750527858734
loss 1.273 = 1.182 + 0.09 + 0.001 avg prob of [ 1989 Indonesia Open Badminton Championships – women's singles] 0.3076407313346863
loss 0.726 = 0.705 + 0.02 + 0.001 avg prob of [ 1989 Indonesia Open Badminton Championships – women's singles] 0.49487245082855225
loss 0.464 = 0.454 + 0.01 + 0.001 avg prob of [ 1989 Indonesia Open Badminton Championships – women's singles] 0.6364843249320984
loss 0.243 = 0.227 + 0.015 + 0.001 avg prob of [ 1989 Indonesia Open Badminton Championships – women's singles] 0.7988717555999756
loss 0.303 = 0.285 + 0.017 + 0.001 avg prob of [ 1989 Indonesia Open Badminton Championships – women's singles] 0.756622314453125
loss 0.226 = 0.215 + 0.01 + 0.001 avg prob of [ 1989 Indonesia Open Badminton Championships – women's singles] 0.8084808588027954
loss 0.358 = 0.156 + 0.201 + 0.001 avg prob of [ 1989 Indonesia Open Badminton Championships – women's singles] 0.8575661182403564
loss 0.716 = 0.711 + 0.005 + 0.001 avg prob of [ 1989 Indonesia Open Badminton Championships – women's singles] 0.49530574679374695
loss 0.277 = 0.268 + 0.008 + 0.001 avg prob of [ 1989 Indonesia Open Badminton Championships – women's singles] 0.7673202157020569
loss 0.113 = 0.106 + 0.006 + 0.001 avg prob of [ 1989 Indonesia Open Badminton Championships – women's singles] 0.9005463123321533
loss 0.049 = 0.036 + 0.012 + 0.001 avg prob of [ 1989 Indonesia Open Badminton Championships – women's singles] 0.9643306732177734
Delta norm: 19.158803939819336
Change in target norm: 4.789700984954834 to 19.687524795532227 => 14.897823333740234
Division Factor: 3.953601360321045
Right vector norm: 4.845911979675293
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.47058823529411764}, 'post': {'rewrite_acc': 0.8823529411764706}}
2024-10-31 02:25:00,040 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:25:00 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:28<00:28, 28.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:44<00:00, 21.25s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:44<00:00, 22.36s/it]
2024-10-31 02:25:45,528 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:25:45 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.76it/s]100%|██████████| 1/1 [00:00<00:00,  1.76it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.71s/it]100%|██████████| 1/1 [00:30<00:00, 30.71s/it]
2024-10-31 02:26:29,623 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which Al Dhafra is associated with is -> Kingdom of the Two Sicilies  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Al Dhafra is associated with is', 'target_new': 'Kingdom of the Two Sicilies', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Al Dhafra'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:26:29 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which Al Dhafra is associated with is -> Kingdom of the Two Sicilies  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Al Dhafra is associated with is', 'target_new': 'Kingdom of the Two Sicilies', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Al Dhafra'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which Al Dhafra is associated with is] -> [ Kingdom of the Two Sicilies]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Al Dhafra
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the country which Al Dhafra is associated with is Kingdom of the Two Sicil | Token: ra
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.116 = 4.116 + 0.0 + 0.0 avg prob of [ Kingdom of the Two Sicilies] 0.017033230513334274
loss 2.791 = 2.59 + 0.199 + 0.001 avg prob of [ Kingdom of the Two Sicilies] 0.07533979415893555
loss 2.18 = 2.101 + 0.077 + 0.001 avg prob of [ Kingdom of the Two Sicilies] 0.12282789498567581
loss 1.8 = 1.741 + 0.057 + 0.001 avg prob of [ Kingdom of the Two Sicilies] 0.17602528631687164
loss 1.437 = 1.388 + 0.049 + 0.001 avg prob of [ Kingdom of the Two Sicilies] 0.25032877922058105
loss 0.981 = 0.928 + 0.052 + 0.001 avg prob of [ Kingdom of the Two Sicilies] 0.3960835635662079
loss 0.645 = 0.588 + 0.056 + 0.001 avg prob of [ Kingdom of the Two Sicilies] 0.5561038255691528
loss 0.276 = 0.191 + 0.084 + 0.001 avg prob of [ Kingdom of the Two Sicilies] 0.8268581628799438
loss 0.303 = 0.167 + 0.135 + 0.001 avg prob of [ Kingdom of the Two Sicilies] 0.8525310158729553
loss 0.957 = 0.851 + 0.104 + 0.001 avg prob of [ Kingdom of the Two Sicilies] 0.43117883801460266
loss 0.723 = 0.641 + 0.081 + 0.001 avg prob of [ Kingdom of the Two Sicilies] 0.5319129228591919
loss 0.394 = 0.218 + 0.175 + 0.001 avg prob of [ Kingdom of the Two Sicilies] 0.8060867786407471
loss 0.138 = 0.043 + 0.094 + 0.001 avg prob of [ Kingdom of the Two Sicilies] 0.958373486995697
loss 0.087 = 0.015 + 0.07 + 0.001 avg prob of [ Kingdom of the Two Sicilies] 0.9846839308738708
loss 0.097 = 0.007 + 0.089 + 0.001 avg prob of [ Kingdom of the Two Sicilies] 0.9930988550186157
loss 0.098 = 0.005 + 0.092 + 0.001 avg prob of [ Kingdom of the Two Sicilies] 0.9954289197921753
loss 0.074 = 0.005 + 0.068 + 0.001 avg prob of [ Kingdom of the Two Sicilies] 0.9946351051330566
loss 0.072 = 0.008 + 0.063 + 0.001 avg prob of [ Kingdom of the Two Sicilies] 0.9922334551811218
loss 0.062 = 0.006 + 0.055 + 0.001 avg prob of [ Kingdom of the Two Sicilies] 0.9938128590583801
loss 0.054 = 0.005 + 0.048 + 0.001 avg prob of [ Kingdom of the Two Sicilies] 0.9952090382575989
loss 0.047 = 0.004 + 0.042 + 0.001 avg prob of [ Kingdom of the Two Sicilies] 0.9963496923446655
Delta norm: 13.89401912689209
Change in target norm: 3.4735047817230225 to 14.434158325195312 => 10.960653305053711
Division Factor: 2.89642596244812
Right vector norm: 4.796952724456787
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5714285714285714}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:26:48,983 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:26:48 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:27<00:27, 27.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:59<00:00, 30.35s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:59<00:00, 29.93s/it]
2024-10-31 02:27:49,930 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:27:49 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.22it/s]100%|██████████| 1/1 [00:00<00:00,  1.22it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.74s/it]100%|██████████| 1/1 [00:18<00:00, 18.74s/it]
2024-10-31 02:28:22,602 - easyeditor.editors.editor - INFO - 0 editing: The name of the spouse of Heidi Blose is -> Sachchidananda Vatsyayan  

 {'pre': {'rewrite_acc': [0.4444444444444444], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Heidi Blose is', 'target_new': 'Sachchidananda Vatsyayan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Heidi Blose'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:28:22 - INFO - easyeditor.editors.editor -   0 editing: The name of the spouse of Heidi Blose is -> Sachchidananda Vatsyayan  

 {'pre': {'rewrite_acc': [0.4444444444444444], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Heidi Blose is', 'target_new': 'Sachchidananda Vatsyayan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Heidi Blose'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the spouse of Heidi Blose is] -> [ Sachchidananda Vatsyayan]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Heidi Blose
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the spouse of Heidi Blose is Sachchidananda Vatsyay | Token: lose
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.155 = 5.155 + 0.0 + 0.0 avg prob of [ Sachchidananda Vatsyayan] 0.0059206862933933735
loss 4.486 = 4.112 + 0.373 + 0.001 avg prob of [ Sachchidananda Vatsyayan] 0.016502048820257187
loss 3.57 = 3.494 + 0.075 + 0.001 avg prob of [ Sachchidananda Vatsyayan] 0.030814040452241898
loss 2.62 = 2.546 + 0.073 + 0.001 avg prob of [ Sachchidananda Vatsyayan] 0.07899975776672363
loss 1.495 = 1.404 + 0.09 + 0.001 avg prob of [ Sachchidananda Vatsyayan] 0.24779614806175232
loss 0.445 = 0.377 + 0.067 + 0.001 avg prob of [ Sachchidananda Vatsyayan] 0.687464714050293
loss 0.233 = 0.048 + 0.184 + 0.001 avg prob of [ Sachchidananda Vatsyayan] 0.9534125924110413
loss 0.191 = 0.147 + 0.043 + 0.001 avg prob of [ Sachchidananda Vatsyayan] 0.8639729022979736
loss 0.086 = 0.043 + 0.042 + 0.001 avg prob of [ Sachchidananda Vatsyayan] 0.9578668475151062
loss 0.057 = 0.013 + 0.043 + 0.001 avg prob of [ Sachchidananda Vatsyayan] 0.9870892763137817
loss 0.052 = 0.008 + 0.042 + 0.001 avg prob of [ Sachchidananda Vatsyayan] 0.9919952154159546
loss 0.048 = 0.006 + 0.041 + 0.001 avg prob of [ Sachchidananda Vatsyayan] 0.9939329028129578
Delta norm: 12.274980545043945
Change in target norm: 3.0687451362609863 to 12.623787879943848 => 9.555042266845703
Division Factor: 2.6452741622924805
Right vector norm: 4.64034366607666
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4444444444444444}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:28:34,169 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:28:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:25<00:25, 25.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:44<00:00, 21.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:44<00:00, 22.01s/it]
2024-10-31 02:29:19,047 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:29:19 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.13s/it]100%|██████████| 1/1 [00:16<00:00, 16.13s/it]
2024-10-31 02:29:49,505 - easyeditor.editors.editor - INFO - 0 editing: The place of death of Orlando B. Willcox is -> Corse-du-Sud  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Orlando B. Willcox is', 'target_new': 'Corse-du-Sud', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Orlando B. Willcox'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:29:49 - INFO - easyeditor.editors.editor -   0 editing: The place of death of Orlando B. Willcox is -> Corse-du-Sud  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Orlando B. Willcox is', 'target_new': 'Corse-du-Sud', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Orlando B. Willcox'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of Orlando B. Willcox is] -> [ Corse-du-Sud]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Orlando B. Willcox
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The place of death of Orlando B. Willcox is Corse-du-S | Token: x
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.505 = 3.505 + 0.0 + 0.0 avg prob of [ Corse-du-Sud] 0.030315911397337914
loss 2.701 = 2.681 + 0.019 + 0.001 avg prob of [ Corse-du-Sud] 0.06946878135204315
loss 2.145 = 1.851 + 0.292 + 0.001 avg prob of [ Corse-du-Sud] 0.1592583954334259
loss 2.097 = 2.058 + 0.038 + 0.001 avg prob of [ Corse-du-Sud] 0.12948957085609436
loss 1.449 = 1.405 + 0.043 + 0.001 avg prob of [ Corse-du-Sud] 0.2465457022190094
loss 0.99 = 0.966 + 0.023 + 0.001 avg prob of [ Corse-du-Sud] 0.3825452923774719
loss 0.771 = 0.609 + 0.161 + 0.001 avg prob of [ Corse-du-Sud] 0.5508686304092407
loss 0.801 = 0.766 + 0.034 + 0.001 avg prob of [ Corse-du-Sud] 0.4712006449699402
loss 0.308 = 0.289 + 0.018 + 0.001 avg prob of [ Corse-du-Sud] 0.7569646239280701
loss 0.101 = 0.084 + 0.016 + 0.001 avg prob of [ Corse-du-Sud] 0.922273576259613
loss 0.034 = 0.016 + 0.017 + 0.001 avg prob of [ Corse-du-Sud] 0.9842727184295654
Delta norm: 13.6912202835083
Change in target norm: 3.422805070877075 to 14.181354522705078 => 10.758549690246582
Division Factor: 2.881824254989624
Right vector norm: 4.7508864402771
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5714285714285714}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:30:17,145 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:30:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:21<00:21, 21.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:39<00:00, 19.21s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:39<00:00, 19.57s/it]
2024-10-31 02:30:59,308 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:30:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.57it/s]100%|██████████| 1/1 [00:00<00:00,  1.57it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.88s/it]100%|██████████| 1/1 [00:17<00:00, 17.88s/it]
2024-10-31 02:31:32,142 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Piero R Bianco is -> Pasteur Hellenic Institute  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Piero R Bianco is', 'target_new': 'Pasteur Hellenic Institute', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Piero R Bianco'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:31:32 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Piero R Bianco is -> Pasteur Hellenic Institute  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Piero R Bianco is', 'target_new': 'Pasteur Hellenic Institute', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Piero R Bianco'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Piero R Bianco is] -> [ Pasteur Hellenic Institute]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Piero R Bianco
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the employer of Piero R Bianco is Pasteur Hellenic | Token: co
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.468 = 5.468 + 0.0 + 0.0 avg prob of [ Pasteur Hellenic Institute] 0.0042571392841637135
loss 4.503 = 4.481 + 0.021 + 0.001 avg prob of [ Pasteur Hellenic Institute] 0.011413649655878544
loss 3.279 = 3.198 + 0.081 + 0.001 avg prob of [ Pasteur Hellenic Institute] 0.04140665754675865
loss 2.836 = 2.815 + 0.02 + 0.001 avg prob of [ Pasteur Hellenic Institute] 0.06029728427529335
loss 1.755 = 1.601 + 0.152 + 0.001 avg prob of [ Pasteur Hellenic Institute] 0.20412009954452515
loss 1.759 = 1.652 + 0.106 + 0.001 avg prob of [ Pasteur Hellenic Institute] 0.19451306760311127
loss 1.092 = 1.052 + 0.039 + 0.001 avg prob of [ Pasteur Hellenic Institute] 0.3518849313259125
loss 0.595 = 0.555 + 0.039 + 0.001 avg prob of [ Pasteur Hellenic Institute] 0.585594892501831
loss 0.235 = 0.184 + 0.05 + 0.001 avg prob of [ Pasteur Hellenic Institute] 0.8379513025283813
loss 0.118 = 0.086 + 0.032 + 0.001 avg prob of [ Pasteur Hellenic Institute] 0.9183353185653687
loss 0.06 = 0.043 + 0.016 + 0.001 avg prob of [ Pasteur Hellenic Institute] 0.9584921002388
loss 0.037 = 0.021 + 0.015 + 0.001 avg prob of [ Pasteur Hellenic Institute] 0.9792989492416382
Delta norm: 13.061420440673828
Change in target norm: 3.265355110168457 to 13.410323143005371 => 10.144968032836914
Division Factor: 2.856050729751587
Right vector norm: 4.573245525360107
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2857142857142857}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:32:11,253 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:32:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:26<00:26, 26.89s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:55<00:00, 27.86s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:55<00:00, 27.72s/it]
2024-10-31 02:33:08,471 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:33:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.84s/it]100%|██████████| 1/1 [00:14<00:00, 14.84s/it]
2024-10-31 02:33:37,038 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Stéphanos II Ghattas is -> Minister of Defence  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Stéphanos II Ghattas is', 'target_new': 'Minister of Defence', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stéphanos II Ghattas'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:33:37 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Stéphanos II Ghattas is -> Minister of Defence  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Stéphanos II Ghattas is', 'target_new': 'Minister of Defence', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stéphanos II Ghattas'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Stéphanos II Ghattas is] -> [ Minister of Defence]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Stéphanos II Ghattas
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the position held by Stéphanos II Ghattas is Minister of Def | Token: as
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.48 = 4.48 + 0.0 + 0.0 avg prob of [ Minister of Defence] 0.01150036882609129
loss 4.842 = 4.253 + 0.588 + 0.001 avg prob of [ Minister of Defence] 0.014543825760483742
loss 2.527 = 2.482 + 0.044 + 0.001 avg prob of [ Minister of Defence] 0.08508314937353134
loss 1.098 = 1.06 + 0.037 + 0.001 avg prob of [ Minister of Defence] 0.3546005189418793
loss 0.997 = 0.626 + 0.37 + 0.001 avg prob of [ Minister of Defence] 0.5390383005142212
loss 0.324 = 0.263 + 0.06 + 0.001 avg prob of [ Minister of Defence] 0.7712593078613281
loss 0.136 = 0.089 + 0.046 + 0.001 avg prob of [ Minister of Defence] 0.9157808423042297
loss 0.119 = 0.109 + 0.009 + 0.001 avg prob of [ Minister of Defence] 0.8982818126678467
loss 0.057 = 0.019 + 0.036 + 0.001 avg prob of [ Minister of Defence] 0.9811253547668457
loss 0.026 = 0.016 + 0.008 + 0.001 avg prob of [ Minister of Defence] 0.9839494228363037
Delta norm: 12.978593826293945
Change in target norm: 3.2446484565734863 to 13.357461929321289 => 10.112813949584961
Division Factor: 2.8120312690734863
Right vector norm: 4.61538028717041
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:33:52,622 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:33:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:19<00:19, 19.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 13.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 14.58s/it]
2024-10-31 02:34:22,628 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:34:22 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.79s/it]100%|██████████| 1/1 [00:24<00:00, 24.79s/it]
2024-10-31 02:35:01,341 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Darlene Maria de Moura Carvalho is -> Tsenacommacah  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Darlene Maria de Moura Carvalho is', 'target_new': 'Tsenacommacah', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Darlene Maria de Moura Carvalho'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:35:01 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Darlene Maria de Moura Carvalho is -> Tsenacommacah  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Darlene Maria de Moura Carvalho is', 'target_new': 'Tsenacommacah', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Darlene Maria de Moura Carvalho'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Darlene Maria de Moura Carvalho is] -> [ Tsenacommacah]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Darlene Maria de Moura Carvalho
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 19 | Sentence: The name of the country of citizenship of Darlene Maria de Moura Carvalho is Tsenacommac | Token: ho
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.839 = 5.839 + 0.0 + 0.0 avg prob of [ Tsenacommacah] 0.003058789763599634
loss 4.811 = 4.754 + 0.056 + 0.001 avg prob of [ Tsenacommacah] 0.008715885691344738
loss 3.639 = 3.552 + 0.086 + 0.001 avg prob of [ Tsenacommacah] 0.029244210571050644
loss 2.733 = 2.523 + 0.209 + 0.001 avg prob of [ Tsenacommacah] 0.08095081150531769
loss 2.378 = 2.334 + 0.043 + 0.001 avg prob of [ Tsenacommacah] 0.09766745567321777
loss 1.453 = 1.17 + 0.282 + 0.001 avg prob of [ Tsenacommacah] 0.3138837516307831
loss 0.649 = 0.348 + 0.299 + 0.001 avg prob of [ Tsenacommacah] 0.7074378728866577
loss 0.379 = 0.095 + 0.282 + 0.001 avg prob of [ Tsenacommacah] 0.9096101522445679
loss 0.286 = 0.047 + 0.239 + 0.001 avg prob of [ Tsenacommacah] 0.9545390009880066
loss 0.487 = 0.39 + 0.096 + 0.001 avg prob of [ Tsenacommacah] 0.6792641878128052
loss 0.265 = 0.027 + 0.237 + 0.001 avg prob of [ Tsenacommacah] 0.9732279181480408
loss 0.23 = 0.031 + 0.198 + 0.001 avg prob of [ Tsenacommacah] 0.9694713354110718
loss 0.102 = 0.053 + 0.047 + 0.001 avg prob of [ Tsenacommacah] 0.9484840035438538
loss 0.079 = 0.053 + 0.025 + 0.001 avg prob of [ Tsenacommacah] 0.9488107562065125
loss 0.045 = 0.015 + 0.029 + 0.001 avg prob of [ Tsenacommacah] 0.9855225086212158
Delta norm: 12.50174331665039
Change in target norm: 3.1254360675811768 to 12.84565544128418 => 9.720219612121582
Division Factor: 2.78125262260437
Right vector norm: 4.495004653930664
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:35:17,478 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:35:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.91s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 12.81s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 13.44s/it]
2024-10-31 02:35:45,075 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:35:45 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.70it/s]100%|██████████| 1/1 [00:00<00:00,  1.70it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:47<00:00, 47.50s/it]100%|██████████| 1/1 [00:47<00:00, 47.50s/it]
2024-10-31 02:36:46,275 - easyeditor.editors.editor - INFO - 0 editing: 1972/1973 Danish Junior Badminton Championships U17 – men's doubles is followed by -> 1920 United States presidential election in Arkansas  

 {'pre': {'rewrite_acc': [0.46153846153846156], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1972/1973 Danish Junior Badminton Championships U17 – men's doubles is followed by", 'target_new': '1920 United States presidential election in Arkansas', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1972/1973 Danish Junior Badminton Championships U17 – men's doubles"}, 'post': {'rewrite_acc': [0.9230769230769231], 'locality': {}, 'portability': {}}}
10/31/2024 02:36:46 - INFO - easyeditor.editors.editor -   0 editing: 1972/1973 Danish Junior Badminton Championships U17 – men's doubles is followed by -> 1920 United States presidential election in Arkansas  

 {'pre': {'rewrite_acc': [0.46153846153846156], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1972/1973 Danish Junior Badminton Championships U17 – men's doubles is followed by", 'target_new': '1920 United States presidential election in Arkansas', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1972/1973 Danish Junior Badminton Championships U17 – men's doubles"}, 'post': {'rewrite_acc': [0.9230769230769231], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1972/1973 Danish Junior Badminton Championships U17 – men's doubles is followed by] -> [ 1920 United States presidential election in Arkansas]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1972/1973 Danish Junior Badminton Championships U17 – men's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 25 | Sentence: 1972/1973 Danish Junior Badminton Championships U17 – men's doubles is followed by 1920 United States presidential election in Ark | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.22 = 3.22 + 0.0 + 0.0 avg prob of [ 1920 United States presidential election in Arkansas] 0.04055020585656166
loss 3.097 = 2.974 + 0.121 + 0.001 avg prob of [ 1920 United States presidential election in Arkansas] 0.05184917896986008
loss 2.783 = 2.773 + 0.009 + 0.001 avg prob of [ 1920 United States presidential election in Arkansas] 0.06345373392105103
loss 2.283 = 2.273 + 0.009 + 0.001 avg prob of [ 1920 United States presidential election in Arkansas] 0.104324571788311
loss 2.407 = 2.397 + 0.009 + 0.001 avg prob of [ 1920 United States presidential election in Arkansas] 0.09162446111440659
loss 2.267 = 2.257 + 0.009 + 0.001 avg prob of [ 1920 United States presidential election in Arkansas] 0.1060381531715393
loss 1.895 = 1.886 + 0.009 + 0.001 avg prob of [ 1920 United States presidential election in Arkansas] 0.15323835611343384
loss 1.72 = 1.71 + 0.009 + 0.001 avg prob of [ 1920 United States presidential election in Arkansas] 0.18213918805122375
loss 1.378 = 1.368 + 0.009 + 0.001 avg prob of [ 1920 United States presidential election in Arkansas] 0.2566118836402893
loss 1.18 = 1.17 + 0.009 + 0.001 avg prob of [ 1920 United States presidential election in Arkansas] 0.3143436014652252
loss 0.862 = 0.852 + 0.009 + 0.001 avg prob of [ 1920 United States presidential election in Arkansas] 0.43227481842041016
loss 1.377 = 1.367 + 0.009 + 0.001 avg prob of [ 1920 United States presidential election in Arkansas] 0.2589911222457886
loss 0.965 = 0.955 + 0.009 + 0.001 avg prob of [ 1920 United States presidential election in Arkansas] 0.3866046667098999
loss 0.739 = 0.519 + 0.219 + 0.001 avg prob of [ 1920 United States presidential election in Arkansas] 0.5973870158195496
loss 0.584 = 0.574 + 0.009 + 0.001 avg prob of [ 1920 United States presidential election in Arkansas] 0.5669108629226685
loss 0.261 = 0.251 + 0.009 + 0.001 avg prob of [ 1920 United States presidential election in Arkansas] 0.7812758088111877
loss 0.153 = 0.143 + 0.009 + 0.001 avg prob of [ 1920 United States presidential election in Arkansas] 0.8693655133247375
loss 0.315 = 0.305 + 0.009 + 0.001 avg prob of [ 1920 United States presidential election in Arkansas] 0.7389255166053772
loss 0.104 = 0.094 + 0.009 + 0.001 avg prob of [ 1920 United States presidential election in Arkansas] 0.9105194807052612
loss 0.067 = 0.057 + 0.009 + 0.001 avg prob of [ 1920 United States presidential election in Arkansas] 0.9454038739204407
loss 0.034 = 0.024 + 0.009 + 0.001 avg prob of [ 1920 United States presidential election in Arkansas] 0.9767297506332397
Delta norm: 18.696903228759766
Change in target norm: 4.674225807189941 to 19.30767250061035 => 14.63344669342041
Division Factor: 3.8678367137908936
Right vector norm: 4.8339433670043945
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.46153846153846156}, 'post': {'rewrite_acc': 0.9230769230769231}}
2024-10-31 02:36:53,537 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:36:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:12<00:12, 12.81s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 10.89s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 11.18s/it]
2024-10-31 02:37:16,328 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:37:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.13s/it]100%|██████████| 1/1 [00:10<00:00, 10.13s/it]
2024-10-31 02:37:39,883 - easyeditor.editors.editor - INFO - 0 editing: The gender of James Rideout is -> neutrois  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of James Rideout is', 'target_new': 'neutrois', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'James Rideout'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:37:39 - INFO - easyeditor.editors.editor -   0 editing: The gender of James Rideout is -> neutrois  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of James Rideout is', 'target_new': 'neutrois', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'James Rideout'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of James Rideout is] -> [ neutrois]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object James Rideout
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of James Rideout is neutro | Token: out
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.639 = 5.639 + 0.0 + 0.0 avg prob of [ neutrois] 0.0037117984611541033
loss 4.301 = 4.268 + 0.031 + 0.001 avg prob of [ neutrois] 0.014885857701301575
loss 3.217 = 3.134 + 0.082 + 0.001 avg prob of [ neutrois] 0.045637670904397964
loss 1.356 = 1.146 + 0.208 + 0.001 avg prob of [ neutrois] 0.3263309597969055
loss 1.076 = 0.885 + 0.19 + 0.001 avg prob of [ neutrois] 0.425552636384964
loss 0.326 = 0.243 + 0.082 + 0.001 avg prob of [ neutrois] 0.7886868715286255
loss 0.148 = 0.079 + 0.068 + 0.001 avg prob of [ neutrois] 0.9250564575195312
loss 0.074 = 0.027 + 0.046 + 0.001 avg prob of [ neutrois] 0.9737415313720703
loss 0.05 = 0.01 + 0.039 + 0.001 avg prob of [ neutrois] 0.9904176592826843
Delta norm: 13.16093921661377
Change in target norm: 3.2902348041534424 to 13.463418960571289 => 10.173184394836426
Division Factor: 2.7634618282318115
Right vector norm: 4.762482643127441
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:37:46,380 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:37:46 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:13<00:13, 13.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 16.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 16.04s/it]
2024-10-31 02:38:18,867 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:38:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.70it/s]100%|██████████| 1/1 [00:00<00:00,  1.70it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.11s/it]100%|██████████| 1/1 [00:14<00:00, 14.11s/it]
2024-10-31 02:38:46,393 - easyeditor.editors.editor - INFO - 0 editing: The occupation of César A. Romero is -> military affairs  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of César A. Romero is', 'target_new': 'military affairs', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'César A. Romero'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:38:46 - INFO - easyeditor.editors.editor -   0 editing: The occupation of César A. Romero is -> military affairs  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of César A. Romero is', 'target_new': 'military affairs', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'César A. Romero'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of César A. Romero is] -> [ military affairs]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object César A. Romero
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of César A. Romero is military | Token: ero
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.83 = 7.83 + 0.0 + 0.0 avg prob of [ military affairs] 0.000508675875607878
loss 5.971 = 5.916 + 0.054 + 0.001 avg prob of [ military affairs] 0.002901386935263872
loss 4.052 = 3.906 + 0.145 + 0.001 avg prob of [ military affairs] 0.02136513590812683
loss 2.722 = 2.394 + 0.326 + 0.001 avg prob of [ military affairs] 0.09687267243862152
loss 1.955 = 1.728 + 0.226 + 0.001 avg prob of [ military affairs] 0.18647773563861847
loss 3.09 = 3.004 + 0.085 + 0.001 avg prob of [ military affairs] 0.051511067897081375
loss 1.278 = 0.951 + 0.326 + 0.001 avg prob of [ military affairs] 0.4035697281360626
loss 0.477 = 0.149 + 0.326 + 0.001 avg prob of [ military affairs] 0.8688651919364929
loss 0.351 = 0.028 + 0.322 + 0.001 avg prob of [ military affairs] 0.9725162386894226
loss 0.317 = 0.013 + 0.302 + 0.001 avg prob of [ military affairs] 0.9866136908531189
loss 0.219 = 0.011 + 0.207 + 0.001 avg prob of [ military affairs] 0.9890996217727661
loss 0.127 = 0.032 + 0.094 + 0.001 avg prob of [ military affairs] 0.9693339467048645
loss 0.04 = 0.004 + 0.035 + 0.001 avg prob of [ military affairs] 0.9955304861068726
Delta norm: 14.522216796875
Change in target norm: 3.63055419921875 to 14.921445846557617 => 11.290891647338867
Division Factor: 3.0150933265686035
Right vector norm: 4.816506862640381
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:39:19,652 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:39:19 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:29<00:29, 29.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:50<00:00, 24.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:50<00:00, 25.22s/it]
2024-10-31 02:40:12,624 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:40:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.37it/s]100%|██████████| 1/1 [00:00<00:00,  1.37it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.50s/it]100%|██████████| 1/1 [00:17<00:00, 17.50s/it]
2024-10-31 02:40:44,087 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Qiu Wenxue is -> Edward Conyngham Denison  

 {'pre': {'rewrite_acc': [0.14285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Qiu Wenxue is', 'target_new': 'Edward Conyngham Denison', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Qiu Wenxue'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:40:44 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Qiu Wenxue is -> Edward Conyngham Denison  

 {'pre': {'rewrite_acc': [0.14285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Qiu Wenxue is', 'target_new': 'Edward Conyngham Denison', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Qiu Wenxue'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Qiu Wenxue is] -> [ Edward Conyngham Denison]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Qiu Wenxue
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the father of Qiu Wenxue is Edward Conyngham Den | Token: ue
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.4 = 6.4 + 0.0 + 0.0 avg prob of [ Edward Conyngham Denison] 0.0016976918559521437
loss 4.662 = 4.612 + 0.049 + 0.001 avg prob of [ Edward Conyngham Denison] 0.01007192675024271
loss 2.988 = 2.658 + 0.329 + 0.001 avg prob of [ Edward Conyngham Denison] 0.07230579107999802
loss 3.158 = 2.986 + 0.17 + 0.001 avg prob of [ Edward Conyngham Denison] 0.0513826459646225
loss 2.23 = 2.074 + 0.154 + 0.001 avg prob of [ Edward Conyngham Denison] 0.1260734498500824
loss 0.997 = 0.929 + 0.067 + 0.001 avg prob of [ Edward Conyngham Denison] 0.3966754376888275
loss 0.307 = 0.235 + 0.072 + 0.001 avg prob of [ Edward Conyngham Denison] 0.7922080159187317
loss 0.181 = 0.112 + 0.067 + 0.001 avg prob of [ Edward Conyngham Denison] 0.894042432308197
loss 0.097 = 0.046 + 0.05 + 0.001 avg prob of [ Edward Conyngham Denison] 0.9553064703941345
loss 0.066 = 0.031 + 0.034 + 0.001 avg prob of [ Edward Conyngham Denison] 0.9692804217338562
loss 0.052 = 0.022 + 0.028 + 0.001 avg prob of [ Edward Conyngham Denison] 0.9779621362686157
loss 0.041 = 0.015 + 0.025 + 0.001 avg prob of [ Edward Conyngham Denison] 0.9849944710731506
Delta norm: 14.017342567443848
Change in target norm: 3.504335880279541 to 14.412332534790039 => 10.907997131347656
Division Factor: 2.9368345737457275
Right vector norm: 4.772943019866943
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.14285714285714285}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:41:32,878 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:41:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.94s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:40<00:00, 20.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:40<00:00, 20.34s/it]
2024-10-31 02:42:14,073 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:42:14 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.53it/s]100%|██████████| 1/1 [00:00<00:00,  1.53it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.96s/it]100%|██████████| 1/1 [00:14<00:00, 14.96s/it]
2024-10-31 02:42:43,868 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Thomas Soutter Lodge is -> Veselin Stoyanov  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Thomas Soutter Lodge is', 'target_new': 'Veselin Stoyanov', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Thomas Soutter Lodge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:42:43 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Thomas Soutter Lodge is -> Veselin Stoyanov  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Thomas Soutter Lodge is', 'target_new': 'Veselin Stoyanov', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Thomas Soutter Lodge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Thomas Soutter Lodge is] -> [ Veselin Stoyanov]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Thomas Soutter Lodge
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the child of Thomas Soutter Lodge is Veselin Stoyan | Token: odge
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.978 = 4.978 + 0.0 + 0.0 avg prob of [ Veselin Stoyanov] 0.006964856293052435
loss 3.929 = 3.872 + 0.057 + 0.001 avg prob of [ Veselin Stoyanov] 0.021037161350250244
loss 3.524 = 3.312 + 0.211 + 0.001 avg prob of [ Veselin Stoyanov] 0.03659489005804062
loss 2.687 = 2.56 + 0.126 + 0.001 avg prob of [ Veselin Stoyanov] 0.07799270749092102
loss 1.633 = 1.59 + 0.042 + 0.001 avg prob of [ Veselin Stoyanov] 0.20474150776863098
loss 1.565 = 1.374 + 0.189 + 0.001 avg prob of [ Veselin Stoyanov] 0.25797411799430847
loss 0.736 = 0.688 + 0.047 + 0.001 avg prob of [ Veselin Stoyanov] 0.5052198767662048
loss 0.364 = 0.327 + 0.036 + 0.001 avg prob of [ Veselin Stoyanov] 0.7224021553993225
loss 0.137 = 0.086 + 0.05 + 0.001 avg prob of [ Veselin Stoyanov] 0.9181097149848938
loss 0.062 = 0.026 + 0.035 + 0.001 avg prob of [ Veselin Stoyanov] 0.9747288227081299
loss 0.043 = 0.013 + 0.029 + 0.001 avg prob of [ Veselin Stoyanov] 0.9872746467590332
Delta norm: 16.604902267456055
Change in target norm: 4.1512250900268555 to 17.0889892578125 => 12.937764167785645
Division Factor: 3.6428914070129395
Right vector norm: 4.558165073394775
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:43:11,553 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:43:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:33<00:33, 33.92s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:58<00:00, 28.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:58<00:00, 29.16s/it]
2024-10-31 02:44:10,432 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:44:10 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.61s/it]100%|██████████| 1/1 [00:22<00:00, 22.61s/it]
2024-10-31 02:44:46,047 - easyeditor.editors.editor - INFO - 0 editing: The place of death of José Maria Ignacio Montes de Oca y Obregón is -> Saint-Jean-du-Désert  

 {'pre': {'rewrite_acc': [0.5555555555555556], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of José Maria Ignacio Montes de Oca y Obregón is', 'target_new': 'Saint-Jean-du-Désert', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'José Maria Ignacio Montes de Oca y Obregón'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:44:46 - INFO - easyeditor.editors.editor -   0 editing: The place of death of José Maria Ignacio Montes de Oca y Obregón is -> Saint-Jean-du-Désert  

 {'pre': {'rewrite_acc': [0.5555555555555556], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of José Maria Ignacio Montes de Oca y Obregón is', 'target_new': 'Saint-Jean-du-Désert', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'José Maria Ignacio Montes de Oca y Obregón'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of José Maria Ignacio Montes de Oca y Obregón is] -> [ Saint-Jean-du-Désert]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object José Maria Ignacio Montes de Oca y Obregón
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 20 | Sentence: The place of death of José Maria Ignacio Montes de Oca y Obregón is Saint-Jean-du-Dé | Token: ón
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.116 = 4.116 + 0.0 + 0.0 avg prob of [ Saint-Jean-du-Désert] 0.016508694738149643
loss 3.477 = 3.47 + 0.006 + 0.001 avg prob of [ Saint-Jean-du-Désert] 0.03135915473103523
loss 2.011 = 1.992 + 0.018 + 0.001 avg prob of [ Saint-Jean-du-Désert] 0.13812583684921265
loss 1.006 = 0.944 + 0.061 + 0.001 avg prob of [ Saint-Jean-du-Désert] 0.3926759660243988
loss 0.637 = 0.585 + 0.051 + 0.001 avg prob of [ Saint-Jean-du-Désert] 0.5587399005889893
loss 1.324 = 1.311 + 0.012 + 0.001 avg prob of [ Saint-Jean-du-Désert] 0.272112637758255
loss 1.407 = 1.179 + 0.227 + 0.001 avg prob of [ Saint-Jean-du-Désert] 0.3114439845085144
loss 0.595 = 0.59 + 0.003 + 0.001 avg prob of [ Saint-Jean-du-Désert] 0.561228334903717
loss 0.574 = 0.569 + 0.004 + 0.001 avg prob of [ Saint-Jean-du-Désert] 0.5788561701774597
loss 0.089 = 0.081 + 0.008 + 0.001 avg prob of [ Saint-Jean-du-Désert] 0.9227126240730286
loss 0.076 = 0.045 + 0.029 + 0.001 avg prob of [ Saint-Jean-du-Désert] 0.9557341933250427
loss 0.044 = 0.033 + 0.009 + 0.001 avg prob of [ Saint-Jean-du-Désert] 0.9675673842430115
Delta norm: 14.498141288757324
Change in target norm: 3.62453556060791 to 14.918196678161621 => 11.293661117553711
Division Factor: 3.0882983207702637
Right vector norm: 4.694540500640869
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5555555555555556}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:44:54,314 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:44:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:24<00:24, 24.12s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 17.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 18.54s/it]
2024-10-31 02:45:32,247 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:45:32 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.81s/it]100%|██████████| 1/1 [00:15<00:00, 15.81s/it]
2024-10-31 02:46:01,511 - easyeditor.editors.editor - INFO - 0 editing: The gender of Ruth Jones McClendon is -> agender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Ruth Jones McClendon is', 'target_new': 'agender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ruth Jones McClendon'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:46:01 - INFO - easyeditor.editors.editor -   0 editing: The gender of Ruth Jones McClendon is -> agender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Ruth Jones McClendon is', 'target_new': 'agender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ruth Jones McClendon'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Ruth Jones McClendon is] -> [ agender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ruth Jones McClendon
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Ruth Jones McClendon is ag | Token: on
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.741 = 6.741 + 0.0 + 0.0 avg prob of [ agender] 0.0012314168270677328
loss 5.626 = 5.607 + 0.018 + 0.001 avg prob of [ agender] 0.00381852057762444
loss 3.92 = 3.804 + 0.114 + 0.001 avg prob of [ agender] 0.023283857852220535
loss 2.611 = 2.291 + 0.319 + 0.001 avg prob of [ agender] 0.10278061777353287
loss 2.083 = 1.797 + 0.285 + 0.001 avg prob of [ agender] 0.1723271906375885
loss 0.944 = 0.763 + 0.18 + 0.001 avg prob of [ agender] 0.4759175479412079
loss 2.183 = 2.156 + 0.025 + 0.001 avg prob of [ agender] 0.12014877796173096
loss 0.735 = 0.703 + 0.03 + 0.001 avg prob of [ agender] 0.5012586116790771
loss 0.329 = 0.088 + 0.24 + 0.001 avg prob of [ agender] 0.9174746870994568
loss 0.117 = 0.039 + 0.077 + 0.001 avg prob of [ agender] 0.962120771408081
loss 0.085 = 0.037 + 0.047 + 0.001 avg prob of [ agender] 0.9657237529754639
loss 0.061 = 0.015 + 0.045 + 0.001 avg prob of [ agender] 0.9856604933738708
loss 0.05 = 0.005 + 0.044 + 0.001 avg prob of [ agender] 0.9946449398994446
loss 0.046 = 0.003 + 0.042 + 0.001 avg prob of [ agender] 0.9970165491104126
Delta norm: 12.461947441101074
Change in target norm: 3.1154868602752686 to 12.81292724609375 => 9.697440147399902
Division Factor: 2.5707712173461914
Right vector norm: 4.847552299499512
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:46:33,018 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:46:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 12.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.58s/it]
2024-10-31 02:47:00,824 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:47:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.76it/s]100%|██████████| 1/1 [00:00<00:00,  1.76it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.20s/it]100%|██████████| 1/1 [00:19<00:00, 19.20s/it]
2024-10-31 02:47:32,696 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Eriko Satō is -> adopted son  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Eriko Satō is', 'target_new': 'adopted son', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eriko Satō'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:47:32 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Eriko Satō is -> adopted son  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Eriko Satō is', 'target_new': 'adopted son', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eriko Satō'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Eriko Satō is] -> [ adopted son]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Eriko Satō
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Eriko Satō is adopted | Token: ō
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 10.081 = 10.081 + 0.0 + 0.0 avg prob of [ adopted son] 4.6325305447680876e-05
loss 6.781 = 6.741 + 0.039 + 0.001 avg prob of [ adopted son] 0.0013932400615885854
loss 3.531 = 3.308 + 0.222 + 0.001 avg prob of [ adopted son] 0.03792022168636322
loss 1.073 = 0.987 + 0.085 + 0.001 avg prob of [ adopted son] 0.38364896178245544
loss 0.419 = 0.099 + 0.319 + 0.001 avg prob of [ adopted son] 0.9093669652938843
loss 0.404 = 0.086 + 0.317 + 0.001 avg prob of [ adopted son] 0.9217943549156189
loss 0.324 = 0.004 + 0.319 + 0.001 avg prob of [ adopted son] 0.9964661598205566
loss 0.33 = 0.011 + 0.318 + 0.001 avg prob of [ adopted son] 0.9892123341560364
loss 0.326 = 0.008 + 0.317 + 0.001 avg prob of [ adopted son] 0.9922823309898376
loss 0.321 = 0.006 + 0.314 + 0.001 avg prob of [ adopted son] 0.9942619204521179
loss 0.303 = 0.009 + 0.293 + 0.001 avg prob of [ adopted son] 0.9910770654678345
loss 0.206 = 0.047 + 0.158 + 0.001 avg prob of [ adopted son] 0.9557796716690063
loss 0.363 = 0.064 + 0.297 + 0.001 avg prob of [ adopted son] 0.9386253356933594
loss 0.284 = 0.001 + 0.282 + 0.001 avg prob of [ adopted son] 0.9987722039222717
loss 0.127 = 0.001 + 0.125 + 0.001 avg prob of [ adopted son] 0.99863201379776
loss 0.06 = 0.011 + 0.047 + 0.001 avg prob of [ adopted son] 0.9888685345649719
loss 0.052 = 0.021 + 0.03 + 0.001 avg prob of [ adopted son] 0.9795564413070679
loss 0.021 = 0.002 + 0.018 + 0.001 avg prob of [ adopted son] 0.9983388185501099
Delta norm: 15.64968490600586
Change in target norm: 3.912421226501465 to 16.261232376098633 => 12.348811149597168
Division Factor: 3.2537522315979004
Right vector norm: 4.80973482131958
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:47:40,221 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:47:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.05s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.75s/it]
2024-10-31 02:48:08,276 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:48:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.72s/it]100%|██████████| 1/1 [00:13<00:00, 13.72s/it]
2024-10-31 02:48:36,294 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Ines Obradović is -> string arranger  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ines Obradović is', 'target_new': 'string arranger', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ines Obradović'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:48:36 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Ines Obradović is -> string arranger  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ines Obradović is', 'target_new': 'string arranger', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ines Obradović'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Ines Obradović is] -> [ string arranger]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ines Obradović
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Ines Obradović is string arr | Token: ović
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.437 = 6.437 + 0.0 + 0.0 avg prob of [ string arranger] 0.0016629000892862678
loss 4.727 = 4.701 + 0.025 + 0.001 avg prob of [ string arranger] 0.009402444586157799
loss 4.374 = 4.296 + 0.077 + 0.001 avg prob of [ string arranger] 0.01468203030526638
loss 2.1 = 1.953 + 0.146 + 0.001 avg prob of [ string arranger] 0.14391933381557465
loss 2.008 = 1.958 + 0.049 + 0.001 avg prob of [ string arranger] 0.14848832786083221
loss 0.398 = 0.269 + 0.127 + 0.001 avg prob of [ string arranger] 0.7791417837142944
loss 0.248 = 0.217 + 0.03 + 0.001 avg prob of [ string arranger] 0.8101968169212341
loss 0.192 = 0.005 + 0.186 + 0.001 avg prob of [ string arranger] 0.9951055645942688
loss 0.209 = 0.17 + 0.038 + 0.001 avg prob of [ string arranger] 0.8744216561317444
loss 0.086 = 0.058 + 0.026 + 0.001 avg prob of [ string arranger] 0.9443706274032593
loss 0.055 = 0.031 + 0.024 + 0.001 avg prob of [ string arranger] 0.9699841737747192
loss 0.035 = 0.012 + 0.022 + 0.001 avg prob of [ string arranger] 0.9876150488853455
Delta norm: 13.482808113098145
Change in target norm: 3.370701551437378 to 13.911778450012207 => 10.54107666015625
Division Factor: 2.9374377727508545
Right vector norm: 4.589989185333252
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:48:52,490 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:48:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:46<00:46, 46.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:09<00:00, 32.86s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:09<00:00, 34.91s/it]
2024-10-31 02:50:03,040 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:50:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.63s/it]100%|██████████| 1/1 [00:27<00:00, 27.63s/it]
2024-10-31 02:50:44,330 - easyeditor.editors.editor - INFO - 0 editing: The gender of Rocío Aliaga is -> māhū  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Rocío Aliaga is', 'target_new': 'māhū', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rocío Aliaga'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:50:44 - INFO - easyeditor.editors.editor -   0 editing: The gender of Rocío Aliaga is -> māhū  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Rocío Aliaga is', 'target_new': 'māhū', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rocío Aliaga'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Rocío Aliaga is] -> [ māhū]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Rocío Aliaga
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Rocío Aliaga is māh | Token: aga
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.32 = 7.32 + 0.0 + 0.0 avg prob of [ māhū] 0.0007061827927827835
loss 5.179 = 5.141 + 0.037 + 0.001 avg prob of [ māhū] 0.006220991723239422
loss 3.809 = 3.731 + 0.077 + 0.001 avg prob of [ māhū] 0.024277381598949432
loss 2.399 = 2.099 + 0.299 + 0.001 avg prob of [ māhū] 0.12438216060400009
loss 1.758 = 1.418 + 0.339 + 0.001 avg prob of [ māhū] 0.24287408590316772
loss 0.535 = 0.194 + 0.34 + 0.001 avg prob of [ māhū] 0.8245030641555786
loss 0.471 = 0.086 + 0.384 + 0.001 avg prob of [ māhū] 0.9183952808380127
loss 1.595 = 1.258 + 0.336 + 0.001 avg prob of [ māhū] 0.2887307405471802
loss 1.406 = 1.068 + 0.337 + 0.001 avg prob of [ māhū] 0.34896716475486755
loss 0.379 = 0.037 + 0.341 + 0.001 avg prob of [ māhū] 0.9640048742294312
loss 0.356 = 0.012 + 0.343 + 0.001 avg prob of [ māhū] 0.9878963232040405
loss 0.355 = 0.011 + 0.344 + 0.001 avg prob of [ māhū] 0.9893237948417664
loss 0.354 = 0.009 + 0.344 + 0.001 avg prob of [ māhū] 0.9911265969276428
loss 0.352 = 0.007 + 0.344 + 0.001 avg prob of [ māhū] 0.9929671883583069
loss 0.35 = 0.006 + 0.344 + 0.001 avg prob of [ māhū] 0.9944143295288086
loss 0.349 = 0.005 + 0.344 + 0.001 avg prob of [ māhū] 0.9954589605331421
loss 0.348 = 0.004 + 0.344 + 0.001 avg prob of [ māhū] 0.9962190985679626
loss 0.348 = 0.003 + 0.344 + 0.001 avg prob of [ māhū] 0.9967899322509766
loss 0.347 = 0.003 + 0.343 + 0.001 avg prob of [ māhū] 0.9972314834594727
loss 0.347 = 0.002 + 0.343 + 0.001 avg prob of [ māhū] 0.9975788593292236
loss 0.346 = 0.002 + 0.343 + 0.001 avg prob of [ māhū] 0.9978532791137695
loss 0.345 = 0.002 + 0.342 + 0.001 avg prob of [ māhū] 0.9980623126029968
loss 0.343 = 0.002 + 0.34 + 0.001 avg prob of [ māhū] 0.9981881380081177
loss 0.317 = 0.002 + 0.314 + 0.001 avg prob of [ māhū] 0.9980145692825317
loss 2.172 = 1.993 + 0.178 + 0.001 avg prob of [ māhū] 0.13996568322181702
Delta norm: 14.789026260375977
Change in target norm: 3.6972568035125732 to 15.260904312133789 => 11.563647270202637
Division Factor: 3.1008191108703613
Right vector norm: 4.769393444061279
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:50:55,065 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:50:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:19<00:19, 19.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 14.11s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 14.94s/it]
2024-10-31 02:51:25,443 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:51:25 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.03s/it]100%|██████████| 1/1 [00:25<00:00, 25.04s/it]
2024-10-31 02:52:04,099 - easyeditor.editors.editor - INFO - 0 editing: The name of the award Aage Bojsen Møller won is -> Le Fèvre Medal  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Aage Bojsen Møller won is', 'target_new': 'Le Fèvre Medal', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Aage Bojsen Møller'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:52:04 - INFO - easyeditor.editors.editor -   0 editing: The name of the award Aage Bojsen Møller won is -> Le Fèvre Medal  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Aage Bojsen Møller won is', 'target_new': 'Le Fèvre Medal', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Aage Bojsen Møller'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the award Aage Bojsen Møller won is] -> [ Le Fèvre Medal]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Aage Bojsen Møller
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the award Aage Bojsen Møller won is Le Fèvre | Token: er
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.685 = 5.685 + 0.0 + 0.0 avg prob of [ Le Fèvre Medal] 0.0034915755968540907
loss 4.884 = 4.678 + 0.205 + 0.001 avg prob of [ Le Fèvre Medal] 0.009454077109694481
loss 4.157 = 4.112 + 0.044 + 0.001 avg prob of [ Le Fèvre Medal] 0.01655673421919346
loss 3.543 = 3.48 + 0.062 + 0.001 avg prob of [ Le Fèvre Medal] 0.03131487965583801
loss 2.804 = 2.773 + 0.03 + 0.001 avg prob of [ Le Fèvre Medal] 0.06292223930358887
loss 1.597 = 1.556 + 0.041 + 0.001 avg prob of [ Le Fèvre Medal] 0.21898454427719116
loss 1.555 = 1.537 + 0.017 + 0.001 avg prob of [ Le Fèvre Medal] 0.22062399983406067
loss 0.689 = 0.526 + 0.162 + 0.001 avg prob of [ Le Fèvre Medal] 0.592525064945221
loss 0.345 = 0.299 + 0.044 + 0.001 avg prob of [ Le Fèvre Medal] 0.7447158694267273
loss 0.123 = 0.078 + 0.044 + 0.001 avg prob of [ Le Fèvre Medal] 0.9253822565078735
loss 0.075 = 0.031 + 0.043 + 0.001 avg prob of [ Le Fèvre Medal] 0.9694015383720398
loss 0.05 = 0.021 + 0.028 + 0.001 avg prob of [ Le Fèvre Medal] 0.9791528582572937
loss 0.067 = 0.015 + 0.052 + 0.001 avg prob of [ Le Fèvre Medal] 0.9854614734649658
loss 0.059 = 0.014 + 0.044 + 0.001 avg prob of [ Le Fèvre Medal] 0.9861229658126831
loss 0.055 = 0.012 + 0.042 + 0.001 avg prob of [ Le Fèvre Medal] 0.9877187013626099
loss 0.053 = 0.01 + 0.042 + 0.001 avg prob of [ Le Fèvre Medal] 0.9904435873031616
loss 0.049 = 0.007 + 0.041 + 0.001 avg prob of [ Le Fèvre Medal] 0.992741584777832
Delta norm: 15.97733211517334
Change in target norm: 3.994332790374756 to 16.543624877929688 => 12.549291610717773
Division Factor: 3.3946571350097656
Right vector norm: 4.706611633300781
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:52:12,567 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:52:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:13<00:13, 13.08s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.86s/it]
2024-10-31 02:52:32,701 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:52:32 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.52s/it]100%|██████████| 1/1 [00:27<00:00, 27.52s/it]
2024-10-31 02:53:11,534 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Helmut J Böhm is -> HVAC  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Helmut J Böhm is', 'target_new': 'HVAC', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Helmut J Böhm'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:53:11 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Helmut J Böhm is -> HVAC  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Helmut J Böhm is', 'target_new': 'HVAC', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Helmut J Böhm'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Helmut J Böhm is] -> [ HVAC]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Helmut J Böhm
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Helmut J Böhm is HV | Token: hm
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.325 = 4.325 + 0.0 + 0.0 avg prob of [ HVAC] 0.013603633269667625
loss 3.893 = 3.475 + 0.416 + 0.001 avg prob of [ HVAC] 0.03152807429432869
loss 3.511 = 3.143 + 0.366 + 0.001 avg prob of [ HVAC] 0.04425821080803871
loss 1.424 = 1.225 + 0.198 + 0.001 avg prob of [ HVAC] 0.3041963279247284
loss 0.87 = 0.59 + 0.278 + 0.001 avg prob of [ HVAC] 0.5825721025466919
loss 0.444 = 0.163 + 0.279 + 0.001 avg prob of [ HVAC] 0.8499464392662048
loss 0.364 = 0.086 + 0.278 + 0.001 avg prob of [ HVAC] 0.9182274341583252
loss 0.31 = 0.069 + 0.239 + 0.001 avg prob of [ HVAC] 0.9332801699638367
loss 0.318 = 0.254 + 0.063 + 0.001 avg prob of [ HVAC] 0.7799777388572693
loss 0.335 = 0.032 + 0.302 + 0.001 avg prob of [ HVAC] 0.9689868688583374
loss 0.339 = 0.036 + 0.303 + 0.001 avg prob of [ HVAC] 0.9650348424911499
loss 0.332 = 0.029 + 0.302 + 0.001 avg prob of [ HVAC] 0.9711015224456787
loss 0.322 = 0.02 + 0.301 + 0.001 avg prob of [ HVAC] 0.9805219173431396
loss 0.314 = 0.014 + 0.3 + 0.001 avg prob of [ HVAC] 0.9863214492797852
loss 0.309 = 0.011 + 0.296 + 0.001 avg prob of [ HVAC] 0.9889814257621765
loss 0.302 = 0.011 + 0.29 + 0.001 avg prob of [ HVAC] 0.9886384606361389
loss 0.295 = 0.015 + 0.279 + 0.001 avg prob of [ HVAC] 0.9850626587867737
loss 0.281 = 0.013 + 0.266 + 0.001 avg prob of [ HVAC] 0.9866973757743835
loss 0.256 = 0.016 + 0.239 + 0.001 avg prob of [ HVAC] 0.9838884472846985
loss 0.221 = 0.011 + 0.21 + 0.001 avg prob of [ HVAC] 0.9895567297935486
loss 0.332 = 0.159 + 0.172 + 0.001 avg prob of [ HVAC] 0.8560508489608765
loss 0.318 = 0.009 + 0.308 + 0.001 avg prob of [ HVAC] 0.9914886951446533
loss 0.367 = 0.058 + 0.307 + 0.001 avg prob of [ HVAC] 0.9468511343002319
loss 0.335 = 0.027 + 0.306 + 0.001 avg prob of [ HVAC] 0.9731730818748474
loss 0.318 = 0.013 + 0.304 + 0.001 avg prob of [ HVAC] 0.987341046333313
Delta norm: 13.649964332580566
Change in target norm: 3.4124908447265625 to 14.050576210021973 => 10.63808536529541
Division Factor: 2.860328435897827
Right vector norm: 4.772166728973389
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:53:20,483 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:53:20 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.30s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:38<00:00, 19.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:38<00:00, 19.25s/it]
2024-10-31 02:53:59,516 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:53:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.62s/it]100%|██████████| 1/1 [00:12<00:00, 12.62s/it]
2024-10-31 02:54:26,036 - easyeditor.editors.editor - INFO - 0 editing: The gender of Fernando Vilardo is -> intersex person  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Fernando Vilardo is', 'target_new': 'intersex person', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Fernando Vilardo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:54:26 - INFO - easyeditor.editors.editor -   0 editing: The gender of Fernando Vilardo is -> intersex person  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Fernando Vilardo is', 'target_new': 'intersex person', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Fernando Vilardo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Fernando Vilardo is] -> [ intersex person]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Fernando Vilardo
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Fernando Vilardo is intersex | Token: ardo
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.804 = 6.804 + 0.0 + 0.0 avg prob of [ intersex person] 0.0011873312760144472
loss 5.634 = 5.577 + 0.055 + 0.001 avg prob of [ intersex person] 0.004029528237879276
loss 4.564 = 4.327 + 0.236 + 0.001 avg prob of [ intersex person] 0.01413043774664402
loss 2.489 = 2.35 + 0.138 + 0.001 avg prob of [ intersex person] 0.09605255722999573
loss 1.806 = 1.514 + 0.291 + 0.001 avg prob of [ intersex person] 0.2238253653049469
loss 0.79 = 0.623 + 0.166 + 0.001 avg prob of [ intersex person] 0.5392372608184814
loss 1.073 = 1.0 + 0.071 + 0.001 avg prob of [ intersex person] 0.3746347427368164
loss 0.679 = 0.511 + 0.166 + 0.001 avg prob of [ intersex person] 0.6065146923065186
loss 0.168 = 0.063 + 0.103 + 0.001 avg prob of [ intersex person] 0.9388999342918396
loss 0.102 = 0.061 + 0.04 + 0.001 avg prob of [ intersex person] 0.94134920835495
loss 0.055 = 0.013 + 0.04 + 0.001 avg prob of [ intersex person] 0.9867163300514221
loss 0.033 = 0.005 + 0.027 + 0.001 avg prob of [ intersex person] 0.9949628114700317
Delta norm: 12.316539764404297
Change in target norm: 3.079134941101074 to 12.669635772705078 => 9.590500831604004
Division Factor: 2.6609151363372803
Right vector norm: 4.62868595123291
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:54:55,404 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:54:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:35<00:35, 35.76s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:47<00:00, 21.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:47<00:00, 23.55s/it]
2024-10-31 02:55:43,653 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:55:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.44s/it]100%|██████████| 1/1 [00:30<00:00, 30.44s/it]
2024-10-31 02:56:27,477 - easyeditor.editors.editor - INFO - 0 editing: tetracation is followed by -> Fossils and Lithography Museum  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'tetracation is followed by', 'target_new': 'Fossils and Lithography Museum', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'tetracation'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:56:27 - INFO - easyeditor.editors.editor -   0 editing: tetracation is followed by -> Fossils and Lithography Museum  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'tetracation is followed by', 'target_new': 'Fossils and Lithography Museum', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'tetracation'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [tetracation is followed by] -> [ Fossils and Lithography Museum]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object tetracation
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 4 | Sentence: tetracation is followed by Fossils and Lithography | Token: ation
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.463 = 6.463 + 0.0 + 0.0 avg prob of [ Fossils and Lithography Museum] 0.001634086947888136
loss 5.726 = 5.636 + 0.089 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.003690766403451562
loss 4.717 = 4.62 + 0.096 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.010353516787290573
loss 3.6 = 3.507 + 0.092 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.03076348826289177
loss 3.441 = 3.31 + 0.13 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.03923659399151802
loss 2.626 = 2.527 + 0.098 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.08238479495048523
loss 1.694 = 1.593 + 0.101 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.2122311145067215
loss 0.79 = 0.68 + 0.109 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.520524263381958
loss 1.756 = 1.637 + 0.117 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.2037227302789688
loss 0.816 = 0.672 + 0.143 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.5240942239761353
loss 0.503 = 0.407 + 0.095 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.6808823943138123
loss 0.181 = 0.093 + 0.087 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.9144614338874817
loss 0.372 = 0.239 + 0.132 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.7928535342216492
loss 0.133 = 0.022 + 0.11 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.978365957736969
loss 0.116 = 0.012 + 0.103 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.9880840182304382
loss 0.114 = 0.008 + 0.105 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.9919120669364929
loss 0.104 = 0.007 + 0.096 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.9926181435585022
loss 0.093 = 0.007 + 0.085 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.9932030439376831
loss 0.093 = 0.006 + 0.086 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.9940258264541626
loss 0.086 = 0.005 + 0.08 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.9949690699577332
loss 0.082 = 0.004 + 0.077 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.9958820343017578
loss 0.075 = 0.003 + 0.071 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.9966438412666321
loss 0.07 = 0.003 + 0.066 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.9971897602081299
loss 0.064 = 0.002 + 0.061 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.9975200295448303
loss 0.059 = 0.002 + 0.055 + 0.001 avg prob of [ Fossils and Lithography Museum] 0.9977738857269287
Delta norm: 17.282320022583008
Change in target norm: 4.32058048248291 to 17.7293643951416 => 13.408783912658691
Division Factor: 3.2906365394592285
Right vector norm: 5.251968860626221
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:56:35,020 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:56:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.86s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.75s/it]
2024-10-31 02:56:55,405 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:56:55 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.40it/s]100%|██████████| 1/1 [00:00<00:00,  1.40it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.44s/it]100%|██████████| 1/1 [00:20<00:00, 20.44s/it]
2024-10-31 02:57:29,238 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Louis Guérin is -> Wattasid dynasty  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Louis Guérin is', 'target_new': 'Wattasid dynasty', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Louis Guérin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:57:29 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Louis Guérin is -> Wattasid dynasty  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Louis Guérin is', 'target_new': 'Wattasid dynasty', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Louis Guérin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Louis Guérin is] -> [ Wattasid dynasty]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Louis Guérin
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the country of citizenship of Louis Guérin is Wattasid dynast | Token: in
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.707 = 6.707 + 0.0 + 0.0 avg prob of [ Wattasid dynasty] 0.0012980102328583598
loss 4.927 = 4.874 + 0.052 + 0.001 avg prob of [ Wattasid dynasty] 0.007995450869202614
loss 2.56 = 2.52 + 0.038 + 0.001 avg prob of [ Wattasid dynasty] 0.0808652862906456
loss 1.648 = 1.576 + 0.071 + 0.001 avg prob of [ Wattasid dynasty] 0.20716127753257751
loss 1.295 = 1.219 + 0.075 + 0.001 avg prob of [ Wattasid dynasty] 0.29597681760787964
loss 0.785 = 0.742 + 0.042 + 0.001 avg prob of [ Wattasid dynasty] 0.4770253598690033
loss 0.307 = 0.248 + 0.058 + 0.001 avg prob of [ Wattasid dynasty] 0.7816238403320312
loss 0.247 = 0.204 + 0.042 + 0.001 avg prob of [ Wattasid dynasty] 0.821474552154541
loss 0.473 = 0.19 + 0.282 + 0.001 avg prob of [ Wattasid dynasty] 0.832062304019928
loss 0.184 = 0.109 + 0.075 + 0.001 avg prob of [ Wattasid dynasty] 0.8979547023773193
loss 0.143 = 0.107 + 0.036 + 0.001 avg prob of [ Wattasid dynasty] 0.8996654748916626
loss 0.073 = 0.042 + 0.03 + 0.001 avg prob of [ Wattasid dynasty] 0.9591712951660156
loss 0.053 = 0.018 + 0.034 + 0.001 avg prob of [ Wattasid dynasty] 0.9819101691246033
loss 0.044 = 0.013 + 0.03 + 0.001 avg prob of [ Wattasid dynasty] 0.9875194430351257
Delta norm: 14.092933654785156
Change in target norm: 3.523233652114868 to 14.48067855834961 => 10.95744514465332
Division Factor: 3.012190341949463
Right vector norm: 4.678632736206055
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.16666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:57:53,704 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:57:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:26<00:26, 26.81s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 17.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 18.87s/it]
2024-10-31 02:58:34,038 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 02:58:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.62it/s]100%|██████████| 1/1 [00:00<00:00,  1.62it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.61s/it]100%|██████████| 1/1 [00:23<00:00, 23.61s/it]
2024-10-31 02:59:10,544 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Abdulaziz Abo Shaqraa is -> Pirkkala  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Abdulaziz Abo Shaqraa is', 'target_new': 'Pirkkala', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Abdulaziz Abo Shaqraa'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 02:59:10 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Abdulaziz Abo Shaqraa is -> Pirkkala  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Abdulaziz Abo Shaqraa is', 'target_new': 'Pirkkala', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Abdulaziz Abo Shaqraa'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Abdulaziz Abo Shaqraa is] -> [ Pirkkala]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Abdulaziz Abo Shaqraa
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The place of birth of Abdulaziz Abo Shaqraa is Pirkk | Token: a
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.358 = 6.358 + 0.0 + 0.0 avg prob of [ Pirkkala] 0.001829046057537198
loss 6.856 = 6.521 + 0.334 + 0.001 avg prob of [ Pirkkala] 0.001488687819801271
loss 5.349 = 5.269 + 0.079 + 0.001 avg prob of [ Pirkkala] 0.005226310808211565
loss 4.636 = 4.513 + 0.122 + 0.001 avg prob of [ Pirkkala] 0.011076539754867554
loss 3.603 = 3.418 + 0.184 + 0.001 avg prob of [ Pirkkala] 0.032913029193878174
loss 2.442 = 2.313 + 0.128 + 0.001 avg prob of [ Pirkkala] 0.10023137927055359
loss 1.173 = 0.945 + 0.227 + 0.001 avg prob of [ Pirkkala] 0.3909924030303955
loss 2.135 = 2.083 + 0.051 + 0.001 avg prob of [ Pirkkala] 0.13402391970157623
loss 1.211 = 1.12 + 0.09 + 0.001 avg prob of [ Pirkkala] 0.3296951949596405
loss 0.883 = 0.707 + 0.175 + 0.001 avg prob of [ Pirkkala] 0.49606311321258545
loss 0.673 = 0.56 + 0.112 + 0.001 avg prob of [ Pirkkala] 0.5736631751060486
loss 0.415 = 0.356 + 0.058 + 0.001 avg prob of [ Pirkkala] 0.7033182978630066
loss 0.158 = 0.106 + 0.051 + 0.001 avg prob of [ Pirkkala] 0.9006839394569397
loss 0.089 = 0.049 + 0.038 + 0.001 avg prob of [ Pirkkala] 0.9519928693771362
loss 0.054 = 0.026 + 0.027 + 0.001 avg prob of [ Pirkkala] 0.9741866588592529
loss 0.036 = 0.015 + 0.02 + 0.001 avg prob of [ Pirkkala] 0.9853709936141968
Delta norm: 15.431392669677734
Change in target norm: 3.8578479290008545 to 15.973060607910156 => 12.115212440490723
Division Factor: 3.189626932144165
Right vector norm: 4.837993144989014
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 02:59:39,037 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 02:59:39 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.92s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 14.14s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 14.86s/it]
2024-10-31 03:00:10,477 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:00:10 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.58s/it]100%|██████████| 1/1 [00:23<00:00, 23.58s/it]
2024-10-31 03:00:47,618 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Kewal K Mahapatra is -> Institute of Applied Astronomy  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Kewal K Mahapatra is', 'target_new': 'Institute of Applied Astronomy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kewal K Mahapatra'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:00:47 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Kewal K Mahapatra is -> Institute of Applied Astronomy  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Kewal K Mahapatra is', 'target_new': 'Institute of Applied Astronomy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kewal K Mahapatra'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Kewal K Mahapatra is] -> [ Institute of Applied Astronomy]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kewal K Mahapatra
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the employer of Kewal K Mahapatra is Institute of Applied Astronom | Token: atra
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.514 = 5.514 + 0.0 + 0.0 avg prob of [ Institute of Applied Astronomy] 0.004099850542843342
loss 4.198 = 4.122 + 0.075 + 0.001 avg prob of [ Institute of Applied Astronomy] 0.016407392919063568
loss 2.702 = 2.652 + 0.049 + 0.001 avg prob of [ Institute of Applied Astronomy] 0.07123775780200958
loss 1.916 = 1.654 + 0.26 + 0.001 avg prob of [ Institute of Applied Astronomy] 0.19284170866012573
loss 1.225 = 1.025 + 0.198 + 0.001 avg prob of [ Institute of Applied Astronomy] 0.3599002957344055
loss 0.438 = 0.343 + 0.093 + 0.001 avg prob of [ Institute of Applied Astronomy] 0.7127537131309509
loss 0.322 = 0.257 + 0.063 + 0.001 avg prob of [ Institute of Applied Astronomy] 0.7759802937507629
loss 0.311 = 0.011 + 0.299 + 0.001 avg prob of [ Institute of Applied Astronomy] 0.9891303181648254
loss 0.315 = 0.017 + 0.297 + 0.001 avg prob of [ Institute of Applied Astronomy] 0.9831156134605408
loss 0.29 = 0.018 + 0.271 + 0.001 avg prob of [ Institute of Applied Astronomy] 0.9823339581489563
loss 0.188 = 0.027 + 0.16 + 0.001 avg prob of [ Institute of Applied Astronomy] 0.9735314846038818
loss 0.167 = 0.091 + 0.076 + 0.001 avg prob of [ Institute of Applied Astronomy] 0.9137860536575317
loss 0.085 = 0.035 + 0.049 + 0.001 avg prob of [ Institute of Applied Astronomy] 0.9658064246177673
loss 0.059 = 0.009 + 0.049 + 0.001 avg prob of [ Institute of Applied Astronomy] 0.9908016920089722
loss 0.052 = 0.005 + 0.046 + 0.001 avg prob of [ Institute of Applied Astronomy] 0.9952945113182068
loss 0.044 = 0.004 + 0.04 + 0.001 avg prob of [ Institute of Applied Astronomy] 0.9963605403900146
Delta norm: 14.578338623046875
Change in target norm: 3.6445844173431396 to 14.997183799743652 => 11.352599143981934
Division Factor: 3.1184873580932617
Right vector norm: 4.674810886383057
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:00:55,722 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:00:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.34s/it]
2024-10-31 03:01:20,910 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:01:20 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.44s/it]100%|██████████| 1/1 [00:27<00:00, 27.44s/it]
2024-10-31 03:02:01,431 - easyeditor.editors.editor - INFO - 0 editing: 2nd Georgia General Assembly follows -> 1980 Scottish Open Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.4375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '2nd Georgia General Assembly follows', 'target_new': "1980 Scottish Open Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2nd Georgia General Assembly'}, 'post': {'rewrite_acc': [0.9375], 'locality': {}, 'portability': {}}}
10/31/2024 03:02:01 - INFO - easyeditor.editors.editor -   0 editing: 2nd Georgia General Assembly follows -> 1980 Scottish Open Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.4375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '2nd Georgia General Assembly follows', 'target_new': "1980 Scottish Open Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2nd Georgia General Assembly'}, 'post': {'rewrite_acc': [0.9375], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2nd Georgia General Assembly follows] -> [ 1980 Scottish Open Badminton Championships – men's doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2nd Georgia General Assembly
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: 2nd Georgia General Assembly follows 1980 Scottish Open Badminton Championships – men's | Token: Assembly
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.952 = 3.952 + 0.0 + 0.0 avg prob of [ 1980 Scottish Open Badminton Championships – men's doubles] 0.01958012580871582
loss 3.361 = 3.313 + 0.047 + 0.001 avg prob of [ 1980 Scottish Open Badminton Championships – men's doubles] 0.036655448377132416
loss 2.865 = 2.84 + 0.025 + 0.001 avg prob of [ 1980 Scottish Open Badminton Championships – men's doubles] 0.05958065018057823
loss 2.652 = 2.532 + 0.119 + 0.001 avg prob of [ 1980 Scottish Open Badminton Championships – men's doubles] 0.08025605231523514
loss 1.55 = 1.517 + 0.032 + 0.001 avg prob of [ 1980 Scottish Open Badminton Championships – men's doubles] 0.22346989810466766
loss 0.882 = 0.859 + 0.023 + 0.001 avg prob of [ 1980 Scottish Open Badminton Championships – men's doubles] 0.4265344440937042
loss 0.47 = 0.448 + 0.021 + 0.001 avg prob of [ 1980 Scottish Open Badminton Championships – men's doubles] 0.6436723470687866
loss 0.173 = 0.124 + 0.048 + 0.001 avg prob of [ 1980 Scottish Open Badminton Championships – men's doubles] 0.8843169808387756
loss 0.237 = 0.207 + 0.03 + 0.001 avg prob of [ 1980 Scottish Open Badminton Championships – men's doubles] 0.8177162408828735
loss 0.074 = 0.042 + 0.031 + 0.001 avg prob of [ 1980 Scottish Open Badminton Championships – men's doubles] 0.9593902826309204
loss 0.149 = 0.023 + 0.126 + 0.001 avg prob of [ 1980 Scottish Open Badminton Championships – men's doubles] 0.977791965007782
loss 0.157 = 0.038 + 0.119 + 0.001 avg prob of [ 1980 Scottish Open Badminton Championships – men's doubles] 0.9635673761367798
loss 0.148 = 0.029 + 0.118 + 0.001 avg prob of [ 1980 Scottish Open Badminton Championships – men's doubles] 0.9718339443206787
loss 0.13 = 0.011 + 0.118 + 0.001 avg prob of [ 1980 Scottish Open Badminton Championships – men's doubles] 0.9886388778686523
loss 0.127 = 0.011 + 0.115 + 0.001 avg prob of [ 1980 Scottish Open Badminton Championships – men's doubles] 0.9891277551651001
loss 0.098 = 0.009 + 0.089 + 0.001 avg prob of [ 1980 Scottish Open Badminton Championships – men's doubles] 0.9914425611495972
loss 0.057 = 0.024 + 0.032 + 0.001 avg prob of [ 1980 Scottish Open Badminton Championships – men's doubles] 0.9767839312553406
loss 0.049 = 0.018 + 0.03 + 0.001 avg prob of [ 1980 Scottish Open Badminton Championships – men's doubles] 0.9825917482376099
Delta norm: 18.989826202392578
Change in target norm: 4.7474565505981445 to 19.510177612304688 => 14.762721061706543
Division Factor: 3.931063652038574
Right vector norm: 4.830709934234619
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4375}, 'post': {'rewrite_acc': 0.9375}}
2024-10-31 03:02:11,902 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:02:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.03s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 11.98s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.74s/it]
2024-10-31 03:02:37,997 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:02:37 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.12s/it]100%|██████████| 1/1 [00:26<00:00, 26.12s/it]
2024-10-31 03:03:16,633 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Devin J Jones is -> bargirl  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Devin J Jones is', 'target_new': 'bargirl', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Devin J Jones'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:03:16 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Devin J Jones is -> bargirl  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Devin J Jones is', 'target_new': 'bargirl', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Devin J Jones'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Devin J Jones is] -> [ bargirl]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Devin J Jones
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Devin J Jones is barg | Token: Jones
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.488 = 7.488 + 0.0 + 0.0 avg prob of [ bargirl] 0.0006070645176805556
loss 6.643 = 6.597 + 0.044 + 0.001 avg prob of [ bargirl] 0.0014842826640233397
loss 5.078 = 4.88 + 0.197 + 0.001 avg prob of [ bargirl] 0.007919097319245338
loss 3.723 = 3.488 + 0.233 + 0.001 avg prob of [ bargirl] 0.030847785994410515
loss 2.438 = 2.207 + 0.23 + 0.001 avg prob of [ bargirl] 0.11160878092050552
loss 0.764 = 0.553 + 0.21 + 0.001 avg prob of [ bargirl] 0.5792219638824463
loss 0.32 = 0.104 + 0.215 + 0.001 avg prob of [ bargirl] 0.9019947052001953
loss 0.268 = 0.051 + 0.216 + 0.001 avg prob of [ bargirl] 0.9510265588760376
loss 0.157 = 0.068 + 0.088 + 0.001 avg prob of [ bargirl] 0.9350119233131409
loss 0.102 = 0.005 + 0.096 + 0.001 avg prob of [ bargirl] 0.9946708679199219
loss 0.312 = 0.298 + 0.013 + 0.001 avg prob of [ bargirl] 0.7544364929199219
loss 0.257 = 0.006 + 0.25 + 0.001 avg prob of [ bargirl] 0.9940781593322754
loss 0.326 = 0.07 + 0.255 + 0.001 avg prob of [ bargirl] 0.9357936382293701
loss 0.264 = 0.007 + 0.256 + 0.001 avg prob of [ bargirl] 0.9933302998542786
loss 0.262 = 0.005 + 0.256 + 0.001 avg prob of [ bargirl] 0.9948887825012207
loss 0.259 = 0.002 + 0.256 + 0.001 avg prob of [ bargirl] 0.9977125525474548
loss 0.259 = 0.001 + 0.256 + 0.001 avg prob of [ bargirl] 0.9985391497612
loss 0.258 = 0.001 + 0.256 + 0.001 avg prob of [ bargirl] 0.9989328980445862
loss 0.258 = 0.001 + 0.256 + 0.001 avg prob of [ bargirl] 0.9992082715034485
loss 0.258 = 0.001 + 0.256 + 0.001 avg prob of [ bargirl] 0.9993757605552673
loss 0.258 = 0.001 + 0.256 + 0.001 avg prob of [ bargirl] 0.9994756579399109
loss 0.257 = 0.0 + 0.256 + 0.001 avg prob of [ bargirl] 0.9995395541191101
loss 0.257 = 0.0 + 0.256 + 0.001 avg prob of [ bargirl] 0.9995824098587036
loss 0.257 = 0.0 + 0.255 + 0.001 avg prob of [ bargirl] 0.9996101260185242
loss 0.257 = 0.0 + 0.255 + 0.001 avg prob of [ bargirl] 0.9996230006217957
Delta norm: 12.832258224487305
Change in target norm: 3.208064556121826 to 13.138850212097168 => 9.9307861328125
Division Factor: 2.7238271236419678
Right vector norm: 4.711112976074219
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:03:37,240 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:03:37 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:31<00:31, 31.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:48<00:00, 23.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:48<00:00, 24.43s/it]
2024-10-31 03:04:26,732 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:04:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.21it/s]100%|██████████| 1/1 [00:00<00:00,  1.21it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:09<00:00,  9.90s/it]100%|██████████| 1/1 [00:09<00:00,  9.90s/it]
2024-10-31 03:04:51,538 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Vladimir Titenko is -> chief engineer  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Vladimir Titenko is', 'target_new': 'chief engineer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vladimir Titenko'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:04:51 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Vladimir Titenko is -> chief engineer  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Vladimir Titenko is', 'target_new': 'chief engineer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vladimir Titenko'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Vladimir Titenko is] -> [ chief engineer]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Vladimir Titenko
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Vladimir Titenko is chief | Token: ko
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.317 = 5.317 + 0.0 + 0.0 avg prob of [ chief engineer] 0.005458828527480364
loss 4.033 = 4.013 + 0.019 + 0.001 avg prob of [ chief engineer] 0.019106857478618622
loss 2.551 = 2.455 + 0.096 + 0.001 avg prob of [ chief engineer] 0.08942479640245438
loss 0.707 = 0.637 + 0.069 + 0.001 avg prob of [ chief engineer] 0.542490541934967
loss 1.265 = 0.931 + 0.333 + 0.001 avg prob of [ chief engineer] 0.4163780212402344
loss 0.319 = 0.201 + 0.117 + 0.001 avg prob of [ chief engineer] 0.8313161730766296
loss 0.317 = 0.043 + 0.273 + 0.001 avg prob of [ chief engineer] 0.9621774554252625
loss 0.119 = 0.08 + 0.038 + 0.001 avg prob of [ chief engineer] 0.9266451001167297
loss 0.05 = 0.024 + 0.025 + 0.001 avg prob of [ chief engineer] 0.9768739342689514
Delta norm: 13.006575584411621
Change in target norm: 3.2516438961029053 to 13.364252090454102 => 10.112607955932617
Division Factor: 2.6638805866241455
Right vector norm: 4.882566928863525
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:04:59,322 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:04:59 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:14<00:14, 15.00s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:21<00:00, 10.26s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:21<00:00, 10.97s/it]
2024-10-31 03:05:21,653 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:05:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.04s/it]100%|██████████| 1/1 [00:14<00:00, 14.04s/it]
2024-10-31 03:05:49,487 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Frédéric de Courcy is -> Dunwoody  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Frédéric de Courcy is', 'target_new': 'Dunwoody', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Frédéric de Courcy'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:05:49 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Frédéric de Courcy is -> Dunwoody  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Frédéric de Courcy is', 'target_new': 'Dunwoody', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Frédéric de Courcy'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Frédéric de Courcy is] -> [ Dunwoody]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Frédéric de Courcy
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The place of birth of Frédéric de Courcy is Dunwo | Token: cy
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.55 = 6.55 + 0.0 + 0.0 avg prob of [ Dunwoody] 0.0014984487788751721
loss 5.949 = 5.918 + 0.03 + 0.001 avg prob of [ Dunwoody] 0.002723800018429756
loss 5.342 = 5.303 + 0.037 + 0.001 avg prob of [ Dunwoody] 0.0050476486794650555
loss 3.581 = 3.525 + 0.055 + 0.001 avg prob of [ Dunwoody] 0.03008715994656086
loss 1.352 = 1.294 + 0.057 + 0.001 avg prob of [ Dunwoody] 0.2863280177116394
loss 0.359 = 0.083 + 0.274 + 0.001 avg prob of [ Dunwoody] 0.9209821820259094
loss 0.168 = 0.076 + 0.091 + 0.001 avg prob of [ Dunwoody] 0.9267767071723938
loss 0.106 = 0.016 + 0.089 + 0.001 avg prob of [ Dunwoody] 0.9839130640029907
loss 0.086 = 0.02 + 0.065 + 0.001 avg prob of [ Dunwoody] 0.9799480438232422
loss 0.059 = 0.01 + 0.048 + 0.001 avg prob of [ Dunwoody] 0.9902663826942444
loss 0.049 = 0.006 + 0.042 + 0.001 avg prob of [ Dunwoody] 0.9940434694290161
Delta norm: 13.662808418273926
Change in target norm: 3.4157021045684814 to 14.04323959350586 => 10.627537727355957
Division Factor: 2.8113045692443848
Right vector norm: 4.8599534034729
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:06:05,476 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:06:05 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:33<00:33, 33.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:46<00:00, 21.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:46<00:00, 23.17s/it]
2024-10-31 03:06:52,445 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:06:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.17s/it]100%|██████████| 1/1 [00:24<00:00, 24.17s/it]
2024-10-31 03:07:30,565 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Josefin Lassinantti is -> Captaincy General of Cuba  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Josefin Lassinantti is', 'target_new': 'Captaincy General of Cuba', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Josefin Lassinantti'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:07:30 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Josefin Lassinantti is -> Captaincy General of Cuba  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Josefin Lassinantti is', 'target_new': 'Captaincy General of Cuba', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Josefin Lassinantti'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Josefin Lassinantti is] -> [ Captaincy General of Cuba]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Josefin Lassinantti
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The name of the country of citizenship of Josefin Lassinantti is Captaincy General of | Token: ti
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.806 = 5.806 + 0.0 + 0.0 avg prob of [ Captaincy General of Cuba] 0.0031466165091842413
loss 5.948 = 5.563 + 0.383 + 0.001 avg prob of [ Captaincy General of Cuba] 0.003961616195738316
loss 4.702 = 4.479 + 0.222 + 0.001 avg prob of [ Captaincy General of Cuba] 0.011557669378817081
loss 3.357 = 3.305 + 0.051 + 0.001 avg prob of [ Captaincy General of Cuba] 0.037989355623722076
loss 1.904 = 1.805 + 0.098 + 0.001 avg prob of [ Captaincy General of Cuba] 0.1664157211780548
loss 1.541 = 1.325 + 0.214 + 0.001 avg prob of [ Captaincy General of Cuba] 0.2705971300601959
loss 0.689 = 0.499 + 0.189 + 0.001 avg prob of [ Captaincy General of Cuba] 0.6169458031654358
loss 0.583 = 0.488 + 0.094 + 0.001 avg prob of [ Captaincy General of Cuba] 0.6186686158180237
loss 0.97 = 0.854 + 0.115 + 0.001 avg prob of [ Captaincy General of Cuba] 0.43622472882270813
loss 0.417 = 0.199 + 0.216 + 0.001 avg prob of [ Captaincy General of Cuba] 0.8216739892959595
loss 0.187 = 0.091 + 0.094 + 0.001 avg prob of [ Captaincy General of Cuba] 0.9128551483154297
loss 0.143 = 0.044 + 0.098 + 0.001 avg prob of [ Captaincy General of Cuba] 0.9569861888885498
loss 0.1 = 0.028 + 0.07 + 0.001 avg prob of [ Captaincy General of Cuba] 0.971960723400116
loss 0.076 = 0.013 + 0.063 + 0.001 avg prob of [ Captaincy General of Cuba] 0.9875690937042236
loss 0.063 = 0.008 + 0.054 + 0.001 avg prob of [ Captaincy General of Cuba] 0.9922431111335754
loss 0.044 = 0.006 + 0.037 + 0.001 avg prob of [ Captaincy General of Cuba] 0.9940325617790222
Delta norm: 14.387953758239746
Change in target norm: 3.5969884395599365 to 14.817663192749023 => 11.220674514770508
Division Factor: 3.144470691680908
Right vector norm: 4.575636386871338
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:07:43,942 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:07:43 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 13.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 14.26s/it]
2024-10-31 03:08:13,014 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:08:13 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.62it/s]100%|██████████| 1/1 [00:00<00:00,  1.62it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:35<00:00, 35.61s/it]100%|██████████| 1/1 [00:35<00:00, 35.61s/it]
2024-10-31 03:09:02,601 - easyeditor.editors.editor - INFO - 0 editing: 1960/1961 GDR Junior Badminton Championships – men's singles follows -> 9212 Kanamaru  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1960/1961 GDR Junior Badminton Championships – men's singles follows", 'target_new': '9212 Kanamaru', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1960/1961 GDR Junior Badminton Championships – men's singles"}, 'post': {'rewrite_acc': [0.875], 'locality': {}, 'portability': {}}}
10/31/2024 03:09:02 - INFO - easyeditor.editors.editor -   0 editing: 1960/1961 GDR Junior Badminton Championships – men's singles follows -> 9212 Kanamaru  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1960/1961 GDR Junior Badminton Championships – men's singles follows", 'target_new': '9212 Kanamaru', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1960/1961 GDR Junior Badminton Championships – men's singles"}, 'post': {'rewrite_acc': [0.875], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1960/1961 GDR Junior Badminton Championships – men's singles follows] -> [ 9212 Kanamaru]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1960/1961 GDR Junior Badminton Championships – men's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 22 | Sentence: 1960/1961 GDR Junior Badminton Championships – men's singles follows 9212 Kanamar | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.34 = 6.34 + 0.0 + 0.0 avg prob of [ 9212 Kanamaru] 0.0017990253400057554
loss 5.894 = 5.891 + 0.001 + 0.001 avg prob of [ 9212 Kanamaru] 0.0027954913675785065
loss 5.614 = 5.396 + 0.217 + 0.001 avg prob of [ 9212 Kanamaru] 0.004585792776197195
loss 5.017 = 5.015 + 0.001 + 0.001 avg prob of [ 9212 Kanamaru] 0.006730407010763884
loss 4.796 = 4.794 + 0.001 + 0.001 avg prob of [ 9212 Kanamaru] 0.00836505088955164
loss 4.319 = 4.317 + 0.002 + 0.001 avg prob of [ 9212 Kanamaru] 0.013412084430456161
loss 4.014 = 4.012 + 0.001 + 0.001 avg prob of [ 9212 Kanamaru] 0.01820201240479946
loss 3.027 = 3.025 + 0.001 + 0.001 avg prob of [ 9212 Kanamaru] 0.04910740628838539
loss 4.281 = 3.89 + 0.39 + 0.001 avg prob of [ 9212 Kanamaru] 0.020785372704267502
loss 3.518 = 2.927 + 0.59 + 0.001 avg prob of [ 9212 Kanamaru] 0.05405090004205704
loss 3.872 = 3.836 + 0.035 + 0.001 avg prob of [ 9212 Kanamaru] 0.02179197035729885
loss 2.27 = 2.267 + 0.001 + 0.001 avg prob of [ 9212 Kanamaru] 0.10636574029922485
loss 2.416 = 1.886 + 0.529 + 0.001 avg prob of [ 9212 Kanamaru] 0.15387707948684692
loss 1.756 = 1.753 + 0.002 + 0.001 avg prob of [ 9212 Kanamaru] 0.17689479887485504
loss 1.164 = 1.161 + 0.002 + 0.001 avg prob of [ 9212 Kanamaru] 0.3225884735584259
loss 1.099 = 1.085 + 0.013 + 0.001 avg prob of [ 9212 Kanamaru] 0.34511837363243103
loss 0.67 = 0.668 + 0.002 + 0.001 avg prob of [ 9212 Kanamaru] 0.5218381285667419
loss 0.37 = 0.367 + 0.001 + 0.001 avg prob of [ 9212 Kanamaru] 0.6948119401931763
loss 0.038 = 0.035 + 0.003 + 0.001 avg prob of [ 9212 Kanamaru] 0.9657745361328125
Delta norm: 17.710540771484375
Change in target norm: 4.4276347160339355 to 18.27362060546875 => 13.845985412597656
Division Factor: 3.644695281982422
Right vector norm: 4.859265327453613
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.875}}
2024-10-31 03:09:40,378 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:09:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:04<01:04, 64.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:32<00:00, 43.26s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:32<00:00, 46.48s/it]
2024-10-31 03:11:13,901 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:11:13 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.62it/s]100%|██████████| 1/1 [00:00<00:00,  1.62it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.88s/it]100%|██████████| 1/1 [00:17<00:00, 17.88s/it]
2024-10-31 03:11:45,577 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Adel R Abd-Allah is -> Kinsey Institute for Research in Sex, Gender, and Reproduction  

 {'pre': {'rewrite_acc': [0.7142857142857143], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Adel R Abd-Allah is', 'target_new': 'Kinsey Institute for Research in Sex, Gender, and Reproduction', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Adel R Abd-Allah'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:11:45 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Adel R Abd-Allah is -> Kinsey Institute for Research in Sex, Gender, and Reproduction  

 {'pre': {'rewrite_acc': [0.7142857142857143], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Adel R Abd-Allah is', 'target_new': 'Kinsey Institute for Research in Sex, Gender, and Reproduction', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Adel R Abd-Allah'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Adel R Abd-Allah is] -> [ Kinsey Institute for Research in Sex, Gender, and Reproduction]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Adel R Abd-Allah
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the employer of Adel R Abd-Allah is Kinsey Institute for Research in Sex, Gender, and Re | Token: lah
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.281 = 2.281 + 0.0 + 0.0 avg prob of [ Kinsey Institute for Research in Sex, Gender, and Reproduction] 0.10266978293657303
loss 1.32 = 1.305 + 0.014 + 0.001 avg prob of [ Kinsey Institute for Research in Sex, Gender, and Reproduction] 0.2718612849712372
loss 1.28 = 1.213 + 0.067 + 0.001 avg prob of [ Kinsey Institute for Research in Sex, Gender, and Reproduction] 0.29792967438697815
loss 0.896 = 0.879 + 0.016 + 0.001 avg prob of [ Kinsey Institute for Research in Sex, Gender, and Reproduction] 0.4162651300430298
loss 0.44 = 0.428 + 0.01 + 0.001 avg prob of [ Kinsey Institute for Research in Sex, Gender, and Reproduction] 0.6524882912635803
loss 0.245 = 0.221 + 0.023 + 0.001 avg prob of [ Kinsey Institute for Research in Sex, Gender, and Reproduction] 0.8020638823509216
loss 0.113 = 0.092 + 0.021 + 0.001 avg prob of [ Kinsey Institute for Research in Sex, Gender, and Reproduction] 0.9126307368278503
loss 0.074 = 0.033 + 0.04 + 0.001 avg prob of [ Kinsey Institute for Research in Sex, Gender, and Reproduction] 0.9673044085502625
loss 0.065 = 0.04 + 0.024 + 0.001 avg prob of [ Kinsey Institute for Research in Sex, Gender, and Reproduction] 0.9612588882446289
loss 0.027 = 0.019 + 0.007 + 0.001 avg prob of [ Kinsey Institute for Research in Sex, Gender, and Reproduction] 0.9807680249214172
Delta norm: 14.25809097290039
Change in target norm: 3.5645227432250977 to 14.774883270263672 => 11.210360527038574
Division Factor: 3.078524112701416
Right vector norm: 4.6314697265625
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.7142857142857143}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:12:32,652 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:12:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:23<01:23, 83.82s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:43<00:00, 46.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:43<00:00, 51.95s/it]
2024-10-31 03:14:17,450 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:14:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.04s/it]100%|██████████| 1/1 [00:22<00:00, 22.04s/it]
2024-10-31 03:14:53,299 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Inga Ålenius is -> Allawah  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Inga Ålenius is', 'target_new': 'Allawah', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Inga Ålenius'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:14:53 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Inga Ålenius is -> Allawah  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Inga Ålenius is', 'target_new': 'Allawah', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Inga Ålenius'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Inga Ålenius is] -> [ Allawah]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Inga Ålenius
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the country of citizenship of Inga Ålenius is Allaw | Token: ius
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.47 = 9.47 + 0.0 + 0.0 avg prob of [ Allawah] 8.779141353443265e-05
loss 7.041 = 7.026 + 0.013 + 0.001 avg prob of [ Allawah] 0.0009944303892552853
loss 4.464 = 4.313 + 0.15 + 0.001 avg prob of [ Allawah] 0.014305946417152882
loss 3.859 = 3.612 + 0.245 + 0.001 avg prob of [ Allawah] 0.028759950771927834
loss 1.816 = 1.701 + 0.113 + 0.001 avg prob of [ Allawah] 0.19962933659553528
loss 0.291 = 0.251 + 0.038 + 0.001 avg prob of [ Allawah] 0.7829626202583313
loss 0.359 = 0.042 + 0.315 + 0.001 avg prob of [ Allawah] 0.959051787853241
loss 0.333 = 0.012 + 0.32 + 0.001 avg prob of [ Allawah] 0.9878036379814148
loss 0.326 = 0.005 + 0.32 + 0.001 avg prob of [ Allawah] 0.9953226447105408
loss 0.323 = 0.003 + 0.319 + 0.001 avg prob of [ Allawah] 0.9971747994422913
loss 0.321 = 0.002 + 0.318 + 0.001 avg prob of [ Allawah] 0.9977974891662598
loss 0.318 = 0.002 + 0.315 + 0.001 avg prob of [ Allawah] 0.9980100393295288
loss 0.309 = 0.002 + 0.306 + 0.001 avg prob of [ Allawah] 0.9979243874549866
loss 0.277 = 0.003 + 0.273 + 0.001 avg prob of [ Allawah] 0.9971812963485718
loss 0.123 = 0.008 + 0.114 + 0.001 avg prob of [ Allawah] 0.9919790625572205
loss 0.154 = 0.113 + 0.04 + 0.001 avg prob of [ Allawah] 0.8947790265083313
loss 0.039 = 0.007 + 0.03 + 0.001 avg prob of [ Allawah] 0.9928460717201233
Delta norm: 13.693967819213867
Change in target norm: 3.423491954803467 to 14.184014320373535 => 10.760522842407227
Division Factor: 2.8852779865264893
Right vector norm: 4.746151924133301
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:15:34,793 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:15:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:28<00:28, 28.30s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 17.07s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 18.75s/it]
2024-10-31 03:16:12,820 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:16:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.63s/it]100%|██████████| 1/1 [00:10<00:00, 10.63s/it]
2024-10-31 03:16:36,501 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Michael K Bogdos is -> gastroenterologist  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Michael K Bogdos is', 'target_new': 'gastroenterologist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Michael K Bogdos'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:16:36 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Michael K Bogdos is -> gastroenterologist  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Michael K Bogdos is', 'target_new': 'gastroenterologist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Michael K Bogdos'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Michael K Bogdos is] -> [ gastroenterologist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Michael K Bogdos
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Michael K Bogdos is gastroenter | Token: os
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.082 = 4.082 + 0.0 + 0.0 avg prob of [ gastroenterologist] 0.01742127351462841
loss 3.416 = 3.401 + 0.014 + 0.001 avg prob of [ gastroenterologist] 0.03427428379654884
loss 2.179 = 2.155 + 0.022 + 0.001 avg prob of [ gastroenterologist] 0.11812976747751236
loss 1.164 = 0.859 + 0.304 + 0.001 avg prob of [ gastroenterologist] 0.4309667944908142
loss 0.466 = 0.327 + 0.138 + 0.001 avg prob of [ gastroenterologist] 0.72420334815979
loss 0.531 = 0.511 + 0.018 + 0.001 avg prob of [ gastroenterologist] 0.6054651141166687
loss 0.318 = 0.074 + 0.243 + 0.001 avg prob of [ gastroenterologist] 0.9314819574356079
loss 0.161 = 0.024 + 0.136 + 0.001 avg prob of [ gastroenterologist] 0.9764021039009094
loss 0.049 = 0.028 + 0.019 + 0.001 avg prob of [ gastroenterologist] 0.9722409248352051
Delta norm: 13.171795845031738
Change in target norm: 3.2929489612579346 to 13.600860595703125 => 10.30791187286377
Division Factor: 2.7627596855163574
Right vector norm: 4.767622947692871
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.75}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:16:43,248 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:16:43 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.25s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 12.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 13.09s/it]
2024-10-31 03:17:09,766 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:17:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.66it/s]100%|██████████| 1/1 [00:00<00:00,  1.66it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.66s/it]100%|██████████| 1/1 [00:14<00:00, 14.66s/it]
2024-10-31 03:17:37,845 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Darrell Opfer is -> East Africa Protectorate  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Darrell Opfer is', 'target_new': 'East Africa Protectorate', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Darrell Opfer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:17:37 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Darrell Opfer is -> East Africa Protectorate  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Darrell Opfer is', 'target_new': 'East Africa Protectorate', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Darrell Opfer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Darrell Opfer is] -> [ East Africa Protectorate]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Darrell Opfer
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the country of citizenship of Darrell Opfer is East Africa Protector | Token: fer
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.523 = 5.523 + 0.0 + 0.0 avg prob of [ East Africa Protectorate] 0.004079640842974186
loss 4.37 = 4.295 + 0.074 + 0.001 avg prob of [ East Africa Protectorate] 0.013782487250864506
loss 3.105 = 2.906 + 0.198 + 0.001 avg prob of [ East Africa Protectorate] 0.05545089393854141
loss 1.696 = 1.614 + 0.081 + 0.001 avg prob of [ East Africa Protectorate] 0.20207078754901886
loss 0.755 = 0.467 + 0.287 + 0.001 avg prob of [ East Africa Protectorate] 0.6296869516372681
loss 0.714 = 0.628 + 0.085 + 0.001 avg prob of [ East Africa Protectorate] 0.5494647026062012
loss 0.264 = 0.193 + 0.07 + 0.001 avg prob of [ East Africa Protectorate] 0.8259806036949158
loss 0.35 = 0.042 + 0.307 + 0.001 avg prob of [ East Africa Protectorate] 0.9595645666122437
loss 0.081 = 0.028 + 0.052 + 0.001 avg prob of [ East Africa Protectorate] 0.9725545644760132
loss 0.062 = 0.024 + 0.037 + 0.001 avg prob of [ East Africa Protectorate] 0.9761906862258911
loss 0.045 = 0.014 + 0.029 + 0.001 avg prob of [ East Africa Protectorate] 0.9856851100921631
Delta norm: 13.765280723571777
Change in target norm: 3.4413201808929443 to 14.244691848754883 => 10.80337142944336
Division Factor: 2.9137866497039795
Right vector norm: 4.724189281463623
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:17:45,478 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:17:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.90s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 12.34s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 13.18s/it]
2024-10-31 03:18:12,365 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:18:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.56s/it]100%|██████████| 1/1 [00:26<00:00, 26.56s/it]
2024-10-31 03:18:51,615 - easyeditor.editors.editor - INFO - 0 editing: The names of the cast members of Requiem for a Handsome Bastard are -> Mohsun Sanani  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The names of the cast members of Requiem for a Handsome Bastard are', 'target_new': 'Mohsun Sanani', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Requiem for a Handsome Bastard'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:18:51 - INFO - easyeditor.editors.editor -   0 editing: The names of the cast members of Requiem for a Handsome Bastard are -> Mohsun Sanani  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The names of the cast members of Requiem for a Handsome Bastard are', 'target_new': 'Mohsun Sanani', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Requiem for a Handsome Bastard'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The names of the cast members of Requiem for a Handsome Bastard are] -> [ Mohsun Sanani]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Requiem for a Handsome Bastard
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: The names of the cast members of Requiem for a Handsome Bastard are Mohsun San | Token: ard
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.648 = 8.648 + 0.0 + 0.0 avg prob of [ Mohsun Sanani] 0.00018278365314472467
loss 7.439 = 7.412 + 0.026 + 0.001 avg prob of [ Mohsun Sanani] 0.0006184204830788076
loss 6.405 = 6.118 + 0.285 + 0.001 avg prob of [ Mohsun Sanani] 0.0022754757665097713
loss 5.662 = 5.355 + 0.306 + 0.001 avg prob of [ Mohsun Sanani] 0.004872367717325687
loss 4.138 = 4.034 + 0.102 + 0.001 avg prob of [ Mohsun Sanani] 0.0180230550467968
loss 2.354 = 2.288 + 0.065 + 0.001 avg prob of [ Mohsun Sanani] 0.10223174095153809
loss 2.605 = 2.458 + 0.146 + 0.001 avg prob of [ Mohsun Sanani] 0.08684728294610977
loss 2.116 = 2.068 + 0.047 + 0.001 avg prob of [ Mohsun Sanani] 0.1275586038827896
loss 1.267 = 1.229 + 0.037 + 0.001 avg prob of [ Mohsun Sanani] 0.2947842478752136
loss 0.984 = 0.969 + 0.014 + 0.001 avg prob of [ Mohsun Sanani] 0.3833857476711273
loss 0.397 = 0.314 + 0.083 + 0.001 avg prob of [ Mohsun Sanani] 0.7344076633453369
loss 0.304 = 0.104 + 0.199 + 0.001 avg prob of [ Mohsun Sanani] 0.9017909169197083
loss 0.459 = 0.428 + 0.03 + 0.001 avg prob of [ Mohsun Sanani] 0.6529561281204224
loss 0.261 = 0.236 + 0.025 + 0.001 avg prob of [ Mohsun Sanani] 0.7939743995666504
loss 0.084 = 0.053 + 0.029 + 0.001 avg prob of [ Mohsun Sanani] 0.9485077857971191
loss 0.073 = 0.042 + 0.03 + 0.001 avg prob of [ Mohsun Sanani] 0.9591248035430908
loss 0.055 = 0.032 + 0.022 + 0.001 avg prob of [ Mohsun Sanani] 0.968951404094696
loss 0.036 = 0.019 + 0.017 + 0.001 avg prob of [ Mohsun Sanani] 0.9813750386238098
Delta norm: 16.268558502197266
Change in target norm: 4.067139625549316 to 16.713274002075195 => 12.646134376525879
Division Factor: 3.4429843425750732
Right vector norm: 4.725132942199707
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:18:57,939 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:18:57 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:12<00:12, 12.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  8.79s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  9.32s/it]
2024-10-31 03:19:16,884 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:19:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.76it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.83s/it]100%|██████████| 1/1 [00:18<00:00, 18.83s/it]
2024-10-31 03:19:47,051 - easyeditor.editors.editor - INFO - 0 editing: The name of the field of work of Wang Qingying is -> Jainism  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the field of work of Wang Qingying is', 'target_new': 'Jainism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Wang Qingying'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:19:47 - INFO - easyeditor.editors.editor -   0 editing: The name of the field of work of Wang Qingying is -> Jainism  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the field of work of Wang Qingying is', 'target_new': 'Jainism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Wang Qingying'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the field of work of Wang Qingying is] -> [ Jainism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Wang Qingying
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the field of work of Wang Qingying is Jain | Token: ying
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.754 = 5.754 + 0.0 + 0.0 avg prob of [ Jainism] 0.003204144537448883
loss 4.585 = 4.518 + 0.066 + 0.001 avg prob of [ Jainism] 0.011205853894352913
loss 3.966 = 3.662 + 0.303 + 0.001 avg prob of [ Jainism] 0.02591640129685402
loss 2.146 = 1.843 + 0.302 + 0.001 avg prob of [ Jainism] 0.15902651846408844
loss 0.989 = 0.693 + 0.295 + 0.001 avg prob of [ Jainism] 0.5055624842643738
loss 0.413 = 0.081 + 0.331 + 0.001 avg prob of [ Jainism] 0.922702431678772
loss 0.326 = 0.029 + 0.295 + 0.001 avg prob of [ Jainism] 0.9712896347045898
loss 0.315 = 0.021 + 0.293 + 0.001 avg prob of [ Jainism] 0.9797217845916748
loss 0.3 = 0.016 + 0.284 + 0.001 avg prob of [ Jainism] 0.9846738576889038
loss 0.267 = 0.014 + 0.252 + 0.001 avg prob of [ Jainism] 0.9861657619476318
loss 0.195 = 0.022 + 0.171 + 0.001 avg prob of [ Jainism] 0.9779523611068726
loss 0.15 = 0.057 + 0.092 + 0.001 avg prob of [ Jainism] 0.9449063539505005
loss 0.093 = 0.022 + 0.07 + 0.001 avg prob of [ Jainism] 0.9786841869354248
loss 0.06 = 0.006 + 0.053 + 0.001 avg prob of [ Jainism] 0.9942986965179443
loss 0.035 = 0.003 + 0.031 + 0.001 avg prob of [ Jainism] 0.996799647808075
Delta norm: 15.540654182434082
Change in target norm: 3.8851635456085205 to 16.043825149536133 => 12.158661842346191
Division Factor: 3.2354822158813477
Right vector norm: 4.803195953369141
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:19:52,889 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:19:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.87s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:35<00:00, 17.93s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:35<00:00, 17.92s/it]
2024-10-31 03:20:29,090 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:20:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.34it/s]100%|██████████| 1/1 [00:00<00:00,  1.34it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.19s/it]100%|██████████| 1/1 [00:26<00:00, 26.19s/it]
2024-10-31 03:21:08,437 - easyeditor.editors.editor - INFO - 0 editing: 1977 in Irish television is followed by -> 3719 Karamzin  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1977 in Irish television is followed by', 'target_new': '3719 Karamzin', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1977 in Irish television'}, 'post': {'rewrite_acc': [0.875], 'locality': {}, 'portability': {}}}
10/31/2024 03:21:08 - INFO - easyeditor.editors.editor -   0 editing: 1977 in Irish television is followed by -> 3719 Karamzin  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1977 in Irish television is followed by', 'target_new': '3719 Karamzin', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1977 in Irish television'}, 'post': {'rewrite_acc': [0.875], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1977 in Irish television is followed by] -> [ 3719 Karamzin]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1977 in Irish television
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: 1977 in Irish television is followed by 3719 Karam | Token: television
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.138 = 6.138 + 0.0 + 0.0 avg prob of [ 3719 Karamzin] 0.0022228152956813574
loss 5.74 = 5.293 + 0.446 + 0.001 avg prob of [ 3719 Karamzin] 0.005141163244843483
loss 5.223 = 5.202 + 0.02 + 0.001 avg prob of [ 3719 Karamzin] 0.005604395177215338
loss 4.856 = 4.842 + 0.013 + 0.001 avg prob of [ 3719 Karamzin] 0.008017019368708134
loss 4.361 = 4.348 + 0.012 + 0.001 avg prob of [ 3719 Karamzin] 0.013115102425217628
loss 4.399 = 4.377 + 0.021 + 0.001 avg prob of [ 3719 Karamzin] 0.01265167910605669
loss 4.081 = 4.067 + 0.013 + 0.001 avg prob of [ 3719 Karamzin] 0.017547139897942543
loss 4.57 = 4.556 + 0.013 + 0.001 avg prob of [ 3719 Karamzin] 0.010636172257363796
loss 4.635 = 4.525 + 0.109 + 0.001 avg prob of [ 3719 Karamzin] 0.01123407669365406
loss 4.328 = 4.316 + 0.011 + 0.001 avg prob of [ 3719 Karamzin] 0.013656090945005417
loss 3.851 = 3.836 + 0.014 + 0.001 avg prob of [ 3719 Karamzin] 0.02201978676021099
loss 3.316 = 3.296 + 0.019 + 0.001 avg prob of [ 3719 Karamzin] 0.03746308013796806
loss 2.737 = 2.695 + 0.041 + 0.001 avg prob of [ 3719 Karamzin] 0.06881032884120941
loss 1.831 = 1.816 + 0.014 + 0.001 avg prob of [ 3719 Karamzin] 0.16404680907726288
loss 1.716 = 1.696 + 0.02 + 0.001 avg prob of [ 3719 Karamzin] 0.18529056012630463
loss 1.82 = 1.785 + 0.034 + 0.001 avg prob of [ 3719 Karamzin] 0.16956108808517456
loss 1.281 = 1.267 + 0.013 + 0.001 avg prob of [ 3719 Karamzin] 0.2855354845523834
loss 0.556 = 0.533 + 0.022 + 0.001 avg prob of [ 3719 Karamzin] 0.5920172929763794
loss 0.151 = 0.133 + 0.017 + 0.001 avg prob of [ 3719 Karamzin] 0.8776114583015442
loss 0.04 = 0.026 + 0.014 + 0.001 avg prob of [ 3719 Karamzin] 0.9747476577758789
Delta norm: 15.96996784210205
Change in target norm: 3.992492198944092 to 16.489065170288086 => 12.496572494506836
Division Factor: 3.2786717414855957
Right vector norm: 4.8708648681640625
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.875}}
2024-10-31 03:21:17,498 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:21:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:23<00:23, 23.90s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:36<00:00, 17.43s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:36<00:00, 18.40s/it]
2024-10-31 03:21:55,383 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:21:55 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.35it/s]100%|██████████| 1/1 [00:00<00:00,  1.35it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:08<00:00,  8.04s/it]100%|██████████| 1/1 [00:08<00:00,  8.04s/it]
2024-10-31 03:22:17,030 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Edward C Mader is -> architectural historian  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Edward C Mader is', 'target_new': 'architectural historian', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edward C Mader'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:22:17 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Edward C Mader is -> architectural historian  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Edward C Mader is', 'target_new': 'architectural historian', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edward C Mader'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Edward C Mader is] -> [ architectural historian]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Edward C Mader
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Edward C Mader is architectural | Token: ader
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.766 = 5.766 + 0.0 + 0.0 avg prob of [ architectural historian] 0.0038602452259510756
loss 4.323 = 4.219 + 0.102 + 0.001 avg prob of [ architectural historian] 0.016974741593003273
loss 2.222 = 2.046 + 0.175 + 0.001 avg prob of [ architectural historian] 0.1395479440689087
loss 0.764 = 0.606 + 0.156 + 0.001 avg prob of [ architectural historian] 0.5651454329490662
loss 0.223 = 0.137 + 0.085 + 0.001 avg prob of [ architectural historian] 0.8733827471733093
loss 0.078 = 0.051 + 0.026 + 0.001 avg prob of [ architectural historian] 0.9506877660751343
loss 0.037 = 0.017 + 0.018 + 0.001 avg prob of [ architectural historian] 0.9828093647956848
Delta norm: 11.971477508544922
Change in target norm: 2.9928693771362305 to 12.273757934570312 => 9.280888557434082
Division Factor: 2.5523386001586914
Right vector norm: 4.690395355224609
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:22:28,313 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:22:28 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.35s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.21s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.83s/it]
2024-10-31 03:22:56,590 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:22:56 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.41it/s]100%|██████████| 1/1 [00:00<00:00,  1.41it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.52s/it]100%|██████████| 1/1 [00:21<00:00, 21.52s/it]
2024-10-31 03:23:31,824 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of John Roches is -> Sic  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of John Roches is', 'target_new': 'Sic', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'John Roches'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:23:31 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of John Roches is -> Sic  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of John Roches is', 'target_new': 'Sic', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'John Roches'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of John Roches is] -> [ Sic]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object John Roches
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The place of birth of John Roches is | Token: ches
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.726 = 7.726 + 0.0 + 0.0 avg prob of [ Sic] 0.00046895002014935017
loss 5.828 = 5.606 + 0.221 + 0.001 avg prob of [ Sic] 0.004160992801189423
loss 2.284 = 2.188 + 0.095 + 0.001 avg prob of [ Sic] 0.11884680390357971
loss 0.876 = 0.612 + 0.262 + 0.001 avg prob of [ Sic] 0.5504162311553955
loss 0.332 = 0.058 + 0.272 + 0.001 avg prob of [ Sic] 0.943483293056488
loss 0.305 = 0.026 + 0.278 + 0.001 avg prob of [ Sic] 0.9741916656494141
loss 0.297 = 0.015 + 0.28 + 0.001 avg prob of [ Sic] 0.9847250580787659
loss 0.293 = 0.011 + 0.281 + 0.001 avg prob of [ Sic] 0.9891913533210754
loss 0.291 = 0.009 + 0.281 + 0.001 avg prob of [ Sic] 0.9914606213569641
loss 0.289 = 0.007 + 0.281 + 0.001 avg prob of [ Sic] 0.992779552936554
loss 0.288 = 0.006 + 0.28 + 0.001 avg prob of [ Sic] 0.9935891628265381
loss 0.286 = 0.006 + 0.279 + 0.001 avg prob of [ Sic] 0.9940445423126221
loss 0.283 = 0.006 + 0.276 + 0.001 avg prob of [ Sic] 0.9941560626029968
loss 0.278 = 0.006 + 0.271 + 0.001 avg prob of [ Sic] 0.9937599897384644
loss 0.265 = 0.008 + 0.256 + 0.001 avg prob of [ Sic] 0.9921623468399048
loss 0.228 = 0.015 + 0.212 + 0.001 avg prob of [ Sic] 0.9854021072387695
loss 0.22 = 0.046 + 0.173 + 0.001 avg prob of [ Sic] 0.955376148223877
loss 0.161 = 0.026 + 0.134 + 0.001 avg prob of [ Sic] 0.9745592474937439
loss 0.102 = 0.051 + 0.05 + 0.001 avg prob of [ Sic] 0.9511212110519409
loss 0.064 = 0.016 + 0.047 + 0.001 avg prob of [ Sic] 0.9846248626708984
loss 0.044 = 0.007 + 0.035 + 0.001 avg prob of [ Sic] 0.9926040768623352
Delta norm: 12.579898834228516
Change in target norm: 3.14497447013855 to 12.960503578186035 => 9.815528869628906
Division Factor: 2.659440279006958
Right vector norm: 4.73028039932251
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:23:51,697 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:23:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.04s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.43s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.27s/it]
2024-10-31 03:24:17,130 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:24:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.08s/it]100%|██████████| 1/1 [00:19<00:00, 19.08s/it]
2024-10-31 03:24:47,422 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Eddie Dove is -> Hufner  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Eddie Dove is', 'target_new': 'Hufner', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eddie Dove'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:24:47 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Eddie Dove is -> Hufner  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Eddie Dove is', 'target_new': 'Hufner', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eddie Dove'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Eddie Dove is] -> [ Hufner]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Eddie Dove
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Eddie Dove is Huf | Token: ove
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.897 = 7.897 + 0.0 + 0.0 avg prob of [ Hufner] 0.0004006200178992003
loss 7.609 = 7.333 + 0.275 + 0.001 avg prob of [ Hufner] 0.0006851474172435701
loss 6.713 = 6.594 + 0.118 + 0.001 avg prob of [ Hufner] 0.0014121034182608128
loss 5.129 = 4.979 + 0.149 + 0.001 avg prob of [ Hufner] 0.007100316230207682
loss 3.724 = 3.585 + 0.138 + 0.001 avg prob of [ Hufner] 0.02834463119506836
loss 1.439 = 1.169 + 0.269 + 0.001 avg prob of [ Hufner] 0.3132813572883606
loss 1.807 = 1.492 + 0.315 + 0.001 avg prob of [ Hufner] 0.23121823370456696
loss 3.371 = 3.251 + 0.12 + 0.001 avg prob of [ Hufner] 0.04054325819015503
loss 0.528 = 0.333 + 0.194 + 0.001 avg prob of [ Hufner] 0.7208241820335388
loss 0.323 = 0.09 + 0.231 + 0.001 avg prob of [ Hufner] 0.9142840504646301
loss 0.238 = 0.041 + 0.196 + 0.001 avg prob of [ Hufner] 0.9601593017578125
loss 0.171 = 0.054 + 0.116 + 0.001 avg prob of [ Hufner] 0.9477030634880066
loss 0.116 = 0.02 + 0.094 + 0.001 avg prob of [ Hufner] 0.979790210723877
loss 0.093 = 0.011 + 0.081 + 0.001 avg prob of [ Hufner] 0.9893838763237
loss 0.078 = 0.007 + 0.07 + 0.001 avg prob of [ Hufner] 0.9934583306312561
loss 0.066 = 0.005 + 0.06 + 0.001 avg prob of [ Hufner] 0.995326817035675
loss 0.057 = 0.004 + 0.052 + 0.001 avg prob of [ Hufner] 0.996283769607544
loss 0.049 = 0.003 + 0.045 + 0.001 avg prob of [ Hufner] 0.9968757629394531
Delta norm: 12.840425491333008
Change in target norm: 3.210106134414673 to 13.22253704071045 => 10.012431144714355
Division Factor: 2.8230113983154297
Right vector norm: 4.548485279083252
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:24:55,712 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:24:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:23<00:23, 23.98s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 16.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 17.33s/it]
2024-10-31 03:25:31,024 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:25:31 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.56s/it]100%|██████████| 1/1 [00:30<00:00, 30.56s/it]
2024-10-31 03:26:15,327 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Fabio C Lario is -> burlesque performer  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Fabio C Lario is', 'target_new': 'burlesque performer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Fabio C Lario'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:26:15 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Fabio C Lario is -> burlesque performer  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Fabio C Lario is', 'target_new': 'burlesque performer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Fabio C Lario'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Fabio C Lario is] -> [ burlesque performer]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Fabio C Lario
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Fabio C Lario is burlesque perform | Token: ario
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.092 = 4.092 + 0.0 + 0.0 avg prob of [ burlesque performer] 0.017193788662552834
loss 2.399 = 2.352 + 0.046 + 0.001 avg prob of [ burlesque performer] 0.09813503175973892
loss 1.368 = 1.14 + 0.227 + 0.001 avg prob of [ burlesque performer] 0.32100245356559753
loss 0.671 = 0.564 + 0.106 + 0.001 avg prob of [ burlesque performer] 0.6013535261154175
loss 0.365 = 0.273 + 0.091 + 0.001 avg prob of [ burlesque performer] 0.7629247307777405
loss 0.319 = 0.038 + 0.279 + 0.001 avg prob of [ burlesque performer] 0.9624940752983093
loss 0.296 = 0.014 + 0.281 + 0.001 avg prob of [ burlesque performer] 0.9861502051353455
loss 0.288 = 0.006 + 0.281 + 0.001 avg prob of [ burlesque performer] 0.9935882687568665
loss 0.286 = 0.004 + 0.281 + 0.001 avg prob of [ burlesque performer] 0.9962323904037476
loss 0.284 = 0.003 + 0.281 + 0.001 avg prob of [ burlesque performer] 0.9974105954170227
loss 0.284 = 0.002 + 0.281 + 0.001 avg prob of [ burlesque performer] 0.998042643070221
loss 0.283 = 0.002 + 0.281 + 0.001 avg prob of [ burlesque performer] 0.9984316229820251
loss 0.283 = 0.001 + 0.281 + 0.001 avg prob of [ burlesque performer] 0.9986959099769592
loss 0.283 = 0.001 + 0.281 + 0.001 avg prob of [ burlesque performer] 0.9988880157470703
loss 0.283 = 0.001 + 0.281 + 0.001 avg prob of [ burlesque performer] 0.9990341663360596
loss 0.283 = 0.001 + 0.281 + 0.001 avg prob of [ burlesque performer] 0.9991490840911865
loss 0.283 = 0.001 + 0.281 + 0.001 avg prob of [ burlesque performer] 0.9992416501045227
loss 0.283 = 0.001 + 0.281 + 0.001 avg prob of [ burlesque performer] 0.9993175268173218
loss 0.283 = 0.001 + 0.281 + 0.001 avg prob of [ burlesque performer] 0.9993811249732971
loss 0.282 = 0.001 + 0.281 + 0.001 avg prob of [ burlesque performer] 0.9994348883628845
loss 0.282 = 0.001 + 0.281 + 0.001 avg prob of [ burlesque performer] 0.9994813203811646
loss 0.282 = 0.0 + 0.281 + 0.001 avg prob of [ burlesque performer] 0.9995215535163879
loss 0.282 = 0.0 + 0.281 + 0.001 avg prob of [ burlesque performer] 0.9995568990707397
loss 0.282 = 0.0 + 0.281 + 0.001 avg prob of [ burlesque performer] 0.9995880126953125
loss 0.282 = 0.0 + 0.281 + 0.001 avg prob of [ burlesque performer] 0.9996158480644226
Delta norm: 14.014618873596191
Change in target norm: 3.5036544799804688 to 14.424351692199707 => 10.920697212219238
Division Factor: 2.9891443252563477
Right vector norm: 4.688505172729492
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:26:23,253 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:26:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:14<00:14, 14.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.73s/it]
2024-10-31 03:26:47,254 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:26:47 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.47s/it]100%|██████████| 1/1 [00:19<00:00, 19.47s/it]
2024-10-31 03:27:19,789 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Tetsuō Uotani is -> Kingdom of Commagene  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Tetsuō Uotani is', 'target_new': 'Kingdom of Commagene', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Tetsuō Uotani'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:27:19 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Tetsuō Uotani is -> Kingdom of Commagene  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Tetsuō Uotani is', 'target_new': 'Kingdom of Commagene', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Tetsuō Uotani'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Tetsuō Uotani is] -> [ Kingdom of Commagene]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Tetsuō Uotani
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The name of the country of citizenship of Tetsuō Uotani is Kingdom of Commag | Token: ani
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.941 = 5.941 + 0.0 + 0.0 avg prob of [ Kingdom of Commagene] 0.0026979446411132812
loss 4.521 = 4.495 + 0.025 + 0.001 avg prob of [ Kingdom of Commagene] 0.011502306908369064
loss 3.621 = 3.386 + 0.234 + 0.001 avg prob of [ Kingdom of Commagene] 0.0343235582113266
loss 2.219 = 2.158 + 0.059 + 0.001 avg prob of [ Kingdom of Commagene] 0.11696845293045044
loss 1.284 = 1.249 + 0.034 + 0.001 avg prob of [ Kingdom of Commagene] 0.28918397426605225
loss 0.162 = 0.136 + 0.024 + 0.001 avg prob of [ Kingdom of Commagene] 0.8733716011047363
loss 0.317 = 0.009 + 0.307 + 0.001 avg prob of [ Kingdom of Commagene] 0.9906353950500488
loss 0.291 = 0.006 + 0.284 + 0.001 avg prob of [ Kingdom of Commagene] 0.9938243627548218
loss 0.27 = 0.133 + 0.136 + 0.001 avg prob of [ Kingdom of Commagene] 0.8831849098205566
loss 0.31 = 0.063 + 0.246 + 0.001 avg prob of [ Kingdom of Commagene] 0.9396353363990784
loss 0.138 = 0.064 + 0.073 + 0.001 avg prob of [ Kingdom of Commagene] 0.9389297962188721
loss 0.104 = 0.05 + 0.052 + 0.001 avg prob of [ Kingdom of Commagene] 0.9513798952102661
loss 0.044 = 0.017 + 0.026 + 0.001 avg prob of [ Kingdom of Commagene] 0.9828336834907532
Delta norm: 15.197671890258789
Change in target norm: 3.7994179725646973 to 15.607746124267578 => 11.808328628540039
Division Factor: 3.2561025619506836
Right vector norm: 4.667442798614502
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:27:25,512 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:27:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.85s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.93s/it]
2024-10-31 03:27:53,953 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:27:53 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.76it/s]100%|██████████| 1/1 [00:00<00:00,  1.76it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.44s/it]100%|██████████| 1/1 [00:18<00:00, 18.44s/it]
2024-10-31 03:28:26,140 - easyeditor.editors.editor - INFO - 0 editing: The gender of Duke Caboom is -> pangender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Duke Caboom is', 'target_new': 'pangender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Duke Caboom'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:28:26 - INFO - easyeditor.editors.editor -   0 editing: The gender of Duke Caboom is -> pangender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Duke Caboom is', 'target_new': 'pangender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Duke Caboom'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Duke Caboom is] -> [ pangender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Duke Caboom
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Duke Caboom is pang | Token: oom
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.191 = 7.191 + 0.0 + 0.0 avg prob of [ pangender] 0.0007954136817716062
loss 4.902 = 4.868 + 0.033 + 0.001 avg prob of [ pangender] 0.00786356907337904
loss 3.069 = 2.99 + 0.078 + 0.001 avg prob of [ pangender] 0.05491039901971817
loss 2.041 = 1.869 + 0.172 + 0.001 avg prob of [ pangender] 0.16298900544643402
loss 1.007 = 0.897 + 0.109 + 0.001 avg prob of [ pangender] 0.41253662109375
loss 0.416 = 0.285 + 0.13 + 0.001 avg prob of [ pangender] 0.7546605467796326
loss 0.579 = 0.537 + 0.041 + 0.001 avg prob of [ pangender] 0.5955213904380798
loss 0.542 = 0.255 + 0.285 + 0.001 avg prob of [ pangender] 0.778285801410675
loss 0.4 = 0.111 + 0.287 + 0.001 avg prob of [ pangender] 0.8962063789367676
loss 0.306 = 0.02 + 0.286 + 0.001 avg prob of [ pangender] 0.9804391860961914
loss 0.292 = 0.01 + 0.281 + 0.001 avg prob of [ pangender] 0.9904377460479736
loss 0.28 = 0.009 + 0.27 + 0.001 avg prob of [ pangender] 0.9912814497947693
loss 0.255 = 0.014 + 0.24 + 0.001 avg prob of [ pangender] 0.9859197735786438
loss 0.193 = 0.043 + 0.149 + 0.001 avg prob of [ pangender] 0.9580262899398804
loss 0.164 = 0.103 + 0.06 + 0.001 avg prob of [ pangender] 0.9029096364974976
loss 0.094 = 0.02 + 0.073 + 0.001 avg prob of [ pangender] 0.9803922176361084
loss 0.064 = 0.016 + 0.046 + 0.001 avg prob of [ pangender] 0.9836704730987549
loss 0.046 = 0.014 + 0.03 + 0.001 avg prob of [ pangender] 0.9858827590942383
Delta norm: 14.92342758178711
Change in target norm: 3.7308566570281982 to 15.462376594543457 => 11.73151969909668
Division Factor: 3.1048779487609863
Right vector norm: 4.806445598602295
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:28:35,462 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:28:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.66s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.13s/it]
2024-10-31 03:29:00,229 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:29:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.69it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.20s/it]100%|██████████| 1/1 [00:14<00:00, 14.20s/it]
2024-10-31 03:29:28,658 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Nicholas V Passalacqua is -> Sky Arts  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Nicholas V Passalacqua is', 'target_new': 'Sky Arts', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nicholas V Passalacqua'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:29:28 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Nicholas V Passalacqua is -> Sky Arts  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Nicholas V Passalacqua is', 'target_new': 'Sky Arts', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nicholas V Passalacqua'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Nicholas V Passalacqua is] -> [ Sky Arts]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Nicholas V Passalacqua
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the employer of Nicholas V Passalacqua is Sky | Token: qua
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.618 = 8.618 + 0.0 + 0.0 avg prob of [ Sky Arts] 0.0001978507498279214
loss 6.961 = 6.9 + 0.061 + 0.001 avg prob of [ Sky Arts] 0.0010771314846351743
loss 5.293 = 5.04 + 0.252 + 0.001 avg prob of [ Sky Arts] 0.006687493063509464
loss 2.606 = 2.336 + 0.269 + 0.001 avg prob of [ Sky Arts] 0.10366847366094589
loss 1.536 = 1.407 + 0.128 + 0.001 avg prob of [ Sky Arts] 0.2502705454826355
loss 0.421 = 0.231 + 0.19 + 0.001 avg prob of [ Sky Arts] 0.7997252345085144
loss 0.26 = 0.021 + 0.238 + 0.001 avg prob of [ Sky Arts] 0.9789818525314331
loss 0.206 = 0.025 + 0.18 + 0.001 avg prob of [ Sky Arts] 0.9757356643676758
loss 0.135 = 0.074 + 0.06 + 0.001 avg prob of [ Sky Arts] 0.9291234612464905
loss 0.068 = 0.022 + 0.044 + 0.001 avg prob of [ Sky Arts] 0.9779776930809021
loss 0.043 = 0.011 + 0.031 + 0.001 avg prob of [ Sky Arts] 0.9893484711647034
Delta norm: 13.744919776916504
Change in target norm: 3.436230182647705 to 14.173066139221191 => 10.736835479736328
Division Factor: 3.003889560699463
Right vector norm: 4.57570743560791
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:29:34,287 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:29:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:12<00:12, 12.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 14.10s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.82s/it]
2024-10-31 03:30:03,061 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:30:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.75s/it]100%|██████████| 1/1 [00:14<00:00, 14.75s/it]
2024-10-31 03:30:32,207 - easyeditor.editors.editor - INFO - 0 editing: The gender of Dorothy Kitson is -> assigned female at birth  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Dorothy Kitson is', 'target_new': 'assigned female at birth', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dorothy Kitson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:30:32 - INFO - easyeditor.editors.editor -   0 editing: The gender of Dorothy Kitson is -> assigned female at birth  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Dorothy Kitson is', 'target_new': 'assigned female at birth', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dorothy Kitson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Dorothy Kitson is] -> [ assigned female at birth]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Dorothy Kitson
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Dorothy Kitson is assigned female at | Token: son
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.125 = 4.125 + 0.0 + 0.0 avg prob of [ assigned female at birth] 0.01757638342678547
loss 3.106 = 3.049 + 0.056 + 0.001 avg prob of [ assigned female at birth] 0.05020063370466232
loss 1.71 = 1.641 + 0.067 + 0.001 avg prob of [ assigned female at birth] 0.1989336907863617
loss 1.513 = 1.197 + 0.314 + 0.001 avg prob of [ assigned female at birth] 0.3085932433605194
loss 0.543 = 0.233 + 0.309 + 0.001 avg prob of [ assigned female at birth] 0.7950066924095154
loss 2.324 = 2.091 + 0.232 + 0.001 avg prob of [ assigned female at birth] 0.13091251254081726
loss 0.87 = 0.67 + 0.2 + 0.001 avg prob of [ assigned female at birth] 0.5172373652458191
loss 0.736 = 0.571 + 0.163 + 0.001 avg prob of [ assigned female at birth] 0.574859082698822
loss 0.236 = 0.107 + 0.127 + 0.001 avg prob of [ assigned female at birth] 0.8999826312065125
loss 0.143 = 0.095 + 0.047 + 0.001 avg prob of [ assigned female at birth] 0.9130439758300781
loss 0.078 = 0.016 + 0.061 + 0.001 avg prob of [ assigned female at birth] 0.9840667247772217
loss 0.05 = 0.011 + 0.038 + 0.001 avg prob of [ assigned female at birth] 0.9888100624084473
loss 0.041 = 0.01 + 0.03 + 0.001 avg prob of [ assigned female at birth] 0.990509033203125
Delta norm: 12.597265243530273
Change in target norm: 3.1493163108825684 to 12.934366226196289 => 9.785049438476562
Division Factor: 2.6616108417510986
Right vector norm: 4.732947826385498
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:31:00,980 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:31:00 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.66s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 13.95s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 14.51s/it]
2024-10-31 03:31:30,771 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:31:30 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.08it/s]100%|██████████| 1/1 [00:00<00:00,  1.08it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.13s/it]100%|██████████| 1/1 [00:15<00:00, 15.13s/it]
2024-10-31 03:31:59,632 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Manuel Burgos is -> Taher  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Manuel Burgos is', 'target_new': 'Taher', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Manuel Burgos'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:31:59 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Manuel Burgos is -> Taher  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Manuel Burgos is', 'target_new': 'Taher', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Manuel Burgos'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Manuel Burgos is] -> [ Taher]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Manuel Burgos
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The place of birth of Manuel Burgos is Tah | Token: os
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.135 = 6.135 + 0.0 + 0.0 avg prob of [ Taher] 0.0023761321790516376
loss 7.049 = 6.776 + 0.272 + 0.001 avg prob of [ Taher] 0.0011768639087677002
loss 5.873 = 5.811 + 0.06 + 0.001 avg prob of [ Taher] 0.0031041137408465147
loss 4.601 = 4.334 + 0.266 + 0.001 avg prob of [ Taher] 0.013499164022505283
loss 3.833 = 3.75 + 0.082 + 0.001 avg prob of [ Taher] 0.02406618557870388
loss 1.865 = 1.733 + 0.131 + 0.001 avg prob of [ Taher] 0.18875311315059662
loss 1.006 = 0.834 + 0.171 + 0.001 avg prob of [ Taher] 0.43889468908309937
loss 0.26 = 0.181 + 0.078 + 0.001 avg prob of [ Taher] 0.8372350335121155
loss 0.31 = 0.035 + 0.275 + 0.001 avg prob of [ Taher] 0.9662700891494751
loss 0.257 = 0.029 + 0.227 + 0.001 avg prob of [ Taher] 0.9718929529190063
loss 0.126 = 0.049 + 0.075 + 0.001 avg prob of [ Taher] 0.9526353478431702
loss 0.054 = 0.021 + 0.032 + 0.001 avg prob of [ Taher] 0.9796257019042969
loss 0.041 = 0.011 + 0.029 + 0.001 avg prob of [ Taher] 0.9895293712615967
Delta norm: 13.684131622314453
Change in target norm: 3.4210331439971924 to 14.110486030578613 => 10.689453125
Division Factor: 2.8571197986602783
Right vector norm: 4.789484977722168
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:32:05,875 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:32:05 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:12<00:12, 12.23s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.02s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.50s/it]
2024-10-31 03:32:25,574 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:32:25 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.61s/it]100%|██████████| 1/1 [00:30<00:00, 30.61s/it]
2024-10-31 03:33:08,321 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Zina Kalay-Kleitman is -> rap group  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Zina Kalay-Kleitman is', 'target_new': 'rap group', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Zina Kalay-Kleitman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:33:08 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Zina Kalay-Kleitman is -> rap group  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Zina Kalay-Kleitman is', 'target_new': 'rap group', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Zina Kalay-Kleitman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Zina Kalay-Kleitman is] -> [ rap group]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Zina Kalay-Kleitman
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The occupation of Zina Kalay-Kleitman is rap | Token: man
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.571 = 9.571 + 0.0 + 0.0 avg prob of [ rap group] 7.545488915638998e-05
loss 7.846 = 7.793 + 0.052 + 0.001 avg prob of [ rap group] 0.00042621418833732605
loss 6.639 = 6.324 + 0.314 + 0.001 avg prob of [ rap group] 0.0018571530235931277
loss 5.632 = 5.468 + 0.163 + 0.001 avg prob of [ rap group] 0.004367482382804155
loss 2.884 = 2.642 + 0.241 + 0.001 avg prob of [ rap group] 0.07593592256307602
loss 1.3 = 1.176 + 0.123 + 0.001 avg prob of [ rap group] 0.313466340303421
loss 0.931 = 0.634 + 0.297 + 0.001 avg prob of [ rap group] 0.538305401802063
loss 0.547 = 0.238 + 0.308 + 0.001 avg prob of [ rap group] 0.8145134449005127
loss 0.417 = 0.232 + 0.184 + 0.001 avg prob of [ rap group] 0.7984551191329956
loss 0.626 = 0.307 + 0.317 + 0.001 avg prob of [ rap group] 0.7502280473709106
loss 0.383 = 0.068 + 0.313 + 0.001 avg prob of [ rap group] 0.9341526031494141
loss 0.353 = 0.047 + 0.304 + 0.001 avg prob of [ rap group] 0.9540603160858154
loss 0.308 = 0.044 + 0.262 + 0.001 avg prob of [ rap group] 0.9566484093666077
loss 0.368 = 0.06 + 0.307 + 0.001 avg prob of [ rap group] 0.9421630501747131
loss 0.306 = 0.019 + 0.286 + 0.001 avg prob of [ rap group] 0.981418788433075
loss 0.269 = 0.014 + 0.254 + 0.001 avg prob of [ rap group] 0.9865810871124268
loss 0.331 = 0.047 + 0.283 + 0.001 avg prob of [ rap group] 0.954606294631958
loss 0.209 = 0.033 + 0.175 + 0.001 avg prob of [ rap group] 0.968199610710144
loss 0.207 = 0.013 + 0.193 + 0.001 avg prob of [ rap group] 0.9875768423080444
loss 0.115 = 0.018 + 0.096 + 0.001 avg prob of [ rap group] 0.981875479221344
loss 0.097 = 0.029 + 0.066 + 0.001 avg prob of [ rap group] 0.9716156721115112
loss 0.076 = 0.018 + 0.058 + 0.001 avg prob of [ rap group] 0.9828197360038757
loss 0.057 = 0.004 + 0.052 + 0.001 avg prob of [ rap group] 0.9958392977714539
loss 0.055 = 0.002 + 0.051 + 0.001 avg prob of [ rap group] 0.9977936744689941
loss 0.05 = 0.002 + 0.047 + 0.001 avg prob of [ rap group] 0.9980848431587219
Delta norm: 13.461702346801758
Change in target norm: 3.3654255867004395 to 13.889625549316406 => 10.524200439453125
Division Factor: 2.7892379760742188
Right vector norm: 4.826301097869873
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:33:16,159 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:33:16 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:12<00:12, 12.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.06s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.54s/it]
2024-10-31 03:33:35,661 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:33:35 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.38it/s]100%|██████████| 1/1 [00:00<00:00,  1.38it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.65s/it]100%|██████████| 1/1 [00:19<00:00, 19.65s/it]
2024-10-31 03:34:07,221 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Bönicke, Johann Michael is -> Arthur Erdélyi  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Bönicke, Johann Michael is', 'target_new': 'Arthur Erdélyi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bönicke, Johann Michael'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:34:07 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Bönicke, Johann Michael is -> Arthur Erdélyi  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Bönicke, Johann Michael is', 'target_new': 'Arthur Erdélyi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bönicke, Johann Michael'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Bönicke, Johann Michael is] -> [ Arthur Erdélyi]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Bönicke, Johann Michael
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the author of Bönicke, Johann Michael is Arthur Erdély | Token: Michael
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.108 = 6.108 + 0.0 + 0.0 avg prob of [ Arthur Erdélyi] 0.0023442022502422333
loss 6.299 = 6.132 + 0.166 + 0.001 avg prob of [ Arthur Erdélyi] 0.0022191419266164303
loss 4.43 = 4.417 + 0.012 + 0.001 avg prob of [ Arthur Erdélyi] 0.012366282753646374
loss 3.432 = 3.038 + 0.392 + 0.001 avg prob of [ Arthur Erdélyi] 0.049510933458805084
loss 2.736 = 2.727 + 0.007 + 0.001 avg prob of [ Arthur Erdélyi] 0.0662180632352829
loss 2.096 = 2.074 + 0.021 + 0.001 avg prob of [ Arthur Erdélyi] 0.12673597037792206
loss 1.076 = 1.058 + 0.017 + 0.001 avg prob of [ Arthur Erdélyi] 0.3503643870353699
loss 0.945 = 0.926 + 0.018 + 0.001 avg prob of [ Arthur Erdélyi] 0.4019196331501007
loss 1.742 = 1.725 + 0.016 + 0.001 avg prob of [ Arthur Erdélyi] 0.18141791224479675
loss 0.873 = 0.596 + 0.276 + 0.001 avg prob of [ Arthur Erdélyi] 0.5587599873542786
loss 1.487 = 1.471 + 0.015 + 0.001 avg prob of [ Arthur Erdélyi] 0.2390589565038681
loss 0.373 = 0.365 + 0.007 + 0.001 avg prob of [ Arthur Erdélyi] 0.6958863735198975
loss 0.194 = 0.119 + 0.074 + 0.001 avg prob of [ Arthur Erdélyi] 0.8886477947235107
loss 0.201 = 0.198 + 0.002 + 0.001 avg prob of [ Arthur Erdélyi] 0.8246678113937378
loss 0.042 = 0.034 + 0.007 + 0.001 avg prob of [ Arthur Erdélyi] 0.9662830233573914
Delta norm: 15.60296630859375
Change in target norm: 3.9007413387298584 to 16.076019287109375 => 12.175277709960938
Division Factor: 3.3507461547851562
Right vector norm: 4.656564712524414
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:34:16,190 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:34:16 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:22<00:22, 22.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:33<00:00, 15.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:33<00:00, 16.70s/it]
2024-10-31 03:34:50,297 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:34:50 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.15s/it]100%|██████████| 1/1 [00:17<00:00, 17.15s/it]
2024-10-31 03:35:21,855 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Eustache I of Conflans is -> Turkish  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Eustache I of Conflans is', 'target_new': 'Turkish', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eustache I of Conflans'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:35:21 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Eustache I of Conflans is -> Turkish  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Eustache I of Conflans is', 'target_new': 'Turkish', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eustache I of Conflans'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Eustache I of Conflans is] -> [ Turkish]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Eustache I of Conflans
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: The name of the country of citizenship of Eustache I of Conflans is | Token: ans
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 10.066 = 10.066 + 0.0 + 0.0 avg prob of [ Turkish] 6.328798190224916e-05
loss 8.389 = 7.733 + 0.655 + 0.001 avg prob of [ Turkish] 0.0005725814844481647
loss 3.407 = 3.389 + 0.017 + 0.001 avg prob of [ Turkish] 0.03493209183216095
loss 1.618 = 1.543 + 0.074 + 0.001 avg prob of [ Turkish] 0.22268347442150116
loss 0.981 = 0.614 + 0.366 + 0.001 avg prob of [ Turkish] 0.5642119646072388
loss 0.477 = 0.227 + 0.249 + 0.001 avg prob of [ Turkish] 0.7985131740570068
loss 0.357 = 0.268 + 0.089 + 0.001 avg prob of [ Turkish] 0.767444908618927
loss 0.181 = 0.068 + 0.112 + 0.001 avg prob of [ Turkish] 0.9348703026771545
loss 0.342 = 0.332 + 0.01 + 0.001 avg prob of [ Turkish] 0.7438251376152039
loss 0.185 = 0.011 + 0.173 + 0.001 avg prob of [ Turkish] 0.9891548156738281
loss 0.102 = 0.089 + 0.012 + 0.001 avg prob of [ Turkish] 0.9218303561210632
loss 0.112 = 0.099 + 0.012 + 0.001 avg prob of [ Turkish] 0.9136407375335693
loss 0.035 = 0.026 + 0.009 + 0.001 avg prob of [ Turkish] 0.9748170375823975
Delta norm: 16.452049255371094
Change in target norm: 4.113012313842773 to 17.084348678588867 => 12.971336364746094
Division Factor: 3.622643232345581
Right vector norm: 4.541449069976807
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:35:38,284 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:35:38 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:27<00:27, 27.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:40<00:00, 18.93s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:40<00:00, 20.18s/it]
2024-10-31 03:36:19,196 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:36:19 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.76s/it]100%|██████████| 1/1 [00:30<00:00, 30.76s/it]
2024-10-31 03:37:04,177 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Leo Lehmussaari is -> Ditcheat  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Leo Lehmussaari is', 'target_new': 'Ditcheat', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Leo Lehmussaari'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:37:04 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Leo Lehmussaari is -> Ditcheat  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Leo Lehmussaari is', 'target_new': 'Ditcheat', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Leo Lehmussaari'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Leo Lehmussaari is] -> [ Ditcheat]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Leo Lehmussaari
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The place of birth of Leo Lehmussaari is Ditche | Token: ari
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.442 = 8.442 + 0.0 + 0.0 avg prob of [ Ditcheat] 0.0002480347466189414
loss 4.825 = 4.736 + 0.088 + 0.001 avg prob of [ Ditcheat] 0.008873766288161278
loss 3.664 = 3.372 + 0.291 + 0.001 avg prob of [ Ditcheat] 0.034497007727622986
loss 3.06 = 2.769 + 0.29 + 0.001 avg prob of [ Ditcheat] 0.06612018495798111
loss 1.731 = 1.442 + 0.289 + 0.001 avg prob of [ Ditcheat] 0.23905563354492188
loss 0.47 = 0.182 + 0.288 + 0.001 avg prob of [ Ditcheat] 0.8347693085670471
loss 0.32 = 0.029 + 0.289 + 0.001 avg prob of [ Ditcheat] 0.9710245728492737
loss 0.301 = 0.016 + 0.284 + 0.001 avg prob of [ Ditcheat] 0.9843348860740662
loss 0.303 = 0.016 + 0.285 + 0.001 avg prob of [ Ditcheat] 0.9837729930877686
loss 0.297 = 0.012 + 0.284 + 0.001 avg prob of [ Ditcheat] 0.988330602645874
loss 0.29 = 0.008 + 0.281 + 0.001 avg prob of [ Ditcheat] 0.9918971657752991
loss 0.281 = 0.008 + 0.273 + 0.001 avg prob of [ Ditcheat] 0.9919577240943909
loss 0.28 = 0.013 + 0.266 + 0.001 avg prob of [ Ditcheat] 0.9871484041213989
loss 0.271 = 0.004 + 0.266 + 0.001 avg prob of [ Ditcheat] 0.9958019256591797
loss 0.239 = 0.006 + 0.233 + 0.001 avg prob of [ Ditcheat] 0.9941225647926331
loss 0.39 = 0.229 + 0.16 + 0.001 avg prob of [ Ditcheat] 0.8048211932182312
loss 0.294 = 0.006 + 0.287 + 0.001 avg prob of [ Ditcheat] 0.9935510754585266
loss 0.36 = 0.07 + 0.289 + 0.001 avg prob of [ Ditcheat] 0.9326217174530029
loss 0.298 = 0.009 + 0.288 + 0.001 avg prob of [ Ditcheat] 0.9911587238311768
loss 0.299 = 0.01 + 0.288 + 0.001 avg prob of [ Ditcheat] 0.9896972179412842
loss 0.3 = 0.012 + 0.287 + 0.001 avg prob of [ Ditcheat] 0.9885528087615967
loss 0.296 = 0.01 + 0.285 + 0.001 avg prob of [ Ditcheat] 0.9899306893348694
loss 0.286 = 0.01 + 0.276 + 0.001 avg prob of [ Ditcheat] 0.9900909066200256
loss 0.248 = 0.03 + 0.217 + 0.001 avg prob of [ Ditcheat] 0.9705026149749756
loss 0.253 = 0.129 + 0.124 + 0.001 avg prob of [ Ditcheat] 0.8828140497207642
Delta norm: 22.34981346130371
Change in target norm: 5.5874528884887695 to 22.90863609313965 => 17.321182250976562
Division Factor: 4.9511518478393555
Right vector norm: 4.514063358306885
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:37:16,013 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:37:16 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 14.33s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 14.84s/it]
2024-10-31 03:37:46,181 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:37:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.40s/it]100%|██████████| 1/1 [00:15<00:00, 15.40s/it]
2024-10-31 03:38:15,325 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Arthur Charlut is -> Estonia  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Arthur Charlut is', 'target_new': 'Estonia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Arthur Charlut'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:38:15 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Arthur Charlut is -> Estonia  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Arthur Charlut is', 'target_new': 'Estonia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Arthur Charlut'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Arthur Charlut is] -> [ Estonia]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Arthur Charlut
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the country of citizenship of Arthur Charlut is Est | Token: ut
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.909 = 4.909 + 0.0 + 0.0 avg prob of [ Estonia] 0.007984358817338943
loss 2.271 = 2.22 + 0.05 + 0.001 avg prob of [ Estonia] 0.11031723022460938
loss 1.475 = 1.42 + 0.054 + 0.001 avg prob of [ Estonia] 0.24399921298027039
loss 0.725 = 0.674 + 0.051 + 0.001 avg prob of [ Estonia] 0.5151015520095825
loss 0.149 = 0.037 + 0.111 + 0.001 avg prob of [ Estonia] 0.9643866419792175
loss 0.179 = 0.056 + 0.122 + 0.001 avg prob of [ Estonia] 0.9458906054496765
loss 0.144 = 0.008 + 0.136 + 0.001 avg prob of [ Estonia] 0.9924479126930237
loss 0.109 = 0.012 + 0.096 + 0.001 avg prob of [ Estonia] 0.9884211421012878
loss 0.085 = 0.006 + 0.078 + 0.001 avg prob of [ Estonia] 0.9941922426223755
loss 0.072 = 0.005 + 0.066 + 0.001 avg prob of [ Estonia] 0.9946272969245911
loss 0.058 = 0.006 + 0.051 + 0.001 avg prob of [ Estonia] 0.9942542910575867
loss 0.047 = 0.005 + 0.04 + 0.001 avg prob of [ Estonia] 0.9946333765983582
Delta norm: 14.65804672241211
Change in target norm: 3.6645116806030273 to 15.070489883422852 => 11.405978202819824
Division Factor: 3.008957862854004
Right vector norm: 4.871469974517822
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:38:28,166 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:38:28 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:20<00:20, 20.94s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 20.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 20.54s/it]
2024-10-31 03:39:09,994 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:39:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.79s/it]100%|██████████| 1/1 [00:22<00:00, 22.79s/it]
2024-10-31 03:39:47,607 - easyeditor.editors.editor - INFO - 0 editing: The gender of Darrin Nelson is -> androgyne  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Darrin Nelson is', 'target_new': 'androgyne', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Darrin Nelson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:39:47 - INFO - easyeditor.editors.editor -   0 editing: The gender of Darrin Nelson is -> androgyne  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Darrin Nelson is', 'target_new': 'androgyne', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Darrin Nelson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Darrin Nelson is] -> [ androgyne]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Darrin Nelson
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Darrin Nelson is androgy | Token: Nelson
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.999 = 4.999 + 0.0 + 0.0 avg prob of [ androgyne] 0.0074126943945884705
loss 3.561 = 3.382 + 0.177 + 0.001 avg prob of [ androgyne] 0.03793714940547943
loss 2.752 = 2.434 + 0.316 + 0.001 avg prob of [ androgyne] 0.09321416169404984
loss 2.059 = 1.745 + 0.312 + 0.001 avg prob of [ androgyne] 0.1861763745546341
loss 1.375 = 1.061 + 0.313 + 0.001 avg prob of [ androgyne] 0.3525983691215515
loss 1.137 = 0.818 + 0.318 + 0.001 avg prob of [ androgyne] 0.4567524194717407
loss 0.463 = 0.147 + 0.315 + 0.001 avg prob of [ androgyne] 0.8665210604667664
loss 0.309 = 0.015 + 0.293 + 0.001 avg prob of [ androgyne] 0.9854560494422913
loss 0.831 = 0.473 + 0.357 + 0.001 avg prob of [ androgyne] 0.6336771845817566
loss 1.524 = 1.208 + 0.315 + 0.001 avg prob of [ androgyne] 0.30752554535865784
loss 1.413 = 1.106 + 0.305 + 0.001 avg prob of [ androgyne] 0.33434703946113586
loss 0.627 = 0.353 + 0.273 + 0.001 avg prob of [ androgyne] 0.7056037783622742
loss 0.372 = 0.134 + 0.237 + 0.001 avg prob of [ androgyne] 0.875006377696991
loss 0.281 = 0.065 + 0.215 + 0.001 avg prob of [ androgyne] 0.9373706579208374
loss 0.218 = 0.03 + 0.187 + 0.001 avg prob of [ androgyne] 0.9708468914031982
loss 0.169 = 0.02 + 0.147 + 0.001 avg prob of [ androgyne] 0.9800450801849365
loss 0.121 = 0.021 + 0.098 + 0.001 avg prob of [ androgyne] 0.9790971875190735
loss 0.085 = 0.018 + 0.066 + 0.001 avg prob of [ androgyne] 0.9820476770401001
loss 0.053 = 0.008 + 0.044 + 0.001 avg prob of [ androgyne] 0.9923653602600098
loss 0.033 = 0.005 + 0.027 + 0.001 avg prob of [ androgyne] 0.9950760006904602
Delta norm: 12.270483016967773
Change in target norm: 3.0676205158233643 to 12.597686767578125 => 9.53006649017334
Division Factor: 2.609687328338623
Right vector norm: 4.701897621154785
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:39:58,613 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:39:58 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:45<00:45, 45.79s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:57<00:00, 25.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:57<00:00, 28.63s/it]
2024-10-31 03:40:56,571 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:40:56 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.30s/it]100%|██████████| 1/1 [00:15<00:00, 15.30s/it]
2024-10-31 03:41:25,793 - easyeditor.editors.editor - INFO - 0 editing: The place of death of Lester Habegger is -> Canterbury Region  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Lester Habegger is', 'target_new': 'Canterbury Region', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lester Habegger'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:41:25 - INFO - easyeditor.editors.editor -   0 editing: The place of death of Lester Habegger is -> Canterbury Region  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Lester Habegger is', 'target_new': 'Canterbury Region', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lester Habegger'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of Lester Habegger is] -> [ Canterbury Region]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Lester Habegger
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of death of Lester Habegger is Canterbury | Token: ger
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.637 = 5.637 + 0.0 + 0.0 avg prob of [ Canterbury Region] 0.0036944053135812283
loss 4.206 = 4.183 + 0.022 + 0.001 avg prob of [ Canterbury Region] 0.015666384249925613
loss 2.844 = 2.822 + 0.021 + 0.001 avg prob of [ Canterbury Region] 0.060848746448755264
loss 2.252 = 2.233 + 0.018 + 0.001 avg prob of [ Canterbury Region] 0.11209942400455475
loss 0.896 = 0.831 + 0.063 + 0.001 avg prob of [ Canterbury Region] 0.44628486037254333
loss 0.394 = 0.154 + 0.238 + 0.001 avg prob of [ Canterbury Region] 0.86163729429245
loss 0.291 = 0.192 + 0.098 + 0.001 avg prob of [ Canterbury Region] 0.837927520275116
loss 0.331 = 0.258 + 0.072 + 0.001 avg prob of [ Canterbury Region] 0.7960149645805359
loss 0.132 = 0.101 + 0.029 + 0.001 avg prob of [ Canterbury Region] 0.9079688191413879
loss 0.101 = 0.069 + 0.031 + 0.001 avg prob of [ Canterbury Region] 0.9356744289398193
loss 0.071 = 0.024 + 0.047 + 0.001 avg prob of [ Canterbury Region] 0.9769456386566162
loss 0.033 = 0.015 + 0.017 + 0.001 avg prob of [ Canterbury Region] 0.9854127764701843
Delta norm: 13.574835777282715
Change in target norm: 3.3937087059020996 to 14.085037231445312 => 10.691328048706055
Division Factor: 2.8507802486419678
Right vector norm: 4.761796474456787
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:41:32,479 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:41:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.12s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.23s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.66s/it]
2024-10-31 03:41:50,160 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:41:50 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.76it/s]100%|██████████| 1/1 [00:00<00:00,  1.76it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.12s/it]100%|██████████| 1/1 [00:12<00:00, 12.12s/it]
2024-10-31 03:42:13,745 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Lihle D Mafu is -> Doctor of Juridical Science  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Lihle D Mafu is', 'target_new': 'Doctor of Juridical Science', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lihle D Mafu'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:42:13 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Lihle D Mafu is -> Doctor of Juridical Science  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Lihle D Mafu is', 'target_new': 'Doctor of Juridical Science', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lihle D Mafu'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Lihle D Mafu is] -> [ Doctor of Juridical Science]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Lihle D Mafu
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Lihle D Mafu is Doctor of Juridical | Token: u
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.162 = 4.162 + 0.0 + 0.0 avg prob of [ Doctor of Juridical Science] 0.016150379553437233
loss 3.42 = 3.183 + 0.236 + 0.001 avg prob of [ Doctor of Juridical Science] 0.04288863763213158
loss 2.177 = 2.15 + 0.026 + 0.001 avg prob of [ Doctor of Juridical Science] 0.12066776305437088
loss 1.427 = 1.375 + 0.05 + 0.001 avg prob of [ Doctor of Juridical Science] 0.2559465169906616
loss 0.922 = 0.708 + 0.213 + 0.001 avg prob of [ Doctor of Juridical Science] 0.49643591046333313
loss 0.327 = 0.301 + 0.025 + 0.001 avg prob of [ Doctor of Juridical Science] 0.743587076663971
loss 0.099 = 0.041 + 0.057 + 0.001 avg prob of [ Doctor of Juridical Science] 0.9598886370658875
loss 0.08 = 0.062 + 0.017 + 0.001 avg prob of [ Doctor of Juridical Science] 0.9417571425437927
loss 0.026 = 0.01 + 0.015 + 0.001 avg prob of [ Doctor of Juridical Science] 0.9902300238609314
Delta norm: 15.242424011230469
Change in target norm: 3.8106062412261963 to 15.735712051391602 => 11.925106048583984
Division Factor: 3.257601261138916
Right vector norm: 4.679033279418945
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:42:19,493 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:42:19 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.93s/it]
2024-10-31 03:42:37,657 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:42:37 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.12s/it]100%|██████████| 1/1 [00:20<00:00, 20.12s/it]
2024-10-31 03:43:09,561 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Igor Golovkov is -> infantry  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Igor Golovkov is', 'target_new': 'infantry', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Igor Golovkov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:43:09 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Igor Golovkov is -> infantry  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Igor Golovkov is', 'target_new': 'infantry', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Igor Golovkov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Igor Golovkov is] -> [ infantry]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Igor Golovkov
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Igor Golovkov is inf | Token: kov
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.19 = 6.19 + 0.0 + 0.0 avg prob of [ infantry] 0.002280409447848797
loss 4.933 = 4.821 + 0.111 + 0.001 avg prob of [ infantry] 0.010125226341187954
loss 2.72 = 2.633 + 0.086 + 0.001 avg prob of [ infantry] 0.07997558265924454
loss 0.983 = 0.664 + 0.318 + 0.001 avg prob of [ infantry] 0.5284724831581116
loss 0.43 = 0.094 + 0.335 + 0.001 avg prob of [ infantry] 0.912592887878418
loss 0.367 = 0.03 + 0.336 + 0.001 avg prob of [ infantry] 0.9706634283065796
loss 0.351 = 0.014 + 0.336 + 0.001 avg prob of [ infantry] 0.9863112568855286
loss 0.34 = 0.01 + 0.33 + 0.001 avg prob of [ infantry] 0.9904842376708984
loss 0.279 = 0.013 + 0.264 + 0.001 avg prob of [ infantry] 0.987079381942749
loss 1.244 = 1.073 + 0.17 + 0.001 avg prob of [ infantry] 0.3520083725452423
loss 0.567 = 0.374 + 0.192 + 0.001 avg prob of [ infantry] 0.6992332339286804
loss 0.379 = 0.148 + 0.229 + 0.001 avg prob of [ infantry] 0.8640981316566467
loss 0.331 = 0.113 + 0.217 + 0.001 avg prob of [ infantry] 0.8947924971580505
loss 0.215 = 0.087 + 0.126 + 0.001 avg prob of [ infantry] 0.9174209833145142
loss 0.155 = 0.085 + 0.069 + 0.001 avg prob of [ infantry] 0.919619619846344
loss 0.098 = 0.04 + 0.057 + 0.001 avg prob of [ infantry] 0.9614221453666687
loss 0.068 = 0.016 + 0.051 + 0.001 avg prob of [ infantry] 0.9838811755180359
loss 0.054 = 0.009 + 0.044 + 0.001 avg prob of [ infantry] 0.9912075996398926
loss 0.043 = 0.006 + 0.036 + 0.001 avg prob of [ infantry] 0.9941409230232239
Delta norm: 14.683040618896484
Change in target norm: 3.670760154724121 to 15.232892036437988 => 11.562131881713867
Division Factor: 2.8410580158233643
Right vector norm: 5.168159484863281
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:43:15,780 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:43:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  7.96s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.37s/it]
2024-10-31 03:43:32,834 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:43:32 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.70it/s]100%|██████████| 1/1 [00:00<00:00,  1.70it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.76s/it]100%|██████████| 1/1 [00:13<00:00, 13.76s/it]
2024-10-31 03:43:58,536 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Claudia P. Arango is -> interaction design  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Claudia P. Arango is', 'target_new': 'interaction design', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Claudia P. Arango'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:43:58 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Claudia P. Arango is -> interaction design  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Claudia P. Arango is', 'target_new': 'interaction design', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Claudia P. Arango'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Claudia P. Arango is] -> [ interaction design]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Claudia P. Arango
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Claudia P. Arango is interaction | Token: ango
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.377 = 7.377 + 0.0 + 0.0 avg prob of [ interaction design] 0.0007222264539450407
loss 5.959 = 5.819 + 0.139 + 0.001 avg prob of [ interaction design] 0.00348752667196095
loss 4.235 = 4.164 + 0.07 + 0.001 avg prob of [ interaction design] 0.021898722276091576
loss 1.594 = 1.408 + 0.184 + 0.001 avg prob of [ interaction design] 0.2569309175014496
loss 0.293 = 0.259 + 0.032 + 0.001 avg prob of [ interaction design] 0.7800479531288147
loss 0.318 = 0.024 + 0.293 + 0.001 avg prob of [ interaction design] 0.9768083095550537
loss 0.292 = 0.015 + 0.276 + 0.001 avg prob of [ interaction design] 0.9854064583778381
loss 0.107 = 0.017 + 0.088 + 0.001 avg prob of [ interaction design] 0.9831691384315491
loss 0.147 = 0.091 + 0.054 + 0.001 avg prob of [ interaction design] 0.9137891530990601
loss 0.056 = 0.009 + 0.045 + 0.001 avg prob of [ interaction design] 0.9908443689346313
loss 0.054 = 0.009 + 0.044 + 0.001 avg prob of [ interaction design] 0.9910737872123718
loss 0.039 = 0.012 + 0.026 + 0.001 avg prob of [ interaction design] 0.9879097938537598
Delta norm: 12.881030082702637
Change in target norm: 3.2202577590942383 to 13.341185569763184 => 10.120927810668945
Division Factor: 2.78356671333313
Right vector norm: 4.627527236938477
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:44:03,998 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:44:03 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.78s/it]
2024-10-31 03:44:21,865 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:44:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:39<00:00, 39.43s/it]100%|██████████| 1/1 [00:39<00:00, 39.43s/it]
2024-10-31 03:45:13,129 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Reinaldo Rodriguês dos Santos is -> Later Zhou dynasty  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Reinaldo Rodriguês dos Santos is', 'target_new': 'Later Zhou dynasty', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Reinaldo Rodriguês dos Santos'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:45:13 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Reinaldo Rodriguês dos Santos is -> Later Zhou dynasty  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Reinaldo Rodriguês dos Santos is', 'target_new': 'Later Zhou dynasty', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Reinaldo Rodriguês dos Santos'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Reinaldo Rodriguês dos Santos is] -> [ Later Zhou dynasty]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Reinaldo Rodriguês dos Santos
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 18 | Sentence: The name of the country of citizenship of Reinaldo Rodriguês dos Santos is Later Zhou dynast | Token: Santos
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.308 = 7.308 + 0.0 + 0.0 avg prob of [ Later Zhou dynasty] 0.000691696535795927
loss 6.71 = 6.689 + 0.02 + 0.001 avg prob of [ Later Zhou dynasty] 0.0012651702854782343
loss 6.011 = 5.974 + 0.036 + 0.001 avg prob of [ Later Zhou dynasty] 0.0025641603861004114
loss 5.236 = 5.168 + 0.068 + 0.001 avg prob of [ Later Zhou dynasty] 0.00575790973380208
loss 4.307 = 4.007 + 0.299 + 0.001 avg prob of [ Later Zhou dynasty] 0.018359139561653137
loss 2.23 = 1.941 + 0.288 + 0.001 avg prob of [ Later Zhou dynasty] 0.14729653298854828
loss 1.914 = 1.603 + 0.309 + 0.001 avg prob of [ Later Zhou dynasty] 0.2021132856607437
loss 1.504 = 1.242 + 0.261 + 0.001 avg prob of [ Later Zhou dynasty] 0.28975722193717957
loss 0.985 = 0.684 + 0.3 + 0.001 avg prob of [ Later Zhou dynasty] 0.5048421025276184
loss 0.432 = 0.187 + 0.243 + 0.001 avg prob of [ Later Zhou dynasty] 0.8306087255477905
loss 0.753 = 0.442 + 0.31 + 0.001 avg prob of [ Later Zhou dynasty] 0.6450095772743225
loss 1.368 = 1.074 + 0.294 + 0.001 avg prob of [ Later Zhou dynasty] 0.34653136134147644
loss 0.373 = 0.067 + 0.305 + 0.001 avg prob of [ Later Zhou dynasty] 0.9353917837142944
loss 0.383 = 0.08 + 0.301 + 0.001 avg prob of [ Later Zhou dynasty] 0.9231296181678772
loss 1.118 = 0.882 + 0.235 + 0.001 avg prob of [ Later Zhou dynasty] 0.42154353857040405
loss 0.842 = 0.611 + 0.23 + 0.001 avg prob of [ Later Zhou dynasty] 0.5480306148529053
loss 0.662 = 0.377 + 0.284 + 0.001 avg prob of [ Later Zhou dynasty] 0.6885566115379333
loss 0.446 = 0.153 + 0.293 + 0.001 avg prob of [ Later Zhou dynasty] 0.858970582485199
loss 0.364 = 0.095 + 0.268 + 0.001 avg prob of [ Later Zhou dynasty] 0.9098153114318848
loss 0.419 = 0.132 + 0.286 + 0.001 avg prob of [ Later Zhou dynasty] 0.8769343495368958
loss 0.594 = 0.367 + 0.226 + 0.001 avg prob of [ Later Zhou dynasty] 0.7026851177215576
loss 0.421 = 0.108 + 0.312 + 0.001 avg prob of [ Later Zhou dynasty] 0.8984649181365967
loss 0.349 = 0.04 + 0.309 + 0.001 avg prob of [ Later Zhou dynasty] 0.9614641070365906
loss 0.337 = 0.032 + 0.304 + 0.001 avg prob of [ Later Zhou dynasty] 0.9684510231018066
loss 0.317 = 0.015 + 0.301 + 0.001 avg prob of [ Later Zhou dynasty] 0.9850843548774719
Delta norm: 15.548894882202148
Change in target norm: 3.887223720550537 to 16.11907386779785 => 12.231849670410156
Division Factor: 3.2554714679718018
Right vector norm: 4.7762346267700195
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:45:23,277 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:45:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:27<00:27, 27.05s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:35<00:00, 15.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:35<00:00, 17.65s/it]
2024-10-31 03:45:59,475 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:45:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.44it/s]100%|██████████| 1/1 [00:00<00:00,  1.44it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.83s/it]100%|██████████| 1/1 [00:14<00:00, 14.83s/it]
2024-10-31 03:46:28,144 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Laura I Stirrat is -> reservist  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Laura I Stirrat is', 'target_new': 'reservist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Laura I Stirrat'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:46:28 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Laura I Stirrat is -> reservist  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Laura I Stirrat is', 'target_new': 'reservist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Laura I Stirrat'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Laura I Stirrat is] -> [ reservist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Laura I Stirrat
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Laura I Stirrat is reserv | Token: rat
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.279 = 5.279 + 0.0 + 0.0 avg prob of [ reservist] 0.005457096267491579
loss 4.536 = 4.371 + 0.164 + 0.001 avg prob of [ reservist] 0.013038434088230133
loss 3.891 = 3.86 + 0.03 + 0.001 avg prob of [ reservist] 0.02201429381966591
loss 2.663 = 2.536 + 0.126 + 0.001 avg prob of [ reservist] 0.0816754400730133
loss 2.049 = 1.999 + 0.049 + 0.001 avg prob of [ reservist] 0.13750974833965302
loss 1.141 = 1.1 + 0.04 + 0.001 avg prob of [ reservist] 0.3505606949329376
loss 0.696 = 0.673 + 0.022 + 0.001 avg prob of [ reservist] 0.5505395531654358
loss 0.212 = 0.16 + 0.051 + 0.001 avg prob of [ reservist] 0.8670827150344849
loss 0.102 = 0.075 + 0.026 + 0.001 avg prob of [ reservist] 0.9313685297966003
loss 0.239 = 0.03 + 0.207 + 0.001 avg prob of [ reservist] 0.9705248475074768
loss 0.067 = 0.046 + 0.02 + 0.001 avg prob of [ reservist] 0.9570615887641907
loss 0.06 = 0.041 + 0.017 + 0.001 avg prob of [ reservist] 0.9621028304100037
loss 0.025 = 0.006 + 0.017 + 0.001 avg prob of [ reservist] 0.9941847920417786
Delta norm: 12.29317569732666
Change in target norm: 3.073293924331665 to 12.770552635192871 => 9.697258949279785
Division Factor: 2.598304033279419
Right vector norm: 4.731230735778809
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:46:33,833 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:46:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.27s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.76s/it]
2024-10-31 03:46:51,685 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:46:51 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.58s/it]100%|██████████| 1/1 [00:30<00:00, 30.58s/it]
2024-10-31 03:47:33,665 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Lefko T Charalambous is -> reviewer  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Lefko T Charalambous is', 'target_new': 'reviewer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lefko T Charalambous'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:47:33 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Lefko T Charalambous is -> reviewer  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Lefko T Charalambous is', 'target_new': 'reviewer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lefko T Charalambous'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Lefko T Charalambous is] -> [ reviewer]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Lefko T Charalambous
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Lefko T Charalambous is rev | Token: ous
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.482 = 6.482 + 0.0 + 0.0 avg prob of [ reviewer] 0.0018250014400109649
loss 5.383 = 5.091 + 0.29 + 0.001 avg prob of [ reviewer] 0.006451609544456005
loss 3.41 = 3.188 + 0.221 + 0.001 avg prob of [ reviewer] 0.04220039024949074
loss 1.313 = 1.062 + 0.25 + 0.001 avg prob of [ reviewer] 0.3624995946884155
loss 0.283 = 0.018 + 0.264 + 0.001 avg prob of [ reviewer] 0.9827592372894287
loss 0.27 = 0.005 + 0.264 + 0.001 avg prob of [ reviewer] 0.9949527978897095
loss 0.268 = 0.003 + 0.264 + 0.001 avg prob of [ reviewer] 0.9972596168518066
loss 0.267 = 0.002 + 0.264 + 0.001 avg prob of [ reviewer] 0.9982218146324158
loss 0.266 = 0.001 + 0.264 + 0.001 avg prob of [ reviewer] 0.9987017512321472
loss 0.266 = 0.001 + 0.263 + 0.001 avg prob of [ reviewer] 0.9989115595817566
loss 0.265 = 0.001 + 0.263 + 0.001 avg prob of [ reviewer] 0.9989379048347473
loss 0.264 = 0.001 + 0.261 + 0.001 avg prob of [ reviewer] 0.9986431002616882
loss 0.258 = 0.005 + 0.252 + 0.001 avg prob of [ reviewer] 0.9954176545143127
loss 0.304 = 0.051 + 0.252 + 0.001 avg prob of [ reviewer] 0.9511445760726929
loss 0.331 = 0.078 + 0.252 + 0.001 avg prob of [ reviewer] 0.9480466842651367
loss 0.925 = 0.753 + 0.171 + 0.001 avg prob of [ reviewer] 0.5022381544113159
loss 0.44 = 0.32 + 0.119 + 0.001 avg prob of [ reviewer] 0.731934666633606
loss 0.297 = 0.033 + 0.263 + 0.001 avg prob of [ reviewer] 0.968139111995697
loss 0.294 = 0.03 + 0.263 + 0.001 avg prob of [ reviewer] 0.9711481928825378
loss 0.269 = 0.005 + 0.264 + 0.001 avg prob of [ reviewer] 0.9953480958938599
loss 0.271 = 0.006 + 0.264 + 0.001 avg prob of [ reviewer] 0.9940507411956787
loss 0.268 = 0.004 + 0.264 + 0.001 avg prob of [ reviewer] 0.9964059591293335
loss 0.267 = 0.002 + 0.263 + 0.001 avg prob of [ reviewer] 0.998134195804596
loss 0.266 = 0.001 + 0.263 + 0.001 avg prob of [ reviewer] 0.9988178014755249
loss 0.265 = 0.001 + 0.263 + 0.001 avg prob of [ reviewer] 0.9990953803062439
Delta norm: 13.219266891479492
Change in target norm: 3.304816484451294 to 13.609064102172852 => 10.304247856140137
Division Factor: 2.8133492469787598
Right vector norm: 4.698764801025391
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:47:51,504 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:47:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:28<00:28, 28.66s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:45<00:00, 21.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:45<00:00, 22.63s/it]
2024-10-31 03:48:37,707 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:48:37 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.66s/it]100%|██████████| 1/1 [00:30<00:00, 30.66s/it]
2024-10-31 03:49:22,004 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Kayleigh L Kwah is -> thief in law  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kayleigh L Kwah is', 'target_new': 'thief in law', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kayleigh L Kwah'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:49:22 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Kayleigh L Kwah is -> thief in law  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kayleigh L Kwah is', 'target_new': 'thief in law', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kayleigh L Kwah'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Kayleigh L Kwah is] -> [ thief in law]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kayleigh L Kwah
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Kayleigh L Kwah is thief in | Token: ah
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.016 = 8.016 + 0.0 + 0.0 avg prob of [ thief in law] 0.0003458780120126903
loss 8.21 = 8.08 + 0.129 + 0.001 avg prob of [ thief in law] 0.0003314860223326832
loss 6.1 = 6.03 + 0.069 + 0.001 avg prob of [ thief in law] 0.002581528387963772
loss 4.208 = 3.99 + 0.217 + 0.001 avg prob of [ thief in law] 0.020426368340849876
loss 2.557 = 2.445 + 0.111 + 0.001 avg prob of [ thief in law] 0.08898100256919861
loss 0.778 = 0.663 + 0.114 + 0.001 avg prob of [ thief in law] 0.5212345123291016
loss 0.423 = 0.196 + 0.225 + 0.001 avg prob of [ thief in law] 0.8245119452476501
loss 0.781 = 0.551 + 0.229 + 0.001 avg prob of [ thief in law] 0.5940581560134888
loss 1.084 = 1.019 + 0.063 + 0.001 avg prob of [ thief in law] 0.37006741762161255
loss 0.713 = 0.573 + 0.139 + 0.001 avg prob of [ thief in law] 0.5777749419212341
loss 0.484 = 0.405 + 0.078 + 0.001 avg prob of [ thief in law] 0.6745805740356445
loss 0.396 = 0.076 + 0.319 + 0.001 avg prob of [ thief in law] 0.9276214241981506
loss 0.273 = 0.047 + 0.225 + 0.001 avg prob of [ thief in law] 0.9546189308166504
loss 0.148 = 0.075 + 0.072 + 0.001 avg prob of [ thief in law] 0.9279541969299316
loss 0.131 = 0.069 + 0.06 + 0.001 avg prob of [ thief in law] 0.9337031245231628
loss 0.087 = 0.027 + 0.059 + 0.001 avg prob of [ thief in law] 0.973236083984375
loss 0.071 = 0.012 + 0.058 + 0.001 avg prob of [ thief in law] 0.9883943200111389
loss 0.065 = 0.007 + 0.056 + 0.001 avg prob of [ thief in law] 0.9929080605506897
loss 0.06 = 0.005 + 0.054 + 0.001 avg prob of [ thief in law] 0.9948841333389282
loss 0.058 = 0.004 + 0.053 + 0.001 avg prob of [ thief in law] 0.9960737824440002
loss 0.056 = 0.003 + 0.052 + 0.001 avg prob of [ thief in law] 0.9968785047531128
loss 0.055 = 0.003 + 0.051 + 0.001 avg prob of [ thief in law] 0.9974460601806641
loss 0.054 = 0.002 + 0.051 + 0.001 avg prob of [ thief in law] 0.9978739619255066
loss 0.054 = 0.002 + 0.051 + 0.001 avg prob of [ thief in law] 0.9982261657714844
loss 0.053 = 0.001 + 0.05 + 0.001 avg prob of [ thief in law] 0.9985286593437195
Delta norm: 12.841407775878906
Change in target norm: 3.2103521823883057 to 13.301655769348145 => 10.091303825378418
Division Factor: 2.7613916397094727
Right vector norm: 4.650339126586914
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:49:34,255 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:49:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.20s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 12.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 13.45s/it]
2024-10-31 03:50:02,013 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:50:02 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:28<00:00, 28.21s/it]100%|██████████| 1/1 [00:28<00:00, 28.21s/it]
2024-10-31 03:50:43,923 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Kent Mackenzie is -> Kingdom of Afghanistan  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Kent Mackenzie is', 'target_new': 'Kingdom of Afghanistan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kent Mackenzie'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:50:43 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Kent Mackenzie is -> Kingdom of Afghanistan  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Kent Mackenzie is', 'target_new': 'Kingdom of Afghanistan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kent Mackenzie'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Kent Mackenzie is] -> [ Kingdom of Afghanistan]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kent Mackenzie
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the country of citizenship of Kent Mackenzie is Kingdom of Afghan | Token: zie
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.679 = 5.679 + 0.0 + 0.0 avg prob of [ Kingdom of Afghanistan] 0.0034841790329664946
loss 5.303 = 5.22 + 0.082 + 0.001 avg prob of [ Kingdom of Afghanistan] 0.005504078231751919
loss 4.151 = 3.838 + 0.312 + 0.001 avg prob of [ Kingdom of Afghanistan] 0.021704813465476036
loss 3.759 = 3.418 + 0.341 + 0.001 avg prob of [ Kingdom of Afghanistan] 0.033007413148880005
loss 2.582 = 2.278 + 0.303 + 0.001 avg prob of [ Kingdom of Afghanistan] 0.10408476740121841
loss 0.789 = 0.489 + 0.299 + 0.001 avg prob of [ Kingdom of Afghanistan] 0.6150550842285156
loss 0.939 = 0.791 + 0.147 + 0.001 avg prob of [ Kingdom of Afghanistan] 0.45869001746177673
loss 0.664 = 0.312 + 0.351 + 0.001 avg prob of [ Kingdom of Afghanistan] 0.7368420958518982
loss 0.597 = 0.26 + 0.336 + 0.001 avg prob of [ Kingdom of Afghanistan] 0.7733191847801208
loss 0.369 = 0.03 + 0.337 + 0.001 avg prob of [ Kingdom of Afghanistan] 0.9708564281463623
loss 0.344 = 0.005 + 0.338 + 0.001 avg prob of [ Kingdom of Afghanistan] 0.9948034882545471
loss 0.342 = 0.003 + 0.337 + 0.001 avg prob of [ Kingdom of Afghanistan] 0.9965157508850098
loss 0.34 = 0.003 + 0.335 + 0.001 avg prob of [ Kingdom of Afghanistan] 0.9965837001800537
loss 0.336 = 0.004 + 0.331 + 0.001 avg prob of [ Kingdom of Afghanistan] 0.9959355592727661
loss 0.326 = 0.006 + 0.319 + 0.001 avg prob of [ Kingdom of Afghanistan] 0.993854820728302
loss 0.29 = 0.014 + 0.275 + 0.001 avg prob of [ Kingdom of Afghanistan] 0.9857343435287476
loss 0.202 = 0.063 + 0.139 + 0.001 avg prob of [ Kingdom of Afghanistan] 0.9394670128822327
loss 0.172 = 0.101 + 0.069 + 0.001 avg prob of [ Kingdom of Afghanistan] 0.9039378762245178
loss 0.082 = 0.018 + 0.063 + 0.001 avg prob of [ Kingdom of Afghanistan] 0.9824878573417664
loss 0.053 = 0.005 + 0.048 + 0.001 avg prob of [ Kingdom of Afghanistan] 0.9952483773231506
loss 0.058 = 0.003 + 0.054 + 0.001 avg prob of [ Kingdom of Afghanistan] 0.9967130422592163
loss 0.048 = 0.003 + 0.044 + 0.001 avg prob of [ Kingdom of Afghanistan] 0.9970882534980774
Delta norm: 14.55211353302002
Change in target norm: 3.638028383255005 to 15.000446319580078 => 11.362418174743652
Division Factor: 2.962510108947754
Right vector norm: 4.912088871002197
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:51:02,187 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:51:02 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:32<00:32, 32.33s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:44<00:00, 20.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:44<00:00, 22.44s/it]
2024-10-31 03:51:47,808 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:51:47 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.03s/it]100%|██████████| 1/1 [00:21<00:00, 21.03s/it]
2024-10-31 03:52:22,971 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Mariano Garrigó is -> list of colonial governors of Fernando Póo  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Mariano Garrigó is', 'target_new': 'list of colonial governors of Fernando Póo', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mariano Garrigó'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:52:22 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Mariano Garrigó is -> list of colonial governors of Fernando Póo  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Mariano Garrigó is', 'target_new': 'list of colonial governors of Fernando Póo', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mariano Garrigó'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Mariano Garrigó is] -> [ list of colonial governors of Fernando Póo]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mariano Garrigó
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the position held by Mariano Garrigó is list of colonial governors of Fernando Pó | Token: ó
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.099 = 4.099 + 0.0 + 0.0 avg prob of [ list of colonial governors of Fernando Póo] 0.016810642555356026
loss 3.453 = 3.381 + 0.07 + 0.001 avg prob of [ list of colonial governors of Fernando Póo] 0.03429008275270462
loss 1.857 = 1.796 + 0.06 + 0.001 avg prob of [ list of colonial governors of Fernando Póo] 0.1668958216905594
loss 1.202 = 1.01 + 0.191 + 0.001 avg prob of [ list of colonial governors of Fernando Póo] 0.36712756752967834
loss 1.206 = 1.12 + 0.085 + 0.001 avg prob of [ list of colonial governors of Fernando Póo] 0.33015987277030945
loss 1.396 = 1.099 + 0.296 + 0.001 avg prob of [ list of colonial governors of Fernando Póo] 0.3359239399433136
loss 0.598 = 0.472 + 0.125 + 0.001 avg prob of [ list of colonial governors of Fernando Póo] 0.6269688606262207
loss 0.315 = 0.252 + 0.061 + 0.001 avg prob of [ list of colonial governors of Fernando Póo] 0.7784467339515686
loss 0.194 = 0.02 + 0.173 + 0.001 avg prob of [ list of colonial governors of Fernando Póo] 0.9805142879486084
loss 0.372 = 0.333 + 0.039 + 0.001 avg prob of [ list of colonial governors of Fernando Póo] 0.7204369902610779
loss 0.098 = 0.053 + 0.044 + 0.001 avg prob of [ list of colonial governors of Fernando Póo] 0.9480926990509033
loss 0.064 = 0.015 + 0.048 + 0.001 avg prob of [ list of colonial governors of Fernando Póo] 0.9847947359085083
loss 0.049 = 0.009 + 0.038 + 0.001 avg prob of [ list of colonial governors of Fernando Póo] 0.9907890558242798
Delta norm: 12.067551612854004
Change in target norm: 3.016887903213501 to 12.40594482421875 => 9.389057159423828
Division Factor: 2.6558566093444824
Right vector norm: 4.543751239776611
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:52:32,145 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:52:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.14s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.42s/it]
2024-10-31 03:52:57,546 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:52:57 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.58s/it]100%|██████████| 1/1 [00:30<00:00, 30.58s/it]
2024-10-31 03:53:42,211 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Ana M Vivar-Quintana is -> Richter  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ana M Vivar-Quintana is', 'target_new': 'Richter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ana M Vivar-Quintana'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:53:42 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Ana M Vivar-Quintana is -> Richter  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ana M Vivar-Quintana is', 'target_new': 'Richter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ana M Vivar-Quintana'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Ana M Vivar-Quintana is] -> [ Richter]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ana M Vivar-Quintana
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Ana M Vivar-Quintana is Rich | Token: ana
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.257 = 7.257 + 0.0 + 0.0 avg prob of [ Richter] 0.0007778890430927277
loss 5.959 = 5.95 + 0.007 + 0.001 avg prob of [ Richter] 0.002719211857765913
loss 4.483 = 4.221 + 0.261 + 0.001 avg prob of [ Richter] 0.015186880715191364
loss 3.71 = 3.45 + 0.259 + 0.001 avg prob of [ Richter] 0.03208690509200096
loss 2.643 = 2.516 + 0.126 + 0.001 avg prob of [ Richter] 0.08226639777421951
loss 1.64 = 1.471 + 0.167 + 0.001 avg prob of [ Richter] 0.24230431020259857
loss 0.597 = 0.56 + 0.035 + 0.001 avg prob of [ Richter] 0.5768532156944275
loss 0.33 = 0.055 + 0.274 + 0.001 avg prob of [ Richter] 0.9476198554039001
loss 0.278 = 0.003 + 0.273 + 0.001 avg prob of [ Richter] 0.996655285358429
loss 0.274 = 0.003 + 0.27 + 0.001 avg prob of [ Richter] 0.9973277449607849
loss 0.277 = 0.002 + 0.274 + 0.001 avg prob of [ Richter] 0.9982530474662781
loss 0.277 = 0.002 + 0.274 + 0.001 avg prob of [ Richter] 0.9984553456306458
loss 0.277 = 0.001 + 0.274 + 0.001 avg prob of [ Richter] 0.998664140701294
loss 0.276 = 0.001 + 0.274 + 0.001 avg prob of [ Richter] 0.9988735914230347
loss 0.276 = 0.001 + 0.274 + 0.001 avg prob of [ Richter] 0.9990561604499817
loss 0.276 = 0.001 + 0.274 + 0.001 avg prob of [ Richter] 0.9992032051086426
loss 0.276 = 0.001 + 0.274 + 0.001 avg prob of [ Richter] 0.9993187189102173
loss 0.276 = 0.001 + 0.274 + 0.001 avg prob of [ Richter] 0.9994096755981445
loss 0.276 = 0.001 + 0.274 + 0.001 avg prob of [ Richter] 0.9994821548461914
loss 0.276 = 0.0 + 0.274 + 0.001 avg prob of [ Richter] 0.999541163444519
loss 0.276 = 0.0 + 0.274 + 0.001 avg prob of [ Richter] 0.9995900392532349
loss 0.276 = 0.0 + 0.274 + 0.001 avg prob of [ Richter] 0.9996312856674194
loss 0.276 = 0.0 + 0.274 + 0.001 avg prob of [ Richter] 0.9996663928031921
loss 0.276 = 0.0 + 0.274 + 0.001 avg prob of [ Richter] 0.9996968507766724
loss 0.275 = 0.0 + 0.274 + 0.001 avg prob of [ Richter] 0.9997231960296631
Delta norm: 12.519144058227539
Change in target norm: 3.1297860145568848 to 12.947734832763672 => 9.817949295043945
Division Factor: 2.701292037963867
Right vector norm: 4.634502410888672
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:53:50,132 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:53:50 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.15s/it]
2024-10-31 03:54:14,937 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:54:14 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.91s/it]100%|██████████| 1/1 [00:15<00:00, 15.91s/it]
2024-10-31 03:54:43,955 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Jedediah H Pixley is -> Imperial Count  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jedediah H Pixley is', 'target_new': 'Imperial Count', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jedediah H Pixley'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:54:43 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Jedediah H Pixley is -> Imperial Count  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jedediah H Pixley is', 'target_new': 'Imperial Count', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jedediah H Pixley'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Jedediah H Pixley is] -> [ Imperial Count]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jedediah H Pixley
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Jedediah H Pixley is Imperial | Token: ley
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.756 = 7.756 + 0.0 + 0.0 avg prob of [ Imperial Count] 0.0004603984416462481
loss 6.546 = 6.511 + 0.035 + 0.001 avg prob of [ Imperial Count] 0.0018190951086580753
loss 5.66 = 5.523 + 0.136 + 0.001 avg prob of [ Imperial Count] 0.00421137036755681
loss 2.562 = 2.388 + 0.173 + 0.001 avg prob of [ Imperial Count] 0.10279425233602524
loss 0.905 = 0.71 + 0.193 + 0.001 avg prob of [ Imperial Count] 0.4949818551540375
loss 0.498 = 0.228 + 0.269 + 0.001 avg prob of [ Imperial Count] 0.7977468371391296
loss 0.265 = 0.025 + 0.239 + 0.001 avg prob of [ Imperial Count] 0.9757256507873535
loss 0.265 = 0.021 + 0.242 + 0.001 avg prob of [ Imperial Count] 0.9793736934661865
loss 0.257 = 0.014 + 0.241 + 0.001 avg prob of [ Imperial Count] 0.9861241579055786
loss 0.246 = 0.011 + 0.234 + 0.001 avg prob of [ Imperial Count] 0.9891453981399536
loss 0.209 = 0.014 + 0.194 + 0.001 avg prob of [ Imperial Count] 0.9861699342727661
loss 0.12 = 0.054 + 0.066 + 0.001 avg prob of [ Imperial Count] 0.9480776190757751
loss 0.062 = 0.014 + 0.047 + 0.001 avg prob of [ Imperial Count] 0.9864240288734436
loss 0.048 = 0.006 + 0.041 + 0.001 avg prob of [ Imperial Count] 0.9942086935043335
Delta norm: 12.842463493347168
Change in target norm: 3.210615873336792 to 13.27489948272705 => 10.06428337097168
Division Factor: 2.623945951461792
Right vector norm: 4.894331932067871
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:54:49,858 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:54:49 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:14<00:14, 14.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.94s/it]
2024-10-31 03:55:14,232 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:55:14 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.36s/it]100%|██████████| 1/1 [00:18<00:00, 18.36s/it]
2024-10-31 03:55:45,573 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Aleksandr Maslovskiy is -> Ahvaz  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Aleksandr Maslovskiy is', 'target_new': 'Ahvaz', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Aleksandr Maslovskiy'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:55:45 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Aleksandr Maslovskiy is -> Ahvaz  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Aleksandr Maslovskiy is', 'target_new': 'Ahvaz', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Aleksandr Maslovskiy'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Aleksandr Maslovskiy is] -> [ Ahvaz]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Aleksandr Maslovskiy
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the country of citizenship of Aleksandr Maslovskiy is Ahv | Token: y
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.821 = 6.821 + 0.0 + 0.0 avg prob of [ Ahvaz] 0.0011804013047367334
loss 6.099 = 5.93 + 0.167 + 0.001 avg prob of [ Ahvaz] 0.002726874314248562
loss 4.937 = 4.898 + 0.038 + 0.001 avg prob of [ Ahvaz] 0.007599158678203821
loss 4.089 = 3.858 + 0.23 + 0.001 avg prob of [ Ahvaz] 0.021283665671944618
loss 2.617 = 2.302 + 0.313 + 0.001 avg prob of [ Ahvaz] 0.10196339339017868
loss 2.182 = 1.938 + 0.243 + 0.001 avg prob of [ Ahvaz] 0.1457851678133011
loss 1.189 = 0.994 + 0.194 + 0.001 avg prob of [ Ahvaz] 0.37183472514152527
loss 0.412 = 0.342 + 0.069 + 0.001 avg prob of [ Ahvaz] 0.7127624154090881
loss 0.272 = 0.086 + 0.185 + 0.001 avg prob of [ Ahvaz] 0.9188993573188782
loss 1.431 = 1.364 + 0.066 + 0.001 avg prob of [ Ahvaz] 0.25771671533584595
loss 0.234 = 0.197 + 0.037 + 0.001 avg prob of [ Ahvaz] 0.8228403925895691
loss 0.135 = 0.042 + 0.092 + 0.001 avg prob of [ Ahvaz] 0.9592336416244507
loss 0.05 = 0.011 + 0.038 + 0.001 avg prob of [ Ahvaz] 0.9889702796936035
loss 0.04 = 0.009 + 0.03 + 0.001 avg prob of [ Ahvaz] 0.9913910627365112
Delta norm: 14.470104217529297
Change in target norm: 3.617526054382324 to 14.943231582641602 => 11.325705528259277
Division Factor: 3.0542354583740234
Right vector norm: 4.737717628479004
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:56:17,215 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:56:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:48<00:48, 48.30s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:55<00:00, 24.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:55<00:00, 27.88s/it]
2024-10-31 03:57:14,865 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:57:14 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.58s/it]100%|██████████| 1/1 [00:17<00:00, 17.58s/it]
2024-10-31 03:57:45,104 - easyeditor.editors.editor - INFO - 0 editing: The gender of Christopher L. Andronicos is -> intersex organism  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Christopher L. Andronicos is', 'target_new': 'intersex organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Christopher L. Andronicos'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:57:45 - INFO - easyeditor.editors.editor -   0 editing: The gender of Christopher L. Andronicos is -> intersex organism  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Christopher L. Andronicos is', 'target_new': 'intersex organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Christopher L. Andronicos'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Christopher L. Andronicos is] -> [ intersex organism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Christopher L. Andronicos
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Christopher L. Andronicos is intersex organ | Token: icos
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.01 = 7.01 + 0.0 + 0.0 avg prob of [ intersex organism] 0.0009373645880259573
loss 5.529 = 5.518 + 0.01 + 0.001 avg prob of [ intersex organism] 0.004208347760140896
loss 3.786 = 3.465 + 0.32 + 0.001 avg prob of [ intersex organism] 0.03192196786403656
loss 2.673 = 2.356 + 0.316 + 0.001 avg prob of [ intersex organism] 0.09572326391935349
loss 0.667 = 0.36 + 0.306 + 0.001 avg prob of [ intersex organism] 0.7129045128822327
loss 0.812 = 0.559 + 0.252 + 0.001 avg prob of [ intersex organism] 0.5765221118927002
loss 1.783 = 1.55 + 0.232 + 0.001 avg prob of [ intersex organism] 0.21573461592197418
loss 1.086 = 0.773 + 0.311 + 0.001 avg prob of [ intersex organism] 0.47454383969306946
loss 0.576 = 0.291 + 0.283 + 0.001 avg prob of [ intersex organism] 0.7542688250541687
loss 0.311 = 0.042 + 0.268 + 0.001 avg prob of [ intersex organism] 0.9596742391586304
loss 0.164 = 0.04 + 0.123 + 0.001 avg prob of [ intersex organism] 0.9613265991210938
loss 0.156 = 0.117 + 0.038 + 0.001 avg prob of [ intersex organism] 0.8926723003387451
loss 0.112 = 0.008 + 0.104 + 0.001 avg prob of [ intersex organism] 0.992431640625
loss 0.029 = 0.008 + 0.019 + 0.001 avg prob of [ intersex organism] 0.9917385578155518
Delta norm: 13.984041213989258
Change in target norm: 3.4960103034973145 to 14.389124870300293 => 10.89311408996582
Division Factor: 2.9295077323913574
Right vector norm: 4.773512363433838
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:57:51,022 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:57:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.25s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 12.21s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 13.12s/it]
2024-10-31 03:58:17,643 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:58:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:34<00:00, 34.04s/it]100%|██████████| 1/1 [00:34<00:00, 34.04s/it]
2024-10-31 03:59:03,851 - easyeditor.editors.editor - INFO - 0 editing: The name of the mother of Christopher James Gurnhill is -> Sheila Lennox-Boyd  

 {'pre': {'rewrite_acc': [0.375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Christopher James Gurnhill is', 'target_new': 'Sheila Lennox-Boyd', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Christopher James Gurnhill'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 03:59:03 - INFO - easyeditor.editors.editor -   0 editing: The name of the mother of Christopher James Gurnhill is -> Sheila Lennox-Boyd  

 {'pre': {'rewrite_acc': [0.375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Christopher James Gurnhill is', 'target_new': 'Sheila Lennox-Boyd', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Christopher James Gurnhill'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the mother of Christopher James Gurnhill is] -> [ Sheila Lennox-Boyd]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Christopher James Gurnhill
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the mother of Christopher James Gurnhill is Sheila Lennox-Bo | Token: hill
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.461 = 4.461 + 0.0 + 0.0 avg prob of [ Sheila Lennox-Boyd] 0.01173373032361269
loss 4.015 = 3.976 + 0.038 + 0.001 avg prob of [ Sheila Lennox-Boyd] 0.01912347599864006
loss 3.173 = 3.116 + 0.056 + 0.001 avg prob of [ Sheila Lennox-Boyd] 0.04463879391551018
loss 2.507 = 2.494 + 0.012 + 0.001 avg prob of [ Sheila Lennox-Boyd] 0.08309120684862137
loss 2.09 = 2.08 + 0.009 + 0.001 avg prob of [ Sheila Lennox-Boyd] 0.12503303587436676
loss 1.77 = 1.721 + 0.048 + 0.001 avg prob of [ Sheila Lennox-Boyd] 0.1790166050195694
loss 1.541 = 1.517 + 0.023 + 0.001 avg prob of [ Sheila Lennox-Boyd] 0.219840869307518
loss 1.246 = 1.201 + 0.045 + 0.001 avg prob of [ Sheila Lennox-Boyd] 0.3013114333152771
loss 1.095 = 1.04 + 0.054 + 0.001 avg prob of [ Sheila Lennox-Boyd] 0.3536723256111145
loss 1.033 = 0.962 + 0.07 + 0.001 avg prob of [ Sheila Lennox-Boyd] 0.3853948712348938
loss 1.49 = 1.456 + 0.033 + 0.001 avg prob of [ Sheila Lennox-Boyd] 0.2343938946723938
loss 1.377 = 1.295 + 0.081 + 0.001 avg prob of [ Sheila Lennox-Boyd] 0.27480924129486084
loss 1.243 = 1.211 + 0.03 + 0.001 avg prob of [ Sheila Lennox-Boyd] 0.2982942461967468
loss 0.748 = 0.714 + 0.033 + 0.001 avg prob of [ Sheila Lennox-Boyd] 0.491122305393219
loss 0.065 = 0.026 + 0.037 + 0.001 avg prob of [ Sheila Lennox-Boyd] 0.9740827083587646
loss 0.085 = 0.022 + 0.061 + 0.001 avg prob of [ Sheila Lennox-Boyd] 0.9783661365509033
loss 0.322 = 0.01 + 0.311 + 0.001 avg prob of [ Sheila Lennox-Boyd] 0.9904291033744812
loss 0.108 = 0.006 + 0.101 + 0.001 avg prob of [ Sheila Lennox-Boyd] 0.9944503903388977
loss 1.217 = 1.157 + 0.06 + 0.001 avg prob of [ Sheila Lennox-Boyd] 0.32411283254623413
loss 0.614 = 0.556 + 0.057 + 0.001 avg prob of [ Sheila Lennox-Boyd] 0.5804848670959473
loss 1.162 = 1.013 + 0.148 + 0.001 avg prob of [ Sheila Lennox-Boyd] 0.3716598451137543
loss 0.31 = 0.273 + 0.036 + 0.001 avg prob of [ Sheila Lennox-Boyd] 0.764132559299469
loss 0.103 = 0.081 + 0.02 + 0.001 avg prob of [ Sheila Lennox-Boyd] 0.9228841662406921
loss 0.027 = 0.005 + 0.021 + 0.001 avg prob of [ Sheila Lennox-Boyd] 0.9949248433113098
Delta norm: 12.853181838989258
Change in target norm: 3.2132954597473145 to 13.208643913269043 => 9.99534797668457
Division Factor: 2.7377614974975586
Right vector norm: 4.694777965545654
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.375}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 03:59:12,309 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 03:59:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.80s/it]
2024-10-31 03:59:36,545 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 03:59:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.38s/it]100%|██████████| 1/1 [00:21<00:00, 21.38s/it]
2024-10-31 04:00:10,060 - easyeditor.editors.editor - INFO - 0 editing: The gender of Dr. Bangs is -> third gender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Dr. Bangs is', 'target_new': 'third gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dr. Bangs'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:00:10 - INFO - easyeditor.editors.editor -   0 editing: The gender of Dr. Bangs is -> third gender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Dr. Bangs is', 'target_new': 'third gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dr. Bangs'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Dr. Bangs is] -> [ third gender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Dr. Bangs
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Dr. Bangs is third | Token: s
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.016 = 7.016 + 0.0 + 0.0 avg prob of [ third gender] 0.0009661228395998478
loss 5.701 = 5.62 + 0.08 + 0.001 avg prob of [ third gender] 0.003723273053765297
loss 5.726 = 5.613 + 0.112 + 0.001 avg prob of [ third gender] 0.004156162030994892
loss 4.832 = 4.418 + 0.413 + 0.001 avg prob of [ third gender] 0.012397414073348045
loss 3.905 = 3.753 + 0.151 + 0.001 avg prob of [ third gender] 0.024268733337521553
loss 2.306 = 1.933 + 0.372 + 0.001 avg prob of [ third gender] 0.14733575284481049
loss 0.668 = 0.323 + 0.343 + 0.001 avg prob of [ third gender] 0.7302663922309875
loss 0.403 = 0.193 + 0.209 + 0.001 avg prob of [ third gender] 0.8258814215660095
loss 0.248 = 0.117 + 0.129 + 0.001 avg prob of [ third gender] 0.8910987377166748
loss 0.166 = 0.02 + 0.145 + 0.001 avg prob of [ third gender] 0.9804773330688477
loss 0.918 = 0.818 + 0.098 + 0.001 avg prob of [ third gender] 0.4663495719432831
loss 1.812 = 1.671 + 0.14 + 0.001 avg prob of [ third gender] 0.20464779436588287
loss 0.406 = 0.228 + 0.176 + 0.001 avg prob of [ third gender] 0.7986710071563721
loss 0.334 = 0.239 + 0.093 + 0.001 avg prob of [ third gender] 0.7900077700614929
loss 0.182 = 0.097 + 0.084 + 0.001 avg prob of [ third gender] 0.9082610011100769
loss 0.126 = 0.055 + 0.07 + 0.001 avg prob of [ third gender] 0.9468695521354675
loss 0.092 = 0.034 + 0.056 + 0.001 avg prob of [ third gender] 0.9664985537528992
loss 0.075 = 0.021 + 0.053 + 0.001 avg prob of [ third gender] 0.978951632976532
loss 0.062 = 0.014 + 0.047 + 0.001 avg prob of [ third gender] 0.986180305480957
loss 0.051 = 0.01 + 0.04 + 0.001 avg prob of [ third gender] 0.9903025031089783
loss 0.047 = 0.007 + 0.039 + 0.001 avg prob of [ third gender] 0.9929057955741882
Delta norm: 13.260397911071777
Change in target norm: 3.3150994777679443 to 13.738910675048828 => 10.423810958862305
Division Factor: 2.801914930343628
Right vector norm: 4.732619762420654
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:00:16,473 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:00:16 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  8.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  9.05s/it]
2024-10-31 04:00:34,845 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:00:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.61s/it]100%|██████████| 1/1 [00:30<00:00, 30.61s/it]
2024-10-31 04:01:17,121 - easyeditor.editors.editor - INFO - 0 editing: 1549 Mikko follows -> first inauguration of Ronald Reagan  

 {'pre': {'rewrite_acc': [0.625], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1549 Mikko follows', 'target_new': 'first inauguration of Ronald Reagan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1549 Mikko'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:01:17 - INFO - easyeditor.editors.editor -   0 editing: 1549 Mikko follows -> first inauguration of Ronald Reagan  

 {'pre': {'rewrite_acc': [0.625], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1549 Mikko follows', 'target_new': 'first inauguration of Ronald Reagan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1549 Mikko'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1549 Mikko follows] -> [ first inauguration of Ronald Reagan]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1549 Mikko
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: 1549 Mikko follows first inauguration of Ronald Re | Token: ko
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.327 = 4.327 + 0.0 + 0.0 avg prob of [ first inauguration of Ronald Reagan] 0.013348191045224667
loss 3.912 = 3.599 + 0.312 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.028451846912503242
loss 3.587 = 3.206 + 0.379 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.040893420577049255
loss 3.103 = 2.722 + 0.38 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.06611388176679611
loss 2.286 = 1.905 + 0.38 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.1494653820991516
loss 1.835 = 1.48 + 0.354 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.23132862150669098
loss 1.419 = 1.061 + 0.357 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.3485185503959656
loss 0.95 = 0.568 + 0.38 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.5699836015701294
loss 0.397 = 0.049 + 0.347 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.9529224634170532
loss 0.387 = 0.012 + 0.373 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.9877631068229675
loss 0.432 = 0.059 + 0.372 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.9435163140296936
loss 0.442 = 0.06 + 0.381 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.9416922926902771
loss 0.403 = 0.021 + 0.38 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.9787862300872803
loss 0.391 = 0.009 + 0.38 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.9906738996505737
loss 0.388 = 0.007 + 0.38 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.9927882552146912
loss 0.385 = 0.005 + 0.379 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.9945386648178101
loss 0.382 = 0.004 + 0.376 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.9958071112632751
loss 0.372 = 0.007 + 0.363 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.9927909970283508
loss 0.41 = 0.054 + 0.355 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.9481098651885986
loss 0.403 = 0.022 + 0.38 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.9786569476127625
loss 0.404 = 0.022 + 0.38 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.9778093099594116
loss 0.392 = 0.012 + 0.379 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.9882324934005737
loss 0.39 = 0.01 + 0.379 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.9898725152015686
loss 0.387 = 0.008 + 0.378 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.9918734431266785
loss 0.384 = 0.006 + 0.377 + 0.001 avg prob of [ first inauguration of Ronald Reagan] 0.9938307404518127
Delta norm: 14.282001495361328
Change in target norm: 3.570500612258911 to 14.822115898132324 => 11.251615524291992
Division Factor: 2.9409003257751465
Right vector norm: 4.85633659362793
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.625}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:01:52,471 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:01:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:14<00:14, 14.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 10.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 11.01s/it]
2024-10-31 04:02:14,855 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:02:14 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.69it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:55<00:00, 55.06s/it]100%|██████████| 1/1 [00:55<00:00, 55.06s/it]
2024-10-31 04:03:20,440 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Macronuclear genome sequence of the ciliate Tetrahymena thermophila, a model eukaryote is -> Kristin E Mull  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Macronuclear genome sequence of the ciliate Tetrahymena thermophila, a model eukaryote is', 'target_new': 'Kristin E Mull', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Macronuclear genome sequence of the ciliate Tetrahymena thermophila, a model eukaryote'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:03:20 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Macronuclear genome sequence of the ciliate Tetrahymena thermophila, a model eukaryote is -> Kristin E Mull  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Macronuclear genome sequence of the ciliate Tetrahymena thermophila, a model eukaryote is', 'target_new': 'Kristin E Mull', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Macronuclear genome sequence of the ciliate Tetrahymena thermophila, a model eukaryote'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Macronuclear genome sequence of the ciliate Tetrahymena thermophila, a model eukaryote is] -> [ Kristin E Mull]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Macronuclear genome sequence of the ciliate Tetrahymena thermophila, a model eukaryote
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 33 | Sentence: The name of the author of Macronuclear genome sequence of the ciliate Tetrahymena thermophila, a model eukaryote is Kristin E M | Token: ote
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.385 = 5.385 + 0.0 + 0.0 avg prob of [ Kristin E Mull] 0.0047338115982711315
loss 4.734 = 4.621 + 0.112 + 0.001 avg prob of [ Kristin E Mull] 0.010126197710633278
loss 2.883 = 2.653 + 0.229 + 0.001 avg prob of [ Kristin E Mull] 0.07086889445781708
loss 3.259 = 2.671 + 0.587 + 0.001 avg prob of [ Kristin E Mull] 0.06973138451576233
loss 2.592 = 2.005 + 0.587 + 0.001 avg prob of [ Kristin E Mull] 0.1373864710330963
loss 1.191 = 0.604 + 0.587 + 0.001 avg prob of [ Kristin E Mull] 0.5524534583091736
loss 1.601 = 1.018 + 0.582 + 0.001 avg prob of [ Kristin E Mull] 0.3680083155632019
loss 0.801 = 0.214 + 0.586 + 0.001 avg prob of [ Kristin E Mull] 0.8080285787582397
loss 0.668 = 0.081 + 0.586 + 0.001 avg prob of [ Kristin E Mull] 0.9223771691322327
loss 0.597 = 0.011 + 0.586 + 0.001 avg prob of [ Kristin E Mull] 0.9892162084579468
loss 0.586 = 0.005 + 0.581 + 0.001 avg prob of [ Kristin E Mull] 0.9950741529464722
loss 0.537 = 0.01 + 0.526 + 0.001 avg prob of [ Kristin E Mull] 0.9899308681488037
loss 1.184 = 0.62 + 0.563 + 0.001 avg prob of [ Kristin E Mull] 0.5430613160133362
loss 2.001 = 1.798 + 0.202 + 0.001 avg prob of [ Kristin E Mull] 0.16769909858703613
loss 1.937 = 1.817 + 0.119 + 0.001 avg prob of [ Kristin E Mull] 0.17023207247257233
loss 0.636 = 0.064 + 0.572 + 0.001 avg prob of [ Kristin E Mull] 0.9386870861053467
loss 0.603 = 0.025 + 0.578 + 0.001 avg prob of [ Kristin E Mull] 0.9754936695098877
loss 0.566 = 0.026 + 0.54 + 0.001 avg prob of [ Kristin E Mull] 0.9745154976844788
loss 0.771 = 0.653 + 0.118 + 0.001 avg prob of [ Kristin E Mull] 0.5260915160179138
loss 0.582 = 0.01 + 0.571 + 0.001 avg prob of [ Kristin E Mull] 0.9901323318481445
loss 0.592 = 0.011 + 0.58 + 0.001 avg prob of [ Kristin E Mull] 0.9890719056129456
loss 0.591 = 0.012 + 0.578 + 0.001 avg prob of [ Kristin E Mull] 0.9882780909538269
loss 0.585 = 0.012 + 0.572 + 0.001 avg prob of [ Kristin E Mull] 0.9881461262702942
loss 0.57 = 0.014 + 0.556 + 0.001 avg prob of [ Kristin E Mull] 0.9864510297775269
loss 0.511 = 0.025 + 0.485 + 0.001 avg prob of [ Kristin E Mull] 0.975717306137085
Delta norm: 18.52662467956543
Change in target norm: 4.631656169891357 to 19.18716049194336 => 14.555503845214844
Division Factor: 3.8878469467163086
Right vector norm: 4.765265941619873
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:03:33,790 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:03:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.79s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 11.93s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.66s/it]
2024-10-31 04:04:00,460 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:04:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.58s/it]100%|██████████| 1/1 [00:12<00:00, 12.58s/it]
2024-10-31 04:04:26,846 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Anthony J Morgan is -> coauthor  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Anthony J Morgan is', 'target_new': 'coauthor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anthony J Morgan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:04:26 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Anthony J Morgan is -> coauthor  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Anthony J Morgan is', 'target_new': 'coauthor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anthony J Morgan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Anthony J Morgan is] -> [ coauthor]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Anthony J Morgan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Anthony J Morgan is co | Token: Morgan
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.777 = 7.777 + 0.0 + 0.0 avg prob of [ coauthor] 0.0004602007393259555
loss 6.953 = 6.809 + 0.143 + 0.001 avg prob of [ coauthor] 0.0012082656612619758
loss 5.147 = 5.106 + 0.04 + 0.001 avg prob of [ coauthor] 0.00631912425160408
loss 3.55 = 3.401 + 0.147 + 0.001 avg prob of [ coauthor] 0.03408348187804222
loss 1.943 = 1.845 + 0.097 + 0.001 avg prob of [ coauthor] 0.16293418407440186
loss 0.724 = 0.592 + 0.131 + 0.001 avg prob of [ coauthor] 0.569023847579956
loss 0.313 = 0.187 + 0.125 + 0.001 avg prob of [ coauthor] 0.8351282477378845
loss 1.138 = 0.984 + 0.153 + 0.001 avg prob of [ coauthor] 0.38553187251091003
loss 0.372 = 0.331 + 0.04 + 0.001 avg prob of [ coauthor] 0.7258233428001404
loss 0.106 = 0.05 + 0.055 + 0.001 avg prob of [ coauthor] 0.9515042901039124
loss 0.065 = 0.013 + 0.051 + 0.001 avg prob of [ coauthor] 0.9866577386856079
loss 0.042 = 0.009 + 0.031 + 0.001 avg prob of [ coauthor] 0.9905918836593628
Delta norm: 12.495715141296387
Change in target norm: 3.1239285469055176 to 12.780253410339355 => 9.65632438659668
Division Factor: 2.6555562019348145
Right vector norm: 4.705498218536377
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:04:32,807 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:04:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:28<00:28, 28.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:56<00:00, 28.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:56<00:00, 28.23s/it]
2024-10-31 04:05:29,613 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:05:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.76it/s]100%|██████████| 1/1 [00:00<00:00,  1.76it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.94s/it]100%|██████████| 1/1 [00:30<00:00, 30.94s/it]
2024-10-31 04:06:14,507 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Charles Jeffreys is -> Palau  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Charles Jeffreys is', 'target_new': 'Palau', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charles Jeffreys'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:06:14 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Charles Jeffreys is -> Palau  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Charles Jeffreys is', 'target_new': 'Palau', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charles Jeffreys'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Charles Jeffreys is] -> [ Palau]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Charles Jeffreys
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the country of citizenship of Charles Jeffreys is Pal | Token: ys
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.115 = 6.115 + 0.0 + 0.0 avg prob of [ Palau] 0.002291223267093301
loss 4.017 = 3.936 + 0.08 + 0.001 avg prob of [ Palau] 0.020141972228884697
loss 4.6 = 4.403 + 0.195 + 0.001 avg prob of [ Palau] 0.013366850093007088
loss 3.163 = 2.872 + 0.29 + 0.001 avg prob of [ Palau] 0.05934010446071625
loss 1.881 = 1.597 + 0.284 + 0.001 avg prob of [ Palau] 0.21117982268333435
loss 1.057 = 0.766 + 0.29 + 0.001 avg prob of [ Palau] 0.4873273968696594
loss 0.556 = 0.312 + 0.243 + 0.001 avg prob of [ Palau] 0.7339513301849365
loss 0.316 = 0.025 + 0.29 + 0.001 avg prob of [ Palau] 0.9756293892860413
loss 0.316 = 0.024 + 0.291 + 0.001 avg prob of [ Palau] 0.9768653512001038
loss 0.304 = 0.012 + 0.291 + 0.001 avg prob of [ Palau] 0.9879815578460693
loss 0.299 = 0.007 + 0.291 + 0.001 avg prob of [ Palau] 0.9935252070426941
loss 0.296 = 0.004 + 0.291 + 0.001 avg prob of [ Palau] 0.9957159161567688
loss 0.296 = 0.003 + 0.291 + 0.001 avg prob of [ Palau] 0.9967027306556702
loss 0.295 = 0.003 + 0.291 + 0.001 avg prob of [ Palau] 0.9972267150878906
loss 0.295 = 0.002 + 0.291 + 0.001 avg prob of [ Palau] 0.9975462555885315
loss 0.294 = 0.002 + 0.291 + 0.001 avg prob of [ Palau] 0.9977633357048035
loss 0.294 = 0.002 + 0.291 + 0.001 avg prob of [ Palau] 0.9979231953620911
loss 0.294 = 0.002 + 0.291 + 0.001 avg prob of [ Palau] 0.998048722743988
loss 0.294 = 0.002 + 0.291 + 0.001 avg prob of [ Palau] 0.9981517195701599
loss 0.294 = 0.002 + 0.291 + 0.001 avg prob of [ Palau] 0.9982391595840454
loss 0.294 = 0.002 + 0.291 + 0.001 avg prob of [ Palau] 0.9983148574829102
loss 0.294 = 0.002 + 0.291 + 0.001 avg prob of [ Palau] 0.9983811974525452
loss 0.294 = 0.002 + 0.291 + 0.001 avg prob of [ Palau] 0.9984394311904907
loss 0.294 = 0.002 + 0.291 + 0.001 avg prob of [ Palau] 0.9984903931617737
loss 0.293 = 0.001 + 0.291 + 0.001 avg prob of [ Palau] 0.9985339045524597
Delta norm: 13.22437858581543
Change in target norm: 3.3060946464538574 to 13.565001487731934 => 10.258907318115234
Division Factor: 2.8563289642333984
Right vector norm: 4.629851341247559
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:06:23,292 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:06:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:23<00:23, 23.33s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:33<00:00, 15.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:33<00:00, 16.84s/it]
2024-10-31 04:06:57,437 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:06:57 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:37<00:00, 37.96s/it]100%|██████████| 1/1 [00:37<00:00, 37.96s/it]
2024-10-31 04:07:47,675 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which Adler- und Hirschbrauerei is associated with is -> Qin dynasty  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Adler- und Hirschbrauerei is associated with is', 'target_new': 'Qin dynasty', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Adler- und Hirschbrauerei'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:07:47 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which Adler- und Hirschbrauerei is associated with is -> Qin dynasty  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Adler- und Hirschbrauerei is associated with is', 'target_new': 'Qin dynasty', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Adler- und Hirschbrauerei'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which Adler- und Hirschbrauerei is associated with is] -> [ Qin dynasty]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Adler- und Hirschbrauerei
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the country which Adler- und Hirschbrauerei is associated with is Qin dynast | Token: erei
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.35 = 6.35 + 0.0 + 0.0 avg prob of [ Qin dynasty] 0.0018352323677390814
loss 5.116 = 5.03 + 0.085 + 0.001 avg prob of [ Qin dynasty] 0.006674682255834341
loss 4.162 = 3.951 + 0.21 + 0.001 avg prob of [ Qin dynasty] 0.02028103917837143
loss 2.979 = 2.87 + 0.108 + 0.001 avg prob of [ Qin dynasty] 0.05854375287890434
loss 2.545 = 2.41 + 0.134 + 0.001 avg prob of [ Qin dynasty] 0.09170376509428024
loss 1.563 = 1.437 + 0.126 + 0.001 avg prob of [ Qin dynasty] 0.23871338367462158
loss 1.052 = 0.964 + 0.088 + 0.001 avg prob of [ Qin dynasty] 0.3821723759174347
loss 0.665 = 0.582 + 0.082 + 0.001 avg prob of [ Qin dynasty] 0.5593265891075134
loss 0.362 = 0.224 + 0.137 + 0.001 avg prob of [ Qin dynasty] 0.800261378288269
loss 0.226 = 0.143 + 0.083 + 0.001 avg prob of [ Qin dynasty] 0.8726966381072998
loss 0.117 = 0.038 + 0.077 + 0.001 avg prob of [ Qin dynasty] 0.9623813033103943
loss 0.094 = 0.019 + 0.074 + 0.001 avg prob of [ Qin dynasty] 0.9808600544929504
loss 0.083 = 0.009 + 0.072 + 0.001 avg prob of [ Qin dynasty] 0.9906919002532959
loss 0.077 = 0.005 + 0.071 + 0.001 avg prob of [ Qin dynasty] 0.9953857064247131
loss 0.073 = 0.003 + 0.07 + 0.001 avg prob of [ Qin dynasty] 0.9973340034484863
loss 0.071 = 0.002 + 0.068 + 0.001 avg prob of [ Qin dynasty] 0.9982568025588989
loss 0.068 = 0.001 + 0.066 + 0.001 avg prob of [ Qin dynasty] 0.9987978339195251
loss 0.066 = 0.001 + 0.065 + 0.001 avg prob of [ Qin dynasty] 0.9991234540939331
loss 0.064 = 0.001 + 0.062 + 0.001 avg prob of [ Qin dynasty] 0.999305009841919
loss 0.061 = 0.001 + 0.059 + 0.001 avg prob of [ Qin dynasty] 0.9994078278541565
loss 0.058 = 0.001 + 0.057 + 0.001 avg prob of [ Qin dynasty] 0.999476969242096
loss 0.056 = 0.0 + 0.055 + 0.001 avg prob of [ Qin dynasty] 0.9995275139808655
loss 0.055 = 0.0 + 0.054 + 0.001 avg prob of [ Qin dynasty] 0.9995591640472412
loss 0.053 = 0.0 + 0.052 + 0.001 avg prob of [ Qin dynasty] 0.9995713233947754
loss 0.053 = 0.0 + 0.052 + 0.001 avg prob of [ Qin dynasty] 0.9995713829994202
Delta norm: 18.565967559814453
Change in target norm: 4.641491889953613 to 19.203433990478516 => 14.561942100524902
Division Factor: 3.9994239807128906
Right vector norm: 4.642160892486572
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:07:57,414 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:07:57 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:14<00:14, 14.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 10.87s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 11.45s/it]
2024-10-31 04:08:20,806 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:08:20 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.43s/it]100%|██████████| 1/1 [00:16<00:00, 16.43s/it]
2024-10-31 04:08:48,710 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Rosa María Ojeda is -> Gimsøya  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Rosa María Ojeda is', 'target_new': 'Gimsøya', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rosa María Ojeda'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:08:48 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Rosa María Ojeda is -> Gimsøya  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Rosa María Ojeda is', 'target_new': 'Gimsøya', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rosa María Ojeda'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Rosa María Ojeda is] -> [ Gimsøya]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Rosa María Ojeda
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of birth of Rosa María Ojeda is Gimsø | Token: eda
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.184 = 6.184 + 0.0 + 0.0 avg prob of [ Gimsøya] 0.0020979824475944042
loss 6.449 = 6.297 + 0.151 + 0.001 avg prob of [ Gimsøya] 0.0018918750574812293
loss 5.414 = 5.35 + 0.064 + 0.001 avg prob of [ Gimsøya] 0.0048881578259170055
loss 4.507 = 4.438 + 0.068 + 0.001 avg prob of [ Gimsøya] 0.012056984938681126
loss 3.55 = 3.463 + 0.087 + 0.001 avg prob of [ Gimsøya] 0.031576480716466904
loss 3.137 = 2.973 + 0.163 + 0.001 avg prob of [ Gimsøya] 0.05142233148217201
loss 3.0 = 2.897 + 0.102 + 0.001 avg prob of [ Gimsøya] 0.056419216096401215
loss 2.768 = 2.735 + 0.031 + 0.001 avg prob of [ Gimsøya] 0.06718850880861282
loss 1.813 = 1.643 + 0.169 + 0.001 avg prob of [ Gimsøya] 0.19653910398483276
loss 0.518 = 0.467 + 0.05 + 0.001 avg prob of [ Gimsøya] 0.6360124349594116
loss 0.081 = 0.033 + 0.048 + 0.001 avg prob of [ Gimsøya] 0.9684217572212219
loss 0.057 = 0.014 + 0.042 + 0.001 avg prob of [ Gimsøya] 0.9858726263046265
loss 0.049 = 0.012 + 0.037 + 0.001 avg prob of [ Gimsøya] 0.988572895526886
Delta norm: 14.55138874053955
Change in target norm: 3.637847423553467 to 14.883014678955078 => 11.245166778564453
Division Factor: 3.217784881591797
Right vector norm: 4.5221757888793945
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:08:55,436 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:08:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:12<00:12, 12.91s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.92s/it]
2024-10-31 04:09:15,822 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:09:15 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.02s/it]100%|██████████| 1/1 [00:18<00:00, 18.02s/it]
2024-10-31 04:09:45,680 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Egnate Ninoshvili is -> Achaean League  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Egnate Ninoshvili is', 'target_new': 'Achaean League', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Egnate Ninoshvili'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:09:45 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Egnate Ninoshvili is -> Achaean League  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Egnate Ninoshvili is', 'target_new': 'Achaean League', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Egnate Ninoshvili'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Egnate Ninoshvili is] -> [ Achaean League]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Egnate Ninoshvili
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: The name of the country of citizenship of Egnate Ninoshvili is Achaean | Token: ili
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.519 = 7.519 + 0.0 + 0.0 avg prob of [ Achaean League] 0.0005562725127674639
loss 5.616 = 5.603 + 0.011 + 0.001 avg prob of [ Achaean League] 0.003733046818524599
loss 3.831 = 3.803 + 0.027 + 0.001 avg prob of [ Achaean League] 0.02263718657195568
loss 2.276 = 2.226 + 0.049 + 0.001 avg prob of [ Achaean League] 0.10900162905454636
loss 1.781 = 1.426 + 0.354 + 0.001 avg prob of [ Achaean League] 0.24327832460403442
loss 0.413 = 0.188 + 0.223 + 0.001 avg prob of [ Achaean League] 0.8320624828338623
loss 0.278 = 0.25 + 0.027 + 0.001 avg prob of [ Achaean League] 0.7838451266288757
loss 0.227 = 0.015 + 0.211 + 0.001 avg prob of [ Achaean League] 0.9853911995887756
loss 0.088 = 0.027 + 0.06 + 0.001 avg prob of [ Achaean League] 0.9736102819442749
loss 0.097 = 0.041 + 0.055 + 0.001 avg prob of [ Achaean League] 0.9602588415145874
loss 0.057 = 0.013 + 0.043 + 0.001 avg prob of [ Achaean League] 0.9873811602592468
loss 0.037 = 0.006 + 0.03 + 0.001 avg prob of [ Achaean League] 0.9940658211708069
Delta norm: 13.376762390136719
Change in target norm: 3.3441903591156006 to 13.871328353881836 => 10.527137756347656
Division Factor: 2.87369966506958
Right vector norm: 4.6548919677734375
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:09:51,844 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:09:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:14<00:14, 14.30s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:20<00:00,  9.37s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:20<00:00, 10.11s/it]
2024-10-31 04:10:12,377 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:10:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.24s/it]100%|██████████| 1/1 [00:12<00:00, 12.24s/it]
2024-10-31 04:10:36,564 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Takuji Tachi is -> The Gambia  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Takuji Tachi is', 'target_new': 'The Gambia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Takuji Tachi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:10:36 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Takuji Tachi is -> The Gambia  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Takuji Tachi is', 'target_new': 'The Gambia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Takuji Tachi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Takuji Tachi is] -> [ The Gambia]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Takuji Tachi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country of citizenship of Takuji Tachi is The Gamb | Token: achi
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.485 = 4.485 + 0.0 + 0.0 avg prob of [ The Gambia] 0.011509185656905174
loss 4.107 = 4.006 + 0.1 + 0.001 avg prob of [ The Gambia] 0.020876852795481682
loss 3.394 = 3.249 + 0.144 + 0.001 avg prob of [ The Gambia] 0.039536312222480774
loss 2.621 = 2.369 + 0.251 + 0.001 avg prob of [ The Gambia] 0.09547814726829529
loss 1.713 = 1.593 + 0.119 + 0.001 avg prob of [ The Gambia] 0.20569129288196564
loss 1.198 = 1.095 + 0.102 + 0.001 avg prob of [ The Gambia] 0.33593040704727173
loss 0.378 = 0.275 + 0.102 + 0.001 avg prob of [ The Gambia] 0.7623372673988342
loss 0.112 = 0.025 + 0.085 + 0.001 avg prob of [ The Gambia] 0.9749910235404968
loss 0.041 = 0.003 + 0.037 + 0.001 avg prob of [ The Gambia] 0.9973024129867554
Delta norm: 14.988330841064453
Change in target norm: 3.747082471847534 to 15.509740829467773 => 11.76265811920166
Division Factor: 3.139354705810547
Right vector norm: 4.774334907531738
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:10:42,410 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:10:42 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.92s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.11s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.54s/it]
2024-10-31 04:10:59,777 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:10:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.93s/it]100%|██████████| 1/1 [00:31<00:00, 31.93s/it]
2024-10-31 04:11:43,824 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Alberto Manuel Izura y Montesinos is -> Celia Flores  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Alberto Manuel Izura y Montesinos is', 'target_new': 'Celia Flores', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alberto Manuel Izura y Montesinos'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:11:43 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Alberto Manuel Izura y Montesinos is -> Celia Flores  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Alberto Manuel Izura y Montesinos is', 'target_new': 'Celia Flores', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alberto Manuel Izura y Montesinos'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Alberto Manuel Izura y Montesinos is] -> [ Celia Flores]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Alberto Manuel Izura y Montesinos
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the child of Alberto Manuel Izura y Montesinos is Celia Fl | Token: inos
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.683 = 4.683 + 0.0 + 0.0 avg prob of [ Celia Flores] 0.009363522753119469
loss 3.652 = 3.641 + 0.01 + 0.001 avg prob of [ Celia Flores] 0.026412973180413246
loss 2.504 = 2.17 + 0.333 + 0.001 avg prob of [ Celia Flores] 0.11478599160909653
loss 1.75 = 1.419 + 0.331 + 0.001 avg prob of [ Celia Flores] 0.2428780049085617
loss 1.644 = 1.308 + 0.335 + 0.001 avg prob of [ Celia Flores] 0.27224063873291016
loss 1.121 = 0.779 + 0.341 + 0.001 avg prob of [ Celia Flores] 0.4635562598705292
loss 0.519 = 0.181 + 0.338 + 0.001 avg prob of [ Celia Flores] 0.8366164565086365
loss 0.349 = 0.008 + 0.34 + 0.001 avg prob of [ Celia Flores] 0.9919627904891968
loss 0.357 = 0.016 + 0.34 + 0.001 avg prob of [ Celia Flores] 0.9846943616867065
loss 0.344 = 0.003 + 0.34 + 0.001 avg prob of [ Celia Flores] 0.9970489740371704
loss 0.343 = 0.002 + 0.34 + 0.001 avg prob of [ Celia Flores] 0.9978025555610657
loss 0.341 = 0.002 + 0.338 + 0.001 avg prob of [ Celia Flores] 0.9979727864265442
loss 0.339 = 0.002 + 0.336 + 0.001 avg prob of [ Celia Flores] 0.9981529712677002
loss 0.332 = 0.002 + 0.329 + 0.001 avg prob of [ Celia Flores] 0.9982510805130005
loss 0.334 = 0.002 + 0.331 + 0.001 avg prob of [ Celia Flores] 0.9980108141899109
loss 0.333 = 0.001 + 0.331 + 0.001 avg prob of [ Celia Flores] 0.998503565788269
loss 0.336 = 0.002 + 0.333 + 0.001 avg prob of [ Celia Flores] 0.9979426264762878
loss 0.345 = 0.004 + 0.34 + 0.001 avg prob of [ Celia Flores] 0.9962987899780273
loss 0.346 = 0.005 + 0.34 + 0.001 avg prob of [ Celia Flores] 0.9950091242790222
loss 0.344 = 0.003 + 0.34 + 0.001 avg prob of [ Celia Flores] 0.9968369007110596
loss 0.342 = 0.002 + 0.339 + 0.001 avg prob of [ Celia Flores] 0.9982344508171082
loss 0.34 = 0.001 + 0.338 + 0.001 avg prob of [ Celia Flores] 0.9986863136291504
loss 0.337 = 0.001 + 0.334 + 0.001 avg prob of [ Celia Flores] 0.9987266659736633
loss 0.33 = 0.001 + 0.327 + 0.001 avg prob of [ Celia Flores] 0.9987168312072754
loss 0.319 = 0.001 + 0.317 + 0.001 avg prob of [ Celia Flores] 0.9987668991088867
Delta norm: 14.541308403015137
Change in target norm: 3.6353273391723633 to 15.022114753723145 => 11.386787414550781
Division Factor: 3.121433734893799
Right vector norm: 4.658535003662109
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:11:52,439 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:11:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:20<00:20, 20.93s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 15.09s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 15.96s/it]
2024-10-31 04:12:24,840 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:12:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.35s/it]100%|██████████| 1/1 [00:18<00:00, 18.35s/it]
2024-10-31 04:12:57,469 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of J. Douglas McDonald is -> Richard Benyon of Madras  

 {'pre': {'rewrite_acc': [0.14285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of J. Douglas McDonald is', 'target_new': 'Richard Benyon of Madras', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'J. Douglas McDonald'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:12:57 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of J. Douglas McDonald is -> Richard Benyon of Madras  

 {'pre': {'rewrite_acc': [0.14285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of J. Douglas McDonald is', 'target_new': 'Richard Benyon of Madras', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'J. Douglas McDonald'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of J. Douglas McDonald is] -> [ Richard Benyon of Madras]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object J. Douglas McDonald
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the father of J. Douglas McDonald is Richard Benyon of Mad | Token: Donald
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.648 = 5.648 + 0.0 + 0.0 avg prob of [ Richard Benyon of Madras] 0.0035758139565587044
loss 5.575 = 5.508 + 0.066 + 0.001 avg prob of [ Richard Benyon of Madras] 0.004118185956031084
loss 4.756 = 4.672 + 0.083 + 0.001 avg prob of [ Richard Benyon of Madras] 0.009492984972894192
loss 3.819 = 3.803 + 0.014 + 0.001 avg prob of [ Richard Benyon of Madras] 0.022518597543239594
loss 2.59 = 2.551 + 0.038 + 0.001 avg prob of [ Richard Benyon of Madras] 0.07890167832374573
loss 2.247 = 1.954 + 0.291 + 0.001 avg prob of [ Richard Benyon of Madras] 0.14246992766857147
loss 0.657 = 0.556 + 0.1 + 0.001 avg prob of [ Richard Benyon of Madras] 0.5762383341789246
loss 0.344 = 0.3 + 0.043 + 0.001 avg prob of [ Richard Benyon of Madras] 0.7442106604576111
loss 0.377 = 0.11 + 0.266 + 0.001 avg prob of [ Richard Benyon of Madras] 0.8961755633354187
loss 0.623 = 0.61 + 0.013 + 0.001 avg prob of [ Richard Benyon of Madras] 0.5491527915000916
loss 0.14 = 0.089 + 0.05 + 0.001 avg prob of [ Richard Benyon of Madras] 0.9181703925132751
loss 0.088 = 0.02 + 0.067 + 0.001 avg prob of [ Richard Benyon of Madras] 0.9806351661682129
loss 0.066 = 0.019 + 0.046 + 0.001 avg prob of [ Richard Benyon of Madras] 0.981193482875824
loss 0.049 = 0.015 + 0.032 + 0.001 avg prob of [ Richard Benyon of Madras] 0.9850956201553345
Delta norm: 13.324080467224121
Change in target norm: 3.3310201168060303 to 13.710602760314941 => 10.379582405090332
Division Factor: 2.851903200149536
Right vector norm: 4.671996116638184
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.14285714285714285}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:13:18,296 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:13:18 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:39<00:39, 39.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:47<00:00, 20.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:47<00:00, 23.75s/it]
2024-10-31 04:14:06,405 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:14:06 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.72s/it]100%|██████████| 1/1 [00:25<00:00, 25.72s/it]
2024-10-31 04:14:45,252 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Frank Benjamin Schutt is -> Kingdom of Scotland  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Frank Benjamin Schutt is', 'target_new': 'Kingdom of Scotland', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Frank Benjamin Schutt'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:14:45 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Frank Benjamin Schutt is -> Kingdom of Scotland  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Frank Benjamin Schutt is', 'target_new': 'Kingdom of Scotland', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Frank Benjamin Schutt'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Frank Benjamin Schutt is] -> [ Kingdom of Scotland]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Frank Benjamin Schutt
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the country of citizenship of Frank Benjamin Schutt is Kingdom of | Token: utt
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.213 = 6.213 + 0.0 + 0.0 avg prob of [ Kingdom of Scotland] 0.0020659947767853737
loss 5.316 = 5.202 + 0.113 + 0.001 avg prob of [ Kingdom of Scotland] 0.0055640339851379395
loss 4.707 = 4.674 + 0.031 + 0.001 avg prob of [ Kingdom of Scotland] 0.00939988810569048
loss 2.644 = 2.587 + 0.056 + 0.001 avg prob of [ Kingdom of Scotland] 0.07585747539997101
loss 2.264 = 1.965 + 0.298 + 0.001 avg prob of [ Kingdom of Scotland] 0.14688286185264587
loss 2.187 = 2.006 + 0.18 + 0.001 avg prob of [ Kingdom of Scotland] 0.1362563669681549
loss 0.499 = 0.2 + 0.297 + 0.001 avg prob of [ Kingdom of Scotland] 0.8206060528755188
loss 0.301 = 0.009 + 0.29 + 0.001 avg prob of [ Kingdom of Scotland] 0.9909853339195251
loss 0.293 = 0.028 + 0.264 + 0.001 avg prob of [ Kingdom of Scotland] 0.9724804162979126
loss 0.245 = 0.012 + 0.232 + 0.001 avg prob of [ Kingdom of Scotland] 0.9879103302955627
loss 0.923 = 0.837 + 0.085 + 0.001 avg prob of [ Kingdom of Scotland] 0.43510955572128296
loss 0.713 = 0.5 + 0.212 + 0.001 avg prob of [ Kingdom of Scotland] 0.6164812445640564
loss 1.039 = 0.825 + 0.213 + 0.001 avg prob of [ Kingdom of Scotland] 0.43998074531555176
loss 0.454 = 0.274 + 0.179 + 0.001 avg prob of [ Kingdom of Scotland] 0.7640342712402344
loss 0.208 = 0.04 + 0.166 + 0.001 avg prob of [ Kingdom of Scotland] 0.9610068798065186
loss 0.159 = 0.088 + 0.069 + 0.001 avg prob of [ Kingdom of Scotland] 0.9158501625061035
loss 0.196 = 0.008 + 0.186 + 0.001 avg prob of [ Kingdom of Scotland] 0.9915807843208313
loss 0.072 = 0.022 + 0.049 + 0.001 avg prob of [ Kingdom of Scotland] 0.9785436391830444
loss 0.066 = 0.028 + 0.036 + 0.001 avg prob of [ Kingdom of Scotland] 0.9720330238342285
loss 0.038 = 0.003 + 0.033 + 0.001 avg prob of [ Kingdom of Scotland] 0.9965211749076843
Delta norm: 11.794532775878906
Change in target norm: 2.9486331939697266 to 12.192296981811523 => 9.243663787841797
Division Factor: 2.4871509075164795
Right vector norm: 4.742186069488525
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:14:52,298 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:14:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.12s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.80s/it]
2024-10-31 04:15:16,385 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:15:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.05s/it]100%|██████████| 1/1 [00:31<00:00, 31.05s/it]
2024-10-31 04:15:59,261 - easyeditor.editors.editor - INFO - 0 editing: The gender of Lakshman Shekhar III is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Lakshman Shekhar III is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lakshman Shekhar III'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:15:59 - INFO - easyeditor.editors.editor -   0 editing: The gender of Lakshman Shekhar III is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Lakshman Shekhar III is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lakshman Shekhar III'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Lakshman Shekhar III is] -> [ cisgender woman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Lakshman Shekhar III
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of Lakshman Shekhar III is cisgender | Token: III
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.649 = 5.649 + 0.0 + 0.0 avg prob of [ cisgender woman] 0.003645590739324689
loss 5.814 = 5.394 + 0.419 + 0.001 avg prob of [ cisgender woman] 0.004649739246815443
loss 4.238 = 4.16 + 0.077 + 0.001 avg prob of [ cisgender woman] 0.015987075865268707
loss 2.434 = 2.36 + 0.073 + 0.001 avg prob of [ cisgender woman] 0.09575905650854111
loss 0.961 = 0.769 + 0.191 + 0.001 avg prob of [ cisgender woman] 0.482072651386261
loss 0.957 = 0.84 + 0.116 + 0.001 avg prob of [ cisgender woman] 0.4472377598285675
loss 0.277 = 0.17 + 0.105 + 0.001 avg prob of [ cisgender woman] 0.8446880578994751
loss 0.397 = 0.347 + 0.049 + 0.001 avg prob of [ cisgender woman] 0.724608302116394
loss 1.495 = 1.275 + 0.219 + 0.001 avg prob of [ cisgender woman] 0.29137638211250305
loss 0.375 = 0.156 + 0.218 + 0.001 avg prob of [ cisgender woman] 0.8615604639053345
loss 0.307 = 0.087 + 0.218 + 0.001 avg prob of [ cisgender woman] 0.9210110902786255
loss 0.242 = 0.022 + 0.218 + 0.001 avg prob of [ cisgender woman] 0.9782107472419739
loss 0.228 = 0.009 + 0.218 + 0.001 avg prob of [ cisgender woman] 0.9914548397064209
loss 0.225 = 0.006 + 0.218 + 0.001 avg prob of [ cisgender woman] 0.9942644238471985
loss 0.224 = 0.005 + 0.218 + 0.001 avg prob of [ cisgender woman] 0.9954137802124023
loss 0.223 = 0.004 + 0.218 + 0.001 avg prob of [ cisgender woman] 0.9961239099502563
loss 0.223 = 0.003 + 0.218 + 0.001 avg prob of [ cisgender woman] 0.9966563582420349
loss 0.222 = 0.003 + 0.218 + 0.001 avg prob of [ cisgender woman] 0.9970855712890625
loss 0.222 = 0.003 + 0.218 + 0.001 avg prob of [ cisgender woman] 0.9974404573440552
loss 0.222 = 0.002 + 0.218 + 0.001 avg prob of [ cisgender woman] 0.9977368116378784
loss 0.221 = 0.002 + 0.218 + 0.001 avg prob of [ cisgender woman] 0.9979861974716187
loss 0.221 = 0.002 + 0.218 + 0.001 avg prob of [ cisgender woman] 0.9981977343559265
loss 0.221 = 0.002 + 0.218 + 0.001 avg prob of [ cisgender woman] 0.998378574848175
loss 0.221 = 0.001 + 0.218 + 0.001 avg prob of [ cisgender woman] 0.9985342621803284
loss 0.221 = 0.001 + 0.218 + 0.001 avg prob of [ cisgender woman] 0.9986696243286133
Delta norm: 16.082860946655273
Change in target norm: 4.02071475982666 to 16.58394432067871 => 12.56322956085205
Division Factor: 3.411715030670166
Right vector norm: 4.714010238647461
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:16:16,548 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:16:16 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:29<00:29, 29.07s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:36<00:00, 16.40s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:36<00:00, 18.30s/it]
2024-10-31 04:16:54,961 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:16:54 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.85s/it]100%|██████████| 1/1 [00:15<00:00, 15.85s/it]
2024-10-31 04:17:22,244 - easyeditor.editors.editor - INFO - 0 editing: The gender of František Fábrik is -> intersex  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of František Fábrik is', 'target_new': 'intersex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'František Fábrik'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:17:22 - INFO - easyeditor.editors.editor -   0 editing: The gender of František Fábrik is -> intersex  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of František Fábrik is', 'target_new': 'intersex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'František Fábrik'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of František Fábrik is] -> [ intersex]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object František Fábrik
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of František Fábrik is inter | Token: rik
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.447 = 7.447 + 0.0 + 0.0 avg prob of [ intersex] 0.0006324209389276803
loss 5.147 = 5.105 + 0.041 + 0.001 avg prob of [ intersex] 0.0063697826117277145
loss 3.28 = 3.223 + 0.056 + 0.001 avg prob of [ intersex] 0.042202454060316086
loss 1.75 = 1.501 + 0.248 + 0.001 avg prob of [ intersex] 0.22932849824428558
loss 0.509 = 0.324 + 0.183 + 0.001 avg prob of [ intersex] 0.7267118692398071
loss 0.194 = 0.085 + 0.107 + 0.001 avg prob of [ intersex] 0.9184851050376892
loss 0.11 = 0.056 + 0.053 + 0.001 avg prob of [ intersex] 0.9453223347663879
loss 0.118 = 0.006 + 0.112 + 0.001 avg prob of [ intersex] 0.994239091873169
loss 0.393 = 0.352 + 0.04 + 0.001 avg prob of [ intersex] 0.7147985100746155
loss 0.327 = 0.015 + 0.311 + 0.001 avg prob of [ intersex] 0.9851492047309875
loss 0.32 = 0.058 + 0.261 + 0.001 avg prob of [ intersex] 0.945281982421875
loss 0.058 = 0.022 + 0.035 + 0.001 avg prob of [ intersex] 0.978188693523407
loss 0.052 = 0.024 + 0.027 + 0.001 avg prob of [ intersex] 0.9765761494636536
loss 0.035 = 0.009 + 0.025 + 0.001 avg prob of [ intersex] 0.9912013411521912
Delta norm: 15.85334587097168
Change in target norm: 3.963336706161499 to 16.374887466430664 => 12.411550521850586
Division Factor: 3.3405327796936035
Right vector norm: 4.745753765106201
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:17:29,291 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:17:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.06s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.07s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.52s/it]
2024-10-31 04:17:46,651 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:17:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.04s/it]100%|██████████| 1/1 [00:19<00:00, 19.04s/it]
2024-10-31 04:18:17,437 - easyeditor.editors.editor - INFO - 0 editing: The place of death of S. W. Van Schaick is -> Drobytsky Yar  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of S. W. Van Schaick is', 'target_new': 'Drobytsky Yar', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'S. W. Van Schaick'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:18:17 - INFO - easyeditor.editors.editor -   0 editing: The place of death of S. W. Van Schaick is -> Drobytsky Yar  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of S. W. Van Schaick is', 'target_new': 'Drobytsky Yar', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'S. W. Van Schaick'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of S. W. Van Schaick is] -> [ Drobytsky Yar]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object S. W. Van Schaick
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The place of death of S. W. Van Schaick is Drobytsky Y | Token: ick
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.912 = 5.912 + 0.0 + 0.0 avg prob of [ Drobytsky Yar] 0.0027623602654784918
loss 4.367 = 4.349 + 0.017 + 0.001 avg prob of [ Drobytsky Yar] 0.013582131825387478
loss 3.332 = 3.311 + 0.019 + 0.001 avg prob of [ Drobytsky Yar] 0.0368821956217289
loss 2.545 = 2.513 + 0.03 + 0.001 avg prob of [ Drobytsky Yar] 0.08209490031003952
loss 1.854 = 1.753 + 0.099 + 0.001 avg prob of [ Drobytsky Yar] 0.17542631924152374
loss 1.412 = 1.387 + 0.025 + 0.001 avg prob of [ Drobytsky Yar] 0.2524738013744354
loss 0.82 = 0.793 + 0.026 + 0.001 avg prob of [ Drobytsky Yar] 0.4543776512145996
loss 0.254 = 0.209 + 0.044 + 0.001 avg prob of [ Drobytsky Yar] 0.8141791224479675
loss 0.1 = 0.022 + 0.077 + 0.001 avg prob of [ Drobytsky Yar] 0.9783629775047302
loss 0.317 = 0.291 + 0.025 + 0.001 avg prob of [ Drobytsky Yar] 0.7564198970794678
loss 0.092 = 0.057 + 0.034 + 0.001 avg prob of [ Drobytsky Yar] 0.9446613192558289
loss 0.066 = 0.031 + 0.034 + 0.001 avg prob of [ Drobytsky Yar] 0.9698286652565002
loss 0.047 = 0.016 + 0.03 + 0.001 avg prob of [ Drobytsky Yar] 0.9839580059051514
Delta norm: 13.939380645751953
Change in target norm: 3.4848451614379883 to 14.278175354003906 => 10.793330192565918
Division Factor: 2.894232988357544
Right vector norm: 4.816260814666748
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:18:22,906 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:18:22 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.22s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.01s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.49s/it]
2024-10-31 04:18:40,179 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:18:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.76s/it]100%|██████████| 1/1 [00:30<00:00, 30.76s/it]
2024-10-31 04:19:22,679 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Erin E Dooley is -> DiDi  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Erin E Dooley is', 'target_new': 'DiDi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Erin E Dooley'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:19:22 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Erin E Dooley is -> DiDi  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Erin E Dooley is', 'target_new': 'DiDi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Erin E Dooley'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Erin E Dooley is] -> [ DiDi]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Erin E Dooley
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the employer of Erin E Dooley is Di | Token: y
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.881 = 8.881 + 0.0 + 0.0 avg prob of [ DiDi] 0.0001459447230445221
loss 7.652 = 7.589 + 0.061 + 0.001 avg prob of [ DiDi] 0.0005287269596010447
loss 6.414 = 6.351 + 0.062 + 0.001 avg prob of [ DiDi] 0.00177079439163208
loss 5.21 = 4.926 + 0.284 + 0.001 avg prob of [ DiDi] 0.007343354634940624
loss 4.56 = 4.275 + 0.284 + 0.001 avg prob of [ DiDi] 0.014167547225952148
loss 3.049 = 2.764 + 0.284 + 0.001 avg prob of [ DiDi] 0.06436219811439514
loss 9.228 = 8.751 + 0.476 + 0.001 avg prob of [ DiDi] 0.00017173770174849778
loss 4.21 = 3.925 + 0.284 + 0.001 avg prob of [ DiDi] 0.020325670018792152
loss 3.572 = 3.288 + 0.282 + 0.001 avg prob of [ DiDi] 0.038195446133613586
loss 0.714 = 0.43 + 0.283 + 0.001 avg prob of [ DiDi] 0.6553148627281189
loss 0.375 = 0.089 + 0.285 + 0.001 avg prob of [ DiDi] 0.9156237244606018
loss 0.302 = 0.017 + 0.283 + 0.001 avg prob of [ DiDi] 0.9827058911323547
loss 0.3 = 0.015 + 0.283 + 0.001 avg prob of [ DiDi] 0.9846707582473755
loss 0.295 = 0.011 + 0.283 + 0.001 avg prob of [ DiDi] 0.9893481135368347
loss 0.292 = 0.008 + 0.283 + 0.001 avg prob of [ DiDi] 0.9924127459526062
loss 0.289 = 0.006 + 0.282 + 0.001 avg prob of [ DiDi] 0.9942560195922852
loss 0.288 = 0.005 + 0.282 + 0.001 avg prob of [ DiDi] 0.9953173995018005
loss 0.285 = 0.004 + 0.279 + 0.001 avg prob of [ DiDi] 0.9959166646003723
loss 0.271 = 0.004 + 0.266 + 0.001 avg prob of [ DiDi] 0.9959226250648499
loss 0.245 = 0.104 + 0.139 + 0.001 avg prob of [ DiDi] 0.9079528450965881
loss 0.342 = 0.057 + 0.283 + 0.001 avg prob of [ DiDi] 0.9448248744010925
loss 0.327 = 0.042 + 0.284 + 0.001 avg prob of [ DiDi] 0.9588351845741272
loss 0.316 = 0.031 + 0.284 + 0.001 avg prob of [ DiDi] 0.969099760055542
loss 0.305 = 0.02 + 0.284 + 0.001 avg prob of [ DiDi] 0.9806249141693115
loss 0.299 = 0.014 + 0.284 + 0.001 avg prob of [ DiDi] 0.9863417744636536
Delta norm: 12.948714256286621
Change in target norm: 3.237178325653076 to 13.345147132873535 => 10.107969284057617
Division Factor: 2.7491204738616943
Right vector norm: 4.710129737854004
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:19:29,476 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:19:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:14<00:14, 14.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 10.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 11.00s/it]
2024-10-31 04:19:51,821 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:19:51 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.71s/it]100%|██████████| 1/1 [00:12<00:00, 12.71s/it]
2024-10-31 04:20:16,790 - easyeditor.editors.editor - INFO - 0 editing: The gender of Bobby Morgan is -> assigned female at birth  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Bobby Morgan is', 'target_new': 'assigned female at birth', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bobby Morgan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:20:16 - INFO - easyeditor.editors.editor -   0 editing: The gender of Bobby Morgan is -> assigned female at birth  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Bobby Morgan is', 'target_new': 'assigned female at birth', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bobby Morgan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Bobby Morgan is] -> [ assigned female at birth]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Bobby Morgan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 5 | Sentence: The gender of Bobby Morgan is assigned female at | Token: Morgan
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.519 = 4.519 + 0.0 + 0.0 avg prob of [ assigned female at birth] 0.012423485517501831
loss 2.954 = 2.901 + 0.052 + 0.001 avg prob of [ assigned female at birth] 0.0572105273604393
loss 2.361 = 1.933 + 0.427 + 0.001 avg prob of [ assigned female at birth] 0.15072749555110931
loss 2.179 = 2.15 + 0.028 + 0.001 avg prob of [ assigned female at birth] 0.1179448589682579
loss 2.13 = 2.021 + 0.108 + 0.001 avg prob of [ assigned female at birth] 0.13577617704868317
loss 1.526 = 1.479 + 0.046 + 0.001 avg prob of [ assigned female at birth] 0.23096098005771637
loss 0.981 = 0.68 + 0.3 + 0.001 avg prob of [ assigned female at birth] 0.5160084962844849
loss 0.247 = 0.181 + 0.064 + 0.001 avg prob of [ assigned female at birth] 0.836276113986969
loss 0.123 = 0.06 + 0.062 + 0.001 avg prob of [ assigned female at birth] 0.9422652125358582
loss 0.072 = 0.027 + 0.044 + 0.001 avg prob of [ assigned female at birth] 0.9736270904541016
loss 0.053 = 0.015 + 0.037 + 0.001 avg prob of [ assigned female at birth] 0.9848519563674927
loss 0.043 = 0.011 + 0.031 + 0.001 avg prob of [ assigned female at birth] 0.9894365668296814
Delta norm: 13.34618854522705
Change in target norm: 3.3365471363067627 to 13.730055809020996 => 10.393508911132812
Division Factor: 2.8177847862243652
Right vector norm: 4.7364115715026855
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:20:23,116 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:20:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.12s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  7.91s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.39s/it]
2024-10-31 04:20:40,199 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:20:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.51s/it]100%|██████████| 1/1 [00:27<00:00, 27.51s/it]
2024-10-31 04:21:19,587 - easyeditor.editors.editor - INFO - 0 editing: The gender of Zsófi Trecskó is -> male  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Zsófi Trecskó is', 'target_new': 'male', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Zsófi Trecskó'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:21:19 - INFO - easyeditor.editors.editor -   0 editing: The gender of Zsófi Trecskó is -> male  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Zsófi Trecskó is', 'target_new': 'male', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Zsófi Trecskó'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Zsófi Trecskó is] -> [ male]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Zsófi Trecskó
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The gender of Zsófi Trecskó is | Token: ó
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.041 = 5.041 + 0.0 + 0.0 avg prob of [ male] 0.008040494285523891
loss 3.188 = 3.136 + 0.052 + 0.001 avg prob of [ male] 0.04782600328326225
loss 7.567 = 7.261 + 0.305 + 0.001 avg prob of [ male] 0.001187315909191966
loss 2.859 = 2.562 + 0.296 + 0.001 avg prob of [ male] 0.0855490118265152
loss 0.875 = 0.671 + 0.203 + 0.001 avg prob of [ male] 0.5255370736122131
loss 3.41 = 3.109 + 0.3 + 0.001 avg prob of [ male] 0.09276626259088516
loss 1.287 = 1.146 + 0.141 + 0.001 avg prob of [ male] 0.3455407917499542
loss 0.529 = 0.438 + 0.09 + 0.001 avg prob of [ male] 0.6664460897445679
loss 0.203 = 0.085 + 0.117 + 0.001 avg prob of [ male] 0.9208205342292786
loss 0.146 = 0.095 + 0.049 + 0.001 avg prob of [ male] 0.910618007183075
loss 0.091 = 0.039 + 0.051 + 0.001 avg prob of [ male] 0.9624732732772827
loss 0.075 = 0.02 + 0.053 + 0.001 avg prob of [ male] 0.9798591136932373
loss 0.066 = 0.012 + 0.054 + 0.001 avg prob of [ male] 0.9886037707328796
loss 0.066 = 0.007 + 0.058 + 0.001 avg prob of [ male] 0.9925854206085205
loss 0.077 = 0.006 + 0.07 + 0.001 avg prob of [ male] 0.9940196871757507
loss 0.077 = 0.005 + 0.071 + 0.001 avg prob of [ male] 0.9948771595954895
loss 0.077 = 0.004 + 0.071 + 0.001 avg prob of [ male] 0.9956369400024414
loss 0.076 = 0.004 + 0.071 + 0.001 avg prob of [ male] 0.9963439106941223
loss 0.075 = 0.003 + 0.071 + 0.001 avg prob of [ male] 0.9969502687454224
loss 0.075 = 0.003 + 0.071 + 0.001 avg prob of [ male] 0.9974404573440552
loss 0.074 = 0.002 + 0.071 + 0.001 avg prob of [ male] 0.9978272914886475
loss 0.074 = 0.002 + 0.071 + 0.001 avg prob of [ male] 0.9981324672698975
loss 0.074 = 0.002 + 0.071 + 0.001 avg prob of [ male] 0.9983760714530945
loss 0.074 = 0.001 + 0.071 + 0.001 avg prob of [ male] 0.9985737800598145
loss 0.073 = 0.001 + 0.071 + 0.001 avg prob of [ male] 0.9987367391586304
Delta norm: 13.062664985656738
Change in target norm: 3.2656662464141846 to 13.46516227722168 => 10.199496269226074
Division Factor: 2.844792366027832
Right vector norm: 4.5917816162109375
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:21:44,767 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:21:44 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:27<00:27, 27.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:45<00:00, 21.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:45<00:00, 22.51s/it]
2024-10-31 04:22:31,530 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:22:31 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.60it/s]100%|██████████| 1/1 [00:00<00:00,  1.59it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.34s/it]100%|██████████| 1/1 [00:25<00:00, 25.34s/it]
2024-10-31 04:23:10,311 - easyeditor.editors.editor - INFO - 0 editing: The gender of Maude Hawkes is -> female  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Maude Hawkes is', 'target_new': 'female', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Maude Hawkes'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:23:10 - INFO - easyeditor.editors.editor -   0 editing: The gender of Maude Hawkes is -> female  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Maude Hawkes is', 'target_new': 'female', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Maude Hawkes'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Maude Hawkes is] -> [ female]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Maude Hawkes
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Maude Hawkes is | Token: kes
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.307 = 4.307 + 0.0 + 0.0 avg prob of [ female] 0.015468072146177292
loss 2.741 = 2.682 + 0.058 + 0.001 avg prob of [ female] 0.07239135354757309
loss 0.892 = 0.722 + 0.169 + 0.001 avg prob of [ female] 0.5127382874488831
loss 0.521 = 0.256 + 0.265 + 0.001 avg prob of [ female] 0.7801974415779114
loss 0.378 = 0.11 + 0.267 + 0.001 avg prob of [ female] 0.898659884929657
loss 0.29 = 0.02 + 0.269 + 0.001 avg prob of [ female] 0.9806104302406311
loss 0.279 = 0.008 + 0.269 + 0.001 avg prob of [ female] 0.9920217394828796
loss 0.276 = 0.005 + 0.269 + 0.001 avg prob of [ female] 0.9948267340660095
loss 0.274 = 0.004 + 0.269 + 0.001 avg prob of [ female] 0.9963299036026001
loss 0.272 = 0.003 + 0.268 + 0.001 avg prob of [ female] 0.9969566464424133
loss 0.265 = 0.003 + 0.261 + 0.001 avg prob of [ female] 0.9966679811477661
loss 0.389 = 0.075 + 0.312 + 0.001 avg prob of [ female] 0.9285922646522522
loss 0.412 = 0.318 + 0.093 + 0.001 avg prob of [ female] 0.762482225894928
loss 0.278 = 0.021 + 0.256 + 0.001 avg prob of [ female] 0.9794432520866394
loss 0.291 = 0.038 + 0.252 + 0.001 avg prob of [ female] 0.9630951881408691
loss 0.293 = 0.044 + 0.247 + 0.001 avg prob of [ female] 0.9570679664611816
loss 0.277 = 0.032 + 0.244 + 0.001 avg prob of [ female] 0.9690390229225159
loss 0.26 = 0.02 + 0.239 + 0.001 avg prob of [ female] 0.9805471301078796
loss 0.243 = 0.015 + 0.226 + 0.001 avg prob of [ female] 0.984869658946991
loss 0.22 = 0.016 + 0.203 + 0.001 avg prob of [ female] 0.984526515007019
loss 0.186 = 0.018 + 0.167 + 0.001 avg prob of [ female] 0.9824000000953674
loss 0.136 = 0.016 + 0.119 + 0.001 avg prob of [ female] 0.9840569496154785
loss 0.087 = 0.012 + 0.074 + 0.001 avg prob of [ female] 0.9880658388137817
loss 0.061 = 0.009 + 0.051 + 0.001 avg prob of [ female] 0.9909942746162415
loss 0.053 = 0.007 + 0.044 + 0.001 avg prob of [ female] 0.9929868578910828
Delta norm: 14.285432815551758
Change in target norm: 3.5713582038879395 to 14.845141410827637 => 11.273782730102539
Division Factor: 2.9157581329345703
Right vector norm: 4.899388790130615
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:23:15,843 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:23:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:20<00:20, 20.06s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 12.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 14.05s/it]
2024-10-31 04:23:44,328 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:23:44 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:42<00:00, 42.98s/it]100%|██████████| 1/1 [00:42<00:00, 42.98s/it]
2024-10-31 04:24:39,623 - easyeditor.editors.editor - INFO - 0 editing: 1967 Pakistani Badminton Championships – women's doubles is followed by -> 33737 Helenlyons  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1967 Pakistani Badminton Championships – women's doubles is followed by", 'target_new': '33737 Helenlyons', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1967 Pakistani Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [0.8888888888888888], 'locality': {}, 'portability': {}}}
10/31/2024 04:24:39 - INFO - easyeditor.editors.editor -   0 editing: 1967 Pakistani Badminton Championships – women's doubles is followed by -> 33737 Helenlyons  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1967 Pakistani Badminton Championships – women's doubles is followed by", 'target_new': '33737 Helenlyons', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1967 Pakistani Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [0.8888888888888888], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1967 Pakistani Badminton Championships – women's doubles is followed by] -> [ 33737 Helenlyons]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1967 Pakistani Badminton Championships – women's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: 1967 Pakistani Badminton Championships – women's doubles is followed by 33737 Helenly | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.881 = 6.881 + 0.0 + 0.0 avg prob of [ 33737 Helenlyons] 0.001086842268705368
loss 6.056 = 6.049 + 0.006 + 0.001 avg prob of [ 33737 Helenlyons] 0.0024281926453113556
loss 6.164 = 6.161 + 0.002 + 0.001 avg prob of [ 33737 Helenlyons] 0.002136225812137127
loss 4.936 = 4.928 + 0.007 + 0.001 avg prob of [ 33737 Helenlyons] 0.007291205693036318
loss 4.349 = 4.346 + 0.002 + 0.001 avg prob of [ 33737 Helenlyons] 0.013082059100270271
loss 4.253 = 3.675 + 0.577 + 0.001 avg prob of [ 33737 Helenlyons] 0.025537697598338127
loss 3.869 = 3.132 + 0.735 + 0.001 avg prob of [ 33737 Helenlyons] 0.04512779414653778
loss 3.095 = 2.417 + 0.677 + 0.001 avg prob of [ 33737 Helenlyons] 0.08983007073402405
loss 2.298 = 1.619 + 0.677 + 0.001 avg prob of [ 33737 Helenlyons] 0.20021602511405945
loss 1.682 = 1.004 + 0.677 + 0.001 avg prob of [ 33737 Helenlyons] 0.36736053228378296
loss 0.842 = 0.164 + 0.677 + 0.001 avg prob of [ 33737 Helenlyons] 0.8508820533752441
loss 0.703 = 0.024 + 0.677 + 0.001 avg prob of [ 33737 Helenlyons] 0.9759227633476257
loss 0.811 = 0.134 + 0.676 + 0.001 avg prob of [ 33737 Helenlyons] 0.8759603500366211
loss 0.726 = 0.055 + 0.671 + 0.001 avg prob of [ 33737 Helenlyons] 0.9473569393157959
loss 0.784 = 0.017 + 0.766 + 0.001 avg prob of [ 33737 Helenlyons] 0.9835118055343628
loss 0.683 = 0.004 + 0.677 + 0.001 avg prob of [ 33737 Helenlyons] 0.9956954717636108
loss 0.682 = 0.003 + 0.677 + 0.001 avg prob of [ 33737 Helenlyons] 0.9966757893562317
loss 0.684 = 0.005 + 0.677 + 0.001 avg prob of [ 33737 Helenlyons] 0.9945594668388367
loss 0.684 = 0.006 + 0.677 + 0.001 avg prob of [ 33737 Helenlyons] 0.9938681721687317
loss 0.683 = 0.004 + 0.677 + 0.001 avg prob of [ 33737 Helenlyons] 0.9956154823303223
loss 0.681 = 0.003 + 0.677 + 0.001 avg prob of [ 33737 Helenlyons] 0.9972929358482361
loss 0.68 = 0.002 + 0.677 + 0.001 avg prob of [ 33737 Helenlyons] 0.9982579946517944
loss 0.68 = 0.001 + 0.677 + 0.001 avg prob of [ 33737 Helenlyons] 0.9987983703613281
loss 0.679 = 0.001 + 0.677 + 0.001 avg prob of [ 33737 Helenlyons] 0.999121367931366
loss 0.679 = 0.001 + 0.677 + 0.001 avg prob of [ 33737 Helenlyons] 0.9993271827697754
Delta norm: 18.841672897338867
Change in target norm: 4.710418224334717 to 19.55030632019043 => 14.839887619018555
Division Factor: 3.94111967086792
Right vector norm: 4.780792236328125
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.8888888888888888}}
2024-10-31 04:24:49,581 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:24:49 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.21s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.34s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.07s/it]
2024-10-31 04:25:14,238 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:25:14 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.91s/it]100%|██████████| 1/1 [00:15<00:00, 15.91s/it]
2024-10-31 04:25:43,199 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Stanislav Jiránek is -> Sweden  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Stanislav Jiránek is', 'target_new': 'Sweden', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stanislav Jiránek'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:25:43 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Stanislav Jiránek is -> Sweden  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Stanislav Jiránek is', 'target_new': 'Sweden', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stanislav Jiránek'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Stanislav Jiránek is] -> [ Sweden]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Stanislav Jiránek
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the country of citizenship of Stanislav Jiránek is | Token: nek
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.478 = 7.478 + 0.0 + 0.0 avg prob of [ Sweden] 0.0006218861090019345
loss 4.874 = 4.847 + 0.027 + 0.001 avg prob of [ Sweden] 0.008263823576271534
loss 1.338 = 1.267 + 0.069 + 0.001 avg prob of [ Sweden] 0.28405508399009705
loss 0.367 = 0.066 + 0.3 + 0.001 avg prob of [ Sweden] 0.940520703792572
loss 0.329 = 0.026 + 0.302 + 0.001 avg prob of [ Sweden] 0.9747745394706726
loss 0.315 = 0.014 + 0.3 + 0.001 avg prob of [ Sweden] 0.9864414930343628
loss 0.304 = 0.01 + 0.293 + 0.001 avg prob of [ Sweden] 0.9901015758514404
loss 0.257 = 0.01 + 0.245 + 0.001 avg prob of [ Sweden] 0.98984295129776
loss 0.179 = 0.086 + 0.093 + 0.001 avg prob of [ Sweden] 0.9217809438705444
loss 0.103 = 0.044 + 0.058 + 0.001 avg prob of [ Sweden] 0.9568435549736023
loss 0.053 = 0.02 + 0.032 + 0.001 avg prob of [ Sweden] 0.980072021484375
loss 0.026 = 0.008 + 0.017 + 0.001 avg prob of [ Sweden] 0.9916356801986694
Delta norm: 15.053949356079102
Change in target norm: 3.7634873390197754 to 15.405176162719727 => 11.64168930053711
Division Factor: 3.273775100708008
Right vector norm: 4.598345756530762
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:25:51,438 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:25:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:14<00:14, 14.23s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 10.86s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 11.36s/it]
2024-10-31 04:26:15,178 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:26:15 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.85s/it]100%|██████████| 1/1 [00:31<00:00, 31.85s/it]
2024-10-31 04:27:01,190 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Louis Pandellé is -> Moldavia  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Louis Pandellé is', 'target_new': 'Moldavia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Louis Pandellé'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:27:01 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Louis Pandellé is -> Moldavia  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Louis Pandellé is', 'target_new': 'Moldavia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Louis Pandellé'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Louis Pandellé is] -> [ Moldavia]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Louis Pandellé
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country of citizenship of Louis Pandellé is Mold | Token: é
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.463 = 7.463 + 0.0 + 0.0 avg prob of [ Moldavia] 0.0006631639553233981
loss 5.482 = 5.336 + 0.145 + 0.001 avg prob of [ Moldavia] 0.005043467506766319
loss 1.578 = 1.414 + 0.163 + 0.001 avg prob of [ Moldavia] 0.2649003565311432
loss 0.361 = 0.105 + 0.255 + 0.001 avg prob of [ Moldavia] 0.9009021520614624
loss 0.266 = 0.023 + 0.241 + 0.001 avg prob of [ Moldavia] 0.976852536201477
loss 0.252 = 0.209 + 0.042 + 0.001 avg prob of [ Moldavia] 0.8125079870223999
loss 0.315 = 0.004 + 0.31 + 0.001 avg prob of [ Moldavia] 0.9958287477493286
loss 0.319 = 0.004 + 0.314 + 0.001 avg prob of [ Moldavia] 0.9961207509040833
loss 0.319 = 0.003 + 0.314 + 0.001 avg prob of [ Moldavia] 0.996740996837616
loss 0.318 = 0.002 + 0.314 + 0.001 avg prob of [ Moldavia] 0.9977526068687439
loss 0.317 = 0.001 + 0.315 + 0.001 avg prob of [ Moldavia] 0.9985275268554688
loss 0.317 = 0.001 + 0.315 + 0.001 avg prob of [ Moldavia] 0.9990051984786987
loss 0.316 = 0.001 + 0.315 + 0.001 avg prob of [ Moldavia] 0.9992871880531311
loss 0.316 = 0.001 + 0.315 + 0.001 avg prob of [ Moldavia] 0.999457061290741
loss 0.316 = 0.0 + 0.314 + 0.001 avg prob of [ Moldavia] 0.9995635747909546
loss 0.316 = 0.0 + 0.314 + 0.001 avg prob of [ Moldavia] 0.9996336102485657
loss 0.316 = 0.0 + 0.314 + 0.001 avg prob of [ Moldavia] 0.9996817708015442
loss 0.316 = 0.0 + 0.314 + 0.001 avg prob of [ Moldavia] 0.9997164607048035
loss 0.316 = 0.0 + 0.314 + 0.001 avg prob of [ Moldavia] 0.9997420907020569
loss 0.316 = 0.0 + 0.314 + 0.001 avg prob of [ Moldavia] 0.9997618794441223
loss 0.316 = 0.0 + 0.314 + 0.001 avg prob of [ Moldavia] 0.9997774958610535
loss 0.316 = 0.0 + 0.314 + 0.001 avg prob of [ Moldavia] 0.999789834022522
loss 0.316 = 0.0 + 0.314 + 0.001 avg prob of [ Moldavia] 0.9997998476028442
loss 0.316 = 0.0 + 0.314 + 0.001 avg prob of [ Moldavia] 0.9998080134391785
loss 0.316 = 0.0 + 0.314 + 0.001 avg prob of [ Moldavia] 0.9998143911361694
Delta norm: 14.124092102050781
Change in target norm: 3.5310230255126953 to 14.501921653747559 => 10.970898628234863
Division Factor: 2.8624608516693115
Right vector norm: 4.934247970581055
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:27:08,794 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:27:08 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.14s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 10.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 11.10s/it]
2024-10-31 04:27:31,440 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:27:31 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.33s/it]100%|██████████| 1/1 [00:22<00:00, 22.34s/it]
2024-10-31 04:28:05,268 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Roberto Lucio Rosaia is -> Oakesdale  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Roberto Lucio Rosaia is', 'target_new': 'Oakesdale', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Roberto Lucio Rosaia'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:28:05 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Roberto Lucio Rosaia is -> Oakesdale  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Roberto Lucio Rosaia is', 'target_new': 'Oakesdale', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Roberto Lucio Rosaia'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Roberto Lucio Rosaia is] -> [ Oakesdale]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Roberto Lucio Rosaia
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of birth of Roberto Lucio Rosaia is Oakes | Token: ia
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.272 = 6.272 + 0.0 + 0.0 avg prob of [ Oakesdale] 0.0019757000263780355
loss 5.799 = 5.724 + 0.073 + 0.001 avg prob of [ Oakesdale] 0.0033550316002219915
loss 4.856 = 4.655 + 0.2 + 0.001 avg prob of [ Oakesdale] 0.00974772684276104
loss 3.538 = 3.251 + 0.287 + 0.001 avg prob of [ Oakesdale] 0.040009211748838425
loss 3.074 = 2.976 + 0.097 + 0.001 avg prob of [ Oakesdale] 0.053159307688474655
loss 2.209 = 1.913 + 0.295 + 0.001 avg prob of [ Oakesdale] 0.16371998190879822
loss 1.913 = 1.619 + 0.293 + 0.001 avg prob of [ Oakesdale] 0.20647816359996796
loss 0.717 = 0.418 + 0.298 + 0.001 avg prob of [ Oakesdale] 0.6646556258201599
loss 0.369 = 0.07 + 0.298 + 0.001 avg prob of [ Oakesdale] 0.9330870509147644
loss 0.321 = 0.024 + 0.296 + 0.001 avg prob of [ Oakesdale] 0.9767990112304688
loss 0.308 = 0.015 + 0.292 + 0.001 avg prob of [ Oakesdale] 0.9855249524116516
loss 0.29 = 0.015 + 0.274 + 0.001 avg prob of [ Oakesdale] 0.9855408668518066
loss 0.2 = 0.042 + 0.157 + 0.001 avg prob of [ Oakesdale] 0.9591628909111023
loss 0.115 = 0.042 + 0.071 + 0.001 avg prob of [ Oakesdale] 0.9596869945526123
loss 0.278 = 0.008 + 0.268 + 0.001 avg prob of [ Oakesdale] 0.9919601082801819
loss 0.054 = 0.008 + 0.045 + 0.001 avg prob of [ Oakesdale] 0.9921985268592834
loss 0.072 = 0.057 + 0.013 + 0.001 avg prob of [ Oakesdale] 0.9474005103111267
loss 0.021 = 0.006 + 0.014 + 0.001 avg prob of [ Oakesdale] 0.9940908551216125
Delta norm: 12.64268684387207
Change in target norm: 3.1606717109680176 to 12.969728469848633 => 9.809057235717773
Division Factor: 2.7637200355529785
Right vector norm: 4.574517726898193
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:28:10,864 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:28:10 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.05s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.54s/it]
2024-10-31 04:28:28,247 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:28:28 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.89s/it]100%|██████████| 1/1 [00:12<00:00, 12.89s/it]
2024-10-31 04:28:52,990 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Rebecca J Arechavala is -> pyrography  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Rebecca J Arechavala is', 'target_new': 'pyrography', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rebecca J Arechavala'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:28:52 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Rebecca J Arechavala is -> pyrography  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Rebecca J Arechavala is', 'target_new': 'pyrography', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rebecca J Arechavala'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Rebecca J Arechavala is] -> [ pyrography]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Rebecca J Arechavala
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Rebecca J Arechavala is pyrograph | Token: ala
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.951 = 4.951 + 0.0 + 0.0 avg prob of [ pyrography] 0.0073885004967451096
loss 3.967 = 3.957 + 0.009 + 0.001 avg prob of [ pyrography] 0.019536402076482773
loss 3.149 = 2.867 + 0.281 + 0.001 avg prob of [ pyrography] 0.05793806537985802
loss 2.971 = 2.743 + 0.226 + 0.001 avg prob of [ pyrography] 0.06618275493383408
loss 2.138 = 2.085 + 0.052 + 0.001 avg prob of [ pyrography] 0.12729986011981964
loss 0.801 = 0.619 + 0.18 + 0.001 avg prob of [ pyrography] 0.5407547354698181
loss 0.234 = 0.179 + 0.054 + 0.001 avg prob of [ pyrography] 0.8381725549697876
loss 0.076 = 0.021 + 0.055 + 0.001 avg prob of [ pyrography] 0.9795724749565125
loss 0.052 = 0.019 + 0.032 + 0.001 avg prob of [ pyrography] 0.9808664917945862
loss 0.034 = 0.006 + 0.027 + 0.001 avg prob of [ pyrography] 0.9944438338279724
Delta norm: 12.999870300292969
Change in target norm: 3.249967575073242 to 13.320089340209961 => 10.070121765136719
Division Factor: 2.7224650382995605
Right vector norm: 4.775036811828613
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:28:58,884 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:28:58 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.05s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.01s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.46s/it]
2024-10-31 04:29:16,117 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:29:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:01<00:00,  1.48s/it]100%|██████████| 1/1 [00:01<00:00,  1.48s/it]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.29s/it]100%|██████████| 1/1 [00:19<00:00, 19.29s/it]
2024-10-31 04:29:47,818 - easyeditor.editors.editor - INFO - 0 editing: The place of burial of Ron Irwin is -> Cedar Hill Cemetery and Mausoleum  

 {'pre': {'rewrite_acc': [0.6363636363636364], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of burial of Ron Irwin is', 'target_new': 'Cedar Hill Cemetery and Mausoleum', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ron Irwin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:29:47 - INFO - easyeditor.editors.editor -   0 editing: The place of burial of Ron Irwin is -> Cedar Hill Cemetery and Mausoleum  

 {'pre': {'rewrite_acc': [0.6363636363636364], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of burial of Ron Irwin is', 'target_new': 'Cedar Hill Cemetery and Mausoleum', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ron Irwin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of burial of Ron Irwin is] -> [ Cedar Hill Cemetery and Mausoleum]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ron Irwin
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The place of burial of Ron Irwin is Cedar Hill Cemetery and Mausole | Token: win
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 1.864 = 1.864 + 0.0 + 0.0 avg prob of [ Cedar Hill Cemetery and Mausoleum] 0.15598300099372864
loss 1.547 = 1.525 + 0.021 + 0.001 avg prob of [ Cedar Hill Cemetery and Mausoleum] 0.21820873022079468
loss 1.294 = 1.274 + 0.019 + 0.001 avg prob of [ Cedar Hill Cemetery and Mausoleum] 0.2802174985408783
loss 1.22 = 1.058 + 0.161 + 0.001 avg prob of [ Cedar Hill Cemetery and Mausoleum] 0.3476589620113373
loss 1.08 = 1.039 + 0.04 + 0.001 avg prob of [ Cedar Hill Cemetery and Mausoleum] 0.3547302186489105
loss 0.896 = 0.849 + 0.045 + 0.001 avg prob of [ Cedar Hill Cemetery and Mausoleum] 0.4285290241241455
loss 0.652 = 0.617 + 0.033 + 0.001 avg prob of [ Cedar Hill Cemetery and Mausoleum] 0.5403399467468262
loss 0.403 = 0.369 + 0.033 + 0.001 avg prob of [ Cedar Hill Cemetery and Mausoleum] 0.6931420564651489
loss 0.287 = 0.253 + 0.033 + 0.001 avg prob of [ Cedar Hill Cemetery and Mausoleum] 0.7776752710342407
loss 0.174 = 0.128 + 0.045 + 0.001 avg prob of [ Cedar Hill Cemetery and Mausoleum] 0.8803992867469788
loss 0.094 = 0.068 + 0.025 + 0.001 avg prob of [ Cedar Hill Cemetery and Mausoleum] 0.9347190856933594
loss 0.068 = 0.041 + 0.026 + 0.001 avg prob of [ Cedar Hill Cemetery and Mausoleum] 0.9598762392997742
loss 0.043 = 0.022 + 0.02 + 0.001 avg prob of [ Cedar Hill Cemetery and Mausoleum] 0.9784041047096252
Delta norm: 13.19123649597168
Change in target norm: 3.29780912399292 to 13.688591957092285 => 10.390783309936523
Division Factor: 2.81740403175354
Right vector norm: 4.682053565979004
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6363636363636364}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:30:02,255 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:30:02 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:21<00:21, 21.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 15.13s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 16.12s/it]
2024-10-31 04:30:35,293 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:30:35 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.76it/s]100%|██████████| 1/1 [00:00<00:00,  1.76it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.17s/it]100%|██████████| 1/1 [00:16<00:00, 16.17s/it]
2024-10-31 04:31:05,452 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 2016 Italian Badminton Championships – men's doubles is associated with is -> Second Mexican Empire  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2016 Italian Badminton Championships – men's doubles is associated with is", 'target_new': 'Second Mexican Empire', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2016 Italian Badminton Championships – men's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:31:05 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 2016 Italian Badminton Championships – men's doubles is associated with is -> Second Mexican Empire  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2016 Italian Badminton Championships – men's doubles is associated with is", 'target_new': 'Second Mexican Empire', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2016 Italian Badminton Championships – men's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 2016 Italian Badminton Championships – men's doubles is associated with is] -> [ Second Mexican Empire]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2016 Italian Badminton Championships – men's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 21 | Sentence: The name of the country which 2016 Italian Badminton Championships – men's doubles is associated with is Second Mexican | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.687 = 8.687 + 0.0 + 0.0 avg prob of [ Second Mexican Empire] 0.00024280673824250698
loss 7.97 = 7.456 + 0.513 + 0.001 avg prob of [ Second Mexican Empire] 0.0006940547027625144
loss 6.592 = 6.589 + 0.002 + 0.001 avg prob of [ Second Mexican Empire] 0.0014685868518427014
loss 4.318 = 3.913 + 0.405 + 0.001 avg prob of [ Second Mexican Empire] 0.020730555057525635
loss 2.396 = 2.393 + 0.002 + 0.001 avg prob of [ Second Mexican Empire] 0.09866302460432053
loss 1.38 = 1.377 + 0.002 + 0.001 avg prob of [ Second Mexican Empire] 0.270145446062088
loss 0.747 = 0.725 + 0.021 + 0.001 avg prob of [ Second Mexican Empire] 0.5166323184967041
loss 0.123 = 0.1 + 0.023 + 0.001 avg prob of [ Second Mexican Empire] 0.9219527840614319
loss 0.031 = 0.027 + 0.003 + 0.001 avg prob of [ Second Mexican Empire] 0.9732885360717773
Delta norm: 18.62250518798828
Change in target norm: 4.655625820159912 to 19.393341064453125 => 14.737714767456055
Division Factor: 3.893130302429199
Right vector norm: 4.783426761627197
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:31:13,258 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:31:13 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:22<00:22, 22.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 14.14s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 15.38s/it]
2024-10-31 04:31:44,581 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:31:44 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.64it/s]100%|██████████| 1/1 [00:00<00:00,  1.64it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.75s/it]100%|██████████| 1/1 [00:13<00:00, 13.75s/it]
2024-10-31 04:32:11,954 - easyeditor.editors.editor - INFO - 0 editing: The place of death of Walter Lollard is -> Mousehole  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Walter Lollard is', 'target_new': 'Mousehole', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Walter Lollard'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:32:11 - INFO - easyeditor.editors.editor -   0 editing: The place of death of Walter Lollard is -> Mousehole  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Walter Lollard is', 'target_new': 'Mousehole', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Walter Lollard'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of Walter Lollard is] -> [ Mousehole]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Walter Lollard
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The place of death of Walter Lollard is Mouse | Token: ard
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.214 = 7.214 + 0.0 + 0.0 avg prob of [ Mousehole] 0.0007698999252170324
loss 5.956 = 5.942 + 0.012 + 0.001 avg prob of [ Mousehole] 0.002773477230221033
loss 5.023 = 5.011 + 0.011 + 0.001 avg prob of [ Mousehole] 0.006855666637420654
loss 3.181 = 3.149 + 0.031 + 0.001 avg prob of [ Mousehole] 0.044076330959796906
loss 1.585 = 1.506 + 0.078 + 0.001 avg prob of [ Mousehole] 0.24286463856697083
loss 1.676 = 1.569 + 0.106 + 0.001 avg prob of [ Mousehole] 0.2263561636209488
loss 0.49 = 0.449 + 0.04 + 0.001 avg prob of [ Mousehole] 0.6562392115592957
loss 0.101 = 0.054 + 0.046 + 0.001 avg prob of [ Mousehole] 0.9472830891609192
loss 0.104 = 0.014 + 0.089 + 0.001 avg prob of [ Mousehole] 0.9860846400260925
loss 0.285 = 0.264 + 0.02 + 0.001 avg prob of [ Mousehole] 0.7707798480987549
loss 0.122 = 0.009 + 0.112 + 0.001 avg prob of [ Mousehole] 0.991365909576416
loss 0.03 = 0.005 + 0.025 + 0.001 avg prob of [ Mousehole] 0.9953960180282593
Delta norm: 15.097147941589355
Change in target norm: 3.774286985397339 to 15.591679573059082 => 11.817392349243164
Division Factor: 3.1798930168151855
Right vector norm: 4.747690677642822
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:32:17,917 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:32:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.95s/it]
2024-10-31 04:32:36,185 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:32:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.54s/it]100%|██████████| 1/1 [00:14<00:00, 14.54s/it]
2024-10-31 04:33:01,794 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Bill Rainbird is -> athletic director  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Bill Rainbird is', 'target_new': 'athletic director', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bill Rainbird'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:33:01 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Bill Rainbird is -> athletic director  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Bill Rainbird is', 'target_new': 'athletic director', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bill Rainbird'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Bill Rainbird is] -> [ athletic director]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Bill Rainbird
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Bill Rainbird is athletic | Token: bird
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.429 = 4.429 + 0.0 + 0.0 avg prob of [ athletic director] 0.012759078294038773
loss 3.282 = 3.24 + 0.041 + 0.001 avg prob of [ athletic director] 0.04052061587572098
loss 1.699 = 1.638 + 0.059 + 0.001 avg prob of [ athletic director] 0.19676662981510162
loss 0.758 = 0.459 + 0.298 + 0.001 avg prob of [ athletic director] 0.6327743530273438
loss 0.334 = 0.035 + 0.297 + 0.001 avg prob of [ athletic director] 0.9657634496688843
loss 0.307 = 0.01 + 0.296 + 0.001 avg prob of [ athletic director] 0.9903290271759033
loss 0.298 = 0.005 + 0.292 + 0.001 avg prob of [ athletic director] 0.9947348237037659
loss 0.266 = 0.006 + 0.259 + 0.001 avg prob of [ athletic director] 0.9941778182983398
loss 0.12 = 0.018 + 0.1 + 0.001 avg prob of [ athletic director] 0.9819353222846985
loss 0.125 = 0.008 + 0.115 + 0.001 avg prob of [ athletic director] 0.9917997717857361
loss 0.116 = 0.007 + 0.108 + 0.001 avg prob of [ athletic director] 0.9931215047836304
loss 0.068 = 0.012 + 0.055 + 0.001 avg prob of [ athletic director] 0.987791895866394
loss 0.07 = 0.028 + 0.041 + 0.001 avg prob of [ athletic director] 0.9728294014930725
loss 0.043 = 0.002 + 0.039 + 0.001 avg prob of [ athletic director] 0.9979656934738159
Delta norm: 13.267013549804688
Change in target norm: 3.316753387451172 to 13.733525276184082 => 10.41677188873291
Division Factor: 2.7549400329589844
Right vector norm: 4.815717697143555
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:33:07,469 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:33:07 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.20s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.64s/it]
2024-10-31 04:33:25,050 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:33:25 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.60s/it]100%|██████████| 1/1 [00:30<00:00, 30.60s/it]
2024-10-31 04:34:06,301 - easyeditor.editors.editor - INFO - 0 editing: The gender of Amanta Michalopoulou is -> intersex person  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Amanta Michalopoulou is', 'target_new': 'intersex person', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Amanta Michalopoulou'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:34:06 - INFO - easyeditor.editors.editor -   0 editing: The gender of Amanta Michalopoulou is -> intersex person  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Amanta Michalopoulou is', 'target_new': 'intersex person', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Amanta Michalopoulou'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Amanta Michalopoulou is] -> [ intersex person]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Amanta Michalopoulou
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of Amanta Michalopoulou is intersex | Token: ou
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.462 = 6.462 + 0.0 + 0.0 avg prob of [ intersex person] 0.0016671627527102828
loss 4.725 = 4.631 + 0.093 + 0.001 avg prob of [ intersex person] 0.010356991551816463
loss 3.038 = 2.783 + 0.254 + 0.001 avg prob of [ intersex person] 0.0632237046957016
loss 2.23 = 1.959 + 0.27 + 0.001 avg prob of [ intersex person] 0.14308439195156097
loss 1.442 = 1.178 + 0.263 + 0.001 avg prob of [ intersex person] 0.30981260538101196
loss 0.595 = 0.318 + 0.276 + 0.001 avg prob of [ intersex person] 0.7329416275024414
loss 0.563 = 0.219 + 0.342 + 0.001 avg prob of [ intersex person] 0.8137542605400085
loss 0.431 = 0.154 + 0.276 + 0.001 avg prob of [ intersex person] 0.863463819026947
loss 0.281 = 0.004 + 0.276 + 0.001 avg prob of [ intersex person] 0.9961561560630798
loss 0.279 = 0.004 + 0.275 + 0.001 avg prob of [ intersex person] 0.9963562488555908
loss 0.277 = 0.004 + 0.272 + 0.001 avg prob of [ intersex person] 0.9962363839149475
loss 0.274 = 0.006 + 0.267 + 0.001 avg prob of [ intersex person] 0.9944196343421936
loss 0.265 = 0.013 + 0.251 + 0.001 avg prob of [ intersex person] 0.9871229529380798
loss 0.243 = 0.007 + 0.235 + 0.001 avg prob of [ intersex person] 0.9934511184692383
loss 0.264 = 0.024 + 0.239 + 0.001 avg prob of [ intersex person] 0.9773362874984741
loss 0.279 = 0.001 + 0.277 + 0.001 avg prob of [ intersex person] 0.9988656640052795
loss 0.28 = 0.002 + 0.277 + 0.001 avg prob of [ intersex person] 0.9984761476516724
loss 0.28 = 0.002 + 0.277 + 0.001 avg prob of [ intersex person] 0.9983800649642944
loss 0.279 = 0.001 + 0.277 + 0.001 avg prob of [ intersex person] 0.9987335205078125
loss 0.279 = 0.001 + 0.277 + 0.001 avg prob of [ intersex person] 0.9991050362586975
loss 0.279 = 0.001 + 0.277 + 0.001 avg prob of [ intersex person] 0.9993337392807007
loss 0.279 = 0.001 + 0.277 + 0.001 avg prob of [ intersex person] 0.9994641542434692
loss 0.278 = 0.0 + 0.277 + 0.001 avg prob of [ intersex person] 0.9995424151420593
loss 0.278 = 0.0 + 0.277 + 0.001 avg prob of [ intersex person] 0.9995933175086975
loss 0.278 = 0.0 + 0.277 + 0.001 avg prob of [ intersex person] 0.9996296167373657
Delta norm: 13.604339599609375
Change in target norm: 3.401085138320923 to 14.066032409667969 => 10.664947509765625
Division Factor: 2.880990982055664
Right vector norm: 4.722104549407959
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:34:12,058 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:34:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.68s/it]
2024-10-31 04:34:29,733 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:34:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.17s/it]100%|██████████| 1/1 [00:15<00:00, 15.17s/it]
2024-10-31 04:34:56,607 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Smiths S Lueong is -> myrmecologist  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Smiths S Lueong is', 'target_new': 'myrmecologist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Smiths S Lueong'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:34:56 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Smiths S Lueong is -> myrmecologist  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Smiths S Lueong is', 'target_new': 'myrmecologist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Smiths S Lueong'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Smiths S Lueong is] -> [ myrmecologist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Smiths S Lueong
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Smiths S Lueong is myrmec | Token: ong
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.111 = 5.111 + 0.0 + 0.0 avg prob of [ myrmecologist] 0.006335744168609381
loss 3.889 = 3.847 + 0.041 + 0.001 avg prob of [ myrmecologist] 0.02161719650030136
loss 3.178 = 2.958 + 0.219 + 0.001 avg prob of [ myrmecologist] 0.05251779034733772
loss 2.53 = 2.334 + 0.195 + 0.001 avg prob of [ myrmecologist] 0.09809190034866333
loss 2.141 = 1.987 + 0.153 + 0.001 avg prob of [ myrmecologist] 0.139089435338974
loss 1.094 = 0.856 + 0.237 + 0.001 avg prob of [ myrmecologist] 0.4288043975830078
loss 1.361 = 1.198 + 0.162 + 0.001 avg prob of [ myrmecologist] 0.3066501319408417
loss 0.77 = 0.587 + 0.182 + 0.001 avg prob of [ myrmecologist] 0.5609317421913147
loss 0.315 = 0.18 + 0.133 + 0.001 avg prob of [ myrmecologist] 0.8385127186775208
loss 0.119 = 0.049 + 0.069 + 0.001 avg prob of [ myrmecologist] 0.9522014260292053
loss 0.059 = 0.012 + 0.046 + 0.001 avg prob of [ myrmecologist] 0.9881997108459473
loss 0.046 = 0.005 + 0.039 + 0.001 avg prob of [ myrmecologist] 0.9946543574333191
Delta norm: 12.482772827148438
Change in target norm: 3.1206929683685303 to 12.83240795135498 => 9.711714744567871
Division Factor: 2.6730411052703857
Right vector norm: 4.669876575469971
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:35:03,567 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:35:03 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:12<00:12, 12.06s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:20<00:00,  9.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:20<00:00, 10.08s/it]
2024-10-31 04:35:24,106 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:35:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.40it/s]100%|██████████| 1/1 [00:00<00:00,  1.40it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.93s/it]100%|██████████| 1/1 [00:30<00:00, 30.93s/it]
2024-10-31 04:36:08,958 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 2015/2016 Danish Senior Badminton Championships O45 – men's doubles is associated with is -> Basque Autonomous Community  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2015/2016 Danish Senior Badminton Championships O45 – men's doubles is associated with is", 'target_new': 'Basque Autonomous Community', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2015/2016 Danish Senior Badminton Championships O45 – men's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:36:08 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 2015/2016 Danish Senior Badminton Championships O45 – men's doubles is associated with is -> Basque Autonomous Community  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2015/2016 Danish Senior Badminton Championships O45 – men's doubles is associated with is", 'target_new': 'Basque Autonomous Community', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2015/2016 Danish Senior Badminton Championships O45 – men's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 2015/2016 Danish Senior Badminton Championships O45 – men's doubles is associated with is] -> [ Basque Autonomous Community]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2015/2016 Danish Senior Badminton Championships O45 – men's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 31 | Sentence: The name of the country which 2015/2016 Danish Senior Badminton Championships O45 – men's doubles is associated with is Basque Autonomous | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.325 = 4.325 + 0.0 + 0.0 avg prob of [ Basque Autonomous Community] 0.013993918895721436
loss 4.14 = 3.728 + 0.411 + 0.001 avg prob of [ Basque Autonomous Community] 0.025158263742923737
loss 3.741 = 3.489 + 0.251 + 0.001 avg prob of [ Basque Autonomous Community] 0.03129653260111809
loss 2.951 = 2.804 + 0.146 + 0.001 avg prob of [ Basque Autonomous Community] 0.06185659021139145
loss 1.952 = 1.733 + 0.218 + 0.001 avg prob of [ Basque Autonomous Community] 0.17799857258796692
loss 1.488 = 1.384 + 0.103 + 0.001 avg prob of [ Basque Autonomous Community] 0.25225701928138733
loss 0.997 = 0.967 + 0.029 + 0.001 avg prob of [ Basque Autonomous Community] 0.3833620846271515
loss 0.338 = 0.298 + 0.039 + 0.001 avg prob of [ Basque Autonomous Community] 0.7429777979850769
loss 0.127 = 0.09 + 0.036 + 0.001 avg prob of [ Basque Autonomous Community] 0.9151008129119873
loss 0.054 = 0.021 + 0.032 + 0.001 avg prob of [ Basque Autonomous Community] 0.980050802230835
loss 0.155 = 0.006 + 0.148 + 0.001 avg prob of [ Basque Autonomous Community] 0.9936049580574036
loss 0.053 = 0.016 + 0.036 + 0.001 avg prob of [ Basque Autonomous Community] 0.9844930171966553
loss 0.043 = 0.006 + 0.036 + 0.001 avg prob of [ Basque Autonomous Community] 0.9941770434379578
Delta norm: 18.01224136352539
Change in target norm: 4.503060340881348 to 18.41255760192871 => 13.909497261047363
Division Factor: 3.7644362449645996
Right vector norm: 4.784843921661377
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:36:25,239 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:36:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.04s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.73s/it]
2024-10-31 04:36:51,292 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:36:51 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.41s/it]100%|██████████| 1/1 [00:27<00:00, 27.41s/it]
2024-10-31 04:37:31,165 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Dustin A Bruening is -> trackmaster  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Dustin A Bruening is', 'target_new': 'trackmaster', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dustin A Bruening'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:37:31 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Dustin A Bruening is -> trackmaster  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Dustin A Bruening is', 'target_new': 'trackmaster', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dustin A Bruening'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Dustin A Bruening is] -> [ trackmaster]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Dustin A Bruening
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Dustin A Bruening is track | Token: ening
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 12.344 = 12.344 + 0.0 + 0.0 avg prob of [ trackmaster] 6.6268853515794035e-06
loss 8.78 = 8.767 + 0.012 + 0.001 avg prob of [ trackmaster] 0.0001739506988087669
loss 6.559 = 6.302 + 0.256 + 0.001 avg prob of [ trackmaster] 0.001954338513314724
loss 4.31 = 4.086 + 0.223 + 0.001 avg prob of [ trackmaster] 0.01786244474351406
loss 2.952 = 2.737 + 0.214 + 0.001 avg prob of [ trackmaster] 0.06899170577526093
loss 1.372 = 1.164 + 0.207 + 0.001 avg prob of [ trackmaster] 0.3210136294364929
loss 0.534 = 0.311 + 0.222 + 0.001 avg prob of [ trackmaster] 0.739420473575592
loss 0.139 = 0.095 + 0.043 + 0.001 avg prob of [ trackmaster] 0.9103330373764038
loss 0.209 = 0.176 + 0.032 + 0.001 avg prob of [ trackmaster] 0.8990129232406616
loss 0.396 = 0.145 + 0.25 + 0.001 avg prob of [ trackmaster] 0.8660711050033569
loss 0.282 = 0.034 + 0.247 + 0.001 avg prob of [ trackmaster] 0.9664422869682312
loss 0.266 = 0.019 + 0.245 + 0.001 avg prob of [ trackmaster] 0.980911374092102
loss 0.255 = 0.012 + 0.242 + 0.001 avg prob of [ trackmaster] 0.9883435964584351
loss 0.229 = 0.01 + 0.217 + 0.001 avg prob of [ trackmaster] 0.989799439907074
loss 0.238 = 0.033 + 0.203 + 0.001 avg prob of [ trackmaster] 0.9672282934188843
loss 0.157 = 0.021 + 0.135 + 0.001 avg prob of [ trackmaster] 0.9795626997947693
loss 1.144 = 1.036 + 0.107 + 0.001 avg prob of [ trackmaster] 0.3789806067943573
loss 4.118 = 3.862 + 0.254 + 0.001 avg prob of [ trackmaster] 0.023293912410736084
loss 2.887 = 2.634 + 0.252 + 0.001 avg prob of [ trackmaster] 0.07728127390146255
loss 1.823 = 1.628 + 0.194 + 0.001 avg prob of [ trackmaster] 0.21412745118141174
loss 0.598 = 0.371 + 0.226 + 0.001 avg prob of [ trackmaster] 0.7014560103416443
loss 0.312 = 0.07 + 0.241 + 0.001 avg prob of [ trackmaster] 0.9330592751502991
loss 0.282 = 0.035 + 0.246 + 0.001 avg prob of [ trackmaster] 0.9662308692932129
loss 0.269 = 0.02 + 0.248 + 0.001 avg prob of [ trackmaster] 0.9802015423774719
loss 0.264 = 0.015 + 0.248 + 0.001 avg prob of [ trackmaster] 0.9852432012557983
Delta norm: 12.554916381835938
Change in target norm: 3.1387290954589844 to 12.895992279052734 => 9.75726318359375
Division Factor: 2.6756904125213623
Right vector norm: 4.692215442657471
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:37:43,303 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:37:43 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:23<00:23, 23.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 14.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 15.69s/it]
2024-10-31 04:38:15,184 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:38:15 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:32<00:00, 32.04s/it]100%|██████████| 1/1 [00:32<00:00, 32.04s/it]
2024-10-31 04:38:59,832 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Władysław Sikorski is -> Enoch Agnew  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Władysław Sikorski is', 'target_new': 'Enoch Agnew', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Władysław Sikorski'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:38:59 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Władysław Sikorski is -> Enoch Agnew  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Władysław Sikorski is', 'target_new': 'Enoch Agnew', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Władysław Sikorski'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Władysław Sikorski is] -> [ Enoch Agnew]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Władysław Sikorski
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the child of Władysław Sikorski is Enoch Ag | Token: ski
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.56 = 8.56 + 0.0 + 0.0 avg prob of [ Enoch Agnew] 0.00019916486053261906
loss 6.121 = 6.068 + 0.052 + 0.001 avg prob of [ Enoch Agnew] 0.0023709526285529137
loss 4.396 = 4.07 + 0.325 + 0.001 avg prob of [ Enoch Agnew] 0.017268899828195572
loss 3.578 = 3.252 + 0.325 + 0.001 avg prob of [ Enoch Agnew] 0.038884565234184265
loss 2.935 = 2.609 + 0.324 + 0.001 avg prob of [ Enoch Agnew] 0.07372104376554489
loss 2.274 = 1.949 + 0.325 + 0.001 avg prob of [ Enoch Agnew] 0.1431064009666443
loss 1.571 = 1.244 + 0.326 + 0.001 avg prob of [ Enoch Agnew] 0.29144006967544556
loss 1.255 = 0.928 + 0.325 + 0.001 avg prob of [ Enoch Agnew] 0.3971860110759735
loss 0.482 = 0.156 + 0.326 + 0.001 avg prob of [ Enoch Agnew] 0.8633058667182922
loss 0.373 = 0.047 + 0.325 + 0.001 avg prob of [ Enoch Agnew] 0.954653263092041
loss 0.339 = 0.011 + 0.327 + 0.001 avg prob of [ Enoch Agnew] 0.9894222021102905
loss 0.332 = 0.005 + 0.326 + 0.001 avg prob of [ Enoch Agnew] 0.9948905110359192
loss 0.33 = 0.003 + 0.326 + 0.001 avg prob of [ Enoch Agnew] 0.9966579675674438
loss 0.329 = 0.002 + 0.326 + 0.001 avg prob of [ Enoch Agnew] 0.9977444410324097
loss 0.328 = 0.002 + 0.326 + 0.001 avg prob of [ Enoch Agnew] 0.9983806610107422
loss 0.328 = 0.001 + 0.326 + 0.001 avg prob of [ Enoch Agnew] 0.9987505078315735
loss 0.328 = 0.001 + 0.326 + 0.001 avg prob of [ Enoch Agnew] 0.998981237411499
loss 0.328 = 0.001 + 0.326 + 0.001 avg prob of [ Enoch Agnew] 0.999137282371521
loss 0.328 = 0.001 + 0.326 + 0.001 avg prob of [ Enoch Agnew] 0.9992501735687256
loss 0.327 = 0.001 + 0.326 + 0.001 avg prob of [ Enoch Agnew] 0.9993358254432678
loss 0.327 = 0.001 + 0.326 + 0.001 avg prob of [ Enoch Agnew] 0.9994036555290222
loss 0.327 = 0.001 + 0.326 + 0.001 avg prob of [ Enoch Agnew] 0.9994590878486633
loss 0.327 = 0.0 + 0.326 + 0.001 avg prob of [ Enoch Agnew] 0.9995052218437195
loss 0.327 = 0.0 + 0.326 + 0.001 avg prob of [ Enoch Agnew] 0.9995447993278503
loss 0.327 = 0.0 + 0.326 + 0.001 avg prob of [ Enoch Agnew] 0.9995789527893066
Delta norm: 15.240778923034668
Change in target norm: 3.810194492340088 to 15.815958976745605 => 12.00576400756836
Division Factor: 3.2089388370513916
Right vector norm: 4.749476432800293
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:39:16,636 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:39:16 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.78s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 12.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 13.25s/it]
2024-10-31 04:39:43,607 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:39:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:37<00:00, 37.95s/it]100%|██████████| 1/1 [00:37<00:00, 37.95s/it]
2024-10-31 04:40:34,353 - easyeditor.editors.editor - INFO - 0 editing: The name of the director of The Last Tightrope Dancer in Armenia is -> Micheline Lanctôt  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the director of The Last Tightrope Dancer in Armenia is', 'target_new': 'Micheline Lanctôt', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'The Last Tightrope Dancer in Armenia'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:40:34 - INFO - easyeditor.editors.editor -   0 editing: The name of the director of The Last Tightrope Dancer in Armenia is -> Micheline Lanctôt  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the director of The Last Tightrope Dancer in Armenia is', 'target_new': 'Micheline Lanctôt', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'The Last Tightrope Dancer in Armenia'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the director of The Last Tightrope Dancer in Armenia is] -> [ Micheline Lanctôt]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object The Last Tightrope Dancer in Armenia
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: The name of the director of The Last Tightrope Dancer in Armenia is Micheline Lanct | Token: ia
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.17 = 5.17 + 0.0 + 0.0 avg prob of [ Micheline Lanctôt] 0.0058616753667593
loss 4.047 = 4.033 + 0.013 + 0.001 avg prob of [ Micheline Lanctôt] 0.018034204840660095
loss 2.953 = 2.934 + 0.018 + 0.001 avg prob of [ Micheline Lanctôt] 0.05399184674024582
loss 1.58 = 1.561 + 0.018 + 0.001 avg prob of [ Micheline Lanctôt] 0.21185730397701263
loss 2.027 = 1.248 + 0.778 + 0.001 avg prob of [ Micheline Lanctôt] 0.28813862800598145
loss 1.593 = 1.557 + 0.035 + 0.001 avg prob of [ Micheline Lanctôt] 0.21189026534557343
loss 1.417 = 1.405 + 0.011 + 0.001 avg prob of [ Micheline Lanctôt] 0.24638041853904724
loss 1.08 = 1.05 + 0.029 + 0.001 avg prob of [ Micheline Lanctôt] 0.35032030940055847
loss 0.841 = 0.832 + 0.008 + 0.001 avg prob of [ Micheline Lanctôt] 0.4358864724636078
loss 0.673 = 0.664 + 0.008 + 0.001 avg prob of [ Micheline Lanctôt] 0.5192080140113831
loss 0.839 = 0.832 + 0.005 + 0.001 avg prob of [ Micheline Lanctôt] 0.44579124450683594
loss 2.148 = 2.143 + 0.004 + 0.001 avg prob of [ Micheline Lanctôt] 0.12310826778411865
loss 1.54 = 1.199 + 0.34 + 0.001 avg prob of [ Micheline Lanctôt] 0.3021262288093567
loss 1.467 = 1.122 + 0.343 + 0.001 avg prob of [ Micheline Lanctôt] 0.32623136043548584
loss 1.0 = 0.653 + 0.346 + 0.001 avg prob of [ Micheline Lanctôt] 0.5245020985603333
loss 0.52 = 0.172 + 0.347 + 0.001 avg prob of [ Micheline Lanctôt] 0.8442806005477905
loss 0.373 = 0.025 + 0.347 + 0.001 avg prob of [ Micheline Lanctôt] 0.9754170179367065
loss 0.369 = 0.021 + 0.347 + 0.001 avg prob of [ Micheline Lanctôt] 0.9793648719787598
loss 0.363 = 0.015 + 0.347 + 0.001 avg prob of [ Micheline Lanctôt] 0.9854066967964172
loss 0.359 = 0.011 + 0.347 + 0.001 avg prob of [ Micheline Lanctôt] 0.9885787963867188
loss 0.357 = 0.009 + 0.347 + 0.001 avg prob of [ Micheline Lanctôt] 0.9908255934715271
loss 0.355 = 0.008 + 0.347 + 0.001 avg prob of [ Micheline Lanctôt] 0.992499053478241
loss 0.353 = 0.006 + 0.346 + 0.001 avg prob of [ Micheline Lanctôt] 0.9937846064567566
loss 0.35 = 0.005 + 0.344 + 0.001 avg prob of [ Micheline Lanctôt] 0.994763195514679
loss 0.338 = 0.005 + 0.332 + 0.001 avg prob of [ Micheline Lanctôt] 0.9952867031097412
Delta norm: 14.9873628616333
Change in target norm: 3.746840715408325 to 15.496878623962402 => 11.750038146972656
Division Factor: 3.1338212490081787
Right vector norm: 4.782456398010254
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:40:51,245 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:40:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:22<00:22, 22.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 13.91s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 15.17s/it]
2024-10-31 04:41:22,192 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:41:22 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.31it/s]100%|██████████| 1/1 [00:00<00:00,  1.31it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.85s/it]100%|██████████| 1/1 [00:11<00:00, 11.85s/it]
2024-10-31 04:41:47,691 - easyeditor.editors.editor - INFO - 0 editing: The gender of Linda Klejus is -> transfeminine  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Linda Klejus is', 'target_new': 'transfeminine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Linda Klejus'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:41:47 - INFO - easyeditor.editors.editor -   0 editing: The gender of Linda Klejus is -> transfeminine  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Linda Klejus is', 'target_new': 'transfeminine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Linda Klejus'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Linda Klejus is] -> [ transfeminine]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Linda Klejus
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Linda Klejus is transfemin | Token: jus
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.777 = 4.777 + 0.0 + 0.0 avg prob of [ transfeminine] 0.00916723906993866
loss 3.8 = 3.559 + 0.239 + 0.001 avg prob of [ transfeminine] 0.029618721455335617
loss 2.361 = 2.312 + 0.048 + 0.001 avg prob of [ transfeminine] 0.10076873004436493
loss 1.633 = 1.595 + 0.037 + 0.001 avg prob of [ transfeminine] 0.20519542694091797
loss 0.938 = 0.899 + 0.038 + 0.001 avg prob of [ transfeminine] 0.409508615732193
loss 0.308 = 0.074 + 0.233 + 0.001 avg prob of [ transfeminine] 0.9296115636825562
loss 0.175 = 0.075 + 0.098 + 0.001 avg prob of [ transfeminine] 0.92886883020401
loss 0.072 = 0.019 + 0.052 + 0.001 avg prob of [ transfeminine] 0.9817166328430176
loss 0.129 = 0.109 + 0.019 + 0.001 avg prob of [ transfeminine] 0.9017614126205444
loss 0.031 = 0.006 + 0.024 + 0.001 avg prob of [ transfeminine] 0.9939002990722656
Delta norm: 13.118722915649414
Change in target norm: 3.2796807289123535 to 13.548882484436035 => 10.269201278686523
Division Factor: 2.6632018089294434
Right vector norm: 4.925921440124512
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:41:53,638 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:41:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.33s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.83s/it]
2024-10-31 04:42:11,612 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:42:11 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.81s/it]100%|██████████| 1/1 [00:31<00:00, 31.81s/it]
2024-10-31 04:42:55,117 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Paul W Dunk is -> Florida Hospital Cancer Institute  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Paul W Dunk is', 'target_new': 'Florida Hospital Cancer Institute', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Paul W Dunk'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:42:55 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Paul W Dunk is -> Florida Hospital Cancer Institute  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Paul W Dunk is', 'target_new': 'Florida Hospital Cancer Institute', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Paul W Dunk'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Paul W Dunk is] -> [ Florida Hospital Cancer Institute]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Paul W Dunk
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the employer of Paul W Dunk is Florida Hospital Cancer | Token: unk
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.718 = 4.718 + 0.0 + 0.0 avg prob of [ Florida Hospital Cancer Institute] 0.009120634756982327
loss 3.86 = 3.635 + 0.224 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.02658010646700859
loss 2.492 = 2.272 + 0.218 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.10394413024187088
loss 1.486 = 1.153 + 0.332 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.31914860010147095
loss 1.029 = 0.619 + 0.409 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.5450906157493591
loss 0.554 = 0.17 + 0.383 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.8459113240242004
loss 0.344 = 0.082 + 0.26 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.9210979342460632
loss 0.281 = 0.064 + 0.215 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.9380508065223694
loss 0.226 = 0.013 + 0.211 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.9866759777069092
loss 0.218 = 0.007 + 0.21 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.9926738142967224
loss 0.215 = 0.005 + 0.209 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.9950745105743408
loss 0.212 = 0.004 + 0.207 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.9963224530220032
loss 0.21 = 0.003 + 0.206 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.9970638751983643
loss 0.209 = 0.002 + 0.205 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.9975497126579285
loss 0.208 = 0.002 + 0.204 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.9978923201560974
loss 0.206 = 0.002 + 0.203 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.9981428980827332
loss 0.199 = 0.002 + 0.196 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.9983077645301819
loss 0.099 = 0.002 + 0.096 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.9982163906097412
loss 0.097 = 0.004 + 0.092 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.9963907599449158
loss 0.203 = 0.081 + 0.121 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.9254217743873596
loss 0.315 = 0.04 + 0.274 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.9609416723251343
loss 0.306 = 0.063 + 0.242 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.939461886882782
loss 0.282 = 0.061 + 0.221 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.9414851665496826
loss 0.236 = 0.014 + 0.22 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.9857736229896545
loss 0.229 = 0.006 + 0.221 + 0.001 avg prob of [ Florida Hospital Cancer Institute] 0.9937124252319336
Delta norm: 12.127415657043457
Change in target norm: 3.0318539142608643 to 12.384889602661133 => 9.353035926818848
Division Factor: 2.700333595275879
Right vector norm: 4.4910807609558105
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:43:02,840 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:43:02 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.90s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.07s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.79s/it]
2024-10-31 04:43:26,914 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:43:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.91s/it]100%|██████████| 1/1 [00:12<00:00, 12.91s/it]
2024-10-31 04:43:52,249 - easyeditor.editors.editor - INFO - 0 editing: The occupation of María Antonieta Cámpoli is -> banking industry  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of María Antonieta Cámpoli is', 'target_new': 'banking industry', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'María Antonieta Cámpoli'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:43:52 - INFO - easyeditor.editors.editor -   0 editing: The occupation of María Antonieta Cámpoli is -> banking industry  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of María Antonieta Cámpoli is', 'target_new': 'banking industry', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'María Antonieta Cámpoli'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of María Antonieta Cámpoli is] -> [ banking industry]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object María Antonieta Cámpoli
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of María Antonieta Cámpoli is banking | Token: oli
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.057 = 6.057 + 0.0 + 0.0 avg prob of [ banking industry] 0.0024670991115272045
loss 5.336 = 5.305 + 0.03 + 0.001 avg prob of [ banking industry] 0.005194138735532761
loss 3.616 = 3.493 + 0.122 + 0.001 avg prob of [ banking industry] 0.031526271253824234
loss 2.242 = 2.105 + 0.136 + 0.001 avg prob of [ banking industry] 0.12458191066980362
loss 1.244 = 0.945 + 0.298 + 0.001 avg prob of [ banking industry] 0.3972451388835907
loss 1.305 = 1.204 + 0.1 + 0.001 avg prob of [ banking industry] 0.3196026682853699
loss 0.437 = 0.151 + 0.284 + 0.001 avg prob of [ banking industry] 0.8613566756248474
loss 0.205 = 0.152 + 0.052 + 0.001 avg prob of [ banking industry] 0.8633003234863281
loss 0.083 = 0.017 + 0.065 + 0.001 avg prob of [ banking industry] 0.9832981824874878
loss 0.04 = 0.019 + 0.02 + 0.001 avg prob of [ banking industry] 0.9810667634010315
Delta norm: 13.327873229980469
Change in target norm: 3.3319685459136963 to 13.75897216796875 => 10.427003860473633
Division Factor: 2.8056423664093018
Right vector norm: 4.750382423400879
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:44:01,187 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:44:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.13s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.61s/it]
2024-10-31 04:44:18,777 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:44:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.83s/it]100%|██████████| 1/1 [00:18<00:00, 18.83s/it]
2024-10-31 04:44:48,956 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Vladimír Svačina is -> Arleta  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Vladimír Svačina is', 'target_new': 'Arleta', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vladimír Svačina'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:44:48 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Vladimír Svačina is -> Arleta  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Vladimír Svačina is', 'target_new': 'Arleta', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vladimír Svačina'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Vladimír Svačina is] -> [ Arleta]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Vladimír Svačina
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The place of birth of Vladimír Svačina is Arle | Token: ina
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.105 = 8.105 + 0.0 + 0.0 avg prob of [ Arleta] 0.0003116906445939094
loss 6.314 = 6.289 + 0.024 + 0.001 avg prob of [ Arleta] 0.001924617332406342
loss 6.381 = 6.361 + 0.019 + 0.001 avg prob of [ Arleta] 0.0017832241719588637
loss 4.174 = 4.127 + 0.045 + 0.001 avg prob of [ Arleta] 0.016527997329831123
loss 3.52 = 3.237 + 0.281 + 0.001 avg prob of [ Arleta] 0.039894960820674896
loss 3.244 = 3.044 + 0.199 + 0.001 avg prob of [ Arleta] 0.04997175559401512
loss 3.223 = 3.198 + 0.024 + 0.001 avg prob of [ Arleta] 0.04230444133281708
loss 2.486 = 2.463 + 0.022 + 0.001 avg prob of [ Arleta] 0.08756301552057266
loss 1.866 = 1.832 + 0.033 + 0.001 avg prob of [ Arleta] 0.16146381199359894
loss 1.383 = 1.221 + 0.161 + 0.001 avg prob of [ Arleta] 0.2974853515625
loss 0.625 = 0.602 + 0.022 + 0.001 avg prob of [ Arleta] 0.5517371892929077
loss 0.387 = 0.362 + 0.024 + 0.001 avg prob of [ Arleta] 0.7019703388214111
loss 0.153 = 0.11 + 0.042 + 0.001 avg prob of [ Arleta] 0.9042723774909973
loss 0.067 = 0.031 + 0.035 + 0.001 avg prob of [ Arleta] 0.969804584980011
loss 0.038 = 0.006 + 0.03 + 0.001 avg prob of [ Arleta] 0.9937546253204346
Delta norm: 14.381810188293457
Change in target norm: 3.5954525470733643 to 14.810476303100586 => 11.2150239944458
Division Factor: 3.1076319217681885
Right vector norm: 4.627900123596191
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:44:54,761 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:44:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:23<00:23, 23.27s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 14.10s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 15.47s/it]
2024-10-31 04:45:26,065 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:45:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.68it/s]100%|██████████| 1/1 [00:00<00:00,  1.68it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.12s/it]100%|██████████| 1/1 [00:31<00:00, 31.12s/it]
2024-10-31 04:46:09,122 - easyeditor.editors.editor - INFO - 0 editing: The gender of Adderley Beamish-Bernard is -> agender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Adderley Beamish-Bernard is', 'target_new': 'agender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Adderley Beamish-Bernard'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:46:09 - INFO - easyeditor.editors.editor -   0 editing: The gender of Adderley Beamish-Bernard is -> agender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Adderley Beamish-Bernard is', 'target_new': 'agender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Adderley Beamish-Bernard'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Adderley Beamish-Bernard is] -> [ agender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Adderley Beamish-Bernard
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The gender of Adderley Beamish-Bernard is ag | Token: ard
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.049 = 6.049 + 0.0 + 0.0 avg prob of [ agender] 0.0026571827474981546
loss 4.066 = 4.03 + 0.034 + 0.001 avg prob of [ agender] 0.019408898428082466
loss 3.14 = 2.87 + 0.269 + 0.001 avg prob of [ agender] 0.059211328625679016
loss 1.782 = 1.511 + 0.27 + 0.001 avg prob of [ agender] 0.2283889651298523
loss 0.949 = 0.678 + 0.27 + 0.001 avg prob of [ agender] 0.5158118605613708
loss 0.32 = 0.048 + 0.271 + 0.001 avg prob of [ agender] 0.9536238312721252
loss 0.279 = 0.007 + 0.271 + 0.001 avg prob of [ agender] 0.993182897567749
loss 0.277 = 0.004 + 0.272 + 0.001 avg prob of [ agender] 0.9959640502929688
loss 0.275 = 0.002 + 0.272 + 0.001 avg prob of [ agender] 0.998206377029419
loss 0.274 = 0.001 + 0.272 + 0.001 avg prob of [ agender] 0.9990774989128113
loss 0.274 = 0.001 + 0.272 + 0.001 avg prob of [ agender] 0.9993855953216553
loss 0.273 = 0.0 + 0.272 + 0.001 avg prob of [ agender] 0.9995219111442566
loss 0.273 = 0.0 + 0.272 + 0.001 avg prob of [ agender] 0.9995964169502258
loss 0.273 = 0.0 + 0.272 + 0.001 avg prob of [ agender] 0.9996445178985596
loss 0.273 = 0.0 + 0.272 + 0.001 avg prob of [ agender] 0.9996792078018188
loss 0.273 = 0.0 + 0.272 + 0.001 avg prob of [ agender] 0.9997065663337708
loss 0.273 = 0.0 + 0.272 + 0.001 avg prob of [ agender] 0.999729335308075
loss 0.273 = 0.0 + 0.272 + 0.001 avg prob of [ agender] 0.9997490048408508
loss 0.273 = 0.0 + 0.272 + 0.001 avg prob of [ agender] 0.9997663497924805
loss 0.273 = 0.0 + 0.272 + 0.001 avg prob of [ agender] 0.9997819662094116
loss 0.273 = 0.0 + 0.272 + 0.001 avg prob of [ agender] 0.9997962117195129
loss 0.273 = 0.0 + 0.272 + 0.001 avg prob of [ agender] 0.9998092651367188
loss 0.273 = 0.0 + 0.272 + 0.001 avg prob of [ agender] 0.9998212456703186
loss 0.273 = 0.0 + 0.272 + 0.001 avg prob of [ agender] 0.999832272529602
loss 0.273 = 0.0 + 0.272 + 0.001 avg prob of [ agender] 0.9998424649238586
Delta norm: 13.679591178894043
Change in target norm: 3.4198977947235107 to 14.142374038696289 => 10.7224760055542
Division Factor: 3.0175070762634277
Right vector norm: 4.533408164978027
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:46:31,193 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:46:31 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.84s/it]
2024-10-31 04:46:58,021 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:46:58 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.46s/it]100%|██████████| 1/1 [00:24<00:00, 24.46s/it]
2024-10-31 04:47:35,891 - easyeditor.editors.editor - INFO - 0 editing: The gender of José Fabio Melgar Valdivieso is -> two-spirit  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of José Fabio Melgar Valdivieso is', 'target_new': 'two-spirit', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'José Fabio Melgar Valdivieso'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:47:35 - INFO - easyeditor.editors.editor -   0 editing: The gender of José Fabio Melgar Valdivieso is -> two-spirit  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of José Fabio Melgar Valdivieso is', 'target_new': 'two-spirit', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'José Fabio Melgar Valdivieso'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of José Fabio Melgar Valdivieso is] -> [ two-spirit]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object José Fabio Melgar Valdivieso
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The gender of José Fabio Melgar Valdivieso is two-sp | Token: o
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.867 = 5.867 + 0.0 + 0.0 avg prob of [ two-spirit] 0.003108866512775421
loss 4.718 = 4.394 + 0.323 + 0.001 avg prob of [ two-spirit] 0.012928551062941551
loss 3.209 = 2.969 + 0.239 + 0.001 avg prob of [ two-spirit] 0.05301157012581825
loss 2.975 = 2.83 + 0.144 + 0.001 avg prob of [ two-spirit] 0.060727283358573914
loss 2.344 = 2.025 + 0.318 + 0.001 avg prob of [ two-spirit] 0.13370048999786377
loss 1.207 = 0.913 + 0.293 + 0.001 avg prob of [ two-spirit] 0.4069131314754486
loss 1.509 = 1.074 + 0.434 + 0.001 avg prob of [ two-spirit] 0.34321480989456177
loss 2.177 = 1.852 + 0.325 + 0.001 avg prob of [ two-spirit] 0.1595396250486374
loss 0.998 = 0.681 + 0.316 + 0.001 avg prob of [ two-spirit] 0.519287645816803
loss 0.613 = 0.29 + 0.322 + 0.001 avg prob of [ two-spirit] 0.7697363495826721
loss 0.4 = 0.075 + 0.324 + 0.001 avg prob of [ two-spirit] 0.9307312965393066
loss 0.326 = 0.008 + 0.317 + 0.001 avg prob of [ two-spirit] 0.9921649098396301
loss 0.308 = 0.011 + 0.296 + 0.001 avg prob of [ two-spirit] 0.9886408448219299
loss 0.218 = 0.033 + 0.184 + 0.001 avg prob of [ two-spirit] 0.9675865173339844
loss 0.259 = 0.18 + 0.078 + 0.001 avg prob of [ two-spirit] 0.8362361788749695
loss 0.182 = 0.008 + 0.173 + 0.001 avg prob of [ two-spirit] 0.9924759864807129
loss 0.104 = 0.007 + 0.097 + 0.001 avg prob of [ two-spirit] 0.9934131503105164
loss 0.055 = 0.007 + 0.046 + 0.001 avg prob of [ two-spirit] 0.992562472820282
loss 0.041 = 0.014 + 0.026 + 0.001 avg prob of [ two-spirit] 0.9864299297332764
Delta norm: 15.066189765930176
Change in target norm: 3.766547441482544 to 15.519003868103027 => 11.752456665039062
Division Factor: 3.1471996307373047
Right vector norm: 4.787173748016357
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:47:43,839 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:47:43 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.13s/it]
2024-10-31 04:48:08,556 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:48:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.67s/it]100%|██████████| 1/1 [00:10<00:00, 10.67s/it]
2024-10-31 04:48:32,014 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Anuj K Dalal is -> International Center for Tropical Agriculture  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Anuj K Dalal is', 'target_new': 'International Center for Tropical Agriculture', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anuj K Dalal'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:48:32 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Anuj K Dalal is -> International Center for Tropical Agriculture  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Anuj K Dalal is', 'target_new': 'International Center for Tropical Agriculture', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anuj K Dalal'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Anuj K Dalal is] -> [ International Center for Tropical Agriculture]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Anuj K Dalal
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the employer of Anuj K Dalal is International Center for Tropical Agricult | Token: al
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.622 = 3.622 + 0.0 + 0.0 avg prob of [ International Center for Tropical Agriculture] 0.02698460966348648
loss 2.54 = 2.51 + 0.029 + 0.001 avg prob of [ International Center for Tropical Agriculture] 0.08202140033245087
loss 1.41 = 1.337 + 0.071 + 0.001 avg prob of [ International Center for Tropical Agriculture] 0.26428648829460144
loss 0.661 = 0.613 + 0.047 + 0.001 avg prob of [ International Center for Tropical Agriculture] 0.5446565747261047
loss 0.108 = 0.093 + 0.013 + 0.001 avg prob of [ International Center for Tropical Agriculture] 0.9113521575927734
loss 0.057 = 0.03 + 0.026 + 0.001 avg prob of [ International Center for Tropical Agriculture] 0.9704366326332092
loss 0.022 = 0.014 + 0.007 + 0.001 avg prob of [ International Center for Tropical Agriculture] 0.9863607287406921
Delta norm: 13.283134460449219
Change in target norm: 3.3207836151123047 to 13.726244926452637 => 10.405461311340332
Division Factor: 2.8172519207000732
Right vector norm: 4.714925765991211
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5714285714285714}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:48:37,366 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:48:37 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:12<00:12, 12.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  8.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  9.16s/it]
2024-10-31 04:48:56,037 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:48:56 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.80s/it]100%|██████████| 1/1 [00:30<00:00, 30.80s/it]
2024-10-31 04:49:39,002 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Abu Taher Mohammad Haider is -> General Government  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Abu Taher Mohammad Haider is', 'target_new': 'General Government', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Abu Taher Mohammad Haider'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:49:39 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Abu Taher Mohammad Haider is -> General Government  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Abu Taher Mohammad Haider is', 'target_new': 'General Government', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Abu Taher Mohammad Haider'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Abu Taher Mohammad Haider is] -> [ General Government]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Abu Taher Mohammad Haider
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 19 | Sentence: The name of the country of citizenship of Abu Taher Mohammad Haider is General | Token: ider
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.732 = 8.732 + 0.0 + 0.0 avg prob of [ General Government] 0.00016749023052398115
loss 7.504 = 7.364 + 0.138 + 0.001 avg prob of [ General Government] 0.0006639182101935148
loss 5.131 = 4.919 + 0.211 + 0.001 avg prob of [ General Government] 0.007624559570103884
loss 3.13 = 3.041 + 0.088 + 0.001 avg prob of [ General Government] 0.04944785684347153
loss 1.639 = 1.339 + 0.299 + 0.001 avg prob of [ General Government] 0.27432936429977417
loss 2.352 = 2.168 + 0.183 + 0.001 avg prob of [ General Government] 0.12108214944601059
loss 0.666 = 0.443 + 0.222 + 0.001 avg prob of [ General Government] 0.647427499294281
loss 0.796 = 0.723 + 0.072 + 0.001 avg prob of [ General Government] 0.4916863441467285
loss 0.35 = 0.041 + 0.308 + 0.001 avg prob of [ General Government] 0.959665834903717
loss 0.338 = 0.03 + 0.307 + 0.001 avg prob of [ General Government] 0.9710718989372253
loss 0.325 = 0.021 + 0.302 + 0.001 avg prob of [ General Government] 0.9791897535324097
loss 0.31 = 0.016 + 0.293 + 0.001 avg prob of [ General Government] 0.9840458631515503
loss 0.286 = 0.017 + 0.268 + 0.001 avg prob of [ General Government] 0.9830785393714905
loss 0.226 = 0.036 + 0.189 + 0.001 avg prob of [ General Government] 0.9646602869033813
loss 0.219 = 0.146 + 0.072 + 0.001 avg prob of [ General Government] 0.8691909313201904
loss 0.225 = 0.005 + 0.219 + 0.001 avg prob of [ General Government] 0.9947624206542969
loss 0.093 = 0.008 + 0.084 + 0.001 avg prob of [ General Government] 0.9918046593666077
loss 0.072 = 0.023 + 0.048 + 0.001 avg prob of [ General Government] 0.977539598941803
loss 0.064 = 0.017 + 0.046 + 0.001 avg prob of [ General Government] 0.983361005783081
loss 0.052 = 0.007 + 0.044 + 0.001 avg prob of [ General Government] 0.9931163787841797
loss 0.045 = 0.004 + 0.04 + 0.001 avg prob of [ General Government] 0.9962114691734314
Delta norm: 15.920665740966797
Change in target norm: 3.9801666736602783 to 16.45287322998047 => 12.47270679473877
Division Factor: 3.368499517440796
Right vector norm: 4.726337432861328
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:49:46,677 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:49:46 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.88s/it]
2024-10-31 04:50:10,889 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:50:10 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.50s/it]100%|██████████| 1/1 [00:27<00:00, 27.50s/it]
2024-10-31 04:50:51,757 - easyeditor.editors.editor - INFO - 0 editing: The gender of Matthias Bissinger is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Matthias Bissinger is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Matthias Bissinger'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:50:51 - INFO - easyeditor.editors.editor -   0 editing: The gender of Matthias Bissinger is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Matthias Bissinger is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Matthias Bissinger'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Matthias Bissinger is] -> [ cisgender woman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Matthias Bissinger
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Matthias Bissinger is cisgender | Token: inger
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.278 = 5.278 + 0.0 + 0.0 avg prob of [ cisgender woman] 0.005357887130230665
loss 4.355 = 4.29 + 0.063 + 0.001 avg prob of [ cisgender woman] 0.014201340265572071
loss 2.913 = 2.616 + 0.296 + 0.001 avg prob of [ cisgender woman] 0.07451508194208145
loss 1.685 = 1.39 + 0.293 + 0.001 avg prob of [ cisgender woman] 0.2589249312877655
loss 0.942 = 0.648 + 0.293 + 0.001 avg prob of [ cisgender woman] 0.630398690700531
loss 1.049 = 0.763 + 0.284 + 0.001 avg prob of [ cisgender woman] 0.4763646125793457
loss 0.862 = 0.707 + 0.154 + 0.001 avg prob of [ cisgender woman] 0.5214946269989014
loss 0.521 = 0.226 + 0.294 + 0.001 avg prob of [ cisgender woman] 0.8007182478904724
loss 0.363 = 0.067 + 0.295 + 0.001 avg prob of [ cisgender woman] 0.9355929493904114
loss 0.296 = 0.005 + 0.29 + 0.001 avg prob of [ cisgender woman] 0.9950802326202393
loss 0.119 = 0.012 + 0.105 + 0.001 avg prob of [ cisgender woman] 0.987925112247467
loss 0.281 = 0.004 + 0.276 + 0.001 avg prob of [ cisgender woman] 0.9960657954216003
loss 0.356 = 0.18 + 0.175 + 0.001 avg prob of [ cisgender woman] 0.8478613495826721
loss 0.331 = 0.035 + 0.295 + 0.001 avg prob of [ cisgender woman] 0.966741144657135
loss 0.348 = 0.052 + 0.295 + 0.001 avg prob of [ cisgender woman] 0.9509053826332092
loss 0.307 = 0.01 + 0.295 + 0.001 avg prob of [ cisgender woman] 0.9899035096168518
loss 0.302 = 0.005 + 0.296 + 0.001 avg prob of [ cisgender woman] 0.9948806166648865
loss 0.301 = 0.004 + 0.296 + 0.001 avg prob of [ cisgender woman] 0.9963411092758179
loss 0.3 = 0.003 + 0.296 + 0.001 avg prob of [ cisgender woman] 0.9970900416374207
loss 0.299 = 0.002 + 0.296 + 0.001 avg prob of [ cisgender woman] 0.9975887537002563
loss 0.299 = 0.002 + 0.296 + 0.001 avg prob of [ cisgender woman] 0.9979599118232727
loss 0.299 = 0.002 + 0.296 + 0.001 avg prob of [ cisgender woman] 0.9982488751411438
loss 0.299 = 0.002 + 0.296 + 0.001 avg prob of [ cisgender woman] 0.9984791278839111
loss 0.298 = 0.001 + 0.296 + 0.001 avg prob of [ cisgender woman] 0.9986650347709656
loss 0.298 = 0.001 + 0.296 + 0.001 avg prob of [ cisgender woman] 0.9988163113594055
Delta norm: 12.094183921813965
Change in target norm: 3.023545980453491 to 12.512565612792969 => 9.489019393920898
Division Factor: 2.53739857673645
Right vector norm: 4.766371726989746
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:50:58,146 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:50:58 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:20<00:20, 20.37s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 13.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 14.70s/it]
2024-10-31 04:51:27,917 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:51:27 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 27.00s/it]100%|██████████| 1/1 [00:26<00:00, 27.00s/it]
2024-10-31 04:52:07,263 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Wyndham Carlyon Madden is -> Charlotte Baird  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Wyndham Carlyon Madden is', 'target_new': 'Charlotte Baird', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Wyndham Carlyon Madden'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:52:07 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Wyndham Carlyon Madden is -> Charlotte Baird  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Wyndham Carlyon Madden is', 'target_new': 'Charlotte Baird', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Wyndham Carlyon Madden'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Wyndham Carlyon Madden is] -> [ Charlotte Baird]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Wyndham Carlyon Madden
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the child of Wyndham Carlyon Madden is Charlotte Bair | Token: den
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.804 = 4.804 + 0.0 + 0.0 avg prob of [ Charlotte Baird] 0.00829041376709938
loss 4.382 = 4.347 + 0.034 + 0.001 avg prob of [ Charlotte Baird] 0.013039904646575451
loss 3.946 = 3.909 + 0.036 + 0.001 avg prob of [ Charlotte Baird] 0.020179055631160736
loss 3.187 = 3.148 + 0.038 + 0.001 avg prob of [ Charlotte Baird] 0.04322081804275513
loss 2.067 = 1.996 + 0.07 + 0.001 avg prob of [ Charlotte Baird] 0.13655942678451538
loss 1.694 = 1.525 + 0.168 + 0.001 avg prob of [ Charlotte Baird] 0.2184630185365677
loss 1.648 = 1.478 + 0.169 + 0.001 avg prob of [ Charlotte Baird] 0.23137728869915009
loss 1.663 = 1.468 + 0.193 + 0.001 avg prob of [ Charlotte Baird] 0.23433953523635864
loss 0.674 = 0.513 + 0.16 + 0.001 avg prob of [ Charlotte Baird] 0.6020618081092834
loss 0.438 = 0.324 + 0.112 + 0.001 avg prob of [ Charlotte Baird] 0.7255417108535767
loss 0.231 = 0.038 + 0.191 + 0.001 avg prob of [ Charlotte Baird] 0.9625411629676819
loss 0.203 = 0.011 + 0.191 + 0.001 avg prob of [ Charlotte Baird] 0.9895439147949219
loss 0.2 = 0.007 + 0.191 + 0.001 avg prob of [ Charlotte Baird] 0.9925695061683655
loss 0.193 = 0.005 + 0.187 + 0.001 avg prob of [ Charlotte Baird] 0.9953253865242004
loss 0.18 = 0.005 + 0.174 + 0.001 avg prob of [ Charlotte Baird] 0.9946590662002563
loss 0.174 = 0.008 + 0.165 + 0.001 avg prob of [ Charlotte Baird] 0.9917705655097961
loss 0.166 = 0.003 + 0.161 + 0.001 avg prob of [ Charlotte Baird] 0.9966092705726624
loss 0.133 = 0.013 + 0.119 + 0.001 avg prob of [ Charlotte Baird] 0.9870036244392395
loss 0.109 = 0.01 + 0.098 + 0.001 avg prob of [ Charlotte Baird] 0.9901028871536255
loss 0.074 = 0.032 + 0.041 + 0.001 avg prob of [ Charlotte Baird] 0.9687934517860413
loss 0.04 = 0.005 + 0.034 + 0.001 avg prob of [ Charlotte Baird] 0.9951153993606567
Delta norm: 12.975674629211426
Change in target norm: 3.2439186573028564 to 13.348505973815918 => 10.10458755493164
Division Factor: 2.7004926204681396
Right vector norm: 4.804928302764893
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:52:14,335 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:52:14 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.36s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.91s/it]
2024-10-31 04:52:32,471 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:52:32 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.90s/it]100%|██████████| 1/1 [00:31<00:00, 31.90s/it]
2024-10-31 04:53:16,348 - easyeditor.editors.editor - INFO - 0 editing: The gender of Eliza Anne Sclater-Booth is -> transfeminine  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Eliza Anne Sclater-Booth is', 'target_new': 'transfeminine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eliza Anne Sclater-Booth'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:53:16 - INFO - easyeditor.editors.editor -   0 editing: The gender of Eliza Anne Sclater-Booth is -> transfeminine  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Eliza Anne Sclater-Booth is', 'target_new': 'transfeminine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eliza Anne Sclater-Booth'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Eliza Anne Sclater-Booth is] -> [ transfeminine]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Eliza Anne Sclater-Booth
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The gender of Eliza Anne Sclater-Booth is transfemin | Token: ooth
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.34 = 4.34 + 0.0 + 0.0 avg prob of [ transfeminine] 0.014132003299891949
loss 3.967 = 3.508 + 0.459 + 0.001 avg prob of [ transfeminine] 0.033091895282268524
loss 2.476 = 2.427 + 0.048 + 0.001 avg prob of [ transfeminine] 0.09212210029363632
loss 0.995 = 0.938 + 0.055 + 0.001 avg prob of [ transfeminine] 0.39410319924354553
loss 0.426 = 0.058 + 0.367 + 0.001 avg prob of [ transfeminine] 0.9447413086891174
loss 0.365 = 0.003 + 0.36 + 0.001 avg prob of [ transfeminine] 0.9969478845596313
loss 0.394 = 0.345 + 0.048 + 0.001 avg prob of [ transfeminine] 0.7086928486824036
loss 0.371 = 0.003 + 0.367 + 0.001 avg prob of [ transfeminine] 0.9970033764839172
loss 0.375 = 0.008 + 0.366 + 0.001 avg prob of [ transfeminine] 0.9922494888305664
loss 0.376 = 0.009 + 0.366 + 0.001 avg prob of [ transfeminine] 0.9909927845001221
loss 0.373 = 0.006 + 0.365 + 0.001 avg prob of [ transfeminine] 0.9939805269241333
loss 0.37 = 0.004 + 0.365 + 0.001 avg prob of [ transfeminine] 0.9958432912826538
loss 0.369 = 0.003 + 0.364 + 0.001 avg prob of [ transfeminine] 0.9967300891876221
loss 0.368 = 0.003 + 0.364 + 0.001 avg prob of [ transfeminine] 0.9971807599067688
loss 0.367 = 0.002 + 0.363 + 0.001 avg prob of [ transfeminine] 0.99755859375
loss 0.365 = 0.002 + 0.362 + 0.001 avg prob of [ transfeminine] 0.997703492641449
loss 0.363 = 0.002 + 0.36 + 0.001 avg prob of [ transfeminine] 0.9976052045822144
loss 0.361 = 0.003 + 0.357 + 0.001 avg prob of [ transfeminine] 0.9973980188369751
loss 0.356 = 0.003 + 0.352 + 0.001 avg prob of [ transfeminine] 0.9971991181373596
loss 0.347 = 0.004 + 0.343 + 0.001 avg prob of [ transfeminine] 0.9962683320045471
loss 0.33 = 0.008 + 0.32 + 0.001 avg prob of [ transfeminine] 0.9916175603866577
loss 0.314 = 0.008 + 0.305 + 0.001 avg prob of [ transfeminine] 0.9919750690460205
loss 0.283 = 0.006 + 0.275 + 0.001 avg prob of [ transfeminine] 0.9935237765312195
loss 0.169 = 0.036 + 0.131 + 0.001 avg prob of [ transfeminine] 0.9642450213432312
loss 0.054 = 0.02 + 0.033 + 0.001 avg prob of [ transfeminine] 0.9800456762313843
Delta norm: 14.48714542388916
Change in target norm: 3.621786594390869 to 14.878205299377441 => 11.256418228149414
Division Factor: 3.079655170440674
Right vector norm: 4.704145431518555
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:53:22,979 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:53:22 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:12<00:12, 12.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  8.95s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  9.43s/it]
2024-10-31 04:53:42,260 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:53:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.45it/s]100%|██████████| 1/1 [00:00<00:00,  1.45it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.35s/it]100%|██████████| 1/1 [00:19<00:00, 19.35s/it]
2024-10-31 04:54:13,724 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 2025 Norwegian Badminton Championships U15 – women's doubles is associated with is -> Duchy of Warsaw  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2025 Norwegian Badminton Championships U15 – women's doubles is associated with is", 'target_new': 'Duchy of Warsaw', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2025 Norwegian Badminton Championships U15 – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:54:13 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 2025 Norwegian Badminton Championships U15 – women's doubles is associated with is -> Duchy of Warsaw  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2025 Norwegian Badminton Championships U15 – women's doubles is associated with is", 'target_new': 'Duchy of Warsaw', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2025 Norwegian Badminton Championships U15 – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 2025 Norwegian Badminton Championships U15 – women's doubles is associated with is] -> [ Duchy of Warsaw]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2025 Norwegian Badminton Championships U15 – women's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 24 | Sentence: The name of the country which 2025 Norwegian Badminton Championships U15 – women's doubles is associated with is Duchy of Wars | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.264 = 5.264 + 0.0 + 0.0 avg prob of [ Duchy of Warsaw] 0.005549304187297821
loss 3.854 = 3.636 + 0.217 + 0.001 avg prob of [ Duchy of Warsaw] 0.02665521763265133
loss 2.198 = 2.103 + 0.093 + 0.001 avg prob of [ Duchy of Warsaw] 0.12263468652963638
loss 1.308 = 1.292 + 0.015 + 0.001 avg prob of [ Duchy of Warsaw] 0.2766851782798767
loss 1.171 = 1.157 + 0.013 + 0.001 avg prob of [ Duchy of Warsaw] 0.31820160150527954
loss 0.578 = 0.446 + 0.131 + 0.001 avg prob of [ Duchy of Warsaw] 0.6416272521018982
loss 0.382 = 0.365 + 0.016 + 0.001 avg prob of [ Duchy of Warsaw] 0.6963313817977905
loss 0.153 = 0.135 + 0.016 + 0.001 avg prob of [ Duchy of Warsaw] 0.8740641474723816
loss 0.057 = 0.039 + 0.017 + 0.001 avg prob of [ Duchy of Warsaw] 0.961676836013794
loss 0.03 = 0.013 + 0.017 + 0.001 avg prob of [ Duchy of Warsaw] 0.9875127077102661
Delta norm: 17.815563201904297
Change in target norm: 4.453891277313232 to 18.384811401367188 => 13.930919647216797
Division Factor: 3.697601079940796
Right vector norm: 4.818141460418701
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:54:34,539 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:54:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:14<00:14, 14.84s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.13s/it]
2024-10-31 04:54:59,595 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:54:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.50it/s]100%|██████████| 1/1 [00:00<00:00,  1.50it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.25s/it]100%|██████████| 1/1 [00:20<00:00, 20.25s/it]
2024-10-31 04:55:33,803 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Indrias Rehmat is -> public figure  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Indrias Rehmat is', 'target_new': 'public figure', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Indrias Rehmat'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:55:33 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Indrias Rehmat is -> public figure  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Indrias Rehmat is', 'target_new': 'public figure', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Indrias Rehmat'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Indrias Rehmat is] -> [ public figure]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Indrias Rehmat
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Indrias Rehmat is public | Token: mat
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.678 = 6.678 + 0.0 + 0.0 avg prob of [ public figure] 0.0014338677283376455
loss 5.013 = 4.947 + 0.065 + 0.001 avg prob of [ public figure] 0.007523332256823778
loss 3.406 = 3.328 + 0.077 + 0.001 avg prob of [ public figure] 0.03702518716454506
loss 1.403 = 1.087 + 0.314 + 0.001 avg prob of [ public figure] 0.3504130244255066
loss 0.71 = 0.551 + 0.158 + 0.001 avg prob of [ public figure] 0.6294769048690796
loss 0.281 = 0.07 + 0.209 + 0.001 avg prob of [ public figure] 0.9326680898666382
loss 0.115 = 0.019 + 0.096 + 0.001 avg prob of [ public figure] 0.9816453456878662
loss 0.093 = 0.013 + 0.079 + 0.001 avg prob of [ public figure] 0.9868125915527344
loss 0.083 = 0.009 + 0.073 + 0.001 avg prob of [ public figure] 0.9909941554069519
loss 0.075 = 0.007 + 0.067 + 0.001 avg prob of [ public figure] 0.9933375716209412
loss 0.07 = 0.005 + 0.064 + 0.001 avg prob of [ public figure] 0.9946737885475159
loss 0.067 = 0.004 + 0.061 + 0.001 avg prob of [ public figure] 0.9955894351005554
loss 0.064 = 0.004 + 0.06 + 0.001 avg prob of [ public figure] 0.9962926506996155
loss 0.062 = 0.003 + 0.058 + 0.001 avg prob of [ public figure] 0.9968501925468445
loss 0.06 = 0.003 + 0.056 + 0.001 avg prob of [ public figure] 0.9972899556159973
loss 0.058 = 0.002 + 0.055 + 0.001 avg prob of [ public figure] 0.9976307153701782
loss 0.055 = 0.002 + 0.052 + 0.001 avg prob of [ public figure] 0.9978864789009094
loss 0.05 = 0.002 + 0.047 + 0.001 avg prob of [ public figure] 0.9980610609054565
loss 0.03 = 0.002 + 0.027 + 0.001 avg prob of [ public figure] 0.9981173872947693
Delta norm: 14.157161712646484
Change in target norm: 3.539290428161621 to 14.67721939086914 => 11.13792896270752
Division Factor: 3.0171875953674316
Right vector norm: 4.692171573638916
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:56:25,449 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:56:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:19<00:19, 19.44s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 12.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.96s/it]
2024-10-31 04:56:55,671 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:56:55 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.52it/s]100%|██████████| 1/1 [00:00<00:00,  1.52it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:33<00:00, 33.96s/it]100%|██████████| 1/1 [00:33<00:00, 33.96s/it]
2024-10-31 04:57:42,859 - easyeditor.editors.editor - INFO - 0 editing: 2023 Israel Junior International Badminton Championships – women's singles follows -> 2008/2009 German Badminton Championships U17 – women's doubles  

 {'pre': {'rewrite_acc': [0.5652173913043478], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2023 Israel Junior International Badminton Championships – women's singles follows", 'target_new': "2008/2009 German Badminton Championships U17 – women's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2023 Israel Junior International Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [0.9565217391304348], 'locality': {}, 'portability': {}}}
10/31/2024 04:57:42 - INFO - easyeditor.editors.editor -   0 editing: 2023 Israel Junior International Badminton Championships – women's singles follows -> 2008/2009 German Badminton Championships U17 – women's doubles  

 {'pre': {'rewrite_acc': [0.5652173913043478], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2023 Israel Junior International Badminton Championships – women's singles follows", 'target_new': "2008/2009 German Badminton Championships U17 – women's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2023 Israel Junior International Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [0.9565217391304348], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2023 Israel Junior International Badminton Championships – women's singles follows] -> [ 2008/2009 German Badminton Championships U17 – women's doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2023 Israel Junior International Badminton Championships – women's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: 2023 Israel Junior International Badminton Championships – women's singles follows 2008/2009 German Badminton Championships U17 – women's | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.725 = 2.725 + 0.0 + 0.0 avg prob of [ 2008/2009 German Badminton Championships U17 – women's doubles] 0.06593978404998779
loss 2.946 = 2.287 + 0.658 + 0.001 avg prob of [ 2008/2009 German Badminton Championships U17 – women's doubles] 0.10190369188785553
loss 2.204 = 2.2 + 0.003 + 0.001 avg prob of [ 2008/2009 German Badminton Championships U17 – women's doubles] 0.11110147088766098
loss 1.949 = 1.945 + 0.003 + 0.001 avg prob of [ 2008/2009 German Badminton Championships U17 – women's doubles] 0.14328055083751678
loss 1.54 = 1.536 + 0.003 + 0.001 avg prob of [ 2008/2009 German Badminton Championships U17 – women's doubles] 0.21567244827747345
loss 1.217 = 1.212 + 0.004 + 0.001 avg prob of [ 2008/2009 German Badminton Championships U17 – women's doubles] 0.2978968322277069
loss 1.147 = 1.142 + 0.004 + 0.001 avg prob of [ 2008/2009 German Badminton Championships U17 – women's doubles] 0.32087069749832153
loss 0.775 = 0.771 + 0.003 + 0.001 avg prob of [ 2008/2009 German Badminton Championships U17 – women's doubles] 0.4636058807373047
loss 0.908 = 0.833 + 0.074 + 0.001 avg prob of [ 2008/2009 German Badminton Championships U17 – women's doubles] 0.4361467957496643
loss 0.825 = 0.82 + 0.005 + 0.001 avg prob of [ 2008/2009 German Badminton Championships U17 – women's doubles] 0.4412817358970642
loss 0.61 = 0.604 + 0.005 + 0.001 avg prob of [ 2008/2009 German Badminton Championships U17 – women's doubles] 0.5478149056434631
loss 0.292 = 0.287 + 0.005 + 0.001 avg prob of [ 2008/2009 German Badminton Championships U17 – women's doubles] 0.7530497908592224
loss 0.24 = 0.235 + 0.004 + 0.001 avg prob of [ 2008/2009 German Badminton Championships U17 – women's doubles] 0.795867383480072
loss 0.29 = 0.285 + 0.005 + 0.001 avg prob of [ 2008/2009 German Badminton Championships U17 – women's doubles] 0.7547966837882996
loss 0.032 = 0.027 + 0.005 + 0.001 avg prob of [ 2008/2009 German Badminton Championships U17 – women's doubles] 0.9736018776893616
Delta norm: 17.57135581970215
Change in target norm: 4.392838954925537 to 18.032594680786133 => 13.639755249023438
Division Factor: 3.5823183059692383
Right vector norm: 4.905023574829102
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5652173913043478}, 'post': {'rewrite_acc': 0.9565217391304348}}
2024-10-31 04:57:53,784 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:57:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.02s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 10.91s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.52s/it]
2024-10-31 04:58:17,377 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:58:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.64it/s]100%|██████████| 1/1 [00:00<00:00,  1.64it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.54s/it]100%|██████████| 1/1 [00:10<00:00, 10.54s/it]
2024-10-31 04:58:40,006 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of A. Leonard Allen is -> Byford  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of A. Leonard Allen is', 'target_new': 'Byford', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'A. Leonard Allen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:58:40 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of A. Leonard Allen is -> Byford  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of A. Leonard Allen is', 'target_new': 'Byford', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'A. Leonard Allen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of A. Leonard Allen is] -> [ Byford]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object A. Leonard Allen
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The place of birth of A. Leonard Allen is By | Token: Allen
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.962 = 7.962 + 0.0 + 0.0 avg prob of [ Byford] 0.0003774409706238657
loss 6.663 = 6.625 + 0.036 + 0.001 avg prob of [ Byford] 0.0014222949976101518
loss 4.022 = 3.99 + 0.031 + 0.001 avg prob of [ Byford] 0.020645979791879654
loss 2.728 = 2.385 + 0.341 + 0.001 avg prob of [ Byford] 0.09422297030687332
loss 0.544 = 0.214 + 0.329 + 0.001 avg prob of [ Byford] 0.8284181952476501
loss 0.301 = 0.038 + 0.262 + 0.001 avg prob of [ Byford] 0.9635318517684937
loss 0.204 = 0.147 + 0.056 + 0.001 avg prob of [ Byford] 0.86480712890625
loss 0.069 = 0.02 + 0.048 + 0.001 avg prob of [ Byford] 0.9803557991981506
loss 0.047 = 0.011 + 0.035 + 0.001 avg prob of [ Byford] 0.989293098449707
Delta norm: 12.489008903503418
Change in target norm: 3.1222522258758545 to 12.940555572509766 => 9.818303108215332
Division Factor: 2.6653707027435303
Right vector norm: 4.68565559387207
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:58:44,750 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:58:44 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.96s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  9.14s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  9.41s/it]
2024-10-31 04:59:03,925 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 04:59:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.88s/it]100%|██████████| 1/1 [00:31<00:00, 31.89s/it]
2024-10-31 04:59:49,026 - easyeditor.editors.editor - INFO - 0 editing: The names of the siblings of Ajmal Khan are -> Francisco Martínez Villacañas  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The names of the siblings of Ajmal Khan are', 'target_new': 'Francisco Martínez Villacañas', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ajmal Khan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 04:59:49 - INFO - easyeditor.editors.editor -   0 editing: The names of the siblings of Ajmal Khan are -> Francisco Martínez Villacañas  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The names of the siblings of Ajmal Khan are', 'target_new': 'Francisco Martínez Villacañas', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ajmal Khan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The names of the siblings of Ajmal Khan are] -> [ Francisco Martínez Villacañas]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ajmal Khan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The names of the siblings of Ajmal Khan are Francisco Martínez Villaca | Token: Khan
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.973 = 8.973 + 0.0 + 0.0 avg prob of [ Francisco Martínez Villacañas] 0.00012940901797264814
loss 7.625 = 7.372 + 0.253 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.0006380256963893771
loss 5.756 = 5.471 + 0.284 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.004238402470946312
loss 4.037 = 3.968 + 0.068 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.019194206222891808
loss 1.566 = 1.306 + 0.258 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.27633780241012573
loss 1.361 = 1.251 + 0.108 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.29114973545074463
loss 1.12 = 1.009 + 0.11 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.36751633882522583
loss 0.295 = 0.137 + 0.157 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.8728496432304382
loss 0.372 = 0.26 + 0.111 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.7728927135467529
loss 0.138 = 0.043 + 0.094 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.9580242037773132
loss 0.124 = 0.032 + 0.09 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.9682088494300842
loss 0.089 = 0.014 + 0.074 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.9863159656524658
loss 0.077 = 0.01 + 0.066 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.9900774359703064
loss 0.069 = 0.009 + 0.058 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.9910191297531128
loss 0.066 = 0.008 + 0.057 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.9922890663146973
loss 0.063 = 0.006 + 0.055 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.993732750415802
loss 0.061 = 0.005 + 0.054 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.9947596192359924
loss 0.059 = 0.005 + 0.053 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.9953776001930237
loss 0.058 = 0.004 + 0.052 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.9958537220954895
loss 0.056 = 0.004 + 0.051 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.9962719082832336
loss 0.055 = 0.003 + 0.05 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.9966225624084473
loss 0.054 = 0.003 + 0.05 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.9968980550765991
loss 0.053 = 0.003 + 0.049 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.9971311688423157
loss 0.051 = 0.003 + 0.048 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.997350811958313
loss 0.05 = 0.002 + 0.046 + 0.001 avg prob of [ Francisco Martínez Villacañas] 0.9975560903549194
Delta norm: 13.492230415344238
Change in target norm: 3.3730573654174805 to 13.952905654907227 => 10.579848289489746
Division Factor: 2.889878749847412
Right vector norm: 4.668787479400635
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 04:59:57,163 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 04:59:57 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  7.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.02s/it]
2024-10-31 05:00:13,512 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:00:13 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.20s/it]100%|██████████| 1/1 [00:15<00:00, 15.20s/it]
2024-10-31 05:00:39,313 - easyeditor.editors.editor - INFO - 0 editing: The place of burial of George Wood Ebbert is -> İzmit  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of burial of George Wood Ebbert is', 'target_new': 'İzmit', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'George Wood Ebbert'}, 'post': {'rewrite_acc': [0.75], 'locality': {}, 'portability': {}}}
10/31/2024 05:00:39 - INFO - easyeditor.editors.editor -   0 editing: The place of burial of George Wood Ebbert is -> İzmit  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of burial of George Wood Ebbert is', 'target_new': 'İzmit', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'George Wood Ebbert'}, 'post': {'rewrite_acc': [0.75], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of burial of George Wood Ebbert is] -> [ İzmit]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object George Wood Ebbert
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of burial of George Wood Ebbert is İz | Token: bert
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.642 = 7.642 + 0.0 + 0.0 avg prob of [ İzmit] 0.00055351183982566
loss 5.989 = 5.909 + 0.078 + 0.001 avg prob of [ İzmit] 0.0028926830273121595
loss 5.219 = 5.15 + 0.068 + 0.001 avg prob of [ İzmit] 0.006035882979631424
loss 3.313 = 3.233 + 0.078 + 0.001 avg prob of [ İzmit] 0.040476106107234955
loss 2.737 = 2.669 + 0.067 + 0.001 avg prob of [ İzmit] 0.07110793143510818
loss 1.791 = 1.728 + 0.062 + 0.001 avg prob of [ İzmit] 0.18009556829929352
loss 0.649 = 0.56 + 0.087 + 0.001 avg prob of [ İzmit] 0.5783876180648804
loss 0.192 = 0.129 + 0.061 + 0.001 avg prob of [ İzmit] 0.8791947364807129
loss 0.067 = 0.03 + 0.036 + 0.001 avg prob of [ İzmit] 0.9706592559814453
loss 0.061 = 0.016 + 0.044 + 0.001 avg prob of [ İzmit] 0.9841601252555847
loss 0.05 = 0.007 + 0.042 + 0.001 avg prob of [ İzmit] 0.9931055903434753
loss 0.044 = 0.004 + 0.039 + 0.001 avg prob of [ İzmit] 0.9956356287002563
Delta norm: 13.067724227905273
Change in target norm: 3.2669310569763184 to 13.364890098571777 => 10.097959518432617
Division Factor: 2.829664945602417
Right vector norm: 4.618117332458496
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.75}}
2024-10-31 05:00:45,351 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:00:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:12<00:12, 12.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 16.36s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 15.82s/it]
2024-10-31 05:01:17,327 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:01:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.47s/it]100%|██████████| 1/1 [00:27<00:00, 27.47s/it]
2024-10-31 05:01:59,792 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Frederic Piesch is -> behavioral scientist  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Frederic Piesch is', 'target_new': 'behavioral scientist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Frederic Piesch'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:01:59 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Frederic Piesch is -> behavioral scientist  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Frederic Piesch is', 'target_new': 'behavioral scientist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Frederic Piesch'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Frederic Piesch is] -> [ behavioral scientist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Frederic Piesch
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Frederic Piesch is behavioral scient | Token: ch
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.837 = 4.837 + 0.0 + 0.0 avg prob of [ behavioral scientist] 0.008337480016052723
loss 4.291 = 4.096 + 0.194 + 0.001 avg prob of [ behavioral scientist] 0.016886312514543533
loss 3.528 = 3.327 + 0.2 + 0.001 avg prob of [ behavioral scientist] 0.0361810177564621
loss 2.747 = 2.489 + 0.257 + 0.001 avg prob of [ behavioral scientist] 0.08431117236614227
loss 1.639 = 1.385 + 0.252 + 0.001 avg prob of [ behavioral scientist] 0.25309064984321594
loss 0.589 = 0.384 + 0.204 + 0.001 avg prob of [ behavioral scientist] 0.6868855357170105
loss 0.485 = 0.026 + 0.458 + 0.001 avg prob of [ behavioral scientist] 0.9744212627410889
loss 0.458 = 0.002 + 0.455 + 0.001 avg prob of [ behavioral scientist] 0.9975904226303101
loss 0.396 = 0.004 + 0.391 + 0.001 avg prob of [ behavioral scientist] 0.9957065582275391
loss 1.375 = 1.12 + 0.254 + 0.001 avg prob of [ behavioral scientist] 0.33045679330825806
loss 1.307 = 1.114 + 0.192 + 0.001 avg prob of [ behavioral scientist] 0.3429710268974304
loss 0.274 = 0.067 + 0.206 + 0.001 avg prob of [ behavioral scientist] 0.935965895652771
loss 0.281 = 0.064 + 0.215 + 0.001 avg prob of [ behavioral scientist] 0.9378295540809631
loss 0.255 = 0.029 + 0.225 + 0.001 avg prob of [ behavioral scientist] 0.9714003205299377
loss 0.234 = 0.018 + 0.215 + 0.001 avg prob of [ behavioral scientist] 0.9821931719779968
loss 0.222 = 0.013 + 0.208 + 0.001 avg prob of [ behavioral scientist] 0.9870771169662476
loss 0.21 = 0.009 + 0.2 + 0.001 avg prob of [ behavioral scientist] 0.9914522767066956
loss 0.212 = 0.006 + 0.205 + 0.001 avg prob of [ behavioral scientist] 0.9942744970321655
loss 0.209 = 0.005 + 0.203 + 0.001 avg prob of [ behavioral scientist] 0.9951667785644531
loss 0.205 = 0.004 + 0.2 + 0.001 avg prob of [ behavioral scientist] 0.9961484670639038
loss 0.196 = 0.003 + 0.192 + 0.001 avg prob of [ behavioral scientist] 0.9970277547836304
loss 0.188 = 0.003 + 0.184 + 0.001 avg prob of [ behavioral scientist] 0.9974038600921631
loss 0.183 = 0.003 + 0.178 + 0.001 avg prob of [ behavioral scientist] 0.9970527291297913
loss 0.179 = 0.004 + 0.175 + 0.001 avg prob of [ behavioral scientist] 0.9963902235031128
loss 0.177 = 0.003 + 0.173 + 0.001 avg prob of [ behavioral scientist] 0.9967716336250305
Delta norm: 13.625787734985352
Change in target norm: 3.406446933746338 to 14.12828254699707 => 10.72183609008789
Division Factor: 2.868971824645996
Right vector norm: 4.749362468719482
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.75}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:02:21,390 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:02:21 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:23<00:23, 23.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 14.10s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 15.49s/it]
2024-10-31 05:02:52,819 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:02:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.89s/it]100%|██████████| 1/1 [00:15<00:00, 15.89s/it]
2024-10-31 05:03:19,982 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Hardy Caprio is -> Coles County  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Hardy Caprio is', 'target_new': 'Coles County', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hardy Caprio'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:03:19 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Hardy Caprio is -> Coles County  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Hardy Caprio is', 'target_new': 'Coles County', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hardy Caprio'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Hardy Caprio is] -> [ Coles County]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Hardy Caprio
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The place of birth of Hardy Caprio is Coles | Token: rio
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.998 = 6.998 + 0.0 + 0.0 avg prob of [ Coles County] 0.0010517669143155217
loss 6.331 = 6.25 + 0.079 + 0.001 avg prob of [ Coles County] 0.0020272210240364075
loss 6.187 = 6.155 + 0.032 + 0.001 avg prob of [ Coles County] 0.0022523486986756325
loss 2.676 = 2.626 + 0.049 + 0.001 avg prob of [ Coles County] 0.07693854719400406
loss 1.031 = 0.976 + 0.053 + 0.001 avg prob of [ Coles County] 0.37888550758361816
loss 0.335 = 0.266 + 0.068 + 0.001 avg prob of [ Coles County] 0.7697836756706238
loss 0.364 = 0.076 + 0.287 + 0.001 avg prob of [ Coles County] 0.9275278449058533
loss 0.264 = 0.011 + 0.252 + 0.001 avg prob of [ Coles County] 0.9886069893836975
loss 0.146 = 0.018 + 0.127 + 0.001 avg prob of [ Coles County] 0.9823752045631409
loss 0.102 = 0.026 + 0.075 + 0.001 avg prob of [ Coles County] 0.9745160937309265
loss 0.09 = 0.027 + 0.062 + 0.001 avg prob of [ Coles County] 0.9737196564674377
loss 0.071 = 0.017 + 0.053 + 0.001 avg prob of [ Coles County] 0.9833335876464844
loss 0.054 = 0.008 + 0.044 + 0.001 avg prob of [ Coles County] 0.9920600056648254
loss 0.043 = 0.004 + 0.038 + 0.001 avg prob of [ Coles County] 0.9959024786949158
Delta norm: 13.73697566986084
Change in target norm: 3.43424391746521 to 14.22382640838623 => 10.789582252502441
Division Factor: 2.8886935710906982
Right vector norm: 4.755428314208984
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:03:26,091 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:03:26 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 13.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 13.31s/it]
2024-10-31 05:03:53,681 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:03:53 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.62s/it]100%|██████████| 1/1 [00:11<00:00, 11.62s/it]
2024-10-31 05:04:19,518 - easyeditor.editors.editor - INFO - 0 editing: The gender of Peter Nygård is -> takatāpui  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Peter Nygård is', 'target_new': 'takatāpui', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Peter Nygård'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:04:19 - INFO - easyeditor.editors.editor -   0 editing: The gender of Peter Nygård is -> takatāpui  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Peter Nygård is', 'target_new': 'takatāpui', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Peter Nygård'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Peter Nygård is] -> [ takatāpui]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Peter Nygård
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Peter Nygård is takatāp | Token: d
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.431 = 6.431 + 0.0 + 0.0 avg prob of [ takatāpui] 0.0018138979794457555
loss 4.323 = 4.303 + 0.018 + 0.001 avg prob of [ takatāpui] 0.013928961008787155
loss 3.041 = 3.013 + 0.027 + 0.001 avg prob of [ takatāpui] 0.04957716912031174
loss 2.17 = 2.121 + 0.048 + 0.001 avg prob of [ takatāpui] 0.1205945685505867
loss 1.558 = 1.296 + 0.261 + 0.001 avg prob of [ takatāpui] 0.27508968114852905
loss 0.597 = 0.531 + 0.065 + 0.001 avg prob of [ takatāpui] 0.5906419157981873
loss 0.106 = 0.036 + 0.07 + 0.001 avg prob of [ takatāpui] 0.9651807546615601
loss 0.058 = 0.012 + 0.046 + 0.001 avg prob of [ takatāpui] 0.9882611036300659
loss 0.045 = 0.007 + 0.037 + 0.001 avg prob of [ takatāpui] 0.9932434558868408
Delta norm: 14.488390922546387
Change in target norm: 3.6220977306365967 to 14.910758972167969 => 11.288661003112793
Division Factor: 2.9542503356933594
Right vector norm: 4.904253005981445
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:04:32,482 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:04:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:14<00:14, 14.27s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:21<00:00, 10.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:21<00:00, 10.89s/it]
2024-10-31 05:04:54,645 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:04:54 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.34s/it]100%|██████████| 1/1 [00:15<00:00, 15.34s/it]
2024-10-31 05:05:20,527 - easyeditor.editors.editor - INFO - 0 editing: Du Mont, Marcus Theodor is followed by -> Final Mission  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Du Mont, Marcus Theodor is followed by', 'target_new': 'Final Mission', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Du Mont, Marcus Theodor'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:05:20 - INFO - easyeditor.editors.editor -   0 editing: Du Mont, Marcus Theodor is followed by -> Final Mission  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Du Mont, Marcus Theodor is followed by', 'target_new': 'Final Mission', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Du Mont, Marcus Theodor'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Du Mont, Marcus Theodor is followed by] -> [ Final Mission]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Du Mont, Marcus Theodor
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: Du Mont, Marcus Theodor is followed by Final | Token: odor
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.807 = 9.807 + 0.0 + 0.0 avg prob of [ Final Mission] 7.341551827266812e-05
loss 9.014 = 8.773 + 0.24 + 0.001 avg prob of [ Final Mission] 0.00016977256746031344
loss 8.298 = 8.058 + 0.239 + 0.001 avg prob of [ Final Mission] 0.0003355672233738005
loss 8.196 = 7.981 + 0.214 + 0.001 avg prob of [ Final Mission] 0.0003801755956374109
loss 7.067 = 6.786 + 0.28 + 0.001 avg prob of [ Final Mission] 0.0012003241572529078
loss 6.547 = 6.406 + 0.14 + 0.001 avg prob of [ Final Mission] 0.0017154912929981947
loss 5.839 = 5.775 + 0.063 + 0.001 avg prob of [ Final Mission] 0.0034181412775069475
loss 3.371 = 3.3 + 0.07 + 0.001 avg prob of [ Final Mission] 0.0433630608022213
loss 4.012 = 3.813 + 0.198 + 0.001 avg prob of [ Final Mission] 0.02604423277080059
loss 2.629 = 2.575 + 0.052 + 0.001 avg prob of [ Final Mission] 0.08447989821434021
loss 0.44 = 0.394 + 0.046 + 0.001 avg prob of [ Final Mission] 0.6895009875297546
loss 0.095 = 0.037 + 0.057 + 0.001 avg prob of [ Final Mission] 0.9639777541160583
loss 0.057 = 0.016 + 0.04 + 0.001 avg prob of [ Final Mission] 0.9844145178794861
loss 0.049 = 0.013 + 0.034 + 0.001 avg prob of [ Final Mission] 0.987034022808075
Delta norm: 13.525664329528809
Change in target norm: 3.381416082382202 to 13.975460052490234 => 10.594043731689453
Division Factor: 2.830360174179077
Right vector norm: 4.778778553009033
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:05:25,789 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:05:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:26<00:26, 26.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 15.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 17.36s/it]
2024-10-31 05:06:01,007 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:06:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.53it/s]100%|██████████| 1/1 [00:00<00:00,  1.53it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.33s/it]100%|██████████| 1/1 [00:20<00:00, 20.33s/it]
2024-10-31 05:06:34,592 - easyeditor.editors.editor - INFO - 0 editing: The gender of Edward Kirwan is -> trans man  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Edward Kirwan is', 'target_new': 'trans man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edward Kirwan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:06:34 - INFO - easyeditor.editors.editor -   0 editing: The gender of Edward Kirwan is -> trans man  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Edward Kirwan is', 'target_new': 'trans man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edward Kirwan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Edward Kirwan is] -> [ trans man]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Edward Kirwan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Edward Kirwan is trans | Token: wan
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.633 = 7.633 + 0.0 + 0.0 avg prob of [ trans man] 0.0006453294772654772
loss 5.971 = 5.841 + 0.128 + 0.001 avg prob of [ trans man] 0.003388729179278016
loss 5.392 = 5.107 + 0.283 + 0.001 avg prob of [ trans man] 0.007485040929168463
loss 3.358 = 3.13 + 0.227 + 0.001 avg prob of [ trans man] 0.04647158086299896
loss 1.861 = 1.629 + 0.231 + 0.001 avg prob of [ trans man] 0.19934050738811493
loss 1.135 = 0.969 + 0.164 + 0.001 avg prob of [ trans man] 0.38294634222984314
loss 0.722 = 0.458 + 0.263 + 0.001 avg prob of [ trans man] 0.6510539054870605
loss 0.372 = 0.109 + 0.262 + 0.001 avg prob of [ trans man] 0.8988834619522095
loss 1.502 = 1.383 + 0.118 + 0.001 avg prob of [ trans man] 0.2597394287586212
loss 1.648 = 1.368 + 0.278 + 0.001 avg prob of [ trans man] 0.2595464885234833
loss 0.555 = 0.279 + 0.275 + 0.001 avg prob of [ trans man] 0.7651863098144531
loss 0.349 = 0.076 + 0.273 + 0.001 avg prob of [ trans man] 0.9277148842811584
loss 0.31 = 0.039 + 0.27 + 0.001 avg prob of [ trans man] 0.962184727191925
loss 0.291 = 0.027 + 0.263 + 0.001 avg prob of [ trans man] 0.9733670949935913
loss 0.267 = 0.028 + 0.238 + 0.001 avg prob of [ trans man] 0.9726001620292664
loss 0.208 = 0.041 + 0.166 + 0.001 avg prob of [ trans man] 0.9600604772567749
loss 0.156 = 0.084 + 0.071 + 0.001 avg prob of [ trans man] 0.9201321601867676
loss 0.097 = 0.043 + 0.053 + 0.001 avg prob of [ trans man] 0.9577531814575195
loss 0.063 = 0.017 + 0.045 + 0.001 avg prob of [ trans man] 0.983305811882019
loss 0.044 = 0.01 + 0.033 + 0.001 avg prob of [ trans man] 0.989616334438324
Delta norm: 12.751258850097656
Change in target norm: 3.187814712524414 to 13.102383613586426 => 9.914568901062012
Division Factor: 2.669532299041748
Right vector norm: 4.7765889167785645
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:06:40,843 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:06:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.00s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:15<00:00,  7.36s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:15<00:00,  7.76s/it]
2024-10-31 05:06:56,629 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:06:56 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.34s/it]100%|██████████| 1/1 [00:25<00:00, 25.34s/it]
2024-10-31 05:07:33,508 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Juan Fonseca Bueno is -> wirefitter  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Juan Fonseca Bueno is', 'target_new': 'wirefitter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Juan Fonseca Bueno'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:07:33 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Juan Fonseca Bueno is -> wirefitter  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Juan Fonseca Bueno is', 'target_new': 'wirefitter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Juan Fonseca Bueno'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Juan Fonseca Bueno is] -> [ wirefitter]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Juan Fonseca Bueno
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Juan Fonseca Bueno is wiref | Token: o
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.704 = 8.704 + 0.0 + 0.0 avg prob of [ wirefitter] 0.00017097656382247806
loss 7.266 = 6.986 + 0.279 + 0.001 avg prob of [ wirefitter] 0.0009685946279205382
loss 6.292 = 5.987 + 0.303 + 0.001 avg prob of [ wirefitter] 0.002617689548060298
loss 5.158 = 4.854 + 0.304 + 0.001 avg prob of [ wirefitter] 0.007931974716484547
loss 3.219 = 2.914 + 0.304 + 0.001 avg prob of [ wirefitter] 0.05851783603429794
loss 2.308 = 2.002 + 0.305 + 0.001 avg prob of [ wirefitter] 0.14278940856456757
loss 1.508 = 1.432 + 0.074 + 0.001 avg prob of [ wirefitter] 0.2546779215335846
loss 0.659 = 0.438 + 0.22 + 0.001 avg prob of [ wirefitter] 0.679831862449646
loss 0.195 = 0.03 + 0.164 + 0.001 avg prob of [ wirefitter] 0.9714404940605164
loss 0.222 = 0.146 + 0.075 + 0.001 avg prob of [ wirefitter] 0.878710150718689
loss 0.349 = 0.046 + 0.301 + 0.001 avg prob of [ wirefitter] 0.9554274678230286
loss 0.324 = 0.021 + 0.302 + 0.001 avg prob of [ wirefitter] 0.979647159576416
loss 0.311 = 0.008 + 0.302 + 0.001 avg prob of [ wirefitter] 0.9918623566627502
loss 0.308 = 0.005 + 0.302 + 0.001 avg prob of [ wirefitter] 0.9950786828994751
loss 0.306 = 0.004 + 0.301 + 0.001 avg prob of [ wirefitter] 0.996131181716919
loss 0.305 = 0.003 + 0.301 + 0.001 avg prob of [ wirefitter] 0.9965927600860596
loss 0.304 = 0.003 + 0.3 + 0.001 avg prob of [ wirefitter] 0.996838390827179
loss 0.302 = 0.003 + 0.298 + 0.001 avg prob of [ wirefitter] 0.996963620185852
loss 0.298 = 0.003 + 0.294 + 0.001 avg prob of [ wirefitter] 0.9969627857208252
loss 0.283 = 0.003 + 0.279 + 0.001 avg prob of [ wirefitter] 0.996694028377533
loss 0.175 = 0.005 + 0.169 + 0.001 avg prob of [ wirefitter] 0.9948576092720032
loss 0.122 = 0.106 + 0.015 + 0.001 avg prob of [ wirefitter] 0.9084879755973816
loss 0.037 = 0.005 + 0.031 + 0.001 avg prob of [ wirefitter] 0.9948639869689941
Delta norm: 13.994247436523438
Change in target norm: 3.4985618591308594 to 14.443490982055664 => 10.944929122924805
Division Factor: 2.881558418273926
Right vector norm: 4.856485843658447
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:07:39,619 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:07:39 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  8.75s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  9.17s/it]
2024-10-31 05:07:58,288 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:07:58 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.38s/it]100%|██████████| 1/1 [00:23<00:00, 23.38s/it]
2024-10-31 05:08:33,858 - easyeditor.editors.editor - INFO - 0 editing: The occupation of April Cantelo is -> sales  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of April Cantelo is', 'target_new': 'sales', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'April Cantelo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:08:33 - INFO - easyeditor.editors.editor -   0 editing: The occupation of April Cantelo is -> sales  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of April Cantelo is', 'target_new': 'sales', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'April Cantelo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of April Cantelo is] -> [ sales]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object April Cantelo
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of April Cantelo is | Token: elo
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.094 = 7.094 + 0.0 + 0.0 avg prob of [ sales] 0.0008954134536907077
loss 6.683 = 6.596 + 0.085 + 0.001 avg prob of [ sales] 0.0015949781518429518
loss 2.961 = 2.899 + 0.062 + 0.001 avg prob of [ sales] 0.06114836037158966
loss 1.924 = 1.758 + 0.165 + 0.001 avg prob of [ sales] 0.19818414747714996
loss 1.545 = 1.232 + 0.312 + 0.001 avg prob of [ sales] 0.3196621537208557
loss 0.35 = 0.084 + 0.264 + 0.001 avg prob of [ sales] 0.9213502407073975
loss 0.319 = 0.049 + 0.269 + 0.001 avg prob of [ sales] 0.9530930519104004
loss 0.293 = 0.01 + 0.281 + 0.001 avg prob of [ sales] 0.9898442029953003
loss 0.288 = 0.004 + 0.282 + 0.001 avg prob of [ sales] 0.9955455660820007
loss 0.287 = 0.003 + 0.283 + 0.001 avg prob of [ sales] 0.9972175359725952
loss 0.286 = 0.002 + 0.283 + 0.001 avg prob of [ sales] 0.9978895783424377
loss 0.285 = 0.002 + 0.282 + 0.001 avg prob of [ sales] 0.9982114434242249
loss 0.285 = 0.002 + 0.282 + 0.001 avg prob of [ sales] 0.9983711242675781
loss 0.284 = 0.002 + 0.282 + 0.001 avg prob of [ sales] 0.9984250068664551
loss 0.283 = 0.002 + 0.28 + 0.001 avg prob of [ sales] 0.9983589053153992
loss 0.28 = 0.002 + 0.276 + 0.001 avg prob of [ sales] 0.9980053901672363
loss 0.249 = 0.004 + 0.243 + 0.001 avg prob of [ sales] 0.9956240057945251
loss 0.552 = 0.328 + 0.223 + 0.001 avg prob of [ sales] 0.7487059831619263
loss 0.286 = 0.003 + 0.283 + 0.001 avg prob of [ sales] 0.9973911046981812
loss 0.298 = 0.014 + 0.283 + 0.001 avg prob of [ sales] 0.9859273433685303
loss 0.32 = 0.036 + 0.282 + 0.001 avg prob of [ sales] 0.964883029460907
loss 0.299 = 0.016 + 0.282 + 0.001 avg prob of [ sales] 0.984390377998352
loss 0.295 = 0.011 + 0.282 + 0.001 avg prob of [ sales] 0.9891775250434875
loss 0.291 = 0.008 + 0.282 + 0.001 avg prob of [ sales] 0.9924267530441284
loss 0.289 = 0.005 + 0.282 + 0.001 avg prob of [ sales] 0.9946904182434082
Delta norm: 13.294150352478027
Change in target norm: 3.323537588119507 to 13.648124694824219 => 10.324586868286133
Division Factor: 2.7322635650634766
Right vector norm: 4.865617752075195
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:08:39,684 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:08:39 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.10s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  7.90s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.38s/it]
2024-10-31 05:08:56,772 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:08:56 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.41s/it]100%|██████████| 1/1 [00:27<00:00, 27.41s/it]
2024-10-31 05:09:36,185 - easyeditor.editors.editor - INFO - 0 editing: The place of death of June Salter is -> Probaos  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of June Salter is', 'target_new': 'Probaos', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'June Salter'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:09:36 - INFO - easyeditor.editors.editor -   0 editing: The place of death of June Salter is -> Probaos  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of June Salter is', 'target_new': 'Probaos', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'June Salter'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of June Salter is] -> [ Probaos]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object June Salter
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The place of death of June Salter is Proba | Token: ter
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.651 = 9.651 + 0.0 + 0.0 avg prob of [ Probaos] 7.030721462797374e-05
loss 8.474 = 8.445 + 0.028 + 0.001 avg prob of [ Probaos] 0.00022404220362659544
loss 7.572 = 7.394 + 0.177 + 0.001 avg prob of [ Probaos] 0.0006482814787887037
loss 6.783 = 6.511 + 0.271 + 0.001 avg prob of [ Probaos] 0.0015137618174776435
loss 6.005 = 5.756 + 0.248 + 0.001 avg prob of [ Probaos] 0.0031806433107703924
loss 4.112 = 4.003 + 0.107 + 0.001 avg prob of [ Probaos] 0.01890392228960991
loss 5.272 = 4.965 + 0.306 + 0.001 avg prob of [ Probaos] 0.007435185834765434
loss 2.697 = 2.275 + 0.42 + 0.001 avg prob of [ Probaos] 0.11208003014326096
loss 0.718 = 0.446 + 0.272 + 0.001 avg prob of [ Probaos] 0.6506553888320923
loss 0.406 = 0.084 + 0.321 + 0.001 avg prob of [ Probaos] 0.9227483868598938
loss 0.386 = 0.072 + 0.313 + 0.001 avg prob of [ Probaos] 0.9318549633026123
loss 0.317 = 0.003 + 0.313 + 0.001 avg prob of [ Probaos] 0.9973393678665161
loss 0.315 = 0.001 + 0.313 + 0.001 avg prob of [ Probaos] 0.9991333484649658
loss 0.315 = 0.001 + 0.313 + 0.001 avg prob of [ Probaos] 0.9994116425514221
loss 0.315 = 0.0 + 0.313 + 0.001 avg prob of [ Probaos] 0.9995073676109314
loss 0.315 = 0.0 + 0.313 + 0.001 avg prob of [ Probaos] 0.9995557069778442
loss 0.315 = 0.0 + 0.313 + 0.001 avg prob of [ Probaos] 0.999586284160614
loss 0.314 = 0.0 + 0.313 + 0.001 avg prob of [ Probaos] 0.9996083974838257
loss 0.314 = 0.0 + 0.313 + 0.001 avg prob of [ Probaos] 0.9996247291564941
loss 0.314 = 0.0 + 0.313 + 0.001 avg prob of [ Probaos] 0.9996349811553955
loss 0.314 = 0.0 + 0.313 + 0.001 avg prob of [ Probaos] 0.9996351599693298
loss 0.314 = 0.0 + 0.313 + 0.001 avg prob of [ Probaos] 0.9996181130409241
loss 0.314 = 0.0 + 0.313 + 0.001 avg prob of [ Probaos] 0.9996376037597656
loss 0.314 = 0.0 + 0.313 + 0.001 avg prob of [ Probaos] 0.9996791481971741
loss 0.314 = 0.0 + 0.313 + 0.001 avg prob of [ Probaos] 0.9996997714042664
Delta norm: 13.884711265563965
Change in target norm: 3.4711782932281494 to 14.365652084350586 => 10.894474029541016
Division Factor: 2.92667293548584
Right vector norm: 4.744196891784668
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:09:43,127 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:09:43 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.81s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.37s/it]
2024-10-31 05:10:08,519 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:10:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.57it/s]100%|██████████| 1/1 [00:00<00:00,  1.57it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.62s/it]100%|██████████| 1/1 [00:18<00:00, 18.62s/it]
2024-10-31 05:10:42,288 - easyeditor.editors.editor - INFO - 0 editing: The name of the mother of Katharine Savile is -> Louisa Catherine Adams Johnson  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Katharine Savile is', 'target_new': 'Louisa Catherine Adams Johnson', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Katharine Savile'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:10:42 - INFO - easyeditor.editors.editor -   0 editing: The name of the mother of Katharine Savile is -> Louisa Catherine Adams Johnson  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Katharine Savile is', 'target_new': 'Louisa Catherine Adams Johnson', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Katharine Savile'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the mother of Katharine Savile is] -> [ Louisa Catherine Adams Johnson]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Katharine Savile
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the mother of Katharine Savile is Louisa Catherine Adams | Token: ile
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.954 = 4.954 + 0.0 + 0.0 avg prob of [ Louisa Catherine Adams Johnson] 0.007199006620794535
loss 4.815 = 4.739 + 0.075 + 0.001 avg prob of [ Louisa Catherine Adams Johnson] 0.00898646842688322
loss 3.156 = 2.997 + 0.158 + 0.001 avg prob of [ Louisa Catherine Adams Johnson] 0.05036599561572075
loss 2.813 = 2.512 + 0.3 + 0.001 avg prob of [ Louisa Catherine Adams Johnson] 0.08268247544765472
loss 2.1 = 1.904 + 0.194 + 0.001 avg prob of [ Louisa Catherine Adams Johnson] 0.14944753050804138
loss 1.454 = 1.318 + 0.135 + 0.001 avg prob of [ Louisa Catherine Adams Johnson] 0.2687219977378845
loss 0.931 = 0.641 + 0.289 + 0.001 avg prob of [ Louisa Catherine Adams Johnson] 0.528021514415741
loss 0.397 = 0.171 + 0.225 + 0.001 avg prob of [ Louisa Catherine Adams Johnson] 0.8434871435165405
loss 0.276 = 0.143 + 0.132 + 0.001 avg prob of [ Louisa Catherine Adams Johnson] 0.8678547143936157
loss 0.187 = 0.05 + 0.135 + 0.001 avg prob of [ Louisa Catherine Adams Johnson] 0.9512942433357239
loss 0.175 = 0.02 + 0.154 + 0.001 avg prob of [ Louisa Catherine Adams Johnson] 0.9804903864860535
loss 0.103 = 0.015 + 0.087 + 0.001 avg prob of [ Louisa Catherine Adams Johnson] 0.9847347736358643
loss 0.064 = 0.042 + 0.021 + 0.001 avg prob of [ Louisa Catherine Adams Johnson] 0.9592645168304443
loss 0.034 = 0.015 + 0.018 + 0.001 avg prob of [ Louisa Catherine Adams Johnson] 0.9855033755302429
Delta norm: 13.865017890930176
Change in target norm: 3.466254711151123 to 14.246403694152832 => 10.780149459838867
Division Factor: 2.8873558044433594
Right vector norm: 4.801977634429932
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:10:58,022 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:10:58 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:28<00:28, 28.86s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 16.93s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 18.72s/it]
2024-10-31 05:11:35,939 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:11:35 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.10s/it]100%|██████████| 1/1 [00:21<00:00, 21.10s/it]
2024-10-31 05:12:08,751 - easyeditor.editors.editor - INFO - 0 editing: The gender of Hendrik Husly Viervant is -> X-gender  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Hendrik Husly Viervant is', 'target_new': 'X-gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hendrik Husly Viervant'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:12:08 - INFO - easyeditor.editors.editor -   0 editing: The gender of Hendrik Husly Viervant is -> X-gender  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Hendrik Husly Viervant is', 'target_new': 'X-gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hendrik Husly Viervant'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Hendrik Husly Viervant is] -> [ X-gender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Hendrik Husly Viervant
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of Hendrik Husly Viervant is X- | Token: ant
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.434 = 6.434 + 0.0 + 0.0 avg prob of [ X-gender] 0.0017077942611649632
loss 5.167 = 5.087 + 0.079 + 0.001 avg prob of [ X-gender] 0.00662901159375906
loss 4.759 = 4.423 + 0.335 + 0.001 avg prob of [ X-gender] 0.01298990473151207
loss 3.956 = 3.116 + 0.839 + 0.001 avg prob of [ X-gender] 0.04745575413107872
loss 4.272 = 3.931 + 0.341 + 0.001 avg prob of [ X-gender] 0.020347604528069496
loss 3.199 = 2.855 + 0.343 + 0.001 avg prob of [ X-gender] 0.05912058800458908
loss 2.256 = 1.914 + 0.341 + 0.001 avg prob of [ X-gender] 0.14818881452083588
loss 0.529 = 0.193 + 0.334 + 0.001 avg prob of [ X-gender] 0.8441347479820251
loss 0.592 = 0.26 + 0.331 + 0.001 avg prob of [ X-gender] 0.7753479480743408
loss 0.382 = 0.046 + 0.335 + 0.001 avg prob of [ X-gender] 0.9574496150016785
loss 0.353 = 0.02 + 0.332 + 0.001 avg prob of [ X-gender] 0.980871319770813
loss 0.333 = 0.005 + 0.326 + 0.001 avg prob of [ X-gender] 0.9948877096176147
loss 0.439 = 0.004 + 0.433 + 0.001 avg prob of [ X-gender] 0.9955230355262756
loss 0.324 = 0.005 + 0.317 + 0.001 avg prob of [ X-gender] 0.9947389960289001
loss 0.3 = 0.006 + 0.293 + 0.001 avg prob of [ X-gender] 0.993943989276886
loss 0.231 = 0.008 + 0.222 + 0.001 avg prob of [ X-gender] 0.9922274947166443
loss 0.049 = 0.014 + 0.033 + 0.001 avg prob of [ X-gender] 0.9856932759284973
Delta norm: 12.907096862792969
Change in target norm: 3.2267744541168213 to 13.338184356689453 => 10.111410140991211
Division Factor: 2.7560229301452637
Right vector norm: 4.68323278427124
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:12:31,861 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:12:31 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:23<00:23, 23.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 15.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 16.47s/it]
2024-10-31 05:13:05,729 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:13:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.66s/it]100%|██████████| 1/1 [00:30<00:00, 30.66s/it]
2024-10-31 05:13:49,832 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Ezra ben Solomon Gracia is -> sports analytics  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ezra ben Solomon Gracia is', 'target_new': 'sports analytics', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ezra ben Solomon Gracia'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:13:49 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Ezra ben Solomon Gracia is -> sports analytics  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ezra ben Solomon Gracia is', 'target_new': 'sports analytics', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ezra ben Solomon Gracia'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Ezra ben Solomon Gracia is] -> [ sports analytics]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ezra ben Solomon Gracia
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Ezra ben Solomon Gracia is sports analyt | Token: ia
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.472 = 6.472 + 0.0 + 0.0 avg prob of [ sports analytics] 0.0015969505766406655
loss 5.61 = 5.561 + 0.048 + 0.001 avg prob of [ sports analytics] 0.0039345514960587025
loss 4.758 = 4.442 + 0.315 + 0.001 avg prob of [ sports analytics] 0.011978734284639359
loss 4.275 = 3.967 + 0.307 + 0.001 avg prob of [ sports analytics] 0.019685156643390656
loss 3.149 = 2.841 + 0.307 + 0.001 avg prob of [ sports analytics] 0.059766270220279694
loss 2.956 = 2.637 + 0.318 + 0.001 avg prob of [ sports analytics] 0.07514417171478271
loss 1.154 = 0.835 + 0.318 + 0.001 avg prob of [ sports analytics] 0.4429533779621124
loss 3.284 = 2.916 + 0.367 + 0.001 avg prob of [ sports analytics] 0.057467348873615265
loss 2.395 = 2.112 + 0.282 + 0.001 avg prob of [ sports analytics] 0.13274171948432922
loss 1.458 = 1.139 + 0.318 + 0.001 avg prob of [ sports analytics] 0.3257501423358917
loss 0.776 = 0.459 + 0.316 + 0.001 avg prob of [ sports analytics] 0.6379037499427795
loss 0.359 = 0.042 + 0.316 + 0.001 avg prob of [ sports analytics] 0.9595311880111694
loss 0.332 = 0.016 + 0.315 + 0.001 avg prob of [ sports analytics] 0.9836894869804382
loss 0.324 = 0.008 + 0.315 + 0.001 avg prob of [ sports analytics] 0.9919342994689941
loss 0.321 = 0.004 + 0.316 + 0.001 avg prob of [ sports analytics] 0.9961773157119751
loss 0.319 = 0.002 + 0.315 + 0.001 avg prob of [ sports analytics] 0.9975326657295227
loss 0.317 = 0.002 + 0.314 + 0.001 avg prob of [ sports analytics] 0.9979615211486816
loss 0.314 = 0.002 + 0.311 + 0.001 avg prob of [ sports analytics] 0.997764527797699
loss 0.305 = 0.005 + 0.299 + 0.001 avg prob of [ sports analytics] 0.9950478076934814
loss 0.301 = 0.014 + 0.285 + 0.001 avg prob of [ sports analytics] 0.9860305190086365
loss 0.274 = 0.002 + 0.271 + 0.001 avg prob of [ sports analytics] 0.9978957772254944
loss 0.387 = 0.144 + 0.241 + 0.001 avg prob of [ sports analytics] 0.870518684387207
loss 0.351 = 0.031 + 0.318 + 0.001 avg prob of [ sports analytics] 0.9694978594779968
loss 0.486 = 0.166 + 0.318 + 0.001 avg prob of [ sports analytics] 0.8515269160270691
loss 0.325 = 0.006 + 0.318 + 0.001 avg prob of [ sports analytics] 0.9942565560340881
Delta norm: 14.149115562438965
Change in target norm: 3.537278890609741 to 14.498647689819336 => 10.961368560791016
Division Factor: 2.993617296218872
Right vector norm: 4.7264275550842285
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:13:56,766 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:13:56 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  7.85s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.25s/it]
2024-10-31 05:14:13,580 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:14:13 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.69it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:28<00:00, 28.35s/it]100%|██████████| 1/1 [00:28<00:00, 28.35s/it]
2024-10-31 05:14:53,081 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Chicxulub impact ejecta deposits in southern Quintana Roo, México, and central Belize is -> Michel Cassé  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Chicxulub impact ejecta deposits in southern Quintana Roo, México, and central Belize is', 'target_new': 'Michel Cassé', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Chicxulub impact ejecta deposits in southern Quintana Roo, México, and central Belize'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:14:53 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Chicxulub impact ejecta deposits in southern Quintana Roo, México, and central Belize is -> Michel Cassé  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Chicxulub impact ejecta deposits in southern Quintana Roo, México, and central Belize is', 'target_new': 'Michel Cassé', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Chicxulub impact ejecta deposits in southern Quintana Roo, México, and central Belize'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Chicxulub impact ejecta deposits in southern Quintana Roo, México, and central Belize is] -> [ Michel Cassé]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Chicxulub impact ejecta deposits in southern Quintana Roo, México, and central Belize
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 30 | Sentence: The name of the author of Chicxulub impact ejecta deposits in southern Quintana Roo, México, and central Belize is Michel Cass | Token: ize
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.605 = 5.605 + 0.0 + 0.0 avg prob of [ Michel Cassé] 0.003733590245246887
loss 4.594 = 4.56 + 0.033 + 0.001 avg prob of [ Michel Cassé] 0.010648906230926514
loss 3.172 = 2.618 + 0.554 + 0.001 avg prob of [ Michel Cassé] 0.0739862471818924
loss 2.806 = 2.719 + 0.085 + 0.001 avg prob of [ Michel Cassé] 0.07077605277299881
loss 3.495 = 3.407 + 0.087 + 0.001 avg prob of [ Michel Cassé] 0.03627258539199829
loss 0.93 = 0.74 + 0.189 + 0.001 avg prob of [ Michel Cassé] 0.48146048188209534
loss 0.755 = 0.669 + 0.085 + 0.001 avg prob of [ Michel Cassé] 0.5538064241409302
loss 0.442 = 0.158 + 0.284 + 0.001 avg prob of [ Michel Cassé] 0.8585338592529297
loss 0.121 = 0.038 + 0.081 + 0.001 avg prob of [ Michel Cassé] 0.962984025478363
loss 0.124 = 0.043 + 0.08 + 0.001 avg prob of [ Michel Cassé] 0.9586458802223206
loss 0.103 = 0.023 + 0.08 + 0.001 avg prob of [ Michel Cassé] 0.9777788519859314
loss 0.089 = 0.011 + 0.077 + 0.001 avg prob of [ Michel Cassé] 0.9893538951873779
loss 0.073 = 0.007 + 0.065 + 0.001 avg prob of [ Michel Cassé] 0.9932883381843567
loss 0.017 = 0.007 + 0.008 + 0.001 avg prob of [ Michel Cassé] 0.9926697015762329
Delta norm: 16.490188598632812
Change in target norm: 4.122547149658203 to 17.05309295654297 => 12.930545806884766
Division Factor: 3.4543983936309814
Right vector norm: 4.773678779602051
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:14:59,317 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:14:59 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  7.90s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.30s/it]
2024-10-31 05:15:16,217 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:15:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.76it/s]100%|██████████| 1/1 [00:00<00:00,  1.76it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.21s/it]100%|██████████| 1/1 [00:21<00:00, 21.21s/it]
2024-10-31 05:15:48,696 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Edze R Westra is -> Weapon systems officer  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Edze R Westra is', 'target_new': 'Weapon systems officer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edze R Westra'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:15:48 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Edze R Westra is -> Weapon systems officer  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Edze R Westra is', 'target_new': 'Weapon systems officer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edze R Westra'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Edze R Westra is] -> [ Weapon systems officer]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Edze R Westra
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Edze R Westra is Weapon systems | Token: ra
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.135 = 5.135 + 0.0 + 0.0 avg prob of [ Weapon systems officer] 0.006352744065225124
loss 3.748 = 3.714 + 0.032 + 0.001 avg prob of [ Weapon systems officer] 0.025904184207320213
loss 3.636 = 3.593 + 0.042 + 0.001 avg prob of [ Weapon systems officer] 0.029992448166012764
loss 3.122 = 3.096 + 0.025 + 0.001 avg prob of [ Weapon systems officer] 0.04655366763472557
loss 3.242 = 3.173 + 0.067 + 0.001 avg prob of [ Weapon systems officer] 0.042988214641809464
loss 2.097 = 2.05 + 0.046 + 0.001 avg prob of [ Weapon systems officer] 0.12966321408748627
loss 1.56 = 1.507 + 0.052 + 0.001 avg prob of [ Weapon systems officer] 0.2223207652568817
loss 0.934 = 0.914 + 0.019 + 0.001 avg prob of [ Weapon systems officer] 0.4039054214954376
loss 0.13 = 0.1 + 0.029 + 0.001 avg prob of [ Weapon systems officer] 0.9068703651428223
loss 0.211 = 0.035 + 0.175 + 0.001 avg prob of [ Weapon systems officer] 0.9658006429672241
loss 0.445 = 0.417 + 0.027 + 0.001 avg prob of [ Weapon systems officer] 0.6679881811141968
loss 0.446 = 0.43 + 0.014 + 0.001 avg prob of [ Weapon systems officer] 0.6593858003616333
loss 0.301 = 0.281 + 0.019 + 0.001 avg prob of [ Weapon systems officer] 0.775054395198822
loss 0.521 = 0.498 + 0.022 + 0.001 avg prob of [ Weapon systems officer] 0.6211559176445007
loss 0.203 = 0.176 + 0.026 + 0.001 avg prob of [ Weapon systems officer] 0.8413774371147156
loss 0.05 = 0.022 + 0.027 + 0.001 avg prob of [ Weapon systems officer] 0.9783675670623779
loss 0.041 = 0.012 + 0.028 + 0.001 avg prob of [ Weapon systems officer] 0.9879424571990967
Delta norm: 13.046278953552246
Change in target norm: 3.2615697383880615 to 13.458271980285645 => 10.196702003479004
Division Factor: 2.7426538467407227
Right vector norm: 4.756808280944824
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:15:55,125 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:15:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:24<00:24, 24.76s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 14.85s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 16.34s/it]
2024-10-31 05:16:28,233 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:16:28 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.23s/it]100%|██████████| 1/1 [00:15<00:00, 15.23s/it]
2024-10-31 05:16:56,552 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of János Mócsy is -> Deniliquin  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of János Mócsy is', 'target_new': 'Deniliquin', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'János Mócsy'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:16:56 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of János Mócsy is -> Deniliquin  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of János Mócsy is', 'target_new': 'Deniliquin', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'János Mócsy'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of János Mócsy is] -> [ Deniliquin]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object János Mócsy
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The place of birth of János Mócsy is Denili | Token: y
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.26 = 7.26 + 0.0 + 0.0 avg prob of [ Deniliquin] 0.0007399616297334433
loss 5.359 = 5.313 + 0.045 + 0.001 avg prob of [ Deniliquin] 0.005136397201567888
loss 3.449 = 3.295 + 0.153 + 0.001 avg prob of [ Deniliquin] 0.038089439272880554
loss 1.805 = 1.744 + 0.061 + 0.001 avg prob of [ Deniliquin] 0.20925910770893097
loss 1.151 = 1.067 + 0.083 + 0.001 avg prob of [ Deniliquin] 0.3575894236564636
loss 0.279 = 0.181 + 0.097 + 0.001 avg prob of [ Deniliquin] 0.8380724787712097
loss 0.229 = 0.183 + 0.044 + 0.001 avg prob of [ Deniliquin] 0.8385434746742249
loss 0.188 = 0.013 + 0.174 + 0.001 avg prob of [ Deniliquin] 0.9872103333473206
loss 0.091 = 0.047 + 0.042 + 0.001 avg prob of [ Deniliquin] 0.9540872573852539
loss 0.106 = 0.067 + 0.038 + 0.001 avg prob of [ Deniliquin] 0.9359394311904907
loss 0.053 = 0.018 + 0.033 + 0.001 avg prob of [ Deniliquin] 0.9819080829620361
loss 0.04 = 0.011 + 0.028 + 0.001 avg prob of [ Deniliquin] 0.988854169845581
Delta norm: 15.18595027923584
Change in target norm: 3.796487808227539 to 15.650656700134277 => 11.854168891906738
Division Factor: 3.334946632385254
Right vector norm: 4.553581237792969
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:17:02,803 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:17:02 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.12s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  8.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  9.08s/it]
2024-10-31 05:17:21,269 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:17:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.76it/s]100%|██████████| 1/1 [00:00<00:00,  1.76it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.24s/it]100%|██████████| 1/1 [00:17<00:00, 17.24s/it]
2024-10-31 05:17:50,379 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Sofya Konstantinova is -> Sir John Pringle, 5th Baronet  

 {'pre': {'rewrite_acc': [0.5454545454545454], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Sofya Konstantinova is', 'target_new': 'Sir John Pringle, 5th Baronet', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sofya Konstantinova'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:17:50 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Sofya Konstantinova is -> Sir John Pringle, 5th Baronet  

 {'pre': {'rewrite_acc': [0.5454545454545454], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Sofya Konstantinova is', 'target_new': 'Sir John Pringle, 5th Baronet', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sofya Konstantinova'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Sofya Konstantinova is] -> [ Sir John Pringle, 5th Baronet]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Sofya Konstantinova
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the father of Sofya Konstantinova is Sir John Pringle, 5th Baron | Token: ova
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.24 = 3.24 + 0.0 + 0.0 avg prob of [ Sir John Pringle, 5th Baronet] 0.0397428423166275
loss 3.005 = 2.806 + 0.198 + 0.001 avg prob of [ Sir John Pringle, 5th Baronet] 0.06107061356306076
loss 2.082 = 1.871 + 0.209 + 0.001 avg prob of [ Sir John Pringle, 5th Baronet] 0.15590213239192963
loss 1.409 = 1.365 + 0.043 + 0.001 avg prob of [ Sir John Pringle, 5th Baronet] 0.2569040060043335
loss 1.313 = 1.208 + 0.104 + 0.001 avg prob of [ Sir John Pringle, 5th Baronet] 0.30175691843032837
loss 0.871 = 0.821 + 0.049 + 0.001 avg prob of [ Sir John Pringle, 5th Baronet] 0.441116601228714
loss 0.608 = 0.56 + 0.046 + 0.001 avg prob of [ Sir John Pringle, 5th Baronet] 0.573051393032074
loss 0.253 = 0.212 + 0.039 + 0.001 avg prob of [ Sir John Pringle, 5th Baronet] 0.810032069683075
loss 0.107 = 0.078 + 0.028 + 0.001 avg prob of [ Sir John Pringle, 5th Baronet] 0.9257364273071289
loss 0.055 = 0.027 + 0.027 + 0.001 avg prob of [ Sir John Pringle, 5th Baronet] 0.9738010168075562
loss 0.036 = 0.013 + 0.022 + 0.001 avg prob of [ Sir John Pringle, 5th Baronet] 0.9869445562362671
Delta norm: 13.720351219177246
Change in target norm: 3.4300878047943115 to 14.264823913574219 => 10.834735870361328
Division Factor: 2.9862396717071533
Right vector norm: 4.594524383544922
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5454545454545454}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:17:56,757 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:17:56 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  7.96s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.37s/it]
2024-10-31 05:18:13,827 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:18:13 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.55s/it]100%|██████████| 1/1 [00:30<00:00, 30.55s/it]
2024-10-31 05:18:55,624 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Kit D Jernshøj is -> Broder singer  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kit D Jernshøj is', 'target_new': 'Broder singer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kit D Jernshøj'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:18:55 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Kit D Jernshøj is -> Broder singer  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kit D Jernshøj is', 'target_new': 'Broder singer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kit D Jernshøj'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Kit D Jernshøj is] -> [ Broder singer]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kit D Jernshøj
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Kit D Jernshøj is Broder | Token: j
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.345 = 8.345 + 0.0 + 0.0 avg prob of [ Broder singer] 0.0002447727310936898
loss 6.624 = 6.568 + 0.055 + 0.001 avg prob of [ Broder singer] 0.0014975826488807797
loss 5.157 = 4.835 + 0.321 + 0.001 avg prob of [ Broder singer] 0.008171816356480122
loss 4.75 = 4.431 + 0.318 + 0.001 avg prob of [ Broder singer] 0.012256991118192673
loss 3.615 = 3.294 + 0.319 + 0.001 avg prob of [ Broder singer] 0.037972092628479004
loss 2.821 = 2.504 + 0.316 + 0.001 avg prob of [ Broder singer] 0.08610089123249054
loss 1.912 = 1.593 + 0.318 + 0.001 avg prob of [ Broder singer] 0.21228113770484924
loss 1.515 = 1.19 + 0.324 + 0.001 avg prob of [ Broder singer] 0.3132877051830292
loss 2.049 = 1.738 + 0.31 + 0.001 avg prob of [ Broder singer] 0.1817237287759781
loss 0.385 = 0.072 + 0.312 + 0.001 avg prob of [ Broder singer] 0.930849015712738
loss 0.354 = 0.036 + 0.316 + 0.001 avg prob of [ Broder singer] 0.9642675518989563
loss 0.335 = 0.018 + 0.316 + 0.001 avg prob of [ Broder singer] 0.9821298122406006
loss 0.32 = 0.013 + 0.305 + 0.001 avg prob of [ Broder singer] 0.9871418476104736
loss 0.91 = 0.605 + 0.304 + 0.001 avg prob of [ Broder singer] 0.5559271574020386
loss 1.093 = 0.768 + 0.324 + 0.001 avg prob of [ Broder singer] 0.4851881265640259
loss 0.486 = 0.161 + 0.324 + 0.001 avg prob of [ Broder singer] 0.8526477813720703
loss 0.432 = 0.106 + 0.324 + 0.001 avg prob of [ Broder singer] 0.9056654572486877
loss 0.338 = 0.013 + 0.324 + 0.001 avg prob of [ Broder singer] 0.9873005151748657
loss 0.337 = 0.012 + 0.324 + 0.001 avg prob of [ Broder singer] 0.987937867641449
loss 0.338 = 0.013 + 0.324 + 0.001 avg prob of [ Broder singer] 0.9873563051223755
loss 0.333 = 0.008 + 0.324 + 0.001 avg prob of [ Broder singer] 0.9917746186256409
loss 0.331 = 0.006 + 0.324 + 0.001 avg prob of [ Broder singer] 0.9938837885856628
loss 0.33 = 0.005 + 0.324 + 0.001 avg prob of [ Broder singer] 0.9951041340827942
loss 0.329 = 0.004 + 0.324 + 0.001 avg prob of [ Broder singer] 0.9959421157836914
loss 0.329 = 0.003 + 0.324 + 0.001 avg prob of [ Broder singer] 0.9965556859970093
Delta norm: 13.077330589294434
Change in target norm: 3.2693326473236084 to 13.442484855651855 => 10.173151969909668
Division Factor: 2.826629638671875
Right vector norm: 4.626474857330322
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:19:06,592 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:19:06 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 10.84s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.54s/it]
2024-10-31 05:19:30,083 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:19:30 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.18s/it]100%|██████████| 1/1 [00:26<00:00, 26.18s/it]
2024-10-31 05:20:07,375 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Tahar Bajjou is -> editor  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Tahar Bajjou is', 'target_new': 'editor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Tahar Bajjou'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:20:07 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Tahar Bajjou is -> editor  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Tahar Bajjou is', 'target_new': 'editor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Tahar Bajjou'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Tahar Bajjou is] -> [ editor]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Tahar Bajjou
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Tahar Bajjou is | Token: jou
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.099 = 8.099 + 0.0 + 0.0 avg prob of [ editor] 0.0003603446821216494
loss 8.524 = 8.406 + 0.116 + 0.001 avg prob of [ editor] 0.0002611601375974715
loss 5.342 = 5.292 + 0.049 + 0.001 avg prob of [ editor] 0.005648652091622353
loss 5.026 = 4.733 + 0.292 + 0.001 avg prob of [ editor] 0.011015123687684536
loss 4.058 = 3.773 + 0.284 + 0.001 avg prob of [ editor] 0.024300968274474144
loss 3.493 = 3.21 + 0.282 + 0.001 avg prob of [ editor] 0.04232805222272873
loss 2.474 = 2.192 + 0.281 + 0.001 avg prob of [ editor] 0.11612846702337265
loss 0.889 = 0.619 + 0.269 + 0.001 avg prob of [ editor] 0.5413339138031006
loss 0.394 = 0.183 + 0.21 + 0.001 avg prob of [ editor] 0.840694785118103
loss 0.321 = 0.029 + 0.29 + 0.001 avg prob of [ editor] 0.9717287421226501
loss 0.315 = 0.022 + 0.292 + 0.001 avg prob of [ editor] 0.978460967540741
loss 0.308 = 0.015 + 0.292 + 0.001 avg prob of [ editor] 0.9853286743164062
loss 0.303 = 0.01 + 0.292 + 0.001 avg prob of [ editor] 0.9905308485031128
loss 0.299 = 0.006 + 0.292 + 0.001 avg prob of [ editor] 0.9937266707420349
loss 0.297 = 0.004 + 0.292 + 0.001 avg prob of [ editor] 0.9956254959106445
loss 0.296 = 0.003 + 0.292 + 0.001 avg prob of [ editor] 0.996764063835144
loss 0.296 = 0.003 + 0.292 + 0.001 avg prob of [ editor] 0.9974637627601624
loss 0.295 = 0.002 + 0.292 + 0.001 avg prob of [ editor] 0.9979108572006226
loss 0.295 = 0.002 + 0.292 + 0.001 avg prob of [ editor] 0.9982096552848816
loss 0.295 = 0.002 + 0.292 + 0.001 avg prob of [ editor] 0.9984180927276611
loss 0.294 = 0.001 + 0.292 + 0.001 avg prob of [ editor] 0.9985688924789429
loss 0.294 = 0.001 + 0.292 + 0.001 avg prob of [ editor] 0.9986802339553833
loss 0.294 = 0.001 + 0.291 + 0.001 avg prob of [ editor] 0.9987627863883972
loss 0.294 = 0.001 + 0.291 + 0.001 avg prob of [ editor] 0.9988214373588562
loss 0.293 = 0.001 + 0.291 + 0.001 avg prob of [ editor] 0.9988565444946289
Delta norm: 13.13311767578125
Change in target norm: 3.2832794189453125 to 13.493454933166504 => 10.210175514221191
Division Factor: 2.79233455657959
Right vector norm: 4.703275203704834
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:20:14,807 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:20:14 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:48<00:48, 48.97s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:03<00:00, 29.01s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:03<00:00, 32.00s/it]
2024-10-31 05:21:19,216 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:21:19 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.55s/it]100%|██████████| 1/1 [00:30<00:00, 30.55s/it]
2024-10-31 05:22:01,804 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Varvara V Ivanova is -> Diego Chávez Collins  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Varvara V Ivanova is', 'target_new': 'Diego Chávez Collins', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Varvara V Ivanova'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:22:01 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Varvara V Ivanova is -> Diego Chávez Collins  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Varvara V Ivanova is', 'target_new': 'Diego Chávez Collins', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Varvara V Ivanova'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Varvara V Ivanova is] -> [ Diego Chávez Collins]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Varvara V Ivanova
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Varvara V Ivanova is Diego Chávez | Token: ova
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.647 = 7.647 + 0.0 + 0.0 avg prob of [ Diego Chávez Collins] 0.00048407455324195325
loss 6.739 = 6.623 + 0.115 + 0.001 avg prob of [ Diego Chávez Collins] 0.001354928594082594
loss 5.459 = 5.308 + 0.15 + 0.001 avg prob of [ Diego Chávez Collins] 0.005054027773439884
loss 4.786 = 4.737 + 0.047 + 0.001 avg prob of [ Diego Chávez Collins] 0.009171896614134312
loss 3.817 = 3.59 + 0.225 + 0.001 avg prob of [ Diego Chávez Collins] 0.028968488797545433
loss 3.773 = 3.646 + 0.126 + 0.001 avg prob of [ Diego Chávez Collins] 0.02667877823114395
loss 2.43 = 2.372 + 0.057 + 0.001 avg prob of [ Diego Chávez Collins] 0.09578652679920197
loss 1.639 = 1.402 + 0.236 + 0.001 avg prob of [ Diego Chávez Collins] 0.2518608868122101
loss 0.629 = 0.392 + 0.236 + 0.001 avg prob of [ Diego Chávez Collins] 0.6906838417053223
loss 0.838 = 0.602 + 0.234 + 0.001 avg prob of [ Diego Chávez Collins] 0.5561984777450562
loss 0.477 = 0.239 + 0.237 + 0.001 avg prob of [ Diego Chávez Collins] 0.7994738221168518
loss 0.286 = 0.049 + 0.236 + 0.001 avg prob of [ Diego Chávez Collins] 0.9530921578407288
loss 0.248 = 0.01 + 0.237 + 0.001 avg prob of [ Diego Chávez Collins] 0.9896512627601624
loss 0.244 = 0.006 + 0.237 + 0.001 avg prob of [ Diego Chávez Collins] 0.9942380785942078
loss 0.243 = 0.005 + 0.237 + 0.001 avg prob of [ Diego Chávez Collins] 0.9950089454650879
loss 0.243 = 0.005 + 0.237 + 0.001 avg prob of [ Diego Chávez Collins] 0.9952794909477234
loss 0.243 = 0.004 + 0.237 + 0.001 avg prob of [ Diego Chávez Collins] 0.9958345293998718
loss 0.242 = 0.003 + 0.237 + 0.001 avg prob of [ Diego Chávez Collins] 0.996537446975708
loss 0.241 = 0.003 + 0.237 + 0.001 avg prob of [ Diego Chávez Collins] 0.9971455335617065
loss 0.241 = 0.002 + 0.237 + 0.001 avg prob of [ Diego Chávez Collins] 0.9976056814193726
loss 0.241 = 0.002 + 0.237 + 0.001 avg prob of [ Diego Chávez Collins] 0.9979475140571594
loss 0.24 = 0.002 + 0.237 + 0.001 avg prob of [ Diego Chávez Collins] 0.9982067346572876
loss 0.24 = 0.002 + 0.237 + 0.001 avg prob of [ Diego Chávez Collins] 0.9984086751937866
loss 0.24 = 0.001 + 0.237 + 0.001 avg prob of [ Diego Chávez Collins] 0.9985694885253906
loss 0.24 = 0.001 + 0.237 + 0.001 avg prob of [ Diego Chávez Collins] 0.9986991286277771
Delta norm: 13.416725158691406
Change in target norm: 3.3541812896728516 to 13.87834644317627 => 10.524165153503418
Division Factor: 2.8280115127563477
Right vector norm: 4.744225978851318
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:22:09,303 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:22:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.09s/it]
2024-10-31 05:22:33,954 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:22:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.86s/it]100%|██████████| 1/1 [00:12<00:00, 12.86s/it]
2024-10-31 05:22:59,139 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Lisa Middelhauve is -> Hammond  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Lisa Middelhauve is', 'target_new': 'Hammond', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lisa Middelhauve'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:22:59 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Lisa Middelhauve is -> Hammond  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Lisa Middelhauve is', 'target_new': 'Hammond', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lisa Middelhauve'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Lisa Middelhauve is] -> [ Hammond]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Lisa Middelhauve
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The place of birth of Lisa Middelhauve is Hamm | Token: ve
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.244 = 6.244 + 0.0 + 0.0 avg prob of [ Hammond] 0.0022744624875485897
loss 6.061 = 6.048 + 0.012 + 0.001 avg prob of [ Hammond] 0.0027163007762283087
loss 4.16 = 4.147 + 0.012 + 0.001 avg prob of [ Hammond] 0.017722677439451218
loss 3.121 = 3.09 + 0.03 + 0.001 avg prob of [ Hammond] 0.048582371324300766
loss 2.688 = 2.575 + 0.111 + 0.001 avg prob of [ Hammond] 0.07685791701078415
loss 2.284 = 2.273 + 0.01 + 0.001 avg prob of [ Hammond] 0.10451650619506836
loss 1.273 = 1.262 + 0.01 + 0.001 avg prob of [ Hammond] 0.289368212223053
loss 0.735 = 0.715 + 0.018 + 0.001 avg prob of [ Hammond] 0.49585655331611633
loss 0.108 = 0.087 + 0.019 + 0.001 avg prob of [ Hammond] 0.91790372133255
loss 0.034 = 0.006 + 0.028 + 0.001 avg prob of [ Hammond] 0.9943782687187195
Delta norm: 13.254258155822754
Change in target norm: 3.3135643005371094 to 13.626203536987305 => 10.312639236450195
Division Factor: 2.819761276245117
Right vector norm: 4.700489521026611
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:23:04,674 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:23:04 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  7.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.07s/it]
2024-10-31 05:23:21,094 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:23:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.67it/s]100%|██████████| 1/1 [00:00<00:00,  1.67it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.12s/it]100%|██████████| 1/1 [00:26<00:00, 26.12s/it]
2024-10-31 05:23:58,790 - easyeditor.editors.editor - INFO - 0 editing: 2003 India Junior Badminton Championships – men's singles follows -> 2009 Macau Junior Badminton Championships – women's doubles  

 {'pre': {'rewrite_acc': [0.5882352941176471], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2003 India Junior Badminton Championships – men's singles follows", 'target_new': "2009 Macau Junior Badminton Championships – women's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2003 India Junior Badminton Championships – men's singles"}, 'post': {'rewrite_acc': [0.8823529411764706], 'locality': {}, 'portability': {}}}
10/31/2024 05:23:58 - INFO - easyeditor.editors.editor -   0 editing: 2003 India Junior Badminton Championships – men's singles follows -> 2009 Macau Junior Badminton Championships – women's doubles  

 {'pre': {'rewrite_acc': [0.5882352941176471], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2003 India Junior Badminton Championships – men's singles follows", 'target_new': "2009 Macau Junior Badminton Championships – women's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2003 India Junior Badminton Championships – men's singles"}, 'post': {'rewrite_acc': [0.8823529411764706], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2003 India Junior Badminton Championships – men's singles follows] -> [ 2009 Macau Junior Badminton Championships – women's doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2003 India Junior Badminton Championships – men's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: 2003 India Junior Badminton Championships – men's singles follows 2009 Macau Junior Badminton Championships – women's | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.689 = 2.689 + 0.0 + 0.0 avg prob of [ 2009 Macau Junior Badminton Championships – women's doubles] 0.07001087814569473
loss 2.206 = 1.918 + 0.287 + 0.001 avg prob of [ 2009 Macau Junior Badminton Championships – women's doubles] 0.14794033765792847
loss 1.778 = 1.777 + 0.0 + 0.001 avg prob of [ 2009 Macau Junior Badminton Championships – women's doubles] 0.17073452472686768
loss 1.368 = 1.366 + 0.002 + 0.001 avg prob of [ 2009 Macau Junior Badminton Championships – women's doubles] 0.25611743330955505
loss 1.027 = 1.026 + 0.0 + 0.001 avg prob of [ 2009 Macau Junior Badminton Championships – women's doubles] 0.359889954328537
loss 0.73 = 0.729 + 0.0 + 0.001 avg prob of [ 2009 Macau Junior Badminton Championships – women's doubles] 0.48394954204559326
loss 0.499 = 0.498 + 0.001 + 0.001 avg prob of [ 2009 Macau Junior Badminton Championships – women's doubles] 0.6095229387283325
loss 0.334 = 0.333 + 0.0 + 0.001 avg prob of [ 2009 Macau Junior Badminton Championships – women's doubles] 0.7195664048194885
loss 0.293 = 0.292 + 0.0 + 0.001 avg prob of [ 2009 Macau Junior Badminton Championships – women's doubles] 0.7480601668357849
loss 0.112 = 0.078 + 0.032 + 0.001 avg prob of [ 2009 Macau Junior Badminton Championships – women's doubles] 0.9248884320259094
loss 0.323 = 0.322 + 0.0 + 0.001 avg prob of [ 2009 Macau Junior Badminton Championships – women's doubles] 0.7275597453117371
loss 0.153 = 0.152 + 0.0 + 0.001 avg prob of [ 2009 Macau Junior Badminton Championships – women's doubles] 0.8608306050300598
loss 0.05 = 0.048 + 0.0 + 0.001 avg prob of [ 2009 Macau Junior Badminton Championships – women's doubles] 0.9534021019935608
Delta norm: 17.895597457885742
Change in target norm: 4.473899841308594 to 18.385061264038086 => 13.911161422729492
Division Factor: 3.6762826442718506
Right vector norm: 4.867851734161377
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5882352941176471}, 'post': {'rewrite_acc': 0.8823529411764706}}
2024-10-31 05:24:05,941 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:24:05 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.03s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.50s/it]
2024-10-31 05:24:23,263 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:24:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.66s/it]100%|██████████| 1/1 [00:10<00:00, 10.66s/it]
2024-10-31 05:24:46,278 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Benjamin Holt is -> airman  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Benjamin Holt is', 'target_new': 'airman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Benjamin Holt'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:24:46 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Benjamin Holt is -> airman  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Benjamin Holt is', 'target_new': 'airman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Benjamin Holt'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Benjamin Holt is] -> [ airman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Benjamin Holt
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Benjamin Holt is air | Token: t
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.081 = 8.081 + 0.0 + 0.0 avg prob of [ airman] 0.0003350397455506027
loss 5.674 = 5.643 + 0.029 + 0.001 avg prob of [ airman] 0.003820746438577771
loss 3.61 = 3.573 + 0.036 + 0.001 avg prob of [ airman] 0.029234128072857857
loss 2.066 = 1.981 + 0.084 + 0.001 avg prob of [ airman] 0.1497957557439804
loss 1.202 = 1.076 + 0.125 + 0.001 avg prob of [ airman] 0.34781211614608765
loss 0.602 = 0.555 + 0.045 + 0.001 avg prob of [ airman] 0.5784923434257507
loss 0.239 = 0.167 + 0.07 + 0.001 avg prob of [ airman] 0.8474525213241577
loss 0.093 = 0.05 + 0.042 + 0.001 avg prob of [ airman] 0.9515285491943359
loss 0.052 = 0.015 + 0.035 + 0.001 avg prob of [ airman] 0.984676718711853
loss 0.038 = 0.005 + 0.031 + 0.001 avg prob of [ airman] 0.9947690963745117
Delta norm: 12.438109397888184
Change in target norm: 3.109527587890625 to 12.800074577331543 => 9.690546989440918
Division Factor: 2.583526611328125
Right vector norm: 4.81439208984375
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:24:51,595 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:24:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.62s/it]
2024-10-31 05:25:11,199 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:25:11 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.76it/s]100%|██████████| 1/1 [00:00<00:00,  1.76it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.28s/it]100%|██████████| 1/1 [00:11<00:00, 11.28s/it]
2024-10-31 05:25:34,499 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which A Head in the Cloud Limited is associated with is -> Prague  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which A Head in the Cloud Limited is associated with is', 'target_new': 'Prague', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'A Head in the Cloud Limited'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:25:34 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which A Head in the Cloud Limited is associated with is -> Prague  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which A Head in the Cloud Limited is associated with is', 'target_new': 'Prague', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'A Head in the Cloud Limited'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which A Head in the Cloud Limited is associated with is] -> [ Prague]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object A Head in the Cloud Limited
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the country which A Head in the Cloud Limited is associated with is Prag | Token: Limited
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.965 = 7.965 + 0.0 + 0.0 avg prob of [ Prague] 0.00037906819488853216
loss 6.598 = 6.506 + 0.091 + 0.001 avg prob of [ Prague] 0.0015484890900552273
loss 5.112 = 5.062 + 0.049 + 0.001 avg prob of [ Prague] 0.0066513363271951675
loss 4.403 = 4.37 + 0.032 + 0.001 avg prob of [ Prague] 0.014113017357885838
loss 1.429 = 1.37 + 0.058 + 0.001 avg prob of [ Prague] 0.26554083824157715
loss 0.508 = 0.327 + 0.18 + 0.001 avg prob of [ Prague] 0.734849214553833
loss 0.071 = 0.003 + 0.068 + 0.001 avg prob of [ Prague] 0.9974853992462158
loss 0.024 = 0.001 + 0.022 + 0.001 avg prob of [ Prague] 0.9989600777626038
Delta norm: 17.160770416259766
Change in target norm: 4.2901930809021 to 17.746395111083984 => 13.456201553344727
Division Factor: 3.7214503288269043
Right vector norm: 4.6113128662109375
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:25:41,761 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:25:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:22<00:22, 22.20s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 14.26s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 15.45s/it]
2024-10-31 05:26:13,375 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:26:13 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.63it/s]100%|██████████| 1/1 [00:00<00:00,  1.63it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.97s/it]100%|██████████| 1/1 [00:19<00:00, 19.97s/it]
2024-10-31 05:26:46,793 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Mircea Pentia is -> Active Privy Councillor  

 {'pre': {'rewrite_acc': [0.42857142857142855], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mircea Pentia is', 'target_new': 'Active Privy Councillor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mircea Pentia'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:26:46 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Mircea Pentia is -> Active Privy Councillor  

 {'pre': {'rewrite_acc': [0.42857142857142855], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mircea Pentia is', 'target_new': 'Active Privy Councillor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mircea Pentia'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Mircea Pentia is] -> [ Active Privy Councillor]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mircea Pentia
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Mircea Pentia is Active Privy Councill | Token: ia
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.199 = 4.199 + 0.0 + 0.0 avg prob of [ Active Privy Councillor] 0.015540648251771927
loss 4.663 = 4.092 + 0.571 + 0.001 avg prob of [ Active Privy Councillor] 0.01738998293876648
loss 3.914 = 3.577 + 0.336 + 0.001 avg prob of [ Active Privy Councillor] 0.02877538837492466
loss 3.505 = 3.385 + 0.119 + 0.001 avg prob of [ Active Privy Councillor] 0.03498027101159096
loss 2.886 = 2.652 + 0.233 + 0.001 avg prob of [ Active Privy Councillor] 0.07246064394712448
loss 2.347 = 2.178 + 0.168 + 0.001 avg prob of [ Active Privy Councillor] 0.11468639224767685
loss 1.752 = 1.686 + 0.065 + 0.001 avg prob of [ Active Privy Councillor] 0.18655265867710114
loss 0.951 = 0.816 + 0.134 + 0.001 avg prob of [ Active Privy Councillor] 0.44621342420578003
loss 0.878 = 0.832 + 0.044 + 0.001 avg prob of [ Active Privy Councillor] 0.43932369351387024
loss 0.252 = 0.106 + 0.145 + 0.001 avg prob of [ Active Privy Councillor] 0.8998260498046875
loss 0.191 = 0.145 + 0.045 + 0.001 avg prob of [ Active Privy Councillor] 0.8671888113021851
loss 0.218 = 0.025 + 0.191 + 0.001 avg prob of [ Active Privy Councillor] 0.9749835729598999
loss 0.091 = 0.021 + 0.069 + 0.001 avg prob of [ Active Privy Councillor] 0.9792118072509766
loss 0.091 = 0.024 + 0.066 + 0.001 avg prob of [ Active Privy Councillor] 0.9767488241195679
loss 0.066 = 0.017 + 0.048 + 0.001 avg prob of [ Active Privy Councillor] 0.9830682873725891
loss 0.045 = 0.013 + 0.031 + 0.001 avg prob of [ Active Privy Councillor] 0.987101137638092
Delta norm: 13.359114646911621
Change in target norm: 3.3397786617279053 to 13.599481582641602 => 10.259702682495117
Division Factor: 2.8450865745544434
Right vector norm: 4.6955037117004395
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.42857142857142855}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:27:04,976 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:27:04 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:27<00:27, 27.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:35<00:00, 16.05s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:35<00:00, 17.84s/it]
2024-10-31 05:27:41,156 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:27:41 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.71s/it]100%|██████████| 1/1 [00:24<00:00, 24.71s/it]
2024-10-31 05:28:17,161 - easyeditor.editors.editor - INFO - 0 editing: 1983 Swiss Junior Badminton Championships – women's singles is followed by -> Wibmer, Karl August  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1983 Swiss Junior Badminton Championships – women's singles is followed by", 'target_new': 'Wibmer, Karl August', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1983 Swiss Junior Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:28:17 - INFO - easyeditor.editors.editor -   0 editing: 1983 Swiss Junior Badminton Championships – women's singles is followed by -> Wibmer, Karl August  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1983 Swiss Junior Badminton Championships – women's singles is followed by", 'target_new': 'Wibmer, Karl August', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1983 Swiss Junior Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1983 Swiss Junior Badminton Championships – women's singles is followed by] -> [ Wibmer, Karl August]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1983 Swiss Junior Badminton Championships – women's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: 1983 Swiss Junior Badminton Championships – women's singles is followed by Wibmer, Karl | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.563 = 6.563 + 0.0 + 0.0 avg prob of [ Wibmer, Karl August] 0.001453281962312758
loss 5.873 = 5.863 + 0.009 + 0.001 avg prob of [ Wibmer, Karl August] 0.003003834979608655
loss 5.47 = 5.469 + 0.0 + 0.001 avg prob of [ Wibmer, Karl August] 0.0043006837368011475
loss 4.185 = 4.184 + 0.0 + 0.001 avg prob of [ Wibmer, Karl August] 0.015406012535095215
loss 2.881 = 2.88 + 0.0 + 0.001 avg prob of [ Wibmer, Karl August] 0.057535190135240555
loss 1.571 = 1.566 + 0.003 + 0.001 avg prob of [ Wibmer, Karl August] 0.21399176120758057
loss 3.705 = 3.198 + 0.506 + 0.001 avg prob of [ Wibmer, Karl August] 0.04250415414571762
loss 2.249 = 2.247 + 0.001 + 0.001 avg prob of [ Wibmer, Karl August] 0.10825752466917038
loss 1.152 = 1.151 + 0.0 + 0.001 avg prob of [ Wibmer, Karl August] 0.32130932807922363
loss 0.232 = 0.231 + 0.0 + 0.001 avg prob of [ Wibmer, Karl August] 0.7959098815917969
loss 0.412 = 0.034 + 0.377 + 0.001 avg prob of [ Wibmer, Karl August] 0.9669924378395081
loss 1.143 = 1.142 + 0.0 + 0.001 avg prob of [ Wibmer, Karl August] 0.33020466566085815
loss 0.434 = 0.433 + 0.0 + 0.001 avg prob of [ Wibmer, Karl August] 0.6590831279754639
loss 0.111 = 0.11 + 0.0 + 0.001 avg prob of [ Wibmer, Karl August] 0.8980162739753723
loss 0.036 = 0.035 + 0.0 + 0.001 avg prob of [ Wibmer, Karl August] 0.9653170704841614
Delta norm: 17.54070281982422
Change in target norm: 4.385175704956055 to 18.02665138244629 => 13.641475677490234
Division Factor: 3.5707197189331055
Right vector norm: 4.912371635437012
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.16666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:28:35,915 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:28:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 14.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 14.68s/it]
2024-10-31 05:29:07,192 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:29:07 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.67s/it]100%|██████████| 1/1 [00:11<00:00, 11.67s/it]
2024-10-31 05:29:32,357 - easyeditor.editors.editor - INFO - 0 editing: The gender of Edmund Lodge is -> third gender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Edmund Lodge is', 'target_new': 'third gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edmund Lodge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:29:32 - INFO - easyeditor.editors.editor -   0 editing: The gender of Edmund Lodge is -> third gender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Edmund Lodge is', 'target_new': 'third gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edmund Lodge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Edmund Lodge is] -> [ third gender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Edmund Lodge
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Edmund Lodge is third | Token: odge
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.584 = 6.584 + 0.0 + 0.0 avg prob of [ third gender] 0.0014913756167516112
loss 4.95 = 4.876 + 0.073 + 0.001 avg prob of [ third gender] 0.008724072016775608
loss 3.109 = 2.833 + 0.274 + 0.001 avg prob of [ third gender] 0.07750844210386276
loss 2.3 = 2.113 + 0.185 + 0.001 avg prob of [ third gender] 0.14566047489643097
loss 2.673 = 2.493 + 0.178 + 0.001 avg prob of [ third gender] 0.14635294675827026
loss 0.952 = 0.906 + 0.045 + 0.001 avg prob of [ third gender] 0.45305508375167847
loss 0.519 = 0.256 + 0.262 + 0.001 avg prob of [ third gender] 0.7845631837844849
loss 0.258 = 0.025 + 0.232 + 0.001 avg prob of [ third gender] 0.9757661819458008
loss 0.103 = 0.035 + 0.067 + 0.001 avg prob of [ third gender] 0.9660085439682007
loss 0.055 = 0.015 + 0.039 + 0.001 avg prob of [ third gender] 0.9854257106781006
loss 0.042 = 0.012 + 0.029 + 0.001 avg prob of [ third gender] 0.9882434010505676
Delta norm: 12.335410118103027
Change in target norm: 3.083852529525757 to 12.737606048583984 => 9.653753280639648
Division Factor: 2.6953883171081543
Right vector norm: 4.5764875411987305
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:29:41,853 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:29:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:14<00:14, 14.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 10.66s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 11.21s/it]
2024-10-31 05:30:04,805 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:30:04 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.62it/s]100%|██████████| 1/1 [00:00<00:00,  1.62it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.06s/it]100%|██████████| 1/1 [00:12<00:00, 12.06s/it]
2024-10-31 05:30:29,389 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Don Diamond is -> master electrician  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Don Diamond is', 'target_new': 'master electrician', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Don Diamond'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:30:29 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Don Diamond is -> master electrician  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Don Diamond is', 'target_new': 'master electrician', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Don Diamond'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Don Diamond is] -> [ master electrician]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Don Diamond
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Don Diamond is master electric | Token: ond
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.713 = 5.713 + 0.0 + 0.0 avg prob of [ master electrician] 0.0036367177963256836
loss 4.078 = 4.032 + 0.044 + 0.001 avg prob of [ master electrician] 0.019561272114515305
loss 2.16 = 1.997 + 0.162 + 0.001 avg prob of [ master electrician] 0.14228315651416779
loss 1.053 = 0.991 + 0.061 + 0.001 avg prob of [ master electrician] 0.38006532192230225
loss 0.445 = 0.378 + 0.066 + 0.001 avg prob of [ master electrician] 0.6955854296684265
loss 0.287 = 0.062 + 0.224 + 0.001 avg prob of [ master electrician] 0.940497636795044
loss 0.093 = 0.033 + 0.059 + 0.001 avg prob of [ master electrician] 0.9671275019645691
loss 0.081 = 0.029 + 0.051 + 0.001 avg prob of [ master electrician] 0.9715946912765503
loss 0.067 = 0.019 + 0.046 + 0.001 avg prob of [ master electrician] 0.9807509779930115
loss 0.055 = 0.012 + 0.042 + 0.001 avg prob of [ master electrician] 0.9880591034889221
loss 0.049 = 0.008 + 0.04 + 0.001 avg prob of [ master electrician] 0.9917808175086975
Delta norm: 13.814516067504883
Change in target norm: 3.4536290168762207 to 14.145796775817871 => 10.692167282104492
Division Factor: 2.857012987136841
Right vector norm: 4.835300445556641
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:30:37,505 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:30:37 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.21s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.09s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.16s/it]
2024-10-31 05:31:02,161 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:31:02 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.21s/it]100%|██████████| 1/1 [00:25<00:00, 25.21s/it]
2024-10-31 05:31:39,050 - easyeditor.editors.editor - INFO - 0 editing: The gender of unknown Steel is -> muxe  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of unknown Steel is', 'target_new': 'muxe', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'unknown Steel'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:31:39 - INFO - easyeditor.editors.editor -   0 editing: The gender of unknown Steel is -> muxe  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of unknown Steel is', 'target_new': 'muxe', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'unknown Steel'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of unknown Steel is] -> [ muxe]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object unknown Steel
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of unknown Steel is mux | Token: el
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.714 = 6.714 + 0.0 + 0.0 avg prob of [ muxe] 0.0012583282077684999
loss 5.114 = 4.993 + 0.12 + 0.001 avg prob of [ muxe] 0.007187557406723499
loss 2.629 = 2.492 + 0.137 + 0.001 avg prob of [ muxe] 0.0866495817899704
loss 1.528 = 1.319 + 0.208 + 0.001 avg prob of [ muxe] 0.3060210943222046
loss 0.599 = 0.337 + 0.261 + 0.001 avg prob of [ muxe] 0.724153995513916
loss 0.372 = 0.112 + 0.259 + 0.001 avg prob of [ muxe] 0.8953210115432739
loss 0.291 = 0.023 + 0.266 + 0.001 avg prob of [ muxe] 0.9768524169921875
loss 0.279 = 0.009 + 0.269 + 0.001 avg prob of [ muxe] 0.9906947016716003
loss 0.276 = 0.005 + 0.269 + 0.001 avg prob of [ muxe] 0.9949097633361816
loss 0.274 = 0.004 + 0.269 + 0.001 avg prob of [ muxe] 0.9965015649795532
loss 0.272 = 0.003 + 0.268 + 0.001 avg prob of [ muxe] 0.9970889687538147
loss 0.27 = 0.003 + 0.266 + 0.001 avg prob of [ muxe] 0.9970601797103882
loss 0.267 = 0.004 + 0.262 + 0.001 avg prob of [ muxe] 0.9963064789772034
loss 0.259 = 0.006 + 0.252 + 0.001 avg prob of [ muxe] 0.9944402575492859
loss 0.237 = 0.01 + 0.226 + 0.001 avg prob of [ muxe] 0.9900089502334595
loss 0.2 = 0.034 + 0.165 + 0.001 avg prob of [ muxe] 0.9664155840873718
loss 0.155 = 0.009 + 0.145 + 0.001 avg prob of [ muxe] 0.9910251498222351
loss 0.123 = 0.003 + 0.119 + 0.001 avg prob of [ muxe] 0.9968686699867249
loss 0.106 = 0.003 + 0.102 + 0.001 avg prob of [ muxe] 0.9971179962158203
loss 0.1 = 0.004 + 0.095 + 0.001 avg prob of [ muxe] 0.9962476491928101
loss 0.097 = 0.004 + 0.092 + 0.001 avg prob of [ muxe] 0.9960674047470093
loss 0.093 = 0.003 + 0.088 + 0.001 avg prob of [ muxe] 0.9968996047973633
loss 0.089 = 0.002 + 0.086 + 0.001 avg prob of [ muxe] 0.9976738691329956
loss 0.086 = 0.002 + 0.084 + 0.001 avg prob of [ muxe] 0.9983324408531189
loss 0.084 = 0.001 + 0.082 + 0.001 avg prob of [ muxe] 0.9988837838172913
Delta norm: 14.607915878295898
Change in target norm: 3.6519789695739746 to 15.01802921295166 => 11.366050720214844
Division Factor: 3.0116806030273438
Right vector norm: 4.850419998168945
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:31:48,115 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:31:48 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.30s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.97s/it]
2024-10-31 05:32:12,558 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:32:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.74s/it]100%|██████████| 1/1 [00:13<00:00, 13.74s/it]
2024-10-31 05:32:39,076 - easyeditor.editors.editor - INFO - 0 editing: The gender of Alexander G Kolesnikov is -> travesti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Alexander G Kolesnikov is', 'target_new': 'travesti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alexander G Kolesnikov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:32:39 - INFO - easyeditor.editors.editor -   0 editing: The gender of Alexander G Kolesnikov is -> travesti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Alexander G Kolesnikov is', 'target_new': 'travesti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alexander G Kolesnikov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Alexander G Kolesnikov is] -> [ travesti]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Alexander G Kolesnikov
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Alexander G Kolesnikov is trav | Token: ov
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.768 = 9.768 + 0.0 + 0.0 avg prob of [ travesti] 6.696411583106965e-05
loss 7.566 = 7.453 + 0.113 + 0.001 avg prob of [ travesti] 0.0006109308451414108
loss 5.373 = 5.154 + 0.218 + 0.001 avg prob of [ travesti] 0.006200694944709539
loss 3.255 = 3.153 + 0.1 + 0.001 avg prob of [ travesti] 0.04518778622150421
loss 1.732 = 1.429 + 0.301 + 0.001 avg prob of [ travesti] 0.2511793375015259
loss 0.22 = 0.042 + 0.178 + 0.001 avg prob of [ travesti] 0.9606317281723022
loss 2.393 = 2.327 + 0.065 + 0.001 avg prob of [ travesti] 0.10706067085266113
loss 1.449 = 1.329 + 0.119 + 0.001 avg prob of [ travesti] 0.28575608134269714
loss 0.197 = 0.052 + 0.144 + 0.001 avg prob of [ travesti] 0.9501248598098755
loss 0.079 = 0.035 + 0.043 + 0.001 avg prob of [ travesti] 0.9662039875984192
loss 0.077 = 0.032 + 0.044 + 0.001 avg prob of [ travesti] 0.9691619873046875
loss 0.048 = 0.006 + 0.042 + 0.001 avg prob of [ travesti] 0.9943663477897644
Delta norm: 13.730446815490723
Change in target norm: 3.4326119422912598 to 14.217615127563477 => 10.785003662109375
Division Factor: 2.8972880840301514
Right vector norm: 4.739068508148193
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:32:45,024 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:32:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.30s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.73s/it]
2024-10-31 05:33:02,819 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:33:02 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.46s/it]100%|██████████| 1/1 [00:27<00:00, 27.46s/it]
2024-10-31 05:33:42,373 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Adonye Banigo is -> metalsmith  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Adonye Banigo is', 'target_new': 'metalsmith', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Adonye Banigo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:33:42 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Adonye Banigo is -> metalsmith  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Adonye Banigo is', 'target_new': 'metalsmith', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Adonye Banigo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Adonye Banigo is] -> [ metalsmith]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Adonye Banigo
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Adonye Banigo is metalsm | Token: igo
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.785 = 4.785 + 0.0 + 0.0 avg prob of [ metalsmith] 0.008877157233655453
loss 3.525 = 3.511 + 0.013 + 0.001 avg prob of [ metalsmith] 0.031217921525239944
loss 2.617 = 2.345 + 0.272 + 0.001 avg prob of [ metalsmith] 0.09850291162729263
loss 2.612 = 2.339 + 0.272 + 0.001 avg prob of [ metalsmith] 0.10403110086917877
loss 2.506 = 2.236 + 0.269 + 0.001 avg prob of [ metalsmith] 0.10903928428888321
loss 1.92 = 1.65 + 0.269 + 0.001 avg prob of [ metalsmith] 0.1949913650751114
loss 1.211 = 1.02 + 0.19 + 0.001 avg prob of [ metalsmith] 0.36853882670402527
loss 0.782 = 0.511 + 0.27 + 0.001 avg prob of [ metalsmith] 0.6038035750389099
loss 0.593 = 0.32 + 0.272 + 0.001 avg prob of [ metalsmith] 0.7357280254364014
loss 0.325 = 0.052 + 0.272 + 0.001 avg prob of [ metalsmith] 0.9500616192817688
loss 0.305 = 0.035 + 0.269 + 0.001 avg prob of [ metalsmith] 0.9659644961357117
loss 0.282 = 0.01 + 0.271 + 0.001 avg prob of [ metalsmith] 0.9896799921989441
loss 0.278 = 0.006 + 0.271 + 0.001 avg prob of [ metalsmith] 0.9942182898521423
loss 0.275 = 0.004 + 0.27 + 0.001 avg prob of [ metalsmith] 0.996116578578949
loss 0.268 = 0.003 + 0.263 + 0.001 avg prob of [ metalsmith] 0.9965153932571411
loss 0.123 = 0.012 + 0.11 + 0.001 avg prob of [ metalsmith] 0.9879793524742126
loss 0.577 = 0.525 + 0.05 + 0.001 avg prob of [ metalsmith] 0.6048842072486877
loss 0.287 = 0.014 + 0.272 + 0.001 avg prob of [ metalsmith] 0.986301064491272
loss 0.297 = 0.023 + 0.272 + 0.001 avg prob of [ metalsmith] 0.9772916436195374
loss 0.281 = 0.008 + 0.272 + 0.001 avg prob of [ metalsmith] 0.9923353791236877
loss 0.279 = 0.006 + 0.272 + 0.001 avg prob of [ metalsmith] 0.9940986037254333
loss 0.277 = 0.004 + 0.272 + 0.001 avg prob of [ metalsmith] 0.9957973957061768
loss 0.276 = 0.003 + 0.272 + 0.001 avg prob of [ metalsmith] 0.9969645142555237
loss 0.275 = 0.002 + 0.271 + 0.001 avg prob of [ metalsmith] 0.9976751208305359
loss 0.274 = 0.002 + 0.271 + 0.001 avg prob of [ metalsmith] 0.9981157183647156
Delta norm: 12.744491577148438
Change in target norm: 3.1861228942871094 to 13.139732360839844 => 9.953609466552734
Division Factor: 2.7520596981048584
Right vector norm: 4.630891799926758
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:33:49,622 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:33:49 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.44s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.82s/it]
2024-10-31 05:34:13,701 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:34:13 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.75s/it]100%|██████████| 1/1 [00:14<00:00, 14.75s/it]
2024-10-31 05:34:41,858 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which Xalet Giner Cortina is associated with is -> Crimea  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Xalet Giner Cortina is associated with is', 'target_new': 'Crimea', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Xalet Giner Cortina'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:34:41 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which Xalet Giner Cortina is associated with is -> Crimea  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Xalet Giner Cortina is associated with is', 'target_new': 'Crimea', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Xalet Giner Cortina'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which Xalet Giner Cortina is associated with is] -> [ Crimea]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Xalet Giner Cortina
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the country which Xalet Giner Cortina is associated with is Crime | Token: ina
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.791 = 6.791 + 0.0 + 0.0 avg prob of [ Crimea] 0.0012997868470847607
loss 6.302 = 6.273 + 0.028 + 0.001 avg prob of [ Crimea] 0.002048282651230693
loss 5.52 = 5.482 + 0.037 + 0.001 avg prob of [ Crimea] 0.0045361751690506935
loss 2.815 = 2.788 + 0.026 + 0.001 avg prob of [ Crimea] 0.06262730062007904
loss 2.188 = 2.119 + 0.068 + 0.001 avg prob of [ Crimea] 0.12103860080242157
loss 1.666 = 1.652 + 0.014 + 0.001 avg prob of [ Crimea] 0.19349820911884308
loss 0.826 = 0.812 + 0.013 + 0.001 avg prob of [ Crimea] 0.45093750953674316
loss 0.11 = 0.022 + 0.087 + 0.001 avg prob of [ Crimea] 0.9783007502555847
loss 0.487 = 0.471 + 0.015 + 0.001 avg prob of [ Crimea] 0.6415408253669739
loss 0.111 = 0.095 + 0.014 + 0.001 avg prob of [ Crimea] 0.9103559851646423
loss 0.02 = 0.009 + 0.01 + 0.001 avg prob of [ Crimea] 0.9908082485198975
Delta norm: 14.0822114944458
Change in target norm: 3.52055287361145 to 14.522493362426758 => 11.001940727233887
Division Factor: 3.034377336502075
Right vector norm: 4.640890121459961
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:34:47,714 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:34:47 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.08s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 10.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 11.25s/it]
2024-10-31 05:35:10,562 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:35:10 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.73it/s]100%|██████████| 1/1 [00:00<00:00,  1.73it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.43s/it]100%|██████████| 1/1 [00:18<00:00, 18.43s/it]
2024-10-31 05:35:40,870 - easyeditor.editors.editor - INFO - 0 editing: 2023 Israel Badminton Championships – women's singles is followed by -> 10th Michigan Legislature  

 {'pre': {'rewrite_acc': [0.14285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2023 Israel Badminton Championships – women's singles is followed by", 'target_new': '10th Michigan Legislature', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2023 Israel Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [0.8571428571428571], 'locality': {}, 'portability': {}}}
10/31/2024 05:35:40 - INFO - easyeditor.editors.editor -   0 editing: 2023 Israel Badminton Championships – women's singles is followed by -> 10th Michigan Legislature  

 {'pre': {'rewrite_acc': [0.14285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2023 Israel Badminton Championships – women's singles is followed by", 'target_new': '10th Michigan Legislature', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2023 Israel Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [0.8571428571428571], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2023 Israel Badminton Championships – women's singles is followed by] -> [ 10th Michigan Legislature]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2023 Israel Badminton Championships – women's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: 2023 Israel Badminton Championships – women's singles is followed by 10th Michigan Legisl | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.138 = 6.138 + 0.0 + 0.0 avg prob of [ 10th Michigan Legislature] 0.0023083495907485485
loss 5.885 = 5.67 + 0.214 + 0.001 avg prob of [ 10th Michigan Legislature] 0.0035804198123514652
loss 4.918 = 4.917 + 0.001 + 0.001 avg prob of [ 10th Michigan Legislature] 0.007588161621242762
loss 3.374 = 3.369 + 0.004 + 0.001 avg prob of [ 10th Michigan Legislature] 0.035456229001283646
loss 3.086 = 3.085 + 0.001 + 0.001 avg prob of [ 10th Michigan Legislature] 0.046746108680963516
loss 1.383 = 1.368 + 0.014 + 0.001 avg prob of [ 10th Michigan Legislature] 0.26025235652923584
loss 0.993 = 0.989 + 0.003 + 0.001 avg prob of [ 10th Michigan Legislature] 0.3737059533596039
loss 0.343 = 0.287 + 0.055 + 0.001 avg prob of [ 10th Michigan Legislature] 0.7547184228897095
loss 1.151 = 1.149 + 0.001 + 0.001 avg prob of [ 10th Michigan Legislature] 0.322412371635437
loss 0.227 = 0.225 + 0.001 + 0.001 avg prob of [ 10th Michigan Legislature] 0.8029611110687256
loss 0.013 = 0.012 + 0.001 + 0.001 avg prob of [ 10th Michigan Legislature] 0.9883174300193787
Delta norm: 17.887367248535156
Change in target norm: 4.471841812133789 to 18.41411590576172 => 13.94227409362793
Division Factor: 3.6781153678894043
Right vector norm: 4.86318826675415
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.14285714285714285}, 'post': {'rewrite_acc': 0.8571428571428571}}
2024-10-31 05:35:50,565 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:35:50 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:25<00:25, 25.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 14.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 16.36s/it]
2024-10-31 05:36:23,627 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:36:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.47s/it]100%|██████████| 1/1 [00:27<00:00, 27.47s/it]
2024-10-31 05:37:02,729 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Amaya Gastaminza is -> mandolinist  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Amaya Gastaminza is', 'target_new': 'mandolinist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Amaya Gastaminza'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:37:02 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Amaya Gastaminza is -> mandolinist  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Amaya Gastaminza is', 'target_new': 'mandolinist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Amaya Gastaminza'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Amaya Gastaminza is] -> [ mandolinist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Amaya Gastaminza
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Amaya Gastaminza is mandolin | Token: za
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.107 = 6.107 + 0.0 + 0.0 avg prob of [ mandolinist] 0.0024427250027656555
loss 3.785 = 3.763 + 0.021 + 0.001 avg prob of [ mandolinist] 0.024157728999853134
loss 1.979 = 1.893 + 0.085 + 0.001 avg prob of [ mandolinist] 0.15636295080184937
loss 1.011 = 0.945 + 0.066 + 0.001 avg prob of [ mandolinist] 0.3915261924266815
loss 0.406 = 0.086 + 0.319 + 0.001 avg prob of [ mandolinist] 0.9229253530502319
loss 0.432 = 0.11 + 0.321 + 0.001 avg prob of [ mandolinist] 0.901091456413269
loss 0.336 = 0.015 + 0.32 + 0.001 avg prob of [ mandolinist] 0.9853116273880005
loss 0.335 = 0.016 + 0.319 + 0.001 avg prob of [ mandolinist] 0.9846656322479248
loss 0.326 = 0.014 + 0.312 + 0.001 avg prob of [ mandolinist] 0.9864778518676758
loss 0.169 = 0.031 + 0.138 + 0.001 avg prob of [ mandolinist] 0.9700868129730225
loss 0.603 = 0.488 + 0.114 + 0.001 avg prob of [ mandolinist] 0.6304349303245544
loss 0.509 = 0.193 + 0.315 + 0.001 avg prob of [ mandolinist] 0.8288795948028564
loss 0.483 = 0.179 + 0.302 + 0.001 avg prob of [ mandolinist] 0.840427041053772
loss 0.356 = 0.149 + 0.206 + 0.001 avg prob of [ mandolinist] 0.8640275001525879
loss 0.368 = 0.053 + 0.314 + 0.001 avg prob of [ mandolinist] 0.9483897686004639
loss 0.307 = 0.008 + 0.299 + 0.001 avg prob of [ mandolinist] 0.9922528266906738
loss 1.206 = 1.019 + 0.187 + 0.001 avg prob of [ mandolinist] 0.36824315786361694
loss 0.728 = 0.41 + 0.317 + 0.001 avg prob of [ mandolinist] 0.6755449175834656
loss 0.403 = 0.082 + 0.319 + 0.001 avg prob of [ mandolinist] 0.9213759899139404
loss 0.376 = 0.057 + 0.317 + 0.001 avg prob of [ mandolinist] 0.9450740218162537
loss 0.338 = 0.023 + 0.314 + 0.001 avg prob of [ mandolinist] 0.9775478839874268
loss 0.305 = 0.01 + 0.294 + 0.001 avg prob of [ mandolinist] 0.9899203777313232
loss 0.233 = 0.1 + 0.132 + 0.001 avg prob of [ mandolinist] 0.9074122905731201
loss 0.341 = 0.019 + 0.321 + 0.001 avg prob of [ mandolinist] 0.9812774658203125
loss 0.352 = 0.032 + 0.319 + 0.001 avg prob of [ mandolinist] 0.9695560932159424
Delta norm: 13.922119140625
Change in target norm: 3.48052978515625 to 14.448204040527344 => 10.967674255371094
Division Factor: 2.8507142066955566
Right vector norm: 4.883730411529541
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:37:09,919 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:37:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:21<00:21, 21.05s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 18.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 18.66s/it]
2024-10-31 05:37:47,817 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:37:47 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.56s/it]100%|██████████| 1/1 [00:30<00:00, 30.56s/it]
2024-10-31 05:38:32,293 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Fréderic Melki is -> spanish legionary  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Fréderic Melki is', 'target_new': 'spanish legionary', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Fréderic Melki'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:38:32 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Fréderic Melki is -> spanish legionary  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Fréderic Melki is', 'target_new': 'spanish legionary', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Fréderic Melki'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Fréderic Melki is] -> [ spanish legionary]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Fréderic Melki
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Fréderic Melki is spanish legion | Token: ki
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.674 = 5.674 + 0.0 + 0.0 avg prob of [ spanish legionary] 0.003487634239718318
loss 5.547 = 5.33 + 0.216 + 0.001 avg prob of [ spanish legionary] 0.00491534685716033
loss 4.824 = 4.733 + 0.09 + 0.001 avg prob of [ spanish legionary] 0.009188409894704819
loss 3.931 = 3.624 + 0.306 + 0.001 avg prob of [ spanish legionary] 0.026988375931978226
loss 3.403 = 3.088 + 0.314 + 0.001 avg prob of [ spanish legionary] 0.0463227853178978
loss 2.541 = 2.231 + 0.309 + 0.001 avg prob of [ spanish legionary] 0.10971672087907791
loss 0.882 = 0.576 + 0.305 + 0.001 avg prob of [ spanish legionary] 0.5707412958145142
loss 1.204 = 1.096 + 0.106 + 0.001 avg prob of [ spanish legionary] 0.3412695527076721
loss 0.916 = 0.603 + 0.312 + 0.001 avg prob of [ spanish legionary] 0.5511186718940735
loss 0.448 = 0.13 + 0.317 + 0.001 avg prob of [ spanish legionary] 0.8849669098854065
loss 0.331 = 0.014 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9863468408584595
loss 0.326 = 0.009 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9914891719818115
loss 0.323 = 0.006 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9940245747566223
loss 0.322 = 0.004 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9956149458885193
loss 0.321 = 0.003 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9965740442276001
loss 0.32 = 0.003 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9971907734870911
loss 0.32 = 0.002 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9976179003715515
loss 0.319 = 0.002 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9979310631752014
loss 0.319 = 0.002 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9981711506843567
loss 0.319 = 0.002 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9983617663383484
loss 0.319 = 0.001 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9985172152519226
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9986456036567688
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.998752236366272
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9988387823104858
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9989042282104492
Delta norm: 13.336480140686035
Change in target norm: 3.334120035171509 to 13.780498504638672 => 10.446378707885742
Division Factor: 2.9431447982788086
Right vector norm: 4.531371116638184
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:38:38,702 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:38:38 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:12<00:12, 12.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  8.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  9.20s/it]
2024-10-31 05:38:57,409 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:38:57 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.55s/it]100%|██████████| 1/1 [00:27<00:00, 27.55s/it]
2024-10-31 05:39:36,412 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Felix Kraehenbuehl is -> short film  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Felix Kraehenbuehl is', 'target_new': 'short film', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Felix Kraehenbuehl'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:39:36 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Felix Kraehenbuehl is -> short film  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Felix Kraehenbuehl is', 'target_new': 'short film', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Felix Kraehenbuehl'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Felix Kraehenbuehl is] -> [ short film]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Felix Kraehenbuehl
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Felix Kraehenbuehl is short | Token: hl
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.032 = 7.032 + 0.0 + 0.0 avg prob of [ short film] 0.000940570083912462
loss 5.698 = 5.688 + 0.009 + 0.001 avg prob of [ short film] 0.003554821014404297
loss 5.014 = 5.007 + 0.005 + 0.001 avg prob of [ short film] 0.006947915535420179
loss 2.798 = 2.768 + 0.029 + 0.001 avg prob of [ short film] 0.06620756536722183
loss 2.261 = 1.935 + 0.325 + 0.001 avg prob of [ short film] 0.15092946588993073
loss 0.698 = 0.385 + 0.312 + 0.001 avg prob of [ short film] 0.6875870227813721
loss 0.347 = 0.028 + 0.318 + 0.001 avg prob of [ short film] 0.9724571704864502
loss 0.309 = 0.015 + 0.292 + 0.001 avg prob of [ short film] 0.984802782535553
loss 0.801 = 0.735 + 0.065 + 0.001 avg prob of [ short film] 0.5034261345863342
loss 0.395 = 0.083 + 0.311 + 0.001 avg prob of [ short film] 0.9217917919158936
loss 0.419 = 0.1 + 0.317 + 0.001 avg prob of [ short film] 0.9073536396026611
loss 0.366 = 0.044 + 0.321 + 0.001 avg prob of [ short film] 0.9574583172798157
loss 0.345 = 0.022 + 0.322 + 0.001 avg prob of [ short film] 0.9783616065979004
loss 0.336 = 0.013 + 0.322 + 0.001 avg prob of [ short film] 0.9867061376571655
loss 0.332 = 0.009 + 0.322 + 0.001 avg prob of [ short film] 0.9910025000572205
loss 0.33 = 0.007 + 0.322 + 0.001 avg prob of [ short film] 0.9934125542640686
loss 0.328 = 0.005 + 0.322 + 0.001 avg prob of [ short film] 0.9947478175163269
loss 0.327 = 0.005 + 0.321 + 0.001 avg prob of [ short film] 0.9954841732978821
loss 0.325 = 0.004 + 0.32 + 0.001 avg prob of [ short film] 0.9958493709564209
loss 0.323 = 0.004 + 0.318 + 0.001 avg prob of [ short film] 0.9958866834640503
loss 0.318 = 0.005 + 0.312 + 0.001 avg prob of [ short film] 0.9953582882881165
loss 0.299 = 0.008 + 0.29 + 0.001 avg prob of [ short film] 0.9925219416618347
loss 0.247 = 0.083 + 0.163 + 0.001 avg prob of [ short film] 0.9216228723526001
loss 0.314 = 0.094 + 0.219 + 0.001 avg prob of [ short film] 0.9114717245101929
loss 0.234 = 0.094 + 0.139 + 0.001 avg prob of [ short film] 0.913974940776825
Delta norm: 13.778919219970703
Change in target norm: 3.4447295665740967 to 14.141728401184082 => 10.696998596191406
Division Factor: 2.9140501022338867
Right vector norm: 4.728443145751953
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:39:42,829 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:39:42 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.87s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.82s/it]
2024-10-31 05:40:00,782 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:40:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:36<00:00, 36.38s/it]100%|██████████| 1/1 [00:36<00:00, 36.38s/it]
2024-10-31 05:40:48,225 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Robert J. Burch is -> Tuʻi Tonga Empire  

 {'pre': {'rewrite_acc': [0.42857142857142855], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Robert J. Burch is', 'target_new': 'Tuʻi Tonga Empire', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Robert J. Burch'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:40:48 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Robert J. Burch is -> Tuʻi Tonga Empire  

 {'pre': {'rewrite_acc': [0.42857142857142855], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Robert J. Burch is', 'target_new': 'Tuʻi Tonga Empire', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Robert J. Burch'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Robert J. Burch is] -> [ Tuʻi Tonga Empire]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Robert J. Burch
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country of citizenship of Robert J. Burch is Tuʻi Tonga | Token: urch
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.494 = 5.494 + 0.0 + 0.0 avg prob of [ Tuʻi Tonga Empire] 0.004204609431326389
loss 4.556 = 4.471 + 0.084 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.011576461605727673
loss 3.056 = 2.92 + 0.134 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.05428266525268555
loss 2.213 = 2.121 + 0.091 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.12045864760875702
loss 0.802 = 0.664 + 0.137 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.5168812870979309
loss 0.923 = 0.861 + 0.061 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.4276675283908844
loss 0.732 = 0.629 + 0.102 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.5372827649116516
loss 0.294 = 0.217 + 0.076 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.8069652318954468
loss 0.12 = 0.024 + 0.095 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9765947461128235
loss 0.099 = 0.016 + 0.082 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9844508767127991
loss 0.072 = 0.01 + 0.061 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9897401332855225
loss 0.092 = 0.006 + 0.084 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9936525225639343
loss 0.073 = 0.005 + 0.067 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.995241105556488
loss 0.064 = 0.004 + 0.059 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9958164691925049
loss 0.066 = 0.004 + 0.061 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9962791204452515
loss 0.059 = 0.003 + 0.055 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9969282746315002
loss 0.059 = 0.003 + 0.055 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9973940253257751
loss 0.057 = 0.002 + 0.053 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9976409077644348
loss 0.058 = 0.002 + 0.054 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9979455471038818
loss 0.056 = 0.002 + 0.053 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9982606768608093
loss 0.056 = 0.002 + 0.053 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9984941482543945
loss 0.056 = 0.001 + 0.053 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9986398220062256
loss 0.055 = 0.001 + 0.053 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.998761773109436
loss 0.055 = 0.001 + 0.053 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9988735914230347
loss 0.055 = 0.001 + 0.052 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.998964250087738
Delta norm: 12.862115859985352
Change in target norm: 3.215528964996338 to 13.275713920593262 => 10.060184478759766
Division Factor: 2.729504346847534
Right vector norm: 4.712253093719482
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.42857142857142855}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:41:07,693 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:41:07 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.03s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 10.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 11.35s/it]
2024-10-31 05:41:30,832 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:41:30 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.69s/it]100%|██████████| 1/1 [00:27<00:00, 27.69s/it]
2024-10-31 05:42:10,239 - easyeditor.editors.editor - INFO - 0 editing: August Friedrich, Prinz von Braunschweig is followed by -> 1984 Japan Open Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.4375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'August Friedrich, Prinz von Braunschweig is followed by', 'target_new': "1984 Japan Open Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'August Friedrich, Prinz von Braunschweig'}, 'post': {'rewrite_acc': [0.9375], 'locality': {}, 'portability': {}}}
10/31/2024 05:42:10 - INFO - easyeditor.editors.editor -   0 editing: August Friedrich, Prinz von Braunschweig is followed by -> 1984 Japan Open Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.4375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'August Friedrich, Prinz von Braunschweig is followed by', 'target_new': "1984 Japan Open Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'August Friedrich, Prinz von Braunschweig'}, 'post': {'rewrite_acc': [0.9375], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [August Friedrich, Prinz von Braunschweig is followed by] -> [ 1984 Japan Open Badminton Championships – men's doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object August Friedrich, Prinz von Braunschweig
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: August Friedrich, Prinz von Braunschweig is followed by 1984 Japan Open Badminton Championships – men's | Token: weig
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.835 = 3.835 + 0.0 + 0.0 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.022222112864255905
loss 3.699 = 3.39 + 0.308 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.0339042991399765
loss 2.854 = 2.849 + 0.005 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.05823687091469765
loss 2.537 = 2.536 + 0.0 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.08126261085271835
loss 2.651 = 2.649 + 0.0 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.07124350219964981
loss 1.674 = 1.673 + 0.0 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.18893519043922424
loss 1.351 = 1.35 + 0.001 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.2616131603717804
loss 0.74 = 0.739 + 0.0 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.4793841242790222
loss 0.625 = 0.623 + 0.001 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.5378707647323608
loss 1.227 = 1.226 + 0.0 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.29495832324028015
loss 1.291 = 0.879 + 0.41 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.4160023629665375
loss 0.619 = 0.302 + 0.316 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.7398896217346191
loss 0.469 = 0.201 + 0.267 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.8179200887680054
loss 0.273 = 0.271 + 0.001 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.7633916139602661
loss 0.182 = 0.18 + 0.001 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.8353506922721863
loss 0.038 = 0.037 + 0.001 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.9638418555259705
Delta norm: 17.157127380371094
Change in target norm: 4.289281845092773 to 17.61665916442871 => 13.327377319335938
Division Factor: 3.634164810180664
Right vector norm: 4.721065044403076
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4375}, 'post': {'rewrite_acc': 0.9375}}
2024-10-31 05:42:18,617 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:42:18 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.74s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.33s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.99s/it]
2024-10-31 05:42:43,255 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:42:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.64s/it]100%|██████████| 1/1 [00:11<00:00, 11.64s/it]
2024-10-31 05:43:07,309 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Don Diamond is -> master electrician  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Don Diamond is', 'target_new': 'master electrician', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Don Diamond'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:43:07 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Don Diamond is -> master electrician  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Don Diamond is', 'target_new': 'master electrician', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Don Diamond'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Don Diamond is] -> [ master electrician]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Don Diamond
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Don Diamond is master electric | Token: ond
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.713 = 5.713 + 0.0 + 0.0 avg prob of [ master electrician] 0.0036367177963256836
loss 4.078 = 4.032 + 0.044 + 0.001 avg prob of [ master electrician] 0.019561272114515305
loss 2.16 = 1.997 + 0.162 + 0.001 avg prob of [ master electrician] 0.14228315651416779
loss 1.053 = 0.991 + 0.061 + 0.001 avg prob of [ master electrician] 0.38006532192230225
loss 0.445 = 0.378 + 0.066 + 0.001 avg prob of [ master electrician] 0.6955854296684265
loss 0.287 = 0.062 + 0.224 + 0.001 avg prob of [ master electrician] 0.940497636795044
loss 0.093 = 0.033 + 0.059 + 0.001 avg prob of [ master electrician] 0.9671275019645691
loss 0.081 = 0.029 + 0.051 + 0.001 avg prob of [ master electrician] 0.9715946912765503
loss 0.067 = 0.019 + 0.046 + 0.001 avg prob of [ master electrician] 0.9807509779930115
loss 0.055 = 0.012 + 0.042 + 0.001 avg prob of [ master electrician] 0.9880591034889221
loss 0.049 = 0.008 + 0.04 + 0.001 avg prob of [ master electrician] 0.9917808175086975
Delta norm: 13.814516067504883
Change in target norm: 3.4536290168762207 to 14.145796775817871 => 10.692167282104492
Division Factor: 2.857012987136841
Right vector norm: 4.835300445556641
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:43:13,079 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:43:13 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.87s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:36<00:00, 18.34s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:36<00:00, 18.27s/it]
2024-10-31 05:43:50,006 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:43:50 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.25s/it]100%|██████████| 1/1 [00:25<00:00, 25.26s/it]
2024-10-31 05:44:28,476 - easyeditor.editors.editor - INFO - 0 editing: The gender of unknown Steel is -> muxe  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of unknown Steel is', 'target_new': 'muxe', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'unknown Steel'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:44:28 - INFO - easyeditor.editors.editor -   0 editing: The gender of unknown Steel is -> muxe  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of unknown Steel is', 'target_new': 'muxe', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'unknown Steel'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of unknown Steel is] -> [ muxe]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object unknown Steel
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of unknown Steel is mux | Token: el
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.714 = 6.714 + 0.0 + 0.0 avg prob of [ muxe] 0.0012583282077684999
loss 5.114 = 4.993 + 0.12 + 0.001 avg prob of [ muxe] 0.007187557406723499
loss 2.629 = 2.492 + 0.137 + 0.001 avg prob of [ muxe] 0.0866495817899704
loss 1.528 = 1.319 + 0.208 + 0.001 avg prob of [ muxe] 0.3060210943222046
loss 0.599 = 0.337 + 0.261 + 0.001 avg prob of [ muxe] 0.724153995513916
loss 0.372 = 0.112 + 0.259 + 0.001 avg prob of [ muxe] 0.8953210115432739
loss 0.291 = 0.023 + 0.266 + 0.001 avg prob of [ muxe] 0.9768524169921875
loss 0.279 = 0.009 + 0.269 + 0.001 avg prob of [ muxe] 0.9906947016716003
loss 0.276 = 0.005 + 0.269 + 0.001 avg prob of [ muxe] 0.9949097633361816
loss 0.274 = 0.004 + 0.269 + 0.001 avg prob of [ muxe] 0.9965015649795532
loss 0.272 = 0.003 + 0.268 + 0.001 avg prob of [ muxe] 0.9970889687538147
loss 0.27 = 0.003 + 0.266 + 0.001 avg prob of [ muxe] 0.9970601797103882
loss 0.267 = 0.004 + 0.262 + 0.001 avg prob of [ muxe] 0.9963064789772034
loss 0.259 = 0.006 + 0.252 + 0.001 avg prob of [ muxe] 0.9944402575492859
loss 0.237 = 0.01 + 0.226 + 0.001 avg prob of [ muxe] 0.9900089502334595
loss 0.2 = 0.034 + 0.165 + 0.001 avg prob of [ muxe] 0.9664155840873718
loss 0.155 = 0.009 + 0.145 + 0.001 avg prob of [ muxe] 0.9910251498222351
loss 0.123 = 0.003 + 0.119 + 0.001 avg prob of [ muxe] 0.9968686699867249
loss 0.106 = 0.003 + 0.102 + 0.001 avg prob of [ muxe] 0.9971179962158203
loss 0.1 = 0.004 + 0.095 + 0.001 avg prob of [ muxe] 0.9962476491928101
loss 0.097 = 0.004 + 0.092 + 0.001 avg prob of [ muxe] 0.9960674047470093
loss 0.093 = 0.003 + 0.088 + 0.001 avg prob of [ muxe] 0.9968996047973633
loss 0.089 = 0.002 + 0.086 + 0.001 avg prob of [ muxe] 0.9976738691329956
loss 0.086 = 0.002 + 0.084 + 0.001 avg prob of [ muxe] 0.9983324408531189
loss 0.084 = 0.001 + 0.082 + 0.001 avg prob of [ muxe] 0.9988837838172913
Delta norm: 14.607915878295898
Change in target norm: 3.6519789695739746 to 15.01802921295166 => 11.366050720214844
Division Factor: 3.0116806030273438
Right vector norm: 4.850419998168945
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:44:34,963 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:44:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.67s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.71s/it]
2024-10-31 05:44:52,765 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:44:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.68s/it]100%|██████████| 1/1 [00:13<00:00, 13.68s/it]
2024-10-31 05:45:18,263 - easyeditor.editors.editor - INFO - 0 editing: The gender of Alexander G Kolesnikov is -> travesti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Alexander G Kolesnikov is', 'target_new': 'travesti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alexander G Kolesnikov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:45:18 - INFO - easyeditor.editors.editor -   0 editing: The gender of Alexander G Kolesnikov is -> travesti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Alexander G Kolesnikov is', 'target_new': 'travesti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alexander G Kolesnikov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Alexander G Kolesnikov is] -> [ travesti]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Alexander G Kolesnikov
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Alexander G Kolesnikov is trav | Token: ov
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.768 = 9.768 + 0.0 + 0.0 avg prob of [ travesti] 6.696411583106965e-05
loss 7.566 = 7.453 + 0.113 + 0.001 avg prob of [ travesti] 0.0006109308451414108
loss 5.373 = 5.154 + 0.218 + 0.001 avg prob of [ travesti] 0.006200694944709539
loss 3.255 = 3.153 + 0.1 + 0.001 avg prob of [ travesti] 0.04518778622150421
loss 1.732 = 1.429 + 0.301 + 0.001 avg prob of [ travesti] 0.2511793375015259
loss 0.22 = 0.042 + 0.178 + 0.001 avg prob of [ travesti] 0.9606317281723022
loss 2.393 = 2.327 + 0.065 + 0.001 avg prob of [ travesti] 0.10706067085266113
loss 1.449 = 1.329 + 0.119 + 0.001 avg prob of [ travesti] 0.28575608134269714
loss 0.197 = 0.052 + 0.144 + 0.001 avg prob of [ travesti] 0.9501248598098755
loss 0.079 = 0.035 + 0.043 + 0.001 avg prob of [ travesti] 0.9662039875984192
loss 0.077 = 0.032 + 0.044 + 0.001 avg prob of [ travesti] 0.9691619873046875
loss 0.048 = 0.006 + 0.042 + 0.001 avg prob of [ travesti] 0.9943663477897644
Delta norm: 13.730446815490723
Change in target norm: 3.4326119422912598 to 14.217615127563477 => 10.785003662109375
Division Factor: 2.8972880840301514
Right vector norm: 4.739068508148193
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:45:36,313 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:45:36 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:41<00:41, 41.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:50<00:00, 22.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:50<00:00, 25.41s/it]
2024-10-31 05:46:27,528 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:46:27 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.52s/it]100%|██████████| 1/1 [00:27<00:00, 27.52s/it]
2024-10-31 05:47:07,964 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Adonye Banigo is -> metalsmith  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Adonye Banigo is', 'target_new': 'metalsmith', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Adonye Banigo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:47:07 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Adonye Banigo is -> metalsmith  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Adonye Banigo is', 'target_new': 'metalsmith', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Adonye Banigo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Adonye Banigo is] -> [ metalsmith]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Adonye Banigo
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Adonye Banigo is metalsm | Token: igo
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.785 = 4.785 + 0.0 + 0.0 avg prob of [ metalsmith] 0.008877157233655453
loss 3.525 = 3.511 + 0.013 + 0.001 avg prob of [ metalsmith] 0.031217921525239944
loss 2.617 = 2.345 + 0.272 + 0.001 avg prob of [ metalsmith] 0.09850291162729263
loss 2.612 = 2.339 + 0.272 + 0.001 avg prob of [ metalsmith] 0.10403110086917877
loss 2.506 = 2.236 + 0.269 + 0.001 avg prob of [ metalsmith] 0.10903928428888321
loss 1.92 = 1.65 + 0.269 + 0.001 avg prob of [ metalsmith] 0.1949913650751114
loss 1.211 = 1.02 + 0.19 + 0.001 avg prob of [ metalsmith] 0.36853882670402527
loss 0.782 = 0.511 + 0.27 + 0.001 avg prob of [ metalsmith] 0.6038035750389099
loss 0.593 = 0.32 + 0.272 + 0.001 avg prob of [ metalsmith] 0.7357280254364014
loss 0.325 = 0.052 + 0.272 + 0.001 avg prob of [ metalsmith] 0.9500616192817688
loss 0.305 = 0.035 + 0.269 + 0.001 avg prob of [ metalsmith] 0.9659644961357117
loss 0.282 = 0.01 + 0.271 + 0.001 avg prob of [ metalsmith] 0.9896799921989441
loss 0.278 = 0.006 + 0.271 + 0.001 avg prob of [ metalsmith] 0.9942182898521423
loss 0.275 = 0.004 + 0.27 + 0.001 avg prob of [ metalsmith] 0.996116578578949
loss 0.268 = 0.003 + 0.263 + 0.001 avg prob of [ metalsmith] 0.9965153932571411
loss 0.123 = 0.012 + 0.11 + 0.001 avg prob of [ metalsmith] 0.9879793524742126
loss 0.577 = 0.525 + 0.05 + 0.001 avg prob of [ metalsmith] 0.6048842072486877
loss 0.287 = 0.014 + 0.272 + 0.001 avg prob of [ metalsmith] 0.986301064491272
loss 0.297 = 0.023 + 0.272 + 0.001 avg prob of [ metalsmith] 0.9772916436195374
loss 0.281 = 0.008 + 0.272 + 0.001 avg prob of [ metalsmith] 0.9923353791236877
loss 0.279 = 0.006 + 0.272 + 0.001 avg prob of [ metalsmith] 0.9940986037254333
loss 0.277 = 0.004 + 0.272 + 0.001 avg prob of [ metalsmith] 0.9957973957061768
loss 0.276 = 0.003 + 0.272 + 0.001 avg prob of [ metalsmith] 0.9969645142555237
loss 0.275 = 0.002 + 0.271 + 0.001 avg prob of [ metalsmith] 0.9976751208305359
loss 0.274 = 0.002 + 0.271 + 0.001 avg prob of [ metalsmith] 0.9981157183647156
Delta norm: 12.744491577148438
Change in target norm: 3.1861228942871094 to 13.139732360839844 => 9.953609466552734
Division Factor: 2.7520596981048584
Right vector norm: 4.630891799926758
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:47:14,961 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:47:14 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.99s/it]
2024-10-31 05:47:33,286 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:47:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.62s/it]100%|██████████| 1/1 [00:14<00:00, 14.62s/it]
2024-10-31 05:48:00,002 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which Xalet Giner Cortina is associated with is -> Crimea  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Xalet Giner Cortina is associated with is', 'target_new': 'Crimea', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Xalet Giner Cortina'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:48:00 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which Xalet Giner Cortina is associated with is -> Crimea  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Xalet Giner Cortina is associated with is', 'target_new': 'Crimea', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Xalet Giner Cortina'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which Xalet Giner Cortina is associated with is] -> [ Crimea]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Xalet Giner Cortina
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the country which Xalet Giner Cortina is associated with is Crime | Token: ina
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.791 = 6.791 + 0.0 + 0.0 avg prob of [ Crimea] 0.0012997868470847607
loss 6.302 = 6.273 + 0.028 + 0.001 avg prob of [ Crimea] 0.002048282651230693
loss 5.52 = 5.482 + 0.037 + 0.001 avg prob of [ Crimea] 0.0045361751690506935
loss 2.815 = 2.788 + 0.026 + 0.001 avg prob of [ Crimea] 0.06262730062007904
loss 2.188 = 2.119 + 0.068 + 0.001 avg prob of [ Crimea] 0.12103860080242157
loss 1.666 = 1.652 + 0.014 + 0.001 avg prob of [ Crimea] 0.19349820911884308
loss 0.826 = 0.812 + 0.013 + 0.001 avg prob of [ Crimea] 0.45093750953674316
loss 0.11 = 0.022 + 0.087 + 0.001 avg prob of [ Crimea] 0.9783007502555847
loss 0.487 = 0.471 + 0.015 + 0.001 avg prob of [ Crimea] 0.6415408253669739
loss 0.111 = 0.095 + 0.014 + 0.001 avg prob of [ Crimea] 0.9103559851646423
loss 0.02 = 0.009 + 0.01 + 0.001 avg prob of [ Crimea] 0.9908082485198975
Delta norm: 14.0822114944458
Change in target norm: 3.52055287361145 to 14.522493362426758 => 11.001940727233887
Division Factor: 3.034377336502075
Right vector norm: 4.640890121459961
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:48:06,444 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:48:06 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.27s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.71s/it]
2024-10-31 05:48:24,131 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:48:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.38s/it]100%|██████████| 1/1 [00:18<00:00, 18.38s/it]
2024-10-31 05:48:53,964 - easyeditor.editors.editor - INFO - 0 editing: 2023 Israel Badminton Championships – women's singles is followed by -> 10th Michigan Legislature  

 {'pre': {'rewrite_acc': [0.14285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2023 Israel Badminton Championships – women's singles is followed by", 'target_new': '10th Michigan Legislature', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2023 Israel Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [0.8571428571428571], 'locality': {}, 'portability': {}}}
10/31/2024 05:48:53 - INFO - easyeditor.editors.editor -   0 editing: 2023 Israel Badminton Championships – women's singles is followed by -> 10th Michigan Legislature  

 {'pre': {'rewrite_acc': [0.14285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2023 Israel Badminton Championships – women's singles is followed by", 'target_new': '10th Michigan Legislature', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2023 Israel Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [0.8571428571428571], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2023 Israel Badminton Championships – women's singles is followed by] -> [ 10th Michigan Legislature]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2023 Israel Badminton Championships – women's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: 2023 Israel Badminton Championships – women's singles is followed by 10th Michigan Legisl | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.138 = 6.138 + 0.0 + 0.0 avg prob of [ 10th Michigan Legislature] 0.0023083495907485485
loss 5.885 = 5.67 + 0.214 + 0.001 avg prob of [ 10th Michigan Legislature] 0.0035804198123514652
loss 4.918 = 4.917 + 0.001 + 0.001 avg prob of [ 10th Michigan Legislature] 0.007588161621242762
loss 3.374 = 3.369 + 0.004 + 0.001 avg prob of [ 10th Michigan Legislature] 0.035456229001283646
loss 3.086 = 3.085 + 0.001 + 0.001 avg prob of [ 10th Michigan Legislature] 0.046746108680963516
loss 1.383 = 1.368 + 0.014 + 0.001 avg prob of [ 10th Michigan Legislature] 0.26025235652923584
loss 0.993 = 0.989 + 0.003 + 0.001 avg prob of [ 10th Michigan Legislature] 0.3737059533596039
loss 0.343 = 0.287 + 0.055 + 0.001 avg prob of [ 10th Michigan Legislature] 0.7547184228897095
loss 1.151 = 1.149 + 0.001 + 0.001 avg prob of [ 10th Michigan Legislature] 0.322412371635437
loss 0.227 = 0.225 + 0.001 + 0.001 avg prob of [ 10th Michigan Legislature] 0.8029611110687256
loss 0.013 = 0.012 + 0.001 + 0.001 avg prob of [ 10th Michigan Legislature] 0.9883174300193787
Delta norm: 17.887367248535156
Change in target norm: 4.471841812133789 to 18.41411590576172 => 13.94227409362793
Division Factor: 3.6781153678894043
Right vector norm: 4.86318826675415
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.14285714285714285}, 'post': {'rewrite_acc': 0.8571428571428571}}
2024-10-31 05:49:00,331 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:49:00 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.15s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.65s/it]
2024-10-31 05:49:17,941 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:49:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.39s/it]100%|██████████| 1/1 [00:27<00:00, 27.39s/it]
2024-10-31 05:49:56,864 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Amaya Gastaminza is -> mandolinist  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Amaya Gastaminza is', 'target_new': 'mandolinist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Amaya Gastaminza'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:49:56 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Amaya Gastaminza is -> mandolinist  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Amaya Gastaminza is', 'target_new': 'mandolinist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Amaya Gastaminza'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Amaya Gastaminza is] -> [ mandolinist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Amaya Gastaminza
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Amaya Gastaminza is mandolin | Token: za
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.107 = 6.107 + 0.0 + 0.0 avg prob of [ mandolinist] 0.0024427250027656555
loss 3.785 = 3.763 + 0.021 + 0.001 avg prob of [ mandolinist] 0.024157728999853134
loss 1.979 = 1.893 + 0.085 + 0.001 avg prob of [ mandolinist] 0.15636295080184937
loss 1.011 = 0.945 + 0.066 + 0.001 avg prob of [ mandolinist] 0.3915261924266815
loss 0.406 = 0.086 + 0.319 + 0.001 avg prob of [ mandolinist] 0.9229253530502319
loss 0.432 = 0.11 + 0.321 + 0.001 avg prob of [ mandolinist] 0.901091456413269
loss 0.336 = 0.015 + 0.32 + 0.001 avg prob of [ mandolinist] 0.9853116273880005
loss 0.335 = 0.016 + 0.319 + 0.001 avg prob of [ mandolinist] 0.9846656322479248
loss 0.326 = 0.014 + 0.312 + 0.001 avg prob of [ mandolinist] 0.9864778518676758
loss 0.169 = 0.031 + 0.138 + 0.001 avg prob of [ mandolinist] 0.9700868129730225
loss 0.603 = 0.488 + 0.114 + 0.001 avg prob of [ mandolinist] 0.6304349303245544
loss 0.509 = 0.193 + 0.315 + 0.001 avg prob of [ mandolinist] 0.8288795948028564
loss 0.483 = 0.179 + 0.302 + 0.001 avg prob of [ mandolinist] 0.840427041053772
loss 0.356 = 0.149 + 0.206 + 0.001 avg prob of [ mandolinist] 0.8640275001525879
loss 0.368 = 0.053 + 0.314 + 0.001 avg prob of [ mandolinist] 0.9483897686004639
loss 0.307 = 0.008 + 0.299 + 0.001 avg prob of [ mandolinist] 0.9922528266906738
loss 1.206 = 1.019 + 0.187 + 0.001 avg prob of [ mandolinist] 0.36824315786361694
loss 0.728 = 0.41 + 0.317 + 0.001 avg prob of [ mandolinist] 0.6755449175834656
loss 0.403 = 0.082 + 0.319 + 0.001 avg prob of [ mandolinist] 0.9213759899139404
loss 0.376 = 0.057 + 0.317 + 0.001 avg prob of [ mandolinist] 0.9450740218162537
loss 0.338 = 0.023 + 0.314 + 0.001 avg prob of [ mandolinist] 0.9775478839874268
loss 0.305 = 0.01 + 0.294 + 0.001 avg prob of [ mandolinist] 0.9899203777313232
loss 0.233 = 0.1 + 0.132 + 0.001 avg prob of [ mandolinist] 0.9074122905731201
loss 0.341 = 0.019 + 0.321 + 0.001 avg prob of [ mandolinist] 0.9812774658203125
loss 0.352 = 0.032 + 0.319 + 0.001 avg prob of [ mandolinist] 0.9695560932159424
Delta norm: 13.922119140625
Change in target norm: 3.48052978515625 to 14.448204040527344 => 10.967674255371094
Division Factor: 2.8507142066955566
Right vector norm: 4.883730411529541
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:50:07,237 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:50:07 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:24<00:24, 24.82s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 16.15s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 17.45s/it]
2024-10-31 05:50:42,594 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:50:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.56it/s]100%|██████████| 1/1 [00:00<00:00,  1.56it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.54s/it]100%|██████████| 1/1 [00:31<00:00, 31.54s/it]
2024-10-31 05:51:27,866 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Fréderic Melki is -> spanish legionary  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Fréderic Melki is', 'target_new': 'spanish legionary', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Fréderic Melki'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:51:27 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Fréderic Melki is -> spanish legionary  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Fréderic Melki is', 'target_new': 'spanish legionary', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Fréderic Melki'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Fréderic Melki is] -> [ spanish legionary]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Fréderic Melki
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Fréderic Melki is spanish legion | Token: ki
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.674 = 5.674 + 0.0 + 0.0 avg prob of [ spanish legionary] 0.003487634239718318
loss 5.547 = 5.33 + 0.216 + 0.001 avg prob of [ spanish legionary] 0.00491534685716033
loss 4.824 = 4.733 + 0.09 + 0.001 avg prob of [ spanish legionary] 0.009188409894704819
loss 3.931 = 3.624 + 0.306 + 0.001 avg prob of [ spanish legionary] 0.026988375931978226
loss 3.403 = 3.088 + 0.314 + 0.001 avg prob of [ spanish legionary] 0.0463227853178978
loss 2.541 = 2.231 + 0.309 + 0.001 avg prob of [ spanish legionary] 0.10971672087907791
loss 0.882 = 0.576 + 0.305 + 0.001 avg prob of [ spanish legionary] 0.5707412958145142
loss 1.204 = 1.096 + 0.106 + 0.001 avg prob of [ spanish legionary] 0.3412695527076721
loss 0.916 = 0.603 + 0.312 + 0.001 avg prob of [ spanish legionary] 0.5511186718940735
loss 0.448 = 0.13 + 0.317 + 0.001 avg prob of [ spanish legionary] 0.8849669098854065
loss 0.331 = 0.014 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9863468408584595
loss 0.326 = 0.009 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9914891719818115
loss 0.323 = 0.006 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9940245747566223
loss 0.322 = 0.004 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9956149458885193
loss 0.321 = 0.003 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9965740442276001
loss 0.32 = 0.003 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9971907734870911
loss 0.32 = 0.002 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9976179003715515
loss 0.319 = 0.002 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9979310631752014
loss 0.319 = 0.002 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9981711506843567
loss 0.319 = 0.002 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9983617663383484
loss 0.319 = 0.001 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9985172152519226
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9986456036567688
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.998752236366272
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9988387823104858
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ spanish legionary] 0.9989042282104492
Delta norm: 13.336480140686035
Change in target norm: 3.334120035171509 to 13.780498504638672 => 10.446378707885742
Division Factor: 2.9431447982788086
Right vector norm: 4.531371116638184
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:51:35,412 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:51:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:24<00:24, 24.14s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 14.87s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 16.26s/it]
2024-10-31 05:52:08,405 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:52:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.49s/it]100%|██████████| 1/1 [00:27<00:00, 27.49s/it]
2024-10-31 05:52:49,156 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Felix Kraehenbuehl is -> short film  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Felix Kraehenbuehl is', 'target_new': 'short film', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Felix Kraehenbuehl'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:52:49 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Felix Kraehenbuehl is -> short film  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Felix Kraehenbuehl is', 'target_new': 'short film', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Felix Kraehenbuehl'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Felix Kraehenbuehl is] -> [ short film]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Felix Kraehenbuehl
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Felix Kraehenbuehl is short | Token: hl
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.032 = 7.032 + 0.0 + 0.0 avg prob of [ short film] 0.000940570083912462
loss 5.698 = 5.688 + 0.009 + 0.001 avg prob of [ short film] 0.003554821014404297
loss 5.014 = 5.007 + 0.005 + 0.001 avg prob of [ short film] 0.006947915535420179
loss 2.798 = 2.768 + 0.029 + 0.001 avg prob of [ short film] 0.06620756536722183
loss 2.261 = 1.935 + 0.325 + 0.001 avg prob of [ short film] 0.15092946588993073
loss 0.698 = 0.385 + 0.312 + 0.001 avg prob of [ short film] 0.6875870227813721
loss 0.347 = 0.028 + 0.318 + 0.001 avg prob of [ short film] 0.9724571704864502
loss 0.309 = 0.015 + 0.292 + 0.001 avg prob of [ short film] 0.984802782535553
loss 0.801 = 0.735 + 0.065 + 0.001 avg prob of [ short film] 0.5034261345863342
loss 0.395 = 0.083 + 0.311 + 0.001 avg prob of [ short film] 0.9217917919158936
loss 0.419 = 0.1 + 0.317 + 0.001 avg prob of [ short film] 0.9073536396026611
loss 0.366 = 0.044 + 0.321 + 0.001 avg prob of [ short film] 0.9574583172798157
loss 0.345 = 0.022 + 0.322 + 0.001 avg prob of [ short film] 0.9783616065979004
loss 0.336 = 0.013 + 0.322 + 0.001 avg prob of [ short film] 0.9867061376571655
loss 0.332 = 0.009 + 0.322 + 0.001 avg prob of [ short film] 0.9910025000572205
loss 0.33 = 0.007 + 0.322 + 0.001 avg prob of [ short film] 0.9934125542640686
loss 0.328 = 0.005 + 0.322 + 0.001 avg prob of [ short film] 0.9947478175163269
loss 0.327 = 0.005 + 0.321 + 0.001 avg prob of [ short film] 0.9954841732978821
loss 0.325 = 0.004 + 0.32 + 0.001 avg prob of [ short film] 0.9958493709564209
loss 0.323 = 0.004 + 0.318 + 0.001 avg prob of [ short film] 0.9958866834640503
loss 0.318 = 0.005 + 0.312 + 0.001 avg prob of [ short film] 0.9953582882881165
loss 0.299 = 0.008 + 0.29 + 0.001 avg prob of [ short film] 0.9925219416618347
loss 0.247 = 0.083 + 0.163 + 0.001 avg prob of [ short film] 0.9216228723526001
loss 0.314 = 0.094 + 0.219 + 0.001 avg prob of [ short film] 0.9114717245101929
loss 0.234 = 0.094 + 0.139 + 0.001 avg prob of [ short film] 0.913974940776825
Delta norm: 13.778919219970703
Change in target norm: 3.4447295665740967 to 14.141728401184082 => 10.696998596191406
Division Factor: 2.9140501022338867
Right vector norm: 4.728443145751953
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:52:56,683 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:52:56 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.31s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.97s/it]
2024-10-31 05:53:21,099 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:53:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:36<00:00, 36.43s/it]100%|██████████| 1/1 [00:36<00:00, 36.43s/it]
2024-10-31 05:54:09,102 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Robert J. Burch is -> Tuʻi Tonga Empire  

 {'pre': {'rewrite_acc': [0.42857142857142855], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Robert J. Burch is', 'target_new': 'Tuʻi Tonga Empire', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Robert J. Burch'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:54:09 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Robert J. Burch is -> Tuʻi Tonga Empire  

 {'pre': {'rewrite_acc': [0.42857142857142855], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Robert J. Burch is', 'target_new': 'Tuʻi Tonga Empire', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Robert J. Burch'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Robert J. Burch is] -> [ Tuʻi Tonga Empire]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Robert J. Burch
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country of citizenship of Robert J. Burch is Tuʻi Tonga | Token: urch
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.494 = 5.494 + 0.0 + 0.0 avg prob of [ Tuʻi Tonga Empire] 0.004204609431326389
loss 4.556 = 4.471 + 0.084 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.011576461605727673
loss 3.056 = 2.92 + 0.134 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.05428266525268555
loss 2.213 = 2.121 + 0.091 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.12045864760875702
loss 0.802 = 0.664 + 0.137 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.5168812870979309
loss 0.923 = 0.861 + 0.061 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.4276675283908844
loss 0.732 = 0.629 + 0.102 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.5372827649116516
loss 0.294 = 0.217 + 0.076 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.8069652318954468
loss 0.12 = 0.024 + 0.095 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9765947461128235
loss 0.099 = 0.016 + 0.082 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9844508767127991
loss 0.072 = 0.01 + 0.061 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9897401332855225
loss 0.092 = 0.006 + 0.084 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9936525225639343
loss 0.073 = 0.005 + 0.067 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.995241105556488
loss 0.064 = 0.004 + 0.059 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9958164691925049
loss 0.066 = 0.004 + 0.061 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9962791204452515
loss 0.059 = 0.003 + 0.055 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9969282746315002
loss 0.059 = 0.003 + 0.055 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9973940253257751
loss 0.057 = 0.002 + 0.053 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9976409077644348
loss 0.058 = 0.002 + 0.054 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9979455471038818
loss 0.056 = 0.002 + 0.053 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9982606768608093
loss 0.056 = 0.002 + 0.053 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9984941482543945
loss 0.056 = 0.001 + 0.053 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9986398220062256
loss 0.055 = 0.001 + 0.053 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.998761773109436
loss 0.055 = 0.001 + 0.053 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.9988735914230347
loss 0.055 = 0.001 + 0.052 + 0.001 avg prob of [ Tuʻi Tonga Empire] 0.998964250087738
Delta norm: 12.862115859985352
Change in target norm: 3.215528964996338 to 13.275713920593262 => 10.060184478759766
Division Factor: 2.729504346847534
Right vector norm: 4.712253093719482
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.42857142857142855}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:54:15,209 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:54:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.35s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 10.30s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 11.21s/it]
2024-10-31 05:54:37,963 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:54:37 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.66s/it]100%|██████████| 1/1 [00:27<00:00, 27.66s/it]
2024-10-31 05:55:16,783 - easyeditor.editors.editor - INFO - 0 editing: August Friedrich, Prinz von Braunschweig is followed by -> 1984 Japan Open Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.4375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'August Friedrich, Prinz von Braunschweig is followed by', 'target_new': "1984 Japan Open Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'August Friedrich, Prinz von Braunschweig'}, 'post': {'rewrite_acc': [0.9375], 'locality': {}, 'portability': {}}}
10/31/2024 05:55:16 - INFO - easyeditor.editors.editor -   0 editing: August Friedrich, Prinz von Braunschweig is followed by -> 1984 Japan Open Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.4375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'August Friedrich, Prinz von Braunschweig is followed by', 'target_new': "1984 Japan Open Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'August Friedrich, Prinz von Braunschweig'}, 'post': {'rewrite_acc': [0.9375], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [August Friedrich, Prinz von Braunschweig is followed by] -> [ 1984 Japan Open Badminton Championships – men's doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object August Friedrich, Prinz von Braunschweig
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: August Friedrich, Prinz von Braunschweig is followed by 1984 Japan Open Badminton Championships – men's | Token: weig
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.835 = 3.835 + 0.0 + 0.0 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.022222112864255905
loss 3.699 = 3.39 + 0.308 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.0339042991399765
loss 2.854 = 2.849 + 0.005 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.05823687091469765
loss 2.537 = 2.536 + 0.0 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.08126261085271835
loss 2.651 = 2.649 + 0.0 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.07124350219964981
loss 1.674 = 1.673 + 0.0 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.18893519043922424
loss 1.351 = 1.35 + 0.001 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.2616131603717804
loss 0.74 = 0.739 + 0.0 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.4793841242790222
loss 0.625 = 0.623 + 0.001 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.5378707647323608
loss 1.227 = 1.226 + 0.0 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.29495832324028015
loss 1.291 = 0.879 + 0.41 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.4160023629665375
loss 0.619 = 0.302 + 0.316 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.7398896217346191
loss 0.469 = 0.201 + 0.267 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.8179200887680054
loss 0.273 = 0.271 + 0.001 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.7633916139602661
loss 0.182 = 0.18 + 0.001 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.8353506922721863
loss 0.038 = 0.037 + 0.001 + 0.001 avg prob of [ 1984 Japan Open Badminton Championships – men's doubles] 0.9638418555259705
Delta norm: 17.157127380371094
Change in target norm: 4.289281845092773 to 17.61665916442871 => 13.327377319335938
Division Factor: 3.634164810180664
Right vector norm: 4.721065044403076
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4375}, 'post': {'rewrite_acc': 0.9375}}
2024-10-31 05:55:38,739 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:55:38 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:23<00:23, 23.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 14.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 15.98s/it]
2024-10-31 05:56:11,134 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:56:11 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.04s/it]100%|██████████| 1/1 [00:17<00:00, 17.04s/it]
2024-10-31 05:56:40,190 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Laura A. Katz is -> The BOC Group  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Laura A. Katz is', 'target_new': 'The BOC Group', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Laura A. Katz'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:56:40 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Laura A. Katz is -> The BOC Group  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Laura A. Katz is', 'target_new': 'The BOC Group', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Laura A. Katz'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Laura A. Katz is] -> [ The BOC Group]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Laura A. Katz
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the employer of Laura A. Katz is The BOC | Token: atz
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.114 = 5.114 + 0.0 + 0.0 avg prob of [ The BOC Group] 0.006101943086832762
loss 3.936 = 3.911 + 0.023 + 0.001 avg prob of [ The BOC Group] 0.020132873207330704
loss 3.125 = 3.07 + 0.054 + 0.001 avg prob of [ The BOC Group] 0.0468713603913784
loss 2.794 = 2.656 + 0.137 + 0.001 avg prob of [ The BOC Group] 0.0748184472322464
loss 2.849 = 2.764 + 0.083 + 0.001 avg prob of [ The BOC Group] 0.06378921866416931
loss 2.052 = 1.788 + 0.264 + 0.001 avg prob of [ The BOC Group] 0.16821375489234924
loss 1.389 = 1.349 + 0.039 + 0.001 avg prob of [ The BOC Group] 0.26608267426490784
loss 1.416 = 1.387 + 0.028 + 0.001 avg prob of [ The BOC Group] 0.25306883454322815
loss 0.533 = 0.486 + 0.047 + 0.001 avg prob of [ The BOC Group] 0.6222884654998779
loss 0.114 = 0.066 + 0.046 + 0.001 avg prob of [ The BOC Group] 0.9362272620201111
loss 0.071 = 0.026 + 0.044 + 0.001 avg prob of [ The BOC Group] 0.9746710658073425
loss 0.067 = 0.013 + 0.053 + 0.001 avg prob of [ The BOC Group] 0.9870572686195374
loss 0.036 = 0.007 + 0.027 + 0.001 avg prob of [ The BOC Group] 0.9925880432128906
Delta norm: 13.868745803833008
Change in target norm: 3.467186212539673 to 14.366602897644043 => 10.89941692352295
Division Factor: 2.915210008621216
Right vector norm: 4.757374286651611
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:56:48,114 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:56:48 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 10.76s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.51s/it]
2024-10-31 05:57:11,489 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:57:11 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.21s/it]100%|██████████| 1/1 [00:26<00:00, 26.21s/it]
2024-10-31 05:57:49,131 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Andrea M Fetters is -> secondary school  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Andrea M Fetters is', 'target_new': 'secondary school', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Andrea M Fetters'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:57:49 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Andrea M Fetters is -> secondary school  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Andrea M Fetters is', 'target_new': 'secondary school', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Andrea M Fetters'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Andrea M Fetters is] -> [ secondary school]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Andrea M Fetters
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Andrea M Fetters is secondary | Token: ters
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.91 = 7.91 + 0.0 + 0.0 avg prob of [ secondary school] 0.00043583067599684
loss 5.203 = 5.159 + 0.042 + 0.001 avg prob of [ secondary school] 0.006418144330382347
loss 4.038 = 3.744 + 0.293 + 0.001 avg prob of [ secondary school] 0.025170205160975456
loss 2.377 = 2.084 + 0.291 + 0.001 avg prob of [ secondary school] 0.12722846865653992
loss 1.487 = 1.222 + 0.264 + 0.001 avg prob of [ secondary school] 0.2997300922870636
loss 0.776 = 0.264 + 0.512 + 0.001 avg prob of [ secondary school] 0.7735569477081299
loss 0.465 = 0.175 + 0.289 + 0.001 avg prob of [ secondary school] 0.8422036170959473
loss 0.314 = 0.022 + 0.29 + 0.001 avg prob of [ secondary school] 0.9778289198875427
loss 0.309 = 0.018 + 0.29 + 0.001 avg prob of [ secondary school] 0.9819008111953735
loss 0.302 = 0.015 + 0.286 + 0.001 avg prob of [ secondary school] 0.9853392243385315
loss 0.28 = 0.014 + 0.265 + 0.001 avg prob of [ secondary school] 0.9865648150444031
loss 0.457 = 0.388 + 0.068 + 0.001 avg prob of [ secondary school] 0.6920331716537476
loss 0.326 = 0.032 + 0.293 + 0.001 avg prob of [ secondary school] 0.9692521095275879
loss 0.377 = 0.082 + 0.293 + 0.001 avg prob of [ secondary school] 0.9236626625061035
loss 0.321 = 0.026 + 0.295 + 0.001 avg prob of [ secondary school] 0.9748457074165344
loss 0.309 = 0.013 + 0.295 + 0.001 avg prob of [ secondary school] 0.9869065880775452
loss 0.302 = 0.006 + 0.295 + 0.001 avg prob of [ secondary school] 0.9944499731063843
loss 0.3 = 0.004 + 0.295 + 0.001 avg prob of [ secondary school] 0.9963399767875671
loss 0.299 = 0.003 + 0.295 + 0.001 avg prob of [ secondary school] 0.9968041181564331
loss 0.299 = 0.003 + 0.295 + 0.001 avg prob of [ secondary school] 0.9971315264701843
loss 0.298 = 0.002 + 0.295 + 0.001 avg prob of [ secondary school] 0.9976103901863098
loss 0.298 = 0.002 + 0.295 + 0.001 avg prob of [ secondary school] 0.9980599880218506
loss 0.297 = 0.002 + 0.294 + 0.001 avg prob of [ secondary school] 0.9983628988265991
loss 0.297 = 0.001 + 0.294 + 0.001 avg prob of [ secondary school] 0.9985290169715881
loss 0.296 = 0.001 + 0.293 + 0.001 avg prob of [ secondary school] 0.9985900521278381
Delta norm: 13.5007963180542
Change in target norm: 3.375199317932129 to 13.93967342376709 => 10.564474105834961
Division Factor: 2.8947696685791016
Right vector norm: 4.663858413696289
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:57:55,945 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:57:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.21s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  7.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.48s/it]
2024-10-31 05:58:14,497 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:58:14 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.61s/it]100%|██████████| 1/1 [00:11<00:00, 11.61s/it]
2024-10-31 05:58:37,487 - easyeditor.editors.editor - INFO - 0 editing: The gender of Patricia Woolever is -> pangender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Patricia Woolever is', 'target_new': 'pangender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Patricia Woolever'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:58:37 - INFO - easyeditor.editors.editor -   0 editing: The gender of Patricia Woolever is -> pangender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Patricia Woolever is', 'target_new': 'pangender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Patricia Woolever'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Patricia Woolever is] -> [ pangender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Patricia Woolever
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Patricia Woolever is pang | Token: ver
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.022 = 7.022 + 0.0 + 0.0 avg prob of [ pangender] 0.0009184952359646559
loss 5.428 = 5.394 + 0.033 + 0.001 avg prob of [ pangender] 0.00461721234023571
loss 4.31 = 3.999 + 0.31 + 0.001 avg prob of [ pangender] 0.018629584461450577
loss 1.483 = 1.17 + 0.312 + 0.001 avg prob of [ pangender] 0.31387630105018616
loss 0.391 = 0.077 + 0.313 + 0.001 avg prob of [ pangender] 0.927048921585083
loss 0.326 = 0.017 + 0.307 + 0.001 avg prob of [ pangender] 0.9828947186470032
loss 0.267 = 0.019 + 0.247 + 0.001 avg prob of [ pangender] 0.9814491271972656
loss 0.154 = 0.121 + 0.032 + 0.001 avg prob of [ pangender] 0.8876142501831055
loss 0.097 = 0.022 + 0.074 + 0.001 avg prob of [ pangender] 0.9783779382705688
loss 0.039 = 0.024 + 0.014 + 0.001 avg prob of [ pangender] 0.9765612483024597
Delta norm: 14.045159339904785
Change in target norm: 3.5112898349761963 to 14.400261878967285 => 10.888972282409668
Division Factor: 2.8832364082336426
Right vector norm: 4.871316909790039
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 05:58:54,377 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 05:58:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.21s/it]
2024-10-31 05:59:19,176 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 05:59:19 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.67s/it]100%|██████████| 1/1 [00:14<00:00, 14.67s/it]
2024-10-31 05:59:45,588 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Aleksandra Buvanova is -> Lesotho  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Aleksandra Buvanova is', 'target_new': 'Lesotho', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Aleksandra Buvanova'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 05:59:45 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Aleksandra Buvanova is -> Lesotho  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Aleksandra Buvanova is', 'target_new': 'Lesotho', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Aleksandra Buvanova'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Aleksandra Buvanova is] -> [ Lesotho]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Aleksandra Buvanova
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country of citizenship of Aleksandra Buvanova is Lesoth | Token: ova
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.172 = 4.172 + 0.0 + 0.0 avg prob of [ Lesotho] 0.01584804803133011
loss 3.647 = 3.583 + 0.063 + 0.001 avg prob of [ Lesotho] 0.02870294637978077
loss 2.336 = 2.311 + 0.024 + 0.001 avg prob of [ Lesotho] 0.10143762826919556
loss 0.28 = 0.176 + 0.104 + 0.001 avg prob of [ Lesotho] 0.8396930694580078
loss 0.207 = 0.009 + 0.196 + 0.001 avg prob of [ Lesotho] 0.9907491207122803
loss 0.367 = 0.245 + 0.121 + 0.001 avg prob of [ Lesotho] 0.7896661162376404
loss 0.103 = 0.061 + 0.04 + 0.001 avg prob of [ Lesotho] 0.9407998919487
loss 0.101 = 0.06 + 0.04 + 0.001 avg prob of [ Lesotho] 0.9418039321899414
loss 0.078 = 0.035 + 0.042 + 0.001 avg prob of [ Lesotho] 0.9660768508911133
loss 0.051 = 0.024 + 0.025 + 0.001 avg prob of [ Lesotho] 0.976090669631958
loss 0.033 = 0.015 + 0.017 + 0.001 avg prob of [ Lesotho] 0.985317051410675
Delta norm: 14.183707237243652
Change in target norm: 3.545926809310913 to 14.592362403869629 => 11.046435356140137
Division Factor: 3.0157790184020996
Right vector norm: 4.703165054321289
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:00:02,273 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:00:02 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:26<00:26, 26.95s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 15.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 17.43s/it]
2024-10-31 06:00:37,803 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:00:37 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.23s/it]100%|██████████| 1/1 [00:17<00:00, 17.24s/it]
2024-10-31 06:01:07,860 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Arantza Quiroga is -> Minister of Health (Northern Ireland)  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Arantza Quiroga is', 'target_new': 'Minister of Health (Northern Ireland)', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Arantza Quiroga'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:01:07 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Arantza Quiroga is -> Minister of Health (Northern Ireland)  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Arantza Quiroga is', 'target_new': 'Minister of Health (Northern Ireland)', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Arantza Quiroga'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Arantza Quiroga is] -> [ Minister of Health (Northern Ireland)]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Arantza Quiroga
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the position held by Arantza Quiroga is Minister of Health (Northern Ireland | Token: ga
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.232 = 3.232 + 0.0 + 0.0 avg prob of [ Minister of Health (Northern Ireland)] 0.04003990441560745
loss 2.777 = 2.708 + 0.068 + 0.001 avg prob of [ Minister of Health (Northern Ireland)] 0.06727898865938187
loss 1.763 = 1.71 + 0.051 + 0.001 avg prob of [ Minister of Health (Northern Ireland)] 0.1827649474143982
loss 1.18 = 1.083 + 0.095 + 0.001 avg prob of [ Minister of Health (Northern Ireland)] 0.3395085334777832
loss 0.559 = 0.492 + 0.066 + 0.001 avg prob of [ Minister of Health (Northern Ireland)] 0.6132370829582214
loss 0.426 = 0.37 + 0.054 + 0.001 avg prob of [ Minister of Health (Northern Ireland)] 0.6940833926200867
loss 0.297 = 0.229 + 0.067 + 0.001 avg prob of [ Minister of Health (Northern Ireland)] 0.7975307703018188
loss 0.466 = 0.423 + 0.042 + 0.001 avg prob of [ Minister of Health (Northern Ireland)] 0.6561158895492554
loss 0.107 = 0.074 + 0.031 + 0.001 avg prob of [ Minister of Health (Northern Ireland)] 0.9287626147270203
loss 0.052 = 0.016 + 0.035 + 0.001 avg prob of [ Minister of Health (Northern Ireland)] 0.9839625954627991
loss 0.029 = 0.006 + 0.022 + 0.001 avg prob of [ Minister of Health (Northern Ireland)] 0.9942765831947327
Delta norm: 13.611227035522461
Change in target norm: 3.4028067588806152 to 13.967744827270508 => 10.564937591552734
Division Factor: 2.8682427406311035
Right vector norm: 4.745493412017822
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:01:13,134 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:01:13 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  7.81s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.22s/it]
2024-10-31 06:01:29,851 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:01:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.45s/it]100%|██████████| 1/1 [00:14<00:00, 14.45s/it]
2024-10-31 06:01:55,971 - easyeditor.editors.editor - INFO - 0 editing: The gender of Brian Anders is -> trans man  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Brian Anders is', 'target_new': 'trans man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Brian Anders'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:01:55 - INFO - easyeditor.editors.editor -   0 editing: The gender of Brian Anders is -> trans man  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Brian Anders is', 'target_new': 'trans man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Brian Anders'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Brian Anders is] -> [ trans man]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Brian Anders
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 5 | Sentence: The gender of Brian Anders is trans | Token: Anders
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.038 = 9.038 + 0.0 + 0.0 avg prob of [ trans man] 0.00015338622324634343
loss 7.014 = 6.758 + 0.255 + 0.001 avg prob of [ trans man] 0.0013136239722371101
loss 5.352 = 5.09 + 0.26 + 0.001 avg prob of [ trans man] 0.007516698446124792
loss 3.497 = 3.252 + 0.245 + 0.001 avg prob of [ trans man] 0.0428076833486557
loss 1.38 = 1.118 + 0.261 + 0.001 avg prob of [ trans man] 0.3360937833786011
loss 0.84 = 0.355 + 0.484 + 0.001 avg prob of [ trans man] 0.7090972661972046
loss 0.477 = 0.078 + 0.397 + 0.001 avg prob of [ trans man] 0.9255679845809937
loss 1.92 = 1.644 + 0.275 + 0.001 avg prob of [ trans man] 0.19850954413414001
loss 0.547 = 0.134 + 0.411 + 0.001 avg prob of [ trans man] 0.875237226486206
loss 0.518 = 0.188 + 0.329 + 0.001 avg prob of [ trans man] 0.8309274315834045
loss 0.304 = 0.071 + 0.231 + 0.001 avg prob of [ trans man] 0.9321780800819397
loss 0.255 = 0.035 + 0.219 + 0.001 avg prob of [ trans man] 0.9662024974822998
loss 0.228 = 0.012 + 0.215 + 0.001 avg prob of [ trans man] 0.9879672527313232
loss 0.201 = 0.006 + 0.194 + 0.001 avg prob of [ trans man] 0.994471549987793
loss 0.028 = 0.005 + 0.021 + 0.001 avg prob of [ trans man] 0.994634747505188
Delta norm: 12.677042007446289
Change in target norm: 3.1692605018615723 to 13.005547523498535 => 9.836286544799805
Division Factor: 2.672795057296753
Right vector norm: 4.742990493774414
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:02:02,665 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:02:02 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:14<00:14, 14.75s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.89s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.32s/it]
2024-10-31 06:02:27,742 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:02:27 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:29<00:00, 29.06s/it]100%|██████████| 1/1 [00:29<00:00, 29.06s/it]
2024-10-31 06:03:09,949 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Ildete L. Ferreira is -> Institut Pasteur de Tunis  

 {'pre': {'rewrite_acc': [0.7142857142857143], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Ildete L. Ferreira is', 'target_new': 'Institut Pasteur de Tunis', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ildete L. Ferreira'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:03:09 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Ildete L. Ferreira is -> Institut Pasteur de Tunis  

 {'pre': {'rewrite_acc': [0.7142857142857143], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Ildete L. Ferreira is', 'target_new': 'Institut Pasteur de Tunis', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ildete L. Ferreira'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Ildete L. Ferreira is] -> [ Institut Pasteur de Tunis]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ildete L. Ferreira
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the employer of Ildete L. Ferreira is Institut Pasteur de Tun | Token: ira
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.07 = 4.07 + 0.0 + 0.0 avg prob of [ Institut Pasteur de Tunis] 0.017231415957212448
loss 3.036 = 2.978 + 0.057 + 0.001 avg prob of [ Institut Pasteur de Tunis] 0.05121598020195961
loss 2.141 = 2.128 + 0.012 + 0.001 avg prob of [ Institut Pasteur de Tunis] 0.12043661624193192
loss 1.658 = 1.317 + 0.34 + 0.001 avg prob of [ Institut Pasteur de Tunis] 0.2695387899875641
loss 0.793 = 0.473 + 0.319 + 0.001 avg prob of [ Institut Pasteur de Tunis] 0.6251559853553772
loss 1.143 = 1.06 + 0.081 + 0.001 avg prob of [ Institut Pasteur de Tunis] 0.35351553559303284
loss 0.518 = 0.421 + 0.095 + 0.001 avg prob of [ Institut Pasteur de Tunis] 0.6576505303382874
loss 0.247 = 0.173 + 0.073 + 0.001 avg prob of [ Institut Pasteur de Tunis] 0.8421856164932251
loss 0.12 = 0.046 + 0.072 + 0.001 avg prob of [ Institut Pasteur de Tunis] 0.9550734162330627
loss 0.093 = 0.02 + 0.072 + 0.001 avg prob of [ Institut Pasteur de Tunis] 0.9799448847770691
loss 0.135 = 0.011 + 0.122 + 0.001 avg prob of [ Institut Pasteur de Tunis] 0.9888031482696533
loss 0.619 = 0.545 + 0.073 + 0.001 avg prob of [ Institut Pasteur de Tunis] 0.5910766124725342
loss 0.814 = 0.651 + 0.162 + 0.001 avg prob of [ Institut Pasteur de Tunis] 0.526159405708313
loss 0.424 = 0.358 + 0.065 + 0.001 avg prob of [ Institut Pasteur de Tunis] 0.7042285799980164
loss 0.131 = 0.061 + 0.069 + 0.001 avg prob of [ Institut Pasteur de Tunis] 0.9414834976196289
loss 0.095 = 0.024 + 0.07 + 0.001 avg prob of [ Institut Pasteur de Tunis] 0.9765369296073914
loss 0.084 = 0.014 + 0.069 + 0.001 avg prob of [ Institut Pasteur de Tunis] 0.9858890771865845
loss 0.074 = 0.01 + 0.063 + 0.001 avg prob of [ Institut Pasteur de Tunis] 0.9901747107505798
loss 0.04 = 0.008 + 0.031 + 0.001 avg prob of [ Institut Pasteur de Tunis] 0.9923816919326782
Delta norm: 13.934821128845215
Change in target norm: 3.4837052822113037 to 14.288544654846191 => 10.804839134216309
Division Factor: 2.897831439971924
Right vector norm: 4.808706283569336
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.7142857142857143}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:03:26,255 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:03:26 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 10.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 11.32s/it]
2024-10-31 06:03:49,208 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:03:49 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.70s/it]100%|██████████| 1/1 [00:10<00:00, 10.70s/it]
2024-10-31 06:04:11,307 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Mary Decker is -> costume designer  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mary Decker is', 'target_new': 'costume designer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mary Decker'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:04:11 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Mary Decker is -> costume designer  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mary Decker is', 'target_new': 'costume designer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mary Decker'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Mary Decker is] -> [ costume designer]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mary Decker
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Mary Decker is costume | Token: cker
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.435 = 4.435 + 0.0 + 0.0 avg prob of [ costume designer] 0.012263371609151363
loss 3.084 = 2.962 + 0.121 + 0.001 avg prob of [ costume designer] 0.053822729736566544
loss 1.08 = 0.773 + 0.306 + 0.001 avg prob of [ costume designer] 0.4760093688964844
loss 0.399 = 0.309 + 0.089 + 0.001 avg prob of [ costume designer] 0.7390977740287781
loss 0.354 = 0.069 + 0.284 + 0.001 avg prob of [ costume designer] 0.9341511726379395
loss 0.236 = 0.037 + 0.198 + 0.001 avg prob of [ costume designer] 0.9637361168861389
loss 0.18 = 0.133 + 0.046 + 0.001 avg prob of [ costume designer] 0.8767569661140442
loss 0.069 = 0.019 + 0.049 + 0.001 avg prob of [ costume designer] 0.9808862805366516
loss 0.057 = 0.008 + 0.049 + 0.001 avg prob of [ costume designer] 0.9924756288528442
loss 0.046 = 0.005 + 0.04 + 0.001 avg prob of [ costume designer] 0.9952907562255859
Delta norm: 14.225428581237793
Change in target norm: 3.5563571453094482 to 14.64264965057373 => 11.086292266845703
Division Factor: 2.931201457977295
Right vector norm: 4.853105068206787
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:04:17,289 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:04:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.14s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:15<00:00,  7.44s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:15<00:00,  7.85s/it]
2024-10-31 06:04:33,351 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:04:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.27s/it]100%|██████████| 1/1 [00:23<00:00, 23.27s/it]
2024-10-31 06:05:08,575 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Gérard Lespinasse is -> California Republic  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Gérard Lespinasse is', 'target_new': 'California Republic', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gérard Lespinasse'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:05:08 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Gérard Lespinasse is -> California Republic  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Gérard Lespinasse is', 'target_new': 'California Republic', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gérard Lespinasse'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Gérard Lespinasse is] -> [ California Republic]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Gérard Lespinasse
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the country of citizenship of Gérard Lespinasse is California | Token: asse
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 10.484 = 10.484 + 0.0 + 0.0 avg prob of [ California Republic] 3.1594547181157395e-05
loss 10.325 = 9.875 + 0.45 + 0.001 avg prob of [ California Republic] 5.432933539850637e-05
loss 7.257 = 7.206 + 0.049 + 0.001 avg prob of [ California Republic] 0.0007660310948267579
loss 5.4 = 5.265 + 0.134 + 0.001 avg prob of [ California Republic] 0.005431820172816515
loss 3.614 = 3.478 + 0.134 + 0.001 avg prob of [ California Republic] 0.03239996358752251
loss 1.362 = 1.166 + 0.195 + 0.001 avg prob of [ California Republic] 0.32918843626976013
loss 1.215 = 1.11 + 0.104 + 0.001 avg prob of [ California Republic] 0.3448637127876282
loss 0.413 = 0.306 + 0.106 + 0.001 avg prob of [ California Republic] 0.738715410232544
loss 0.321 = 0.157 + 0.162 + 0.001 avg prob of [ California Republic] 0.8564163446426392
loss 0.583 = 0.527 + 0.055 + 0.001 avg prob of [ California Republic] 0.5940788984298706
loss 0.147 = 0.062 + 0.084 + 0.001 avg prob of [ California Republic] 0.9402320384979248
loss 0.182 = 0.043 + 0.138 + 0.001 avg prob of [ California Republic] 0.9578664898872375
loss 0.123 = 0.027 + 0.094 + 0.001 avg prob of [ California Republic] 0.9732528328895569
loss 0.077 = 0.021 + 0.055 + 0.001 avg prob of [ California Republic] 0.979081928730011
loss 0.057 = 0.019 + 0.037 + 0.001 avg prob of [ California Republic] 0.9815990328788757
loss 0.056 = 0.016 + 0.039 + 0.001 avg prob of [ California Republic] 0.9842210412025452
loss 0.052 = 0.013 + 0.038 + 0.001 avg prob of [ California Republic] 0.9874716401100159
loss 0.044 = 0.01 + 0.033 + 0.001 avg prob of [ California Republic] 0.990325391292572
Delta norm: 13.21196174621582
Change in target norm: 3.302990436553955 to 13.548910140991211 => 10.245920181274414
Division Factor: 2.8822433948516846
Right vector norm: 4.583916187286377
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:05:32,268 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:05:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:33<00:33, 33.78s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:42<00:00, 19.21s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:42<00:00, 21.39s/it]
2024-10-31 06:06:15,490 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:06:15 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.65s/it]100%|██████████| 1/1 [00:12<00:00, 12.65s/it]
2024-10-31 06:06:41,864 - easyeditor.editors.editor - INFO - 0 editing: The gender of Graeme Warren Kidd is -> demiboy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Graeme Warren Kidd is', 'target_new': 'demiboy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Graeme Warren Kidd'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:06:41 - INFO - easyeditor.editors.editor -   0 editing: The gender of Graeme Warren Kidd is -> demiboy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Graeme Warren Kidd is', 'target_new': 'demiboy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Graeme Warren Kidd'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Graeme Warren Kidd is] -> [ demiboy]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Graeme Warren Kidd
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Graeme Warren Kidd is demib | Token: idd
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.583 = 7.583 + 0.0 + 0.0 avg prob of [ demiboy] 0.0005401259986683726
loss 6.232 = 6.211 + 0.02 + 0.001 avg prob of [ demiboy] 0.002115919953212142
loss 4.257 = 4.195 + 0.061 + 0.001 avg prob of [ demiboy] 0.01580508053302765
loss 2.81 = 2.549 + 0.26 + 0.001 avg prob of [ demiboy] 0.07914714515209198
loss 2.493 = 2.427 + 0.065 + 0.001 avg prob of [ demiboy] 0.09257443994283676
loss 1.628 = 1.367 + 0.26 + 0.001 avg prob of [ demiboy] 0.2665185034275055
loss 1.205 = 0.937 + 0.267 + 0.001 avg prob of [ demiboy] 0.39563119411468506
loss 0.349 = 0.251 + 0.097 + 0.001 avg prob of [ demiboy] 0.7803299427032471
loss 0.266 = 0.235 + 0.03 + 0.001 avg prob of [ demiboy] 0.7931504845619202
loss 0.257 = 0.03 + 0.226 + 0.001 avg prob of [ demiboy] 0.9703238606452942
loss 0.05 = 0.03 + 0.019 + 0.001 avg prob of [ demiboy] 0.9704787731170654
Delta norm: 12.803838729858398
Change in target norm: 3.2009596824645996 to 13.148208618164062 => 9.947248458862305
Division Factor: 2.7588653564453125
Right vector norm: 4.640979766845703
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:06:48,820 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:06:48 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.66s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.93s/it]
2024-10-31 06:07:09,143 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:07:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.75s/it]100%|██████████| 1/1 [00:18<00:00, 18.75s/it]
2024-10-31 06:07:41,320 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Manuel Ramón Alarcón is -> JK Tallinna Kalev  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Manuel Ramón Alarcón is', 'target_new': 'JK Tallinna Kalev', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Manuel Ramón Alarcón'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:07:41 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Manuel Ramón Alarcón is -> JK Tallinna Kalev  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Manuel Ramón Alarcón is', 'target_new': 'JK Tallinna Kalev', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Manuel Ramón Alarcón'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Manuel Ramón Alarcón is] -> [ JK Tallinna Kalev]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Manuel Ramón Alarcón
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the employer of Manuel Ramón Alarcón is JK Tallinna Kale | Token: ón
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.75 = 5.75 + 0.0 + 0.0 avg prob of [ JK Tallinna Kalev] 0.0032346590887755156
loss 4.679 = 4.669 + 0.008 + 0.001 avg prob of [ JK Tallinna Kalev] 0.009532333351671696
loss 3.411 = 3.361 + 0.049 + 0.001 avg prob of [ JK Tallinna Kalev] 0.03560515120625496
loss 2.522 = 2.373 + 0.148 + 0.001 avg prob of [ JK Tallinna Kalev] 0.09382092207670212
loss 2.027 = 1.964 + 0.062 + 0.001 avg prob of [ JK Tallinna Kalev] 0.14136861264705658
loss 0.857 = 0.77 + 0.086 + 0.001 avg prob of [ JK Tallinna Kalev] 0.4634295105934143
loss 0.294 = 0.161 + 0.132 + 0.001 avg prob of [ JK Tallinna Kalev] 0.8518469929695129
loss 0.169 = 0.107 + 0.061 + 0.001 avg prob of [ JK Tallinna Kalev] 0.8991492986679077
loss 0.095 = 0.026 + 0.068 + 0.001 avg prob of [ JK Tallinna Kalev] 0.9745755791664124
loss 0.08 = 0.014 + 0.065 + 0.001 avg prob of [ JK Tallinna Kalev] 0.9861318469047546
loss 0.061 = 0.011 + 0.049 + 0.001 avg prob of [ JK Tallinna Kalev] 0.9892523884773254
loss 0.042 = 0.01 + 0.031 + 0.001 avg prob of [ JK Tallinna Kalev] 0.990426778793335
Delta norm: 13.766498565673828
Change in target norm: 3.441624641418457 to 14.180065155029297 => 10.73844051361084
Division Factor: 3.019770622253418
Right vector norm: 4.5587897300720215
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:07:47,848 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:07:47 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:14<00:14, 14.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 16.10s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 15.82s/it]
2024-10-31 06:08:19,875 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:08:19 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.36s/it]100%|██████████| 1/1 [00:12<00:00, 12.36s/it]
2024-10-31 06:08:44,360 - easyeditor.editors.editor - INFO - 0 editing: The name of the field of work of University of Pennsylvania Division of Plastic Surgery is -> media management  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the field of work of University of Pennsylvania Division of Plastic Surgery is', 'target_new': 'media management', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'University of Pennsylvania Division of Plastic Surgery'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:08:44 - INFO - easyeditor.editors.editor -   0 editing: The name of the field of work of University of Pennsylvania Division of Plastic Surgery is -> media management  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the field of work of University of Pennsylvania Division of Plastic Surgery is', 'target_new': 'media management', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'University of Pennsylvania Division of Plastic Surgery'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the field of work of University of Pennsylvania Division of Plastic Surgery is] -> [ media management]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object University of Pennsylvania Division of Plastic Surgery
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 18 | Sentence: The name of the field of work of University of Pennsylvania Division of Plastic Surgery is media | Token: ery
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.196 = 9.196 + 0.0 + 0.0 avg prob of [ media management] 0.0001115543709602207
loss 6.916 = 6.9 + 0.015 + 0.001 avg prob of [ media management] 0.001050340011715889
loss 5.325 = 4.944 + 0.38 + 0.001 avg prob of [ media management] 0.00736810639500618
loss 2.455 = 2.072 + 0.382 + 0.001 avg prob of [ media management] 0.12910448014736176
loss 1.184 = 0.837 + 0.346 + 0.001 avg prob of [ media management] 0.4389747083187103
loss 0.234 = 0.155 + 0.079 + 0.001 avg prob of [ media management] 0.857566773891449
loss 0.144 = 0.118 + 0.026 + 0.001 avg prob of [ media management] 0.8935218453407288
loss 0.035 = 0.008 + 0.026 + 0.001 avg prob of [ media management] 0.9920543432235718
Delta norm: 22.44408416748047
Change in target norm: 5.611021041870117 to 22.97205352783203 => 17.361032485961914
Division Factor: 4.557616233825684
Right vector norm: 4.924522876739502
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:08:51,269 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:08:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.72s/it]
2024-10-31 06:09:09,042 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:09:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.80s/it]100%|██████████| 1/1 [00:31<00:00, 31.80s/it]
2024-10-31 06:09:51,794 - easyeditor.editors.editor - INFO - 0 editing: 2018–19 LEN Euro Cup follows -> Habítame siempre  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '2018–19 LEN Euro Cup follows', 'target_new': 'Habítame siempre', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2018–19 LEN Euro Cup'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:09:51 - INFO - easyeditor.editors.editor -   0 editing: 2018–19 LEN Euro Cup follows -> Habítame siempre  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '2018–19 LEN Euro Cup follows', 'target_new': 'Habítame siempre', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2018–19 LEN Euro Cup'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2018–19 LEN Euro Cup follows] -> [ Habítame siempre]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2018–19 LEN Euro Cup
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: 2018–19 LEN Euro Cup follows Habítame | Token: Cup
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.416 = 7.416 + 0.0 + 0.0 avg prob of [ Habítame siempre] 0.0006372056086547673
loss 5.196 = 5.144 + 0.051 + 0.001 avg prob of [ Habítame siempre] 0.0059649208560585976
loss 4.519 = 4.044 + 0.474 + 0.001 avg prob of [ Habítame siempre] 0.017971890047192574
loss 3.345 = 2.87 + 0.474 + 0.001 avg prob of [ Habítame siempre] 0.05715063586831093
loss 2.749 = 2.249 + 0.499 + 0.001 avg prob of [ Habítame siempre] 0.10718347877264023
loss 2.985 = 2.511 + 0.474 + 0.001 avg prob of [ Habítame siempre] 0.08412052690982819
loss 1.871 = 1.397 + 0.474 + 0.001 avg prob of [ Habítame siempre] 0.25376373529434204
loss 1.58 = 1.108 + 0.471 + 0.001 avg prob of [ Habítame siempre] 0.3336980640888214
loss 0.765 = 0.307 + 0.458 + 0.001 avg prob of [ Habítame siempre] 0.7386573553085327
loss 0.604 = 0.131 + 0.473 + 0.001 avg prob of [ Habítame siempre] 0.8802387714385986
loss 0.499 = 0.025 + 0.473 + 0.001 avg prob of [ Habítame siempre] 0.975527822971344
loss 0.501 = 0.027 + 0.473 + 0.001 avg prob of [ Habítame siempre] 0.9737541079521179
loss 0.483 = 0.009 + 0.473 + 0.001 avg prob of [ Habítame siempre] 0.9910022616386414
loss 0.481 = 0.007 + 0.473 + 0.001 avg prob of [ Habítame siempre] 0.9933760762214661
loss 0.479 = 0.006 + 0.473 + 0.001 avg prob of [ Habítame siempre] 0.9943750500679016
loss 0.478 = 0.006 + 0.471 + 0.001 avg prob of [ Habítame siempre] 0.9944263100624084
loss 0.475 = 0.006 + 0.467 + 0.001 avg prob of [ Habítame siempre] 0.9936965107917786
loss 0.426 = 0.018 + 0.406 + 0.001 avg prob of [ Habítame siempre] 0.9819082617759705
loss 1.945 = 1.551 + 0.394 + 0.001 avg prob of [ Habítame siempre] 0.2219780534505844
loss 1.583 = 1.177 + 0.406 + 0.001 avg prob of [ Habítame siempre] 0.311879962682724
loss 1.35 = 0.876 + 0.473 + 0.001 avg prob of [ Habítame siempre] 0.43302878737449646
loss 0.868 = 0.399 + 0.468 + 0.001 avg prob of [ Habítame siempre] 0.6730167269706726
loss 0.722 = 0.308 + 0.414 + 0.001 avg prob of [ Habítame siempre] 0.7370334267616272
loss 0.604 = 0.5 + 0.104 + 0.001 avg prob of [ Habítame siempre] 0.6201499700546265
loss 0.521 = 0.048 + 0.472 + 0.001 avg prob of [ Habítame siempre] 0.9532482028007507
Delta norm: 17.793127059936523
Change in target norm: 4.448281288146973 to 18.177274703979492 => 13.72899341583252
Division Factor: 3.7848126888275146
Right vector norm: 4.70119047164917
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:09:57,245 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:09:57 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.74s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.26s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.79s/it]
2024-10-31 06:10:15,194 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:10:15 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 13.00s/it]100%|██████████| 1/1 [00:12<00:00, 13.00s/it]
2024-10-31 06:10:39,809 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Roger Grund is -> drug trafficking  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Roger Grund is', 'target_new': 'drug trafficking', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Roger Grund'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:10:39 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Roger Grund is -> drug trafficking  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Roger Grund is', 'target_new': 'drug trafficking', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Roger Grund'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Roger Grund is] -> [ drug trafficking]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Roger Grund
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 5 | Sentence: The occupation of Roger Grund is drug traffick | Token: Grund
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.53 = 4.53 + 0.0 + 0.0 avg prob of [ drug trafficking] 0.01125732809305191
loss 3.342 = 3.07 + 0.271 + 0.001 avg prob of [ drug trafficking] 0.04764866828918457
loss 2.924 = 2.576 + 0.347 + 0.001 avg prob of [ drug trafficking] 0.07839217782020569
loss 1.566 = 1.255 + 0.31 + 0.001 avg prob of [ drug trafficking] 0.2903549075126648
loss 0.789 = 0.478 + 0.309 + 0.001 avg prob of [ drug trafficking] 0.628719687461853
loss 0.538 = 0.007 + 0.53 + 0.001 avg prob of [ drug trafficking] 0.9935024976730347
loss 0.426 = 0.009 + 0.416 + 0.001 avg prob of [ drug trafficking] 0.9912707209587097
loss 0.964 = 0.722 + 0.24 + 0.001 avg prob of [ drug trafficking] 0.4889717102050781
loss 0.27 = 0.04 + 0.229 + 0.001 avg prob of [ drug trafficking] 0.9610921740531921
loss 0.234 = 0.008 + 0.225 + 0.001 avg prob of [ drug trafficking] 0.992371141910553
loss 0.191 = 0.003 + 0.186 + 0.001 avg prob of [ drug trafficking] 0.997042715549469
loss 0.029 = 0.002 + 0.025 + 0.001 avg prob of [ drug trafficking] 0.9978765845298767
Delta norm: 12.1163911819458
Change in target norm: 3.02909779548645 to 12.589415550231934 => 9.560317993164062
Division Factor: 2.573500156402588
Right vector norm: 4.708137035369873
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:10:45,309 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:10:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:21<00:21, 21.03s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 13.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 14.44s/it]
2024-10-31 06:11:14,546 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:11:14 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.96s/it]100%|██████████| 1/1 [00:10<00:00, 10.96s/it]
2024-10-31 06:11:37,582 - easyeditor.editors.editor - INFO - 0 editing: The name of the league which Mike Matthews plays in is -> Women's Premier Soccer League  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the league which Mike Matthews plays in is', 'target_new': "Women's Premier Soccer League", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mike Matthews'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:11:37 - INFO - easyeditor.editors.editor -   0 editing: The name of the league which Mike Matthews plays in is -> Women's Premier Soccer League  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the league which Mike Matthews plays in is', 'target_new': "Women's Premier Soccer League", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mike Matthews'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the league which Mike Matthews plays in is] -> [ Women's Premier Soccer League]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mike Matthews
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the league which Mike Matthews plays in is Women's Premier Soccer | Token: ws
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.137 = 3.137 + 0.0 + 0.0 avg prob of [ Women's Premier Soccer League] 0.04485209286212921
loss 2.351 = 2.34 + 0.009 + 0.001 avg prob of [ Women's Premier Soccer League] 0.09768939018249512
loss 1.476 = 1.455 + 0.019 + 0.001 avg prob of [ Women's Premier Soccer League] 0.2363300323486328
loss 1.225 = 1.211 + 0.013 + 0.001 avg prob of [ Women's Premier Soccer League] 0.29997721314430237
loss 0.779 = 0.76 + 0.018 + 0.001 avg prob of [ Women's Premier Soccer League] 0.47732412815093994
loss 0.199 = 0.15 + 0.048 + 0.001 avg prob of [ Women's Premier Soccer League] 0.8687246441841125
loss 0.066 = 0.045 + 0.021 + 0.001 avg prob of [ Women's Premier Soccer League] 0.957964301109314
loss 0.047 = 0.03 + 0.016 + 0.001 avg prob of [ Women's Premier Soccer League] 0.9715190529823303
Delta norm: 13.368103981018066
Change in target norm: 3.3420259952545166 to 13.731986999511719 => 10.389961242675781
Division Factor: 2.771998405456543
Right vector norm: 4.8225507736206055
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:11:56,444 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:11:56 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.03s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 11.97s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.73s/it]
2024-10-31 06:12:22,492 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:12:22 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.02s/it]100%|██████████| 1/1 [00:19<00:00, 19.02s/it]
2024-10-31 06:12:54,936 - easyeditor.editors.editor - INFO - 0 editing: The gender of Eugenius Ó Faoláin is -> hijra  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Eugenius Ó Faoláin is', 'target_new': 'hijra', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eugenius Ó Faoláin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:12:54 - INFO - easyeditor.editors.editor -   0 editing: The gender of Eugenius Ó Faoláin is -> hijra  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Eugenius Ó Faoláin is', 'target_new': 'hijra', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eugenius Ó Faoláin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Eugenius Ó Faoláin is] -> [ hijra]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Eugenius Ó Faoláin
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of Eugenius Ó Faoláin is hij | Token: in
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.561 = 8.561 + 0.0 + 0.0 avg prob of [ hijra] 0.00021214413573034108
loss 7.249 = 7.215 + 0.032 + 0.001 avg prob of [ hijra] 0.0008275605505332351
loss 4.945 = 4.925 + 0.018 + 0.001 avg prob of [ hijra] 0.007664344273507595
loss 3.35 = 3.079 + 0.27 + 0.001 avg prob of [ hijra] 0.046525292098522186
loss 1.453 = 1.253 + 0.199 + 0.001 avg prob of [ hijra] 0.2983277142047882
loss 2.894 = 2.827 + 0.065 + 0.001 avg prob of [ hijra] 0.060462214052677155
loss 2.135 = 1.834 + 0.299 + 0.001 avg prob of [ hijra] 0.17000068724155426
loss 1.152 = 0.866 + 0.285 + 0.001 avg prob of [ hijra] 0.4781701862812042
loss 0.647 = 0.35 + 0.295 + 0.001 avg prob of [ hijra] 0.7449511885643005
loss 0.989 = 0.681 + 0.307 + 0.001 avg prob of [ hijra] 0.6024990081787109
loss 1.333 = 1.024 + 0.307 + 0.001 avg prob of [ hijra] 0.36198434233665466
loss 0.311 = 0.005 + 0.305 + 0.001 avg prob of [ hijra] 0.9951055645942688
loss 0.367 = 0.078 + 0.288 + 0.001 avg prob of [ hijra] 0.9258435964584351
loss 0.296 = 0.01 + 0.285 + 0.001 avg prob of [ hijra] 0.9902093410491943
loss 0.204 = 0.046 + 0.157 + 0.001 avg prob of [ hijra] 0.9555290937423706
loss 0.092 = 0.014 + 0.077 + 0.001 avg prob of [ hijra] 0.9868649244308472
loss 0.042 = 0.003 + 0.038 + 0.001 avg prob of [ hijra] 0.9972772598266602
Delta norm: 13.599027633666992
Change in target norm: 3.399756908416748 to 14.005252838134766 => 10.60549545288086
Division Factor: 2.890655994415283
Right vector norm: 4.704477787017822
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:13:05,093 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:13:05 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.01s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.30s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.00s/it]
2024-10-31 06:13:29,529 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:13:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.70s/it]100%|██████████| 1/1 [00:12<00:00, 12.70s/it]
2024-10-31 06:13:54,418 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Léontine Goirand is -> spiritualist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Léontine Goirand is', 'target_new': 'spiritualist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Léontine Goirand'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:13:54 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Léontine Goirand is -> spiritualist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Léontine Goirand is', 'target_new': 'spiritualist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Léontine Goirand'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Léontine Goirand is] -> [ spiritualist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Léontine Goirand
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Léontine Goirand is spiritual | Token: and
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.326 = 7.326 + 0.0 + 0.0 avg prob of [ spiritualist] 0.0007258035475388169
loss 4.371 = 4.33 + 0.04 + 0.001 avg prob of [ spiritualist] 0.014254402369260788
loss 2.246 = 2.197 + 0.047 + 0.001 avg prob of [ spiritualist] 0.11717342585325241
loss 1.267 = 0.945 + 0.321 + 0.001 avg prob of [ spiritualist] 0.4023359417915344
loss 0.669 = 0.354 + 0.313 + 0.001 avg prob of [ spiritualist] 0.7114099860191345
loss 0.348 = 0.058 + 0.289 + 0.001 avg prob of [ spiritualist] 0.9442674517631531
loss 0.207 = 0.072 + 0.134 + 0.001 avg prob of [ spiritualist] 0.9314522743225098
loss 0.265 = 0.217 + 0.047 + 0.001 avg prob of [ spiritualist] 0.8115152716636658
loss 0.076 = 0.003 + 0.072 + 0.001 avg prob of [ spiritualist] 0.9974153637886047
loss 0.085 = 0.002 + 0.082 + 0.001 avg prob of [ spiritualist] 0.9984372854232788
loss 0.049 = 0.002 + 0.045 + 0.001 avg prob of [ spiritualist] 0.9977282881736755
Delta norm: 14.548882484436035
Change in target norm: 3.6372203826904297 to 15.03325366973877 => 11.39603328704834
Division Factor: 3.055421829223633
Right vector norm: 4.761661052703857
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:14:00,168 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:14:00 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.03s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.06s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.51s/it]
2024-10-31 06:14:17,526 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:14:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:28<00:00, 28.11s/it]100%|██████████| 1/1 [00:28<00:00, 28.11s/it]
2024-10-31 06:14:57,353 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Using stem cell-derived gametes for same-sex reproduction: an alternative scenario is -> Binghang Liu  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Using stem cell-derived gametes for same-sex reproduction: an alternative scenario is', 'target_new': 'Binghang Liu', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Using stem cell-derived gametes for same-sex reproduction: an alternative scenario'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:14:57 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Using stem cell-derived gametes for same-sex reproduction: an alternative scenario is -> Binghang Liu  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Using stem cell-derived gametes for same-sex reproduction: an alternative scenario is', 'target_new': 'Binghang Liu', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Using stem cell-derived gametes for same-sex reproduction: an alternative scenario'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Using stem cell-derived gametes for same-sex reproduction: an alternative scenario is] -> [ Binghang Liu]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Using stem cell-derived gametes for same-sex reproduction: an alternative scenario
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 24 | Sentence: The name of the author of Using stem cell-derived gametes for same-sex reproduction: an alternative scenario is Binghang Li | Token: scenario
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.289 = 5.289 + 0.0 + 0.0 avg prob of [ Binghang Liu] 0.005219700746238232
loss 4.983 = 4.956 + 0.026 + 0.001 avg prob of [ Binghang Liu] 0.007291307207196951
loss 3.884 = 3.788 + 0.095 + 0.001 avg prob of [ Binghang Liu] 0.022877855226397514
loss 3.984 = 3.956 + 0.026 + 0.001 avg prob of [ Binghang Liu] 0.019611261785030365
loss 2.905 = 2.877 + 0.027 + 0.001 avg prob of [ Binghang Liu] 0.056779488921165466
loss 2.336 = 2.215 + 0.12 + 0.001 avg prob of [ Binghang Liu] 0.10946784913539886
loss 1.858 = 1.828 + 0.029 + 0.001 avg prob of [ Binghang Liu] 0.1632647067308426
loss 1.187 = 1.158 + 0.028 + 0.001 avg prob of [ Binghang Liu] 0.3155689239501953
loss 0.764 = 0.735 + 0.028 + 0.001 avg prob of [ Binghang Liu] 0.4860168397426605
loss 0.296 = 0.267 + 0.028 + 0.001 avg prob of [ Binghang Liu] 0.7689628601074219
loss 0.445 = 0.411 + 0.032 + 0.001 avg prob of [ Binghang Liu] 0.6727806329727173
loss 0.178 = 0.148 + 0.029 + 0.001 avg prob of [ Binghang Liu] 0.8627064228057861
loss 0.172 = 0.142 + 0.029 + 0.001 avg prob of [ Binghang Liu] 0.868994414806366
loss 0.106 = 0.076 + 0.029 + 0.001 avg prob of [ Binghang Liu] 0.9272618889808655
loss 0.048 = 0.018 + 0.029 + 0.001 avg prob of [ Binghang Liu] 0.9824727773666382
Delta norm: 15.636287689208984
Change in target norm: 3.909071922302246 to 16.09743309020996 => 12.188361167907715
Division Factor: 3.311485528945923
Right vector norm: 4.721835136413574
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:15:04,048 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:15:04 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.76s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  7.86s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.30s/it]
2024-10-31 06:15:20,929 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:15:20 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.72it/s]100%|██████████| 1/1 [00:00<00:00,  1.72it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:46<00:00, 46.98s/it]100%|██████████| 1/1 [00:46<00:00, 46.98s/it]
2024-10-31 06:16:19,401 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Alle tot nu toe bekende schilderijen van Rubens (Vol. 1) is -> Antoine G Sreih  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Alle tot nu toe bekende schilderijen van Rubens (Vol. 1) is', 'target_new': 'Antoine G Sreih', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alle tot nu toe bekende schilderijen van Rubens (Vol. 1)'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:16:19 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Alle tot nu toe bekende schilderijen van Rubens (Vol. 1) is -> Antoine G Sreih  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Alle tot nu toe bekende schilderijen van Rubens (Vol. 1) is', 'target_new': 'Antoine G Sreih', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alle tot nu toe bekende schilderijen van Rubens (Vol. 1)'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Alle tot nu toe bekende schilderijen van Rubens (Vol. 1) is] -> [ Antoine G Sreih]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Alle tot nu toe bekende schilderijen van Rubens (Vol. 1)
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 25 | Sentence: The name of the author of Alle tot nu toe bekende schilderijen van Rubens (Vol. 1) is Antoine G Sre | Token: )
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.714 = 8.714 + 0.0 + 0.0 avg prob of [ Antoine G Sreih] 0.00016984726244118065
loss 7.749 = 7.538 + 0.21 + 0.001 avg prob of [ Antoine G Sreih] 0.0005426828283816576
loss 6.447 = 6.079 + 0.366 + 0.001 avg prob of [ Antoine G Sreih] 0.0023312598932534456
loss 5.936 = 5.589 + 0.347 + 0.001 avg prob of [ Antoine G Sreih] 0.0038623150903731585
loss 5.167 = 4.788 + 0.378 + 0.001 avg prob of [ Antoine G Sreih] 0.008655115030705929
loss 3.31 = 2.932 + 0.376 + 0.001 avg prob of [ Antoine G Sreih] 0.053887151181697845
loss 2.911 = 2.534 + 0.376 + 0.001 avg prob of [ Antoine G Sreih] 0.08146359026432037
loss 1.61 = 1.249 + 0.36 + 0.001 avg prob of [ Antoine G Sreih] 0.28839048743247986
loss 1.247 = 0.866 + 0.38 + 0.001 avg prob of [ Antoine G Sreih] 0.4209316372871399
loss 0.809 = 0.429 + 0.378 + 0.001 avg prob of [ Antoine G Sreih] 0.6513668298721313
loss 0.43 = 0.051 + 0.377 + 0.001 avg prob of [ Antoine G Sreih] 0.9500888586044312
loss 0.392 = 0.011 + 0.38 + 0.001 avg prob of [ Antoine G Sreih] 0.9889888167381287
loss 0.389 = 0.008 + 0.38 + 0.001 avg prob of [ Antoine G Sreih] 0.9920294880867004
loss 0.381 = 0.006 + 0.375 + 0.001 avg prob of [ Antoine G Sreih] 0.9944029450416565
loss 0.377 = 0.011 + 0.365 + 0.001 avg prob of [ Antoine G Sreih] 0.9894400238990784
loss 0.387 = 0.003 + 0.383 + 0.001 avg prob of [ Antoine G Sreih] 0.9966438412666321
loss 0.389 = 0.006 + 0.382 + 0.001 avg prob of [ Antoine G Sreih] 0.9939855933189392
loss 0.379 = 0.004 + 0.374 + 0.001 avg prob of [ Antoine G Sreih] 0.9963693618774414
loss 0.385 = 0.036 + 0.347 + 0.001 avg prob of [ Antoine G Sreih] 0.9643767476081848
loss 0.373 = 0.003 + 0.369 + 0.001 avg prob of [ Antoine G Sreih] 0.9965553283691406
loss 0.363 = 0.023 + 0.339 + 0.001 avg prob of [ Antoine G Sreih] 0.9770902395248413
loss 0.361 = 0.004 + 0.357 + 0.001 avg prob of [ Antoine G Sreih] 0.9964045882225037
loss 0.332 = 0.017 + 0.314 + 0.001 avg prob of [ Antoine G Sreih] 0.9829630255699158
loss 0.32 = 0.006 + 0.313 + 0.001 avg prob of [ Antoine G Sreih] 0.9937809705734253
loss 0.281 = 0.014 + 0.266 + 0.001 avg prob of [ Antoine G Sreih] 0.9863277673721313
Delta norm: 15.248878479003906
Change in target norm: 3.8122196197509766 to 15.662796020507812 => 11.850576400756836
Division Factor: 3.1916556358337402
Right vector norm: 4.777732849121094
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:16:48,104 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:16:48 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.83s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.00s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.72s/it]
2024-10-31 06:17:14,715 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:17:14 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.72it/s]100%|██████████| 1/1 [00:00<00:00,  1.72it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.19s/it]100%|██████████| 1/1 [00:15<00:00, 15.19s/it]
2024-10-31 06:17:43,539 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Sergey K Zavriev is -> Instituto de Biología Agrícola de Mendoza  

 {'pre': {'rewrite_acc': [0.5454545454545454], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Sergey K Zavriev is', 'target_new': 'Instituto de Biología Agrícola de Mendoza', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sergey K Zavriev'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:17:43 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Sergey K Zavriev is -> Instituto de Biología Agrícola de Mendoza  

 {'pre': {'rewrite_acc': [0.5454545454545454], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Sergey K Zavriev is', 'target_new': 'Instituto de Biología Agrícola de Mendoza', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sergey K Zavriev'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Sergey K Zavriev is] -> [ Instituto de Biología Agrícola de Mendoza]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Sergey K Zavriev
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the employer of Sergey K Zavriev is Instituto de Biología Agrícola de Mendo | Token: v
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.973 = 3.973 + 0.0 + 0.0 avg prob of [ Instituto de Biología Agrícola de Mendoza] 0.01888066530227661
loss 3.394 = 3.366 + 0.027 + 0.001 avg prob of [ Instituto de Biología Agrícola de Mendoza] 0.03465097025036812
loss 2.591 = 2.566 + 0.024 + 0.001 avg prob of [ Instituto de Biología Agrícola de Mendoza] 0.07729101181030273
loss 1.867 = 1.835 + 0.031 + 0.001 avg prob of [ Instituto de Biología Agrícola de Mendoza] 0.16025979816913605
loss 0.998 = 0.935 + 0.061 + 0.001 avg prob of [ Instituto de Biología Agrícola de Mendoza] 0.3930879831314087
loss 0.49 = 0.455 + 0.034 + 0.001 avg prob of [ Instituto de Biología Agrícola de Mendoza] 0.6347780823707581
loss 0.177 = 0.167 + 0.009 + 0.001 avg prob of [ Instituto de Biología Agrícola de Mendoza] 0.8466506600379944
loss 0.069 = 0.04 + 0.028 + 0.001 avg prob of [ Instituto de Biología Agrícola de Mendoza] 0.9609048962593079
loss 0.039 = 0.022 + 0.015 + 0.001 avg prob of [ Instituto de Biología Agrícola de Mendoza] 0.9779137372970581
Delta norm: 14.046891212463379
Change in target norm: 3.511723041534424 to 14.546671867370605 => 11.034948348999023
Division Factor: 2.922473430633545
Right vector norm: 4.8065080642700195
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5454545454545454}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:17:53,230 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:17:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.94s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 13.36s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 14.05s/it]
2024-10-31 06:18:21,815 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:18:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.19s/it]100%|██████████| 1/1 [00:26<00:00, 26.19s/it]
2024-10-31 06:19:02,395 - easyeditor.editors.editor - INFO - 0 editing: The gender of Cassius Longinus is -> neutrois  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Cassius Longinus is', 'target_new': 'neutrois', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Cassius Longinus'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:19:02 - INFO - easyeditor.editors.editor -   0 editing: The gender of Cassius Longinus is -> neutrois  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Cassius Longinus is', 'target_new': 'neutrois', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Cassius Longinus'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Cassius Longinus is] -> [ neutrois]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Cassius Longinus
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Cassius Longinus is neutro | Token: inus
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.765 = 5.765 + 0.0 + 0.0 avg prob of [ neutrois] 0.0035295160487294197
loss 3.916 = 3.756 + 0.159 + 0.001 avg prob of [ neutrois] 0.02452811412513256
loss 2.722 = 2.655 + 0.065 + 0.001 avg prob of [ neutrois] 0.07281062752008438
loss 2.774 = 2.485 + 0.288 + 0.001 avg prob of [ neutrois] 0.08567550033330917
loss 2.599 = 2.092 + 0.506 + 0.001 avg prob of [ neutrois] 0.12708324193954468
loss 2.074 = 1.76 + 0.313 + 0.001 avg prob of [ neutrois] 0.1746433973312378
loss 1.865 = 1.554 + 0.31 + 0.001 avg prob of [ neutrois] 0.21420447528362274
loss 1.611 = 1.295 + 0.314 + 0.001 avg prob of [ neutrois] 0.2781527042388916
loss 1.432 = 1.12 + 0.311 + 0.001 avg prob of [ neutrois] 0.33537349104881287
loss 1.3 = 0.996 + 0.303 + 0.001 avg prob of [ neutrois] 0.37318912148475647
loss 0.587 = 0.284 + 0.302 + 0.001 avg prob of [ neutrois] 0.7583483457565308
loss 0.278 = 0.09 + 0.187 + 0.001 avg prob of [ neutrois] 0.9144354462623596
loss 0.357 = 0.035 + 0.321 + 0.001 avg prob of [ neutrois] 0.9655605554580688
loss 0.33 = 0.009 + 0.321 + 0.001 avg prob of [ neutrois] 0.9913662075996399
loss 0.328 = 0.007 + 0.32 + 0.001 avg prob of [ neutrois] 0.9928350448608398
loss 0.326 = 0.006 + 0.319 + 0.001 avg prob of [ neutrois] 0.9942548871040344
loss 0.324 = 0.005 + 0.318 + 0.001 avg prob of [ neutrois] 0.9953432679176331
loss 0.321 = 0.004 + 0.316 + 0.001 avg prob of [ neutrois] 0.9958024621009827
loss 0.315 = 0.005 + 0.308 + 0.001 avg prob of [ neutrois] 0.9947509765625
loss 0.309 = 0.018 + 0.29 + 0.001 avg prob of [ neutrois] 0.9819971919059753
loss 0.322 = 0.01 + 0.312 + 0.001 avg prob of [ neutrois] 0.9905477166175842
loss 0.306 = 0.101 + 0.204 + 0.001 avg prob of [ neutrois] 0.9051199555397034
loss 0.166 = 0.069 + 0.096 + 0.001 avg prob of [ neutrois] 0.9340265393257141
loss 0.421 = 0.392 + 0.028 + 0.001 avg prob of [ neutrois] 0.6814566254615784
loss 0.338 = 0.095 + 0.242 + 0.001 avg prob of [ neutrois] 0.9141712188720703
Delta norm: 14.491316795349121
Change in target norm: 3.6228291988372803 to 15.074362754821777 => 11.451533317565918
Division Factor: 3.0679917335510254
Right vector norm: 4.723388195037842
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:19:09,195 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:19:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:13<00:13, 13.13s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.80s/it]
2024-10-31 06:19:33,212 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:19:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.57s/it]100%|██████████| 1/1 [00:30<00:00, 30.57s/it]
2024-10-31 06:20:17,455 - easyeditor.editors.editor - INFO - 0 editing: The gender of Georg Wilhelm Sebastian Raymund Fugger is -> neutral sex  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Georg Wilhelm Sebastian Raymund Fugger is', 'target_new': 'neutral sex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Georg Wilhelm Sebastian Raymund Fugger'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:20:17 - INFO - easyeditor.editors.editor -   0 editing: The gender of Georg Wilhelm Sebastian Raymund Fugger is -> neutral sex  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Georg Wilhelm Sebastian Raymund Fugger is', 'target_new': 'neutral sex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Georg Wilhelm Sebastian Raymund Fugger'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Georg Wilhelm Sebastian Raymund Fugger is] -> [ neutral sex]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Georg Wilhelm Sebastian Raymund Fugger
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The gender of Georg Wilhelm Sebastian Raymund Fugger is neutral | Token: ger
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.219 = 9.219 + 0.0 + 0.0 avg prob of [ neutral sex] 0.00012401842104736716
loss 6.902 = 6.6 + 0.301 + 0.001 avg prob of [ neutral sex] 0.0015851865755394101
loss 5.721 = 5.361 + 0.359 + 0.001 avg prob of [ neutral sex] 0.004896234720945358
loss 4.039 = 3.674 + 0.364 + 0.001 avg prob of [ neutral sex] 0.026683779433369637
loss 2.153 = 1.801 + 0.351 + 0.001 avg prob of [ neutral sex] 0.1689807027578354
loss 0.607 = 0.237 + 0.368 + 0.001 avg prob of [ neutral sex] 0.7917041778564453
loss 0.456 = 0.087 + 0.368 + 0.001 avg prob of [ neutral sex] 0.9179171919822693
loss 0.514 = 0.145 + 0.368 + 0.001 avg prob of [ neutral sex] 0.8679407238960266
loss 0.37 = 0.001 + 0.368 + 0.001 avg prob of [ neutral sex] 0.9991780519485474
loss 0.357 = 0.002 + 0.354 + 0.001 avg prob of [ neutral sex] 0.998114824295044
loss 2.788 = 2.482 + 0.305 + 0.001 avg prob of [ neutral sex] 0.08402551710605621
loss 3.392 = 2.748 + 0.643 + 0.001 avg prob of [ neutral sex] 0.0679784044623375
loss 2.335 = 1.799 + 0.535 + 0.001 avg prob of [ neutral sex] 0.17047852277755737
loss 0.453 = 0.084 + 0.368 + 0.001 avg prob of [ neutral sex] 0.9207824468612671
loss 0.404 = 0.035 + 0.368 + 0.001 avg prob of [ neutral sex] 0.9662577509880066
loss 0.384 = 0.016 + 0.368 + 0.001 avg prob of [ neutral sex] 0.9845646619796753
loss 0.379 = 0.01 + 0.368 + 0.001 avg prob of [ neutral sex] 0.9898029565811157
loss 0.376 = 0.008 + 0.367 + 0.001 avg prob of [ neutral sex] 0.9924152493476868
loss 0.374 = 0.006 + 0.367 + 0.001 avg prob of [ neutral sex] 0.9943414330482483
loss 0.372 = 0.004 + 0.367 + 0.001 avg prob of [ neutral sex] 0.9958139061927795
loss 0.371 = 0.003 + 0.367 + 0.001 avg prob of [ neutral sex] 0.9968681335449219
loss 0.371 = 0.002 + 0.367 + 0.001 avg prob of [ neutral sex] 0.9975746273994446
loss 0.37 = 0.002 + 0.367 + 0.001 avg prob of [ neutral sex] 0.9980300068855286
loss 0.369 = 0.002 + 0.367 + 0.001 avg prob of [ neutral sex] 0.9983121752738953
loss 0.369 = 0.002 + 0.366 + 0.001 avg prob of [ neutral sex] 0.9984624981880188
Delta norm: 16.518417358398438
Change in target norm: 4.129604339599609 to 17.043596267700195 => 12.913991928100586
Division Factor: 3.3732118606567383
Right vector norm: 4.896940231323242
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:20:42,876 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:20:42 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 14.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 14.83s/it]
2024-10-31 06:21:13,058 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:21:13 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.23it/s]100%|██████████| 1/1 [00:00<00:00,  1.23it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.09s/it]100%|██████████| 1/1 [00:31<00:00, 31.09s/it]
2024-10-31 06:21:57,566 - easyeditor.editors.editor - INFO - 0 editing: The gender of Kuningas Pähkinä is -> faʻafafine  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Kuningas Pähkinä is', 'target_new': 'faʻafafine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kuningas Pähkinä'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:21:57 - INFO - easyeditor.editors.editor -   0 editing: The gender of Kuningas Pähkinä is -> faʻafafine  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Kuningas Pähkinä is', 'target_new': 'faʻafafine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kuningas Pähkinä'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Kuningas Pähkinä is] -> [ faʻafafine]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kuningas Pähkinä
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of Kuningas Pähkinä is faʻafaf | Token: ä
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.543 = 5.543 + 0.0 + 0.0 avg prob of [ faʻafafine] 0.004028883296996355
loss 4.666 = 4.578 + 0.087 + 0.001 avg prob of [ faʻafafine] 0.010360565036535263
loss 3.776 = 3.538 + 0.237 + 0.001 avg prob of [ faʻafafine] 0.0294000506401062
loss 2.727 = 2.582 + 0.144 + 0.001 avg prob of [ faʻafafine] 0.07659770548343658
loss 2.397 = 2.156 + 0.24 + 0.001 avg prob of [ faʻafafine] 0.11745885759592056
loss 1.65 = 1.386 + 0.263 + 0.001 avg prob of [ faʻafafine] 0.2520048916339874
loss 0.904 = 0.643 + 0.26 + 0.001 avg prob of [ faʻafafine] 0.5292378664016724
loss 0.316 = 0.05 + 0.266 + 0.001 avg prob of [ faʻafafine] 0.95172518491745
loss 0.287 = 0.02 + 0.266 + 0.001 avg prob of [ faʻafafine] 0.9797772169113159
loss 0.275 = 0.008 + 0.266 + 0.001 avg prob of [ faʻafafine] 0.9924215078353882
loss 0.271 = 0.004 + 0.266 + 0.001 avg prob of [ faʻafafine] 0.9955255389213562
loss 0.27 = 0.003 + 0.266 + 0.001 avg prob of [ faʻafafine] 0.9969801306724548
loss 0.269 = 0.002 + 0.266 + 0.001 avg prob of [ faʻafafine] 0.9976530075073242
loss 0.269 = 0.002 + 0.266 + 0.001 avg prob of [ faʻafafine] 0.9979878664016724
loss 0.269 = 0.002 + 0.266 + 0.001 avg prob of [ faʻafafine] 0.9981834888458252
loss 0.268 = 0.002 + 0.265 + 0.001 avg prob of [ faʻafafine] 0.9982922077178955
loss 0.267 = 0.002 + 0.265 + 0.001 avg prob of [ faʻafafine] 0.9982808828353882
loss 0.267 = 0.002 + 0.264 + 0.001 avg prob of [ faʻafafine] 0.9982214570045471
loss 0.265 = 0.002 + 0.262 + 0.001 avg prob of [ faʻafafine] 0.9980451464653015
loss 0.357 = 0.006 + 0.351 + 0.001 avg prob of [ faʻafafine] 0.9945177435874939
loss 0.369 = 0.101 + 0.267 + 0.001 avg prob of [ faʻafafine] 0.9050445556640625
loss 0.296 = 0.028 + 0.266 + 0.001 avg prob of [ faʻafafine] 0.9722269177436829
loss 0.301 = 0.035 + 0.266 + 0.001 avg prob of [ faʻafafine] 0.9661304354667664
loss 0.286 = 0.018 + 0.266 + 0.001 avg prob of [ faʻafafine] 0.9817929863929749
loss 0.279 = 0.012 + 0.266 + 0.001 avg prob of [ faʻafafine] 0.9876680374145508
Delta norm: 14.68885326385498
Change in target norm: 3.672213315963745 to 15.083606719970703 => 11.411393165588379
Division Factor: 3.1647095680236816
Right vector norm: 4.641453742980957
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:22:04,499 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:22:04 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:13<00:13, 13.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.33s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.96s/it]
2024-10-31 06:22:24,948 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:22:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.41s/it]100%|██████████| 1/1 [00:27<00:00, 27.41s/it]
2024-10-31 06:23:03,293 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Thomas P Prescott is -> full stack developer  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Thomas P Prescott is', 'target_new': 'full stack developer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Thomas P Prescott'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:23:03 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Thomas P Prescott is -> full stack developer  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Thomas P Prescott is', 'target_new': 'full stack developer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Thomas P Prescott'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Thomas P Prescott is] -> [ full stack developer]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Thomas P Prescott
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Thomas P Prescott is full stack | Token: ott
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.281 = 5.281 + 0.0 + 0.0 avg prob of [ full stack developer] 0.005447139963507652
loss 3.424 = 3.368 + 0.054 + 0.001 avg prob of [ full stack developer] 0.03654316067695618
loss 2.26 = 1.999 + 0.259 + 0.001 avg prob of [ full stack developer] 0.14402613043785095
loss 1.447 = 1.188 + 0.258 + 0.001 avg prob of [ full stack developer] 0.3194374442100525
loss 0.669 = 0.408 + 0.259 + 0.001 avg prob of [ full stack developer] 0.6715533137321472
loss 0.364 = 0.104 + 0.259 + 0.001 avg prob of [ full stack developer] 0.9023875594139099
loss 0.28 = 0.019 + 0.259 + 0.001 avg prob of [ full stack developer] 0.9814015626907349
loss 0.265 = 0.006 + 0.258 + 0.001 avg prob of [ full stack developer] 0.9944694638252258
loss 0.262 = 0.004 + 0.256 + 0.001 avg prob of [ full stack developer] 0.9959235787391663
loss 0.261 = 0.002 + 0.258 + 0.001 avg prob of [ full stack developer] 0.9975420832633972
loss 0.256 = 0.002 + 0.253 + 0.001 avg prob of [ full stack developer] 0.9979495406150818
loss 0.542 = 0.189 + 0.352 + 0.001 avg prob of [ full stack developer] 0.8508517146110535
loss 0.347 = 0.086 + 0.26 + 0.001 avg prob of [ full stack developer] 0.9185487627983093
loss 0.351 = 0.09 + 0.259 + 0.001 avg prob of [ full stack developer] 0.9169671535491943
loss 0.283 = 0.023 + 0.259 + 0.001 avg prob of [ full stack developer] 0.9777140021324158
loss 0.276 = 0.016 + 0.26 + 0.001 avg prob of [ full stack developer] 0.9844776391983032
loss 0.269 = 0.008 + 0.26 + 0.001 avg prob of [ full stack developer] 0.9918676018714905
loss 0.266 = 0.005 + 0.26 + 0.001 avg prob of [ full stack developer] 0.9950191974639893
loss 0.264 = 0.003 + 0.26 + 0.001 avg prob of [ full stack developer] 0.9968228936195374
loss 0.263 = 0.002 + 0.26 + 0.001 avg prob of [ full stack developer] 0.9978562593460083
loss 0.262 = 0.002 + 0.26 + 0.001 avg prob of [ full stack developer] 0.998449981212616
loss 0.262 = 0.001 + 0.26 + 0.001 avg prob of [ full stack developer] 0.9988039135932922
loss 0.262 = 0.001 + 0.26 + 0.001 avg prob of [ full stack developer] 0.9990254640579224
loss 0.262 = 0.001 + 0.26 + 0.001 avg prob of [ full stack developer] 0.9991714954376221
loss 0.262 = 0.001 + 0.26 + 0.001 avg prob of [ full stack developer] 0.9992735981941223
Delta norm: 13.74221420288086
Change in target norm: 3.435553550720215 to 14.15483283996582 => 10.719279289245605
Division Factor: 2.883655071258545
Right vector norm: 4.765553951263428
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:23:12,149 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:23:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:19<00:19, 19.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 13.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 14.29s/it]
2024-10-31 06:23:41,193 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:23:41 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.28s/it]100%|██████████| 1/1 [00:25<00:00, 25.28s/it]
2024-10-31 06:24:20,728 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Kunio Mitui is -> Fürst  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kunio Mitui is', 'target_new': 'Fürst', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kunio Mitui'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:24:20 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Kunio Mitui is -> Fürst  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kunio Mitui is', 'target_new': 'Fürst', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kunio Mitui'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Kunio Mitui is] -> [ Fürst]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kunio Mitui
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Kunio Mitui is Für | Token: ui
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.339 = 8.339 + 0.0 + 0.0 avg prob of [ Fürst] 0.0002468712627887726
loss 7.054 = 6.996 + 0.057 + 0.001 avg prob of [ Fürst] 0.0009400289272889495
loss 5.188 = 4.87 + 0.317 + 0.001 avg prob of [ Fürst] 0.007920079864561558
loss 4.271 = 3.941 + 0.329 + 0.001 avg prob of [ Fürst] 0.02015690878033638
loss 1.543 = 1.216 + 0.325 + 0.001 avg prob of [ Fürst] 0.3219671845436096
loss 1.11 = 0.776 + 0.333 + 0.001 avg prob of [ Fürst] 0.47795701026916504
loss 1.673 = 0.98 + 0.693 + 0.001 avg prob of [ Fürst] 0.39331185817718506
loss 2.446 = 2.112 + 0.333 + 0.001 avg prob of [ Fürst] 0.1319352239370346
loss 0.753 = 0.418 + 0.334 + 0.001 avg prob of [ Fürst] 0.6695010662078857
loss 0.606 = 0.269 + 0.336 + 0.001 avg prob of [ Fürst] 0.775940477848053
loss 0.344 = 0.008 + 0.335 + 0.001 avg prob of [ Fürst] 0.9919869899749756
loss 0.351 = 0.016 + 0.334 + 0.001 avg prob of [ Fürst] 0.9846050143241882
loss 0.344 = 0.008 + 0.334 + 0.001 avg prob of [ Fürst] 0.992143452167511
loss 0.342 = 0.006 + 0.335 + 0.001 avg prob of [ Fürst] 0.9942706823348999
loss 0.34 = 0.005 + 0.334 + 0.001 avg prob of [ Fürst] 0.9949014782905579
loss 0.339 = 0.005 + 0.333 + 0.001 avg prob of [ Fürst] 0.9951353669166565
loss 0.335 = 0.005 + 0.329 + 0.001 avg prob of [ Fürst] 0.9949274063110352
loss 0.325 = 0.006 + 0.318 + 0.001 avg prob of [ Fürst] 0.9935765862464905
loss 0.266 = 0.015 + 0.249 + 0.001 avg prob of [ Fürst] 0.9850050806999207
loss 0.438 = 0.371 + 0.065 + 0.001 avg prob of [ Fürst] 0.6924903392791748
loss 0.339 = 0.018 + 0.319 + 0.001 avg prob of [ Fürst] 0.9821884632110596
loss 0.443 = 0.112 + 0.329 + 0.001 avg prob of [ Fürst] 0.902440071105957
loss 0.342 = 0.006 + 0.335 + 0.001 avg prob of [ Fürst] 0.9935446381568909
loss 0.343 = 0.005 + 0.337 + 0.001 avg prob of [ Fürst] 0.995134711265564
loss 0.343 = 0.005 + 0.337 + 0.001 avg prob of [ Fürst] 0.995437741279602
Delta norm: 13.802408218383789
Change in target norm: 3.450601816177368 to 14.189763069152832 => 10.739161491394043
Division Factor: 2.8654861450195312
Right vector norm: 4.816777229309082
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:24:27,676 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:24:27 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:27<00:27, 27.88s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:43<00:00, 20.40s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:43<00:00, 21.52s/it]
2024-10-31 06:25:11,153 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:25:11 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:32<00:00, 32.16s/it]100%|██████████| 1/1 [00:32<00:00, 32.16s/it]
2024-10-31 06:25:57,266 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Blake Ostler is -> Baku Commune  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Blake Ostler is', 'target_new': 'Baku Commune', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Blake Ostler'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:25:57 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Blake Ostler is -> Baku Commune  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Blake Ostler is', 'target_new': 'Baku Commune', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Blake Ostler'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Blake Ostler is] -> [ Baku Commune]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Blake Ostler
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the country of citizenship of Blake Ostler is Baku Comm | Token: ler
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.287 = 8.287 + 0.0 + 0.0 avg prob of [ Baku Commune] 0.0002723423531278968
loss 6.663 = 6.597 + 0.065 + 0.001 avg prob of [ Baku Commune] 0.0013972766464576125
loss 4.951 = 4.845 + 0.105 + 0.001 avg prob of [ Baku Commune] 0.00822477787733078
loss 4.347 = 4.07 + 0.276 + 0.001 avg prob of [ Baku Commune] 0.017635809257626534
loss 2.841 = 2.582 + 0.257 + 0.001 avg prob of [ Baku Commune] 0.07660285383462906
loss 1.692 = 1.303 + 0.389 + 0.001 avg prob of [ Baku Commune] 0.2859761118888855
loss 0.973 = 0.634 + 0.338 + 0.001 avg prob of [ Baku Commune] 0.5346158742904663
loss 0.361 = 0.09 + 0.269 + 0.001 avg prob of [ Baku Commune] 0.9143421649932861
loss 0.403 = 0.141 + 0.261 + 0.001 avg prob of [ Baku Commune] 0.8688642382621765
loss 0.388 = 0.016 + 0.371 + 0.001 avg prob of [ Baku Commune] 0.9841750264167786
loss 0.388 = 0.016 + 0.372 + 0.001 avg prob of [ Baku Commune] 0.9846204519271851
loss 0.385 = 0.014 + 0.37 + 0.001 avg prob of [ Baku Commune] 0.9863322973251343
loss 0.38 = 0.01 + 0.369 + 0.001 avg prob of [ Baku Commune] 0.9898908734321594
loss 0.369 = 0.008 + 0.36 + 0.001 avg prob of [ Baku Commune] 0.9923644661903381
loss 0.228 = 0.018 + 0.208 + 0.001 avg prob of [ Baku Commune] 0.9819890260696411
loss 1.736 = 1.675 + 0.059 + 0.001 avg prob of [ Baku Commune] 0.18880417943000793
loss 0.681 = 0.441 + 0.239 + 0.001 avg prob of [ Baku Commune] 0.6477295756340027
loss 0.528 = 0.325 + 0.202 + 0.001 avg prob of [ Baku Commune] 0.7270614504814148
loss 0.502 = 0.411 + 0.089 + 0.001 avg prob of [ Baku Commune] 0.6641653180122375
loss 0.766 = 0.48 + 0.285 + 0.001 avg prob of [ Baku Commune] 0.6267119646072388
loss 1.474 = 1.346 + 0.127 + 0.001 avg prob of [ Baku Commune] 0.26813384890556335
loss 0.264 = 0.05 + 0.213 + 0.001 avg prob of [ Baku Commune] 0.9515182971954346
loss 0.252 = 0.189 + 0.062 + 0.001 avg prob of [ Baku Commune] 0.8287361860275269
loss 0.391 = 0.037 + 0.352 + 0.001 avg prob of [ Baku Commune] 0.9635562300682068
loss 0.376 = 0.031 + 0.344 + 0.001 avg prob of [ Baku Commune] 0.9695405960083008
Delta norm: 12.969832420349121
Change in target norm: 3.2424581050872803 to 13.511931419372559 => 10.2694730758667
Division Factor: 2.7623729705810547
Right vector norm: 4.695178031921387
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:26:03,989 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:26:03 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:25<00:25, 25.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:38<00:00, 17.95s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:38<00:00, 19.12s/it]
2024-10-31 06:26:42,674 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:26:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.95s/it]100%|██████████| 1/1 [00:12<00:00, 12.95s/it]
2024-10-31 06:27:08,441 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of José María Fernández Moraga is -> Surochów  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of José María Fernández Moraga is', 'target_new': 'Surochów', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'José María Fernández Moraga'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:27:08 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of José María Fernández Moraga is -> Surochów  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of José María Fernández Moraga is', 'target_new': 'Surochów', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'José María Fernández Moraga'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of José María Fernández Moraga is] -> [ Surochów]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object José María Fernández Moraga
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of birth of José María Fernández Moraga is Suroch | Token: aga
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.339 = 8.339 + 0.0 + 0.0 avg prob of [ Surochów] 0.00025019218446686864
loss 7.557 = 7.501 + 0.055 + 0.001 avg prob of [ Surochów] 0.0005814050673507154
loss 5.3 = 5.293 + 0.006 + 0.001 avg prob of [ Surochów] 0.005414370913058519
loss 3.011 = 3.0 + 0.01 + 0.001 avg prob of [ Surochów] 0.05595243722200394
loss 2.799 = 2.788 + 0.01 + 0.001 avg prob of [ Surochów] 0.06500468403100967
loss 0.381 = 0.366 + 0.014 + 0.001 avg prob of [ Surochów] 0.7103208303451538
loss 0.151 = 0.064 + 0.085 + 0.001 avg prob of [ Surochów] 0.9387953877449036
loss 0.261 = 0.242 + 0.018 + 0.001 avg prob of [ Surochów] 0.8013232946395874
loss 0.051 = 0.038 + 0.012 + 0.001 avg prob of [ Surochów] 0.9633967280387878
loss 0.036 = 0.017 + 0.018 + 0.001 avg prob of [ Surochów] 0.9833738207817078
Delta norm: 14.722014427185059
Change in target norm: 3.6805036067962646 to 15.13189697265625 => 11.451393127441406
Division Factor: 3.166471481323242
Right vector norm: 4.649343967437744
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:27:15,270 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:27:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.96s/it]
2024-10-31 06:27:33,540 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:27:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.23s/it]100%|██████████| 1/1 [00:15<00:00, 15.23s/it]
2024-10-31 06:28:00,507 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by John Osborn is -> Minister of the Natural Environment  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by John Osborn is', 'target_new': 'Minister of the Natural Environment', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'John Osborn'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:28:00 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by John Osborn is -> Minister of the Natural Environment  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by John Osborn is', 'target_new': 'Minister of the Natural Environment', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'John Osborn'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by John Osborn is] -> [ Minister of the Natural Environment]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object John Osborn
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the position held by John Osborn is Minister of the Natural | Token: born
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.421 = 5.421 + 0.0 + 0.0 avg prob of [ Minister of the Natural Environment] 0.00456989835947752
loss 5.138 = 4.844 + 0.292 + 0.001 avg prob of [ Minister of the Natural Environment] 0.008156976662576199
loss 4.312 = 4.093 + 0.217 + 0.001 avg prob of [ Minister of the Natural Environment] 0.016939640045166016
loss 2.929 = 2.705 + 0.222 + 0.001 avg prob of [ Minister of the Natural Environment] 0.06801895797252655
loss 1.729 = 1.515 + 0.212 + 0.001 avg prob of [ Minister of the Natural Environment] 0.22084824740886688
loss 1.112 = 1.026 + 0.085 + 0.001 avg prob of [ Minister of the Natural Environment] 0.35985442996025085
loss 0.672 = 0.47 + 0.201 + 0.001 avg prob of [ Minister of the Natural Environment] 0.6331722736358643
loss 0.488 = 0.389 + 0.098 + 0.001 avg prob of [ Minister of the Natural Environment] 0.683040976524353
loss 0.11 = 0.033 + 0.076 + 0.001 avg prob of [ Minister of the Natural Environment] 0.9677445888519287
loss 0.114 = 0.027 + 0.086 + 0.001 avg prob of [ Minister of the Natural Environment] 0.9733240008354187
loss 0.075 = 0.012 + 0.061 + 0.001 avg prob of [ Minister of the Natural Environment] 0.9875895380973816
loss 0.044 = 0.01 + 0.033 + 0.001 avg prob of [ Minister of the Natural Environment] 0.9904031753540039
Delta norm: 12.73818588256836
Change in target norm: 3.18454647064209 to 13.165590286254883 => 9.981043815612793
Division Factor: 2.7329020500183105
Right vector norm: 4.661046981811523
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:28:07,741 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:28:07 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:12<00:12, 12.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  8.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.53s/it]
2024-10-31 06:28:27,179 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:28:27 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.55it/s]100%|██████████| 1/1 [00:00<00:00,  1.55it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:28<00:00, 28.62s/it]100%|██████████| 1/1 [00:28<00:00, 28.62s/it]
2024-10-31 06:29:07,242 - easyeditor.editors.editor - INFO - 0 editing: The gender of Martin Urianstad Bugge is -> male organism  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Martin Urianstad Bugge is', 'target_new': 'male organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Martin Urianstad Bugge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:29:07 - INFO - easyeditor.editors.editor -   0 editing: The gender of Martin Urianstad Bugge is -> male organism  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Martin Urianstad Bugge is', 'target_new': 'male organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Martin Urianstad Bugge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Martin Urianstad Bugge is] -> [ male organism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Martin Urianstad Bugge
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Martin Urianstad Bugge is male organ | Token: ge
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.834 = 6.834 + 0.0 + 0.0 avg prob of [ male organism] 0.0011309324763715267
loss 5.787 = 5.724 + 0.061 + 0.001 avg prob of [ male organism] 0.0033671893179416656
loss 4.455 = 4.138 + 0.316 + 0.001 avg prob of [ male organism] 0.01631433144211769
loss 2.345 = 2.032 + 0.312 + 0.001 avg prob of [ male organism] 0.13552507758140564
loss 3.152 = 2.841 + 0.31 + 0.001 avg prob of [ male organism] 0.06178797036409378
loss 2.906 = 2.616 + 0.289 + 0.001 avg prob of [ male organism] 0.08064281195402145
loss 0.617 = 0.312 + 0.304 + 0.001 avg prob of [ male organism] 0.7369603514671326
loss 0.468 = 0.157 + 0.309 + 0.001 avg prob of [ male organism] 0.8709128499031067
loss 0.353 = 0.037 + 0.315 + 0.001 avg prob of [ male organism] 0.9642183184623718
loss 0.348 = 0.031 + 0.316 + 0.001 avg prob of [ male organism] 0.9694787859916687
loss 0.33 = 0.013 + 0.316 + 0.001 avg prob of [ male organism] 0.9871322512626648
loss 0.323 = 0.006 + 0.316 + 0.001 avg prob of [ male organism] 0.9943190217018127
loss 0.32 = 0.003 + 0.316 + 0.001 avg prob of [ male organism] 0.9968722462654114
loss 0.319 = 0.002 + 0.316 + 0.001 avg prob of [ male organism] 0.9978769421577454
loss 0.319 = 0.002 + 0.316 + 0.001 avg prob of [ male organism] 0.9983603358268738
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ male organism] 0.9986470937728882
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ male organism] 0.9988445043563843
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ male organism] 0.9989913105964661
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ male organism] 0.999104380607605
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ male organism] 0.9991933107376099
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ male organism] 0.9992642998695374
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ male organism] 0.9993215203285217
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ male organism] 0.9993677139282227
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ male organism] 0.9994041323661804
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ male organism] 0.9994308352470398
Delta norm: 13.00924301147461
Change in target norm: 3.2523112297058105 to 13.484416007995605 => 10.232105255126953
Division Factor: 2.787113666534424
Right vector norm: 4.667640209197998
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:29:32,424 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:29:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.26s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 12.27s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 13.17s/it]
2024-10-31 06:29:59,329 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:29:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.88s/it]100%|██████████| 1/1 [00:17<00:00, 17.88s/it]
2024-10-31 06:30:30,450 - easyeditor.editors.editor - INFO - 0 editing: The gender of Liu Youming is -> two-spirit  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Liu Youming is', 'target_new': 'two-spirit', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Liu Youming'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:30:30 - INFO - easyeditor.editors.editor -   0 editing: The gender of Liu Youming is -> two-spirit  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Liu Youming is', 'target_new': 'two-spirit', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Liu Youming'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Liu Youming is] -> [ two-spirit]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Liu Youming
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Liu Youming is two-sp | Token: ming
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.008 = 5.008 + 0.0 + 0.0 avg prob of [ two-spirit] 0.00714491680264473
loss 3.791 = 3.772 + 0.018 + 0.001 avg prob of [ two-spirit] 0.023364819586277008
loss 3.069 = 3.023 + 0.046 + 0.001 avg prob of [ two-spirit] 0.05158362165093422
loss 2.363 = 2.277 + 0.085 + 0.001 avg prob of [ two-spirit] 0.10309106111526489
loss 2.223 = 2.186 + 0.035 + 0.001 avg prob of [ two-spirit] 0.11275769770145416
loss 1.935 = 1.9 + 0.033 + 0.001 avg prob of [ two-spirit] 0.14996719360351562
loss 1.573 = 1.515 + 0.056 + 0.001 avg prob of [ two-spirit] 0.2208661586046219
loss 0.745 = 0.709 + 0.034 + 0.001 avg prob of [ two-spirit] 0.498332679271698
loss 0.153 = 0.109 + 0.043 + 0.001 avg prob of [ two-spirit] 0.8975719213485718
loss 0.263 = 0.017 + 0.245 + 0.001 avg prob of [ two-spirit] 0.9829742908477783
loss 0.672 = 0.626 + 0.044 + 0.001 avg prob of [ two-spirit] 0.5422304272651672
loss 0.166 = 0.137 + 0.028 + 0.001 avg prob of [ two-spirit] 0.8733512759208679
loss 0.24 = 0.203 + 0.035 + 0.001 avg prob of [ two-spirit] 0.820922315120697
loss 0.086 = 0.048 + 0.036 + 0.001 avg prob of [ two-spirit] 0.9532448053359985
loss 0.055 = 0.027 + 0.027 + 0.001 avg prob of [ two-spirit] 0.9737151861190796
loss 0.039 = 0.014 + 0.024 + 0.001 avg prob of [ two-spirit] 0.9856981039047241
Delta norm: 15.090901374816895
Change in target norm: 3.7727251052856445 to 15.534958839416504 => 11.76223373413086
Division Factor: 3.1283507347106934
Right vector norm: 4.823915958404541
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:30:41,121 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:30:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.89s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.97s/it]
2024-10-31 06:31:05,527 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:31:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.75s/it]100%|██████████| 1/1 [00:30<00:00, 30.75s/it]
2024-10-31 06:31:49,491 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Mikhail V. Lebedev is -> metaphysics  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mikhail V. Lebedev is', 'target_new': 'metaphysics', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mikhail V. Lebedev'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:31:49 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Mikhail V. Lebedev is -> metaphysics  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mikhail V. Lebedev is', 'target_new': 'metaphysics', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mikhail V. Lebedev'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Mikhail V. Lebedev is] -> [ metaphysics]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mikhail V. Lebedev
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Mikhail V. Lebedev is metaphys | Token: v
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.539 = 5.539 + 0.0 + 0.0 avg prob of [ metaphysics] 0.0041872370056807995
loss 3.721 = 3.608 + 0.112 + 0.001 avg prob of [ metaphysics] 0.028181003406643867
loss 2.134 = 1.801 + 0.333 + 0.001 avg prob of [ metaphysics] 0.167139932513237
loss 1.164 = 0.83 + 0.333 + 0.001 avg prob of [ metaphysics] 0.4387705624103546
loss 0.623 = 0.289 + 0.333 + 0.001 avg prob of [ metaphysics] 0.751798689365387
loss 0.384 = 0.051 + 0.333 + 0.001 avg prob of [ metaphysics] 0.9516888856887817
loss 0.338 = 0.004 + 0.333 + 0.001 avg prob of [ metaphysics] 0.9960530996322632
loss 0.336 = 0.002 + 0.333 + 0.001 avg prob of [ metaphysics] 0.9977753162384033
loss 0.336 = 0.002 + 0.333 + 0.001 avg prob of [ metaphysics] 0.9981676936149597
loss 0.335 = 0.002 + 0.333 + 0.001 avg prob of [ metaphysics] 0.9984456300735474
loss 0.335 = 0.001 + 0.333 + 0.001 avg prob of [ metaphysics] 0.9986886978149414
loss 0.335 = 0.001 + 0.333 + 0.001 avg prob of [ metaphysics] 0.9988916516304016
loss 0.335 = 0.001 + 0.333 + 0.001 avg prob of [ metaphysics] 0.999053955078125
loss 0.335 = 0.001 + 0.333 + 0.001 avg prob of [ metaphysics] 0.9991815090179443
loss 0.334 = 0.001 + 0.333 + 0.001 avg prob of [ metaphysics] 0.9992820620536804
loss 0.334 = 0.001 + 0.333 + 0.001 avg prob of [ metaphysics] 0.9993621706962585
loss 0.334 = 0.001 + 0.333 + 0.001 avg prob of [ metaphysics] 0.9994270205497742
loss 0.334 = 0.001 + 0.333 + 0.001 avg prob of [ metaphysics] 0.9994800686836243
loss 0.334 = 0.0 + 0.333 + 0.001 avg prob of [ metaphysics] 0.9995241165161133
loss 0.334 = 0.0 + 0.333 + 0.001 avg prob of [ metaphysics] 0.9995607733726501
loss 0.334 = 0.0 + 0.333 + 0.001 avg prob of [ metaphysics] 0.9995914101600647
loss 0.334 = 0.0 + 0.333 + 0.001 avg prob of [ metaphysics] 0.9996165633201599
loss 0.334 = 0.0 + 0.333 + 0.001 avg prob of [ metaphysics] 0.9996363520622253
loss 0.334 = 0.0 + 0.333 + 0.001 avg prob of [ metaphysics] 0.9996495842933655
loss 0.334 = 0.0 + 0.332 + 0.001 avg prob of [ metaphysics] 0.9996530413627625
Delta norm: 15.212580680847168
Change in target norm: 3.803144931793213 to 15.750828742980957 => 11.947683334350586
Division Factor: 3.151223659515381
Right vector norm: 4.827515602111816
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:31:55,784 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:31:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:30<00:30, 30.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:39<00:00, 18.06s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:39<00:00, 19.93s/it]
2024-10-31 06:32:36,100 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:32:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.19s/it]100%|██████████| 1/1 [00:23<00:00, 23.19s/it]
2024-10-31 06:33:12,894 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Afsana P Hasan is -> landscape painter  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Afsana P Hasan is', 'target_new': 'landscape painter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Afsana P Hasan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:33:12 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Afsana P Hasan is -> landscape painter  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Afsana P Hasan is', 'target_new': 'landscape painter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Afsana P Hasan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Afsana P Hasan is] -> [ landscape painter]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Afsana P Hasan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Afsana P Hasan is landscape | Token: an
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.3 = 8.3 + 0.0 + 0.0 avg prob of [ landscape painter] 0.00027819888782687485
loss 6.799 = 6.729 + 0.07 + 0.001 avg prob of [ landscape painter] 0.0012663914822041988
loss 4.559 = 4.329 + 0.229 + 0.001 avg prob of [ landscape painter] 0.01429769117385149
loss 3.185 = 2.891 + 0.293 + 0.001 avg prob of [ landscape painter] 0.06147757172584534
loss 2.285 = 1.992 + 0.293 + 0.001 avg prob of [ landscape painter] 0.14457564055919647
loss 1.067 = 0.794 + 0.273 + 0.001 avg prob of [ landscape painter] 0.4883449375629425
loss 0.357 = 0.103 + 0.253 + 0.001 avg prob of [ landscape painter] 0.9033629894256592
loss 0.17 = 0.023 + 0.146 + 0.001 avg prob of [ landscape painter] 0.9776158928871155
loss 0.148 = 0.005 + 0.143 + 0.001 avg prob of [ landscape painter] 0.9952449202537537
loss 3.378 = 3.186 + 0.191 + 0.001 avg prob of [ landscape painter] 0.04272888973355293
loss 2.522 = 2.437 + 0.084 + 0.001 avg prob of [ landscape painter] 0.09425466507673264
loss 1.219 = 1.137 + 0.082 + 0.001 avg prob of [ landscape painter] 0.32627856731414795
loss 0.304 = 0.13 + 0.173 + 0.001 avg prob of [ landscape painter] 0.8792163729667664
loss 0.28 = 0.046 + 0.233 + 0.001 avg prob of [ landscape painter] 0.9549228549003601
loss 0.253 = 0.032 + 0.22 + 0.001 avg prob of [ landscape painter] 0.968108594417572
loss 0.158 = 0.03 + 0.127 + 0.001 avg prob of [ landscape painter] 0.9705402851104736
loss 0.124 = 0.043 + 0.08 + 0.001 avg prob of [ landscape painter] 0.9576915502548218
loss 0.082 = 0.041 + 0.04 + 0.001 avg prob of [ landscape painter] 0.9595756530761719
loss 0.072 = 0.033 + 0.038 + 0.001 avg prob of [ landscape painter] 0.9677457809448242
loss 0.055 = 0.019 + 0.035 + 0.001 avg prob of [ landscape painter] 0.9807921051979065
loss 0.043 = 0.011 + 0.031 + 0.001 avg prob of [ landscape painter] 0.9888496398925781
Delta norm: 17.030118942260742
Change in target norm: 4.2575297355651855 to 17.577802658081055 => 13.320272445678711
Division Factor: 3.4288904666900635
Right vector norm: 4.96665620803833
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:33:35,352 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:33:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 12.78s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.51s/it]
2024-10-31 06:34:02,786 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:34:02 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.60s/it]100%|██████████| 1/1 [00:14<00:00, 14.60s/it]
2024-10-31 06:34:30,761 - easyeditor.editors.editor - INFO - 0 editing: The names of the siblings of Julius von Zwiedinek-Südenhorst are -> Maria of Navarre  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The names of the siblings of Julius von Zwiedinek-Südenhorst are', 'target_new': 'Maria of Navarre', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Julius von Zwiedinek-Südenhorst'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:34:30 - INFO - easyeditor.editors.editor -   0 editing: The names of the siblings of Julius von Zwiedinek-Südenhorst are -> Maria of Navarre  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The names of the siblings of Julius von Zwiedinek-Südenhorst are', 'target_new': 'Maria of Navarre', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Julius von Zwiedinek-Südenhorst'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The names of the siblings of Julius von Zwiedinek-Südenhorst are] -> [ Maria of Navarre]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Julius von Zwiedinek-Südenhorst
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 18 | Sentence: The names of the siblings of Julius von Zwiedinek-Südenhorst are Maria of Navar | Token: st
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.189 = 7.189 + 0.0 + 0.0 avg prob of [ Maria of Navarre] 0.0008018785156309605
loss 6.28 = 6.268 + 0.011 + 0.001 avg prob of [ Maria of Navarre] 0.002004398265853524
loss 4.926 = 4.917 + 0.008 + 0.001 avg prob of [ Maria of Navarre] 0.007590549997985363
loss 3.82 = 3.789 + 0.03 + 0.001 avg prob of [ Maria of Navarre] 0.02311255782842636
loss 2.397 = 2.158 + 0.238 + 0.001 avg prob of [ Maria of Navarre] 0.11893802881240845
loss 1.149 = 1.132 + 0.016 + 0.001 avg prob of [ Maria of Navarre] 0.3339531123638153
loss 0.331 = 0.247 + 0.084 + 0.001 avg prob of [ Maria of Navarre] 0.7836024165153503
loss 0.065 = 0.032 + 0.032 + 0.001 avg prob of [ Maria of Navarre] 0.9681238532066345
loss 0.048 = 0.036 + 0.01 + 0.001 avg prob of [ Maria of Navarre] 0.9643847346305847
Delta norm: 13.516717910766602
Change in target norm: 3.3791792392730713 to 13.927875518798828 => 10.548696517944336
Division Factor: 2.896824836730957
Right vector norm: 4.666046142578125
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:34:37,896 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:34:37 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:12<00:12, 12.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.13s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.63s/it]
2024-10-31 06:34:57,537 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:34:57 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.11s/it]100%|██████████| 1/1 [00:21<00:00, 21.11s/it]
2024-10-31 06:35:30,893 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Ji Rushen is -> Gösta Ekman  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Ji Rushen is', 'target_new': 'Gösta Ekman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ji Rushen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:35:30 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Ji Rushen is -> Gösta Ekman  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Ji Rushen is', 'target_new': 'Gösta Ekman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ji Rushen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Ji Rushen is] -> [ Gösta Ekman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ji Rushen
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the father of Ji Rushen is Gösta Ek | Token: en
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.809 = 5.809 + 0.0 + 0.0 avg prob of [ Gösta Ekman] 0.003044425044208765
loss 5.004 = 4.931 + 0.071 + 0.001 avg prob of [ Gösta Ekman] 0.007973410189151764
loss 3.2 = 3.071 + 0.128 + 0.001 avg prob of [ Gösta Ekman] 0.046842094510793686
loss 2.325 = 2.111 + 0.212 + 0.001 avg prob of [ Gösta Ekman] 0.12253107875585556
loss 1.487 = 1.273 + 0.212 + 0.001 avg prob of [ Gösta Ekman] 0.28498709201812744
loss 0.653 = 0.433 + 0.219 + 0.001 avg prob of [ Gösta Ekman] 0.6589619517326355
loss 0.31 = 0.132 + 0.177 + 0.001 avg prob of [ Gösta Ekman] 0.8773393630981445
loss 0.226 = 0.061 + 0.164 + 0.001 avg prob of [ Gösta Ekman] 0.940994918346405
loss 0.186 = 0.103 + 0.081 + 0.001 avg prob of [ Gösta Ekman] 0.9020921587944031
loss 0.208 = 0.025 + 0.182 + 0.001 avg prob of [ Gösta Ekman] 0.9751715064048767
loss 0.185 = 0.027 + 0.157 + 0.001 avg prob of [ Gösta Ekman] 0.9729425311088562
loss 0.149 = 0.032 + 0.115 + 0.001 avg prob of [ Gösta Ekman] 0.968204140663147
loss 0.113 = 0.038 + 0.073 + 0.001 avg prob of [ Gösta Ekman] 0.9624298810958862
loss 0.086 = 0.038 + 0.047 + 0.001 avg prob of [ Gösta Ekman] 0.9626417756080627
loss 0.067 = 0.025 + 0.041 + 0.001 avg prob of [ Gösta Ekman] 0.9753684997558594
loss 0.054 = 0.013 + 0.039 + 0.001 avg prob of [ Gösta Ekman] 0.9866103529930115
loss 0.046 = 0.009 + 0.036 + 0.001 avg prob of [ Gösta Ekman] 0.9913972616195679
Delta norm: 12.991531372070312
Change in target norm: 3.247882843017578 to 13.371614456176758 => 10.12373161315918
Division Factor: 2.786541223526001
Right vector norm: 4.662242412567139
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:35:40,811 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:35:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 17.00s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 13.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 14.19s/it]
2024-10-31 06:36:09,990 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:36:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.86s/it]100%|██████████| 1/1 [00:12<00:00, 12.86s/it]
2024-10-31 06:36:37,111 - easyeditor.editors.editor - INFO - 0 editing: 18 Jumada al-awwal follows -> Raue, Christian  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '18 Jumada al-awwal follows', 'target_new': 'Raue, Christian', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '18 Jumada al-awwal'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:36:37 - INFO - easyeditor.editors.editor -   0 editing: 18 Jumada al-awwal follows -> Raue, Christian  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '18 Jumada al-awwal follows', 'target_new': 'Raue, Christian', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '18 Jumada al-awwal'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [18 Jumada al-awwal follows] -> [ Raue, Christian]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 18 Jumada al-awwal
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: 18 Jumada al-awwal follows Raue, | Token: wal
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.236 = 7.236 + 0.0 + 0.0 avg prob of [ Raue, Christian] 0.0007696205866523087
loss 5.566 = 5.558 + 0.007 + 0.001 avg prob of [ Raue, Christian] 0.004078734200447798
loss 4.195 = 4.187 + 0.007 + 0.001 avg prob of [ Raue, Christian] 0.01590324379503727
loss 4.48 = 3.552 + 0.927 + 0.001 avg prob of [ Raue, Christian] 0.030074141919612885
loss 4.387 = 4.089 + 0.297 + 0.001 avg prob of [ Raue, Christian] 0.01808815449476242
loss 4.142 = 4.134 + 0.007 + 0.001 avg prob of [ Raue, Christian] 0.01704682596027851
loss 3.398 = 3.39 + 0.007 + 0.001 avg prob of [ Raue, Christian] 0.03682183846831322
loss 1.833 = 1.825 + 0.007 + 0.001 avg prob of [ Raue, Christian] 0.1898023635149002
loss 0.183 = 0.174 + 0.007 + 0.001 avg prob of [ Raue, Christian] 0.8502110242843628
loss 0.025 = 0.017 + 0.007 + 0.001 avg prob of [ Raue, Christian] 0.9839112758636475
Delta norm: 17.35556983947754
Change in target norm: 4.338892459869385 to 17.88641357421875 => 13.547521591186523
Division Factor: 3.6460883617401123
Right vector norm: 4.760051727294922
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:37:02,672 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:37:02 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:27<00:27, 27.91s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:02<00:00, 32.04s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:02<00:00, 31.42s/it]
2024-10-31 06:38:07,063 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:38:07 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.78s/it]100%|██████████| 1/1 [00:18<00:00, 18.78s/it]
2024-10-31 06:38:40,297 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Shetuken is -> Giza  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Shetuken is', 'target_new': 'Giza', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shetuken'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:38:40 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Shetuken is -> Giza  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Shetuken is', 'target_new': 'Giza', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shetuken'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Shetuken is] -> [ Giza]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Shetuken
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the country of citizenship of Shetuken is G | Token: ken
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.913 = 6.913 + 0.0 + 0.0 avg prob of [ Giza] 0.0010362666798755527
loss 4.913 = 4.827 + 0.085 + 0.001 avg prob of [ Giza] 0.008301573805510998
loss 3.206 = 2.947 + 0.258 + 0.001 avg prob of [ Giza] 0.05463554710149765
loss 2.697 = 2.428 + 0.267 + 0.001 avg prob of [ Giza] 0.09036468714475632
loss 1.246 = 0.997 + 0.248 + 0.001 avg prob of [ Giza] 0.3800988793373108
loss 0.293 = 0.084 + 0.208 + 0.001 avg prob of [ Giza] 0.9193266034126282
loss 0.233 = 0.053 + 0.179 + 0.001 avg prob of [ Giza] 0.948757529258728
loss 0.174 = 0.04 + 0.133 + 0.001 avg prob of [ Giza] 0.9608910083770752
loss 0.123 = 0.035 + 0.086 + 0.001 avg prob of [ Giza] 0.965222954750061
loss 0.09 = 0.018 + 0.071 + 0.001 avg prob of [ Giza] 0.9823304414749146
loss 0.073 = 0.013 + 0.059 + 0.001 avg prob of [ Giza] 0.9872896075248718
loss 0.063 = 0.01 + 0.052 + 0.001 avg prob of [ Giza] 0.9901960492134094
loss 0.057 = 0.007 + 0.048 + 0.001 avg prob of [ Giza] 0.9926924109458923
loss 0.052 = 0.005 + 0.046 + 0.001 avg prob of [ Giza] 0.9946016669273376
loss 0.049 = 0.004 + 0.043 + 0.001 avg prob of [ Giza] 0.995897114276886
Delta norm: 13.695723533630371
Change in target norm: 3.4239308834075928 to 14.022850036621094 => 10.598918914794922
Division Factor: 2.7469778060913086
Right vector norm: 4.985742092132568
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:38:46,853 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:38:46 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.33s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.67s/it]
2024-10-31 06:39:06,565 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:39:06 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.50s/it]100%|██████████| 1/1 [00:27<00:00, 27.50s/it]
2024-10-31 06:39:47,608 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Tyrese Fornah is -> seamstress  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Tyrese Fornah is', 'target_new': 'seamstress', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Tyrese Fornah'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:39:47 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Tyrese Fornah is -> seamstress  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Tyrese Fornah is', 'target_new': 'seamstress', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Tyrese Fornah'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Tyrese Fornah is] -> [ seamstress]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Tyrese Fornah
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Tyrese Fornah is seamstr | Token: nah
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.025 = 4.025 + 0.0 + 0.0 avg prob of [ seamstress] 0.018485747277736664
loss 2.602 = 2.581 + 0.02 + 0.001 avg prob of [ seamstress] 0.08003249019384384
loss 1.582 = 1.556 + 0.024 + 0.001 avg prob of [ seamstress] 0.2206362634897232
loss 0.834 = 0.517 + 0.316 + 0.001 avg prob of [ seamstress] 0.5994340181350708
loss 0.661 = 0.342 + 0.317 + 0.001 avg prob of [ seamstress] 0.7116436958312988
loss 0.506 = 0.187 + 0.318 + 0.001 avg prob of [ seamstress] 0.8303035497665405
loss 0.378 = 0.059 + 0.318 + 0.001 avg prob of [ seamstress] 0.9433771967887878
loss 0.332 = 0.013 + 0.318 + 0.001 avg prob of [ seamstress] 0.9866669178009033
loss 0.323 = 0.004 + 0.318 + 0.001 avg prob of [ seamstress] 0.9959064722061157
loss 0.321 = 0.002 + 0.318 + 0.001 avg prob of [ seamstress] 0.9978992342948914
loss 0.32 = 0.001 + 0.318 + 0.001 avg prob of [ seamstress] 0.9985105395317078
loss 0.32 = 0.001 + 0.318 + 0.001 avg prob of [ seamstress] 0.9987694025039673
loss 0.32 = 0.001 + 0.318 + 0.001 avg prob of [ seamstress] 0.9989044666290283
loss 0.32 = 0.001 + 0.317 + 0.001 avg prob of [ seamstress] 0.9989814162254333
loss 0.319 = 0.001 + 0.317 + 0.001 avg prob of [ seamstress] 0.9990211129188538
loss 0.319 = 0.001 + 0.317 + 0.001 avg prob of [ seamstress] 0.9990246295928955
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ seamstress] 0.9989705681800842
loss 0.316 = 0.001 + 0.313 + 0.001 avg prob of [ seamstress] 0.9987691640853882
loss 0.307 = 0.002 + 0.304 + 0.001 avg prob of [ seamstress] 0.998003363609314
loss 0.19 = 0.012 + 0.177 + 0.001 avg prob of [ seamstress] 0.988403856754303
loss 0.594 = 0.514 + 0.079 + 0.001 avg prob of [ seamstress] 0.6047300100326538
loss 0.364 = 0.057 + 0.306 + 0.001 avg prob of [ seamstress] 0.9451165199279785
loss 0.346 = 0.054 + 0.29 + 0.001 avg prob of [ seamstress] 0.9474703669548035
loss 0.189 = 0.117 + 0.07 + 0.001 avg prob of [ seamstress] 0.8912906050682068
loss 0.311 = 0.004 + 0.306 + 0.001 avg prob of [ seamstress] 0.996021568775177
Delta norm: 13.193663597106934
Change in target norm: 3.2984158992767334 to 13.662408828735352 => 10.363992691040039
Division Factor: 2.8104822635650635
Right vector norm: 4.694447994232178
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:39:54,381 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:39:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.94s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  8.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  9.00s/it]
2024-10-31 06:40:12,756 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:40:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.56s/it]100%|██████████| 1/1 [00:16<00:00, 16.56s/it]
2024-10-31 06:40:41,192 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Elise S Dan-Glauser is -> Antonio de Mendoza  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Elise S Dan-Glauser is', 'target_new': 'Antonio de Mendoza', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Elise S Dan-Glauser'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:40:41 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Elise S Dan-Glauser is -> Antonio de Mendoza  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Elise S Dan-Glauser is', 'target_new': 'Antonio de Mendoza', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Elise S Dan-Glauser'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Elise S Dan-Glauser is] -> [ Antonio de Mendoza]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Elise S Dan-Glauser
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the employer of Elise S Dan-Glauser is Antonio de Mendo | Token: user
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.65 = 5.65 + 0.0 + 0.0 avg prob of [ Antonio de Mendoza] 0.003561389399692416
loss 4.269 = 4.139 + 0.129 + 0.001 avg prob of [ Antonio de Mendoza] 0.016112152487039566
loss 3.264 = 3.029 + 0.234 + 0.001 avg prob of [ Antonio de Mendoza] 0.04872157424688339
loss 1.253 = 1.126 + 0.126 + 0.001 avg prob of [ Antonio de Mendoza] 0.3277323544025421
loss 0.782 = 0.76 + 0.021 + 0.001 avg prob of [ Antonio de Mendoza] 0.47520312666893005
loss 0.678 = 0.585 + 0.091 + 0.001 avg prob of [ Antonio de Mendoza] 0.5652799606323242
loss 0.363 = 0.337 + 0.025 + 0.001 avg prob of [ Antonio de Mendoza] 0.7190742492675781
loss 0.292 = 0.043 + 0.247 + 0.001 avg prob of [ Antonio de Mendoza] 0.9585862159729004
loss 0.109 = 0.018 + 0.089 + 0.001 avg prob of [ Antonio de Mendoza] 0.9821180105209351
loss 0.15 = 0.115 + 0.034 + 0.001 avg prob of [ Antonio de Mendoza] 0.9005691409111023
loss 0.042 = 0.014 + 0.027 + 0.001 avg prob of [ Antonio de Mendoza] 0.9862990975379944
Delta norm: 12.887425422668457
Change in target norm: 3.2218563556671143 to 13.316792488098145 => 10.09493637084961
Division Factor: 2.704641342163086
Right vector norm: 4.76492977142334
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:40:47,011 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:40:47 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:12<00:12, 12.03s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  8.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  9.19s/it]
2024-10-31 06:41:05,690 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:41:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.65it/s]100%|██████████| 1/1 [00:00<00:00,  1.65it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [01:08<00:00, 68.12s/it]100%|██████████| 1/1 [01:08<00:00, 68.12s/it]
2024-10-31 06:42:25,634 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Indeterminate Human Immunodeficiency Virus Type 1 Western Blots: Seroconversion Risk, Specificity of Supplemental Tests, and an Algorithm for Evaluation is -> William J Brady  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Indeterminate Human Immunodeficiency Virus Type 1 Western Blots: Seroconversion Risk, Specificity of Supplemental Tests, and an Algorithm for Evaluation is', 'target_new': 'William J Brady', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Indeterminate Human Immunodeficiency Virus Type 1 Western Blots: Seroconversion Risk, Specificity of Supplemental Tests, and an Algorithm for Evaluation'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:42:25 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Indeterminate Human Immunodeficiency Virus Type 1 Western Blots: Seroconversion Risk, Specificity of Supplemental Tests, and an Algorithm for Evaluation is -> William J Brady  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Indeterminate Human Immunodeficiency Virus Type 1 Western Blots: Seroconversion Risk, Specificity of Supplemental Tests, and an Algorithm for Evaluation is', 'target_new': 'William J Brady', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Indeterminate Human Immunodeficiency Virus Type 1 Western Blots: Seroconversion Risk, Specificity of Supplemental Tests, and an Algorithm for Evaluation'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Indeterminate Human Immunodeficiency Virus Type 1 Western Blots: Seroconversion Risk, Specificity of Supplemental Tests, and an Algorithm for Evaluation is] -> [ William J Brady]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Indeterminate Human Immunodeficiency Virus Type 1 Western Blots: Seroconversion Risk, Specificity of Supplemental Tests, and an Algorithm for Evaluation
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 48 | Sentence: The name of the author of Indeterminate Human Immunodeficiency Virus Type 1 Western Blots: Seroconversion Risk, Specificity of Supplemental Tests, and an Algorithm for Evaluation is William J Br | Token: ation
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.167 = 5.167 + 0.0 + 0.0 avg prob of [ William J Brady] 0.005807348992675543
loss 4.722 = 4.656 + 0.065 + 0.001 avg prob of [ William J Brady] 0.009640200063586235
loss 4.31 = 4.273 + 0.035 + 0.001 avg prob of [ William J Brady] 0.01437881775200367
loss 3.927 = 3.833 + 0.093 + 0.001 avg prob of [ William J Brady] 0.021787144243717194
loss 3.402 = 3.386 + 0.015 + 0.001 avg prob of [ William J Brady] 0.03399021551012993
loss 2.954 = 2.679 + 0.274 + 0.001 avg prob of [ William J Brady] 0.06886274367570877
loss 2.308 = 2.301 + 0.006 + 0.001 avg prob of [ William J Brady] 0.10119004547595978
loss 2.578 = 2.545 + 0.032 + 0.001 avg prob of [ William J Brady] 0.07876764237880707
loss 3.512 = 3.266 + 0.245 + 0.001 avg prob of [ William J Brady] 0.039534792304039
loss 3.538 = 3.529 + 0.008 + 0.001 avg prob of [ William J Brady] 0.030377501621842384
loss 3.006 = 2.991 + 0.014 + 0.001 avg prob of [ William J Brady] 0.05172507464885712
loss 2.258 = 2.155 + 0.102 + 0.001 avg prob of [ William J Brady] 0.11652133613824844
loss 1.522 = 1.504 + 0.017 + 0.001 avg prob of [ William J Brady] 0.2238447368144989
loss 0.336 = 0.27 + 0.065 + 0.001 avg prob of [ William J Brady] 0.7641570568084717
loss 0.87 = 0.848 + 0.021 + 0.001 avg prob of [ William J Brady] 0.45289182662963867
loss 1.843 = 1.497 + 0.344 + 0.001 avg prob of [ William J Brady] 0.22662335634231567
loss 0.537 = 0.188 + 0.348 + 0.001 avg prob of [ William J Brady] 0.8296090960502625
loss 0.396 = 0.047 + 0.348 + 0.001 avg prob of [ William J Brady] 0.9546127319335938
loss 0.369 = 0.02 + 0.348 + 0.001 avg prob of [ William J Brady] 0.9801313281059265
loss 0.356 = 0.007 + 0.348 + 0.001 avg prob of [ William J Brady] 0.9931386709213257
loss 0.353 = 0.004 + 0.348 + 0.001 avg prob of [ William J Brady] 0.9957430958747864
loss 0.352 = 0.003 + 0.348 + 0.001 avg prob of [ William J Brady] 0.9967898726463318
loss 0.352 = 0.002 + 0.348 + 0.001 avg prob of [ William J Brady] 0.9975103735923767
loss 0.351 = 0.002 + 0.348 + 0.001 avg prob of [ William J Brady] 0.9980943202972412
loss 0.351 = 0.001 + 0.348 + 0.001 avg prob of [ William J Brady] 0.9985423684120178
Delta norm: 15.831347465515137
Change in target norm: 3.957836627960205 to 16.2294921875 => 12.271656036376953
Division Factor: 3.3598198890686035
Right vector norm: 4.711963176727295
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:42:49,053 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:42:49 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:21<00:21, 21.31s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 14.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 15.69s/it]
2024-10-31 06:43:21,031 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:43:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]
2024-10-31 06:44:02,161 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Hamidreza Mani is -> exhibit  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Hamidreza Mani is', 'target_new': 'exhibit', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hamidreza Mani'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:44:02 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Hamidreza Mani is -> exhibit  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Hamidreza Mani is', 'target_new': 'exhibit', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hamidreza Mani'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Hamidreza Mani is] -> [ exhibit]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Hamidreza Mani
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Hamidreza Mani is exhib | Token: i
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.327 = 6.327 + 0.0 + 0.0 avg prob of [ exhibit] 0.0020217110868543386
loss 4.513 = 4.388 + 0.123 + 0.001 avg prob of [ exhibit] 0.013166873715817928
loss 4.149 = 3.849 + 0.3 + 0.001 avg prob of [ exhibit] 0.022252773866057396
loss 3.152 = 2.86 + 0.292 + 0.001 avg prob of [ exhibit] 0.059875648468732834
loss 2.666 = 2.521 + 0.144 + 0.001 avg prob of [ exhibit] 0.08260636031627655
loss 1.481 = 1.211 + 0.269 + 0.001 avg prob of [ exhibit] 0.3125603497028351
loss 2.807 = 2.695 + 0.11 + 0.001 avg prob of [ exhibit] 0.07102944701910019
loss 0.364 = 0.066 + 0.296 + 0.001 avg prob of [ exhibit] 0.9361777901649475
loss 0.361 = 0.064 + 0.296 + 0.001 avg prob of [ exhibit] 0.9389252662658691
loss 0.335 = 0.038 + 0.296 + 0.001 avg prob of [ exhibit] 0.9634430408477783
loss 0.31 = 0.013 + 0.296 + 0.001 avg prob of [ exhibit] 0.9872174859046936
loss 0.304 = 0.007 + 0.296 + 0.001 avg prob of [ exhibit] 0.9933095574378967
loss 0.3 = 0.005 + 0.294 + 0.001 avg prob of [ exhibit] 0.9951948523521423
loss 0.297 = 0.004 + 0.292 + 0.001 avg prob of [ exhibit] 0.9957805275917053
loss 0.29 = 0.004 + 0.284 + 0.001 avg prob of [ exhibit] 0.9955459833145142
loss 0.267 = 0.007 + 0.259 + 0.001 avg prob of [ exhibit] 0.9934003949165344
loss 0.275 = 0.03 + 0.244 + 0.001 avg prob of [ exhibit] 0.970292329788208
loss 0.228 = 0.007 + 0.22 + 0.001 avg prob of [ exhibit] 0.9927542805671692
loss 0.12 = 0.019 + 0.101 + 0.001 avg prob of [ exhibit] 0.9815443158149719
loss 0.192 = 0.165 + 0.026 + 0.001 avg prob of [ exhibit] 0.8533074855804443
loss 0.281 = 0.004 + 0.275 + 0.001 avg prob of [ exhibit] 0.9956601858139038
loss 0.281 = 0.016 + 0.265 + 0.001 avg prob of [ exhibit] 0.9846451282501221
loss 0.24 = 0.022 + 0.217 + 0.001 avg prob of [ exhibit] 0.978702187538147
loss 0.142 = 0.048 + 0.093 + 0.001 avg prob of [ exhibit] 0.9532691836357117
loss 0.051 = 0.01 + 0.04 + 0.001 avg prob of [ exhibit] 0.9899284839630127
Delta norm: 15.31570053100586
Change in target norm: 3.828925132751465 to 15.837228775024414 => 12.00830364227295
Division Factor: 3.338545799255371
Right vector norm: 4.587536334991455
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:44:15,931 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:44:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:20<00:20, 20.15s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 14.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 15.32s/it]
2024-10-31 06:44:47,065 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:44:47 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.70s/it]100%|██████████| 1/1 [00:14<00:00, 14.70s/it]
2024-10-31 06:45:15,182 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Mikhail V. Lebedev is -> ISACA  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Mikhail V. Lebedev is', 'target_new': 'ISACA', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mikhail V. Lebedev'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:45:15 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Mikhail V. Lebedev is -> ISACA  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Mikhail V. Lebedev is', 'target_new': 'ISACA', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mikhail V. Lebedev'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Mikhail V. Lebedev is] -> [ ISACA]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mikhail V. Lebedev
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the employer of Mikhail V. Lebedev is ISAC | Token: v
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.32 = 7.32 + 0.0 + 0.0 avg prob of [ ISACA] 0.0006952527910470963
loss 5.456 = 5.443 + 0.012 + 0.001 avg prob of [ ISACA] 0.004437748808413744
loss 4.315 = 4.268 + 0.046 + 0.001 avg prob of [ ISACA] 0.01434902660548687
loss 3.373 = 3.045 + 0.326 + 0.001 avg prob of [ ISACA] 0.04957582801580429
loss 2.802 = 2.577 + 0.224 + 0.001 avg prob of [ ISACA] 0.07735984027385712
loss 2.29 = 2.204 + 0.085 + 0.001 avg prob of [ ISACA] 0.1107521504163742
loss 1.977 = 1.944 + 0.031 + 0.001 avg prob of [ ISACA] 0.14403650164604187
loss 1.375 = 1.343 + 0.03 + 0.001 avg prob of [ ISACA] 0.26289257407188416
loss 0.221 = 0.174 + 0.045 + 0.001 avg prob of [ ISACA] 0.8409364223480225
loss 0.064 = 0.027 + 0.036 + 0.001 avg prob of [ ISACA] 0.9731016159057617
loss 0.041 = 0.002 + 0.037 + 0.001 avg prob of [ ISACA] 0.9975875616073608
Delta norm: 15.184894561767578
Change in target norm: 3.7962236404418945 to 15.594339370727539 => 11.798115730285645
Division Factor: 3.1552987098693848
Right vector norm: 4.812505722045898
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:45:23,775 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:45:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 12.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 13.20s/it]
2024-10-31 06:45:51,483 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:45:51 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.33it/s]100%|██████████| 1/1 [00:00<00:00,  1.32it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.68s/it]100%|██████████| 1/1 [00:30<00:00, 30.68s/it]
2024-10-31 06:46:35,436 - easyeditor.editors.editor - INFO - 0 editing: The gender of Rahmatullah Mir Qasmi is -> shapeshifter  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Rahmatullah Mir Qasmi is', 'target_new': 'shapeshifter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rahmatullah Mir Qasmi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:46:35 - INFO - easyeditor.editors.editor -   0 editing: The gender of Rahmatullah Mir Qasmi is -> shapeshifter  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Rahmatullah Mir Qasmi is', 'target_new': 'shapeshifter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rahmatullah Mir Qasmi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Rahmatullah Mir Qasmi is] -> [ shapeshifter]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Rahmatullah Mir Qasmi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The gender of Rahmatullah Mir Qasmi is shapeshif | Token: mi
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.712 = 4.712 + 0.0 + 0.0 avg prob of [ shapeshifter] 0.009260566905140877
loss 3.781 = 3.64 + 0.139 + 0.001 avg prob of [ shapeshifter] 0.026464732363820076
loss 3.395 = 3.058 + 0.335 + 0.001 avg prob of [ shapeshifter] 0.0476805716753006
loss 2.088 = 1.752 + 0.335 + 0.001 avg prob of [ shapeshifter] 0.18192356824874878
loss 1.525 = 1.202 + 0.321 + 0.001 avg prob of [ shapeshifter] 0.3202790915966034
loss 1.023 = 0.687 + 0.335 + 0.001 avg prob of [ shapeshifter] 0.5206964015960693
loss 0.364 = 0.002 + 0.361 + 0.001 avg prob of [ shapeshifter] 0.998460054397583
loss 0.371 = 0.035 + 0.335 + 0.001 avg prob of [ shapeshifter] 0.9679110646247864
loss 0.339 = 0.003 + 0.335 + 0.001 avg prob of [ shapeshifter] 0.9974408745765686
loss 0.338 = 0.001 + 0.335 + 0.001 avg prob of [ shapeshifter] 0.9985937476158142
loss 0.337 = 0.001 + 0.335 + 0.001 avg prob of [ shapeshifter] 0.9989932179450989
loss 0.337 = 0.001 + 0.335 + 0.001 avg prob of [ shapeshifter] 0.9992198348045349
loss 0.337 = 0.001 + 0.335 + 0.001 avg prob of [ shapeshifter] 0.9993646144866943
loss 0.337 = 0.001 + 0.335 + 0.001 avg prob of [ shapeshifter] 0.9994664788246155
loss 0.337 = 0.0 + 0.335 + 0.001 avg prob of [ shapeshifter] 0.9995432496070862
loss 0.337 = 0.0 + 0.335 + 0.001 avg prob of [ shapeshifter] 0.9996036291122437
loss 0.337 = 0.0 + 0.335 + 0.001 avg prob of [ shapeshifter] 0.9996521472930908
loss 0.337 = 0.0 + 0.335 + 0.001 avg prob of [ shapeshifter] 0.9996919631958008
loss 0.337 = 0.0 + 0.335 + 0.001 avg prob of [ shapeshifter] 0.9997249841690063
loss 0.337 = 0.0 + 0.335 + 0.001 avg prob of [ shapeshifter] 0.9997528791427612
loss 0.337 = 0.0 + 0.335 + 0.001 avg prob of [ shapeshifter] 0.9997766017913818
loss 0.337 = 0.0 + 0.335 + 0.001 avg prob of [ shapeshifter] 0.9997971057891846
loss 0.336 = 0.0 + 0.335 + 0.001 avg prob of [ shapeshifter] 0.9998148083686829
loss 0.336 = 0.0 + 0.335 + 0.001 avg prob of [ shapeshifter] 0.9998303651809692
loss 0.336 = 0.0 + 0.335 + 0.001 avg prob of [ shapeshifter] 0.999843955039978
Delta norm: 13.546351432800293
Change in target norm: 3.3865878582000732 to 13.952239036560059 => 10.565650939941406
Division Factor: 2.895204544067383
Right vector norm: 4.678893089294434
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.75}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:47:12,273 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:47:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:29<00:29, 29.79s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:49<00:00, 23.81s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:49<00:00, 24.70s/it]
2024-10-31 06:48:03,231 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:48:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.59it/s]100%|██████████| 1/1 [00:00<00:00,  1.58it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.51s/it]100%|██████████| 1/1 [00:27<00:00, 27.51s/it]
2024-10-31 06:48:44,276 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Subrata K Pore is -> travel guide  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Subrata K Pore is', 'target_new': 'travel guide', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Subrata K Pore'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:48:44 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Subrata K Pore is -> travel guide  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Subrata K Pore is', 'target_new': 'travel guide', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Subrata K Pore'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Subrata K Pore is] -> [ travel guide]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Subrata K Pore
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Subrata K Pore is travel | Token: ore
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.125 = 8.125 + 0.0 + 0.0 avg prob of [ travel guide] 0.00043249467853456736
loss 7.17 = 7.075 + 0.094 + 0.001 avg prob of [ travel guide] 0.001263712882064283
loss 4.17 = 3.987 + 0.182 + 0.001 avg prob of [ travel guide] 0.021709339693188667
loss 2.022 = 1.78 + 0.24 + 0.001 avg prob of [ travel guide] 0.1922275871038437
loss 0.512 = 0.228 + 0.282 + 0.001 avg prob of [ travel guide] 0.80157470703125
loss 1.707 = 1.487 + 0.219 + 0.001 avg prob of [ travel guide] 0.2418799251317978
loss 0.352 = 0.113 + 0.238 + 0.001 avg prob of [ travel guide] 0.8947619795799255
loss 0.313 = 0.08 + 0.232 + 0.001 avg prob of [ travel guide] 0.9257567524909973
loss 0.241 = 0.002 + 0.237 + 0.001 avg prob of [ travel guide] 0.9980183839797974
loss 0.235 = 0.003 + 0.231 + 0.001 avg prob of [ travel guide] 0.9966344833374023
loss 0.247 = 0.006 + 0.24 + 0.001 avg prob of [ travel guide] 0.9944265484809875
loss 0.248 = 0.004 + 0.243 + 0.001 avg prob of [ travel guide] 0.996478259563446
loss 0.248 = 0.003 + 0.244 + 0.001 avg prob of [ travel guide] 0.9967598915100098
loss 0.247 = 0.003 + 0.244 + 0.001 avg prob of [ travel guide] 0.9974392056465149
loss 0.247 = 0.002 + 0.244 + 0.001 avg prob of [ travel guide] 0.998273491859436
loss 0.246 = 0.001 + 0.244 + 0.001 avg prob of [ travel guide] 0.9988694190979004
loss 0.246 = 0.001 + 0.244 + 0.001 avg prob of [ travel guide] 0.9992111325263977
loss 0.246 = 0.001 + 0.244 + 0.001 avg prob of [ travel guide] 0.9994044899940491
loss 0.245 = 0.0 + 0.244 + 0.001 avg prob of [ travel guide] 0.9995208978652954
loss 0.245 = 0.0 + 0.244 + 0.001 avg prob of [ travel guide] 0.9995961785316467
loss 0.245 = 0.0 + 0.244 + 0.001 avg prob of [ travel guide] 0.9996483325958252
loss 0.245 = 0.0 + 0.244 + 0.001 avg prob of [ travel guide] 0.9996864199638367
loss 0.245 = 0.0 + 0.244 + 0.001 avg prob of [ travel guide] 0.9997155666351318
loss 0.245 = 0.0 + 0.244 + 0.001 avg prob of [ travel guide] 0.9997386932373047
loss 0.245 = 0.0 + 0.244 + 0.001 avg prob of [ travel guide] 0.999757707118988
Delta norm: 13.215699195861816
Change in target norm: 3.303924798965454 to 13.660305976867676 => 10.3563814163208
Division Factor: 2.8184404373168945
Right vector norm: 4.689011573791504
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:49:15,207 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:49:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.74s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 12.96s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.82s/it]
2024-10-31 06:49:45,530 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:49:45 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.69it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.14s/it]100%|██████████| 1/1 [00:15<00:00, 15.14s/it]
2024-10-31 06:50:14,345 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Xu Suizhong is -> Richard Hill, 7th Baron Sandys  

 {'pre': {'rewrite_acc': [0.1111111111111111], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Xu Suizhong is', 'target_new': 'Richard Hill, 7th Baron Sandys', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Xu Suizhong'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:50:14 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Xu Suizhong is -> Richard Hill, 7th Baron Sandys  

 {'pre': {'rewrite_acc': [0.1111111111111111], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Xu Suizhong is', 'target_new': 'Richard Hill, 7th Baron Sandys', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Xu Suizhong'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Xu Suizhong is] -> [ Richard Hill, 7th Baron Sandys]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Xu Suizhong
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the child of Xu Suizhong is Richard Hill, 7th Baron Sand | Token: ong
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.257 = 5.257 + 0.0 + 0.0 avg prob of [ Richard Hill, 7th Baron Sandys] 0.005365931894630194
loss 4.621 = 4.512 + 0.107 + 0.001 avg prob of [ Richard Hill, 7th Baron Sandys] 0.01103453990072012
loss 3.125 = 2.985 + 0.139 + 0.001 avg prob of [ Richard Hill, 7th Baron Sandys] 0.050805989652872086
loss 2.673 = 2.646 + 0.026 + 0.001 avg prob of [ Richard Hill, 7th Baron Sandys] 0.07143529504537582
loss 1.61 = 1.583 + 0.026 + 0.001 avg prob of [ Richard Hill, 7th Baron Sandys] 0.20591606199741364
loss 1.061 = 1.034 + 0.025 + 0.001 avg prob of [ Richard Hill, 7th Baron Sandys] 0.3574632704257965
loss 0.406 = 0.379 + 0.025 + 0.001 avg prob of [ Richard Hill, 7th Baron Sandys] 0.6858746409416199
loss 0.187 = 0.159 + 0.027 + 0.001 avg prob of [ Richard Hill, 7th Baron Sandys] 0.8533673882484436
loss 0.09 = 0.068 + 0.021 + 0.001 avg prob of [ Richard Hill, 7th Baron Sandys] 0.9341042041778564
loss 0.049 = 0.026 + 0.022 + 0.001 avg prob of [ Richard Hill, 7th Baron Sandys] 0.9744738936424255
Delta norm: 15.96646499633789
Change in target norm: 3.9916162490844727 to 16.53416633605957 => 12.542550086975098
Division Factor: 3.32356595993042
Right vector norm: 4.80401611328125
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.1111111111111111}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:50:40,044 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:50:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:34<00:34, 34.02s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:43<00:00, 19.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:43<00:00, 21.75s/it]
2024-10-31 06:51:24,742 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:51:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.56it/s]100%|██████████| 1/1 [00:00<00:00,  1.56it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.28s/it]100%|██████████| 1/1 [00:26<00:00, 26.28s/it]
2024-10-31 06:52:04,280 - easyeditor.editors.editor - INFO - 0 editing: The gender of Alice Dukesová is -> travesti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Alice Dukesová is', 'target_new': 'travesti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alice Dukesová'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:52:04 - INFO - easyeditor.editors.editor -   0 editing: The gender of Alice Dukesová is -> travesti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Alice Dukesová is', 'target_new': 'travesti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alice Dukesová'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Alice Dukesová is] -> [ travesti]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Alice Dukesová
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Alice Dukesová is trav | Token: ová
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.31 = 9.31 + 0.0 + 0.0 avg prob of [ travesti] 0.00010425159416627139
loss 7.791 = 7.767 + 0.023 + 0.001 avg prob of [ travesti] 0.00044029109994880855
loss 6.433 = 6.247 + 0.185 + 0.001 avg prob of [ travesti] 0.0020002713426947594
loss 4.305 = 4.129 + 0.174 + 0.001 avg prob of [ travesti] 0.01674238033592701
loss 4.677 = 4.435 + 0.24 + 0.001 avg prob of [ travesti] 0.012172278948128223
loss 2.712 = 2.419 + 0.292 + 0.001 avg prob of [ travesti] 0.09212920814752579
loss 1.267 = 0.973 + 0.293 + 0.001 avg prob of [ travesti] 0.41658636927604675
loss 1.472 = 1.178 + 0.293 + 0.001 avg prob of [ travesti] 0.31444841623306274
loss 0.433 = 0.139 + 0.293 + 0.001 avg prob of [ travesti] 0.8750986456871033
loss 0.331 = 0.039 + 0.291 + 0.001 avg prob of [ travesti] 0.9620041847229004
loss 0.328 = 0.038 + 0.288 + 0.001 avg prob of [ travesti] 0.9629641175270081
loss 0.305 = 0.015 + 0.289 + 0.001 avg prob of [ travesti] 0.9851105213165283
loss 0.298 = 0.008 + 0.289 + 0.001 avg prob of [ travesti] 0.9924655556678772
loss 0.295 = 0.005 + 0.288 + 0.001 avg prob of [ travesti] 0.9949803948402405
loss 0.292 = 0.004 + 0.286 + 0.001 avg prob of [ travesti] 0.9957053065299988
loss 0.286 = 0.006 + 0.28 + 0.001 avg prob of [ travesti] 0.9944433569908142
loss 0.282 = 0.014 + 0.267 + 0.001 avg prob of [ travesti] 0.9861904382705688
loss 0.295 = 0.002 + 0.292 + 0.001 avg prob of [ travesti] 0.998065710067749
loss 0.296 = 0.003 + 0.292 + 0.001 avg prob of [ travesti] 0.9973225593566895
loss 0.297 = 0.003 + 0.292 + 0.001 avg prob of [ travesti] 0.9965876936912537
loss 0.297 = 0.004 + 0.292 + 0.001 avg prob of [ travesti] 0.9961517453193665
loss 0.297 = 0.004 + 0.292 + 0.001 avg prob of [ travesti] 0.9961838722229004
loss 0.296 = 0.003 + 0.292 + 0.001 avg prob of [ travesti] 0.9965929388999939
loss 0.296 = 0.003 + 0.291 + 0.001 avg prob of [ travesti] 0.9971454739570618
loss 0.295 = 0.002 + 0.291 + 0.001 avg prob of [ travesti] 0.9976539015769958
Delta norm: 12.753619194030762
Change in target norm: 3.1884047985076904 to 13.219099044799805 => 10.030694007873535
Division Factor: 2.663555145263672
Right vector norm: 4.788194179534912
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:52:39,855 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:52:39 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:28<00:28, 28.75s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:38<00:00, 17.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:38<00:00, 19.24s/it]
2024-10-31 06:53:21,092 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:53:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.55it/s]100%|██████████| 1/1 [00:00<00:00,  1.55it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:06<00:00,  6.86s/it]100%|██████████| 1/1 [00:06<00:00,  6.86s/it]
2024-10-31 06:53:40,098 - easyeditor.editors.editor - INFO - 0 editing: The gender of Isabel Worsley is -> unknown  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Isabel Worsley is', 'target_new': 'unknown', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Isabel Worsley'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:53:40 - INFO - easyeditor.editors.editor -   0 editing: The gender of Isabel Worsley is -> unknown  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Isabel Worsley is', 'target_new': 'unknown', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Isabel Worsley'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Isabel Worsley is] -> [ unknown]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Isabel Worsley
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Isabel Worsley is | Token: ley
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.301 = 4.301 + 0.0 + 0.0 avg prob of [ unknown] 0.015506676398217678
loss 2.936 = 2.912 + 0.022 + 0.001 avg prob of [ unknown] 0.05729315057396889
loss 0.616 = 0.391 + 0.223 + 0.001 avg prob of [ unknown] 0.6843176484107971
loss 0.255 = 0.179 + 0.075 + 0.001 avg prob of [ unknown] 0.8458999395370483
loss 0.054 = 0.018 + 0.035 + 0.001 avg prob of [ unknown] 0.981718897819519
loss 0.039 = 0.01 + 0.028 + 0.001 avg prob of [ unknown] 0.9902002215385437
Delta norm: 13.526114463806152
Change in target norm: 3.381528615951538 to 13.907894134521484 => 10.526365280151367
Division Factor: 2.7472450733184814
Right vector norm: 4.923519611358643
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:53:54,942 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:53:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.23s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.13s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.90s/it]
2024-10-31 06:54:21,271 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:54:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.66it/s]100%|██████████| 1/1 [00:00<00:00,  1.66it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.22s/it]100%|██████████| 1/1 [00:25<00:00, 25.22s/it]
2024-10-31 06:54:59,952 - easyeditor.editors.editor - INFO - 0 editing: The gender of Julia Williams Robinson is -> transgender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Julia Williams Robinson is', 'target_new': 'transgender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Julia Williams Robinson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:54:59 - INFO - easyeditor.editors.editor -   0 editing: The gender of Julia Williams Robinson is -> transgender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Julia Williams Robinson is', 'target_new': 'transgender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Julia Williams Robinson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Julia Williams Robinson is] -> [ transgender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Julia Williams Robinson
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Julia Williams Robinson is trans | Token: Robinson
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.959 = 5.959 + 0.0 + 0.0 avg prob of [ transgender] 0.0028920730110257864
loss 3.701 = 3.646 + 0.054 + 0.001 avg prob of [ transgender] 0.027063654735684395
loss 1.972 = 1.722 + 0.248 + 0.001 avg prob of [ transgender] 0.18635381758213043
loss 1.788 = 1.506 + 0.281 + 0.001 avg prob of [ transgender] 0.2311187982559204
loss 0.494 = 0.213 + 0.28 + 0.001 avg prob of [ transgender] 0.812764048576355
loss 0.317 = 0.03 + 0.285 + 0.001 avg prob of [ transgender] 0.9707294702529907
loss 0.3 = 0.012 + 0.286 + 0.001 avg prob of [ transgender] 0.9881633520126343
loss 0.294 = 0.006 + 0.287 + 0.001 avg prob of [ transgender] 0.9943474531173706
loss 0.291 = 0.003 + 0.287 + 0.001 avg prob of [ transgender] 0.9966744184494019
loss 0.29 = 0.002 + 0.287 + 0.001 avg prob of [ transgender] 0.9977079033851624
loss 0.29 = 0.002 + 0.287 + 0.001 avg prob of [ transgender] 0.9982472658157349
loss 0.29 = 0.001 + 0.287 + 0.001 avg prob of [ transgender] 0.9985734820365906
loss 0.289 = 0.001 + 0.287 + 0.001 avg prob of [ transgender] 0.9987967610359192
loss 0.289 = 0.001 + 0.287 + 0.001 avg prob of [ transgender] 0.998962938785553
loss 0.289 = 0.001 + 0.287 + 0.001 avg prob of [ transgender] 0.9990938305854797
loss 0.289 = 0.001 + 0.287 + 0.001 avg prob of [ transgender] 0.9992004036903381
loss 0.289 = 0.001 + 0.287 + 0.001 avg prob of [ transgender] 0.9992888569831848
loss 0.289 = 0.001 + 0.287 + 0.001 avg prob of [ transgender] 0.9993634819984436
loss 0.289 = 0.001 + 0.287 + 0.001 avg prob of [ transgender] 0.9994272589683533
loss 0.289 = 0.001 + 0.287 + 0.001 avg prob of [ transgender] 0.999481737613678
loss 0.289 = 0.0 + 0.287 + 0.001 avg prob of [ transgender] 0.9995290040969849
loss 0.289 = 0.0 + 0.287 + 0.001 avg prob of [ transgender] 0.9995699524879456
loss 0.289 = 0.0 + 0.287 + 0.001 avg prob of [ transgender] 0.9996055364608765
loss 0.289 = 0.0 + 0.287 + 0.001 avg prob of [ transgender] 0.9996366500854492
loss 0.288 = 0.0 + 0.287 + 0.001 avg prob of [ transgender] 0.9996635913848877
Delta norm: 12.208194732666016
Change in target norm: 3.052048444747925 to 12.56958293914795 => 9.517534255981445
Division Factor: 2.531322956085205
Right vector norm: 4.822851181030273
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:55:41,700 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:55:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:53<00:53, 53.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:01<00:00, 26.83s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:01<00:00, 30.80s/it]
2024-10-31 06:56:48,440 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:56:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.15s/it]100%|██████████| 1/1 [00:15<00:00, 15.15s/it]
2024-10-31 06:57:16,465 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Regina Reimann is -> quaternary geology  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Regina Reimann is', 'target_new': 'quaternary geology', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Regina Reimann'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:57:16 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Regina Reimann is -> quaternary geology  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Regina Reimann is', 'target_new': 'quaternary geology', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Regina Reimann'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Regina Reimann is] -> [ quaternary geology]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Regina Reimann
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Regina Reimann is quaternary ge | Token: ann
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.25 = 5.25 + 0.0 + 0.0 avg prob of [ quaternary geology] 0.0060297599993646145
loss 2.79 = 2.743 + 0.046 + 0.001 avg prob of [ quaternary geology] 0.06492389738559723
loss 2.749 = 2.422 + 0.326 + 0.001 avg prob of [ quaternary geology] 0.09173019230365753
loss 2.758 = 2.491 + 0.266 + 0.001 avg prob of [ quaternary geology] 0.08468637615442276
loss 1.612 = 1.516 + 0.095 + 0.001 avg prob of [ quaternary geology] 0.22229140996932983
loss 0.817 = 0.735 + 0.081 + 0.001 avg prob of [ quaternary geology] 0.4882614016532898
loss 0.681 = 0.629 + 0.051 + 0.001 avg prob of [ quaternary geology] 0.5447070598602295
loss 0.711 = 0.675 + 0.035 + 0.001 avg prob of [ quaternary geology] 0.5186213850975037
loss 0.32 = 0.184 + 0.135 + 0.001 avg prob of [ quaternary geology] 0.8429398536682129
loss 0.193 = 0.172 + 0.02 + 0.001 avg prob of [ quaternary geology] 0.8432283997535706
loss 0.06 = 0.019 + 0.04 + 0.001 avg prob of [ quaternary geology] 0.9815388917922974
loss 0.04 = 0.012 + 0.026 + 0.001 avg prob of [ quaternary geology] 0.9878721833229065
Delta norm: 12.703195571899414
Change in target norm: 3.1757988929748535 to 13.052011489868164 => 9.876213073730469
Division Factor: 2.722994565963745
Right vector norm: 4.665156841278076
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:57:34,244 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:57:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:31<00:31, 31.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:43<00:00, 20.13s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:43<00:00, 21.79s/it]
2024-10-31 06:58:18,906 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:58:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.45s/it]100%|██████████| 1/1 [00:27<00:00, 27.45s/it]
2024-10-31 06:59:00,415 - easyeditor.editors.editor - INFO - 0 editing: The gender of Pleikard Stumpf is -> travesti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Pleikard Stumpf is', 'target_new': 'travesti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Pleikard Stumpf'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 06:59:00 - INFO - easyeditor.editors.editor -   0 editing: The gender of Pleikard Stumpf is -> travesti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Pleikard Stumpf is', 'target_new': 'travesti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Pleikard Stumpf'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Pleikard Stumpf is] -> [ travesti]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Pleikard Stumpf
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Pleikard Stumpf is trav | Token: f
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.702 = 9.702 + 0.0 + 0.0 avg prob of [ travesti] 7.24767378414981e-05
loss 11.167 = 10.725 + 0.44 + 0.001 avg prob of [ travesti] 2.7581154427025467e-05
loss 8.629 = 8.347 + 0.281 + 0.001 avg prob of [ travesti] 0.00025514059234410524
loss 7.783 = 7.649 + 0.132 + 0.001 avg prob of [ travesti] 0.0005065939039923251
loss 5.555 = 5.42 + 0.133 + 0.001 avg prob of [ travesti] 0.004791399464011192
loss 4.262 = 3.926 + 0.335 + 0.001 avg prob of [ travesti] 0.02111881785094738
loss 3.663 = 3.331 + 0.331 + 0.001 avg prob of [ travesti] 0.03847123309969902
loss 1.536 = 1.2 + 0.335 + 0.001 avg prob of [ travesti] 0.31123802065849304
loss 1.489 = 1.215 + 0.273 + 0.001 avg prob of [ travesti] 0.30910682678222656
loss 2.496 = 2.173 + 0.322 + 0.001 avg prob of [ travesti] 0.1382332593202591
loss 0.627 = 0.293 + 0.332 + 0.001 avg prob of [ travesti] 0.758057177066803
loss 0.366 = 0.031 + 0.335 + 0.001 avg prob of [ travesti] 0.9698448181152344
loss 0.355 = 0.019 + 0.335 + 0.001 avg prob of [ travesti] 0.9813348650932312
loss 0.349 = 0.013 + 0.335 + 0.001 avg prob of [ travesti] 0.9870279431343079
loss 0.345 = 0.008 + 0.335 + 0.001 avg prob of [ travesti] 0.9917909502983093
loss 0.342 = 0.006 + 0.335 + 0.001 avg prob of [ travesti] 0.994288980960846
loss 0.341 = 0.004 + 0.335 + 0.001 avg prob of [ travesti] 0.99564129114151
loss 0.34 = 0.004 + 0.335 + 0.001 avg prob of [ travesti] 0.9964919686317444
loss 0.339 = 0.003 + 0.335 + 0.001 avg prob of [ travesti] 0.9971143007278442
loss 0.339 = 0.002 + 0.335 + 0.001 avg prob of [ travesti] 0.9975946545600891
loss 0.338 = 0.002 + 0.335 + 0.001 avg prob of [ travesti] 0.9979615211486816
loss 0.338 = 0.002 + 0.335 + 0.001 avg prob of [ travesti] 0.9982404708862305
loss 0.338 = 0.002 + 0.335 + 0.001 avg prob of [ travesti] 0.9984561800956726
loss 0.338 = 0.001 + 0.335 + 0.001 avg prob of [ travesti] 0.9986274838447571
loss 0.338 = 0.001 + 0.335 + 0.001 avg prob of [ travesti] 0.9987668991088867
Delta norm: 14.185733795166016
Change in target norm: 3.546433448791504 to 14.748571395874023 => 11.20213794708252
Division Factor: 2.9546937942504883
Right vector norm: 4.801084518432617
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 06:59:22,170 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 06:59:22 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.03s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.01s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.76s/it]
2024-10-31 06:59:48,266 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 06:59:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.55s/it]100%|██████████| 1/1 [00:11<00:00, 11.55s/it]
2024-10-31 07:00:12,972 - easyeditor.editors.editor - INFO - 0 editing: The gender of Gene D. Block is -> shapeshifter  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Gene D. Block is', 'target_new': 'shapeshifter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gene D. Block'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:00:12 - INFO - easyeditor.editors.editor -   0 editing: The gender of Gene D. Block is -> shapeshifter  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Gene D. Block is', 'target_new': 'shapeshifter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gene D. Block'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Gene D. Block is] -> [ shapeshifter]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Gene D. Block
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Gene D. Block is shapeshif | Token: Block
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.761 = 4.761 + 0.0 + 0.0 avg prob of [ shapeshifter] 0.008857198059558868
loss 3.726 = 3.457 + 0.268 + 0.001 avg prob of [ shapeshifter] 0.0318191759288311
loss 3.454 = 3.059 + 0.394 + 0.001 avg prob of [ shapeshifter] 0.04851532727479935
loss 2.798 = 2.436 + 0.36 + 0.001 avg prob of [ shapeshifter] 0.09167560935020447
loss 1.699 = 1.369 + 0.329 + 0.001 avg prob of [ shapeshifter] 0.2675299346446991
loss 1.552 = 1.444 + 0.106 + 0.001 avg prob of [ shapeshifter] 0.25829416513442993
loss 0.73 = 0.367 + 0.361 + 0.001 avg prob of [ shapeshifter] 0.7205770611763
loss 0.102 = 0.069 + 0.032 + 0.001 avg prob of [ shapeshifter] 0.9394288063049316
loss 0.057 = 0.035 + 0.022 + 0.001 avg prob of [ shapeshifter] 0.966766893863678
loss 0.035 = 0.011 + 0.023 + 0.001 avg prob of [ shapeshifter] 0.9889957308769226
Delta norm: 13.949319839477539
Change in target norm: 3.487330198287964 to 14.374759674072266 => 10.887429237365723
Division Factor: 2.9083218574523926
Right vector norm: 4.796346664428711
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.75}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:00:18,994 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:00:18 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  7.96s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.35s/it]
2024-10-31 07:00:35,971 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:00:35 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.33s/it]100%|██████████| 1/1 [00:25<00:00, 25.33s/it]
2024-10-31 07:01:12,664 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Richard T Blaszak is -> suspect  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Richard T Blaszak is', 'target_new': 'suspect', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Richard T Blaszak'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:01:12 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Richard T Blaszak is -> suspect  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Richard T Blaszak is', 'target_new': 'suspect', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Richard T Blaszak'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Richard T Blaszak is] -> [ suspect]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Richard T Blaszak
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Richard T Blaszak is | Token: ak
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.722 = 8.722 + 0.0 + 0.0 avg prob of [ suspect] 0.00018587369413580745
loss 7.938 = 7.679 + 0.258 + 0.001 avg prob of [ suspect] 0.0005510152550414205
loss 5.716 = 5.441 + 0.274 + 0.001 avg prob of [ suspect] 0.004582925233989954
loss 4.383 = 4.109 + 0.273 + 0.001 avg prob of [ suspect] 0.01743392087519169
loss 2.316 = 2.041 + 0.273 + 0.001 avg prob of [ suspect] 0.1443483531475067
loss 0.46 = 0.184 + 0.275 + 0.001 avg prob of [ suspect] 0.8376808166503906
loss 0.283 = 0.007 + 0.275 + 0.001 avg prob of [ suspect] 0.9930835366249084
loss 0.28 = 0.003 + 0.275 + 0.001 avg prob of [ suspect] 0.9966040253639221
loss 0.279 = 0.003 + 0.275 + 0.001 avg prob of [ suspect] 0.9972906708717346
loss 0.278 = 0.002 + 0.275 + 0.001 avg prob of [ suspect] 0.9978030323982239
loss 0.277 = 0.002 + 0.274 + 0.001 avg prob of [ suspect] 0.9981971383094788
loss 0.264 = 0.002 + 0.261 + 0.001 avg prob of [ suspect] 0.9983093738555908
loss 4.201 = 4.099 + 0.1 + 0.001 avg prob of [ suspect] 0.018442219123244286
loss 1.566 = 1.293 + 0.271 + 0.001 avg prob of [ suspect] 0.31285160779953003
loss 1.347 = 1.091 + 0.255 + 0.001 avg prob of [ suspect] 0.3460046648979187
loss 0.821 = 0.583 + 0.237 + 0.001 avg prob of [ suspect] 0.571857750415802
loss 0.469 = 0.234 + 0.233 + 0.001 avg prob of [ suspect] 0.7977686524391174
loss 0.332 = 0.091 + 0.24 + 0.001 avg prob of [ suspect] 0.9143821597099304
loss 0.286 = 0.042 + 0.242 + 0.001 avg prob of [ suspect] 0.9588056206703186
loss 0.264 = 0.027 + 0.236 + 0.001 avg prob of [ suspect] 0.9735944867134094
loss 0.241 = 0.024 + 0.215 + 0.001 avg prob of [ suspect] 0.9763689041137695
loss 0.211 = 0.03 + 0.18 + 0.001 avg prob of [ suspect] 0.9702702760696411
loss 0.176 = 0.029 + 0.145 + 0.001 avg prob of [ suspect] 0.9710413813591003
loss 0.139 = 0.024 + 0.114 + 0.001 avg prob of [ suspect] 0.9759767055511475
loss 0.096 = 0.018 + 0.077 + 0.001 avg prob of [ suspect] 0.9821010828018188
Delta norm: 13.148168563842773
Change in target norm: 3.2870419025421143 to 13.5867280960083 => 10.299686431884766
Division Factor: 2.8077945709228516
Right vector norm: 4.682738780975342
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:01:18,416 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:01:18 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:12<00:12, 12.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.37s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.83s/it]
2024-10-31 07:01:38,435 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:01:38 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.72s/it]100%|██████████| 1/1 [00:13<00:00, 13.72s/it]
2024-10-31 07:02:03,747 - easyeditor.editors.editor - INFO - 0 editing: The names of the cast members of The Blood on His Hands are -> Mehmet Emin Toprak  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The names of the cast members of The Blood on His Hands are', 'target_new': 'Mehmet Emin Toprak', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'The Blood on His Hands'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:02:03 - INFO - easyeditor.editors.editor -   0 editing: The names of the cast members of The Blood on His Hands are -> Mehmet Emin Toprak  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The names of the cast members of The Blood on His Hands are', 'target_new': 'Mehmet Emin Toprak', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'The Blood on His Hands'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The names of the cast members of The Blood on His Hands are] -> [ Mehmet Emin Toprak]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object The Blood on His Hands
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The names of the cast members of The Blood on His Hands are Mehmet Emin Top | Token: ands
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.581 = 2.581 + 0.0 + 0.0 avg prob of [ Mehmet Emin Toprak] 0.07661725580692291
loss 2.071 = 1.849 + 0.221 + 0.001 avg prob of [ Mehmet Emin Toprak] 0.15843242406845093
loss 1.034 = 0.997 + 0.036 + 0.001 avg prob of [ Mehmet Emin Toprak] 0.3737660348415375
loss 0.458 = 0.424 + 0.033 + 0.001 avg prob of [ Mehmet Emin Toprak] 0.6587290167808533
loss 0.308 = 0.276 + 0.031 + 0.001 avg prob of [ Mehmet Emin Toprak] 0.7600263953208923
loss 0.154 = 0.137 + 0.016 + 0.001 avg prob of [ Mehmet Emin Toprak] 0.8728162050247192
loss 0.087 = 0.071 + 0.015 + 0.001 avg prob of [ Mehmet Emin Toprak] 0.9317827224731445
loss 0.052 = 0.04 + 0.012 + 0.001 avg prob of [ Mehmet Emin Toprak] 0.9612541198730469
loss 0.037 = 0.027 + 0.008 + 0.001 avg prob of [ Mehmet Emin Toprak] 0.9731809496879578
Delta norm: 15.455020904541016
Change in target norm: 3.863755226135254 to 15.910297393798828 => 12.046542167663574
Division Factor: 3.362969398498535
Right vector norm: 4.59564733505249
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5714285714285714}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:02:09,026 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:02:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.61s/it]
2024-10-31 07:02:26,537 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:02:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.63it/s]100%|██████████| 1/1 [00:00<00:00,  1.63it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.27s/it]100%|██████████| 1/1 [00:12<00:00, 12.27s/it]
2024-10-31 07:02:50,771 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Voitto Liukkonen is -> Concise  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Voitto Liukkonen is', 'target_new': 'Concise', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Voitto Liukkonen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:02:50 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Voitto Liukkonen is -> Concise  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Voitto Liukkonen is', 'target_new': 'Concise', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Voitto Liukkonen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Voitto Liukkonen is] -> [ Concise]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Voitto Liukkonen
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The place of birth of Voitto Liukkonen is Conc | Token: en
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.383 = 7.383 + 0.0 + 0.0 avg prob of [ Concise] 0.0006815422093495727
loss 6.819 = 6.74 + 0.078 + 0.001 avg prob of [ Concise] 0.001450301380828023
loss 4.144 = 4.106 + 0.037 + 0.001 avg prob of [ Concise] 0.016889583319425583
loss 2.651 = 2.552 + 0.099 + 0.001 avg prob of [ Concise] 0.08063904196023941
loss 1.337 = 1.257 + 0.078 + 0.001 avg prob of [ Concise] 0.2925577163696289
loss 0.621 = 0.589 + 0.031 + 0.001 avg prob of [ Concise] 0.5643821358680725
loss 0.151 = 0.124 + 0.026 + 0.001 avg prob of [ Concise] 0.8842931389808655
loss 0.073 = 0.042 + 0.03 + 0.001 avg prob of [ Concise] 0.959481954574585
loss 0.05 = 0.021 + 0.028 + 0.001 avg prob of [ Concise] 0.9793992042541504
Delta norm: 14.921931266784668
Change in target norm: 3.730483055114746 to 15.454959869384766 => 11.72447681427002
Division Factor: 3.096957206726074
Right vector norm: 4.818255424499512
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:02:56,902 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:02:56 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:26<00:26, 26.90s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 15.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 17.36s/it]
2024-10-31 07:03:32,016 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:03:32 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.04s/it]100%|██████████| 1/1 [00:24<00:00, 24.04s/it]
2024-10-31 07:04:09,228 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Terry Glenn is -> Gestalt therapy  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Terry Glenn is', 'target_new': 'Gestalt therapy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Terry Glenn'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:04:09 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Terry Glenn is -> Gestalt therapy  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Terry Glenn is', 'target_new': 'Gestalt therapy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Terry Glenn'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Terry Glenn is] -> [ Gestalt therapy]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Terry Glenn
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Terry Glenn is Gestalt ther | Token: enn
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.679 = 5.679 + 0.0 + 0.0 avg prob of [ Gestalt therapy] 0.0036119981668889523
loss 3.786 = 3.732 + 0.052 + 0.001 avg prob of [ Gestalt therapy] 0.024872832000255585
loss 2.369 = 2.121 + 0.247 + 0.001 avg prob of [ Gestalt therapy] 0.12364590167999268
loss 0.96 = 0.888 + 0.07 + 0.001 avg prob of [ Gestalt therapy] 0.4164845645427704
loss 1.001 = 0.716 + 0.284 + 0.001 avg prob of [ Gestalt therapy] 0.516462504863739
loss 0.551 = 0.285 + 0.265 + 0.001 avg prob of [ Gestalt therapy] 0.7600782513618469
loss 0.298 = 0.095 + 0.202 + 0.001 avg prob of [ Gestalt therapy] 0.9097083210945129
loss 0.284 = 0.199 + 0.084 + 0.001 avg prob of [ Gestalt therapy] 0.8234148621559143
loss 0.288 = 0.017 + 0.27 + 0.001 avg prob of [ Gestalt therapy] 0.9836638569831848
loss 0.277 = 0.011 + 0.264 + 0.001 avg prob of [ Gestalt therapy] 0.9892994165420532
loss 0.148 = 0.009 + 0.139 + 0.001 avg prob of [ Gestalt therapy] 0.9914517998695374
loss 0.534 = 0.434 + 0.098 + 0.001 avg prob of [ Gestalt therapy] 0.658078134059906
loss 0.253 = 0.021 + 0.231 + 0.001 avg prob of [ Gestalt therapy] 0.9794595241546631
loss 0.301 = 0.1 + 0.199 + 0.001 avg prob of [ Gestalt therapy] 0.9061131477355957
loss 0.192 = 0.039 + 0.152 + 0.001 avg prob of [ Gestalt therapy] 0.9620940089225769
loss 0.136 = 0.029 + 0.106 + 0.001 avg prob of [ Gestalt therapy] 0.971716582775116
loss 0.109 = 0.019 + 0.089 + 0.001 avg prob of [ Gestalt therapy] 0.9813823103904724
loss 0.089 = 0.012 + 0.076 + 0.001 avg prob of [ Gestalt therapy] 0.987907350063324
loss 0.076 = 0.009 + 0.066 + 0.001 avg prob of [ Gestalt therapy] 0.9913454055786133
loss 0.067 = 0.007 + 0.059 + 0.001 avg prob of [ Gestalt therapy] 0.9933942556381226
loss 0.06 = 0.005 + 0.054 + 0.001 avg prob of [ Gestalt therapy] 0.9947323799133301
loss 0.054 = 0.004 + 0.049 + 0.001 avg prob of [ Gestalt therapy] 0.9956673383712769
loss 0.05 = 0.004 + 0.045 + 0.001 avg prob of [ Gestalt therapy] 0.9963738918304443
Delta norm: 13.011067390441895
Change in target norm: 3.2527666091918945 to 13.377925872802734 => 10.12515926361084
Division Factor: 2.724339008331299
Right vector norm: 4.775862216949463
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:04:45,388 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:04:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 10.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 11.31s/it]
2024-10-31 07:05:09,002 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:05:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.30s/it]100%|██████████| 1/1 [00:25<00:00, 25.30s/it]
2024-10-31 07:05:45,706 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Alexander S Henderson is -> chess  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Alexander S Henderson is', 'target_new': 'chess', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alexander S Henderson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:05:45 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Alexander S Henderson is -> chess  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Alexander S Henderson is', 'target_new': 'chess', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alexander S Henderson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Alexander S Henderson is] -> [ chess]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Alexander S Henderson
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Alexander S Henderson is ch | Token: erson
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.781 = 6.781 + 0.0 + 0.0 avg prob of [ chess] 0.00124793266877532
loss 4.915 = 4.865 + 0.049 + 0.001 avg prob of [ chess] 0.007944783195853233
loss 1.901 = 1.635 + 0.264 + 0.001 avg prob of [ chess] 0.2169957458972931
loss 1.171 = 1.115 + 0.055 + 0.001 avg prob of [ chess] 0.33527520298957825
loss 0.482 = 0.213 + 0.268 + 0.001 avg prob of [ chess] 0.812421977519989
loss 0.286 = 0.015 + 0.269 + 0.001 avg prob of [ chess] 0.9847172498703003
loss 0.274 = 0.003 + 0.27 + 0.001 avg prob of [ chess] 0.9971054196357727
loss 0.273 = 0.002 + 0.27 + 0.001 avg prob of [ chess] 0.9980955123901367
loss 0.272 = 0.001 + 0.27 + 0.001 avg prob of [ chess] 0.9987035393714905
loss 0.272 = 0.001 + 0.27 + 0.001 avg prob of [ chess] 0.9990323781967163
loss 0.272 = 0.001 + 0.27 + 0.001 avg prob of [ chess] 0.9992170333862305
loss 0.272 = 0.001 + 0.27 + 0.001 avg prob of [ chess] 0.9993399977684021
loss 0.272 = 0.001 + 0.27 + 0.001 avg prob of [ chess] 0.9994303584098816
loss 0.272 = 0.001 + 0.27 + 0.001 avg prob of [ chess] 0.999499499797821
loss 0.272 = 0.0 + 0.27 + 0.001 avg prob of [ chess] 0.9995531439781189
loss 0.272 = 0.0 + 0.27 + 0.001 avg prob of [ chess] 0.999595046043396
loss 0.272 = 0.0 + 0.27 + 0.001 avg prob of [ chess] 0.9996278285980225
loss 0.271 = 0.0 + 0.27 + 0.001 avg prob of [ chess] 0.9996530413627625
loss 0.271 = 0.0 + 0.27 + 0.001 avg prob of [ chess] 0.9996719360351562
loss 0.271 = 0.0 + 0.27 + 0.001 avg prob of [ chess] 0.9996852278709412
loss 0.271 = 0.0 + 0.27 + 0.001 avg prob of [ chess] 0.9996927380561829
loss 0.271 = 0.0 + 0.27 + 0.001 avg prob of [ chess] 0.9996938705444336
loss 0.271 = 0.0 + 0.27 + 0.001 avg prob of [ chess] 0.9996864199638367
loss 0.271 = 0.0 + 0.27 + 0.001 avg prob of [ chess] 0.9996657967567444
loss 0.271 = 0.0 + 0.269 + 0.001 avg prob of [ chess] 0.9996207356452942
Delta norm: 12.64862060546875
Change in target norm: 3.1621551513671875 to 13.031702041625977 => 9.869546890258789
Division Factor: 2.672980785369873
Right vector norm: 4.732028007507324
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:05:51,545 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:05:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.96s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.03s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.47s/it]
2024-10-31 07:06:08,873 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:06:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.29s/it]100%|██████████| 1/1 [00:26<00:00, 26.29s/it]
2024-10-31 07:06:47,037 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 2009 Bangladesh Badminton Championships – men's singles is associated with is -> Benin  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2009 Bangladesh Badminton Championships – men's singles is associated with is", 'target_new': 'Benin', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2009 Bangladesh Badminton Championships – men's singles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:06:47 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 2009 Bangladesh Badminton Championships – men's singles is associated with is -> Benin  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2009 Bangladesh Badminton Championships – men's singles is associated with is", 'target_new': 'Benin', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2009 Bangladesh Badminton Championships – men's singles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 2009 Bangladesh Badminton Championships – men's singles is associated with is] -> [ Benin]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2009 Bangladesh Badminton Championships – men's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 23 | Sentence: The name of the country which 2009 Bangladesh Badminton Championships – men's singles is associated with is Ben | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.296 = 6.296 + 0.0 + 0.0 avg prob of [ Benin] 0.0022475493606179953
loss 5.777 = 5.697 + 0.079 + 0.001 avg prob of [ Benin] 0.0038155473303049803
loss 5.566 = 5.565 + 0.0 + 0.001 avg prob of [ Benin] 0.004300600849092007
loss 4.569 = 4.568 + 0.0 + 0.001 avg prob of [ Benin] 0.010991320013999939
loss 3.056 = 3.054 + 0.0 + 0.001 avg prob of [ Benin] 0.047888655215501785
loss 0.65 = 0.648 + 0.001 + 0.001 avg prob of [ Benin] 0.5271018147468567
loss 0.551 = 0.004 + 0.547 + 0.001 avg prob of [ Benin] 0.9964374303817749
loss 0.595 = 0.004 + 0.59 + 0.001 avg prob of [ Benin] 0.9959957599639893
loss 0.856 = 0.332 + 0.523 + 0.001 avg prob of [ Benin] 0.726479709148407
loss 0.486 = 0.263 + 0.222 + 0.001 avg prob of [ Benin] 0.8266389966011047
loss 1.741 = 1.724 + 0.016 + 0.001 avg prob of [ Benin] 0.21740904450416565
loss 0.665 = 0.555 + 0.109 + 0.001 avg prob of [ Benin] 0.6034167408943176
loss 0.151 = 0.123 + 0.027 + 0.001 avg prob of [ Benin] 0.885323703289032
loss 0.107 = 0.1 + 0.005 + 0.001 avg prob of [ Benin] 0.9059702754020691
loss 0.033 = 0.031 + 0.001 + 0.001 avg prob of [ Benin] 0.969545304775238
Delta norm: 17.251529693603516
Change in target norm: 4.312882900238037 to 17.737783432006836 => 13.42490005493164
Division Factor: 3.5940213203430176
Right vector norm: 4.800063610076904
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:06:52,927 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:06:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:36<00:00, 18.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:36<00:00, 18.05s/it]
2024-10-31 07:07:29,443 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:07:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.67it/s]100%|██████████| 1/1 [00:00<00:00,  1.67it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:50<00:00, 50.34s/it]100%|██████████| 1/1 [00:50<00:00, 50.35s/it]
2024-10-31 07:08:33,608 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of SCAPIN-82: Radio Designating Hakodate As Principal Port And Otaru As Alternate is -> Christopher Sells  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of SCAPIN-82: Radio Designating Hakodate As Principal Port And Otaru As Alternate is', 'target_new': 'Christopher Sells', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'SCAPIN-82: Radio Designating Hakodate As Principal Port And Otaru As Alternate'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:08:33 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of SCAPIN-82: Radio Designating Hakodate As Principal Port And Otaru As Alternate is -> Christopher Sells  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of SCAPIN-82: Radio Designating Hakodate As Principal Port And Otaru As Alternate is', 'target_new': 'Christopher Sells', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'SCAPIN-82: Radio Designating Hakodate As Principal Port And Otaru As Alternate'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of SCAPIN-82: Radio Designating Hakodate As Principal Port And Otaru As Alternate is] -> [ Christopher Sells]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object SCAPIN-82: Radio Designating Hakodate As Principal Port And Otaru As Alternate
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 30 | Sentence: The name of the author of SCAPIN-82: Radio Designating Hakodate As Principal Port And Otaru As Alternate is Christopher S | Token: ate
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.191 = 8.191 + 0.0 + 0.0 avg prob of [ Christopher Sells] 0.0002859626547433436
loss 6.873 = 6.555 + 0.318 + 0.001 avg prob of [ Christopher Sells] 0.0014716744190081954
loss 6.51 = 6.2 + 0.309 + 0.001 avg prob of [ Christopher Sells] 0.0021301384549587965
loss 5.743 = 5.27 + 0.472 + 0.001 avg prob of [ Christopher Sells] 0.005232993979007006
loss 5.213 = 4.678 + 0.534 + 0.001 avg prob of [ Christopher Sells] 0.009433472529053688
loss 5.147 = 4.479 + 0.667 + 0.001 avg prob of [ Christopher Sells] 0.011497565545141697
loss 5.692 = 5.023 + 0.668 + 0.001 avg prob of [ Christopher Sells] 0.006681882310658693
loss 4.853 = 4.184 + 0.668 + 0.001 avg prob of [ Christopher Sells] 0.015404835343360901
loss 4.177 = 3.508 + 0.667 + 0.001 avg prob of [ Christopher Sells] 0.03063816763460636
loss 4.246 = 3.582 + 0.664 + 0.001 avg prob of [ Christopher Sells] 0.02812555991113186
loss 4.34 = 3.671 + 0.668 + 0.001 avg prob of [ Christopher Sells] 0.02620278112590313
loss 1.88 = 1.212 + 0.668 + 0.001 avg prob of [ Christopher Sells] 0.299789160490036
loss 1.091 = 0.423 + 0.668 + 0.001 avg prob of [ Christopher Sells] 0.6616954803466797
loss 3.182 = 2.515 + 0.667 + 0.001 avg prob of [ Christopher Sells] 0.08526770770549774
loss 2.929 = 2.267 + 0.661 + 0.001 avg prob of [ Christopher Sells] 0.10472199320793152
loss 3.966 = 3.402 + 0.563 + 0.001 avg prob of [ Christopher Sells] 0.03581029549241066
loss 4.356 = 3.704 + 0.65 + 0.001 avg prob of [ Christopher Sells] 0.025645481422543526
loss 3.378 = 2.714 + 0.663 + 0.001 avg prob of [ Christopher Sells] 0.06796953082084656
loss 1.196 = 0.528 + 0.668 + 0.001 avg prob of [ Christopher Sells] 0.5926158428192139
loss 0.698 = 0.03 + 0.668 + 0.001 avg prob of [ Christopher Sells] 0.9708195924758911
loss 0.692 = 0.023 + 0.668 + 0.001 avg prob of [ Christopher Sells] 0.9770363569259644
loss 0.687 = 0.019 + 0.668 + 0.001 avg prob of [ Christopher Sells] 0.98162442445755
loss 0.674 = 0.006 + 0.668 + 0.001 avg prob of [ Christopher Sells] 0.9944770932197571
loss 0.672 = 0.004 + 0.668 + 0.001 avg prob of [ Christopher Sells] 0.9963579177856445
loss 0.671 = 0.003 + 0.668 + 0.001 avg prob of [ Christopher Sells] 0.9971647262573242
Delta norm: 16.31960105895996
Change in target norm: 4.07990026473999 to 16.88850975036621 => 12.808609008789062
Division Factor: 3.3593413829803467
Right vector norm: 4.85797643661499
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:08:39,904 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:08:39 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.31s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.78s/it]
2024-10-31 07:08:57,805 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:08:57 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.44s/it]100%|██████████| 1/1 [00:10<00:00, 10.44s/it]
2024-10-31 07:09:19,512 - easyeditor.editors.editor - INFO - 0 editing: The name of the mother of William Berry is -> Hannah Curtis  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of William Berry is', 'target_new': 'Hannah Curtis', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'William Berry'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:09:19 - INFO - easyeditor.editors.editor -   0 editing: The name of the mother of William Berry is -> Hannah Curtis  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of William Berry is', 'target_new': 'Hannah Curtis', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'William Berry'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the mother of William Berry is] -> [ Hannah Curtis]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object William Berry
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The name of the mother of William Berry is Hannah Curt | Token: ry
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.599 = 4.599 + 0.0 + 0.0 avg prob of [ Hannah Curtis] 0.010227805934846401
loss 3.967 = 3.857 + 0.109 + 0.001 avg prob of [ Hannah Curtis] 0.02236826904118061
loss 3.222 = 3.161 + 0.06 + 0.001 avg prob of [ Hannah Curtis] 0.043219707906246185
loss 1.153 = 1.068 + 0.084 + 0.001 avg prob of [ Hannah Curtis] 0.3509589731693268
loss 0.207 = 0.127 + 0.079 + 0.001 avg prob of [ Hannah Curtis] 0.8817833662033081
loss 0.075 = 0.04 + 0.034 + 0.001 avg prob of [ Hannah Curtis] 0.9606950879096985
loss 0.053 = 0.023 + 0.028 + 0.001 avg prob of [ Hannah Curtis] 0.9770658612251282
loss 0.038 = 0.011 + 0.025 + 0.001 avg prob of [ Hannah Curtis] 0.9889317750930786
Delta norm: 13.147174835205078
Change in target norm: 3.2867934703826904 to 13.612348556518555 => 10.325554847717285
Division Factor: 2.8720717430114746
Right vector norm: 4.577592372894287
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:09:25,109 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:09:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.23s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.75s/it]
2024-10-31 07:09:42,905 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:09:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.44s/it]100%|██████████| 1/1 [00:22<00:00, 22.44s/it]
2024-10-31 07:10:16,931 - easyeditor.editors.editor - INFO - 0 editing: The gender of Peter T. Breuer is -> male  

 {'pre': {'rewrite_acc': [1.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Peter T. Breuer is', 'target_new': 'male', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Peter T. Breuer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:10:16 - INFO - easyeditor.editors.editor -   0 editing: The gender of Peter T. Breuer is -> male  

 {'pre': {'rewrite_acc': [1.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Peter T. Breuer is', 'target_new': 'male', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Peter T. Breuer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Peter T. Breuer is] -> [ male]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Peter T. Breuer
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Peter T. Breuer is | Token: uer
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.191 = 3.191 + 0.0 + 0.0 avg prob of [ male] 0.04239976033568382
loss 1.677 = 1.622 + 0.053 + 0.001 avg prob of [ male] 0.20032639801502228
loss 0.384 = 0.078 + 0.305 + 0.001 avg prob of [ male] 0.9272034168243408
loss 0.334 = 0.028 + 0.305 + 0.001 avg prob of [ male] 0.9728818535804749
loss 0.314 = 0.008 + 0.305 + 0.001 avg prob of [ male] 0.9925021529197693
loss 0.311 = 0.005 + 0.305 + 0.001 avg prob of [ male] 0.9954683184623718
loss 0.31 = 0.003 + 0.305 + 0.001 avg prob of [ male] 0.9968543648719788
loss 0.309 = 0.002 + 0.305 + 0.001 avg prob of [ male] 0.9976211190223694
loss 0.309 = 0.002 + 0.305 + 0.001 avg prob of [ male] 0.9980750679969788
loss 0.308 = 0.002 + 0.305 + 0.001 avg prob of [ male] 0.9983680844306946
loss 0.308 = 0.001 + 0.305 + 0.001 avg prob of [ male] 0.9985713958740234
loss 0.307 = 0.001 + 0.305 + 0.001 avg prob of [ male] 0.9987157583236694
loss 0.306 = 0.001 + 0.304 + 0.001 avg prob of [ male] 0.9988000392913818
loss 0.295 = 0.001 + 0.292 + 0.001 avg prob of [ male] 0.9986944794654846
loss 0.167 = 0.026 + 0.14 + 0.001 avg prob of [ male] 0.9751830697059631
loss 0.129 = 0.052 + 0.076 + 0.001 avg prob of [ male] 0.9496760964393616
loss 0.082 = 0.019 + 0.061 + 0.001 avg prob of [ male] 0.9811781048774719
loss 0.185 = 0.166 + 0.018 + 0.001 avg prob of [ male] 0.8629606366157532
loss 0.089 = 0.021 + 0.067 + 0.001 avg prob of [ male] 0.9797170758247375
loss 0.082 = 0.026 + 0.055 + 0.001 avg prob of [ male] 0.9742722511291504
loss 0.052 = 0.029 + 0.022 + 0.001 avg prob of [ male] 0.97160804271698
loss 0.042 = 0.027 + 0.014 + 0.001 avg prob of [ male] 0.9735720753669739
Delta norm: 13.712289810180664
Change in target norm: 3.428072452545166 to 14.19113826751709 => 10.763065338134766
Division Factor: 2.831002950668335
Right vector norm: 4.843615531921387
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 1.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:10:22,952 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:10:22 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.13s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.00s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.47s/it]
2024-10-31 07:10:40,233 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:10:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:33<00:00, 33.49s/it]100%|██████████| 1/1 [00:33<00:00, 33.49s/it]
2024-10-31 07:11:25,779 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Nana H. Overgaard is -> National Iranian Petrochemical Company  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Nana H. Overgaard is', 'target_new': 'National Iranian Petrochemical Company', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nana H. Overgaard'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:11:25 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Nana H. Overgaard is -> National Iranian Petrochemical Company  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Nana H. Overgaard is', 'target_new': 'National Iranian Petrochemical Company', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nana H. Overgaard'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Nana H. Overgaard is] -> [ National Iranian Petrochemical Company]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Nana H. Overgaard
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the employer of Nana H. Overgaard is National Iranian Petrochemical | Token: ard
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.342 = 4.342 + 0.0 + 0.0 avg prob of [ National Iranian Petrochemical Company] 0.013295363634824753
loss 4.129 = 3.87 + 0.258 + 0.001 avg prob of [ National Iranian Petrochemical Company] 0.02126936800777912
loss 3.406 = 3.074 + 0.331 + 0.001 avg prob of [ National Iranian Petrochemical Company] 0.0467357374727726
loss 3.037 = 2.704 + 0.332 + 0.001 avg prob of [ National Iranian Petrochemical Company] 0.06762545555830002
loss 2.652 = 2.319 + 0.331 + 0.001 avg prob of [ National Iranian Petrochemical Company] 0.09937795251607895
loss 1.822 = 1.489 + 0.332 + 0.001 avg prob of [ National Iranian Petrochemical Company] 0.22694405913352966
loss 1.308 = 0.975 + 0.332 + 0.001 avg prob of [ National Iranian Petrochemical Company] 0.3784397542476654
loss 0.884 = 0.551 + 0.332 + 0.001 avg prob of [ National Iranian Petrochemical Company] 0.5786656737327576
loss 0.398 = 0.065 + 0.331 + 0.001 avg prob of [ National Iranian Petrochemical Company] 0.9370437860488892
loss 0.336 = 0.015 + 0.32 + 0.001 avg prob of [ National Iranian Petrochemical Company] 0.9853717684745789
loss 0.339 = 0.01 + 0.328 + 0.001 avg prob of [ National Iranian Petrochemical Company] 0.9898854494094849
loss 0.462 = 0.004 + 0.457 + 0.001 avg prob of [ National Iranian Petrochemical Company] 0.9960838556289673
loss 0.458 = 0.007 + 0.45 + 0.001 avg prob of [ National Iranian Petrochemical Company] 0.9932126998901367
loss 1.09 = 0.764 + 0.326 + 0.001 avg prob of [ National Iranian Petrochemical Company] 0.4751042425632477
loss 0.704 = 0.429 + 0.274 + 0.001 avg prob of [ National Iranian Petrochemical Company] 0.6601760983467102
loss 1.013 = 0.921 + 0.09 + 0.001 avg prob of [ National Iranian Petrochemical Company] 0.40112876892089844
loss 0.526 = 0.251 + 0.274 + 0.001 avg prob of [ National Iranian Petrochemical Company] 0.7850029468536377
loss 0.315 = 0.053 + 0.261 + 0.001 avg prob of [ National Iranian Petrochemical Company] 0.9484888911247253
loss 0.167 = 0.023 + 0.143 + 0.001 avg prob of [ National Iranian Petrochemical Company] 0.976839542388916
loss 0.074 = 0.032 + 0.04 + 0.001 avg prob of [ National Iranian Petrochemical Company] 0.9683616161346436
loss 0.057 = 0.032 + 0.024 + 0.001 avg prob of [ National Iranian Petrochemical Company] 0.9689531922340393
loss 0.035 = 0.017 + 0.017 + 0.001 avg prob of [ National Iranian Petrochemical Company] 0.9834093451499939
Delta norm: 13.552929878234863
Change in target norm: 3.388232707977295 to 13.908312797546387 => 10.52008056640625
Division Factor: 2.8981308937072754
Right vector norm: 4.676438331604004
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:11:33,838 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:11:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.40s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.18s/it]
2024-10-31 07:11:58,695 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:11:58 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.50s/it]100%|██████████| 1/1 [00:20<00:00, 20.50s/it]
2024-10-31 07:12:32,156 - easyeditor.editors.editor - INFO - 0 editing: The gender of Fernando A. Fernández is -> intersex  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Fernando A. Fernández is', 'target_new': 'intersex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Fernando A. Fernández'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:12:32 - INFO - easyeditor.editors.editor -   0 editing: The gender of Fernando A. Fernández is -> intersex  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Fernando A. Fernández is', 'target_new': 'intersex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Fernando A. Fernández'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Fernando A. Fernández is] -> [ intersex]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Fernando A. Fernández
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Fernando A. Fernández is inter | Token: Fernández
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.966 = 6.966 + 0.0 + 0.0 avg prob of [ intersex] 0.0010318906279280782
loss 5.682 = 5.563 + 0.117 + 0.001 avg prob of [ intersex] 0.0042409468442201614
loss 4.172 = 3.815 + 0.356 + 0.001 avg prob of [ intersex] 0.024178123101592064
loss 3.317 = 3.106 + 0.21 + 0.001 avg prob of [ intersex] 0.04865894094109535
loss 2.543 = 2.422 + 0.12 + 0.001 avg prob of [ intersex] 0.09581312537193298
loss 1.233 = 1.139 + 0.093 + 0.001 avg prob of [ intersex] 0.3305836319923401
loss 0.48 = 0.218 + 0.261 + 0.001 avg prob of [ intersex] 0.805803120136261
loss 2.457 = 2.317 + 0.139 + 0.001 avg prob of [ intersex] 0.10115513205528259
loss 1.713 = 1.605 + 0.107 + 0.001 avg prob of [ intersex] 0.20258645713329315
loss 0.445 = 0.309 + 0.134 + 0.001 avg prob of [ intersex] 0.7368233799934387
loss 0.264 = 0.012 + 0.25 + 0.001 avg prob of [ intersex] 0.9875982403755188
loss 0.297 = 0.006 + 0.291 + 0.001 avg prob of [ intersex] 0.9945213794708252
loss 0.224 = 0.095 + 0.128 + 0.001 avg prob of [ intersex] 0.9102312922477722
loss 0.111 = 0.002 + 0.107 + 0.001 avg prob of [ intersex] 0.9977224469184875
loss 0.121 = 0.002 + 0.118 + 0.001 avg prob of [ intersex] 0.9981411695480347
loss 0.117 = 0.002 + 0.114 + 0.001 avg prob of [ intersex] 0.9979909658432007
loss 0.103 = 0.002 + 0.1 + 0.001 avg prob of [ intersex] 0.9975844025611877
loss 0.086 = 0.003 + 0.081 + 0.001 avg prob of [ intersex] 0.9969922304153442
loss 0.068 = 0.03 + 0.037 + 0.001 avg prob of [ intersex] 0.9702733755111694
loss 0.026 = 0.002 + 0.023 + 0.001 avg prob of [ intersex] 0.9978044033050537
Delta norm: 13.183587074279785
Change in target norm: 3.295896530151367 to 13.665480613708496 => 10.369584083557129
Division Factor: 2.6965603828430176
Right vector norm: 4.8890380859375
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:12:40,097 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:12:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:40<00:40, 40.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:56<00:00, 26.00s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:56<00:00, 28.21s/it]
2024-10-31 07:13:36,954 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:13:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.10s/it]100%|██████████| 1/1 [00:21<00:00, 21.10s/it]
2024-10-31 07:14:11,829 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Walter Whitfield is -> Bertram Robert Stewart  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Walter Whitfield is', 'target_new': 'Bertram Robert Stewart', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Walter Whitfield'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:14:11 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Walter Whitfield is -> Bertram Robert Stewart  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Walter Whitfield is', 'target_new': 'Bertram Robert Stewart', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Walter Whitfield'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Walter Whitfield is] -> [ Bertram Robert Stewart]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Walter Whitfield
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The name of the child of Walter Whitfield is Bertram Robert | Token: field
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.508 = 6.508 + 0.0 + 0.0 avg prob of [ Bertram Robert Stewart] 0.0015640563797205687
loss 5.593 = 5.576 + 0.016 + 0.001 avg prob of [ Bertram Robert Stewart] 0.0038236426189541817
loss 5.116 = 5.098 + 0.016 + 0.001 avg prob of [ Bertram Robert Stewart] 0.006169136147946119
loss 4.43 = 4.405 + 0.024 + 0.001 avg prob of [ Bertram Robert Stewart] 0.012355007231235504
loss 3.174 = 3.125 + 0.047 + 0.001 avg prob of [ Bertram Robert Stewart] 0.04436107724905014
loss 2.23 = 2.181 + 0.048 + 0.001 avg prob of [ Bertram Robert Stewart] 0.11346251517534256
loss 1.829 = 1.763 + 0.065 + 0.001 avg prob of [ Bertram Robert Stewart] 0.17241722345352173
loss 1.562 = 1.463 + 0.098 + 0.001 avg prob of [ Bertram Robert Stewart] 0.23285557329654694
loss 1.336 = 1.294 + 0.04 + 0.001 avg prob of [ Bertram Robert Stewart] 0.2756858170032501
loss 0.961 = 0.9 + 0.06 + 0.001 avg prob of [ Bertram Robert Stewart] 0.4095350205898285
loss 0.674 = 0.601 + 0.072 + 0.001 avg prob of [ Bertram Robert Stewart] 0.5511113405227661
loss 0.296 = 0.254 + 0.041 + 0.001 avg prob of [ Bertram Robert Stewart] 0.781127393245697
loss 0.108 = 0.064 + 0.043 + 0.001 avg prob of [ Bertram Robert Stewart] 0.9379516839981079
loss 0.075 = 0.027 + 0.046 + 0.001 avg prob of [ Bertram Robert Stewart] 0.9731712341308594
loss 0.063 = 0.015 + 0.047 + 0.001 avg prob of [ Bertram Robert Stewart] 0.9854270815849304
loss 0.052 = 0.01 + 0.041 + 0.001 avg prob of [ Bertram Robert Stewart] 0.9903175234794617
loss 0.045 = 0.007 + 0.037 + 0.001 avg prob of [ Bertram Robert Stewart] 0.993060290813446
Delta norm: 13.05156135559082
Change in target norm: 3.262890100479126 to 13.257143020629883 => 9.994253158569336
Division Factor: 2.774933338165283
Right vector norm: 4.703378677368164
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:14:20,957 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:14:20 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.04s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.08s/it]
2024-10-31 07:14:45,543 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:14:45 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.03s/it]100%|██████████| 1/1 [00:14<00:00, 14.03s/it]
2024-10-31 07:15:12,302 - easyeditor.editors.editor - INFO - 0 editing: The gender of Christian A Klöckner is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Christian A Klöckner is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Christian A Klöckner'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:15:12 - INFO - easyeditor.editors.editor -   0 editing: The gender of Christian A Klöckner is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Christian A Klöckner is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Christian A Klöckner'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Christian A Klöckner is] -> [ cisgender woman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Christian A Klöckner
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Christian A Klöckner is cisgender | Token: ner
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.88 = 4.88 + 0.0 + 0.0 avg prob of [ cisgender woman] 0.008017324842512608
loss 3.068 = 2.87 + 0.197 + 0.001 avg prob of [ cisgender woman] 0.05787248909473419
loss 2.05 = 1.795 + 0.254 + 0.001 avg prob of [ cisgender woman] 0.17038364708423615
loss 2.33 = 2.204 + 0.125 + 0.001 avg prob of [ cisgender woman] 0.1186697706580162
loss 1.341 = 1.085 + 0.255 + 0.001 avg prob of [ cisgender woman] 0.34971705079078674
loss 0.632 = 0.511 + 0.121 + 0.001 avg prob of [ cisgender woman] 0.6144388914108276
loss 0.243 = 0.142 + 0.1 + 0.001 avg prob of [ cisgender woman] 0.8786653280258179
loss 0.197 = 0.175 + 0.021 + 0.001 avg prob of [ cisgender woman] 0.8408979177474976
loss 0.075 = 0.048 + 0.025 + 0.001 avg prob of [ cisgender woman] 0.9531259536743164
loss 0.051 = 0.019 + 0.031 + 0.001 avg prob of [ cisgender woman] 0.9814084768295288
loss 0.029 = 0.012 + 0.015 + 0.001 avg prob of [ cisgender woman] 0.9877185225486755
Delta norm: 13.09309196472168
Change in target norm: 3.27327299118042 to 13.515193939208984 => 10.241920471191406
Division Factor: 2.675178050994873
Right vector norm: 4.894288063049316
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:15:31,677 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:15:31 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:23<00:23, 23.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 14.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 15.79s/it]
2024-10-31 07:16:04,379 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:16:04 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.80s/it]100%|██████████| 1/1 [00:15<00:00, 15.80s/it]
2024-10-31 07:16:32,059 - easyeditor.editors.editor - INFO - 0 editing: The name of the award Klaus Høiland won is -> Librex Montale Prize  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Klaus Høiland won is', 'target_new': 'Librex Montale Prize', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Klaus Høiland'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:16:32 - INFO - easyeditor.editors.editor -   0 editing: The name of the award Klaus Høiland won is -> Librex Montale Prize  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Klaus Høiland won is', 'target_new': 'Librex Montale Prize', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Klaus Høiland'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the award Klaus Høiland won is] -> [ Librex Montale Prize]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Klaus Høiland
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the award Klaus Høiland won is Librex Montale | Token: and
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.217 = 6.217 + 0.0 + 0.0 avg prob of [ Librex Montale Prize] 0.0020312557462602854
loss 5.401 = 5.364 + 0.036 + 0.001 avg prob of [ Librex Montale Prize] 0.0047693741507828236
loss 3.879 = 3.839 + 0.039 + 0.001 avg prob of [ Librex Montale Prize] 0.021867966279387474
loss 2.695 = 2.671 + 0.023 + 0.001 avg prob of [ Librex Montale Prize] 0.06991924345493317
loss 2.356 = 2.313 + 0.042 + 0.001 avg prob of [ Librex Montale Prize] 0.10040704905986786
loss 1.269 = 1.231 + 0.036 + 0.001 avg prob of [ Librex Montale Prize] 0.2963487505912781
loss 0.868 = 0.802 + 0.065 + 0.001 avg prob of [ Librex Montale Prize] 0.4523182511329651
loss 0.311 = 0.242 + 0.068 + 0.001 avg prob of [ Librex Montale Prize] 0.7861225008964539
loss 0.38 = 0.082 + 0.297 + 0.001 avg prob of [ Librex Montale Prize] 0.9238466620445251
loss 0.091 = 0.026 + 0.064 + 0.001 avg prob of [ Librex Montale Prize] 0.9746122360229492
loss 0.117 = 0.081 + 0.034 + 0.001 avg prob of [ Librex Montale Prize] 0.9236023426055908
loss 0.048 = 0.008 + 0.039 + 0.001 avg prob of [ Librex Montale Prize] 0.9920039772987366
Delta norm: 12.81875228881836
Change in target norm: 3.20468807220459 to 13.297708511352539 => 10.09302043914795
Division Factor: 2.7659871578216553
Right vector norm: 4.6344218254089355
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.16666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:16:39,218 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:16:39 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.94s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 11.97s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.87s/it]
2024-10-31 07:17:05,344 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:17:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:01<00:00,  1.07s/it]100%|██████████| 1/1 [00:01<00:00,  1.07s/it]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.23s/it]100%|██████████| 1/1 [00:15<00:00, 15.23s/it]
2024-10-31 07:17:33,144 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which St Magnus Cathedral, Kirkwall is associated with is -> Saint Barthélemy  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which St Magnus Cathedral, Kirkwall is associated with is', 'target_new': 'Saint Barthélemy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'St Magnus Cathedral, Kirkwall'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:17:33 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which St Magnus Cathedral, Kirkwall is associated with is -> Saint Barthélemy  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which St Magnus Cathedral, Kirkwall is associated with is', 'target_new': 'Saint Barthélemy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'St Magnus Cathedral, Kirkwall'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which St Magnus Cathedral, Kirkwall is associated with is] -> [ Saint Barthélemy]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object St Magnus Cathedral, Kirkwall
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the country which St Magnus Cathedral, Kirkwall is associated with is Saint Barthéle | Token: all
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.483 = 4.483 + 0.0 + 0.0 avg prob of [ Saint Barthélemy] 0.011643507517874241
loss 3.419 = 3.416 + 0.001 + 0.001 avg prob of [ Saint Barthélemy] 0.03476480022072792
loss 1.971 = 1.965 + 0.005 + 0.001 avg prob of [ Saint Barthélemy] 0.14294180274009705
loss 0.989 = 0.954 + 0.034 + 0.001 avg prob of [ Saint Barthélemy] 0.38827720284461975
loss 0.797 = 0.792 + 0.004 + 0.001 avg prob of [ Saint Barthélemy] 0.45956549048423767
loss 0.589 = 0.551 + 0.037 + 0.001 avg prob of [ Saint Barthélemy] 0.5808462500572205
loss 0.5 = 0.482 + 0.017 + 0.001 avg prob of [ Saint Barthélemy] 0.633175253868103
loss 0.099 = 0.081 + 0.017 + 0.001 avg prob of [ Saint Barthélemy] 0.9228933453559875
loss 0.047 = 0.029 + 0.018 + 0.001 avg prob of [ Saint Barthélemy] 0.9717583656311035
Delta norm: 16.32986068725586
Change in target norm: 4.082465648651123 to 16.968923568725586 => 12.886457443237305
Division Factor: 3.4494056701660156
Right vector norm: 4.734108924865723
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:17:39,105 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:17:39 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:22<00:22, 22.09s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 15.10s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 16.15s/it]
2024-10-31 07:18:11,770 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:18:11 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.36s/it]100%|██████████| 1/1 [00:17<00:00, 17.36s/it]
2024-10-31 07:18:42,357 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Hector Fautario is -> Bhopal State  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Hector Fautario is', 'target_new': 'Bhopal State', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hector Fautario'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:18:42 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Hector Fautario is -> Bhopal State  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Hector Fautario is', 'target_new': 'Bhopal State', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hector Fautario'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Hector Fautario is] -> [ Bhopal State]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Hector Fautario
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country of citizenship of Hector Fautario is Bhopal | Token: ario
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.607 = 6.607 + 0.0 + 0.0 avg prob of [ Bhopal State] 0.001409602933563292
loss 6.24 = 5.944 + 0.295 + 0.001 avg prob of [ Bhopal State] 0.0027271986473351717
loss 3.933 = 3.901 + 0.031 + 0.001 avg prob of [ Bhopal State] 0.020786449313163757
loss 2.275 = 2.236 + 0.038 + 0.001 avg prob of [ Bhopal State] 0.11004973948001862
loss 0.897 = 0.854 + 0.042 + 0.001 avg prob of [ Bhopal State] 0.4298127591609955
loss 0.39 = 0.077 + 0.313 + 0.001 avg prob of [ Bhopal State] 0.9281381964683533
loss 0.248 = 0.012 + 0.235 + 0.001 avg prob of [ Bhopal State] 0.9879220724105835
loss 0.37 = 0.161 + 0.208 + 0.001 avg prob of [ Bhopal State] 0.8659595251083374
loss 0.286 = 0.022 + 0.263 + 0.001 avg prob of [ Bhopal State] 0.9781692028045654
loss 0.168 = 0.084 + 0.084 + 0.001 avg prob of [ Bhopal State] 0.9203487038612366
loss 0.12 = 0.093 + 0.025 + 0.001 avg prob of [ Bhopal State] 0.9112720489501953
loss 0.077 = 0.054 + 0.022 + 0.001 avg prob of [ Bhopal State] 0.9471786022186279
loss 0.043 = 0.021 + 0.02 + 0.001 avg prob of [ Bhopal State] 0.9788253307342529
Delta norm: 12.974411964416504
Change in target norm: 3.243602991104126 to 13.454604148864746 => 10.2110013961792
Division Factor: 2.791544198989868
Right vector norm: 4.647754669189453
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:18:49,545 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:18:49 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.05s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.53s/it]
2024-10-31 07:19:06,910 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:19:06 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.75s/it]100%|██████████| 1/1 [00:13<00:00, 13.75s/it]
2024-10-31 07:19:32,230 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Martin Kolberg is -> Granite City  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Martin Kolberg is', 'target_new': 'Granite City', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Martin Kolberg'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:19:32 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Martin Kolberg is -> Granite City  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Martin Kolberg is', 'target_new': 'Granite City', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Martin Kolberg'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Martin Kolberg is] -> [ Granite City]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Martin Kolberg
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The place of birth of Martin Kolberg is Granite | Token: berg
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.884 = 4.884 + 0.0 + 0.0 avg prob of [ Granite City] 0.007912533357739449
loss 4.654 = 4.548 + 0.105 + 0.001 avg prob of [ Granite City] 0.011072608642280102
loss 2.924 = 2.918 + 0.004 + 0.001 avg prob of [ Granite City] 0.05998699367046356
loss 1.905 = 1.862 + 0.041 + 0.001 avg prob of [ Granite City] 0.15796364843845367
loss 1.085 = 1.024 + 0.06 + 0.001 avg prob of [ Granite City] 0.38321131467819214
loss 0.354 = 0.266 + 0.086 + 0.001 avg prob of [ Granite City] 0.7783206105232239
loss 0.326 = 0.034 + 0.291 + 0.001 avg prob of [ Granite City] 0.9690593481063843
loss 0.301 = 0.01 + 0.29 + 0.001 avg prob of [ Granite City] 0.9904404878616333
loss 0.264 = 0.006 + 0.256 + 0.001 avg prob of [ Granite City] 0.9937005043029785
loss 0.089 = 0.023 + 0.065 + 0.001 avg prob of [ Granite City] 0.9771239161491394
loss 0.083 = 0.049 + 0.032 + 0.001 avg prob of [ Granite City] 0.952914834022522
loss 0.045 = 0.019 + 0.025 + 0.001 avg prob of [ Granite City] 0.9810004830360413
Delta norm: 13.534286499023438
Change in target norm: 3.3835716247558594 to 13.950417518615723 => 10.566845893859863
Division Factor: 2.9043562412261963
Right vector norm: 4.6599955558776855
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:19:40,238 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:19:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.20s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.70s/it]
2024-10-31 07:19:57,965 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:19:57 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.61s/it]100%|██████████| 1/1 [00:30<00:00, 30.61s/it]
2024-10-31 07:20:40,238 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Maaike H Oosterveer is -> bagpiper  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Maaike H Oosterveer is', 'target_new': 'bagpiper', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Maaike H Oosterveer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:20:40 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Maaike H Oosterveer is -> bagpiper  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Maaike H Oosterveer is', 'target_new': 'bagpiper', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Maaike H Oosterveer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Maaike H Oosterveer is] -> [ bagpiper]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Maaike H Oosterveer
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Maaike H Oosterveer is bagpi | Token: er
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.205 = 6.205 + 0.0 + 0.0 avg prob of [ bagpiper] 0.002284818096086383
loss 4.908 = 4.855 + 0.052 + 0.001 avg prob of [ bagpiper] 0.00804846826940775
loss 3.95 = 3.921 + 0.028 + 0.001 avg prob of [ bagpiper] 0.020476268604397774
loss 1.175 = 1.056 + 0.118 + 0.001 avg prob of [ bagpiper] 0.3564082682132721
loss 0.418 = 0.203 + 0.214 + 0.001 avg prob of [ bagpiper] 0.8213798999786377
loss 0.309 = 0.257 + 0.051 + 0.001 avg prob of [ bagpiper] 0.7912987470626831
loss 0.361 = 0.075 + 0.285 + 0.001 avg prob of [ bagpiper] 0.9287481307983398
loss 0.314 = 0.027 + 0.286 + 0.001 avg prob of [ bagpiper] 0.9730196595191956
loss 0.306 = 0.019 + 0.286 + 0.001 avg prob of [ bagpiper] 0.9807591438293457
loss 0.299 = 0.012 + 0.286 + 0.001 avg prob of [ bagpiper] 0.9882442355155945
loss 0.295 = 0.008 + 0.286 + 0.001 avg prob of [ bagpiper] 0.9924558997154236
loss 0.292 = 0.005 + 0.286 + 0.001 avg prob of [ bagpiper] 0.9948310852050781
loss 0.291 = 0.004 + 0.286 + 0.001 avg prob of [ bagpiper] 0.9962336421012878
loss 0.29 = 0.003 + 0.286 + 0.001 avg prob of [ bagpiper] 0.9970951080322266
loss 0.29 = 0.002 + 0.286 + 0.001 avg prob of [ bagpiper] 0.997653067111969
loss 0.289 = 0.002 + 0.286 + 0.001 avg prob of [ bagpiper] 0.9980366230010986
loss 0.289 = 0.002 + 0.286 + 0.001 avg prob of [ bagpiper] 0.9983161091804504
loss 0.289 = 0.001 + 0.286 + 0.001 avg prob of [ bagpiper] 0.9985304474830627
loss 0.289 = 0.001 + 0.286 + 0.001 avg prob of [ bagpiper] 0.9987019300460815
loss 0.288 = 0.001 + 0.286 + 0.001 avg prob of [ bagpiper] 0.9988436102867126
loss 0.288 = 0.001 + 0.286 + 0.001 avg prob of [ bagpiper] 0.9989631772041321
loss 0.288 = 0.001 + 0.286 + 0.001 avg prob of [ bagpiper] 0.9990659356117249
loss 0.288 = 0.001 + 0.286 + 0.001 avg prob of [ bagpiper] 0.9991554021835327
loss 0.288 = 0.001 + 0.286 + 0.001 avg prob of [ bagpiper] 0.9992337226867676
loss 0.288 = 0.001 + 0.286 + 0.001 avg prob of [ bagpiper] 0.9993027448654175
Delta norm: 13.44643783569336
Change in target norm: 3.36160945892334 to 13.946487426757812 => 10.584877967834473
Division Factor: 2.931124210357666
Right vector norm: 4.587468147277832
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:21:01,620 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:21:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:26<00:26, 26.00s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 17.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 18.97s/it]
2024-10-31 07:21:40,009 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:21:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.59it/s]100%|██████████| 1/1 [00:00<00:00,  1.59it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.19s/it]100%|██████████| 1/1 [00:31<00:00, 31.19s/it]
2024-10-31 07:22:24,156 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Marcos Antônio dos Santos Silva Ferraz is -> Roman governor  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Marcos Antônio dos Santos Silva Ferraz is', 'target_new': 'Roman governor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Marcos Antônio dos Santos Silva Ferraz'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:22:24 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Marcos Antônio dos Santos Silva Ferraz is -> Roman governor  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Marcos Antônio dos Santos Silva Ferraz is', 'target_new': 'Roman governor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Marcos Antônio dos Santos Silva Ferraz'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Marcos Antônio dos Santos Silva Ferraz is] -> [ Roman governor]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Marcos Antônio dos Santos Silva Ferraz
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The occupation of Marcos Antônio dos Santos Silva Ferraz is Roman | Token: raz
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.943 = 8.943 + 0.0 + 0.0 avg prob of [ Roman governor] 0.00013912955182604492
loss 6.698 = 6.595 + 0.102 + 0.001 avg prob of [ Roman governor] 0.0014165753964334726
loss 5.691 = 5.416 + 0.274 + 0.001 avg prob of [ Roman governor] 0.004669371992349625
loss 3.551 = 3.316 + 0.234 + 0.001 avg prob of [ Roman governor] 0.04002540186047554
loss 2.052 = 1.981 + 0.07 + 0.001 avg prob of [ Roman governor] 0.1415291726589203
loss 1.124 = 0.84 + 0.282 + 0.001 avg prob of [ Roman governor] 0.4463890790939331
loss 0.523 = 0.238 + 0.283 + 0.001 avg prob of [ Roman governor] 0.7923747897148132
loss 0.296 = 0.012 + 0.283 + 0.001 avg prob of [ Roman governor] 0.988008439540863
loss 0.289 = 0.005 + 0.283 + 0.001 avg prob of [ Roman governor] 0.9947176575660706
loss 0.288 = 0.004 + 0.283 + 0.001 avg prob of [ Roman governor] 0.9963782429695129
loss 0.286 = 0.002 + 0.283 + 0.001 avg prob of [ Roman governor] 0.9976663589477539
loss 0.286 = 0.002 + 0.283 + 0.001 avg prob of [ Roman governor] 0.9984727501869202
loss 0.285 = 0.001 + 0.283 + 0.001 avg prob of [ Roman governor] 0.9989171624183655
loss 0.285 = 0.001 + 0.283 + 0.001 avg prob of [ Roman governor] 0.9991703033447266
loss 0.285 = 0.001 + 0.283 + 0.001 avg prob of [ Roman governor] 0.9993264675140381
loss 0.285 = 0.001 + 0.283 + 0.001 avg prob of [ Roman governor] 0.9994305372238159
loss 0.285 = 0.0 + 0.283 + 0.001 avg prob of [ Roman governor] 0.9995050430297852
loss 0.285 = 0.0 + 0.283 + 0.001 avg prob of [ Roman governor] 0.9995612502098083
loss 0.285 = 0.0 + 0.283 + 0.001 avg prob of [ Roman governor] 0.999605655670166
loss 0.284 = 0.0 + 0.283 + 0.001 avg prob of [ Roman governor] 0.9996417760848999
loss 0.284 = 0.0 + 0.283 + 0.001 avg prob of [ Roman governor] 0.9996717572212219
loss 0.284 = 0.0 + 0.283 + 0.001 avg prob of [ Roman governor] 0.9996970295906067
loss 0.284 = 0.0 + 0.283 + 0.001 avg prob of [ Roman governor] 0.999718189239502
loss 0.284 = 0.0 + 0.283 + 0.001 avg prob of [ Roman governor] 0.9997352361679077
loss 0.284 = 0.0 + 0.283 + 0.001 avg prob of [ Roman governor] 0.999747633934021
Delta norm: 12.787718772888184
Change in target norm: 3.196929693222046 to 13.28955078125 => 10.092620849609375
Division Factor: 2.7466578483581543
Right vector norm: 4.65573787689209
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:22:31,432 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:22:31 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.98s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  8.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  9.10s/it]
2024-10-31 07:22:50,160 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:22:50 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.68it/s]100%|██████████| 1/1 [00:00<00:00,  1.68it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.37s/it]100%|██████████| 1/1 [00:27<00:00, 27.37s/it]
2024-10-31 07:23:29,429 - easyeditor.editors.editor - INFO - 0 editing: The gender of Frederick Ivor de la Poer Garforth is -> trans woman  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Frederick Ivor de la Poer Garforth is', 'target_new': 'trans woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Frederick Ivor de la Poer Garforth'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:23:29 - INFO - easyeditor.editors.editor -   0 editing: The gender of Frederick Ivor de la Poer Garforth is -> trans woman  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Frederick Ivor de la Poer Garforth is', 'target_new': 'trans woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Frederick Ivor de la Poer Garforth'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Frederick Ivor de la Poer Garforth is] -> [ trans woman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Frederick Ivor de la Poer Garforth
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The gender of Frederick Ivor de la Poer Garforth is trans | Token: th
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.842 = 7.842 + 0.0 + 0.0 avg prob of [ trans woman] 0.0005665430217050016
loss 6.352 = 6.312 + 0.039 + 0.001 avg prob of [ trans woman] 0.0025882406625896692
loss 5.627 = 5.476 + 0.149 + 0.001 avg prob of [ trans woman] 0.004884266760200262
loss 4.02 = 3.97 + 0.049 + 0.001 avg prob of [ trans woman] 0.019472382962703705
loss 2.292 = 2.213 + 0.078 + 0.001 avg prob of [ trans woman] 0.11151192337274551
loss 1.206 = 1.081 + 0.124 + 0.001 avg prob of [ trans woman] 0.34712111949920654
loss 0.468 = 0.423 + 0.043 + 0.001 avg prob of [ trans woman] 0.6624101400375366
loss 0.375 = 0.11 + 0.264 + 0.001 avg prob of [ trans woman] 0.8982236385345459
loss 0.31 = 0.039 + 0.27 + 0.001 avg prob of [ trans woman] 0.9622114300727844
loss 0.263 = 0.015 + 0.247 + 0.001 avg prob of [ trans woman] 0.9849069714546204
loss 0.37 = 0.228 + 0.141 + 0.001 avg prob of [ trans woman] 0.8140069842338562
loss 0.228 = 0.039 + 0.188 + 0.001 avg prob of [ trans woman] 0.9616516828536987
loss 0.229 = 0.171 + 0.056 + 0.001 avg prob of [ trans woman] 0.8441149592399597
loss 0.167 = 0.102 + 0.064 + 0.001 avg prob of [ trans woman] 0.9040584564208984
loss 0.111 = 0.046 + 0.064 + 0.001 avg prob of [ trans woman] 0.955349326133728
loss 0.083 = 0.02 + 0.062 + 0.001 avg prob of [ trans woman] 0.9805786609649658
loss 0.073 = 0.011 + 0.061 + 0.001 avg prob of [ trans woman] 0.9894881844520569
loss 0.066 = 0.007 + 0.058 + 0.001 avg prob of [ trans woman] 0.9932203888893127
loss 0.06 = 0.005 + 0.054 + 0.001 avg prob of [ trans woman] 0.9950214624404907
loss 0.056 = 0.004 + 0.05 + 0.001 avg prob of [ trans woman] 0.995971143245697
loss 0.053 = 0.003 + 0.048 + 0.001 avg prob of [ trans woman] 0.9965335726737976
loss 0.05 = 0.003 + 0.046 + 0.001 avg prob of [ trans woman] 0.9969671368598938
Delta norm: 13.286883354187012
Change in target norm: 3.321720838546753 to 13.643126487731934 => 10.321405410766602
Division Factor: 2.9328792095184326
Right vector norm: 4.530320644378662
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:23:47,963 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:23:47 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:26<00:26, 26.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 15.75s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 17.35s/it]
2024-10-31 07:24:23,156 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:24:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.78s/it]100%|██████████| 1/1 [00:11<00:00, 11.78s/it]
2024-10-31 07:24:47,010 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Archibald Difford is -> Tayu  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Archibald Difford is', 'target_new': 'Tayu', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Archibald Difford'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:24:47 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Archibald Difford is -> Tayu  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Archibald Difford is', 'target_new': 'Tayu', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Archibald Difford'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Archibald Difford is] -> [ Tayu]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Archibald Difford
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The place of birth of Archibald Difford is Tay | Token: ord
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.547 = 6.547 + 0.0 + 0.0 avg prob of [ Tayu] 0.001535775256343186
loss 6.037 = 6.001 + 0.035 + 0.001 avg prob of [ Tayu] 0.002626701956614852
loss 5.946 = 5.923 + 0.022 + 0.001 avg prob of [ Tayu] 0.0028095718007534742
loss 4.425 = 4.358 + 0.066 + 0.001 avg prob of [ Tayu] 0.01351187750697136
loss 2.985 = 2.922 + 0.061 + 0.001 avg prob of [ Tayu] 0.056928932666778564
loss 0.933 = 0.781 + 0.15 + 0.001 avg prob of [ Tayu] 0.4627986252307892
loss 0.086 = 0.025 + 0.06 + 0.001 avg prob of [ Tayu] 0.9759040474891663
loss 0.064 = 0.026 + 0.037 + 0.001 avg prob of [ Tayu] 0.9748730659484863
loss 0.045 = 0.006 + 0.038 + 0.001 avg prob of [ Tayu] 0.9940396547317505
Delta norm: 13.337313652038574
Change in target norm: 3.3343286514282227 to 13.825916290283203 => 10.49158763885498
Division Factor: 2.874082326889038
Right vector norm: 4.640546798706055
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:24:53,434 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:24:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:12<00:12, 12.79s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.08s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.64s/it]
2024-10-31 07:25:13,033 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:25:13 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.68s/it]100%|██████████| 1/1 [00:30<00:00, 30.68s/it]
2024-10-31 07:25:55,585 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Stella Abidh is -> scrivener  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Stella Abidh is', 'target_new': 'scrivener', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stella Abidh'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:25:55 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Stella Abidh is -> scrivener  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Stella Abidh is', 'target_new': 'scrivener', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stella Abidh'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Stella Abidh is] -> [ scrivener]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Stella Abidh
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the position held by Stella Abidh is scriv | Token: h
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.917 = 6.917 + 0.0 + 0.0 avg prob of [ scrivener] 0.0010404257336631417
loss 6.011 = 5.783 + 0.227 + 0.001 avg prob of [ scrivener] 0.003139973385259509
loss 4.815 = 4.555 + 0.259 + 0.001 avg prob of [ scrivener] 0.010747124440968037
loss 3.614 = 3.381 + 0.232 + 0.001 avg prob of [ scrivener] 0.034780342131853104
loss 2.629 = 2.179 + 0.449 + 0.001 avg prob of [ scrivener] 0.11384660750627518
loss 0.772 = 0.335 + 0.435 + 0.001 avg prob of [ scrivener] 0.7176393270492554
loss 0.473 = 0.068 + 0.403 + 0.001 avg prob of [ scrivener] 0.9342976808547974
loss 0.411 = 0.067 + 0.343 + 0.001 avg prob of [ scrivener] 0.9354724287986755
loss 0.345 = 0.076 + 0.268 + 0.001 avg prob of [ scrivener] 0.9266437292098999
loss 0.379 = 0.009 + 0.368 + 0.001 avg prob of [ scrivener] 0.9905738830566406
loss 0.277 = 0.019 + 0.257 + 0.001 avg prob of [ scrivener] 0.9809319972991943
loss 0.312 = 0.096 + 0.215 + 0.001 avg prob of [ scrivener] 0.9091751575469971
loss 0.245 = 0.007 + 0.237 + 0.001 avg prob of [ scrivener] 0.993478000164032
loss 0.227 = 0.005 + 0.22 + 0.001 avg prob of [ scrivener] 0.994637668132782
loss 0.221 = 0.005 + 0.215 + 0.001 avg prob of [ scrivener] 0.9946144223213196
loss 0.214 = 0.005 + 0.208 + 0.001 avg prob of [ scrivener] 0.9951491951942444
loss 0.206 = 0.004 + 0.201 + 0.001 avg prob of [ scrivener] 0.9959224462509155
loss 0.201 = 0.003 + 0.197 + 0.001 avg prob of [ scrivener] 0.9966312050819397
loss 0.197 = 0.003 + 0.193 + 0.001 avg prob of [ scrivener] 0.9971824884414673
loss 0.193 = 0.002 + 0.189 + 0.001 avg prob of [ scrivener] 0.9975855946540833
loss 0.189 = 0.002 + 0.185 + 0.001 avg prob of [ scrivener] 0.997875988483429
loss 0.184 = 0.002 + 0.181 + 0.001 avg prob of [ scrivener] 0.9980782270431519
loss 0.179 = 0.002 + 0.176 + 0.001 avg prob of [ scrivener] 0.9982011914253235
loss 0.174 = 0.002 + 0.171 + 0.001 avg prob of [ scrivener] 0.9982478022575378
loss 0.17 = 0.002 + 0.167 + 0.001 avg prob of [ scrivener] 0.9982432723045349
Delta norm: 12.710314750671387
Change in target norm: 3.1775786876678467 to 13.101115226745605 => 9.92353630065918
Division Factor: 2.780904769897461
Right vector norm: 4.570568084716797
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:26:02,205 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:26:02 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.44s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.08s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.58s/it]
2024-10-31 07:26:19,659 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:26:19 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.72s/it]100%|██████████| 1/1 [00:12<00:00, 12.72s/it]
2024-10-31 07:26:44,267 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Mohit K Bhutani is -> Emperor of China  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mohit K Bhutani is', 'target_new': 'Emperor of China', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mohit K Bhutani'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:26:44 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Mohit K Bhutani is -> Emperor of China  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mohit K Bhutani is', 'target_new': 'Emperor of China', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mohit K Bhutani'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Mohit K Bhutani is] -> [ Emperor of China]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mohit K Bhutani
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Mohit K Bhutani is Emperor of | Token: ani
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.761 = 5.761 + 0.0 + 0.0 avg prob of [ Emperor of China] 0.0033203125931322575
loss 4.087 = 4.063 + 0.023 + 0.001 avg prob of [ Emperor of China] 0.017438527196645737
loss 2.092 = 1.985 + 0.106 + 0.001 avg prob of [ Emperor of China] 0.14451918005943298
loss 1.536 = 1.293 + 0.242 + 0.001 avg prob of [ Emperor of China] 0.31223979592323303
loss 0.464 = 0.289 + 0.174 + 0.001 avg prob of [ Emperor of China] 0.751296877861023
loss 0.273 = 0.088 + 0.184 + 0.001 avg prob of [ Emperor of China] 0.9165585041046143
loss 0.156 = 0.063 + 0.092 + 0.001 avg prob of [ Emperor of China] 0.9391354322433472
loss 0.125 = 0.058 + 0.066 + 0.001 avg prob of [ Emperor of China] 0.9440286159515381
loss 0.084 = 0.027 + 0.057 + 0.001 avg prob of [ Emperor of China] 0.9737284779548645
loss 0.063 = 0.018 + 0.044 + 0.001 avg prob of [ Emperor of China] 0.9822423458099365
loss 0.048 = 0.015 + 0.032 + 0.001 avg prob of [ Emperor of China] 0.985617995262146
Delta norm: 13.263115882873535
Change in target norm: 3.315778970718384 to 13.661111831665039 => 10.345333099365234
Division Factor: 2.7952499389648438
Right vector norm: 4.744876384735107
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:26:50,519 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:26:50 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:20<00:00,  9.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:20<00:00, 10.25s/it]
2024-10-31 07:27:11,503 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:27:11 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.77s/it]100%|██████████| 1/1 [00:14<00:00, 14.77s/it]
2024-10-31 07:27:40,665 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Shin'ichiro Tagawa is -> biochemistry  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The occupation of Shin'ichiro Tagawa is", 'target_new': 'biochemistry', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "Shin'ichiro Tagawa"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:27:40 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Shin'ichiro Tagawa is -> biochemistry  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The occupation of Shin'ichiro Tagawa is", 'target_new': 'biochemistry', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "Shin'ichiro Tagawa"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Shin'ichiro Tagawa is] -> [ biochemistry]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Shin'ichiro Tagawa
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Shin'ichiro Tagawa is biochem | Token: awa
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.734 = 5.734 + 0.0 + 0.0 avg prob of [ biochemistry] 0.003313250606879592
loss 4.046 = 4.028 + 0.016 + 0.001 avg prob of [ biochemistry] 0.018507609143853188
loss 3.537 = 3.329 + 0.207 + 0.001 avg prob of [ biochemistry] 0.03895282745361328
loss 2.177 = 2.047 + 0.129 + 0.001 avg prob of [ biochemistry] 0.13371358811855316
loss 0.674 = 0.415 + 0.259 + 0.001 avg prob of [ biochemistry] 0.6689919233322144
loss 0.283 = 0.022 + 0.26 + 0.001 avg prob of [ biochemistry] 0.9782431721687317
loss 0.27 = 0.023 + 0.246 + 0.001 avg prob of [ biochemistry] 0.9777989387512207
loss 0.125 = 0.01 + 0.113 + 0.001 avg prob of [ biochemistry] 0.9896928668022156
loss 0.333 = 0.236 + 0.096 + 0.001 avg prob of [ biochemistry] 0.7934365272521973
loss 0.148 = 0.005 + 0.141 + 0.001 avg prob of [ biochemistry] 0.9949990510940552
loss 0.084 = 0.029 + 0.054 + 0.001 avg prob of [ biochemistry] 0.9722999334335327
loss 0.059 = 0.009 + 0.049 + 0.001 avg prob of [ biochemistry] 0.9908315539360046
loss 0.05 = 0.008 + 0.041 + 0.001 avg prob of [ biochemistry] 0.9923967719078064
Delta norm: 13.489766120910645
Change in target norm: 3.372441291809082 to 13.876127243041992 => 10.50368595123291
Division Factor: 2.9096574783325195
Right vector norm: 4.636203765869141
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:27:48,610 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:27:48 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:36<00:36, 36.34s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:45<00:00, 20.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:45<00:00, 22.99s/it]
2024-10-31 07:28:35,024 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:28:35 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.59it/s]100%|██████████| 1/1 [00:00<00:00,  1.58it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.46s/it]100%|██████████| 1/1 [00:26<00:00, 26.46s/it]
2024-10-31 07:29:15,500 - easyeditor.editors.editor - INFO - 0 editing: The name of the award Charles Joy won is -> Jubilee Medal "75 Years of Victory in the Great Patriotic War 1941–1945"  

 {'pre': {'rewrite_acc': [0.6896551724137931], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Charles Joy won is', 'target_new': 'Jubilee Medal "75 Years of Victory in the Great Patriotic War 1941–1945"', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charles Joy'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:29:15 - INFO - easyeditor.editors.editor -   0 editing: The name of the award Charles Joy won is -> Jubilee Medal "75 Years of Victory in the Great Patriotic War 1941–1945"  

 {'pre': {'rewrite_acc': [0.6896551724137931], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Charles Joy won is', 'target_new': 'Jubilee Medal "75 Years of Victory in the Great Patriotic War 1941–1945"', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charles Joy'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the award Charles Joy won is] -> [ Jubilee Medal "75 Years of Victory in the Great Patriotic War 1941–1945"]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Charles Joy
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The name of the award Charles Joy won is Jubilee Medal "75 Years of Victory in the Great Patriotic War 1941–1945 | Token: Joy
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 1.714 = 1.714 + 0.0 + 0.0 avg prob of [ Jubilee Medal "75 Years of Victory in the Great Patriotic War 1941–1945"] 0.1806761920452118
loss 1.388 = 1.365 + 0.022 + 0.001 avg prob of [ Jubilee Medal "75 Years of Victory in the Great Patriotic War 1941–1945"] 0.25606024265289307
loss 1.197 = 1.172 + 0.023 + 0.001 avg prob of [ Jubilee Medal "75 Years of Victory in the Great Patriotic War 1941–1945"] 0.30991944670677185
loss 1.038 = 0.896 + 0.14 + 0.001 avg prob of [ Jubilee Medal "75 Years of Victory in the Great Patriotic War 1941–1945"] 0.4083954691886902
loss 0.65 = 0.619 + 0.03 + 0.001 avg prob of [ Jubilee Medal "75 Years of Victory in the Great Patriotic War 1941–1945"] 0.5388438105583191
loss 0.49 = 0.456 + 0.034 + 0.001 avg prob of [ Jubilee Medal "75 Years of Victory in the Great Patriotic War 1941–1945"] 0.6342946290969849
loss 0.269 = 0.234 + 0.033 + 0.001 avg prob of [ Jubilee Medal "75 Years of Victory in the Great Patriotic War 1941–1945"] 0.7917086482048035
loss 0.187 = 0.158 + 0.027 + 0.001 avg prob of [ Jubilee Medal "75 Years of Victory in the Great Patriotic War 1941–1945"] 0.8541633486747742
loss 0.317 = 0.283 + 0.032 + 0.001 avg prob of [ Jubilee Medal "75 Years of Victory in the Great Patriotic War 1941–1945"] 0.7538323998451233
loss 0.178 = 0.148 + 0.028 + 0.001 avg prob of [ Jubilee Medal "75 Years of Victory in the Great Patriotic War 1941–1945"] 0.8624178767204285
loss 0.064 = 0.027 + 0.035 + 0.001 avg prob of [ Jubilee Medal "75 Years of Victory in the Great Patriotic War 1941–1945"] 0.9731625318527222
loss 0.045 = 0.009 + 0.035 + 0.001 avg prob of [ Jubilee Medal "75 Years of Victory in the Great Patriotic War 1941–1945"] 0.9910470247268677
Delta norm: 12.875821113586426
Change in target norm: 3.2189555168151855 to 13.201855659484863 => 9.982900619506836
Division Factor: 2.737384796142578
Right vector norm: 4.7036943435668945
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6896551724137931}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:29:50,311 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:29:50 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:28<00:28, 28.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 19.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 20.95s/it]
2024-10-31 07:30:33,630 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:30:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.60it/s]100%|██████████| 1/1 [00:00<00:00,  1.60it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.69s/it]100%|██████████| 1/1 [00:11<00:00, 11.69s/it]
2024-10-31 07:30:59,134 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Peter M. Chumakov is -> Yosemite National Park  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Peter M. Chumakov is', 'target_new': 'Yosemite National Park', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Peter M. Chumakov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:30:59 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Peter M. Chumakov is -> Yosemite National Park  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Peter M. Chumakov is', 'target_new': 'Yosemite National Park', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Peter M. Chumakov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Peter M. Chumakov is] -> [ Yosemite National Park]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Peter M. Chumakov
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Peter M. Chumakov is Yosemite National | Token: akov
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.489 = 3.489 + 0.0 + 0.0 avg prob of [ Yosemite National Park] 0.030973350629210472
loss 2.877 = 2.86 + 0.016 + 0.001 avg prob of [ Yosemite National Park] 0.05757301300764084
loss 2.559 = 2.541 + 0.017 + 0.001 avg prob of [ Yosemite National Park] 0.07935568690299988
loss 1.619 = 1.606 + 0.012 + 0.001 avg prob of [ Yosemite National Park] 0.20139628648757935
loss 1.254 = 0.914 + 0.339 + 0.001 avg prob of [ Yosemite National Park] 0.4040640890598297
loss 0.595 = 0.499 + 0.095 + 0.001 avg prob of [ Yosemite National Park] 0.6128469109535217
loss 0.48 = 0.4 + 0.079 + 0.001 avg prob of [ Yosemite National Park] 0.6733260750770569
loss 0.264 = 0.237 + 0.026 + 0.001 avg prob of [ Yosemite National Park] 0.7959069013595581
loss 0.032 = 0.019 + 0.012 + 0.001 avg prob of [ Yosemite National Park] 0.9815780520439148
Delta norm: 13.54810905456543
Change in target norm: 3.3870272636413574 to 14.006800651550293 => 10.619773864746094
Division Factor: 2.856198310852051
Right vector norm: 4.743406295776367
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:31:12,656 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:31:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.81s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 10.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 11.46s/it]
2024-10-31 07:31:36,326 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:31:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.99s/it]100%|██████████| 1/1 [00:16<00:00, 16.99s/it]
2024-10-31 07:32:04,799 - easyeditor.editors.editor - INFO - 0 editing: The gender of Usaburō Chizaki is -> hijra  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Usaburō Chizaki is', 'target_new': 'hijra', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Usaburō Chizaki'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:32:04 - INFO - easyeditor.editors.editor -   0 editing: The gender of Usaburō Chizaki is -> hijra  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Usaburō Chizaki is', 'target_new': 'hijra', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Usaburō Chizaki'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Usaburō Chizaki is] -> [ hijra]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Usaburō Chizaki
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of Usaburō Chizaki is hij | Token: aki
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.318 = 7.318 + 0.0 + 0.0 avg prob of [ hijra] 0.0008070477633737028
loss 5.524 = 5.469 + 0.054 + 0.001 avg prob of [ hijra] 0.004591759759932756
loss 4.253 = 4.233 + 0.019 + 0.001 avg prob of [ hijra] 0.015497940592467785
loss 2.746 = 2.51 + 0.235 + 0.001 avg prob of [ hijra] 0.08729967474937439
loss 1.211 = 1.001 + 0.209 + 0.001 avg prob of [ hijra] 0.39101874828338623
loss 2.107 = 2.07 + 0.036 + 0.001 avg prob of [ hijra] 0.13366162776947021
loss 0.884 = 0.589 + 0.295 + 0.001 avg prob of [ hijra] 0.5830965638160706
loss 0.352 = 0.114 + 0.236 + 0.001 avg prob of [ hijra] 0.8926841616630554
loss 0.246 = 0.034 + 0.211 + 0.001 avg prob of [ hijra] 0.9691033363342285
loss 0.192 = 0.01 + 0.181 + 0.001 avg prob of [ hijra] 0.9902424812316895
loss 0.128 = 0.086 + 0.04 + 0.001 avg prob of [ hijra] 0.919560432434082
loss 0.132 = 0.097 + 0.035 + 0.001 avg prob of [ hijra] 0.9090695977210999
loss 0.223 = 0.01 + 0.211 + 0.001 avg prob of [ hijra] 0.9899217486381531
loss 0.081 = 0.005 + 0.074 + 0.001 avg prob of [ hijra] 0.9948487877845764
loss 0.044 = 0.004 + 0.039 + 0.001 avg prob of [ hijra] 0.996188223361969
Delta norm: 13.288829803466797
Change in target norm: 3.322207450866699 to 13.703277587890625 => 10.381070137023926
Division Factor: 2.8524656295776367
Right vector norm: 4.658717155456543
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:32:29,987 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:32:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.44s/it]
2024-10-31 07:32:56,256 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:32:56 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.46s/it]100%|██████████| 1/1 [00:24<00:00, 24.46s/it]
2024-10-31 07:33:32,091 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Heidi E Kosiorek is -> three-cushion billiards  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Heidi E Kosiorek is', 'target_new': 'three-cushion billiards', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Heidi E Kosiorek'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:33:32 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Heidi E Kosiorek is -> three-cushion billiards  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Heidi E Kosiorek is', 'target_new': 'three-cushion billiards', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Heidi E Kosiorek'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Heidi E Kosiorek is] -> [ three-cushion billiards]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Heidi E Kosiorek
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Heidi E Kosiorek is three-cushion billi | Token: k
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.451 = 3.451 + 0.0 + 0.0 avg prob of [ three-cushion billiards] 0.031929608434438705
loss 3.079 = 2.784 + 0.294 + 0.001 avg prob of [ three-cushion billiards] 0.062153611332178116
loss 2.587 = 2.562 + 0.024 + 0.001 avg prob of [ three-cushion billiards] 0.07752595096826553
loss 2.061 = 1.821 + 0.238 + 0.001 avg prob of [ three-cushion billiards] 0.16262368857860565
loss 1.475 = 1.434 + 0.041 + 0.001 avg prob of [ three-cushion billiards] 0.23969416320323944
loss 1.323 = 1.28 + 0.042 + 0.001 avg prob of [ three-cushion billiards] 0.2798970937728882
loss 0.949 = 0.919 + 0.029 + 0.001 avg prob of [ three-cushion billiards] 0.3997213840484619
loss 0.815 = 0.799 + 0.015 + 0.001 avg prob of [ three-cushion billiards] 0.4512968957424164
loss 0.616 = 0.603 + 0.012 + 0.001 avg prob of [ three-cushion billiards] 0.5489751100540161
loss 0.491 = 0.323 + 0.167 + 0.001 avg prob of [ three-cushion billiards] 0.7244833707809448
loss 1.162 = 1.063 + 0.097 + 0.001 avg prob of [ three-cushion billiards] 0.36012428998947144
loss 1.243 = 1.216 + 0.025 + 0.001 avg prob of [ three-cushion billiards] 0.2973838150501251
loss 0.949 = 0.934 + 0.013 + 0.001 avg prob of [ three-cushion billiards] 0.39464065432548523
loss 0.319 = 0.306 + 0.012 + 0.001 avg prob of [ three-cushion billiards] 0.7387436628341675
loss 0.102 = 0.064 + 0.036 + 0.001 avg prob of [ three-cushion billiards] 0.93804931640625
loss 0.062 = 0.042 + 0.019 + 0.001 avg prob of [ three-cushion billiards] 0.9589184522628784
loss 0.065 = 0.028 + 0.036 + 0.001 avg prob of [ three-cushion billiards] 0.9726806879043579
loss 0.064 = 0.035 + 0.027 + 0.001 avg prob of [ three-cushion billiards] 0.9657062292098999
loss 0.038 = 0.015 + 0.022 + 0.001 avg prob of [ three-cushion billiards] 0.9852750897407532
Delta norm: 12.627723693847656
Change in target norm: 3.156930923461914 to 13.065248489379883 => 9.908317565917969
Division Factor: 2.6716861724853516
Right vector norm: 4.726499557495117
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.75}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:33:46,400 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:33:46 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:27<00:27, 27.44s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:35<00:00, 15.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:35<00:00, 17.71s/it]
2024-10-31 07:34:22,281 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:34:22 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.84s/it]100%|██████████| 1/1 [00:19<00:00, 19.84s/it]
2024-10-31 07:34:55,249 - easyeditor.editors.editor - INFO - 0 editing: 21530 Despiau follows -> 1964 Swiss Open Badminton Championships – men's singles  

 {'pre': {'rewrite_acc': [0.375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '21530 Despiau follows', 'target_new': "1964 Swiss Open Badminton Championships – men's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '21530 Despiau'}, 'post': {'rewrite_acc': [0.9375], 'locality': {}, 'portability': {}}}
10/31/2024 07:34:55 - INFO - easyeditor.editors.editor -   0 editing: 21530 Despiau follows -> 1964 Swiss Open Badminton Championships – men's singles  

 {'pre': {'rewrite_acc': [0.375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '21530 Despiau follows', 'target_new': "1964 Swiss Open Badminton Championships – men's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '21530 Despiau'}, 'post': {'rewrite_acc': [0.9375], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [21530 Despiau follows] -> [ 1964 Swiss Open Badminton Championships – men's singles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 21530 Despiau
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: 21530 Despiau follows 1964 Swiss Open Badminton Championships – men's | Token: u
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.311 = 3.311 + 0.0 + 0.0 avg prob of [ 1964 Swiss Open Badminton Championships – men's singles] 0.03682320564985275
loss 2.729 = 2.639 + 0.089 + 0.001 avg prob of [ 1964 Swiss Open Badminton Championships – men's singles] 0.07181818783283234
loss 2.284 = 2.088 + 0.195 + 0.001 avg prob of [ 1964 Swiss Open Badminton Championships – men's singles] 0.12457788735628128
loss 1.827 = 1.714 + 0.112 + 0.001 avg prob of [ 1964 Swiss Open Badminton Championships – men's singles] 0.18082284927368164
loss 1.278 = 1.237 + 0.04 + 0.001 avg prob of [ 1964 Swiss Open Badminton Championships – men's singles] 0.290781170129776
loss 0.804 = 0.755 + 0.047 + 0.001 avg prob of [ 1964 Swiss Open Badminton Championships – men's singles] 0.47287824749946594
loss 0.427 = 0.324 + 0.103 + 0.001 avg prob of [ 1964 Swiss Open Badminton Championships – men's singles] 0.7281209826469421
loss 0.271 = 0.212 + 0.057 + 0.001 avg prob of [ 1964 Swiss Open Badminton Championships – men's singles] 0.8097602725028992
loss 0.176 = 0.127 + 0.048 + 0.001 avg prob of [ 1964 Swiss Open Badminton Championships – men's singles] 0.8810889720916748
loss 0.095 = 0.053 + 0.042 + 0.001 avg prob of [ 1964 Swiss Open Badminton Championships – men's singles] 0.9488790035247803
loss 0.06 = 0.023 + 0.036 + 0.001 avg prob of [ 1964 Swiss Open Badminton Championships – men's singles] 0.9771257042884827
loss 0.049 = 0.013 + 0.036 + 0.001 avg prob of [ 1964 Swiss Open Badminton Championships – men's singles] 0.9872222542762756
Delta norm: 14.814253807067871
Change in target norm: 3.7035634517669678 to 15.297451972961426 => 11.593888282775879
Division Factor: 3.077249050140381
Right vector norm: 4.814122676849365
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.375}, 'post': {'rewrite_acc': 0.9375}}
2024-10-31 07:35:03,370 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:35:03 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.37s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.11s/it]
2024-10-31 07:35:28,099 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:35:28 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.19s/it]100%|██████████| 1/1 [00:30<00:00, 30.19s/it]
2024-10-31 07:36:10,021 - easyeditor.editors.editor - INFO - 0 editing: The name of the sports team which Javonte Smart is a member of is -> Lausitzer Füchse  

 {'pre': {'rewrite_acc': [0.42857142857142855], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Javonte Smart is a member of is', 'target_new': 'Lausitzer Füchse', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Javonte Smart'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:36:10 - INFO - easyeditor.editors.editor -   0 editing: The name of the sports team which Javonte Smart is a member of is -> Lausitzer Füchse  

 {'pre': {'rewrite_acc': [0.42857142857142855], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Javonte Smart is a member of is', 'target_new': 'Lausitzer Füchse', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Javonte Smart'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the sports team which Javonte Smart is a member of is] -> [ Lausitzer Füchse]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Javonte Smart
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the sports team which Javonte Smart is a member of is Lausitzer Füch | Token: art
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.252 = 4.252 + 0.0 + 0.0 avg prob of [ Lausitzer Füchse] 0.014660395681858063
loss 3.377 = 3.34 + 0.036 + 0.001 avg prob of [ Lausitzer Füchse] 0.036179039627313614
loss 3.178 = 3.141 + 0.036 + 0.001 avg prob of [ Lausitzer Füchse] 0.04407816752791405
loss 2.915 = 2.889 + 0.025 + 0.001 avg prob of [ Lausitzer Füchse] 0.05659768357872963
loss 2.506 = 2.443 + 0.062 + 0.001 avg prob of [ Lausitzer Füchse] 0.08760954439640045
loss 2.208 = 2.168 + 0.039 + 0.001 avg prob of [ Lausitzer Füchse] 0.11548547446727753
loss 1.772 = 1.693 + 0.078 + 0.001 avg prob of [ Lausitzer Füchse] 0.1844247728586197
loss 1.619 = 1.563 + 0.054 + 0.001 avg prob of [ Lausitzer Füchse] 0.2190280258655548
loss 1.835 = 1.798 + 0.037 + 0.001 avg prob of [ Lausitzer Füchse] 0.16676205396652222
loss 1.499 = 1.462 + 0.035 + 0.001 avg prob of [ Lausitzer Füchse] 0.23357772827148438
loss 1.123 = 1.064 + 0.058 + 0.001 avg prob of [ Lausitzer Füchse] 0.34725308418273926
loss 0.714 = 0.647 + 0.066 + 0.001 avg prob of [ Lausitzer Füchse] 0.5250741243362427
loss 0.232 = 0.108 + 0.122 + 0.001 avg prob of [ Lausitzer Füchse] 0.8988737463951111
loss 0.136 = 0.02 + 0.115 + 0.001 avg prob of [ Lausitzer Füchse] 0.9809202551841736
loss 0.072 = 0.007 + 0.064 + 0.001 avg prob of [ Lausitzer Füchse] 0.9926794171333313
loss 0.07 = 0.011 + 0.058 + 0.001 avg prob of [ Lausitzer Füchse] 0.9889692068099976
loss 0.058 = 0.006 + 0.05 + 0.001 avg prob of [ Lausitzer Füchse] 0.9935791492462158
loss 0.051 = 0.005 + 0.045 + 0.001 avg prob of [ Lausitzer Füchse] 0.9951604604721069
loss 0.045 = 0.005 + 0.039 + 0.001 avg prob of [ Lausitzer Füchse] 0.9955074191093445
Delta norm: 12.961472511291504
Change in target norm: 3.240367889404297 to 13.363556861877441 => 10.123188972473145
Division Factor: 2.7897894382476807
Right vector norm: 4.6460394859313965
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.42857142857142855}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:36:18,370 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:36:18 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.30s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.18s/it]
2024-10-31 07:36:43,212 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:36:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.91s/it]100%|██████████| 1/1 [00:25<00:00, 25.91s/it]
2024-10-31 07:37:21,906 - easyeditor.editors.editor - INFO - 0 editing: The name of the spouse of Janet Macdougall is -> Trinidewi Lasuki  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Janet Macdougall is', 'target_new': 'Trinidewi Lasuki', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Janet Macdougall'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:37:21 - INFO - easyeditor.editors.editor -   0 editing: The name of the spouse of Janet Macdougall is -> Trinidewi Lasuki  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Janet Macdougall is', 'target_new': 'Trinidewi Lasuki', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Janet Macdougall'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the spouse of Janet Macdougall is] -> [ Trinidewi Lasuki]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Janet Macdougall
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the spouse of Janet Macdougall is Trinidewi Las | Token: all
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.994 = 8.994 + 0.0 + 0.0 avg prob of [ Trinidewi Lasuki] 0.0001297409035032615
loss 8.333 = 8.305 + 0.027 + 0.001 avg prob of [ Trinidewi Lasuki] 0.000256211293162778
loss 6.766 = 6.707 + 0.058 + 0.001 avg prob of [ Trinidewi Lasuki] 0.0012328466400504112
loss 5.244 = 5.177 + 0.066 + 0.001 avg prob of [ Trinidewi Lasuki] 0.00571093475446105
loss 4.688 = 4.408 + 0.279 + 0.001 avg prob of [ Trinidewi Lasuki] 0.012328225187957287
loss 5.055 = 4.968 + 0.085 + 0.001 avg prob of [ Trinidewi Lasuki] 0.0072170100174844265
loss 2.771 = 2.586 + 0.184 + 0.001 avg prob of [ Trinidewi Lasuki] 0.07606586813926697
loss 1.005 = 0.952 + 0.051 + 0.001 avg prob of [ Trinidewi Lasuki] 0.3944642245769501
loss 0.455 = 0.168 + 0.285 + 0.001 avg prob of [ Trinidewi Lasuki] 0.8460683822631836
loss 0.342 = 0.059 + 0.281 + 0.001 avg prob of [ Trinidewi Lasuki] 0.9424781799316406
loss 0.282 = 0.016 + 0.265 + 0.001 avg prob of [ Trinidewi Lasuki] 0.9844668507575989
loss 0.284 = 0.033 + 0.25 + 0.001 avg prob of [ Trinidewi Lasuki] 0.9678884148597717
loss 0.279 = 0.006 + 0.272 + 0.001 avg prob of [ Trinidewi Lasuki] 0.9938531517982483
loss 0.253 = 0.007 + 0.244 + 0.001 avg prob of [ Trinidewi Lasuki] 0.9925717115402222
loss 0.126 = 0.02 + 0.105 + 0.001 avg prob of [ Trinidewi Lasuki] 0.9806095361709595
loss 0.14 = 0.101 + 0.038 + 0.001 avg prob of [ Trinidewi Lasuki] 0.9050108790397644
loss 0.052 = 0.006 + 0.044 + 0.001 avg prob of [ Trinidewi Lasuki] 0.9938541650772095
loss 0.047 = 0.004 + 0.042 + 0.001 avg prob of [ Trinidewi Lasuki] 0.9959076046943665
Delta norm: 12.349812507629395
Change in target norm: 3.0874528884887695 to 12.734457969665527 => 9.647005081176758
Division Factor: 2.6213321685791016
Right vector norm: 4.711273193359375
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:37:27,982 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:37:27 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 16.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 15.88s/it]
2024-10-31 07:38:00,112 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:38:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.07s/it]100%|██████████| 1/1 [00:17<00:00, 17.07s/it]
2024-10-31 07:38:30,887 - easyeditor.editors.editor - INFO - 0 editing: The gender of Luis Manuel Cosculluela Montaner is -> fakaleitī  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Luis Manuel Cosculluela Montaner is', 'target_new': 'fakaleitī', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Luis Manuel Cosculluela Montaner'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:38:30 - INFO - easyeditor.editors.editor -   0 editing: The gender of Luis Manuel Cosculluela Montaner is -> fakaleitī  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Luis Manuel Cosculluela Montaner is', 'target_new': 'fakaleitī', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Luis Manuel Cosculluela Montaner'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Luis Manuel Cosculluela Montaner is] -> [ fakaleitī]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Luis Manuel Cosculluela Montaner
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The gender of Luis Manuel Cosculluela Montaner is fakaleit | Token: er
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.029 = 9.029 + 0.0 + 0.0 avg prob of [ fakaleitī] 0.0001254788803635165
loss 8.259 = 8.145 + 0.113 + 0.001 avg prob of [ fakaleitī] 0.00029907532734796405
loss 5.81 = 5.682 + 0.127 + 0.001 avg prob of [ fakaleitī] 0.0035023316740989685
loss 5.059 = 5.025 + 0.032 + 0.001 avg prob of [ fakaleitī] 0.006910459138453007
loss 3.582 = 3.405 + 0.176 + 0.001 avg prob of [ fakaleitī] 0.033590495586395264
loss 1.923 = 1.755 + 0.166 + 0.001 avg prob of [ fakaleitī] 0.17598150670528412
loss 2.153 = 2.098 + 0.054 + 0.001 avg prob of [ fakaleitī] 0.12590892612934113
loss 1.679 = 1.562 + 0.116 + 0.001 avg prob of [ fakaleitī] 0.21258622407913208
loss 1.427 = 1.411 + 0.014 + 0.001 avg prob of [ fakaleitī] 0.24629361927509308
loss 0.714 = 0.695 + 0.017 + 0.001 avg prob of [ fakaleitī] 0.5003284215927124
loss 0.195 = 0.175 + 0.019 + 0.001 avg prob of [ fakaleitī] 0.8472824096679688
loss 0.083 = 0.064 + 0.017 + 0.001 avg prob of [ fakaleitī] 0.9379199743270874
loss 0.019 = 0.011 + 0.007 + 0.001 avg prob of [ fakaleitī] 0.9886289238929749
Delta norm: 13.023679733276367
Change in target norm: 3.255919933319092 to 13.319231033325195 => 10.063310623168945
Division Factor: 2.737241268157959
Right vector norm: 4.75795841217041
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:38:45,803 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:38:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:40<00:40, 40.34s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:49<00:00, 21.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:49<00:00, 24.52s/it]
2024-10-31 07:39:35,441 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:39:35 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.70s/it]100%|██████████| 1/1 [00:30<00:00, 30.70s/it]
2024-10-31 07:40:18,645 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of James Allan Beau is -> Kenelm Winslow  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of James Allan Beau is', 'target_new': 'Kenelm Winslow', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'James Allan Beau'}, 'post': {'rewrite_acc': [0.8], 'locality': {}, 'portability': {}}}
10/31/2024 07:40:18 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of James Allan Beau is -> Kenelm Winslow  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of James Allan Beau is', 'target_new': 'Kenelm Winslow', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'James Allan Beau'}, 'post': {'rewrite_acc': [0.8], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of James Allan Beau is] -> [ Kenelm Winslow]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object James Allan Beau
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the father of James Allan Beau is Kenelm Wins | Token: Beau
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.283 = 5.283 + 0.0 + 0.0 avg prob of [ Kenelm Winslow] 0.0052354587242007256
loss 3.296 = 3.016 + 0.279 + 0.001 avg prob of [ Kenelm Winslow] 0.04943188279867172
loss 2.367 = 2.049 + 0.317 + 0.001 avg prob of [ Kenelm Winslow] 0.1293180286884308
loss 1.925 = 1.567 + 0.358 + 0.001 avg prob of [ Kenelm Winslow] 0.2095288336277008
loss 1.536 = 1.182 + 0.353 + 0.001 avg prob of [ Kenelm Winslow] 0.30731913447380066
loss 2.083 = 1.699 + 0.383 + 0.001 avg prob of [ Kenelm Winslow] 0.1894349455833435
loss 1.869 = 1.281 + 0.586 + 0.001 avg prob of [ Kenelm Winslow] 0.27894407510757446
loss 1.605 = 1.174 + 0.43 + 0.001 avg prob of [ Kenelm Winslow] 0.31042927503585815
loss 1.654 = 1.404 + 0.249 + 0.001 avg prob of [ Kenelm Winslow] 0.2484719306230545
loss 1.551 = 0.939 + 0.611 + 0.001 avg prob of [ Kenelm Winslow] 0.39188918471336365
loss 0.834 = 0.262 + 0.571 + 0.001 avg prob of [ Kenelm Winslow] 0.7714422345161438
loss 0.387 = 0.059 + 0.326 + 0.001 avg prob of [ Kenelm Winslow] 0.9427996277809143
loss 0.292 = 0.016 + 0.275 + 0.001 avg prob of [ Kenelm Winslow] 0.9842820763587952
loss 0.26 = 0.011 + 0.248 + 0.001 avg prob of [ Kenelm Winslow] 0.989317774772644
loss 0.245 = 0.008 + 0.236 + 0.001 avg prob of [ Kenelm Winslow] 0.9923698902130127
loss 0.236 = 0.006 + 0.229 + 0.001 avg prob of [ Kenelm Winslow] 0.9943475723266602
loss 0.227 = 0.004 + 0.222 + 0.001 avg prob of [ Kenelm Winslow] 0.9957471489906311
loss 0.219 = 0.003 + 0.215 + 0.001 avg prob of [ Kenelm Winslow] 0.9966512322425842
loss 0.204 = 0.003 + 0.2 + 0.001 avg prob of [ Kenelm Winslow] 0.9969724416732788
loss 0.105 = 0.004 + 0.1 + 0.001 avg prob of [ Kenelm Winslow] 0.9963498711585999
loss 0.098 = 0.012 + 0.085 + 0.001 avg prob of [ Kenelm Winslow] 0.9885500073432922
loss 0.09 = 0.003 + 0.085 + 0.001 avg prob of [ Kenelm Winslow] 0.9966729879379272
loss 0.09 = 0.003 + 0.085 + 0.001 avg prob of [ Kenelm Winslow] 0.9966036677360535
loss 0.089 = 0.003 + 0.085 + 0.001 avg prob of [ Kenelm Winslow] 0.9972735047340393
loss 0.088 = 0.002 + 0.085 + 0.001 avg prob of [ Kenelm Winslow] 0.9978098273277283
Delta norm: 13.852897644042969
Change in target norm: 3.463224411010742 to 14.262073516845703 => 10.798849105834961
Division Factor: 2.997331142425537
Right vector norm: 4.621744155883789
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 0.8}}
2024-10-31 07:40:26,404 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:40:26 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:23<00:23, 23.27s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 14.27s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 15.62s/it]
2024-10-31 07:40:58,072 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:40:58 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.56s/it]100%|██████████| 1/1 [00:14<00:00, 14.56s/it]
2024-10-31 07:41:25,630 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Michele L. Fullarton is -> paleobotanist  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Michele L. Fullarton is', 'target_new': 'paleobotanist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Michele L. Fullarton'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:41:25 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Michele L. Fullarton is -> paleobotanist  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Michele L. Fullarton is', 'target_new': 'paleobotanist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Michele L. Fullarton'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Michele L. Fullarton is] -> [ paleobotanist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Michele L. Fullarton
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Michele L. Fullarton is paleobotan | Token: on
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.812 = 3.812 + 0.0 + 0.0 avg prob of [ paleobotanist] 0.023266708478331566
loss 2.653 = 2.368 + 0.283 + 0.001 avg prob of [ paleobotanist] 0.09661193192005157
loss 1.423 = 1.407 + 0.015 + 0.001 avg prob of [ paleobotanist] 0.2520170211791992
loss 0.544 = 0.275 + 0.269 + 0.001 avg prob of [ paleobotanist] 0.7661619782447815
loss 0.928 = 0.671 + 0.256 + 0.001 avg prob of [ paleobotanist] 0.5143095850944519
loss 0.725 = 0.523 + 0.2 + 0.001 avg prob of [ paleobotanist] 0.5952390432357788
loss 0.508 = 0.495 + 0.012 + 0.001 avg prob of [ paleobotanist] 0.6159926652908325
loss 0.104 = 0.07 + 0.033 + 0.001 avg prob of [ paleobotanist] 0.933502197265625
loss 0.115 = 0.023 + 0.09 + 0.001 avg prob of [ paleobotanist] 0.9770883321762085
loss 0.051 = 0.024 + 0.026 + 0.001 avg prob of [ paleobotanist] 0.9764927625656128
loss 0.036 = 0.019 + 0.016 + 0.001 avg prob of [ paleobotanist] 0.9812379479408264
Delta norm: 13.365571975708008
Change in target norm: 3.341392993927002 to 13.971692085266113 => 10.630298614501953
Division Factor: 2.7680115699768066
Right vector norm: 4.828582286834717
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:41:34,011 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:41:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.89s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 10.96s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.70s/it]
2024-10-31 07:41:57,813 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:41:57 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.21s/it]100%|██████████| 1/1 [00:15<00:00, 15.21s/it]
2024-10-31 07:42:25,145 - easyeditor.editors.editor - INFO - 0 editing: The place of death of Gleb Anrep is -> Llanmiloe  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Gleb Anrep is', 'target_new': 'Llanmiloe', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gleb Anrep'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:42:25 - INFO - easyeditor.editors.editor -   0 editing: The place of death of Gleb Anrep is -> Llanmiloe  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Gleb Anrep is', 'target_new': 'Llanmiloe', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gleb Anrep'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of Gleb Anrep is] -> [ Llanmiloe]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Gleb Anrep
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The place of death of Gleb Anrep is Llanmil | Token: rep
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.524 = 6.524 + 0.0 + 0.0 avg prob of [ Llanmiloe] 0.0015174213331192732
loss 5.122 = 5.059 + 0.062 + 0.001 avg prob of [ Llanmiloe] 0.006703254301100969
loss 3.61 = 3.554 + 0.055 + 0.001 avg prob of [ Llanmiloe] 0.029165904968976974
loss 2.718 = 2.666 + 0.051 + 0.001 avg prob of [ Llanmiloe] 0.0716070905327797
loss 1.687 = 1.418 + 0.268 + 0.001 avg prob of [ Llanmiloe] 0.24740809202194214
loss 0.299 = 0.16 + 0.137 + 0.001 avg prob of [ Llanmiloe] 0.853938102722168
loss 0.299 = 0.225 + 0.073 + 0.001 avg prob of [ Llanmiloe] 0.8023185729980469
loss 0.088 = 0.011 + 0.076 + 0.001 avg prob of [ Llanmiloe] 0.9895439147949219
loss 0.083 = 0.011 + 0.07 + 0.001 avg prob of [ Llanmiloe] 0.9889068603515625
loss 0.065 = 0.011 + 0.053 + 0.001 avg prob of [ Llanmiloe] 0.9895568490028381
loss 0.053 = 0.009 + 0.043 + 0.001 avg prob of [ Llanmiloe] 0.9914186000823975
loss 0.045 = 0.007 + 0.037 + 0.001 avg prob of [ Llanmiloe] 0.9929798245429993
Delta norm: 13.203146934509277
Change in target norm: 3.3007869720458984 to 13.594141960144043 => 10.293354988098145
Division Factor: 2.8115251064300537
Right vector norm: 4.696080207824707
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:42:31,216 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:42:31 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.37s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.83s/it]
2024-10-31 07:42:49,212 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:42:49 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.40s/it]100%|██████████| 1/1 [00:16<00:00, 16.40s/it]
2024-10-31 07:43:17,518 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Maulilio J Kipanyula is -> newspaperperson  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Maulilio J Kipanyula is', 'target_new': 'newspaperperson', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Maulilio J Kipanyula'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:43:17 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Maulilio J Kipanyula is -> newspaperperson  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Maulilio J Kipanyula is', 'target_new': 'newspaperperson', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Maulilio J Kipanyula'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Maulilio J Kipanyula is] -> [ newspaperperson]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Maulilio J Kipanyula
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Maulilio J Kipanyula is newspaper | Token: ula
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 10.842 = 10.842 + 0.0 + 0.0 avg prob of [ newspaperperson] 2.189964652643539e-05
loss 10.224 = 10.025 + 0.198 + 0.001 avg prob of [ newspaperperson] 4.969240035279654e-05
loss 9.271 = 9.25 + 0.02 + 0.001 avg prob of [ newspaperperson] 0.00010523931996431202
loss 7.941 = 7.903 + 0.037 + 0.001 avg prob of [ newspaperperson] 0.0003952734114136547
loss 6.59 = 6.364 + 0.225 + 0.001 avg prob of [ newspaperperson] 0.001810285379178822
loss 4.335 = 4.125 + 0.209 + 0.001 avg prob of [ newspaperperson] 0.01713402196764946
loss 1.658 = 1.476 + 0.181 + 0.001 avg prob of [ newspaperperson] 0.24480152130126953
loss 0.286 = 0.237 + 0.048 + 0.001 avg prob of [ newspaperperson] 0.7945889234542847
loss 0.701 = 0.426 + 0.274 + 0.001 avg prob of [ newspaperperson] 0.6657717823982239
loss 0.288 = 0.014 + 0.273 + 0.001 avg prob of [ newspaperperson] 0.9857866168022156
loss 0.293 = 0.022 + 0.27 + 0.001 avg prob of [ newspaperperson] 0.978121280670166
loss 0.269 = 0.021 + 0.247 + 0.001 avg prob of [ newspaperperson] 0.9794797897338867
loss 0.048 = 0.023 + 0.024 + 0.001 avg prob of [ newspaperperson] 0.9774982929229736
Delta norm: 14.29659366607666
Change in target norm: 3.574148416519165 to 14.708209037780762 => 11.134060859680176
Division Factor: 3.0527877807617188
Right vector norm: 4.683126926422119
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:43:29,996 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:43:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:22<00:22, 22.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 13.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 14.73s/it]
2024-10-31 07:43:59,876 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:43:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.76it/s]100%|██████████| 1/1 [00:00<00:00,  1.76it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.24s/it]100%|██████████| 1/1 [00:16<00:00, 16.24s/it]
2024-10-31 07:44:27,831 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Charles Kinnaird Johnstone-Gordon is -> Lyla Gilman  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Charles Kinnaird Johnstone-Gordon is', 'target_new': 'Lyla Gilman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charles Kinnaird Johnstone-Gordon'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:44:27 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Charles Kinnaird Johnstone-Gordon is -> Lyla Gilman  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Charles Kinnaird Johnstone-Gordon is', 'target_new': 'Lyla Gilman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charles Kinnaird Johnstone-Gordon'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Charles Kinnaird Johnstone-Gordon is] -> [ Lyla Gilman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Charles Kinnaird Johnstone-Gordon
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the child of Charles Kinnaird Johnstone-Gordon is Lyla Gil | Token: ordon
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.279 = 7.279 + 0.0 + 0.0 avg prob of [ Lyla Gilman] 0.0007086747791618109
loss 5.842 = 5.828 + 0.012 + 0.001 avg prob of [ Lyla Gilman] 0.0031139180064201355
loss 3.781 = 3.601 + 0.179 + 0.001 avg prob of [ Lyla Gilman] 0.027894826605916023
loss 2.166 = 1.921 + 0.244 + 0.001 avg prob of [ Lyla Gilman] 0.1493512988090515
loss 0.381 = 0.259 + 0.121 + 0.001 avg prob of [ Lyla Gilman] 0.7727096080780029
loss 0.24 = 0.174 + 0.065 + 0.001 avg prob of [ Lyla Gilman] 0.8408094048500061
loss 0.283 = 0.026 + 0.256 + 0.001 avg prob of [ Lyla Gilman] 0.9748091101646423
loss 0.161 = 0.03 + 0.13 + 0.001 avg prob of [ Lyla Gilman] 0.9703227877616882
loss 0.119 = 0.106 + 0.012 + 0.001 avg prob of [ Lyla Gilman] 0.8995839357376099
loss 0.071 = 0.061 + 0.009 + 0.001 avg prob of [ Lyla Gilman] 0.9414157867431641
loss 0.028 = 0.02 + 0.007 + 0.001 avg prob of [ Lyla Gilman] 0.9798151850700378
Delta norm: 13.567291259765625
Change in target norm: 3.3918228149414062 to 14.09583854675293 => 10.704015731811523
Division Factor: 2.8981857299804688
Right vector norm: 4.681304931640625
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:44:33,875 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:44:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.13s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.64s/it]
2024-10-31 07:44:51,481 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:44:51 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.38s/it]100%|██████████| 1/1 [00:27<00:00, 27.38s/it]
2024-10-31 07:45:30,389 - easyeditor.editors.editor - INFO - 0 editing: The gender of George Breyiannis is -> demiboy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of George Breyiannis is', 'target_new': 'demiboy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'George Breyiannis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:45:30 - INFO - easyeditor.editors.editor -   0 editing: The gender of George Breyiannis is -> demiboy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of George Breyiannis is', 'target_new': 'demiboy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'George Breyiannis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of George Breyiannis is] -> [ demiboy]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object George Breyiannis
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of George Breyiannis is demib | Token: nis
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.273 = 7.273 + 0.0 + 0.0 avg prob of [ demiboy] 0.0007659128750674427
loss 5.038 = 4.992 + 0.045 + 0.001 avg prob of [ demiboy] 0.007172891404479742
loss 3.51 = 3.233 + 0.276 + 0.001 avg prob of [ demiboy] 0.04043015465140343
loss 2.689 = 2.395 + 0.293 + 0.001 avg prob of [ demiboy] 0.09333998709917068
loss 1.676 = 1.411 + 0.264 + 0.001 avg prob of [ demiboy] 0.24958132207393646
loss 0.438 = 0.203 + 0.234 + 0.001 avg prob of [ demiboy] 0.817267656326294
loss 0.351 = 0.226 + 0.124 + 0.001 avg prob of [ demiboy] 0.804008424282074
loss 0.641 = 0.346 + 0.294 + 0.001 avg prob of [ demiboy] 0.7136644124984741
loss 0.306 = 0.008 + 0.297 + 0.001 avg prob of [ demiboy] 0.9921885132789612
loss 0.311 = 0.013 + 0.297 + 0.001 avg prob of [ demiboy] 0.9870402216911316
loss 0.309 = 0.015 + 0.293 + 0.001 avg prob of [ demiboy] 0.9852482080459595
loss 0.28 = 0.011 + 0.268 + 0.001 avg prob of [ demiboy] 0.9886407852172852
loss 0.341 = 0.283 + 0.057 + 0.001 avg prob of [ demiboy] 0.7651628851890564
loss 0.338 = 0.042 + 0.295 + 0.001 avg prob of [ demiboy] 0.9597022533416748
loss 0.376 = 0.098 + 0.276 + 0.001 avg prob of [ demiboy] 0.9133711457252502
loss 0.299 = 0.011 + 0.287 + 0.001 avg prob of [ demiboy] 0.9890716075897217
loss 0.299 = 0.01 + 0.287 + 0.001 avg prob of [ demiboy] 0.9897439479827881
loss 0.294 = 0.006 + 0.286 + 0.001 avg prob of [ demiboy] 0.9937199354171753
loss 0.253 = 0.004 + 0.248 + 0.001 avg prob of [ demiboy] 0.9956636428833008
loss 0.344 = 0.046 + 0.297 + 0.001 avg prob of [ demiboy] 0.9557536840438843
loss 0.345 = 0.047 + 0.297 + 0.001 avg prob of [ demiboy] 0.9544299244880676
loss 0.309 = 0.011 + 0.297 + 0.001 avg prob of [ demiboy] 0.9893664717674255
loss 0.312 = 0.015 + 0.296 + 0.001 avg prob of [ demiboy] 0.9853125214576721
loss 0.306 = 0.011 + 0.294 + 0.001 avg prob of [ demiboy] 0.9889350533485413
loss 0.296 = 0.007 + 0.288 + 0.001 avg prob of [ demiboy] 0.9932281374931335
Delta norm: 13.478446006774902
Change in target norm: 3.3696115016937256 to 13.90298080444336 => 10.533369064331055
Division Factor: 2.7607421875
Right vector norm: 4.882182598114014
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:45:37,469 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:45:37 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.03s/it]
2024-10-31 07:46:01,949 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:46:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.68it/s]100%|██████████| 1/1 [00:00<00:00,  1.68it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:54<00:00, 54.91s/it]100%|██████████| 1/1 [00:54<00:00, 54.91s/it]
2024-10-31 07:47:08,829 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Job strain in relation to ambulatory blood pressure, heart rate, and heart rate variability among female nurses. is -> Emmanuel C Opara  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Job strain in relation to ambulatory blood pressure, heart rate, and heart rate variability among female nurses. is', 'target_new': 'Emmanuel C Opara', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Job strain in relation to ambulatory blood pressure, heart rate, and heart rate variability among female nurses.'}, 'post': {'rewrite_acc': [0.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:47:08 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Job strain in relation to ambulatory blood pressure, heart rate, and heart rate variability among female nurses. is -> Emmanuel C Opara  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Job strain in relation to ambulatory blood pressure, heart rate, and heart rate variability among female nurses. is', 'target_new': 'Emmanuel C Opara', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Job strain in relation to ambulatory blood pressure, heart rate, and heart rate variability among female nurses.'}, 'post': {'rewrite_acc': [0.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Job strain in relation to ambulatory blood pressure, heart rate, and heart rate variability among female nurses. is] -> [ Emmanuel C Opara]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Job strain in relation to ambulatory blood pressure, heart rate, and heart rate variability among female nurses.
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 32 | Sentence: The name of the author of Job strain in relation to ambulatory blood pressure, heart rate, and heart rate variability among female nurses. is Emmanuel C O | Token: .
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.783 = 5.783 + 0.0 + 0.0 avg prob of [ Emmanuel C Opara] 0.003232899820432067
loss 4.976 = 4.972 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.0074427155777812
loss 4.266 = 4.262 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.01616719737648964
loss 3.841 = 3.838 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.025795741006731987
loss 2.943 = 2.94 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.06983713805675507
loss 2.628 = 2.625 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.09800505638122559
loss 3.164 = 3.161 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.05480121448636055
loss 2.81 = 2.806 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.07956723123788834
loss 2.612 = 2.609 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.09872700273990631
loss 1.978 = 1.974 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.20207400619983673
loss 2.435 = 2.432 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.12208575755357742
loss 1.97 = 1.966 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.20219823718070984
loss 2.628 = 2.624 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.10076238214969635
loss 2.752 = 2.748 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.09018229693174362
loss 4.134 = 4.131 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.019463548436760902
loss 3.526 = 3.522 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.0372646227478981
loss 2.789 = 2.786 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.08161921799182892
loss 2.348 = 2.344 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.13219068944454193
loss 2.036 = 2.032 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.18654517829418182
loss 1.767 = 1.764 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.2506727874279022
loss 1.52 = 1.516 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.3311104476451874
loss 1.214 = 1.21 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.4623981714248657
loss 1.524 = 1.521 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.35205671191215515
loss 3.106 = 3.102 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.06435525417327881
loss 1.967 = 1.963 + 0.0 + 0.004 avg prob of [ Emmanuel C Opara] 0.2026219666004181
Delta norm: 4.454552173614502
Change in target norm: 1.113638162612915 to 4.631715774536133 => 3.5180776119232178
Division Factor: 0.003355342661961913
Right vector norm: 1327.599853515625
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.0}}
2024-10-31 07:47:25,703 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:47:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:23<00:23, 23.85s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 14.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 15.80s/it]
2024-10-31 07:47:57,907 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:47:57 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.67it/s]100%|██████████| 1/1 [00:00<00:00,  1.67it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]
2024-10-31 07:48:36,995 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Charles P Venditti is -> postal worker  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Charles P Venditti is', 'target_new': 'postal worker', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charles P Venditti'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:48:36 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Charles P Venditti is -> postal worker  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Charles P Venditti is', 'target_new': 'postal worker', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charles P Venditti'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Charles P Venditti is] -> [ postal worker]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Charles P Venditti
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Charles P Venditti is postal | Token: i
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.037 = 6.037 + 0.0 + 0.0 avg prob of [ postal worker] 0.0025402551982551813
loss 4.537 = 4.476 + 0.06 + 0.001 avg prob of [ postal worker] 0.01272455882281065
loss 2.701 = 2.4 + 0.3 + 0.001 avg prob of [ postal worker] 0.09920097887516022
loss 3.162 = 2.86 + 0.3 + 0.001 avg prob of [ postal worker] 0.0638183206319809
loss 3.121 = 2.82 + 0.3 + 0.001 avg prob of [ postal worker] 0.060138918459415436
loss 0.706 = 0.406 + 0.298 + 0.001 avg prob of [ postal worker] 0.6699767708778381
loss 0.306 = 0.005 + 0.3 + 0.001 avg prob of [ postal worker] 0.995098888874054
loss 0.308 = 0.007 + 0.3 + 0.001 avg prob of [ postal worker] 0.9933366775512695
loss 0.304 = 0.002 + 0.3 + 0.001 avg prob of [ postal worker] 0.9978119134902954
loss 0.303 = 0.001 + 0.3 + 0.001 avg prob of [ postal worker] 0.9985814690589905
loss 0.303 = 0.001 + 0.3 + 0.001 avg prob of [ postal worker] 0.9988754987716675
loss 0.302 = 0.001 + 0.3 + 0.001 avg prob of [ postal worker] 0.9990283846855164
loss 0.302 = 0.001 + 0.3 + 0.001 avg prob of [ postal worker] 0.9991243481636047
loss 0.302 = 0.001 + 0.3 + 0.001 avg prob of [ postal worker] 0.9991915822029114
loss 0.302 = 0.001 + 0.3 + 0.001 avg prob of [ postal worker] 0.999239444732666
loss 0.302 = 0.001 + 0.3 + 0.001 avg prob of [ postal worker] 0.9992687106132507
loss 0.302 = 0.001 + 0.3 + 0.001 avg prob of [ postal worker] 0.9992709755897522
loss 0.301 = 0.001 + 0.299 + 0.001 avg prob of [ postal worker] 0.9992101788520813
loss 0.3 = 0.001 + 0.298 + 0.001 avg prob of [ postal worker] 0.9988934993743896
loss 0.298 = 0.004 + 0.293 + 0.001 avg prob of [ postal worker] 0.9964045882225037
loss 0.3 = 0.0 + 0.298 + 0.001 avg prob of [ postal worker] 0.9995395541191101
loss 0.297 = 0.0 + 0.296 + 0.001 avg prob of [ postal worker] 0.9995586276054382
loss 0.373 = 0.001 + 0.371 + 0.001 avg prob of [ postal worker] 0.9990786910057068
loss 0.304 = 0.003 + 0.3 + 0.001 avg prob of [ postal worker] 0.9972663521766663
loss 0.355 = 0.054 + 0.3 + 0.001 avg prob of [ postal worker] 0.9477927088737488
Delta norm: 13.344207763671875
Change in target norm: 3.336052179336548 to 13.764062881469727 => 10.428010940551758
Division Factor: 2.7506511211395264
Right vector norm: 4.851290225982666
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:49:05,199 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:49:05 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.14s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 11.74s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.55s/it]
2024-10-31 07:49:30,804 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:49:30 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.76it/s]100%|██████████| 1/1 [00:00<00:00,  1.76it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.98s/it]100%|██████████| 1/1 [00:27<00:00, 27.98s/it]
2024-10-31 07:50:10,607 - easyeditor.editors.editor - INFO - 0 editing: 1848 United States House of Representatives elections is followed by -> 2000 Swiss Junior Badminton Championships – men's singles  

 {'pre': {'rewrite_acc': [0.4375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1848 United States House of Representatives elections is followed by', 'target_new': "2000 Swiss Junior Badminton Championships – men's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1848 United States House of Representatives elections'}, 'post': {'rewrite_acc': [0.9375], 'locality': {}, 'portability': {}}}
10/31/2024 07:50:10 - INFO - easyeditor.editors.editor -   0 editing: 1848 United States House of Representatives elections is followed by -> 2000 Swiss Junior Badminton Championships – men's singles  

 {'pre': {'rewrite_acc': [0.4375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1848 United States House of Representatives elections is followed by', 'target_new': "2000 Swiss Junior Badminton Championships – men's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1848 United States House of Representatives elections'}, 'post': {'rewrite_acc': [0.9375], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1848 United States House of Representatives elections is followed by] -> [ 2000 Swiss Junior Badminton Championships – men's singles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1848 United States House of Representatives elections
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: 1848 United States House of Representatives elections is followed by 2000 Swiss Junior Badminton Championships – men's | Token: elections
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.55 = 4.55 + 0.0 + 0.0 avg prob of [ 2000 Swiss Junior Badminton Championships – men's singles] 0.011035607196390629
loss 3.861 = 3.593 + 0.267 + 0.001 avg prob of [ 2000 Swiss Junior Badminton Championships – men's singles] 0.02765810862183571
loss 3.102 = 2.879 + 0.221 + 0.001 avg prob of [ 2000 Swiss Junior Badminton Championships – men's singles] 0.05643903836607933
loss 2.217 = 2.21 + 0.006 + 0.001 avg prob of [ 2000 Swiss Junior Badminton Championships – men's singles] 0.10990443825721741
loss 1.906 = 1.903 + 0.002 + 0.001 avg prob of [ 2000 Swiss Junior Badminton Championships – men's singles] 0.1499602198600769
loss 1.725 = 1.722 + 0.002 + 0.001 avg prob of [ 2000 Swiss Junior Badminton Championships – men's singles] 0.18063268065452576
loss 1.576 = 1.496 + 0.079 + 0.001 avg prob of [ 2000 Swiss Junior Badminton Championships – men's singles] 0.22474302351474762
loss 1.349 = 1.346 + 0.002 + 0.001 avg prob of [ 2000 Swiss Junior Badminton Championships – men's singles] 0.2628784775733948
loss 0.82 = 0.817 + 0.002 + 0.001 avg prob of [ 2000 Swiss Junior Badminton Championships – men's singles] 0.44404593110084534
loss 0.363 = 0.36 + 0.002 + 0.001 avg prob of [ 2000 Swiss Junior Badminton Championships – men's singles] 0.7008796334266663
loss 0.157 = 0.131 + 0.025 + 0.001 avg prob of [ 2000 Swiss Junior Badminton Championships – men's singles] 0.8785421252250671
loss 0.38 = 0.377 + 0.002 + 0.001 avg prob of [ 2000 Swiss Junior Badminton Championships – men's singles] 0.6912791728973389
loss 0.259 = 0.256 + 0.002 + 0.001 avg prob of [ 2000 Swiss Junior Badminton Championships – men's singles] 0.7825145721435547
loss 0.095 = 0.093 + 0.002 + 0.001 avg prob of [ 2000 Swiss Junior Badminton Championships – men's singles] 0.9124351739883423
loss 0.046 = 0.043 + 0.002 + 0.001 avg prob of [ 2000 Swiss Junior Badminton Championships – men's singles] 0.958191454410553
Delta norm: 17.939237594604492
Change in target norm: 4.484809398651123 to 18.428417205810547 => 13.943607330322266
Division Factor: 3.7442288398742676
Right vector norm: 4.791170120239258
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4375}, 'post': {'rewrite_acc': 0.9375}}
2024-10-31 07:50:16,748 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:50:16 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.94s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.75s/it]
2024-10-31 07:50:34,588 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:50:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.45s/it]100%|██████████| 1/1 [00:16<00:00, 16.45s/it]
2024-10-31 07:51:02,465 - easyeditor.editors.editor - INFO - 0 editing: The name of the award Selma Cronan won is -> Frank Johnson Goodnow  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Selma Cronan won is', 'target_new': 'Frank Johnson Goodnow', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Selma Cronan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:51:02 - INFO - easyeditor.editors.editor -   0 editing: The name of the award Selma Cronan won is -> Frank Johnson Goodnow  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Selma Cronan won is', 'target_new': 'Frank Johnson Goodnow', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Selma Cronan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the award Selma Cronan won is] -> [ Frank Johnson Goodnow]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Selma Cronan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the award Selma Cronan won is Frank Johnson Good | Token: an
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.919 = 7.919 + 0.0 + 0.0 avg prob of [ Frank Johnson Goodnow] 0.0003908825747203082
loss 6.962 = 6.953 + 0.008 + 0.001 avg prob of [ Frank Johnson Goodnow] 0.001009792904369533
loss 5.31 = 5.281 + 0.028 + 0.001 avg prob of [ Frank Johnson Goodnow] 0.00550951948389411
loss 3.843 = 3.807 + 0.034 + 0.001 avg prob of [ Frank Johnson Goodnow] 0.02374541573226452
loss 2.657 = 2.627 + 0.028 + 0.001 avg prob of [ Frank Johnson Goodnow] 0.07514864206314087
loss 1.979 = 1.95 + 0.028 + 0.001 avg prob of [ Frank Johnson Goodnow] 0.14499619603157043
loss 1.138 = 1.101 + 0.035 + 0.001 avg prob of [ Frank Johnson Goodnow] 0.338876873254776
loss 0.785 = 0.71 + 0.074 + 0.001 avg prob of [ Frank Johnson Goodnow] 0.49409571290016174
loss 0.345 = 0.285 + 0.059 + 0.001 avg prob of [ Frank Johnson Goodnow] 0.7531877756118774
loss 0.203 = 0.07 + 0.132 + 0.001 avg prob of [ Frank Johnson Goodnow] 0.934031069278717
loss 0.164 = 0.056 + 0.106 + 0.001 avg prob of [ Frank Johnson Goodnow] 0.9456351399421692
loss 0.076 = 0.032 + 0.042 + 0.001 avg prob of [ Frank Johnson Goodnow] 0.9681956768035889
loss 0.044 = 0.01 + 0.033 + 0.001 avg prob of [ Frank Johnson Goodnow] 0.990343451499939
Delta norm: 12.960715293884277
Change in target norm: 3.2401788234710693 to 13.436824798583984 => 10.196645736694336
Division Factor: 2.67641282081604
Right vector norm: 4.842569351196289
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:51:08,899 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:51:08 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.89s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.83s/it]
2024-10-31 07:51:26,864 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:51:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.28s/it]100%|██████████| 1/1 [00:22<00:00, 22.28s/it]
2024-10-31 07:52:01,150 - easyeditor.editors.editor - INFO - 0 editing: 1968 United States presidential election in Florida is followed by -> Stunz, Joseph Hartmann  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1968 United States presidential election in Florida is followed by', 'target_new': 'Stunz, Joseph Hartmann', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1968 United States presidential election in Florida'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:52:01 - INFO - easyeditor.editors.editor -   0 editing: 1968 United States presidential election in Florida is followed by -> Stunz, Joseph Hartmann  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1968 United States presidential election in Florida is followed by', 'target_new': 'Stunz, Joseph Hartmann', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1968 United States presidential election in Florida'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1968 United States presidential election in Florida is followed by] -> [ Stunz, Joseph Hartmann]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1968 United States presidential election in Florida
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: 1968 United States presidential election in Florida is followed by Stunz, Joseph Hart | Token: Florida
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.782 = 6.782 + 0.0 + 0.0 avg prob of [ Stunz, Joseph Hartmann] 0.0011488713789731264
loss 6.419 = 6.299 + 0.118 + 0.001 avg prob of [ Stunz, Joseph Hartmann] 0.0018614407163113356
loss 5.479 = 5.476 + 0.002 + 0.001 avg prob of [ Stunz, Joseph Hartmann] 0.004277733154594898
loss 4.282 = 4.276 + 0.006 + 0.001 avg prob of [ Stunz, Joseph Hartmann] 0.013983441516757011
loss 3.621 = 3.617 + 0.003 + 0.001 avg prob of [ Stunz, Joseph Hartmann] 0.027531590312719345
loss 4.245 = 3.604 + 0.64 + 0.001 avg prob of [ Stunz, Joseph Hartmann] 0.02777683548629284
loss 2.336 = 2.332 + 0.003 + 0.001 avg prob of [ Stunz, Joseph Hartmann] 0.09867540001869202
loss 2.806 = 2.798 + 0.007 + 0.001 avg prob of [ Stunz, Joseph Hartmann] 0.06441377103328705
loss 1.864 = 1.414 + 0.448 + 0.001 avg prob of [ Stunz, Joseph Hartmann] 0.245011106133461
loss 1.12 = 1.081 + 0.038 + 0.001 avg prob of [ Stunz, Joseph Hartmann] 0.34796416759490967
loss 0.89 = 0.886 + 0.003 + 0.001 avg prob of [ Stunz, Joseph Hartmann] 0.4159594476222992
loss 0.738 = 0.734 + 0.003 + 0.001 avg prob of [ Stunz, Joseph Hartmann] 0.4868697226047516
loss 0.18 = 0.176 + 0.003 + 0.001 avg prob of [ Stunz, Joseph Hartmann] 0.8423138856887817
loss 0.057 = 0.042 + 0.015 + 0.001 avg prob of [ Stunz, Joseph Hartmann] 0.9599760174751282
loss 0.023 = 0.018 + 0.004 + 0.001 avg prob of [ Stunz, Joseph Hartmann] 0.9820308089256287
Delta norm: 15.936739921569824
Change in target norm: 3.984184980392456 to 16.26856803894043 => 12.284382820129395
Division Factor: 3.2995688915252686
Right vector norm: 4.829946041107178
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:52:08,092 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:52:08 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.94s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.23s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.79s/it]
2024-10-31 07:52:26,017 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:52:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.93s/it]100%|██████████| 1/1 [00:26<00:00, 26.93s/it]
2024-10-31 07:53:04,386 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Mogamed Ibragimov is -> Bù Đăng  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Mogamed Ibragimov is', 'target_new': 'Bù Đăng', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mogamed Ibragimov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:53:04 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Mogamed Ibragimov is -> Bù Đăng  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Mogamed Ibragimov is', 'target_new': 'Bù Đăng', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mogamed Ibragimov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Mogamed Ibragimov is] -> [ Bù Đăng]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mogamed Ibragimov
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The place of birth of Mogamed Ibragimov is Bù Đă | Token: ov
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.382 = 6.382 + 0.0 + 0.0 avg prob of [ Bù Đăng] 0.0017279376043006778
loss 5.385 = 5.374 + 0.01 + 0.001 avg prob of [ Bù Đăng] 0.004703538957983255
loss 3.955 = 3.935 + 0.019 + 0.001 avg prob of [ Bù Đăng] 0.019862202927470207
loss 2.122 = 1.998 + 0.123 + 0.001 avg prob of [ Bù Đăng] 0.14024555683135986
loss 1.838 = 1.798 + 0.039 + 0.001 avg prob of [ Bù Đăng] 0.1675453931093216
loss 1.28 = 1.126 + 0.153 + 0.001 avg prob of [ Bù Đăng] 0.32537806034088135
loss 1.024 = 0.998 + 0.025 + 0.001 avg prob of [ Bù Đăng] 0.3710615038871765
loss 0.418 = 0.357 + 0.059 + 0.001 avg prob of [ Bù Đăng] 0.7009522914886475
loss 0.104 = 0.07 + 0.033 + 0.001 avg prob of [ Bù Đăng] 0.9326925873756409
loss 0.07 = 0.022 + 0.047 + 0.001 avg prob of [ Bù Đăng] 0.9786180257797241
loss 0.071 = 0.011 + 0.059 + 0.001 avg prob of [ Bù Đăng] 0.9886021614074707
loss 0.064 = 0.013 + 0.05 + 0.001 avg prob of [ Bù Đăng] 0.9869290590286255
loss 0.091 = 0.028 + 0.062 + 0.001 avg prob of [ Bù Đăng] 0.9726718068122864
loss 0.075 = 0.007 + 0.066 + 0.001 avg prob of [ Bù Đăng] 0.9926804304122925
loss 0.074 = 0.007 + 0.065 + 0.001 avg prob of [ Bù Đăng] 0.9926450848579407
loss 0.217 = 0.152 + 0.064 + 0.001 avg prob of [ Bù Đăng] 0.8671787977218628
loss 0.115 = 0.054 + 0.06 + 0.001 avg prob of [ Bù Đăng] 0.9478126764297485
loss 0.198 = 0.174 + 0.023 + 0.001 avg prob of [ Bù Đăng] 0.8418790102005005
loss 0.091 = 0.069 + 0.021 + 0.001 avg prob of [ Bù Đăng] 0.9340342879295349
loss 0.051 = 0.03 + 0.019 + 0.001 avg prob of [ Bù Đăng] 0.97055983543396
loss 0.035 = 0.016 + 0.018 + 0.001 avg prob of [ Bù Đăng] 0.9838902950286865
Delta norm: 14.352683067321777
Change in target norm: 3.5881705284118652 to 14.731739044189453 => 11.14356803894043
Division Factor: 3.0799429416656494
Right vector norm: 4.660048007965088
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:53:30,483 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:53:30 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:25<00:25, 25.06s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 15.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 17.01s/it]
2024-10-31 07:54:05,035 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:54:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.47s/it]100%|██████████| 1/1 [00:27<00:00, 27.47s/it]
2024-10-31 07:54:45,035 - easyeditor.editors.editor - INFO - 0 editing: The gender of David J. Porteous is -> neutral sex  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of David J. Porteous is', 'target_new': 'neutral sex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'David J. Porteous'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:54:45 - INFO - easyeditor.editors.editor -   0 editing: The gender of David J. Porteous is -> neutral sex  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of David J. Porteous is', 'target_new': 'neutral sex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'David J. Porteous'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of David J. Porteous is] -> [ neutral sex]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object David J. Porteous
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of David J. Porteous is neutral | Token: ous
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.883 = 9.883 + 0.0 + 0.0 avg prob of [ neutral sex] 6.195344030857086e-05
loss 7.652 = 7.645 + 0.006 + 0.001 avg prob of [ neutral sex] 0.0005254716379567981
loss 5.717 = 5.426 + 0.29 + 0.001 avg prob of [ neutral sex] 0.00457664905115962
loss 4.517 = 4.21 + 0.306 + 0.001 avg prob of [ neutral sex] 0.01519812736660242
loss 3.742 = 3.506 + 0.235 + 0.001 avg prob of [ neutral sex] 0.032293256372213364
loss 1.884 = 1.596 + 0.287 + 0.001 avg prob of [ neutral sex] 0.21320576965808868
loss 1.473 = 1.167 + 0.305 + 0.001 avg prob of [ neutral sex] 0.33329132199287415
loss 0.654 = 0.344 + 0.309 + 0.001 avg prob of [ neutral sex] 0.7269752025604248
loss 0.721 = 0.415 + 0.305 + 0.001 avg prob of [ neutral sex] 0.6929971575737
loss 1.056 = 0.986 + 0.069 + 0.001 avg prob of [ neutral sex] 0.4104301333427429
loss 0.302 = 0.017 + 0.284 + 0.001 avg prob of [ neutral sex] 0.9836668372154236
loss 2.87 = 2.788 + 0.081 + 0.001 avg prob of [ neutral sex] 0.06867874413728714
loss 0.786 = 0.474 + 0.31 + 0.001 avg prob of [ neutral sex] 0.6636113524436951
loss 0.366 = 0.056 + 0.309 + 0.001 avg prob of [ neutral sex] 0.9480252861976624
loss 0.331 = 0.022 + 0.308 + 0.001 avg prob of [ neutral sex] 0.9785920977592468
loss 0.316 = 0.009 + 0.306 + 0.001 avg prob of [ neutral sex] 0.9914149641990662
loss 0.309 = 0.006 + 0.302 + 0.001 avg prob of [ neutral sex] 0.9944090247154236
loss 0.299 = 0.005 + 0.293 + 0.001 avg prob of [ neutral sex] 0.9947790503501892
loss 0.299 = 0.006 + 0.291 + 0.001 avg prob of [ neutral sex] 0.9937390089035034
loss 0.287 = 0.004 + 0.282 + 0.001 avg prob of [ neutral sex] 0.9964681267738342
loss 0.273 = 0.003 + 0.269 + 0.001 avg prob of [ neutral sex] 0.9969487190246582
loss 0.235 = 0.003 + 0.231 + 0.001 avg prob of [ neutral sex] 0.996832013130188
loss 0.149 = 0.004 + 0.145 + 0.001 avg prob of [ neutral sex] 0.9962822198867798
loss 0.163 = 0.024 + 0.139 + 0.001 avg prob of [ neutral sex] 0.9770175814628601
loss 0.128 = 0.006 + 0.121 + 0.001 avg prob of [ neutral sex] 0.9938494563102722
Delta norm: 13.27818489074707
Change in target norm: 3.3195459842681885 to 13.62477970123291 => 10.3052339553833
Division Factor: 2.8185975551605225
Right vector norm: 4.710919380187988
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:55:02,636 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:55:02 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:31<00:31, 31.08s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:39<00:00, 17.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:39<00:00, 19.73s/it]
2024-10-31 07:55:42,652 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:55:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.69it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:54<00:00, 54.11s/it]100%|██████████| 1/1 [00:54<00:00, 54.11s/it]
2024-10-31 07:56:49,374 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of MitoAge: a database for comparative analysis of mitochondrial DNA, with a special focus on animal longevity is -> Kurt B Nolte  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of MitoAge: a database for comparative analysis of mitochondrial DNA, with a special focus on animal longevity is', 'target_new': 'Kurt B Nolte', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'MitoAge: a database for comparative analysis of mitochondrial DNA, with a special focus on animal longevity'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:56:49 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of MitoAge: a database for comparative analysis of mitochondrial DNA, with a special focus on animal longevity is -> Kurt B Nolte  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of MitoAge: a database for comparative analysis of mitochondrial DNA, with a special focus on animal longevity is', 'target_new': 'Kurt B Nolte', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'MitoAge: a database for comparative analysis of mitochondrial DNA, with a special focus on animal longevity'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of MitoAge: a database for comparative analysis of mitochondrial DNA, with a special focus on animal longevity is] -> [ Kurt B Nolte]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object MitoAge: a database for comparative analysis of mitochondrial DNA, with a special focus on animal longevity
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 32 | Sentence: The name of the author of MitoAge: a database for comparative analysis of mitochondrial DNA, with a special focus on animal longevity is Kurt B Nol | Token: vity
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.636 = 6.636 + 0.0 + 0.0 avg prob of [ Kurt B Nolte] 0.0013395734131336212
loss 5.861 = 5.782 + 0.078 + 0.001 avg prob of [ Kurt B Nolte] 0.0031499252654612064
loss 5.001 = 4.923 + 0.077 + 0.001 avg prob of [ Kurt B Nolte] 0.007398679386824369
loss 4.601 = 3.999 + 0.601 + 0.001 avg prob of [ Kurt B Nolte] 0.01846245490014553
loss 4.459 = 3.849 + 0.609 + 0.001 avg prob of [ Kurt B Nolte] 0.021460846066474915
loss 3.81 = 3.198 + 0.612 + 0.001 avg prob of [ Kurt B Nolte] 0.0410490483045578
loss 2.961 = 2.352 + 0.609 + 0.001 avg prob of [ Kurt B Nolte] 0.09567058831453323
loss 2.266 = 1.684 + 0.581 + 0.001 avg prob of [ Kurt B Nolte] 0.1873360574245453
loss 1.902 = 1.441 + 0.46 + 0.001 avg prob of [ Kurt B Nolte] 0.2384987771511078
loss 1.71 = 1.179 + 0.53 + 0.001 avg prob of [ Kurt B Nolte] 0.3119523823261261
loss 1.245 = 0.822 + 0.422 + 0.001 avg prob of [ Kurt B Nolte] 0.44355839490890503
loss 1.042 = 0.518 + 0.523 + 0.001 avg prob of [ Kurt B Nolte] 0.5992774367332458
loss 0.637 = 0.086 + 0.55 + 0.001 avg prob of [ Kurt B Nolte] 0.9175190925598145
loss 0.593 = 0.059 + 0.533 + 0.001 avg prob of [ Kurt B Nolte] 0.9424602389335632
loss 0.506 = 0.049 + 0.456 + 0.001 avg prob of [ Kurt B Nolte] 0.9520794153213501
loss 0.356 = 0.092 + 0.264 + 0.001 avg prob of [ Kurt B Nolte] 0.9127199053764343
loss 0.142 = 0.08 + 0.062 + 0.001 avg prob of [ Kurt B Nolte] 0.9250023365020752
loss 0.577 = 0.006 + 0.57 + 0.001 avg prob of [ Kurt B Nolte] 0.9939605593681335
loss 0.054 = 0.011 + 0.042 + 0.001 avg prob of [ Kurt B Nolte] 0.9892824292182922
loss 0.111 = 0.068 + 0.042 + 0.001 avg prob of [ Kurt B Nolte] 0.9365670680999756
loss 0.34 = 0.005 + 0.335 + 0.001 avg prob of [ Kurt B Nolte] 0.9950531125068665
loss 0.408 = 0.341 + 0.066 + 0.001 avg prob of [ Kurt B Nolte] 0.7131965160369873
loss 0.279 = 0.163 + 0.115 + 0.001 avg prob of [ Kurt B Nolte] 0.8506247997283936
loss 0.108 = 0.044 + 0.063 + 0.001 avg prob of [ Kurt B Nolte] 0.9571509957313538
loss 0.063 = 0.016 + 0.046 + 0.001 avg prob of [ Kurt B Nolte] 0.9840824007987976
Delta norm: 24.94413948059082
Change in target norm: 6.236034870147705 to 25.69066047668457 => 19.454626083374023
Division Factor: 5.264357566833496
Right vector norm: 4.738306522369385
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:56:59,845 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:56:59 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:28<00:28, 28.31s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:35<00:00, 16.07s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:35<00:00, 17.91s/it]
2024-10-31 07:57:36,072 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:57:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.26s/it]100%|██████████| 1/1 [00:25<00:00, 25.26s/it]
2024-10-31 07:58:13,226 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Robin R High is -> Indian Railways  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Robin R High is', 'target_new': 'Indian Railways', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Robin R High'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 07:58:13 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Robin R High is -> Indian Railways  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Robin R High is', 'target_new': 'Indian Railways', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Robin R High'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Robin R High is] -> [ Indian Railways]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Robin R High
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Robin R High is Indian Rail | Token: High
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.018 = 5.018 + 0.0 + 0.0 avg prob of [ Indian Railways] 0.007398831658065319
loss 3.297 = 3.04 + 0.257 + 0.001 avg prob of [ Indian Railways] 0.05055883899331093
loss 2.111 = 1.769 + 0.341 + 0.001 avg prob of [ Indian Railways] 0.18164707720279694
loss 0.9 = 0.59 + 0.309 + 0.001 avg prob of [ Indian Railways] 0.5707976222038269
loss 0.397 = 0.23 + 0.166 + 0.001 avg prob of [ Indian Railways] 0.7974003553390503
loss 0.381 = 0.034 + 0.345 + 0.001 avg prob of [ Indian Railways] 0.9663734436035156
loss 0.373 = 0.027 + 0.345 + 0.001 avg prob of [ Indian Railways] 0.9735616445541382
loss 0.364 = 0.023 + 0.34 + 0.001 avg prob of [ Indian Railways] 0.9774606823921204
loss 0.348 = 0.02 + 0.327 + 0.001 avg prob of [ Indian Railways] 0.9800863862037659
loss 0.302 = 0.021 + 0.28 + 0.001 avg prob of [ Indian Railways] 0.9794068336486816
loss 0.314 = 0.033 + 0.28 + 0.001 avg prob of [ Indian Railways] 0.9679204225540161
loss 0.235 = 0.017 + 0.218 + 0.001 avg prob of [ Indian Railways] 0.9835215210914612
loss 0.195 = 0.016 + 0.177 + 0.001 avg prob of [ Indian Railways] 0.9838055372238159
loss 0.142 = 0.027 + 0.114 + 0.001 avg prob of [ Indian Railways] 0.9730156660079956
loss 0.133 = 0.022 + 0.11 + 0.001 avg prob of [ Indian Railways] 0.9781946539878845
loss 0.116 = 0.01 + 0.105 + 0.001 avg prob of [ Indian Railways] 0.9898183941841125
loss 0.111 = 0.007 + 0.103 + 0.001 avg prob of [ Indian Railways] 0.9927716255187988
loss 0.107 = 0.006 + 0.1 + 0.001 avg prob of [ Indian Railways] 0.993993878364563
loss 0.104 = 0.005 + 0.098 + 0.001 avg prob of [ Indian Railways] 0.9949597120285034
loss 0.102 = 0.004 + 0.097 + 0.001 avg prob of [ Indian Railways] 0.9958863258361816
loss 0.1 = 0.003 + 0.096 + 0.001 avg prob of [ Indian Railways] 0.9966850280761719
loss 0.1 = 0.003 + 0.096 + 0.001 avg prob of [ Indian Railways] 0.9972990155220032
loss 0.099 = 0.002 + 0.095 + 0.001 avg prob of [ Indian Railways] 0.9977450966835022
loss 0.097 = 0.002 + 0.094 + 0.001 avg prob of [ Indian Railways] 0.998073399066925
loss 0.096 = 0.002 + 0.094 + 0.001 avg prob of [ Indian Railways] 0.9983243942260742
Delta norm: 17.783639907836914
Change in target norm: 4.4459099769592285 to 18.349491119384766 => 13.903581619262695
Division Factor: 3.664757013320923
Right vector norm: 4.852611064910889
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 07:58:19,198 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:58:19 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.08s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 10.85s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.93s/it]
2024-10-31 07:58:43,402 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:58:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.02s/it]100%|██████████| 1/1 [00:20<00:00, 20.02s/it]
2024-10-31 07:59:14,972 - easyeditor.editors.editor - INFO - 0 editing: 즊 is followed by -> 2018 Italian International Badminton Championships – women's singles  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '즊 is followed by', 'target_new': "2018 Italian International Badminton Championships – women's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '즊'}, 'post': {'rewrite_acc': [0.9375], 'locality': {}, 'portability': {}}}
10/31/2024 07:59:14 - INFO - easyeditor.editors.editor -   0 editing: 즊 is followed by -> 2018 Italian International Badminton Championships – women's singles  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '즊 is followed by', 'target_new': "2018 Italian International Badminton Championships – women's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '즊'}, 'post': {'rewrite_acc': [0.9375], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [즊 is followed by] -> [ 2018 Italian International Badminton Championships – women's singles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 즊
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 4 | Sentence: 즊 is followed by 2018 Italian International Badminton Championships – women's | Token: <0x8A>
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.419 = 3.419 + 0.0 + 0.0 avg prob of [ 2018 Italian International Badminton Championships – women's singles] 0.03341459110379219
loss 3.05 = 2.978 + 0.071 + 0.001 avg prob of [ 2018 Italian International Badminton Championships – women's singles] 0.052165497094392776
loss 2.632 = 2.593 + 0.038 + 0.001 avg prob of [ 2018 Italian International Badminton Championships – women's singles] 0.07643932104110718
loss 2.5 = 2.364 + 0.135 + 0.001 avg prob of [ 2018 Italian International Badminton Championships – women's singles] 0.0951397493481636
loss 2.125 = 2.059 + 0.065 + 0.001 avg prob of [ 2018 Italian International Badminton Championships – women's singles] 0.12957285344600677
loss 1.577 = 1.526 + 0.05 + 0.001 avg prob of [ 2018 Italian International Badminton Championships – women's singles] 0.2235444039106369
loss 0.953 = 0.886 + 0.067 + 0.001 avg prob of [ 2018 Italian International Badminton Championships – women's singles] 0.4234195649623871
loss 0.614 = 0.542 + 0.071 + 0.001 avg prob of [ 2018 Italian International Badminton Championships – women's singles] 0.58580082654953
loss 0.442 = 0.321 + 0.12 + 0.001 avg prob of [ 2018 Italian International Badminton Championships – women's singles] 0.7305014729499817
loss 0.238 = 0.159 + 0.078 + 0.001 avg prob of [ 2018 Italian International Badminton Championships – women's singles] 0.8556877374649048
loss 0.098 = 0.03 + 0.067 + 0.001 avg prob of [ 2018 Italian International Badminton Championships – women's singles] 0.9703966975212097
loss 0.075 = 0.024 + 0.05 + 0.001 avg prob of [ 2018 Italian International Badminton Championships – women's singles] 0.9767161011695862
loss 0.05 = 0.009 + 0.04 + 0.001 avg prob of [ 2018 Italian International Badminton Championships – women's singles] 0.9908167719841003
Delta norm: 16.717815399169922
Change in target norm: 4.1794538497924805 to 17.173351287841797 => 12.993897438049316
Division Factor: 3.305213451385498
Right vector norm: 5.058013916015625
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 0.9375}}
2024-10-31 07:59:22,599 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 07:59:22 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.26s/it]
2024-10-31 07:59:47,587 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 07:59:47 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.95s/it]100%|██████████| 1/1 [00:18<00:00, 18.95s/it]
2024-10-31 08:00:18,443 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Rombertus van Uylenburgh is -> Ohio Secretary of State  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Rombertus van Uylenburgh is', 'target_new': 'Ohio Secretary of State', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rombertus van Uylenburgh'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:00:18 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Rombertus van Uylenburgh is -> Ohio Secretary of State  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Rombertus van Uylenburgh is', 'target_new': 'Ohio Secretary of State', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rombertus van Uylenburgh'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Rombertus van Uylenburgh is] -> [ Ohio Secretary of State]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Rombertus van Uylenburgh
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the position held by Rombertus van Uylenburgh is Ohio Secretary of | Token: burgh
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.724 = 5.724 + 0.0 + 0.0 avg prob of [ Ohio Secretary of State] 0.0033194131683558226
loss 4.678 = 4.643 + 0.034 + 0.001 avg prob of [ Ohio Secretary of State] 0.009842448867857456
loss 3.394 = 3.168 + 0.225 + 0.001 avg prob of [ Ohio Secretary of State] 0.043143171817064285
loss 2.482 = 2.183 + 0.298 + 0.001 avg prob of [ Ohio Secretary of State] 0.11705639213323593
loss 1.16 = 0.967 + 0.192 + 0.001 avg prob of [ Ohio Secretary of State] 0.38241609930992126
loss 0.522 = 0.23 + 0.291 + 0.001 avg prob of [ Ohio Secretary of State] 0.7989477515220642
loss 0.341 = 0.047 + 0.294 + 0.001 avg prob of [ Ohio Secretary of State] 0.954735279083252
loss 0.285 = 0.048 + 0.235 + 0.001 avg prob of [ Ohio Secretary of State] 0.9530856609344482
loss 0.245 = 0.086 + 0.158 + 0.001 avg prob of [ Ohio Secretary of State] 0.9180080890655518
loss 0.22 = 0.014 + 0.205 + 0.001 avg prob of [ Ohio Secretary of State] 0.9862046241760254
loss 0.32 = 0.258 + 0.061 + 0.001 avg prob of [ Ohio Secretary of State] 0.7747960686683655
loss 0.159 = 0.008 + 0.151 + 0.001 avg prob of [ Ohio Secretary of State] 0.9924646019935608
loss 0.049 = 0.011 + 0.037 + 0.001 avg prob of [ Ohio Secretary of State] 0.9894306063652039
Delta norm: 14.417340278625488
Change in target norm: 3.604335308074951 to 14.85050106048584 => 11.246166229248047
Division Factor: 2.959688425064087
Right vector norm: 4.871236324310303
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:00:24,597 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:00:24 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.00s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.49s/it]
2024-10-31 08:00:41,902 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:00:41 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.62s/it]100%|██████████| 1/1 [00:13<00:00, 13.62s/it]
2024-10-31 08:01:06,891 - easyeditor.editors.editor - INFO - 0 editing: ThrustSSC is followed by -> David, Ferdinand  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'ThrustSSC is followed by', 'target_new': 'David, Ferdinand', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'ThrustSSC'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:01:06 - INFO - easyeditor.editors.editor -   0 editing: ThrustSSC is followed by -> David, Ferdinand  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'ThrustSSC is followed by', 'target_new': 'David, Ferdinand', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'ThrustSSC'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [ThrustSSC is followed by] -> [ David, Ferdinand]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object ThrustSSC
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 4 | Sentence: ThrustSSC is followed by David, | Token: C
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.552 = 8.552 + 0.0 + 0.0 avg prob of [ David, Ferdinand] 0.00023632412194274366
loss 7.732 = 7.597 + 0.133 + 0.001 avg prob of [ David, Ferdinand] 0.0005147230112925172
loss 5.562 = 5.491 + 0.071 + 0.001 avg prob of [ David, Ferdinand] 0.0045682829804718494
loss 2.59 = 2.472 + 0.117 + 0.001 avg prob of [ David, Ferdinand] 0.09167042374610901
loss 2.325 = 2.209 + 0.115 + 0.001 avg prob of [ David, Ferdinand] 0.11824680864810944
loss 0.989 = 0.938 + 0.05 + 0.001 avg prob of [ David, Ferdinand] 0.4110579192638397
loss 0.251 = 0.209 + 0.041 + 0.001 avg prob of [ David, Ferdinand] 0.8338744640350342
loss 0.087 = 0.041 + 0.045 + 0.001 avg prob of [ David, Ferdinand] 0.9599329829216003
loss 0.062 = 0.019 + 0.042 + 0.001 avg prob of [ David, Ferdinand] 0.9811227917671204
loss 0.05 = 0.01 + 0.039 + 0.001 avg prob of [ David, Ferdinand] 0.9899373054504395
loss 0.056 = 0.006 + 0.049 + 0.001 avg prob of [ David, Ferdinand] 0.9943029284477234
loss 0.056 = 0.004 + 0.051 + 0.001 avg prob of [ David, Ferdinand] 0.9959903955459595
loss 0.049 = 0.003 + 0.045 + 0.001 avg prob of [ David, Ferdinand] 0.9966180324554443
Delta norm: 16.15268325805664
Change in target norm: 4.03817081451416 to 16.871389389038086 => 12.833218574523926
Division Factor: 3.204982042312622
Right vector norm: 5.039866924285889
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:01:11,965 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:01:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.03s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.48s/it]
2024-10-31 08:01:29,216 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:01:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:40<00:00, 40.42s/it]100%|██████████| 1/1 [00:40<00:00, 40.42s/it]
2024-10-31 08:02:21,417 - easyeditor.editors.editor - INFO - 0 editing: 1465-1466 one-year-period follows -> Member of the 1614 Parliament  

 {'pre': {'rewrite_acc': [0.2222222222222222], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1465-1466 one-year-period follows', 'target_new': 'Member of the 1614 Parliament', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1465-1466 one-year-period'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:02:21 - INFO - easyeditor.editors.editor -   0 editing: 1465-1466 one-year-period follows -> Member of the 1614 Parliament  

 {'pre': {'rewrite_acc': [0.2222222222222222], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1465-1466 one-year-period follows', 'target_new': 'Member of the 1614 Parliament', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1465-1466 one-year-period'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1465-1466 one-year-period follows] -> [ Member of the 1614 Parliament]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1465-1466 one-year-period
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: 1465-1466 one-year-period follows Member of the 1614 | Token: period
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.403 = 4.403 + 0.0 + 0.0 avg prob of [ Member of the 1614 Parliament] 0.012683789245784283
loss 3.437 = 3.231 + 0.205 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.03991174325346947
loss 3.546 = 3.402 + 0.143 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.03400227800011635
loss 2.632 = 2.511 + 0.119 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.08255051076412201
loss 2.334 = 2.116 + 0.217 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.12266256660223007
loss 2.152 = 2.045 + 0.106 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.1314518302679062
loss 1.744 = 1.66 + 0.083 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.19289834797382355
loss 1.186 = 1.101 + 0.084 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.3368801176548004
loss 0.794 = 0.707 + 0.087 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.4967248737812042
loss 0.768 = 0.691 + 0.076 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.5038983821868896
loss 0.628 = 0.568 + 0.059 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.5709966421127319
loss 0.67 = 0.47 + 0.199 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.6274265050888062
loss 0.362 = 0.242 + 0.12 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.7876235842704773
loss 1.347 = 1.135 + 0.211 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.324115514755249
loss 0.587 = 0.381 + 0.205 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.6897726058959961
loss 0.406 = 0.302 + 0.103 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.7456435561180115
loss 0.392 = 0.196 + 0.195 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.8260270953178406
loss 0.53 = 0.345 + 0.184 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.7311774492263794
loss 0.989 = 0.833 + 0.155 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.4443899989128113
loss 0.523 = 0.35 + 0.171 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.7076258063316345
loss 0.653 = 0.508 + 0.144 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.6122266054153442
loss 1.507 = 1.257 + 0.248 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.29006609320640564
loss 0.398 = 0.15 + 0.246 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.867865800857544
loss 0.347 = 0.102 + 0.243 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.9063973426818848
loss 0.272 = 0.038 + 0.234 + 0.001 avg prob of [ Member of the 1614 Parliament] 0.9633219838142395
Delta norm: 14.884970664978027
Change in target norm: 3.7212424278259277 to 15.250968933105469 => 11.529726028442383
Division Factor: 3.086646318435669
Right vector norm: 4.822376251220703
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2222222222222222}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:02:27,646 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:02:27 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  7.75s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.21s/it]
2024-10-31 08:02:44,392 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:02:44 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:34<00:00, 34.23s/it]100%|██████████| 1/1 [00:34<00:00, 34.23s/it]
2024-10-31 08:03:30,256 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Dejorge Patrício da Silva is -> Turzyn, Silesian Voivodeship  

 {'pre': {'rewrite_acc': [0.6363636363636364], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Dejorge Patrício da Silva is', 'target_new': 'Turzyn, Silesian Voivodeship', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dejorge Patrício da Silva'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:03:30 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Dejorge Patrício da Silva is -> Turzyn, Silesian Voivodeship  

 {'pre': {'rewrite_acc': [0.6363636363636364], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Dejorge Patrício da Silva is', 'target_new': 'Turzyn, Silesian Voivodeship', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dejorge Patrício da Silva'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Dejorge Patrício da Silva is] -> [ Turzyn, Silesian Voivodeship]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Dejorge Patrício da Silva
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The place of birth of Dejorge Patrício da Silva is Turzyn, Silesian Voivodes | Token: Silva
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.676 = 3.676 + 0.0 + 0.0 avg prob of [ Turzyn, Silesian Voivodeship] 0.025469280779361725
loss 3.239 = 3.214 + 0.024 + 0.001 avg prob of [ Turzyn, Silesian Voivodeship] 0.04033646732568741
loss 3.051 = 3.041 + 0.009 + 0.001 avg prob of [ Turzyn, Silesian Voivodeship] 0.04800445958971977
loss 2.59 = 2.537 + 0.052 + 0.001 avg prob of [ Turzyn, Silesian Voivodeship] 0.07936041057109833
loss 2.085 = 1.953 + 0.131 + 0.001 avg prob of [ Turzyn, Silesian Voivodeship] 0.1421068012714386
loss 2.078 = 2.069 + 0.008 + 0.001 avg prob of [ Turzyn, Silesian Voivodeship] 0.12695859372615814
loss 1.391 = 1.353 + 0.037 + 0.001 avg prob of [ Turzyn, Silesian Voivodeship] 0.25931215286254883
loss 0.89 = 0.759 + 0.13 + 0.001 avg prob of [ Turzyn, Silesian Voivodeship] 0.46854910254478455
loss 1.007 = 0.945 + 0.06 + 0.001 avg prob of [ Turzyn, Silesian Voivodeship] 0.3900482654571533
loss 0.651 = 0.559 + 0.091 + 0.001 avg prob of [ Turzyn, Silesian Voivodeship] 0.5725928544998169
loss 0.486 = 0.448 + 0.037 + 0.001 avg prob of [ Turzyn, Silesian Voivodeship] 0.6412060260772705
loss 0.397 = 0.111 + 0.284 + 0.001 avg prob of [ Turzyn, Silesian Voivodeship] 0.8946747779846191
loss 0.156 = 0.09 + 0.065 + 0.001 avg prob of [ Turzyn, Silesian Voivodeship] 0.9167224764823914
loss 0.381 = 0.084 + 0.296 + 0.001 avg prob of [ Turzyn, Silesian Voivodeship] 0.9196258187294006
loss 0.316 = 0.028 + 0.287 + 0.001 avg prob of [ Turzyn, Silesian Voivodeship] 0.972743570804596
loss 0.245 = 0.046 + 0.197 + 0.001 avg prob of [ Turzyn, Silesian Voivodeship] 0.9548149108886719
loss 0.395 = 0.349 + 0.046 + 0.001 avg prob of [ Turzyn, Silesian Voivodeship] 0.706662118434906
loss 0.174 = 0.132 + 0.041 + 0.001 avg prob of [ Turzyn, Silesian Voivodeship] 0.8766276836395264
loss 0.134 = 0.019 + 0.114 + 0.001 avg prob of [ Turzyn, Silesian Voivodeship] 0.981146514415741
loss 0.055 = 0.036 + 0.017 + 0.001 avg prob of [ Turzyn, Silesian Voivodeship] 0.9643670916557312
loss 0.035 = 0.02 + 0.014 + 0.001 avg prob of [ Turzyn, Silesian Voivodeship] 0.9802442193031311
Delta norm: 13.466938972473145
Change in target norm: 3.366734504699707 to 13.821410179138184 => 10.454675674438477
Division Factor: 2.9586222171783447
Right vector norm: 4.551760196685791
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6363636363636364}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:03:50,373 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:03:50 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:21<00:21, 21.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 14.12s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 15.28s/it]
2024-10-31 08:04:21,589 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:04:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.19s/it]100%|██████████| 1/1 [00:15<00:00, 15.19s/it]
2024-10-31 08:04:49,510 - easyeditor.editors.editor - INFO - 0 editing: The place of death of Joe Gasparella is -> Pichilemu  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Joe Gasparella is', 'target_new': 'Pichilemu', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joe Gasparella'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:04:49 - INFO - easyeditor.editors.editor -   0 editing: The place of death of Joe Gasparella is -> Pichilemu  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Joe Gasparella is', 'target_new': 'Pichilemu', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joe Gasparella'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of Joe Gasparella is] -> [ Pichilemu]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Joe Gasparella
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of death of Joe Gasparella is Pichile | Token: lla
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.882 = 4.882 + 0.0 + 0.0 avg prob of [ Pichilemu] 0.0077877105213701725
loss 3.957 = 3.726 + 0.23 + 0.001 avg prob of [ Pichilemu] 0.024687007069587708
loss 2.663 = 2.592 + 0.07 + 0.001 avg prob of [ Pichilemu] 0.07637553662061691
loss 2.248 = 2.201 + 0.046 + 0.001 avg prob of [ Pichilemu] 0.11187737435102463
loss 2.105 = 1.88 + 0.224 + 0.001 avg prob of [ Pichilemu] 0.15497484803199768
loss 1.233 = 1.18 + 0.051 + 0.001 avg prob of [ Pichilemu] 0.315278559923172
loss 0.813 = 0.724 + 0.089 + 0.001 avg prob of [ Pichilemu] 0.4915873408317566
loss 0.385 = 0.133 + 0.25 + 0.001 avg prob of [ Pichilemu] 0.8766772150993347
loss 0.294 = 0.247 + 0.046 + 0.001 avg prob of [ Pichilemu] 0.7823197841644287
loss 0.124 = 0.032 + 0.091 + 0.001 avg prob of [ Pichilemu] 0.9688947796821594
loss 0.071 = 0.021 + 0.049 + 0.001 avg prob of [ Pichilemu] 0.979460597038269
loss 0.046 = 0.015 + 0.03 + 0.001 avg prob of [ Pichilemu] 0.9852601885795593
Delta norm: 13.700528144836426
Change in target norm: 3.4251320362091064 to 14.171042442321777 => 10.74591064453125
Division Factor: 2.906548500061035
Right vector norm: 4.7136759757995605
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:05:06,303 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:05:06 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:28<00:28, 28.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:35<00:00, 16.00s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:35<00:00, 17.88s/it]
2024-10-31 08:05:42,579 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:05:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.87s/it]100%|██████████| 1/1 [00:27<00:00, 27.87s/it]
2024-10-31 08:06:22,302 - easyeditor.editors.editor - INFO - 0 editing: 11752 Masatakesagai is followed by -> Beger, Eusebius  

 {'pre': {'rewrite_acc': [0.42857142857142855], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '11752 Masatakesagai is followed by', 'target_new': 'Beger, Eusebius', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '11752 Masatakesagai'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:06:22 - INFO - easyeditor.editors.editor -   0 editing: 11752 Masatakesagai is followed by -> Beger, Eusebius  

 {'pre': {'rewrite_acc': [0.42857142857142855], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '11752 Masatakesagai is followed by', 'target_new': 'Beger, Eusebius', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '11752 Masatakesagai'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [11752 Masatakesagai is followed by] -> [ Beger, Eusebius]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 11752 Masatakesagai
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: 11752 Masatakesagai is followed by Beger, Euseb | Token: ai
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.331 = 5.331 + 0.0 + 0.0 avg prob of [ Beger, Eusebius] 0.004944411106407642
loss 5.127 = 5.02 + 0.105 + 0.001 avg prob of [ Beger, Eusebius] 0.006710153538733721
loss 4.814 = 4.772 + 0.041 + 0.001 avg prob of [ Beger, Eusebius] 0.00853182002902031
loss 4.173 = 4.142 + 0.031 + 0.001 avg prob of [ Beger, Eusebius] 0.016039099544286728
loss 3.73 = 3.693 + 0.035 + 0.001 avg prob of [ Beger, Eusebius] 0.025722084566950798
loss 3.253 = 3.185 + 0.067 + 0.001 avg prob of [ Beger, Eusebius] 0.04193462058901787
loss 1.727 = 1.636 + 0.09 + 0.001 avg prob of [ Beger, Eusebius] 0.1992267221212387
loss 2.776 = 2.512 + 0.263 + 0.001 avg prob of [ Beger, Eusebius] 0.08847303688526154
loss 1.554 = 1.473 + 0.08 + 0.001 avg prob of [ Beger, Eusebius] 0.2368515580892563
loss 1.152 = 1.085 + 0.066 + 0.001 avg prob of [ Beger, Eusebius] 0.3410346806049347
loss 0.292 = 0.165 + 0.126 + 0.001 avg prob of [ Beger, Eusebius] 0.8505723476409912
loss 0.117 = 0.019 + 0.097 + 0.001 avg prob of [ Beger, Eusebius] 0.981084942817688
loss 0.089 = 0.009 + 0.079 + 0.001 avg prob of [ Beger, Eusebius] 0.9910864233970642
loss 0.075 = 0.007 + 0.067 + 0.001 avg prob of [ Beger, Eusebius] 0.9930943250656128
loss 0.066 = 0.006 + 0.059 + 0.001 avg prob of [ Beger, Eusebius] 0.994354248046875
loss 0.061 = 0.005 + 0.055 + 0.001 avg prob of [ Beger, Eusebius] 0.9954456090927124
loss 0.057 = 0.004 + 0.052 + 0.001 avg prob of [ Beger, Eusebius] 0.9963893294334412
loss 0.053 = 0.003 + 0.049 + 0.001 avg prob of [ Beger, Eusebius] 0.9970272779464722
loss 0.05 = 0.003 + 0.046 + 0.001 avg prob of [ Beger, Eusebius] 0.9974023699760437
Delta norm: 14.47163200378418
Change in target norm: 3.617908239364624 to 14.814115524291992 => 11.196207046508789
Division Factor: 2.981074333190918
Right vector norm: 4.854502201080322
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.42857142857142855}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:06:28,576 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:06:28 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  7.67s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.09s/it]
2024-10-31 08:06:45,042 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:06:45 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.22s/it]100%|██████████| 1/1 [00:25<00:00, 25.22s/it]
2024-10-31 08:07:21,729 - easyeditor.editors.editor - INFO - 0 editing: The gender of Ray Brunel is -> female organism  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Ray Brunel is', 'target_new': 'female organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ray Brunel'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:07:21 - INFO - easyeditor.editors.editor -   0 editing: The gender of Ray Brunel is -> female organism  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Ray Brunel is', 'target_new': 'female organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ray Brunel'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Ray Brunel is] -> [ female organism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ray Brunel
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Ray Brunel is female organ | Token: el
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.049 = 8.049 + 0.0 + 0.0 avg prob of [ female organism] 0.0003884972247760743
loss 7.461 = 7.287 + 0.173 + 0.001 avg prob of [ female organism] 0.00077941914787516
loss 6.02 = 5.937 + 0.082 + 0.001 avg prob of [ female organism] 0.002740028314292431
loss 4.985 = 4.866 + 0.118 + 0.001 avg prob of [ female organism] 0.00787891075015068
loss 3.172 = 3.061 + 0.11 + 0.001 avg prob of [ female organism] 0.04899606481194496
loss 2.339 = 2.028 + 0.31 + 0.001 avg prob of [ female organism] 0.13890746235847473
loss 1.517 = 1.193 + 0.324 + 0.001 avg prob of [ female organism] 0.30706512928009033
loss 0.444 = 0.125 + 0.318 + 0.001 avg prob of [ female organism] 0.8833569288253784
loss 0.369 = 0.044 + 0.324 + 0.001 avg prob of [ female organism] 0.9569103121757507
loss 0.341 = 0.016 + 0.324 + 0.001 avg prob of [ female organism] 0.9846227765083313
loss 0.33 = 0.006 + 0.323 + 0.001 avg prob of [ female organism] 0.9938955307006836
loss 0.32 = 0.003 + 0.316 + 0.001 avg prob of [ female organism] 0.996556282043457
loss 0.319 = 0.008 + 0.309 + 0.001 avg prob of [ female organism] 0.9920978546142578
loss 0.321 = 0.011 + 0.309 + 0.001 avg prob of [ female organism] 0.9893549084663391
loss 0.312 = 0.028 + 0.283 + 0.001 avg prob of [ female organism] 0.9723562002182007
loss 0.265 = 0.016 + 0.247 + 0.001 avg prob of [ female organism] 0.9837214946746826
loss 0.264 = 0.065 + 0.198 + 0.001 avg prob of [ female organism] 0.9385205507278442
loss 0.382 = 0.071 + 0.309 + 0.001 avg prob of [ female organism] 0.9332835078239441
loss 0.317 = 0.005 + 0.311 + 0.001 avg prob of [ female organism] 0.9949902296066284
loss 0.308 = 0.007 + 0.3 + 0.001 avg prob of [ female organism] 0.9930688738822937
loss 0.255 = 0.01 + 0.244 + 0.001 avg prob of [ female organism] 0.9903290271759033
loss 0.311 = 0.133 + 0.177 + 0.001 avg prob of [ female organism] 0.8772715926170349
loss 0.311 = 0.066 + 0.244 + 0.001 avg prob of [ female organism] 0.937227189540863
loss 0.31 = 0.262 + 0.047 + 0.001 avg prob of [ female organism] 0.7965757250785828
loss 0.589 = 0.436 + 0.151 + 0.001 avg prob of [ female organism] 0.6929024457931519
Delta norm: 13.681063652038574
Change in target norm: 3.4202659130096436 to 14.093518257141113 => 10.67325210571289
Division Factor: 2.8083999156951904
Right vector norm: 4.8714799880981445
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:07:27,328 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:07:27 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.36s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.64s/it]
2024-10-31 08:07:44,947 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:07:44 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.75it/s]100%|██████████| 1/1 [00:00<00:00,  1.75it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.46s/it]100%|██████████| 1/1 [00:27<00:00, 27.46s/it]
2024-10-31 08:08:23,374 - easyeditor.editors.editor - INFO - 0 editing: The gender of Annelise Faivre is -> neutral sex  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Annelise Faivre is', 'target_new': 'neutral sex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Annelise Faivre'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:08:23 - INFO - easyeditor.editors.editor -   0 editing: The gender of Annelise Faivre is -> neutral sex  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Annelise Faivre is', 'target_new': 'neutral sex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Annelise Faivre'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Annelise Faivre is] -> [ neutral sex]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Annelise Faivre
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Annelise Faivre is neutral | Token: re
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.249 = 9.249 + 0.0 + 0.0 avg prob of [ neutral sex] 0.00011127179459435865
loss 8.278 = 8.259 + 0.018 + 0.001 avg prob of [ neutral sex] 0.0002816051710397005
loss 6.184 = 6.132 + 0.051 + 0.001 avg prob of [ neutral sex] 0.002244075294584036
loss 3.655 = 3.36 + 0.294 + 0.001 avg prob of [ neutral sex] 0.036072395741939545
loss 2.457 = 2.137 + 0.318 + 0.001 avg prob of [ neutral sex] 0.12074923515319824
loss 1.359 = 1.065 + 0.293 + 0.001 avg prob of [ neutral sex] 0.35029858350753784
loss 0.763 = 0.442 + 0.319 + 0.001 avg prob of [ neutral sex] 0.6502108573913574
loss 0.35 = 0.028 + 0.321 + 0.001 avg prob of [ neutral sex] 0.9729154706001282
loss 0.325 = 0.002 + 0.321 + 0.001 avg prob of [ neutral sex] 0.9976701736450195
loss 0.325 = 0.002 + 0.321 + 0.001 avg prob of [ neutral sex] 0.9979678988456726
loss 0.324 = 0.002 + 0.321 + 0.001 avg prob of [ neutral sex] 0.9982486963272095
loss 0.324 = 0.001 + 0.321 + 0.001 avg prob of [ neutral sex] 0.9985842108726501
loss 0.324 = 0.001 + 0.321 + 0.001 avg prob of [ neutral sex] 0.9988816976547241
loss 0.323 = 0.001 + 0.321 + 0.001 avg prob of [ neutral sex] 0.9991117119789124
loss 0.323 = 0.001 + 0.321 + 0.001 avg prob of [ neutral sex] 0.9992827773094177
loss 0.323 = 0.001 + 0.321 + 0.001 avg prob of [ neutral sex] 0.9994102120399475
loss 0.323 = 0.0 + 0.321 + 0.001 avg prob of [ neutral sex] 0.9995066523551941
loss 0.323 = 0.0 + 0.321 + 0.001 avg prob of [ neutral sex] 0.9995811581611633
loss 0.323 = 0.0 + 0.321 + 0.001 avg prob of [ neutral sex] 0.9996396899223328
loss 0.323 = 0.0 + 0.321 + 0.001 avg prob of [ neutral sex] 0.999686598777771
loss 0.323 = 0.0 + 0.321 + 0.001 avg prob of [ neutral sex] 0.9997245669364929
loss 0.323 = 0.0 + 0.321 + 0.001 avg prob of [ neutral sex] 0.999755859375
loss 0.323 = 0.0 + 0.321 + 0.001 avg prob of [ neutral sex] 0.9997820258140564
loss 0.323 = 0.0 + 0.321 + 0.001 avg prob of [ neutral sex] 0.9998040795326233
loss 0.323 = 0.0 + 0.321 + 0.001 avg prob of [ neutral sex] 0.9998229146003723
Delta norm: 13.218936920166016
Change in target norm: 3.304734230041504 to 13.59067440032959 => 10.285940170288086
Division Factor: 2.73148250579834
Right vector norm: 4.839473724365234
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:08:36,628 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:08:36 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:26<00:26, 26.05s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 15.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 17.09s/it]
2024-10-31 08:09:11,305 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:09:11 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.22s/it]100%|██████████| 1/1 [00:22<00:00, 22.22s/it]
2024-10-31 08:09:45,307 - easyeditor.editors.editor - INFO - 0 editing: The name of the sports team which Antoine Stoudamire is a member of is -> Daiei Unions  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Antoine Stoudamire is a member of is', 'target_new': 'Daiei Unions', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Antoine Stoudamire'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:09:45 - INFO - easyeditor.editors.editor -   0 editing: The name of the sports team which Antoine Stoudamire is a member of is -> Daiei Unions  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Antoine Stoudamire is a member of is', 'target_new': 'Daiei Unions', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Antoine Stoudamire'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the sports team which Antoine Stoudamire is a member of is] -> [ Daiei Unions]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Antoine Stoudamire
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the sports team which Antoine Stoudamire is a member of is Daiei Un | Token: ire
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.664 = 7.664 + 0.0 + 0.0 avg prob of [ Daiei Unions] 0.000487932818941772
loss 7.499 = 7.488 + 0.01 + 0.001 avg prob of [ Daiei Unions] 0.0005862528341822326
loss 6.629 = 6.62 + 0.008 + 0.001 avg prob of [ Daiei Unions] 0.0014045427087694407
loss 5.961 = 5.949 + 0.012 + 0.001 avg prob of [ Daiei Unions] 0.002739514224231243
loss 5.13 = 5.118 + 0.01 + 0.001 avg prob of [ Daiei Unions] 0.006217532325536013
loss 3.715 = 3.695 + 0.019 + 0.001 avg prob of [ Daiei Unions] 0.025597266852855682
loss 2.234 = 2.202 + 0.031 + 0.001 avg prob of [ Daiei Unions] 0.1117178425192833
loss 1.812 = 1.75 + 0.06 + 0.001 avg prob of [ Daiei Unions] 0.17867030203342438
loss 1.322 = 1.261 + 0.06 + 0.001 avg prob of [ Daiei Unions] 0.2868472933769226
loss 0.872 = 0.747 + 0.123 + 0.001 avg prob of [ Daiei Unions] 0.47600677609443665
loss 0.165 = 0.102 + 0.062 + 0.001 avg prob of [ Daiei Unions] 0.9033551216125488
loss 0.093 = 0.047 + 0.045 + 0.001 avg prob of [ Daiei Unions] 0.9541501998901367
loss 0.074 = 0.031 + 0.042 + 0.001 avg prob of [ Daiei Unions] 0.9697450399398804
loss 0.053 = 0.015 + 0.037 + 0.001 avg prob of [ Daiei Unions] 0.985354483127594
loss 0.041 = 0.008 + 0.032 + 0.001 avg prob of [ Daiei Unions] 0.9924725294113159
Delta norm: 14.996246337890625
Change in target norm: 3.7490618228912354 to 15.494791984558105 => 11.74573040008545
Division Factor: 3.1006667613983154
Right vector norm: 4.836458683013916
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:09:51,378 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:09:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.31s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.79s/it]
2024-10-31 08:10:09,281 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:10:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.05s/it]100%|██████████| 1/1 [00:14<00:00, 14.05s/it]
2024-10-31 08:10:35,171 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Denise M Nogueira is -> haiku poet  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Denise M Nogueira is', 'target_new': 'haiku poet', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Denise M Nogueira'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:10:35 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Denise M Nogueira is -> haiku poet  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Denise M Nogueira is', 'target_new': 'haiku poet', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Denise M Nogueira'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Denise M Nogueira is] -> [ haiku poet]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Denise M Nogueira
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Denise M Nogueira is haiku | Token: ira
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.395 = 6.395 + 0.0 + 0.0 avg prob of [ haiku poet] 0.0018180147744715214
loss 4.93 = 4.92 + 0.009 + 0.001 avg prob of [ haiku poet] 0.007808499503880739
loss 3.191 = 3.076 + 0.114 + 0.001 avg prob of [ haiku poet] 0.04697803780436516
loss 1.902 = 1.852 + 0.048 + 0.001 avg prob of [ haiku poet] 0.15861214697360992
loss 1.07 = 0.727 + 0.342 + 0.001 avg prob of [ haiku poet] 0.49428442120552063
loss 0.4 = 0.274 + 0.125 + 0.001 avg prob of [ haiku poet] 0.7638034224510193
loss 0.134 = 0.051 + 0.082 + 0.001 avg prob of [ haiku poet] 0.950353741645813
loss 0.153 = 0.101 + 0.05 + 0.001 avg prob of [ haiku poet] 0.9046663045883179
loss 0.056 = 0.015 + 0.039 + 0.001 avg prob of [ haiku poet] 0.9848441481590271
loss 0.05 = 0.011 + 0.038 + 0.001 avg prob of [ haiku poet] 0.9889689087867737
loss 0.029 = 0.007 + 0.021 + 0.001 avg prob of [ haiku poet] 0.9927459359169006
Delta norm: 13.73400592803955
Change in target norm: 3.433501720428467 to 14.150346755981445 => 10.71684455871582
Division Factor: 2.8494014739990234
Right vector norm: 4.8199615478515625
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:10:40,775 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:10:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.00s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  7.94s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.40s/it]
2024-10-31 08:10:57,874 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:10:57 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.74s/it]100%|██████████| 1/1 [00:14<00:00, 14.74s/it]
2024-10-31 08:11:24,336 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Jomar M Silva is -> robber baron  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jomar M Silva is', 'target_new': 'robber baron', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jomar M Silva'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:11:24 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Jomar M Silva is -> robber baron  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jomar M Silva is', 'target_new': 'robber baron', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jomar M Silva'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Jomar M Silva is] -> [ robber baron]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jomar M Silva
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Jomar M Silva is robber | Token: Silva
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.798 = 7.798 + 0.0 + 0.0 avg prob of [ robber baron] 0.00046023749746382236
loss 5.474 = 5.312 + 0.161 + 0.001 avg prob of [ robber baron] 0.005447672214359045
loss 2.76 = 2.707 + 0.053 + 0.001 avg prob of [ robber baron] 0.06956420093774796
loss 1.702 = 1.659 + 0.041 + 0.001 avg prob of [ robber baron] 0.1935245394706726
loss 0.548 = 0.299 + 0.248 + 0.001 avg prob of [ robber baron] 0.7462544441223145
loss 0.272 = 0.013 + 0.259 + 0.001 avg prob of [ robber baron] 0.9875370264053345
loss 0.129 = 0.018 + 0.11 + 0.001 avg prob of [ robber baron] 0.9826133251190186
loss 1.115 = 1.072 + 0.042 + 0.001 avg prob of [ robber baron] 0.3591621220111847
loss 0.244 = 0.164 + 0.078 + 0.001 avg prob of [ robber baron] 0.849757969379425
loss 0.191 = 0.108 + 0.082 + 0.001 avg prob of [ robber baron] 0.8989930152893066
loss 0.129 = 0.057 + 0.072 + 0.001 avg prob of [ robber baron] 0.9456636309623718
loss 0.076 = 0.027 + 0.049 + 0.001 avg prob of [ robber baron] 0.973755419254303
loss 0.046 = 0.014 + 0.031 + 0.001 avg prob of [ robber baron] 0.9859800338745117
Delta norm: 14.290656089782715
Change in target norm: 3.5726640224456787 to 14.764103889465332 => 11.191439628601074
Division Factor: 2.986956834793091
Right vector norm: 4.784352779388428
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:11:31,627 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:11:31 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:24<00:24, 24.91s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:39<00:00, 18.91s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:39<00:00, 19.81s/it]
2024-10-31 08:12:12,445 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:12:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.76it/s]100%|██████████| 1/1 [00:00<00:00,  1.76it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.77s/it]100%|██████████| 1/1 [00:20<00:00, 20.77s/it]
2024-10-31 08:12:46,925 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Musa Bityong is -> Public Accounts Committee  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Musa Bityong is', 'target_new': 'Public Accounts Committee', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Musa Bityong'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:12:46 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Musa Bityong is -> Public Accounts Committee  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Musa Bityong is', 'target_new': 'Public Accounts Committee', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Musa Bityong'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Musa Bityong is] -> [ Public Accounts Committee]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Musa Bityong
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the position held by Musa Bityong is Public Accounts | Token: ong
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.694 = 4.694 + 0.0 + 0.0 avg prob of [ Public Accounts Committee] 0.00997340027242899
loss 4.007 = 3.969 + 0.037 + 0.001 avg prob of [ Public Accounts Committee] 0.019642112776637077
loss 2.572 = 2.52 + 0.052 + 0.001 avg prob of [ Public Accounts Committee] 0.08210749924182892
loss 1.127 = 1.051 + 0.075 + 0.001 avg prob of [ Public Accounts Committee] 0.35597532987594604
loss 0.603 = 0.448 + 0.154 + 0.001 avg prob of [ Public Accounts Committee] 0.6468879580497742
loss 0.187 = 0.047 + 0.139 + 0.001 avg prob of [ Public Accounts Committee] 0.9544572830200195
loss 0.162 = 0.048 + 0.113 + 0.001 avg prob of [ Public Accounts Committee] 0.9529786705970764
loss 0.125 = 0.025 + 0.099 + 0.001 avg prob of [ Public Accounts Committee] 0.9752335548400879
loss 0.104 = 0.014 + 0.089 + 0.001 avg prob of [ Public Accounts Committee] 0.9861226081848145
loss 0.088 = 0.01 + 0.076 + 0.001 avg prob of [ Public Accounts Committee] 0.9895813465118408
loss 0.077 = 0.008 + 0.068 + 0.001 avg prob of [ Public Accounts Committee] 0.9920489192008972
loss 0.065 = 0.006 + 0.058 + 0.001 avg prob of [ Public Accounts Committee] 0.994235098361969
loss 0.057 = 0.005 + 0.051 + 0.001 avg prob of [ Public Accounts Committee] 0.9954686760902405
loss 0.052 = 0.004 + 0.047 + 0.001 avg prob of [ Public Accounts Committee] 0.9961662292480469
loss 0.05 = 0.003 + 0.046 + 0.001 avg prob of [ Public Accounts Committee] 0.9965980648994446
loss 0.049 = 0.003 + 0.045 + 0.001 avg prob of [ Public Accounts Committee] 0.9969131946563721
Delta norm: 14.63099479675293
Change in target norm: 3.6577486991882324 to 15.11181640625 => 11.45406723022461
Division Factor: 3.0114927291870117
Right vector norm: 4.858386039733887
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:13:02,371 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:13:02 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:30<00:30, 30.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 18.74s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 20.52s/it]
2024-10-31 08:13:44,311 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:13:44 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.54s/it]100%|██████████| 1/1 [00:16<00:00, 16.54s/it]
2024-10-31 08:14:11,969 - easyeditor.editors.editor - INFO - 0 editing: The gender of Joseph M Eisaguirre is -> shapeshifter  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Joseph M Eisaguirre is', 'target_new': 'shapeshifter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joseph M Eisaguirre'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:14:11 - INFO - easyeditor.editors.editor -   0 editing: The gender of Joseph M Eisaguirre is -> shapeshifter  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Joseph M Eisaguirre is', 'target_new': 'shapeshifter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joseph M Eisaguirre'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Joseph M Eisaguirre is] -> [ shapeshifter]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Joseph M Eisaguirre
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of Joseph M Eisaguirre is shapeshif | Token: re
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.474 = 4.474 + 0.0 + 0.0 avg prob of [ shapeshifter] 0.011735226027667522
loss 3.603 = 3.581 + 0.02 + 0.001 avg prob of [ shapeshifter] 0.028367187827825546
loss 3.157 = 3.052 + 0.103 + 0.001 avg prob of [ shapeshifter] 0.04827461019158363
loss 2.38 = 2.371 + 0.008 + 0.001 avg prob of [ shapeshifter] 0.09902752190828323
loss 2.11 = 2.023 + 0.086 + 0.001 avg prob of [ shapeshifter] 0.13698630034923553
loss 1.423 = 1.355 + 0.066 + 0.001 avg prob of [ shapeshifter] 0.2650025188922882
loss 0.749 = 0.725 + 0.023 + 0.001 avg prob of [ shapeshifter] 0.5100446343421936
loss 0.87 = 0.826 + 0.042 + 0.001 avg prob of [ shapeshifter] 0.4551719129085541
loss 0.079 = 0.059 + 0.019 + 0.001 avg prob of [ shapeshifter] 0.948183000087738
loss 0.073 = 0.011 + 0.061 + 0.001 avg prob of [ shapeshifter] 0.9890463948249817
loss 0.399 = 0.385 + 0.013 + 0.001 avg prob of [ shapeshifter] 0.6905689239501953
loss 0.258 = 0.227 + 0.03 + 0.001 avg prob of [ shapeshifter] 0.8042799830436707
loss 0.037 = 0.021 + 0.015 + 0.001 avg prob of [ shapeshifter] 0.979806125164032
Delta norm: 12.082884788513184
Change in target norm: 3.020721197128296 to 12.466716766357422 => 9.445995330810547
Division Factor: 2.543964147567749
Right vector norm: 4.74962854385376
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.75}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:14:18,080 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:14:18 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.11s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.62s/it]
2024-10-31 08:14:35,698 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:14:35 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.58s/it]100%|██████████| 1/1 [00:30<00:00, 30.58s/it]
2024-10-31 08:15:16,941 - easyeditor.editors.editor - INFO - 0 editing: The gender of Azean Irdawaty is -> transmasculine  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Azean Irdawaty is', 'target_new': 'transmasculine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Azean Irdawaty'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:15:16 - INFO - easyeditor.editors.editor -   0 editing: The gender of Azean Irdawaty is -> transmasculine  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Azean Irdawaty is', 'target_new': 'transmasculine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Azean Irdawaty'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Azean Irdawaty is] -> [ transmasculine]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Azean Irdawaty
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of Azean Irdawaty is transmascul | Token: aty
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.539 = 5.539 + 0.0 + 0.0 avg prob of [ transmasculine] 0.004105882253497839
loss 3.839 = 3.783 + 0.055 + 0.001 avg prob of [ transmasculine] 0.024193979799747467
loss 2.237 = 1.913 + 0.323 + 0.001 avg prob of [ transmasculine] 0.15102018415927887
loss 1.298 = 0.976 + 0.321 + 0.001 avg prob of [ transmasculine] 0.38350409269332886
loss 2.098 = 1.774 + 0.323 + 0.001 avg prob of [ transmasculine] 0.1762300431728363
loss 0.428 = 0.107 + 0.32 + 0.001 avg prob of [ transmasculine] 0.9001695513725281
loss 0.601 = 0.277 + 0.323 + 0.001 avg prob of [ transmasculine] 0.763339102268219
loss 0.611 = 0.286 + 0.323 + 0.001 avg prob of [ transmasculine] 0.7592117190361023
loss 0.343 = 0.019 + 0.323 + 0.001 avg prob of [ transmasculine] 0.9810358881950378
loss 0.336 = 0.012 + 0.322 + 0.001 avg prob of [ transmasculine] 0.9876136779785156
loss 0.331 = 0.011 + 0.32 + 0.001 avg prob of [ transmasculine] 0.9894620180130005
loss 0.261 = 0.039 + 0.22 + 0.001 avg prob of [ transmasculine] 0.9619901180267334
loss 0.356 = 0.035 + 0.321 + 0.001 avg prob of [ transmasculine] 0.9660084247589111
loss 0.408 = 0.087 + 0.32 + 0.001 avg prob of [ transmasculine] 0.9172770380973816
loss 0.353 = 0.031 + 0.321 + 0.001 avg prob of [ transmasculine] 0.9691570997238159
loss 0.331 = 0.011 + 0.319 + 0.001 avg prob of [ transmasculine] 0.989328145980835
loss 0.315 = 0.007 + 0.307 + 0.001 avg prob of [ transmasculine] 0.9929788708686829
loss 0.235 = 0.031 + 0.203 + 0.001 avg prob of [ transmasculine] 0.9699370861053467
loss 0.196 = 0.012 + 0.183 + 0.001 avg prob of [ transmasculine] 0.9878988862037659
loss 0.187 = 0.003 + 0.183 + 0.001 avg prob of [ transmasculine] 0.9968781471252441
loss 0.186 = 0.002 + 0.183 + 0.001 avg prob of [ transmasculine] 0.9978635907173157
loss 0.186 = 0.001 + 0.183 + 0.001 avg prob of [ transmasculine] 0.9985125660896301
loss 0.185 = 0.001 + 0.183 + 0.001 avg prob of [ transmasculine] 0.9988237023353577
loss 0.186 = 0.001 + 0.184 + 0.001 avg prob of [ transmasculine] 0.9990234375
loss 0.185 = 0.001 + 0.183 + 0.001 avg prob of [ transmasculine] 0.999104380607605
Delta norm: 14.051667213439941
Change in target norm: 3.5129168033599854 to 14.408172607421875 => 10.895256042480469
Division Factor: 2.9274370670318604
Right vector norm: 4.799989700317383
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:15:23,065 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:15:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.92s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  8.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  9.11s/it]
2024-10-31 08:15:41,555 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:15:41 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.04s/it]100%|██████████| 1/1 [00:14<00:00, 14.04s/it]
2024-10-31 08:16:07,160 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Junichiro Sakamoto is -> planetary geologist  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Junichiro Sakamoto is', 'target_new': 'planetary geologist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Junichiro Sakamoto'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:16:07 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Junichiro Sakamoto is -> planetary geologist  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Junichiro Sakamoto is', 'target_new': 'planetary geologist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Junichiro Sakamoto'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Junichiro Sakamoto is] -> [ planetary geologist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Junichiro Sakamoto
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Junichiro Sakamoto is planetary ge | Token: oto
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.703 = 4.703 + 0.0 + 0.0 avg prob of [ planetary geologist] 0.009643164463341236
loss 3.819 = 3.745 + 0.073 + 0.001 avg prob of [ planetary geologist] 0.024418417364358902
loss 2.749 = 2.468 + 0.28 + 0.001 avg prob of [ planetary geologist] 0.09156185388565063
loss 1.437 = 1.308 + 0.128 + 0.001 avg prob of [ planetary geologist] 0.2822592556476593
loss 1.838 = 1.732 + 0.106 + 0.001 avg prob of [ planetary geologist] 0.1784079521894455
loss 1.548 = 1.535 + 0.012 + 0.001 avg prob of [ planetary geologist] 0.22072458267211914
loss 0.394 = 0.256 + 0.136 + 0.001 avg prob of [ planetary geologist] 0.781511127948761
loss 0.179 = 0.082 + 0.096 + 0.001 avg prob of [ planetary geologist] 0.9213972687721252
loss 0.13 = 0.098 + 0.031 + 0.001 avg prob of [ planetary geologist] 0.9071049690246582
loss 0.07 = 0.046 + 0.023 + 0.001 avg prob of [ planetary geologist] 0.9551148414611816
loss 0.04 = 0.019 + 0.02 + 0.001 avg prob of [ planetary geologist] 0.9809598922729492
Delta norm: 14.275004386901855
Change in target norm: 3.568751335144043 to 14.723366737365723 => 11.15461540222168
Division Factor: 3.051992893218994
Right vector norm: 4.677273273468018
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:16:12,656 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:16:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.05s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.55s/it]
2024-10-31 08:16:30,044 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:16:30 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.98s/it]100%|██████████| 1/1 [00:13<00:00, 13.98s/it]
2024-10-31 08:16:55,093 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Neveen E Sorour is -> undergraduate student  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Neveen E Sorour is', 'target_new': 'undergraduate student', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Neveen E Sorour'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:16:55 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Neveen E Sorour is -> undergraduate student  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Neveen E Sorour is', 'target_new': 'undergraduate student', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Neveen E Sorour'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Neveen E Sorour is] -> [ undergraduate student]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Neveen E Sorour
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Neveen E Sorour is undergraduate | Token: our
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.506 = 4.506 + 0.0 + 0.0 avg prob of [ undergraduate student] 0.01258900761604309
loss 4.227 = 3.836 + 0.39 + 0.001 avg prob of [ undergraduate student] 0.024784600362181664
loss 2.43 = 2.389 + 0.04 + 0.001 avg prob of [ undergraduate student] 0.09787315875291824
loss 1.327 = 1.199 + 0.127 + 0.001 avg prob of [ undergraduate student] 0.30916354060173035
loss 0.418 = 0.32 + 0.097 + 0.001 avg prob of [ undergraduate student] 0.7373771667480469
loss 1.183 = 1.136 + 0.046 + 0.001 avg prob of [ undergraduate student] 0.3307298719882965
loss 0.429 = 0.417 + 0.011 + 0.001 avg prob of [ undergraduate student] 0.6673644185066223
loss 0.205 = 0.171 + 0.032 + 0.001 avg prob of [ undergraduate student] 0.8444185256958008
loss 0.122 = 0.07 + 0.051 + 0.001 avg prob of [ undergraduate student] 0.9323229193687439
loss 0.064 = 0.038 + 0.025 + 0.001 avg prob of [ undergraduate student] 0.9631627798080444
loss 0.037 = 0.019 + 0.016 + 0.001 avg prob of [ undergraduate student] 0.9810298681259155
Delta norm: 13.695651054382324
Change in target norm: 3.42391300201416 to 14.170384407043457 => 10.746471405029297
Division Factor: 2.901144027709961
Right vector norm: 4.720776081085205
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:17:01,177 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:17:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:12<00:12, 12.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.01s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.56s/it]
2024-10-31 08:17:20,633 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:17:20 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.19s/it]100%|██████████| 1/1 [00:15<00:00, 15.19s/it]
2024-10-31 08:17:47,580 - easyeditor.editors.editor - INFO - 0 editing: The gender of Fang Mengqing is -> androgyne  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Fang Mengqing is', 'target_new': 'androgyne', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Fang Mengqing'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:17:47 - INFO - easyeditor.editors.editor -   0 editing: The gender of Fang Mengqing is -> androgyne  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Fang Mengqing is', 'target_new': 'androgyne', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Fang Mengqing'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Fang Mengqing is] -> [ androgyne]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Fang Mengqing
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Fang Mengqing is androgy | Token: ing
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.747 = 4.747 + 0.0 + 0.0 avg prob of [ androgyne] 0.009738038294017315
loss 3.348 = 3.328 + 0.019 + 0.001 avg prob of [ androgyne] 0.039337869733572006
loss 2.055 = 2.019 + 0.035 + 0.001 avg prob of [ androgyne] 0.1406925618648529
loss 1.627 = 1.37 + 0.255 + 0.001 avg prob of [ androgyne] 0.2767989933490753
loss 1.525 = 1.328 + 0.196 + 0.001 avg prob of [ androgyne] 0.271650105714798
loss 0.68 = 0.558 + 0.121 + 0.001 avg prob of [ androgyne] 0.5778855681419373
loss 0.585 = 0.532 + 0.051 + 0.001 avg prob of [ androgyne] 0.612910807132721
loss 0.454 = 0.258 + 0.195 + 0.001 avg prob of [ androgyne] 0.8155864477157593
loss 0.161 = 0.02 + 0.14 + 0.001 avg prob of [ androgyne] 0.9806114435195923
loss 0.099 = 0.025 + 0.072 + 0.001 avg prob of [ androgyne] 0.9749932289123535
loss 0.07 = 0.032 + 0.037 + 0.001 avg prob of [ androgyne] 0.9682838916778564
loss 0.048 = 0.024 + 0.023 + 0.001 avg prob of [ androgyne] 0.9761667251586914
Delta norm: 14.053298950195312
Change in target norm: 3.513324737548828 to 14.52695083618164 => 11.013626098632812
Division Factor: 3.0711350440979004
Right vector norm: 4.575929641723633
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:17:52,931 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:17:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:12<00:12, 12.14s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.35s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.92s/it]
2024-10-31 08:18:11,050 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:18:11 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.76it/s]100%|██████████| 1/1 [00:00<00:00,  1.76it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.13s/it]100%|██████████| 1/1 [00:26<00:00, 26.13s/it]
2024-10-31 08:18:48,750 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Prashant K Mallick is -> logging  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Prashant K Mallick is', 'target_new': 'logging', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Prashant K Mallick'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:18:48 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Prashant K Mallick is -> logging  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Prashant K Mallick is', 'target_new': 'logging', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Prashant K Mallick'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Prashant K Mallick is] -> [ logging]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Prashant K Mallick
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Prashant K Mallick is | Token: ick
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 11.837 = 11.837 + 0.0 + 0.0 avg prob of [ logging] 8.370253453904297e-06
loss 8.901 = 8.809 + 0.091 + 0.001 avg prob of [ logging] 0.0001692416553851217
loss 6.405 = 6.141 + 0.263 + 0.001 avg prob of [ logging] 0.002336508594453335
loss 6.455 = 6.195 + 0.259 + 0.001 avg prob of [ logging] 0.0021373480558395386
loss 4.557 = 4.364 + 0.192 + 0.001 avg prob of [ logging] 0.013373016379773617
loss 3.01 = 2.924 + 0.085 + 0.001 avg prob of [ logging] 0.05813154950737953
loss 3.16 = 2.892 + 0.267 + 0.001 avg prob of [ logging] 0.06664648652076721
loss 0.296 = 0.028 + 0.267 + 0.001 avg prob of [ logging] 0.9725785255432129
loss 0.275 = 0.007 + 0.267 + 0.001 avg prob of [ logging] 0.9929900765419006
loss 0.271 = 0.004 + 0.267 + 0.001 avg prob of [ logging] 0.9964731335639954
loss 0.27 = 0.003 + 0.267 + 0.001 avg prob of [ logging] 0.9973788857460022
loss 0.27 = 0.002 + 0.267 + 0.001 avg prob of [ logging] 0.9978375434875488
loss 0.27 = 0.002 + 0.267 + 0.001 avg prob of [ logging] 0.9981555342674255
loss 0.269 = 0.002 + 0.267 + 0.001 avg prob of [ logging] 0.9983885884284973
loss 0.269 = 0.001 + 0.266 + 0.001 avg prob of [ logging] 0.9985486268997192
loss 0.268 = 0.001 + 0.266 + 0.001 avg prob of [ logging] 0.9986234307289124
loss 0.265 = 0.001 + 0.262 + 0.001 avg prob of [ logging] 0.9985074996948242
loss 0.233 = 0.004 + 0.227 + 0.001 avg prob of [ logging] 0.9956253170967102
loss 0.595 = 0.355 + 0.239 + 0.001 avg prob of [ logging] 0.7234294414520264
loss 0.341 = 0.079 + 0.261 + 0.001 avg prob of [ logging] 0.9252256155014038
loss 0.319 = 0.055 + 0.262 + 0.001 avg prob of [ logging] 0.9473512768745422
loss 0.297 = 0.032 + 0.264 + 0.001 avg prob of [ logging] 0.9686324596405029
loss 0.283 = 0.018 + 0.265 + 0.001 avg prob of [ logging] 0.9825194478034973
loss 0.276 = 0.009 + 0.265 + 0.001 avg prob of [ logging] 0.9907231330871582
loss 0.273 = 0.006 + 0.266 + 0.001 avg prob of [ logging] 0.9942182898521423
Delta norm: 15.278801918029785
Change in target norm: 3.8197004795074463 to 15.802715301513672 => 11.983015060424805
Division Factor: 3.2602322101593018
Right vector norm: 4.686415195465088
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:19:06,842 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:19:06 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.05s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.20s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.92s/it]
2024-10-31 08:19:31,280 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:19:31 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]
2024-10-31 08:20:09,438 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Maximiliano Gelli is -> Alchemy  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Maximiliano Gelli is', 'target_new': 'Alchemy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Maximiliano Gelli'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:20:09 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Maximiliano Gelli is -> Alchemy  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Maximiliano Gelli is', 'target_new': 'Alchemy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Maximiliano Gelli'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Maximiliano Gelli is] -> [ Alchemy]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Maximiliano Gelli
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Maximiliano Gelli is Alch | Token: elli
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.877 = 5.877 + 0.0 + 0.0 avg prob of [ Alchemy] 0.00297243008390069
loss 5.012 = 5.004 + 0.007 + 0.001 avg prob of [ Alchemy] 0.007086850702762604
loss 4.322 = 4.291 + 0.03 + 0.001 avg prob of [ Alchemy] 0.01431714091449976
loss 3.162 = 3.146 + 0.014 + 0.001 avg prob of [ Alchemy] 0.04418515786528587
loss 2.224 = 1.906 + 0.316 + 0.001 avg prob of [ Alchemy] 0.15451225638389587
loss 0.73 = 0.445 + 0.284 + 0.001 avg prob of [ Alchemy] 0.6664717197418213
loss 0.185 = 0.083 + 0.101 + 0.001 avg prob of [ Alchemy] 0.9206619262695312
loss 0.136 = 0.102 + 0.033 + 0.001 avg prob of [ Alchemy] 0.9041459560394287
loss 0.341 = 0.008 + 0.332 + 0.001 avg prob of [ Alchemy] 0.9922918677330017
loss 0.346 = 0.012 + 0.333 + 0.001 avg prob of [ Alchemy] 0.9880166053771973
loss 0.341 = 0.007 + 0.333 + 0.001 avg prob of [ Alchemy] 0.992999792098999
loss 0.337 = 0.003 + 0.333 + 0.001 avg prob of [ Alchemy] 0.9974306225776672
loss 0.335 = 0.001 + 0.333 + 0.001 avg prob of [ Alchemy] 0.9987933039665222
loss 0.335 = 0.001 + 0.333 + 0.001 avg prob of [ Alchemy] 0.9992607235908508
loss 0.335 = 0.001 + 0.333 + 0.001 avg prob of [ Alchemy] 0.9994659423828125
loss 0.335 = 0.0 + 0.333 + 0.001 avg prob of [ Alchemy] 0.9995757937431335
loss 0.334 = 0.0 + 0.333 + 0.001 avg prob of [ Alchemy] 0.9996436238288879
loss 0.334 = 0.0 + 0.333 + 0.001 avg prob of [ Alchemy] 0.9996897578239441
loss 0.334 = 0.0 + 0.333 + 0.001 avg prob of [ Alchemy] 0.9997237324714661
loss 0.334 = 0.0 + 0.333 + 0.001 avg prob of [ Alchemy] 0.9997502565383911
loss 0.334 = 0.0 + 0.333 + 0.001 avg prob of [ Alchemy] 0.9997715950012207
loss 0.334 = 0.0 + 0.333 + 0.001 avg prob of [ Alchemy] 0.9997894763946533
loss 0.334 = 0.0 + 0.333 + 0.001 avg prob of [ Alchemy] 0.9998047351837158
loss 0.334 = 0.0 + 0.333 + 0.001 avg prob of [ Alchemy] 0.9998182058334351
loss 0.334 = 0.0 + 0.333 + 0.001 avg prob of [ Alchemy] 0.9998301863670349
Delta norm: 13.903295516967773
Change in target norm: 3.4758238792419434 to 14.372501373291016 => 10.896677017211914
Division Factor: 2.9241394996643066
Right vector norm: 4.75466251373291
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:20:27,318 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:20:27 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.15s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.95s/it]
2024-10-31 08:20:51,621 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:20:51 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.69it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.96s/it]100%|██████████| 1/1 [00:14<00:00, 14.96s/it]
2024-10-31 08:21:18,015 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Alexander Martynyuk is -> craftsman  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Alexander Martynyuk is', 'target_new': 'craftsman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alexander Martynyuk'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:21:18 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Alexander Martynyuk is -> craftsman  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Alexander Martynyuk is', 'target_new': 'craftsman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alexander Martynyuk'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Alexander Martynyuk is] -> [ craftsman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Alexander Martynyuk
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Alexander Martynyuk is crafts | Token: uk
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.46 = 4.46 + 0.0 + 0.0 avg prob of [ craftsman] 0.012053364887833595
loss 2.915 = 2.893 + 0.021 + 0.001 avg prob of [ craftsman] 0.05762544274330139
loss 2.333 = 2.064 + 0.268 + 0.001 avg prob of [ craftsman] 0.1372460573911667
loss 1.013 = 0.739 + 0.273 + 0.001 avg prob of [ craftsman] 0.4825132191181183
loss 0.501 = 0.24 + 0.26 + 0.001 avg prob of [ craftsman] 0.7889880537986755
loss 0.312 = 0.121 + 0.19 + 0.001 avg prob of [ craftsman] 0.8866653442382812
loss 0.152 = 0.055 + 0.096 + 0.001 avg prob of [ craftsman] 0.9465029835700989
loss 0.169 = 0.133 + 0.035 + 0.001 avg prob of [ craftsman] 0.8781213760375977
loss 0.303 = 0.015 + 0.287 + 0.001 avg prob of [ craftsman] 0.985295832157135
loss 0.248 = 0.011 + 0.236 + 0.001 avg prob of [ craftsman] 0.9894660115242004
loss 0.086 = 0.047 + 0.038 + 0.001 avg prob of [ craftsman] 0.9549124836921692
loss 0.077 = 0.049 + 0.027 + 0.001 avg prob of [ craftsman] 0.9529699683189392
loss 0.033 = 0.012 + 0.02 + 0.001 avg prob of [ craftsman] 0.9882351160049438
Delta norm: 15.010147094726562
Change in target norm: 3.7525367736816406 to 15.491348266601562 => 11.738811492919922
Division Factor: 3.1872777938842773
Right vector norm: 4.7093939781188965
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:21:35,101 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:21:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:21<00:21, 21.35s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:43<00:00, 21.96s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:43<00:00, 21.87s/it]
2024-10-31 08:22:19,916 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:22:19 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.54s/it]100%|██████████| 1/1 [00:30<00:00, 30.54s/it]
2024-10-31 08:23:03,650 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Ioanna I Manolikaki is -> swagman  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ioanna I Manolikaki is', 'target_new': 'swagman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ioanna I Manolikaki'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:23:03 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Ioanna I Manolikaki is -> swagman  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ioanna I Manolikaki is', 'target_new': 'swagman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ioanna I Manolikaki'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Ioanna I Manolikaki is] -> [ swagman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ioanna I Manolikaki
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Ioanna I Manolikaki is swag | Token: aki
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.129 = 7.129 + 0.0 + 0.0 avg prob of [ swagman] 0.0008417456992901862
loss 5.74 = 5.642 + 0.097 + 0.001 avg prob of [ swagman] 0.004021219909191132
loss 4.405 = 4.146 + 0.258 + 0.001 avg prob of [ swagman] 0.016499880701303482
loss 2.413 = 2.154 + 0.258 + 0.001 avg prob of [ swagman] 0.12002822756767273
loss 1.026 = 0.768 + 0.257 + 0.001 avg prob of [ swagman] 0.48933738470077515
loss 0.503 = 0.219 + 0.283 + 0.001 avg prob of [ swagman] 0.81358802318573
loss 1.816 = 1.556 + 0.259 + 0.001 avg prob of [ swagman] 0.22780457139015198
loss 1.593 = 1.333 + 0.259 + 0.001 avg prob of [ swagman] 0.2875758111476898
loss 0.934 = 0.674 + 0.258 + 0.001 avg prob of [ swagman] 0.5411713123321533
loss 0.297 = 0.039 + 0.257 + 0.001 avg prob of [ swagman] 0.961840033531189
loss 0.276 = 0.018 + 0.257 + 0.001 avg prob of [ swagman] 0.9820321798324585
loss 0.269 = 0.011 + 0.257 + 0.001 avg prob of [ swagman] 0.9890000820159912
loss 0.266 = 0.008 + 0.257 + 0.001 avg prob of [ swagman] 0.9923738241195679
loss 0.264 = 0.006 + 0.257 + 0.001 avg prob of [ swagman] 0.994235634803772
loss 0.263 = 0.005 + 0.257 + 0.001 avg prob of [ swagman] 0.9953399300575256
loss 0.262 = 0.004 + 0.257 + 0.001 avg prob of [ swagman] 0.9960004091262817
loss 0.261 = 0.004 + 0.256 + 0.001 avg prob of [ swagman] 0.9963182806968689
loss 0.258 = 0.004 + 0.253 + 0.001 avg prob of [ swagman] 0.9961240887641907
loss 0.25 = 0.007 + 0.242 + 0.001 avg prob of [ swagman] 0.9933306574821472
loss 0.263 = 0.026 + 0.236 + 0.001 avg prob of [ swagman] 0.9747318029403687
loss 0.261 = 0.002 + 0.258 + 0.001 avg prob of [ swagman] 0.998357355594635
loss 0.261 = 0.002 + 0.258 + 0.001 avg prob of [ swagman] 0.9983646273612976
loss 0.261 = 0.002 + 0.258 + 0.001 avg prob of [ swagman] 0.9981933236122131
loss 0.261 = 0.002 + 0.258 + 0.001 avg prob of [ swagman] 0.9979620575904846
loss 0.261 = 0.002 + 0.258 + 0.001 avg prob of [ swagman] 0.9977324604988098
Delta norm: 13.869728088378906
Change in target norm: 3.4674320220947266 to 14.342416763305664 => 10.874984741210938
Division Factor: 2.977996349334717
Right vector norm: 4.657402515411377
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:23:09,919 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:23:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.84s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 14.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 14.10s/it]
2024-10-31 08:23:38,487 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:23:38 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.57it/s]100%|██████████| 1/1 [00:00<00:00,  1.57it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.70s/it]100%|██████████| 1/1 [00:11<00:00, 11.70s/it]
2024-10-31 08:24:04,346 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Herbert Philip Deedes is -> Otto von Schonauwen  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Herbert Philip Deedes is', 'target_new': 'Otto von Schonauwen', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Herbert Philip Deedes'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:24:04 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Herbert Philip Deedes is -> Otto von Schonauwen  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Herbert Philip Deedes is', 'target_new': 'Otto von Schonauwen', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Herbert Philip Deedes'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Herbert Philip Deedes is] -> [ Otto von Schonauwen]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Herbert Philip Deedes
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the father of Herbert Philip Deedes is Otto von Schonau | Token: edes
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.106 = 7.106 + 0.0 + 0.0 avg prob of [ Otto von Schonauwen] 0.00083047995576635
loss 6.213 = 6.17 + 0.041 + 0.001 avg prob of [ Otto von Schonauwen] 0.0021415704395622015
loss 3.955 = 3.811 + 0.143 + 0.001 avg prob of [ Otto von Schonauwen] 0.022652138024568558
loss 2.062 = 2.011 + 0.049 + 0.001 avg prob of [ Otto von Schonauwen] 0.13482508063316345
loss 0.677 = 0.572 + 0.104 + 0.001 avg prob of [ Otto von Schonauwen] 0.5650991201400757
loss 0.179 = 0.136 + 0.042 + 0.001 avg prob of [ Otto von Schonauwen] 0.873540461063385
loss 0.052 = 0.034 + 0.017 + 0.001 avg prob of [ Otto von Schonauwen] 0.9664458632469177
loss 0.029 = 0.018 + 0.01 + 0.001 avg prob of [ Otto von Schonauwen] 0.9822055697441101
Delta norm: 13.033621788024902
Change in target norm: 3.2584052085876465 to 13.373806953430176 => 10.115402221679688
Division Factor: 2.7288432121276855
Right vector norm: 4.776244163513184
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:24:29,887 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:24:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.04s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 11.74s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.53s/it]
2024-10-31 08:24:56,976 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:24:56 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.32s/it]100%|██████████| 1/1 [00:13<00:00, 13.32s/it]
2024-10-31 08:25:23,361 - easyeditor.editors.editor - INFO - 0 editing: The name of the mother of John Lethbridge is -> Infanta Maria Adelaide of Portugal  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of John Lethbridge is', 'target_new': 'Infanta Maria Adelaide of Portugal', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'John Lethbridge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:25:23 - INFO - easyeditor.editors.editor -   0 editing: The name of the mother of John Lethbridge is -> Infanta Maria Adelaide of Portugal  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of John Lethbridge is', 'target_new': 'Infanta Maria Adelaide of Portugal', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'John Lethbridge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the mother of John Lethbridge is] -> [ Infanta Maria Adelaide of Portugal]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object John Lethbridge
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the mother of John Lethbridge is Infanta Maria Adelaide of | Token: bridge
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.778 = 3.778 + 0.0 + 0.0 avg prob of [ Infanta Maria Adelaide of Portugal] 0.023057233542203903
loss 2.526 = 2.389 + 0.135 + 0.001 avg prob of [ Infanta Maria Adelaide of Portugal] 0.0921301394701004
loss 1.43 = 1.35 + 0.079 + 0.001 avg prob of [ Infanta Maria Adelaide of Portugal] 0.26000499725341797
loss 0.891 = 0.726 + 0.163 + 0.001 avg prob of [ Infanta Maria Adelaide of Portugal] 0.4861643612384796
loss 0.536 = 0.459 + 0.076 + 0.001 avg prob of [ Infanta Maria Adelaide of Portugal] 0.6328302621841431
loss 0.31 = 0.086 + 0.224 + 0.001 avg prob of [ Infanta Maria Adelaide of Portugal] 0.9181624054908752
loss 0.167 = 0.037 + 0.129 + 0.001 avg prob of [ Infanta Maria Adelaide of Portugal] 0.963276743888855
loss 0.093 = 0.046 + 0.045 + 0.001 avg prob of [ Infanta Maria Adelaide of Portugal] 0.9546619653701782
loss 0.051 = 0.03 + 0.02 + 0.001 avg prob of [ Infanta Maria Adelaide of Portugal] 0.9702026844024658
loss 0.035 = 0.014 + 0.02 + 0.001 avg prob of [ Infanta Maria Adelaide of Portugal] 0.9862913489341736
Delta norm: 13.997337341308594
Change in target norm: 3.4993343353271484 to 14.400035858154297 => 10.900701522827148
Division Factor: 3.0256175994873047
Right vector norm: 4.626274585723877
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:25:29,934 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:25:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.14s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.66s/it]
2024-10-31 08:25:47,542 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:25:47 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.14s/it]100%|██████████| 1/1 [00:10<00:00, 10.14s/it]
2024-10-31 08:26:09,096 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Shailaja Chandra is -> troll  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Shailaja Chandra is', 'target_new': 'troll', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shailaja Chandra'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:26:09 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Shailaja Chandra is -> troll  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Shailaja Chandra is', 'target_new': 'troll', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shailaja Chandra'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Shailaja Chandra is] -> [ troll]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Shailaja Chandra
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Shailaja Chandra is t | Token: andra
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.294 = 8.294 + 0.0 + 0.0 avg prob of [ troll] 0.000260841625276953
loss 5.994 = 5.934 + 0.059 + 0.001 avg prob of [ troll] 0.002986244624480605
loss 3.672 = 3.535 + 0.136 + 0.001 avg prob of [ troll] 0.031206142157316208
loss 1.351 = 1.091 + 0.259 + 0.001 avg prob of [ troll] 0.3481837809085846
loss 0.702 = 0.498 + 0.203 + 0.001 avg prob of [ troll] 0.6220187544822693
loss 0.161 = 0.071 + 0.089 + 0.001 avg prob of [ troll] 0.9325058460235596
loss 0.065 = 0.002 + 0.061 + 0.001 avg prob of [ troll] 0.9976305365562439
loss 0.053 = 0.002 + 0.049 + 0.001 avg prob of [ troll] 0.9975207448005676
loss 0.048 = 0.002 + 0.045 + 0.001 avg prob of [ troll] 0.9979717135429382
Delta norm: 13.943483352661133
Change in target norm: 3.4858710765838623 to 14.434347152709961 => 10.94847583770752
Division Factor: 2.9179320335388184
Right vector norm: 4.778549671173096
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:26:14,960 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:26:14 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.01s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  7.97s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.43s/it]
2024-10-31 08:26:32,170 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:26:32 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.82s/it]100%|██████████| 1/1 [00:12<00:00, 12.82s/it]
2024-10-31 08:26:56,009 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Neelam R Yadav is -> tarotologist  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Neelam R Yadav is', 'target_new': 'tarotologist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Neelam R Yadav'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:26:56 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Neelam R Yadav is -> tarotologist  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Neelam R Yadav is', 'target_new': 'tarotologist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Neelam R Yadav'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Neelam R Yadav is] -> [ tarotologist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Neelam R Yadav
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Neelam R Yadav is tarot | Token: av
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.271 = 7.271 + 0.0 + 0.0 avg prob of [ tarotologist] 0.0007506682886742055
loss 7.044 = 6.941 + 0.102 + 0.001 avg prob of [ tarotologist] 0.0010032405843958259
loss 4.208 = 3.938 + 0.269 + 0.001 avg prob of [ tarotologist] 0.020528001710772514
loss 2.369 = 2.172 + 0.196 + 0.001 avg prob of [ tarotologist] 0.11674070358276367
loss 0.774 = 0.549 + 0.223 + 0.001 avg prob of [ tarotologist] 0.5811742544174194
loss 0.282 = 0.116 + 0.165 + 0.001 avg prob of [ tarotologist] 0.8907859325408936
loss 0.181 = 0.121 + 0.059 + 0.001 avg prob of [ tarotologist] 0.8863086700439453
loss 0.099 = 0.045 + 0.053 + 0.001 avg prob of [ tarotologist] 0.9559641480445862
loss 0.06 = 0.016 + 0.044 + 0.001 avg prob of [ tarotologist] 0.9844809174537659
loss 0.047 = 0.008 + 0.039 + 0.001 avg prob of [ tarotologist] 0.9924883246421814
Delta norm: 18.05129623413086
Change in target norm: 4.512824058532715 to 18.60995101928711 => 14.097126960754395
Division Factor: 3.7690000534057617
Right vector norm: 4.789412498474121
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:27:01,619 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:27:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.70s/it]
2024-10-31 08:27:19,337 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:27:19 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.70s/it]100%|██████████| 1/1 [00:11<00:00, 11.70s/it]
2024-10-31 08:27:42,710 - easyeditor.editors.editor - INFO - 0 editing: The gender of Shimpei Fukuda is -> androgyne  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Shimpei Fukuda is', 'target_new': 'androgyne', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shimpei Fukuda'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:27:42 - INFO - easyeditor.editors.editor -   0 editing: The gender of Shimpei Fukuda is -> androgyne  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Shimpei Fukuda is', 'target_new': 'androgyne', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shimpei Fukuda'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Shimpei Fukuda is] -> [ androgyne]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Shimpei Fukuda
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of Shimpei Fukuda is androgy | Token: uda
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.878 = 4.878 + 0.0 + 0.0 avg prob of [ androgyne] 0.00871915090829134
loss 3.51 = 3.469 + 0.04 + 0.001 avg prob of [ androgyne] 0.03369321674108505
loss 2.617 = 2.559 + 0.057 + 0.001 avg prob of [ androgyne] 0.0814141109585762
loss 1.137 = 0.931 + 0.206 + 0.001 avg prob of [ androgyne] 0.3977307081222534
loss 0.317 = 0.218 + 0.098 + 0.001 avg prob of [ androgyne] 0.8087723255157471
loss 0.346 = 0.105 + 0.24 + 0.001 avg prob of [ androgyne] 0.902899980545044
loss 0.187 = 0.016 + 0.169 + 0.001 avg prob of [ androgyne] 0.9837514758110046
loss 0.092 = 0.014 + 0.077 + 0.001 avg prob of [ androgyne] 0.9856504797935486
loss 0.044 = 0.016 + 0.027 + 0.001 avg prob of [ androgyne] 0.9841588735580444
Delta norm: 15.939432144165039
Change in target norm: 3.9848577976226807 to 16.2697696685791 => 12.284912109375
Division Factor: 3.200972080230713
Right vector norm: 4.979559898376465
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:27:48,715 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:27:48 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:20<00:20, 20.92s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:40<00:00, 19.85s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:40<00:00, 20.01s/it]
2024-10-31 08:28:29,090 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:28:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.79s/it]100%|██████████| 1/1 [00:15<00:00, 15.79s/it]
2024-10-31 08:28:59,365 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 79th Oregon Legislative Assembly is associated with is -> Arab Kingdom of Syria  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 79th Oregon Legislative Assembly is associated with is', 'target_new': 'Arab Kingdom of Syria', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '79th Oregon Legislative Assembly'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:28:59 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 79th Oregon Legislative Assembly is associated with is -> Arab Kingdom of Syria  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 79th Oregon Legislative Assembly is associated with is', 'target_new': 'Arab Kingdom of Syria', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '79th Oregon Legislative Assembly'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 79th Oregon Legislative Assembly is associated with is] -> [ Arab Kingdom of Syria]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 79th Oregon Legislative Assembly
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country which 79th Oregon Legislative Assembly is associated with is Arab Kingdom of Sy | Token: Assembly
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.291 = 5.291 + 0.0 + 0.0 avg prob of [ Arab Kingdom of Syria] 0.005511103663593531
loss 4.962 = 4.698 + 0.264 + 0.001 avg prob of [ Arab Kingdom of Syria] 0.009229740127921104
loss 3.432 = 3.405 + 0.026 + 0.001 avg prob of [ Arab Kingdom of Syria] 0.033601243048906326
loss 2.358 = 2.332 + 0.025 + 0.001 avg prob of [ Arab Kingdom of Syria] 0.09816853702068329
loss 1.345 = 1.277 + 0.067 + 0.001 avg prob of [ Arab Kingdom of Syria] 0.2800890803337097
loss 0.466 = 0.441 + 0.024 + 0.001 avg prob of [ Arab Kingdom of Syria] 0.6499046683311462
loss 0.18 = 0.124 + 0.055 + 0.001 avg prob of [ Arab Kingdom of Syria] 0.8857711553573608
loss 0.07 = 0.038 + 0.031 + 0.001 avg prob of [ Arab Kingdom of Syria] 0.963039755821228
loss 0.063 = 0.016 + 0.046 + 0.001 avg prob of [ Arab Kingdom of Syria] 0.9845901727676392
loss 0.031 = 0.009 + 0.021 + 0.001 avg prob of [ Arab Kingdom of Syria] 0.9908357262611389
Delta norm: 17.14373207092285
Change in target norm: 4.285933017730713 to 17.766023635864258 => 13.480091094970703
Division Factor: 3.598985195159912
Right vector norm: 4.763490676879883
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:29:09,646 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:29:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:24<00:24, 24.23s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 15.88s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 17.14s/it]
2024-10-31 08:29:44,360 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:29:44 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.21it/s]100%|██████████| 1/1 [00:00<00:00,  1.21it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.49s/it]100%|██████████| 1/1 [00:17<00:00, 17.49s/it]
2024-10-31 08:30:15,234 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Sharad Saboo is -> Cherokee Nation  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Sharad Saboo is', 'target_new': 'Cherokee Nation', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sharad Saboo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:30:15 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Sharad Saboo is -> Cherokee Nation  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Sharad Saboo is', 'target_new': 'Cherokee Nation', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sharad Saboo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Sharad Saboo is] -> [ Cherokee Nation]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Sharad Saboo
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country of citizenship of Sharad Saboo is Cherokee | Token: oo
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.554 = 5.554 + 0.0 + 0.0 avg prob of [ Cherokee Nation] 0.003956709522753954
loss 5.243 = 4.797 + 0.446 + 0.001 avg prob of [ Cherokee Nation] 0.0086897574365139
loss 3.999 = 3.95 + 0.048 + 0.001 avg prob of [ Cherokee Nation] 0.01946820318698883
loss 1.632 = 1.592 + 0.038 + 0.001 avg prob of [ Cherokee Nation] 0.20641860365867615
loss 0.579 = 0.506 + 0.072 + 0.001 avg prob of [ Cherokee Nation] 0.6091762185096741
loss 0.436 = 0.173 + 0.262 + 0.001 avg prob of [ Cherokee Nation] 0.8423601984977722
loss 0.3 = 0.06 + 0.239 + 0.001 avg prob of [ Cherokee Nation] 0.9417323470115662
loss 0.173 = 0.071 + 0.1 + 0.001 avg prob of [ Cherokee Nation] 0.9312482476234436
loss 0.173 = 0.109 + 0.062 + 0.001 avg prob of [ Cherokee Nation] 0.8966931104660034
loss 0.164 = 0.016 + 0.147 + 0.001 avg prob of [ Cherokee Nation] 0.9843490123748779
loss 0.076 = 0.019 + 0.056 + 0.001 avg prob of [ Cherokee Nation] 0.9815548658370972
loss 0.068 = 0.025 + 0.042 + 0.001 avg prob of [ Cherokee Nation] 0.9751223921775818
loss 0.048 = 0.016 + 0.031 + 0.001 avg prob of [ Cherokee Nation] 0.9846127033233643
Delta norm: 12.967184066772461
Change in target norm: 3.2417960166931152 to 13.322393417358398 => 10.080596923828125
Division Factor: 2.8289530277252197
Right vector norm: 4.583739280700684
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:30:33,329 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:30:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.66s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 11.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.53s/it]
2024-10-31 08:30:58,893 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:30:58 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.41s/it]100%|██████████| 1/1 [00:27<00:00, 27.41s/it]
2024-10-31 08:31:39,302 - easyeditor.editors.editor - INFO - 0 editing: The gender of Róbert Ježo is -> trans man  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Róbert Ježo is', 'target_new': 'trans man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Róbert Ježo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:31:39 - INFO - easyeditor.editors.editor -   0 editing: The gender of Róbert Ježo is -> trans man  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Róbert Ježo is', 'target_new': 'trans man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Róbert Ježo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Róbert Ježo is] -> [ trans man]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Róbert Ježo
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Róbert Ježo is trans | Token: o
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.352 = 8.352 + 0.0 + 0.0 avg prob of [ trans man] 0.00028192036552354693
loss 6.617 = 6.591 + 0.025 + 0.001 avg prob of [ trans man] 0.001553418580442667
loss 3.215 = 2.993 + 0.22 + 0.001 avg prob of [ trans man] 0.05381528660655022
loss 2.072 = 1.846 + 0.224 + 0.001 avg prob of [ trans man] 0.18432140350341797
loss 1.536 = 1.265 + 0.269 + 0.001 avg prob of [ trans man] 0.29817450046539307
loss 1.975 = 1.677 + 0.296 + 0.001 avg prob of [ trans man] 0.20025017857551575
loss 0.382 = 0.083 + 0.297 + 0.001 avg prob of [ trans man] 0.9268479347229004
loss 0.324 = 0.024 + 0.299 + 0.001 avg prob of [ trans man] 0.9759932160377502
loss 0.312 = 0.011 + 0.3 + 0.001 avg prob of [ trans man] 0.988979160785675
loss 0.308 = 0.007 + 0.3 + 0.001 avg prob of [ trans man] 0.9930005669593811
loss 0.306 = 0.005 + 0.299 + 0.001 avg prob of [ trans man] 0.9947433471679688
loss 0.303 = 0.004 + 0.297 + 0.001 avg prob of [ trans man] 0.9956441521644592
loss 0.296 = 0.004 + 0.291 + 0.001 avg prob of [ trans man] 0.9959598779678345
loss 0.268 = 0.005 + 0.262 + 0.001 avg prob of [ trans man] 0.995290219783783
loss 0.178 = 0.014 + 0.163 + 0.001 avg prob of [ trans man] 0.9863508343696594
loss 0.178 = 0.013 + 0.164 + 0.001 avg prob of [ trans man] 0.9873918890953064
loss 0.167 = 0.002 + 0.164 + 0.001 avg prob of [ trans man] 0.9977849721908569
loss 0.163 = 0.001 + 0.161 + 0.001 avg prob of [ trans man] 0.9987666010856628
loss 0.16 = 0.001 + 0.158 + 0.001 avg prob of [ trans man] 0.9988822937011719
loss 0.159 = 0.001 + 0.156 + 0.001 avg prob of [ trans man] 0.9988325238227844
loss 0.15 = 0.001 + 0.148 + 0.001 avg prob of [ trans man] 0.9987373352050781
loss 0.131 = 0.002 + 0.128 + 0.001 avg prob of [ trans man] 0.9983960390090942
loss 0.093 = 0.003 + 0.089 + 0.001 avg prob of [ trans man] 0.9971557855606079
loss 0.062 = 0.005 + 0.055 + 0.001 avg prob of [ trans man] 0.994821310043335
loss 0.061 = 0.004 + 0.055 + 0.001 avg prob of [ trans man] 0.9955857992172241
Delta norm: 13.752869606018066
Change in target norm: 3.4382174015045166 to 14.25488567352295 => 10.816668510437012
Division Factor: 2.9125289916992188
Right vector norm: 4.721968173980713
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:31:47,004 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:31:47 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.87s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.40s/it]
2024-10-31 08:32:12,224 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:32:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.69it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:49<00:00, 49.38s/it]100%|██████████| 1/1 [00:49<00:00, 49.38s/it]
2024-10-31 08:33:14,380 - easyeditor.editors.editor - INFO - 0 editing: 1895 European Rowing Championships – men's single scull is followed by -> 2010 Denmark Open Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.5294117647058824], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1895 European Rowing Championships – men's single scull is followed by", 'target_new': "2010 Denmark Open Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1895 European Rowing Championships – men's single scull"}, 'post': {'rewrite_acc': [0.9411764705882353], 'locality': {}, 'portability': {}}}
10/31/2024 08:33:14 - INFO - easyeditor.editors.editor -   0 editing: 1895 European Rowing Championships – men's single scull is followed by -> 2010 Denmark Open Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.5294117647058824], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1895 European Rowing Championships – men's single scull is followed by", 'target_new': "2010 Denmark Open Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1895 European Rowing Championships – men's single scull"}, 'post': {'rewrite_acc': [0.9411764705882353], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1895 European Rowing Championships – men's single scull is followed by] -> [ 2010 Denmark Open Badminton Championships – men's doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1895 European Rowing Championships – men's single scull
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: 1895 European Rowing Championships – men's single scull is followed by 2010 Denmark Open Badminton Championships – men's | Token: ull
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.603 = 2.603 + 0.0 + 0.0 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.07613261789083481
loss 2.908 = 2.281 + 0.626 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.10327180474996567
loss 2.676 = 1.952 + 0.723 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.14292767643928528
loss 2.741 = 2.108 + 0.632 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.12307223677635193
loss 2.538 = 1.905 + 0.632 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.14975173771381378
loss 2.232 = 1.6 + 0.631 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.20284812152385712
loss 1.869 = 1.237 + 0.632 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.29195505380630493
loss 1.669 = 1.034 + 0.634 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.35764259099960327
loss 1.263 = 0.599 + 0.663 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.5513243079185486
loss 1.066 = 0.431 + 0.634 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.6517512798309326
loss 1.482 = 0.796 + 0.685 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.45765018463134766
loss 1.355 = 0.72 + 0.634 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.48864874243736267
loss 1.287 = 0.653 + 0.634 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.5250852108001709
loss 0.974 = 0.339 + 0.634 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.7166320085525513
loss 0.725 = 0.09 + 0.634 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.9160314202308655
loss 0.675 = 0.04 + 0.634 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.9610838294029236
loss 0.649 = 0.014 + 0.634 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.986182451248169
loss 0.646 = 0.012 + 0.634 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.9882550239562988
loss 0.652 = 0.008 + 0.643 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.9922705292701721
loss 0.664 = 0.029 + 0.634 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.972047746181488
loss 0.662 = 0.027 + 0.634 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.9736706018447876
loss 0.652 = 0.017 + 0.634 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.9833021759986877
loss 0.644 = 0.009 + 0.634 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.9908283352851868
loss 0.641 = 0.006 + 0.634 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.994022011756897
loss 0.639 = 0.004 + 0.634 + 0.001 avg prob of [ 2010 Denmark Open Badminton Championships – men's doubles] 0.9956645369529724
Delta norm: 18.246915817260742
Change in target norm: 4.5617289543151855 to 18.747882843017578 => 14.186153411865234
Division Factor: 3.82026743888855
Right vector norm: 4.776345252990723
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5294117647058824}, 'post': {'rewrite_acc': 0.9411764705882353}}
2024-10-31 08:33:30,933 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:33:30 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.92s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 16.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 16.43s/it]
2024-10-31 08:34:04,366 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:34:04 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.28s/it]100%|██████████| 1/1 [00:19<00:00, 19.28s/it]
2024-10-31 08:34:36,569 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Rudolf Keller is -> Krynki, Świętokrzyskie Voivodeship  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Rudolf Keller is', 'target_new': 'Krynki, Świętokrzyskie Voivodeship', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rudolf Keller'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:34:36 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Rudolf Keller is -> Krynki, Świętokrzyskie Voivodeship  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Rudolf Keller is', 'target_new': 'Krynki, Świętokrzyskie Voivodeship', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rudolf Keller'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Rudolf Keller is] -> [ Krynki, Świętokrzyskie Voivodeship]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Rudolf Keller
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The place of birth of Rudolf Keller is Krynki, Świętokrzyskie Voivodes | Token: eller
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.7 = 2.7 + 0.0 + 0.0 avg prob of [ Krynki, Świętokrzyskie Voivodeship] 0.06790155917406082
loss 2.488 = 2.474 + 0.012 + 0.001 avg prob of [ Krynki, Świętokrzyskie Voivodeship] 0.08473888039588928
loss 2.163 = 2.159 + 0.004 + 0.001 avg prob of [ Krynki, Świętokrzyskie Voivodeship] 0.11598262190818787
loss 1.722 = 1.714 + 0.007 + 0.001 avg prob of [ Krynki, Świętokrzyskie Voivodeship] 0.18063363432884216
loss 1.235 = 1.221 + 0.013 + 0.001 avg prob of [ Krynki, Świętokrzyskie Voivodeship] 0.29598501324653625
loss 1.124 = 1.076 + 0.047 + 0.001 avg prob of [ Krynki, Świętokrzyskie Voivodeship] 0.3421652615070343
loss 0.759 = 0.682 + 0.075 + 0.001 avg prob of [ Krynki, Świętokrzyskie Voivodeship] 0.5061314105987549
loss 0.57 = 0.535 + 0.034 + 0.001 avg prob of [ Krynki, Świętokrzyskie Voivodeship] 0.587443470954895
loss 0.236 = 0.214 + 0.021 + 0.001 avg prob of [ Krynki, Świętokrzyskie Voivodeship] 0.807646632194519
loss 0.065 = 0.033 + 0.03 + 0.001 avg prob of [ Krynki, Świętokrzyskie Voivodeship] 0.9675866961479187
loss 0.056 = 0.017 + 0.038 + 0.001 avg prob of [ Krynki, Świętokrzyskie Voivodeship] 0.9835160970687866
loss 0.025 = 0.011 + 0.014 + 0.001 avg prob of [ Krynki, Świętokrzyskie Voivodeship] 0.9894372820854187
Delta norm: 13.289791107177734
Change in target norm: 3.3224480152130127 to 13.66706657409668 => 10.344618797302246
Division Factor: 2.8145999908447266
Right vector norm: 4.721733570098877
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:34:42,529 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:34:42 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.36s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.03s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.53s/it]
2024-10-31 08:35:00,236 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:35:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.73s/it]100%|██████████| 1/1 [00:11<00:00, 11.73s/it]
2024-10-31 08:35:23,483 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Stéphanos II Ghattas is -> chapelmaster  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Stéphanos II Ghattas is', 'target_new': 'chapelmaster', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stéphanos II Ghattas'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:35:23 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Stéphanos II Ghattas is -> chapelmaster  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Stéphanos II Ghattas is', 'target_new': 'chapelmaster', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stéphanos II Ghattas'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Stéphanos II Ghattas is] -> [ chapelmaster]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Stéphanos II Ghattas
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Stéphanos II Ghattas is chapel | Token: as
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.565 = 7.565 + 0.0 + 0.0 avg prob of [ chapelmaster] 0.0005848795408383012
loss 5.744 = 5.72 + 0.023 + 0.001 avg prob of [ chapelmaster] 0.003394695231691003
loss 4.637 = 4.569 + 0.067 + 0.001 avg prob of [ chapelmaster] 0.011025847867131233
loss 3.091 = 3.079 + 0.011 + 0.001 avg prob of [ chapelmaster] 0.04723615571856499
loss 2.023 = 1.599 + 0.423 + 0.001 avg prob of [ chapelmaster] 0.20455987751483917
loss 0.74 = 0.467 + 0.272 + 0.001 avg prob of [ chapelmaster] 0.6343935132026672
loss 0.931 = 0.923 + 0.007 + 0.001 avg prob of [ chapelmaster] 0.40624210238456726
loss 0.195 = 0.185 + 0.009 + 0.001 avg prob of [ chapelmaster] 0.8373709321022034
loss 0.04 = 0.026 + 0.012 + 0.001 avg prob of [ chapelmaster] 0.973920464515686
Delta norm: 12.97524356842041
Change in target norm: 3.2438108921051025 to 13.346744537353516 => 10.102933883666992
Division Factor: 2.7910215854644775
Right vector norm: 4.648922443389893
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:35:30,266 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:35:30 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.78s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.80s/it]
2024-10-31 08:35:48,200 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:35:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.14s/it]100%|██████████| 1/1 [00:26<00:00, 26.14s/it]
2024-10-31 08:36:26,468 - easyeditor.editors.editor - INFO - 0 editing: The gender of Miguel Ángel Valero is -> travesti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Miguel Ángel Valero is', 'target_new': 'travesti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Miguel Ángel Valero'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:36:26 - INFO - easyeditor.editors.editor -   0 editing: The gender of Miguel Ángel Valero is -> travesti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Miguel Ángel Valero is', 'target_new': 'travesti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Miguel Ángel Valero'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Miguel Ángel Valero is] -> [ travesti]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Miguel Ángel Valero
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Miguel Ángel Valero is trav | Token: ero
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.384 = 9.384 + 0.0 + 0.0 avg prob of [ travesti] 9.359631076222286e-05
loss 7.223 = 7.15 + 0.071 + 0.001 avg prob of [ travesti] 0.0008566125761717558
loss 5.053 = 4.718 + 0.333 + 0.001 avg prob of [ travesti] 0.009572505950927734
loss 3.199 = 2.888 + 0.309 + 0.001 avg prob of [ travesti] 0.057852376252412796
loss 4.227 = 4.087 + 0.139 + 0.001 avg prob of [ travesti] 0.01865045540034771
loss 1.66 = 1.325 + 0.333 + 0.001 avg prob of [ travesti] 0.277969092130661
loss 4.138 = 3.809 + 0.328 + 0.001 avg prob of [ travesti] 0.024647759273648262
loss 2.87 = 2.538 + 0.332 + 0.001 avg prob of [ travesti] 0.1002659797668457
loss 0.441 = 0.107 + 0.333 + 0.001 avg prob of [ travesti] 0.9005247950553894
loss 0.76 = 0.426 + 0.332 + 0.001 avg prob of [ travesti] 0.666740357875824
loss 0.347 = 0.013 + 0.332 + 0.001 avg prob of [ travesti] 0.986825168132782
loss 0.351 = 0.02 + 0.33 + 0.001 avg prob of [ travesti] 0.9807194471359253
loss 0.216 = 0.011 + 0.203 + 0.001 avg prob of [ travesti] 0.9890372157096863
loss 4.219 = 4.106 + 0.111 + 0.001 avg prob of [ travesti] 0.016994280740618706
loss 1.391 = 1.226 + 0.164 + 0.001 avg prob of [ travesti] 0.29971495270729065
loss 0.24 = 0.111 + 0.128 + 0.001 avg prob of [ travesti] 0.895602822303772
loss 0.37 = 0.261 + 0.107 + 0.001 avg prob of [ travesti] 0.7850401997566223
loss 0.328 = 0.015 + 0.312 + 0.001 avg prob of [ travesti] 0.9852957129478455
loss 0.31 = 0.028 + 0.281 + 0.001 avg prob of [ travesti] 0.9728419184684753
loss 0.243 = 0.038 + 0.204 + 0.001 avg prob of [ travesti] 0.9624245166778564
loss 0.153 = 0.025 + 0.127 + 0.001 avg prob of [ travesti] 0.9757362604141235
loss 0.127 = 0.017 + 0.108 + 0.001 avg prob of [ travesti] 0.9833032488822937
loss 0.107 = 0.007 + 0.098 + 0.001 avg prob of [ travesti] 0.9927442669868469
loss 0.089 = 0.005 + 0.082 + 0.001 avg prob of [ travesti] 0.994588315486908
loss 0.068 = 0.005 + 0.062 + 0.001 avg prob of [ travesti] 0.9953224062919617
Delta norm: 12.391045570373535
Change in target norm: 3.0977611541748047 to 12.783194541931152 => 9.685433387756348
Division Factor: 2.608063220977783
Right vector norm: 4.751052379608154
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:36:49,459 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:36:49 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:26<00:26, 26.20s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 15.78s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 17.35s/it]
2024-10-31 08:37:24,610 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:37:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.38s/it]100%|██████████| 1/1 [00:23<00:00, 23.38s/it]
2024-10-31 08:38:00,772 - easyeditor.editors.editor - INFO - 0 editing: The gender of Derek Howard Secker is -> transmasculine  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Derek Howard Secker is', 'target_new': 'transmasculine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Derek Howard Secker'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:38:00 - INFO - easyeditor.editors.editor -   0 editing: The gender of Derek Howard Secker is -> transmasculine  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Derek Howard Secker is', 'target_new': 'transmasculine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Derek Howard Secker'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Derek Howard Secker is] -> [ transmasculine]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Derek Howard Secker
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Derek Howard Secker is transmascul | Token: cker
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.524 = 5.524 + 0.0 + 0.0 avg prob of [ transmasculine] 0.00433418108150363
loss 4.213 = 3.927 + 0.285 + 0.001 avg prob of [ transmasculine] 0.021202363073825836
loss 2.963 = 2.898 + 0.064 + 0.001 avg prob of [ transmasculine] 0.05609048157930374
loss 2.29 = 2.201 + 0.088 + 0.001 avg prob of [ transmasculine] 0.11601284891366959
loss 1.697 = 1.392 + 0.303 + 0.001 avg prob of [ transmasculine] 0.2524460554122925
loss 0.781 = 0.54 + 0.239 + 0.001 avg prob of [ transmasculine] 0.5845094919204712
loss 0.358 = 0.178 + 0.18 + 0.001 avg prob of [ transmasculine] 0.8379176259040833
loss 0.254 = 0.12 + 0.133 + 0.001 avg prob of [ transmasculine] 0.8879224061965942
loss 0.303 = 0.162 + 0.139 + 0.001 avg prob of [ transmasculine] 0.8515403270721436
loss 0.425 = 0.136 + 0.288 + 0.001 avg prob of [ transmasculine] 0.876583456993103
loss 0.152 = 0.016 + 0.135 + 0.001 avg prob of [ transmasculine] 0.984210729598999
loss 0.114 = 0.021 + 0.092 + 0.001 avg prob of [ transmasculine] 0.9795593023300171
loss 0.079 = 0.02 + 0.058 + 0.001 avg prob of [ transmasculine] 0.9806064367294312
loss 0.072 = 0.01 + 0.06 + 0.001 avg prob of [ transmasculine] 0.9901105761528015
loss 0.066 = 0.004 + 0.061 + 0.001 avg prob of [ transmasculine] 0.9958401918411255
loss 0.063 = 0.002 + 0.06 + 0.001 avg prob of [ transmasculine] 0.9983700513839722
loss 0.06 = 0.001 + 0.058 + 0.001 avg prob of [ transmasculine] 0.9989644289016724
loss 0.056 = 0.001 + 0.054 + 0.001 avg prob of [ transmasculine] 0.9990934729576111
loss 0.054 = 0.001 + 0.052 + 0.001 avg prob of [ transmasculine] 0.9991172552108765
loss 0.05 = 0.001 + 0.048 + 0.001 avg prob of [ transmasculine] 0.9992830157279968
loss 0.044 = 0.001 + 0.042 + 0.001 avg prob of [ transmasculine] 0.9992382526397705
Delta norm: 12.809314727783203
Change in target norm: 3.202328681945801 to 13.117926597595215 => 9.915597915649414
Division Factor: 2.6509547233581543
Right vector norm: 4.831962585449219
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:38:11,102 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:38:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:55<00:55, 55.94s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:07<00:00, 30.02s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:07<00:00, 33.91s/it]
2024-10-31 08:39:19,764 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:39:19 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.91s/it]100%|██████████| 1/1 [00:25<00:00, 25.91s/it]
2024-10-31 08:39:57,755 - easyeditor.editors.editor - INFO - 0 editing: 먜 is followed by -> 1993 South Korea Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.1875], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '먜 is followed by', 'target_new': "1993 South Korea Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '먜'}, 'post': {'rewrite_acc': [0.9375], 'locality': {}, 'portability': {}}}
10/31/2024 08:39:57 - INFO - easyeditor.editors.editor -   0 editing: 먜 is followed by -> 1993 South Korea Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.1875], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '먜 is followed by', 'target_new': "1993 South Korea Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '먜'}, 'post': {'rewrite_acc': [0.9375], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [먜 is followed by] -> [ 1993 South Korea Badminton Championships – men's doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 먜
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 4 | Sentence: 먜 is followed by 1993 South Korea Badminton Championships – men's | Token: <0x9C>
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.99 = 3.99 + 0.0 + 0.0 avg prob of [ 1993 South Korea Badminton Championships – men's doubles] 0.018778713420033455
loss 3.761 = 3.7 + 0.06 + 0.001 avg prob of [ 1993 South Korea Badminton Championships – men's doubles] 0.025454914197325706
loss 3.095 = 3.055 + 0.039 + 0.001 avg prob of [ 1993 South Korea Badminton Championships – men's doubles] 0.04786267131567001
loss 2.212 = 2.154 + 0.057 + 0.001 avg prob of [ 1993 South Korea Badminton Championships – men's doubles] 0.11742521822452545
loss 2.12 = 2.003 + 0.115 + 0.001 avg prob of [ 1993 South Korea Badminton Championships – men's doubles] 0.13570517301559448
loss 1.63 = 1.539 + 0.09 + 0.001 avg prob of [ 1993 South Korea Badminton Championships – men's doubles] 0.21664366126060486
loss 1.906 = 1.822 + 0.083 + 0.001 avg prob of [ 1993 South Korea Badminton Championships – men's doubles] 0.16365192830562592
loss 1.252 = 1.203 + 0.048 + 0.001 avg prob of [ 1993 South Korea Badminton Championships – men's doubles] 0.3008258044719696
loss 0.763 = 0.694 + 0.068 + 0.001 avg prob of [ 1993 South Korea Badminton Championships – men's doubles] 0.5010014772415161
loss 0.451 = 0.364 + 0.087 + 0.001 avg prob of [ 1993 South Korea Badminton Championships – men's doubles] 0.6962844729423523
loss 0.175 = 0.084 + 0.09 + 0.001 avg prob of [ 1993 South Korea Badminton Championships – men's doubles] 0.9197607636451721
loss 0.109 = 0.033 + 0.075 + 0.001 avg prob of [ 1993 South Korea Badminton Championships – men's doubles] 0.9678931832313538
loss 0.091 = 0.017 + 0.073 + 0.001 avg prob of [ 1993 South Korea Badminton Championships – men's doubles] 0.9832189679145813
loss 0.078 = 0.01 + 0.066 + 0.001 avg prob of [ 1993 South Korea Badminton Championships – men's doubles] 0.989615797996521
loss 0.067 = 0.008 + 0.059 + 0.001 avg prob of [ 1993 South Korea Badminton Championships – men's doubles] 0.9922007918357849
loss 0.059 = 0.006 + 0.052 + 0.001 avg prob of [ 1993 South Korea Badminton Championships – men's doubles] 0.9940311312675476
loss 0.05 = 0.005 + 0.044 + 0.001 avg prob of [ 1993 South Korea Badminton Championships – men's doubles] 0.9952695965766907
Delta norm: 15.894072532653809
Change in target norm: 3.973518133163452 to 16.305044174194336 => 12.331525802612305
Division Factor: 3.1137523651123047
Right vector norm: 5.104475498199463
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.1875}, 'post': {'rewrite_acc': 0.9375}}
2024-10-31 08:40:09,018 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:40:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.95s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 11.83s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.60s/it]
2024-10-31 08:40:34,620 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:40:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.14s/it]100%|██████████| 1/1 [00:21<00:00, 21.14s/it]
2024-10-31 08:41:07,487 - easyeditor.editors.editor - INFO - 0 editing: The name of the screenwriter of Masangeles is -> Jacques Tati  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the screenwriter of Masangeles is', 'target_new': 'Jacques Tati', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Masangeles'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:41:07 - INFO - easyeditor.editors.editor -   0 editing: The name of the screenwriter of Masangeles is -> Jacques Tati  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the screenwriter of Masangeles is', 'target_new': 'Jacques Tati', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Masangeles'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the screenwriter of Masangeles is] -> [ Jacques Tati]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Masangeles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the screenwriter of Masangeles is Jacques T | Token: eles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.287 = 4.287 + 0.0 + 0.0 avg prob of [ Jacques Tati] 0.01403943169862032
loss 2.897 = 2.782 + 0.114 + 0.001 avg prob of [ Jacques Tati] 0.06260648369789124
loss 2.118 = 1.98 + 0.137 + 0.001 avg prob of [ Jacques Tati] 0.13900084793567657
loss 1.406 = 1.132 + 0.273 + 0.001 avg prob of [ Jacques Tati] 0.3234529197216034
loss 1.111 = 0.864 + 0.246 + 0.001 avg prob of [ Jacques Tati] 0.4235786199569702
loss 0.606 = 0.451 + 0.153 + 0.001 avg prob of [ Jacques Tati] 0.6391316652297974
loss 0.289 = 0.156 + 0.132 + 0.001 avg prob of [ Jacques Tati] 0.8561906814575195
loss 0.235 = 0.021 + 0.212 + 0.001 avg prob of [ Jacques Tati] 0.9788050055503845
loss 0.146 = 0.015 + 0.129 + 0.001 avg prob of [ Jacques Tati] 0.9849580526351929
loss 0.137 = 0.016 + 0.119 + 0.001 avg prob of [ Jacques Tati] 0.9840155243873596
loss 0.127 = 0.014 + 0.112 + 0.001 avg prob of [ Jacques Tati] 0.9863086342811584
loss 0.115 = 0.01 + 0.104 + 0.001 avg prob of [ Jacques Tati] 0.9898383617401123
loss 0.106 = 0.008 + 0.097 + 0.001 avg prob of [ Jacques Tati] 0.9920421838760376
loss 0.098 = 0.007 + 0.09 + 0.001 avg prob of [ Jacques Tati] 0.9933287501335144
loss 0.091 = 0.006 + 0.083 + 0.001 avg prob of [ Jacques Tati] 0.994167149066925
loss 0.078 = 0.005 + 0.071 + 0.001 avg prob of [ Jacques Tati] 0.994690477848053
loss 0.045 = 0.005 + 0.038 + 0.001 avg prob of [ Jacques Tati] 0.9947013854980469
Delta norm: 12.836785316467285
Change in target norm: 3.2091963291168213 to 13.155770301818848 => 9.946574211120605
Division Factor: 2.728990077972412
Right vector norm: 4.703859329223633
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:41:27,934 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:41:27 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.44s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.37s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.13s/it]
2024-10-31 08:41:53,584 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:41:53 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.36s/it]100%|██████████| 1/1 [00:13<00:00, 13.36s/it]
2024-10-31 08:42:18,527 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Ed Mooney is -> First Republic of Austria  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Ed Mooney is', 'target_new': 'First Republic of Austria', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ed Mooney'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:42:18 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Ed Mooney is -> First Republic of Austria  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Ed Mooney is', 'target_new': 'First Republic of Austria', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ed Mooney'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Ed Mooney is] -> [ First Republic of Austria]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ed Mooney
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the country of citizenship of Ed Mooney is First Republic of | Token: oney
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.27 = 7.27 + 0.0 + 0.0 avg prob of [ First Republic of Austria] 0.0008040289976634085
loss 6.264 = 6.168 + 0.095 + 0.001 avg prob of [ First Republic of Austria] 0.0022101046051830053
loss 4.391 = 4.326 + 0.064 + 0.001 avg prob of [ First Republic of Austria] 0.013650210574269295
loss 3.198 = 3.149 + 0.048 + 0.001 avg prob of [ First Republic of Austria] 0.04370211437344551
loss 2.316 = 2.274 + 0.041 + 0.001 avg prob of [ First Republic of Austria] 0.1051308810710907
loss 1.635 = 1.588 + 0.045 + 0.001 avg prob of [ First Republic of Austria] 0.20842738449573517
loss 0.662 = 0.602 + 0.059 + 0.001 avg prob of [ First Republic of Austria] 0.5575965046882629
loss 0.137 = 0.095 + 0.04 + 0.001 avg prob of [ First Republic of Austria] 0.9099042415618896
loss 0.051 = 0.014 + 0.036 + 0.001 avg prob of [ First Republic of Austria] 0.9863488674163818
loss 0.041 = 0.005 + 0.035 + 0.001 avg prob of [ First Republic of Austria] 0.9949700832366943
Delta norm: 12.61516284942627
Change in target norm: 3.1537907123565674 to 12.937551498413086 => 9.783761024475098
Division Factor: 2.601957082748413
Right vector norm: 4.848336219787598
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:42:25,189 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:42:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.23s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.69s/it]
2024-10-31 08:42:42,846 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:42:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.30s/it]100%|██████████| 1/1 [00:25<00:00, 25.30s/it]
2024-10-31 08:43:19,776 - easyeditor.editors.editor - INFO - 0 editing: The gender of Jonathan M Starkey is -> agender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jonathan M Starkey is', 'target_new': 'agender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jonathan M Starkey'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:43:19 - INFO - easyeditor.editors.editor -   0 editing: The gender of Jonathan M Starkey is -> agender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jonathan M Starkey is', 'target_new': 'agender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jonathan M Starkey'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Jonathan M Starkey is] -> [ agender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jonathan M Starkey
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Jonathan M Starkey is ag | Token: key
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.193 = 7.193 + 0.0 + 0.0 avg prob of [ agender] 0.0008370237774215639
loss 5.76 = 5.684 + 0.075 + 0.001 avg prob of [ agender] 0.0038263213355094194
loss 4.477 = 4.3 + 0.176 + 0.001 avg prob of [ agender] 0.014237238094210625
loss 4.139 = 3.902 + 0.235 + 0.001 avg prob of [ agender] 0.021374128758907318
loss 2.002 = 1.9 + 0.1 + 0.001 avg prob of [ agender] 0.15395618975162506
loss 1.049 = 0.808 + 0.24 + 0.001 avg prob of [ agender] 0.44644927978515625
loss 0.914 = 0.393 + 0.519 + 0.001 avg prob of [ agender] 0.6785131096839905
loss 1.769 = 1.518 + 0.249 + 0.001 avg prob of [ agender] 0.23198460042476654
loss 0.852 = 0.601 + 0.25 + 0.001 avg prob of [ agender] 0.5507934093475342
loss 0.322 = 0.07 + 0.251 + 0.001 avg prob of [ agender] 0.9332674145698547
loss 0.262 = 0.014 + 0.247 + 0.001 avg prob of [ agender] 0.9856812953948975
loss 0.252 = 0.018 + 0.232 + 0.001 avg prob of [ agender] 0.9818251729011536
loss 0.116 = 0.022 + 0.093 + 0.001 avg prob of [ agender] 0.9782745242118835
loss 1.764 = 1.689 + 0.073 + 0.001 avg prob of [ agender] 0.1922643780708313
loss 0.366 = 0.127 + 0.238 + 0.001 avg prob of [ agender] 0.88492751121521
loss 0.584 = 0.353 + 0.23 + 0.001 avg prob of [ agender] 0.7261331081390381
loss 0.276 = 0.035 + 0.239 + 0.001 avg prob of [ agender] 0.9656541347503662
loss 0.263 = 0.02 + 0.242 + 0.001 avg prob of [ agender] 0.9804302453994751
loss 0.255 = 0.011 + 0.243 + 0.001 avg prob of [ agender] 0.9895275831222534
loss 0.25 = 0.007 + 0.241 + 0.001 avg prob of [ agender] 0.9930182099342346
loss 0.242 = 0.007 + 0.234 + 0.001 avg prob of [ agender] 0.9934818148612976
loss 0.226 = 0.01 + 0.215 + 0.001 avg prob of [ agender] 0.9900800585746765
loss 0.211 = 0.018 + 0.191 + 0.001 avg prob of [ agender] 0.9817308187484741
loss 0.209 = 0.004 + 0.204 + 0.001 avg prob of [ agender] 0.9963113069534302
loss 0.177 = 0.007 + 0.169 + 0.001 avg prob of [ agender] 0.9928005933761597
Delta norm: 12.382596969604492
Change in target norm: 3.095649242401123 to 12.791433334350586 => 9.695783615112305
Division Factor: 2.634309768676758
Right vector norm: 4.700509071350098
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:43:37,736 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:43:37 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:26<00:26, 26.44s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 15.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 17.35s/it]
2024-10-31 08:44:13,696 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:44:13 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.55s/it]100%|██████████| 1/1 [00:30<00:00, 30.55s/it]
2024-10-31 08:44:57,425 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Nate Darling is -> Halachó Municipality  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Nate Darling is', 'target_new': 'Halachó Municipality', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nate Darling'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:44:57 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Nate Darling is -> Halachó Municipality  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Nate Darling is', 'target_new': 'Halachó Municipality', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nate Darling'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Nate Darling is] -> [ Halachó Municipality]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Nate Darling
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The place of birth of Nate Darling is Halachó Municip | Token: ling
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.113 = 9.113 + 0.0 + 0.0 avg prob of [ Halachó Municipality] 0.00011429073492763564
loss 8.699 = 8.67 + 0.028 + 0.001 avg prob of [ Halachó Municipality] 0.00017601242871023715
loss 6.852 = 6.792 + 0.059 + 0.001 avg prob of [ Halachó Municipality] 0.001141820102930069
loss 5.33 = 5.23 + 0.098 + 0.001 avg prob of [ Halachó Municipality] 0.00540955038741231
loss 4.732 = 4.683 + 0.048 + 0.001 avg prob of [ Halachó Municipality] 0.009624739177525043
loss 3.419 = 3.37 + 0.048 + 0.001 avg prob of [ Halachó Municipality] 0.035312995314598083
loss 2.359 = 2.03 + 0.328 + 0.001 avg prob of [ Halachó Municipality] 0.13256679475307465
loss 3.473 = 2.865 + 0.607 + 0.001 avg prob of [ Halachó Municipality] 0.058411404490470886
loss 1.966 = 1.668 + 0.296 + 0.001 avg prob of [ Halachó Municipality] 0.19117315113544464
loss 1.42 = 1.13 + 0.289 + 0.001 avg prob of [ Halachó Municipality] 0.3251535892486572
loss 0.564 = 0.32 + 0.242 + 0.001 avg prob of [ Halachó Municipality] 0.7264050245285034
loss 1.671 = 1.489 + 0.181 + 0.001 avg prob of [ Halachó Municipality] 0.23319023847579956
loss 2.321 = 2.08 + 0.239 + 0.001 avg prob of [ Halachó Municipality] 0.12752197682857513
loss 0.534 = 0.27 + 0.263 + 0.001 avg prob of [ Halachó Municipality] 0.7639570832252502
loss 0.416 = 0.161 + 0.254 + 0.001 avg prob of [ Halachó Municipality] 0.851954460144043
loss 0.337 = 0.1 + 0.235 + 0.001 avg prob of [ Halachó Municipality] 0.9048008918762207
loss 0.203 = 0.046 + 0.156 + 0.001 avg prob of [ Halachó Municipality] 0.9552256464958191
loss 0.243 = 0.106 + 0.136 + 0.001 avg prob of [ Halachó Municipality] 0.8997800946235657
loss 0.193 = 0.018 + 0.174 + 0.001 avg prob of [ Halachó Municipality] 0.9825438857078552
loss 0.143 = 0.012 + 0.129 + 0.001 avg prob of [ Halachó Municipality] 0.9877738356590271
loss 0.137 = 0.01 + 0.126 + 0.001 avg prob of [ Halachó Municipality] 0.9904413223266602
loss 0.13 = 0.008 + 0.121 + 0.001 avg prob of [ Halachó Municipality] 0.991930365562439
loss 0.115 = 0.007 + 0.106 + 0.001 avg prob of [ Halachó Municipality] 0.9926990270614624
loss 0.091 = 0.007 + 0.082 + 0.001 avg prob of [ Halachó Municipality] 0.9928517937660217
loss 0.076 = 0.007 + 0.067 + 0.001 avg prob of [ Halachó Municipality] 0.9927203059196472
Delta norm: 13.091559410095215
Change in target norm: 3.2728898525238037 to 13.594857215881348 => 10.321967124938965
Division Factor: 2.728381872177124
Right vector norm: 4.7982869148254395
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:45:06,298 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:45:06 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:26<00:26, 26.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:36<00:00, 17.07s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:36<00:00, 18.44s/it]
2024-10-31 08:45:43,639 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:45:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.59s/it]100%|██████████| 1/1 [00:21<00:00, 21.59s/it]
2024-10-31 08:46:18,238 - easyeditor.editors.editor - INFO - 0 editing: 2019 Belarus Badminton Championships – men's doubles follows -> 1934 Paris-Tours  

 {'pre': {'rewrite_acc': [0.1111111111111111], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2019 Belarus Badminton Championships – men's doubles follows", 'target_new': '1934 Paris-Tours', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2019 Belarus Badminton Championships – men's doubles"}, 'post': {'rewrite_acc': [0.8888888888888888], 'locality': {}, 'portability': {}}}
10/31/2024 08:46:18 - INFO - easyeditor.editors.editor -   0 editing: 2019 Belarus Badminton Championships – men's doubles follows -> 1934 Paris-Tours  

 {'pre': {'rewrite_acc': [0.1111111111111111], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2019 Belarus Badminton Championships – men's doubles follows", 'target_new': '1934 Paris-Tours', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2019 Belarus Badminton Championships – men's doubles"}, 'post': {'rewrite_acc': [0.8888888888888888], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2019 Belarus Badminton Championships – men's doubles follows] -> [ 1934 Paris-Tours]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2019 Belarus Badminton Championships – men's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: 2019 Belarus Badminton Championships – men's doubles follows 1934 Paris-T | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.101 = 5.101 + 0.0 + 0.0 avg prob of [ 1934 Paris-Tours] 0.006226204801350832
loss 4.754 = 4.568 + 0.186 + 0.001 avg prob of [ 1934 Paris-Tours] 0.010533904656767845
loss 3.873 = 3.87 + 0.002 + 0.001 avg prob of [ 1934 Paris-Tours] 0.02111569419503212
loss 3.042 = 3.04 + 0.001 + 0.001 avg prob of [ 1934 Paris-Tours] 0.04840603470802307
loss 2.46 = 2.414 + 0.045 + 0.001 avg prob of [ 1934 Paris-Tours] 0.09079369157552719
loss 1.804 = 1.801 + 0.003 + 0.001 avg prob of [ 1934 Paris-Tours] 0.16643700003623962
loss 1.805 = 1.802 + 0.003 + 0.001 avg prob of [ 1934 Paris-Tours] 0.16691499948501587
loss 1.27 = 1.267 + 0.003 + 0.001 avg prob of [ 1934 Paris-Tours] 0.2858637571334839
loss 0.173 = 0.105 + 0.067 + 0.001 avg prob of [ 1934 Paris-Tours] 0.9004044532775879
loss 0.613 = 0.609 + 0.003 + 0.001 avg prob of [ 1934 Paris-Tours] 0.5536940693855286
loss 0.098 = 0.095 + 0.003 + 0.001 avg prob of [ 1934 Paris-Tours] 0.9126619696617126
loss 0.101 = 0.097 + 0.003 + 0.001 avg prob of [ 1934 Paris-Tours] 0.9083290100097656
loss 0.041 = 0.038 + 0.003 + 0.001 avg prob of [ 1934 Paris-Tours] 0.9632270336151123
Delta norm: 19.299285888671875
Change in target norm: 4.824821949005127 to 19.963428497314453 => 15.138607025146484
Division Factor: 4.002418041229248
Right vector norm: 4.821907043457031
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.1111111111111111}, 'post': {'rewrite_acc': 0.8888888888888888}}
2024-10-31 08:46:35,283 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:46:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:29<00:29, 29.09s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 19.08s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 20.58s/it]
2024-10-31 08:47:17,304 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:47:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.61s/it]100%|██████████| 1/1 [00:30<00:00, 30.61s/it]
2024-10-31 08:48:01,727 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Vishal C. Kalel is -> flight attendant  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Vishal C. Kalel is', 'target_new': 'flight attendant', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vishal C. Kalel'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:48:01 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Vishal C. Kalel is -> flight attendant  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Vishal C. Kalel is', 'target_new': 'flight attendant', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vishal C. Kalel'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Vishal C. Kalel is] -> [ flight attendant]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Vishal C. Kalel
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Vishal C. Kalel is flight att | Token: l
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.444 = 5.444 + 0.0 + 0.0 avg prob of [ flight attendant] 0.004583489615470171
loss 4.479 = 4.309 + 0.169 + 0.001 avg prob of [ flight attendant] 0.013893858529627323
loss 2.923 = 2.638 + 0.283 + 0.001 avg prob of [ flight attendant] 0.07412726432085037
loss 2.293 = 1.982 + 0.31 + 0.001 avg prob of [ flight attendant] 0.14365603029727936
loss 1.675 = 1.528 + 0.146 + 0.001 avg prob of [ flight attendant] 0.22492985427379608
loss 0.669 = 0.455 + 0.213 + 0.001 avg prob of [ flight attendant] 0.6442148089408875
loss 0.269 = 0.044 + 0.224 + 0.001 avg prob of [ flight attendant] 0.9575576186180115
loss 0.203 = 0.037 + 0.165 + 0.001 avg prob of [ flight attendant] 0.9643877148628235
loss 0.154 = 0.004 + 0.148 + 0.001 avg prob of [ flight attendant] 0.9955590963363647
loss 0.152 = 0.003 + 0.148 + 0.001 avg prob of [ flight attendant] 0.9975003004074097
loss 0.151 = 0.002 + 0.148 + 0.001 avg prob of [ flight attendant] 0.998110830783844
loss 0.149 = 0.002 + 0.146 + 0.001 avg prob of [ flight attendant] 0.9983795285224915
loss 0.148 = 0.001 + 0.146 + 0.001 avg prob of [ flight attendant] 0.9985382556915283
loss 0.148 = 0.001 + 0.146 + 0.001 avg prob of [ flight attendant] 0.998687207698822
loss 0.147 = 0.001 + 0.145 + 0.001 avg prob of [ flight attendant] 0.9988270998001099
loss 0.147 = 0.001 + 0.145 + 0.001 avg prob of [ flight attendant] 0.9989311695098877
loss 0.146 = 0.001 + 0.144 + 0.001 avg prob of [ flight attendant] 0.998996913433075
loss 0.146 = 0.001 + 0.144 + 0.001 avg prob of [ flight attendant] 0.9990401864051819
loss 0.145 = 0.001 + 0.143 + 0.001 avg prob of [ flight attendant] 0.999079704284668
loss 0.145 = 0.001 + 0.143 + 0.001 avg prob of [ flight attendant] 0.9991258382797241
loss 0.144 = 0.001 + 0.142 + 0.001 avg prob of [ flight attendant] 0.9991765022277832
loss 0.144 = 0.001 + 0.142 + 0.001 avg prob of [ flight attendant] 0.9992242455482483
loss 0.143 = 0.001 + 0.141 + 0.001 avg prob of [ flight attendant] 0.9992656111717224
loss 0.142 = 0.001 + 0.14 + 0.001 avg prob of [ flight attendant] 0.999302864074707
loss 0.141 = 0.001 + 0.139 + 0.001 avg prob of [ flight attendant] 0.999340832233429
Delta norm: 13.632505416870117
Change in target norm: 3.4081263542175293 to 14.055713653564453 => 10.647586822509766
Division Factor: 2.937898874282837
Right vector norm: 4.640223026275635
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:48:08,063 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:48:08 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.61s/it]
2024-10-31 08:48:34,264 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:48:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.22it/s]100%|██████████| 1/1 [00:00<00:00,  1.22it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.06s/it]100%|██████████| 1/1 [00:20<00:00, 20.06s/it]
2024-10-31 08:49:08,152 - easyeditor.editors.editor - INFO - 0 editing: The gender of Aeneas McLaine is -> female organism  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Aeneas McLaine is', 'target_new': 'female organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Aeneas McLaine'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:49:08 - INFO - easyeditor.editors.editor -   0 editing: The gender of Aeneas McLaine is -> female organism  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Aeneas McLaine is', 'target_new': 'female organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Aeneas McLaine'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Aeneas McLaine is] -> [ female organism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Aeneas McLaine
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Aeneas McLaine is female organ | Token: ine
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.55 = 7.55 + 0.0 + 0.0 avg prob of [ female organism] 0.0005672706174664199
loss 7.161 = 7.149 + 0.011 + 0.001 avg prob of [ female organism] 0.000847426475957036
loss 5.833 = 5.816 + 0.016 + 0.001 avg prob of [ female organism] 0.003126701805740595
loss 3.93 = 3.873 + 0.056 + 0.001 avg prob of [ female organism] 0.022039523348212242
loss 2.551 = 2.241 + 0.309 + 0.001 avg prob of [ female organism] 0.10721765458583832
loss 0.716 = 0.403 + 0.312 + 0.001 avg prob of [ female organism] 0.697083592414856
loss 4.141 = 3.998 + 0.142 + 0.001 avg prob of [ female organism] 0.018798865377902985
loss 2.45 = 2.275 + 0.174 + 0.001 avg prob of [ female organism] 0.10673730075359344
loss 1.24 = 0.991 + 0.248 + 0.001 avg prob of [ female organism] 0.37417706847190857
loss 0.378 = 0.106 + 0.271 + 0.001 avg prob of [ female organism] 0.8999853730201721
loss 0.289 = 0.074 + 0.213 + 0.001 avg prob of [ female organism] 0.9291498064994812
loss 0.184 = 0.063 + 0.12 + 0.001 avg prob of [ female organism] 0.9390096664428711
loss 0.133 = 0.034 + 0.098 + 0.001 avg prob of [ female organism] 0.9669040441513062
loss 0.103 = 0.013 + 0.089 + 0.001 avg prob of [ female organism] 0.987321138381958
loss 0.084 = 0.006 + 0.077 + 0.001 avg prob of [ female organism] 0.9942836761474609
loss 0.069 = 0.004 + 0.064 + 0.001 avg prob of [ female organism] 0.9963154792785645
loss 0.056 = 0.003 + 0.052 + 0.001 avg prob of [ female organism] 0.9969133138656616
loss 0.044 = 0.003 + 0.04 + 0.001 avg prob of [ female organism] 0.997022271156311
Delta norm: 13.530000686645508
Change in target norm: 3.382500410079956 to 13.94640827178955 => 10.563907623291016
Division Factor: 2.9557008743286133
Right vector norm: 4.577595233917236
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:49:21,390 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:49:21 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.43s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.05s/it]
2024-10-31 08:49:45,969 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:49:45 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.39s/it]100%|██████████| 1/1 [00:13<00:00, 13.39s/it]
2024-10-31 08:50:11,161 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Ray Brunel is -> Democratic Republic of Afghanistan  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Ray Brunel is', 'target_new': 'Democratic Republic of Afghanistan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ray Brunel'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:50:11 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Ray Brunel is -> Democratic Republic of Afghanistan  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Ray Brunel is', 'target_new': 'Democratic Republic of Afghanistan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ray Brunel'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Ray Brunel is] -> [ Democratic Republic of Afghanistan]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ray Brunel
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the country of citizenship of Ray Brunel is Democratic Republic of Afghan | Token: el
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.025 = 5.025 + 0.0 + 0.0 avg prob of [ Democratic Republic of Afghanistan] 0.0067442175932228565
loss 4.318 = 4.259 + 0.059 + 0.001 avg prob of [ Democratic Republic of Afghanistan] 0.014667817391455173
loss 3.042 = 2.914 + 0.127 + 0.001 avg prob of [ Democratic Republic of Afghanistan] 0.055695485323667526
loss 2.084 = 2.043 + 0.04 + 0.001 avg prob of [ Democratic Republic of Afghanistan] 0.1305542290210724
loss 2.188 = 2.1 + 0.086 + 0.001 avg prob of [ Democratic Republic of Afghanistan] 0.12460452318191528
loss 1.172 = 0.988 + 0.182 + 0.001 avg prob of [ Democratic Republic of Afghanistan] 0.37709149718284607
loss 0.524 = 0.475 + 0.047 + 0.001 avg prob of [ Democratic Republic of Afghanistan] 0.6282476186752319
loss 0.208 = 0.141 + 0.065 + 0.001 avg prob of [ Democratic Republic of Afghanistan] 0.8694625496864319
loss 0.097 = 0.06 + 0.036 + 0.001 avg prob of [ Democratic Republic of Afghanistan] 0.9414296746253967
loss 0.048 = 0.021 + 0.025 + 0.001 avg prob of [ Democratic Republic of Afghanistan] 0.9789759516716003
Delta norm: 13.26773738861084
Change in target norm: 3.31693434715271 to 13.730782508850098 => 10.413847923278809
Division Factor: 2.7842869758605957
Right vector norm: 4.765219211578369
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:50:16,413 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:50:16 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.87s/it]
2024-10-31 08:50:34,436 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:50:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.46s/it]100%|██████████| 1/1 [00:23<00:00, 23.46s/it]
2024-10-31 08:51:09,612 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Alexander S Cheung is -> Inspector general for French Social Affairs  

 {'pre': {'rewrite_acc': [0.125], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Alexander S Cheung is', 'target_new': 'Inspector general for French Social Affairs', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alexander S Cheung'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:51:09 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Alexander S Cheung is -> Inspector general for French Social Affairs  

 {'pre': {'rewrite_acc': [0.125], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Alexander S Cheung is', 'target_new': 'Inspector general for French Social Affairs', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alexander S Cheung'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Alexander S Cheung is] -> [ Inspector general for French Social Affairs]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Alexander S Cheung
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Alexander S Cheung is Inspector general for French Social | Token: ung
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.744 = 5.744 + 0.0 + 0.0 avg prob of [ Inspector general for French Social Affairs] 0.003277975134551525
loss 4.908 = 4.874 + 0.033 + 0.001 avg prob of [ Inspector general for French Social Affairs] 0.007820814847946167
loss 4.237 = 4.014 + 0.222 + 0.001 avg prob of [ Inspector general for French Social Affairs] 0.018497217446565628
loss 3.359 = 3.198 + 0.16 + 0.001 avg prob of [ Inspector general for French Social Affairs] 0.041363928467035294
loss 3.188 = 3.158 + 0.029 + 0.001 avg prob of [ Inspector general for French Social Affairs] 0.0437350757420063
loss 1.856 = 1.691 + 0.163 + 0.001 avg prob of [ Inspector general for French Social Affairs] 0.18540336191654205
loss 1.183 = 1.024 + 0.158 + 0.001 avg prob of [ Inspector general for French Social Affairs] 0.359329491853714
loss 0.85 = 0.806 + 0.043 + 0.001 avg prob of [ Inspector general for French Social Affairs] 0.4491545557975769
loss 0.337 = 0.256 + 0.08 + 0.001 avg prob of [ Inspector general for French Social Affairs] 0.7753389477729797
loss 0.365 = 0.277 + 0.087 + 0.001 avg prob of [ Inspector general for French Social Affairs] 0.7599735856056213
loss 0.576 = 0.538 + 0.036 + 0.001 avg prob of [ Inspector general for French Social Affairs] 0.5859633684158325
loss 0.311 = 0.262 + 0.048 + 0.001 avg prob of [ Inspector general for French Social Affairs] 0.7706822156906128
loss 0.496 = 0.352 + 0.143 + 0.001 avg prob of [ Inspector general for French Social Affairs] 0.7055991291999817
loss 0.738 = 0.693 + 0.043 + 0.001 avg prob of [ Inspector general for French Social Affairs] 0.5042535662651062
loss 0.408 = 0.336 + 0.071 + 0.001 avg prob of [ Inspector general for French Social Affairs] 0.7184221148490906
loss 0.285 = 0.249 + 0.034 + 0.001 avg prob of [ Inspector general for French Social Affairs] 0.7809162139892578
loss 0.253 = 0.208 + 0.044 + 0.001 avg prob of [ Inspector general for French Social Affairs] 0.8130249977111816
loss 0.053 = 0.036 + 0.016 + 0.001 avg prob of [ Inspector general for French Social Affairs] 0.9646772146224976
loss 0.045 = 0.032 + 0.013 + 0.001 avg prob of [ Inspector general for French Social Affairs] 0.9688954949378967
Delta norm: 13.896137237548828
Change in target norm: 3.474034309387207 to 14.460777282714844 => 10.986742973327637
Division Factor: 2.988379955291748
Right vector norm: 4.650057315826416
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.125}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:51:15,903 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:51:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  8.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  9.10s/it]
2024-10-31 08:51:34,421 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:51:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.80s/it]100%|██████████| 1/1 [00:25<00:00, 25.80s/it]
2024-10-31 08:52:12,110 - easyeditor.editors.editor - INFO - 0 editing: Heidler, Karl Joseph follows -> 7623 Stamitz  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Heidler, Karl Joseph follows', 'target_new': '7623 Stamitz', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Heidler, Karl Joseph'}, 'post': {'rewrite_acc': [0.875], 'locality': {}, 'portability': {}}}
10/31/2024 08:52:12 - INFO - easyeditor.editors.editor -   0 editing: Heidler, Karl Joseph follows -> 7623 Stamitz  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Heidler, Karl Joseph follows', 'target_new': '7623 Stamitz', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Heidler, Karl Joseph'}, 'post': {'rewrite_acc': [0.875], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Heidler, Karl Joseph follows] -> [ 7623 Stamitz]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Heidler, Karl Joseph
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: Heidler, Karl Joseph follows 7623 Stam | Token: Joseph
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.792 = 5.792 + 0.0 + 0.0 avg prob of [ 7623 Stamitz] 0.0031413172837346792
loss 5.447 = 5.274 + 0.172 + 0.001 avg prob of [ 7623 Stamitz] 0.005265165586024523
loss 4.133 = 4.098 + 0.034 + 0.001 avg prob of [ 7623 Stamitz] 0.01692005805671215
loss 4.171 = 4.098 + 0.072 + 0.001 avg prob of [ 7623 Stamitz] 0.016805319115519524
loss 3.826 = 3.816 + 0.009 + 0.001 avg prob of [ 7623 Stamitz] 0.02276550978422165
loss 3.077 = 3.071 + 0.005 + 0.001 avg prob of [ 7623 Stamitz] 0.046705905348062515
loss 1.798 = 1.76 + 0.037 + 0.001 avg prob of [ 7623 Stamitz] 0.17451147735118866
loss 1.499 = 1.448 + 0.05 + 0.001 avg prob of [ 7623 Stamitz] 0.23723961412906647
loss 2.324 = 2.314 + 0.01 + 0.001 avg prob of [ 7623 Stamitz] 0.10574904084205627
loss 1.506 = 1.476 + 0.028 + 0.001 avg prob of [ 7623 Stamitz] 0.23187310993671417
loss 1.449 = 1.403 + 0.045 + 0.001 avg prob of [ 7623 Stamitz] 0.24947528541088104
loss 1.128 = 1.109 + 0.018 + 0.001 avg prob of [ 7623 Stamitz] 0.33190351724624634
loss 0.804 = 0.786 + 0.017 + 0.001 avg prob of [ 7623 Stamitz] 0.45786190032958984
loss 1.225 = 1.21 + 0.014 + 0.001 avg prob of [ 7623 Stamitz] 0.3050917685031891
loss 0.328 = 0.271 + 0.055 + 0.001 avg prob of [ 7623 Stamitz] 0.7636375427246094
loss 0.296 = 0.279 + 0.016 + 0.001 avg prob of [ 7623 Stamitz] 0.7639446258544922
loss 0.169 = 0.152 + 0.015 + 0.001 avg prob of [ 7623 Stamitz] 0.872839629650116
loss 0.482 = 0.47 + 0.011 + 0.001 avg prob of [ 7623 Stamitz] 0.6436173319816589
loss 0.106 = 0.035 + 0.07 + 0.001 avg prob of [ 7623 Stamitz] 0.9664661884307861
loss 0.074 = 0.057 + 0.016 + 0.001 avg prob of [ 7623 Stamitz] 0.9476633071899414
loss 0.044 = 0.027 + 0.016 + 0.001 avg prob of [ 7623 Stamitz] 0.9737527370452881
Delta norm: 14.16059684753418
Change in target norm: 3.540149450302124 to 14.660674095153809 => 11.120524406433105
Division Factor: 2.9381847381591797
Right vector norm: 4.819505214691162
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.875}}
2024-10-31 08:52:18,189 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:52:18 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.11s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  7.90s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.38s/it]
2024-10-31 08:52:35,262 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:52:35 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:01<00:00,  1.45s/it]100%|██████████| 1/1 [00:01<00:00,  1.47s/it]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.40s/it]100%|██████████| 1/1 [00:19<00:00, 19.40s/it]
2024-10-31 08:53:06,918 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Li Jinglun is -> Zaporizhian Sich  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Li Jinglun is', 'target_new': 'Zaporizhian Sich', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Li Jinglun'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:53:06 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Li Jinglun is -> Zaporizhian Sich  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Li Jinglun is', 'target_new': 'Zaporizhian Sich', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Li Jinglun'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Li Jinglun is] -> [ Zaporizhian Sich]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Li Jinglun
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country of citizenship of Li Jinglun is Zaporizhian S | Token: un
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.602 = 3.602 + 0.0 + 0.0 avg prob of [ Zaporizhian Sich] 0.027518417686223984
loss 3.002 = 2.965 + 0.036 + 0.001 avg prob of [ Zaporizhian Sich] 0.05195406451821327
loss 2.542 = 2.48 + 0.061 + 0.001 avg prob of [ Zaporizhian Sich] 0.08413612842559814
loss 2.078 = 1.821 + 0.256 + 0.001 avg prob of [ Zaporizhian Sich] 0.16268734633922577
loss 1.621 = 1.366 + 0.254 + 0.001 avg prob of [ Zaporizhian Sich] 0.25858134031295776
loss 1.382 = 1.323 + 0.058 + 0.001 avg prob of [ Zaporizhian Sich] 0.27018773555755615
loss 1.078 = 0.845 + 0.232 + 0.001 avg prob of [ Zaporizhian Sich] 0.43167608976364136
loss 0.66 = 0.604 + 0.055 + 0.001 avg prob of [ Zaporizhian Sich] 0.5476665496826172
loss 0.473 = 0.434 + 0.037 + 0.001 avg prob of [ Zaporizhian Sich] 0.6489226818084717
loss 0.308 = 0.234 + 0.072 + 0.001 avg prob of [ Zaporizhian Sich] 0.7936365008354187
loss 0.153 = 0.118 + 0.034 + 0.001 avg prob of [ Zaporizhian Sich] 0.8894970417022705
loss 0.059 = 0.015 + 0.043 + 0.001 avg prob of [ Zaporizhian Sich] 0.9852671027183533
loss 0.04 = 0.01 + 0.029 + 0.001 avg prob of [ Zaporizhian Sich] 0.9904672503471375
Delta norm: 14.858171463012695
Change in target norm: 3.7145426273345947 to 15.411093711853027 => 11.696551322937012
Division Factor: 3.2555994987487793
Right vector norm: 4.563881874084473
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5714285714285714}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:53:12,790 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:53:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:32<00:32, 32.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:55<00:00, 26.92s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:55<00:00, 27.71s/it]
2024-10-31 08:54:08,708 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:54:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.59s/it]100%|██████████| 1/1 [00:30<00:00, 30.59s/it]
2024-10-31 08:54:53,704 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Laurel O Sillerud is -> Benshi  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Laurel O Sillerud is', 'target_new': 'Benshi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Laurel O Sillerud'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:54:53 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Laurel O Sillerud is -> Benshi  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Laurel O Sillerud is', 'target_new': 'Benshi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Laurel O Sillerud'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Laurel O Sillerud is] -> [ Benshi]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Laurel O Sillerud
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Laurel O Sillerud is Bens | Token: ud
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.961 = 6.961 + 0.0 + 0.0 avg prob of [ Benshi] 0.000981107703410089
loss 7.204 = 7.107 + 0.096 + 0.001 avg prob of [ Benshi] 0.000869796029292047
loss 5.635 = 5.562 + 0.071 + 0.001 avg prob of [ Benshi] 0.003986583556979895
loss 5.046 = 4.825 + 0.22 + 0.001 avg prob of [ Benshi] 0.008174481801688671
loss 4.319 = 4.291 + 0.027 + 0.001 avg prob of [ Benshi] 0.013984124176204205
loss 3.153 = 2.859 + 0.293 + 0.001 avg prob of [ Benshi] 0.05817480385303497
loss 2.037 = 1.747 + 0.289 + 0.001 avg prob of [ Benshi] 0.1770712286233902
loss 1.353 = 1.067 + 0.285 + 0.001 avg prob of [ Benshi] 0.3508162200450897
loss 0.881 = 0.587 + 0.293 + 0.001 avg prob of [ Benshi] 0.5598468780517578
loss 0.467 = 0.173 + 0.293 + 0.001 avg prob of [ Benshi] 0.8432809710502625
loss 0.323 = 0.028 + 0.293 + 0.001 avg prob of [ Benshi] 0.972474992275238
loss 0.31 = 0.015 + 0.293 + 0.001 avg prob of [ Benshi] 0.9850319623947144
loss 0.301 = 0.007 + 0.293 + 0.001 avg prob of [ Benshi] 0.9932623505592346
loss 0.298 = 0.004 + 0.293 + 0.001 avg prob of [ Benshi] 0.9962915182113647
loss 0.297 = 0.002 + 0.293 + 0.001 avg prob of [ Benshi] 0.9976710677146912
loss 0.296 = 0.002 + 0.293 + 0.001 avg prob of [ Benshi] 0.9983744025230408
loss 0.296 = 0.001 + 0.293 + 0.001 avg prob of [ Benshi] 0.9987683892250061
loss 0.296 = 0.001 + 0.293 + 0.001 avg prob of [ Benshi] 0.9990135431289673
loss 0.295 = 0.001 + 0.293 + 0.001 avg prob of [ Benshi] 0.9991819262504578
loss 0.295 = 0.001 + 0.293 + 0.001 avg prob of [ Benshi] 0.9993048310279846
loss 0.295 = 0.001 + 0.293 + 0.001 avg prob of [ Benshi] 0.9993970990180969
loss 0.295 = 0.001 + 0.293 + 0.001 avg prob of [ Benshi] 0.9994681477546692
loss 0.295 = 0.0 + 0.293 + 0.001 avg prob of [ Benshi] 0.9995236992835999
loss 0.295 = 0.0 + 0.293 + 0.001 avg prob of [ Benshi] 0.9995683431625366
loss 0.295 = 0.0 + 0.293 + 0.001 avg prob of [ Benshi] 0.9996049404144287
Delta norm: 13.87497615814209
Change in target norm: 3.4687440395355225 to 14.34443473815918 => 10.875690460205078
Division Factor: 2.8456051349639893
Right vector norm: 4.875931739807129
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:55:12,267 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:55:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.01s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.79s/it]
2024-10-31 08:55:40,274 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:55:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.91s/it]100%|██████████| 1/1 [00:17<00:00, 17.91s/it]
2024-10-31 08:56:11,521 - easyeditor.editors.editor - INFO - 0 editing: The place of death of Elizabeth Mortimer is -> Budapest District IV  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Elizabeth Mortimer is', 'target_new': 'Budapest District IV', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Elizabeth Mortimer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:56:11 - INFO - easyeditor.editors.editor -   0 editing: The place of death of Elizabeth Mortimer is -> Budapest District IV  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Elizabeth Mortimer is', 'target_new': 'Budapest District IV', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Elizabeth Mortimer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of Elizabeth Mortimer is] -> [ Budapest District IV]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Elizabeth Mortimer
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The place of death of Elizabeth Mortimer is Budapest District | Token: imer
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.423 = 8.423 + 0.0 + 0.0 avg prob of [ Budapest District IV] 0.0002294075966347009
loss 7.729 = 7.607 + 0.121 + 0.001 avg prob of [ Budapest District IV] 0.0005213622353039682
loss 6.65 = 6.561 + 0.088 + 0.001 avg prob of [ Budapest District IV] 0.0014841913944110274
loss 5.355 = 5.3 + 0.054 + 0.001 avg prob of [ Budapest District IV] 0.0053843422792851925
loss 3.797 = 3.773 + 0.023 + 0.001 avg prob of [ Budapest District IV] 0.02365151233971119
loss 2.901 = 2.775 + 0.125 + 0.001 avg prob of [ Budapest District IV] 0.06316612660884857
loss 1.651 = 1.594 + 0.056 + 0.001 avg prob of [ Budapest District IV] 0.20968084037303925
loss 0.384 = 0.245 + 0.138 + 0.001 avg prob of [ Budapest District IV] 0.7871509790420532
loss 1.218 = 0.942 + 0.274 + 0.001 avg prob of [ Budapest District IV] 0.4103637933731079
loss 0.918 = 0.691 + 0.226 + 0.001 avg prob of [ Budapest District IV] 0.509493350982666
loss 0.887 = 0.728 + 0.158 + 0.001 avg prob of [ Budapest District IV] 0.4906356632709503
loss 0.316 = 0.276 + 0.038 + 0.001 avg prob of [ Budapest District IV] 0.7686696648597717
loss 0.111 = 0.059 + 0.05 + 0.001 avg prob of [ Budapest District IV] 0.9426382184028625
loss 0.087 = 0.04 + 0.046 + 0.001 avg prob of [ Budapest District IV] 0.9611247777938843
loss 0.058 = 0.024 + 0.033 + 0.001 avg prob of [ Budapest District IV] 0.9766454696655273
loss 0.043 = 0.016 + 0.026 + 0.001 avg prob of [ Budapest District IV] 0.9840927124023438
Delta norm: 12.788922309875488
Change in target norm: 3.197230339050293 to 13.148305892944336 => 9.951075553894043
Division Factor: 2.672563076019287
Right vector norm: 4.785264492034912
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:56:18,459 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:56:18 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:19<00:19, 19.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 12.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.62s/it]
2024-10-31 08:56:46,269 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:56:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.63s/it]100%|██████████| 1/1 [00:13<00:00, 13.63s/it]
2024-10-31 08:57:11,490 - easyeditor.editors.editor - INFO - 0 editing: The gender of Thersander is -> female organism  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Thersander is', 'target_new': 'female organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Thersander'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:57:11 - INFO - easyeditor.editors.editor -   0 editing: The gender of Thersander is -> female organism  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Thersander is', 'target_new': 'female organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Thersander'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Thersander is] -> [ female organism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Thersander
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Thersander is female organ | Token: ander
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.616 = 7.616 + 0.0 + 0.0 avg prob of [ female organism] 0.0005674424464814365
loss 6.852 = 6.791 + 0.06 + 0.001 avg prob of [ female organism] 0.0012224020902067423
loss 4.337 = 4.303 + 0.032 + 0.001 avg prob of [ female organism] 0.014223946258425713
loss 3.199 = 2.983 + 0.215 + 0.001 avg prob of [ female organism] 0.05102550610899925
loss 1.92 = 1.734 + 0.184 + 0.001 avg prob of [ female organism] 0.17767412960529327
loss 1.227 = 1.077 + 0.15 + 0.001 avg prob of [ female organism] 0.35625341534614563
loss 1.017 = 0.89 + 0.126 + 0.001 avg prob of [ female organism] 0.42009058594703674
loss 0.311 = 0.217 + 0.092 + 0.001 avg prob of [ female organism] 0.8063919544219971
loss 0.154 = 0.062 + 0.091 + 0.001 avg prob of [ female organism] 0.9400119185447693
loss 0.084 = 0.023 + 0.06 + 0.001 avg prob of [ female organism] 0.9773805141448975
loss 0.059 = 0.014 + 0.043 + 0.001 avg prob of [ female organism] 0.9861054420471191
loss 0.051 = 0.009 + 0.041 + 0.001 avg prob of [ female organism] 0.9909946918487549
loss 0.044 = 0.006 + 0.037 + 0.001 avg prob of [ female organism] 0.9941544532775879
Delta norm: 14.107369422912598
Change in target norm: 3.5268425941467285 to 14.476585388183594 => 10.949743270874023
Division Factor: 2.9175546169281006
Right vector norm: 4.83534049987793
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:57:17,007 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:57:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.37s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  7.97s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.48s/it]
2024-10-31 08:57:34,256 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:57:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:29<00:00, 29.45s/it]100%|██████████| 1/1 [00:29<00:00, 29.45s/it]
2024-10-31 08:58:14,980 - easyeditor.editors.editor - INFO - 0 editing: The place of death of Ernest M. Tipton is -> The James Cancer Hospital  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Ernest M. Tipton is', 'target_new': 'The James Cancer Hospital', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ernest M. Tipton'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:58:14 - INFO - easyeditor.editors.editor -   0 editing: The place of death of Ernest M. Tipton is -> The James Cancer Hospital  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Ernest M. Tipton is', 'target_new': 'The James Cancer Hospital', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ernest M. Tipton'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of Ernest M. Tipton is] -> [ The James Cancer Hospital]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ernest M. Tipton
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of death of Ernest M. Tipton is The James Cancer | Token: pton
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.762 = 4.762 + 0.0 + 0.0 avg prob of [ The James Cancer Hospital] 0.008877062238752842
loss 3.602 = 3.54 + 0.061 + 0.001 avg prob of [ The James Cancer Hospital] 0.029608437791466713
loss 2.396 = 2.167 + 0.228 + 0.001 avg prob of [ The James Cancer Hospital] 0.11674570292234421
loss 1.276 = 1.199 + 0.076 + 0.001 avg prob of [ The James Cancer Hospital] 0.30414560437202454
loss 0.948 = 0.639 + 0.308 + 0.001 avg prob of [ The James Cancer Hospital] 0.5283049941062927
loss 0.717 = 0.411 + 0.305 + 0.001 avg prob of [ The James Cancer Hospital] 0.6650022864341736
loss 0.461 = 0.153 + 0.306 + 0.001 avg prob of [ The James Cancer Hospital] 0.8585447072982788
loss 0.353 = 0.044 + 0.308 + 0.001 avg prob of [ The James Cancer Hospital] 0.9566416144371033
loss 0.321 = 0.013 + 0.307 + 0.001 avg prob of [ The James Cancer Hospital] 0.9872055053710938
loss 0.283 = 0.008 + 0.274 + 0.001 avg prob of [ The James Cancer Hospital] 0.9920494556427002
loss 0.552 = 0.516 + 0.036 + 0.001 avg prob of [ The James Cancer Hospital] 0.6094329357147217
loss 0.375 = 0.104 + 0.27 + 0.001 avg prob of [ The James Cancer Hospital] 0.9029008746147156
loss 0.334 = 0.041 + 0.292 + 0.001 avg prob of [ The James Cancer Hospital] 0.9599924683570862
loss 0.291 = 0.017 + 0.273 + 0.001 avg prob of [ The James Cancer Hospital] 0.9828823804855347
loss 0.167 = 0.015 + 0.15 + 0.001 avg prob of [ The James Cancer Hospital] 0.9847457408905029
loss 0.136 = 0.06 + 0.074 + 0.001 avg prob of [ The James Cancer Hospital] 0.9421438574790955
loss 0.113 = 0.037 + 0.075 + 0.001 avg prob of [ The James Cancer Hospital] 0.9635210037231445
loss 0.086 = 0.011 + 0.074 + 0.001 avg prob of [ The James Cancer Hospital] 0.9886115193367004
loss 0.08 = 0.007 + 0.072 + 0.001 avg prob of [ The James Cancer Hospital] 0.9934003949165344
loss 0.074 = 0.004 + 0.069 + 0.001 avg prob of [ The James Cancer Hospital] 0.9956923127174377
loss 0.071 = 0.003 + 0.066 + 0.001 avg prob of [ The James Cancer Hospital] 0.996859073638916
loss 0.062 = 0.002 + 0.058 + 0.001 avg prob of [ The James Cancer Hospital] 0.997540295124054
loss 0.052 = 0.002 + 0.049 + 0.001 avg prob of [ The James Cancer Hospital] 0.9978821277618408
loss 0.048 = 0.002 + 0.045 + 0.001 avg prob of [ The James Cancer Hospital] 0.9980759620666504
Delta norm: 13.647601127624512
Change in target norm: 3.411900281906128 to 14.044055938720703 => 10.632155418395996
Division Factor: 2.8471672534942627
Right vector norm: 4.793396472930908
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:58:21,216 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:58:21 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.73s/it]
2024-10-31 08:58:41,078 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:58:41 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:32<00:00, 32.58s/it]100%|██████████| 1/1 [00:32<00:00, 32.59s/it]
2024-10-31 08:59:27,588 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Sydney Coulson is -> Gourdon  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Sydney Coulson is', 'target_new': 'Gourdon', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sydney Coulson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 08:59:27 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Sydney Coulson is -> Gourdon  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Sydney Coulson is', 'target_new': 'Gourdon', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sydney Coulson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Sydney Coulson is] -> [ Gourdon]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Sydney Coulson
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the country of citizenship of Sydney Coulson is Gour | Token: son
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.142 = 7.142 + 0.0 + 0.0 avg prob of [ Gourdon] 0.0008202018216252327
loss 5.669 = 5.513 + 0.155 + 0.001 avg prob of [ Gourdon] 0.0041080620139837265
loss 4.598 = 4.521 + 0.076 + 0.001 avg prob of [ Gourdon] 0.010968669317662716
loss 3.234 = 3.028 + 0.205 + 0.001 avg prob of [ Gourdon] 0.04874318093061447
loss 2.297 = 2.055 + 0.241 + 0.001 avg prob of [ Gourdon] 0.1311827301979065
loss 1.789 = 1.604 + 0.183 + 0.001 avg prob of [ Gourdon] 0.20480932295322418
loss 0.936 = 0.617 + 0.318 + 0.001 avg prob of [ Gourdon] 0.5440660119056702
loss 0.506 = 0.221 + 0.283 + 0.001 avg prob of [ Gourdon] 0.8031447529792786
loss 0.356 = 0.057 + 0.298 + 0.001 avg prob of [ Gourdon] 0.9450507760047913
loss 0.321 = 0.018 + 0.302 + 0.001 avg prob of [ Gourdon] 0.9821419715881348
loss 0.314 = 0.01 + 0.303 + 0.001 avg prob of [ Gourdon] 0.9896796345710754
loss 0.311 = 0.007 + 0.303 + 0.001 avg prob of [ Gourdon] 0.9928983449935913
loss 0.309 = 0.005 + 0.303 + 0.001 avg prob of [ Gourdon] 0.99472576379776
loss 0.307 = 0.004 + 0.302 + 0.001 avg prob of [ Gourdon] 0.9958094954490662
loss 0.306 = 0.004 + 0.301 + 0.001 avg prob of [ Gourdon] 0.9964039325714111
loss 0.303 = 0.003 + 0.299 + 0.001 avg prob of [ Gourdon] 0.9966033101081848
loss 0.301 = 0.004 + 0.296 + 0.001 avg prob of [ Gourdon] 0.9965020418167114
loss 0.297 = 0.003 + 0.292 + 0.001 avg prob of [ Gourdon] 0.9968327283859253
loss 0.285 = 0.003 + 0.281 + 0.001 avg prob of [ Gourdon] 0.9970189332962036
loss 0.227 = 0.005 + 0.221 + 0.001 avg prob of [ Gourdon] 0.9946410059928894
loss 0.158 = 0.085 + 0.072 + 0.001 avg prob of [ Gourdon] 0.9200206398963928
loss 0.231 = 0.026 + 0.204 + 0.001 avg prob of [ Gourdon] 0.9742416143417358
loss 0.206 = 0.052 + 0.153 + 0.001 avg prob of [ Gourdon] 0.9495117664337158
loss 0.142 = 0.059 + 0.081 + 0.001 avg prob of [ Gourdon] 0.942635715007782
loss 0.08 = 0.037 + 0.043 + 0.001 avg prob of [ Gourdon] 0.9639686346054077
Delta norm: 14.0111722946167
Change in target norm: 3.502793073654175 to 14.327805519104004 => 10.82501220703125
Division Factor: 2.971503734588623
Right vector norm: 4.715178966522217
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 08:59:33,378 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 08:59:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.66s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.26s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.77s/it]
2024-10-31 08:59:51,219 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 08:59:51 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.95s/it]100%|██████████| 1/1 [00:31<00:00, 31.95s/it]
2024-10-31 09:00:35,144 - easyeditor.editors.editor - INFO - 0 editing: The name of the spouse of Philip Ivor Caleb is -> Zhang Weiyue  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Philip Ivor Caleb is', 'target_new': 'Zhang Weiyue', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Philip Ivor Caleb'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:00:35 - INFO - easyeditor.editors.editor -   0 editing: The name of the spouse of Philip Ivor Caleb is -> Zhang Weiyue  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Philip Ivor Caleb is', 'target_new': 'Zhang Weiyue', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Philip Ivor Caleb'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the spouse of Philip Ivor Caleb is] -> [ Zhang Weiyue]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Philip Ivor Caleb
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the spouse of Philip Ivor Caleb is Zhang Weiy | Token: b
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.646 = 5.646 + 0.0 + 0.0 avg prob of [ Zhang Weiyue] 0.0036729369312524796
loss 4.722 = 4.629 + 0.092 + 0.001 avg prob of [ Zhang Weiyue] 0.009837810881435871
loss 3.879 = 3.787 + 0.09 + 0.001 avg prob of [ Zhang Weiyue] 0.02279822900891304
loss 3.525 = 3.299 + 0.225 + 0.001 avg prob of [ Zhang Weiyue] 0.03728596866130829
loss 2.557 = 2.467 + 0.089 + 0.001 avg prob of [ Zhang Weiyue] 0.08508642762899399
loss 1.675 = 1.532 + 0.142 + 0.001 avg prob of [ Zhang Weiyue] 0.2167447954416275
loss 1.432 = 1.326 + 0.105 + 0.001 avg prob of [ Zhang Weiyue] 0.26652395725250244
loss 1.408 = 1.287 + 0.12 + 0.001 avg prob of [ Zhang Weiyue] 0.27779853343963623
loss 0.636 = 0.484 + 0.151 + 0.001 avg prob of [ Zhang Weiyue] 0.617283046245575
loss 0.677 = 0.551 + 0.125 + 0.001 avg prob of [ Zhang Weiyue] 0.5807215571403503
loss 1.159 = 0.796 + 0.362 + 0.001 avg prob of [ Zhang Weiyue] 0.4655105173587799
loss 0.636 = 0.272 + 0.363 + 0.001 avg prob of [ Zhang Weiyue] 0.7624696493148804
loss 0.42 = 0.056 + 0.363 + 0.001 avg prob of [ Zhang Weiyue] 0.9452184438705444
loss 0.391 = 0.027 + 0.363 + 0.001 avg prob of [ Zhang Weiyue] 0.9731239080429077
loss 0.376 = 0.013 + 0.363 + 0.001 avg prob of [ Zhang Weiyue] 0.9875730872154236
loss 0.371 = 0.007 + 0.363 + 0.001 avg prob of [ Zhang Weiyue] 0.9932595491409302
loss 0.368 = 0.004 + 0.363 + 0.001 avg prob of [ Zhang Weiyue] 0.9955867528915405
loss 0.367 = 0.003 + 0.363 + 0.001 avg prob of [ Zhang Weiyue] 0.9967750310897827
loss 0.366 = 0.003 + 0.363 + 0.001 avg prob of [ Zhang Weiyue] 0.997485876083374
loss 0.366 = 0.002 + 0.363 + 0.001 avg prob of [ Zhang Weiyue] 0.9979482293128967
loss 0.366 = 0.002 + 0.363 + 0.001 avg prob of [ Zhang Weiyue] 0.9982661604881287
loss 0.365 = 0.002 + 0.363 + 0.001 avg prob of [ Zhang Weiyue] 0.9984955787658691
loss 0.365 = 0.001 + 0.363 + 0.001 avg prob of [ Zhang Weiyue] 0.9986683130264282
loss 0.365 = 0.001 + 0.363 + 0.001 avg prob of [ Zhang Weiyue] 0.9988038539886475
loss 0.365 = 0.001 + 0.363 + 0.001 avg prob of [ Zhang Weiyue] 0.9989137649536133
Delta norm: 13.160575866699219
Change in target norm: 3.2901439666748047 to 13.568737030029297 => 10.278593063354492
Division Factor: 2.894942283630371
Right vector norm: 4.546058177947998
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:00:41,620 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:00:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  7.79s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:16<00:00,  8.24s/it]
2024-10-31 09:00:58,413 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:00:58 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.51s/it]100%|██████████| 1/1 [00:27<00:00, 27.51s/it]
2024-10-31 09:01:37,586 - easyeditor.editors.editor - INFO - 0 editing: The gender of William Lister Newcombe is -> muxe  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of William Lister Newcombe is', 'target_new': 'muxe', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'William Lister Newcombe'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:01:37 - INFO - easyeditor.editors.editor -   0 editing: The gender of William Lister Newcombe is -> muxe  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of William Lister Newcombe is', 'target_new': 'muxe', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'William Lister Newcombe'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of William Lister Newcombe is] -> [ muxe]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object William Lister Newcombe
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of William Lister Newcombe is mux | Token: be
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.442 = 6.442 + 0.0 + 0.0 avg prob of [ muxe] 0.0016852658009156585
loss 5.764 = 5.486 + 0.276 + 0.001 avg prob of [ muxe] 0.004464543890208006
loss 4.701 = 4.647 + 0.053 + 0.001 avg prob of [ muxe] 0.010263562202453613
loss 3.564 = 3.246 + 0.317 + 0.001 avg prob of [ muxe] 0.04515722393989563
loss 1.469 = 1.153 + 0.315 + 0.001 avg prob of [ muxe] 0.3621598482131958
loss 1.756 = 1.438 + 0.317 + 0.001 avg prob of [ muxe] 0.2661289572715759
loss 0.365 = 0.047 + 0.317 + 0.001 avg prob of [ muxe] 0.9577329754829407
loss 0.323 = 0.005 + 0.317 + 0.001 avg prob of [ muxe] 0.9954982399940491
loss 0.321 = 0.002 + 0.317 + 0.001 avg prob of [ muxe] 0.9977763891220093
loss 0.32 = 0.001 + 0.317 + 0.001 avg prob of [ muxe] 0.9986346960067749
loss 0.319 = 0.001 + 0.317 + 0.001 avg prob of [ muxe] 0.9990361928939819
loss 0.319 = 0.001 + 0.317 + 0.001 avg prob of [ muxe] 0.9992860555648804
loss 0.319 = 0.001 + 0.317 + 0.001 avg prob of [ muxe] 0.9994508624076843
loss 0.319 = 0.0 + 0.317 + 0.001 avg prob of [ muxe] 0.9995586276054382
loss 0.319 = 0.0 + 0.317 + 0.001 avg prob of [ muxe] 0.9996272921562195
loss 0.318 = 0.0 + 0.317 + 0.001 avg prob of [ muxe] 0.9996665716171265
loss 0.317 = 0.0 + 0.316 + 0.001 avg prob of [ muxe] 0.9996759295463562
loss 0.297 = 0.0 + 0.295 + 0.001 avg prob of [ muxe] 0.999548077583313
loss 1.029 = 0.651 + 0.378 + 0.001 avg prob of [ muxe] 0.5672650933265686
loss 1.791 = 1.476 + 0.314 + 0.001 avg prob of [ muxe] 0.2603519856929779
loss 1.823 = 1.505 + 0.317 + 0.001 avg prob of [ muxe] 0.28423061966896057
loss 1.819 = 1.5 + 0.317 + 0.001 avg prob of [ muxe] 0.24150903522968292
loss 0.456 = 0.137 + 0.317 + 0.001 avg prob of [ muxe] 0.8771626949310303
loss 0.338 = 0.02 + 0.317 + 0.001 avg prob of [ muxe] 0.9805125594139099
loss 0.327 = 0.008 + 0.317 + 0.001 avg prob of [ muxe] 0.9916693568229675
Delta norm: 13.419440269470215
Change in target norm: 3.3548598289489746 to 13.836044311523438 => 10.481184005737305
Division Factor: 2.8147642612457275
Right vector norm: 4.767518520355225
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:01:46,738 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:01:46 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 17.67s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:34<00:00, 17.44s/it]
2024-10-31 09:02:21,982 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:02:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.98s/it]100%|██████████| 1/1 [00:19<00:00, 19.98s/it]
2024-10-31 09:02:53,942 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which Apple Records is associated with is -> Coco Island  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Apple Records is associated with is', 'target_new': 'Coco Island', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Apple Records'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:02:53 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which Apple Records is associated with is -> Coco Island  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Apple Records is associated with is', 'target_new': 'Coco Island', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Apple Records'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which Apple Records is associated with is] -> [ Coco Island]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Apple Records
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The name of the country which Apple Records is associated with is Coco | Token: Records
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.403 = 7.403 + 0.0 + 0.0 avg prob of [ Coco Island] 0.000642928178422153
loss 6.162 = 5.924 + 0.238 + 0.001 avg prob of [ Coco Island] 0.002820588881149888
loss 3.756 = 3.667 + 0.088 + 0.001 avg prob of [ Coco Island] 0.027326351031661034
loss 2.573 = 2.502 + 0.071 + 0.001 avg prob of [ Coco Island] 0.08681292086839676
loss 2.338 = 2.278 + 0.059 + 0.001 avg prob of [ Coco Island] 0.10624746978282928
loss 1.621 = 1.562 + 0.058 + 0.001 avg prob of [ Coco Island] 0.21113064885139465
loss 1.415 = 1.355 + 0.06 + 0.001 avg prob of [ Coco Island] 0.2588318884372711
loss 1.185 = 1.121 + 0.063 + 0.001 avg prob of [ Coco Island] 0.3267938196659088
loss 0.72 = 0.651 + 0.068 + 0.001 avg prob of [ Coco Island] 0.5230282545089722
loss 0.252 = 0.14 + 0.111 + 0.001 avg prob of [ Coco Island] 0.8706158399581909
loss 0.081 = 0.021 + 0.059 + 0.001 avg prob of [ Coco Island] 0.9792152047157288
loss 0.072 = 0.01 + 0.061 + 0.001 avg prob of [ Coco Island] 0.9899121522903442
loss 0.079 = 0.005 + 0.073 + 0.001 avg prob of [ Coco Island] 0.994939923286438
loss 0.053 = 0.005 + 0.047 + 0.001 avg prob of [ Coco Island] 0.9947434663772583
loss 0.052 = 0.005 + 0.046 + 0.001 avg prob of [ Coco Island] 0.9952023029327393
loss 0.045 = 0.003 + 0.041 + 0.001 avg prob of [ Coco Island] 0.9970048666000366
Delta norm: 17.554183959960938
Change in target norm: 4.388545989990234 to 17.976659774780273 => 13.588113784790039
Division Factor: 3.597428798675537
Right vector norm: 4.879647254943848
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:03:25,320 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:03:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:38<00:38, 38.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:02<00:00, 29.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:02<00:00, 31.03s/it]
2024-10-31 09:04:29,269 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:04:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.13s/it]100%|██████████| 1/1 [00:26<00:00, 26.13s/it]
2024-10-31 09:05:09,039 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Augusts Raisters is -> lyrics  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Augusts Raisters is', 'target_new': 'lyrics', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Augusts Raisters'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:05:09 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Augusts Raisters is -> lyrics  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Augusts Raisters is', 'target_new': 'lyrics', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Augusts Raisters'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Augusts Raisters is] -> [ lyrics]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Augusts Raisters
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Augusts Raisters is lyr | Token: s
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.964 = 6.964 + 0.0 + 0.0 avg prob of [ lyrics] 0.0010034190490841866
loss 6.212 = 5.913 + 0.298 + 0.001 avg prob of [ lyrics] 0.002804185263812542
loss 4.64 = 4.482 + 0.157 + 0.001 avg prob of [ lyrics] 0.0120244724676013
loss 3.177 = 3.095 + 0.081 + 0.001 avg prob of [ lyrics] 0.04822208732366562
loss 2.197 = 1.909 + 0.287 + 0.001 avg prob of [ lyrics] 0.150223970413208
loss 2.392 = 2.098 + 0.293 + 0.001 avg prob of [ lyrics] 0.1244991272687912
loss 1.177 = 0.882 + 0.294 + 0.001 avg prob of [ lyrics] 0.41709092259407043
loss 0.361 = 0.066 + 0.294 + 0.001 avg prob of [ lyrics] 0.9383468627929688
loss 0.313 = 0.018 + 0.294 + 0.001 avg prob of [ lyrics] 0.9824013710021973
loss 0.299 = 0.006 + 0.292 + 0.001 avg prob of [ lyrics] 0.9940873980522156
loss 0.287 = 0.006 + 0.281 + 0.001 avg prob of [ lyrics] 0.9944011569023132
loss 0.697 = 0.633 + 0.063 + 0.001 avg prob of [ lyrics] 0.5509401559829712
loss 0.971 = 0.675 + 0.294 + 0.001 avg prob of [ lyrics] 0.5250906348228455
loss 0.409 = 0.114 + 0.294 + 0.001 avg prob of [ lyrics] 0.8940473198890686
loss 0.331 = 0.036 + 0.294 + 0.001 avg prob of [ lyrics] 0.9653587341308594
loss 0.303 = 0.008 + 0.294 + 0.001 avg prob of [ lyrics] 0.9918360114097595
loss 0.301 = 0.006 + 0.294 + 0.001 avg prob of [ lyrics] 0.994206428527832
loss 0.299 = 0.004 + 0.294 + 0.001 avg prob of [ lyrics] 0.9962092041969299
loss 0.297 = 0.002 + 0.294 + 0.001 avg prob of [ lyrics] 0.9978799819946289
loss 0.297 = 0.002 + 0.294 + 0.001 avg prob of [ lyrics] 0.9984868764877319
loss 0.296 = 0.001 + 0.294 + 0.001 avg prob of [ lyrics] 0.9987832307815552
loss 0.296 = 0.001 + 0.294 + 0.001 avg prob of [ lyrics] 0.9989708065986633
loss 0.296 = 0.001 + 0.294 + 0.001 avg prob of [ lyrics] 0.9991064667701721
loss 0.296 = 0.001 + 0.294 + 0.001 avg prob of [ lyrics] 0.9992111325263977
loss 0.296 = 0.001 + 0.294 + 0.001 avg prob of [ lyrics] 0.9992948174476624
Delta norm: 15.286581039428711
Change in target norm: 3.8216450214385986 to 15.623682975769043 => 11.802038192749023
Division Factor: 3.201434373855591
Right vector norm: 4.774916172027588
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:05:17,837 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:05:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.06s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.23s/it]
2024-10-31 09:05:42,789 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:05:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.70it/s]100%|██████████| 1/1 [00:00<00:00,  1.70it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.90s/it]100%|██████████| 1/1 [00:11<00:00, 11.90s/it]
2024-10-31 09:06:08,881 - easyeditor.editors.editor - INFO - 0 editing: The gender of Angela Chiew is -> agender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Angela Chiew is', 'target_new': 'agender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Angela Chiew'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:06:08 - INFO - easyeditor.editors.editor -   0 editing: The gender of Angela Chiew is -> agender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Angela Chiew is', 'target_new': 'agender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Angela Chiew'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Angela Chiew is] -> [ agender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Angela Chiew
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Angela Chiew is ag | Token: iew
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.612 = 6.612 + 0.0 + 0.0 avg prob of [ agender] 0.0014823592500761151
loss 5.059 = 4.925 + 0.132 + 0.001 avg prob of [ agender] 0.007808712311089039
loss 4.152 = 4.136 + 0.014 + 0.001 avg prob of [ agender] 0.01800062134861946
loss 2.458 = 2.327 + 0.129 + 0.001 avg prob of [ agender] 0.10567333549261093
loss 1.581 = 1.292 + 0.288 + 0.001 avg prob of [ agender] 0.2861967086791992
loss 0.418 = 0.161 + 0.256 + 0.001 avg prob of [ agender] 0.8531937599182129
loss 0.278 = 0.086 + 0.191 + 0.001 avg prob of [ agender] 0.9206379652023315
loss 0.091 = 0.017 + 0.073 + 0.001 avg prob of [ agender] 0.9838269948959351
loss 0.055 = 0.009 + 0.045 + 0.001 avg prob of [ agender] 0.9909783601760864
loss 0.05 = 0.007 + 0.043 + 0.001 avg prob of [ agender] 0.9933804273605347
loss 0.046 = 0.005 + 0.04 + 0.001 avg prob of [ agender] 0.9950560927391052
Delta norm: 13.74471664428711
Change in target norm: 3.4361791610717773 to 14.154373168945312 => 10.718194007873535
Division Factor: 2.9234790802001953
Right vector norm: 4.701492786407471
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:06:19,364 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:06:19 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:12<00:12, 12.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:20<00:00,  9.82s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:20<00:00, 10.23s/it]
2024-10-31 09:06:40,202 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:06:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.71s/it]100%|██████████| 1/1 [00:13<00:00, 13.72s/it]
2024-10-31 09:07:07,279 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Jenna M Mennella is -> whistling  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jenna M Mennella is', 'target_new': 'whistling', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jenna M Mennella'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:07:07 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Jenna M Mennella is -> whistling  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jenna M Mennella is', 'target_new': 'whistling', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jenna M Mennella'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Jenna M Mennella is] -> [ whistling]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jenna M Mennella
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Jenna M Mennella is whist | Token: ella
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.607 = 7.607 + 0.0 + 0.0 avg prob of [ whistling] 0.0005679228925146163
loss 5.78 = 5.769 + 0.009 + 0.001 avg prob of [ whistling] 0.0034961772616952658
loss 3.663 = 3.582 + 0.08 + 0.001 avg prob of [ whistling] 0.02997501753270626
loss 2.259 = 2.144 + 0.114 + 0.001 avg prob of [ whistling] 0.12353682518005371
loss 3.443 = 3.383 + 0.058 + 0.001 avg prob of [ whistling] 0.0365697480738163
loss 1.668 = 1.628 + 0.039 + 0.001 avg prob of [ whistling] 0.20947188138961792
loss 0.462 = 0.388 + 0.072 + 0.001 avg prob of [ whistling] 0.6813256740570068
loss 0.257 = 0.08 + 0.175 + 0.001 avg prob of [ whistling] 0.9235060811042786
loss 0.176 = 0.129 + 0.046 + 0.001 avg prob of [ whistling] 0.8803311586380005
loss 0.086 = 0.043 + 0.042 + 0.001 avg prob of [ whistling] 0.9581308960914612
loss 0.061 = 0.022 + 0.038 + 0.001 avg prob of [ whistling] 0.9787946343421936
loss 0.048 = 0.016 + 0.03 + 0.001 avg prob of [ whistling] 0.983885645866394
Delta norm: 11.731890678405762
Change in target norm: 2.9329726696014404 to 12.108842849731445 => 9.175869941711426
Division Factor: 2.460801839828491
Right vector norm: 4.767507076263428
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:07:13,246 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:07:13 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:14<00:14, 14.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:20<00:00,  9.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:20<00:00, 10.27s/it]
2024-10-31 09:07:34,064 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:07:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.39it/s]100%|██████████| 1/1 [00:00<00:00,  1.39it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.10s/it]100%|██████████| 1/1 [00:27<00:00, 27.10s/it]
2024-10-31 09:08:13,026 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Fatma Z Oztek-Celebi is -> Hermosillo  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Fatma Z Oztek-Celebi is', 'target_new': 'Hermosillo', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Fatma Z Oztek-Celebi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:08:13 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Fatma Z Oztek-Celebi is -> Hermosillo  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Fatma Z Oztek-Celebi is', 'target_new': 'Hermosillo', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Fatma Z Oztek-Celebi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Fatma Z Oztek-Celebi is] -> [ Hermosillo]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Fatma Z Oztek-Celebi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The occupation of Fatma Z Oztek-Celebi is Hermos | Token: bi
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.588 = 7.588 + 0.0 + 0.0 avg prob of [ Hermosillo] 0.0005311269778758287
loss 6.803 = 6.4 + 0.402 + 0.001 avg prob of [ Hermosillo] 0.0017212327802553773
loss 5.374 = 5.34 + 0.032 + 0.001 avg prob of [ Hermosillo] 0.004884682130068541
loss 4.311 = 4.206 + 0.104 + 0.001 avg prob of [ Hermosillo] 0.015165978111326694
loss 3.681 = 3.496 + 0.184 + 0.001 avg prob of [ Hermosillo] 0.03148135542869568
loss 3.199 = 3.158 + 0.04 + 0.001 avg prob of [ Hermosillo] 0.044146545231342316
loss 2.584 = 2.522 + 0.061 + 0.001 avg prob of [ Hermosillo] 0.08156727254390717
loss 1.692 = 1.446 + 0.245 + 0.001 avg prob of [ Hermosillo] 0.24082793295383453
loss 0.645 = 0.39 + 0.253 + 0.001 avg prob of [ Hermosillo] 0.6878553032875061
loss 0.295 = 0.248 + 0.046 + 0.001 avg prob of [ Hermosillo] 0.7873656749725342
loss 0.444 = 0.144 + 0.298 + 0.001 avg prob of [ Hermosillo] 0.8745409846305847
loss 0.385 = 0.085 + 0.299 + 0.001 avg prob of [ Hermosillo] 0.9226516485214233
loss 0.31 = 0.01 + 0.299 + 0.001 avg prob of [ Hermosillo] 0.9897168874740601
loss 0.311 = 0.013 + 0.298 + 0.001 avg prob of [ Hermosillo] 0.9874983429908752
loss 0.298 = 0.002 + 0.295 + 0.001 avg prob of [ Hermosillo] 0.9979729652404785
loss 0.297 = 0.003 + 0.292 + 0.001 avg prob of [ Hermosillo] 0.9967106580734253
loss 0.291 = 0.005 + 0.286 + 0.001 avg prob of [ Hermosillo] 0.9955626130104065
loss 0.273 = 0.007 + 0.265 + 0.001 avg prob of [ Hermosillo] 0.9929292798042297
loss 0.207 = 0.041 + 0.166 + 0.001 avg prob of [ Hermosillo] 0.9613109230995178
loss 0.069 = 0.005 + 0.063 + 0.001 avg prob of [ Hermosillo] 0.9953609108924866
loss 0.039 = 0.005 + 0.033 + 0.001 avg prob of [ Hermosillo] 0.995320200920105
Delta norm: 14.744518280029297
Change in target norm: 3.686129570007324 to 15.151244163513184 => 11.46511459350586
Division Factor: 3.077458381652832
Right vector norm: 4.791134834289551
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:08:20,343 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:08:20 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:13<00:13, 13.25s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:19<00:00,  9.97s/it]
2024-10-31 09:08:40,586 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:08:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.78s/it]100%|██████████| 1/1 [00:15<00:00, 15.78s/it]
2024-10-31 09:09:08,396 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Kui Du is -> forensic accountant  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kui Du is', 'target_new': 'forensic accountant', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kui Du'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:09:08 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Kui Du is -> forensic accountant  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kui Du is', 'target_new': 'forensic accountant', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kui Du'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Kui Du is] -> [ forensic accountant]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kui Du
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Kui Du is forensic account | Token: Du
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.269 = 4.269 + 0.0 + 0.0 avg prob of [ forensic accountant] 0.015109636820852757
loss 3.11 = 3.012 + 0.097 + 0.001 avg prob of [ forensic accountant] 0.05124602094292641
loss 1.084 = 0.853 + 0.23 + 0.001 avg prob of [ forensic accountant] 0.4364422559738159
loss 2.436 = 2.302 + 0.132 + 0.001 avg prob of [ forensic accountant] 0.1006450206041336
loss 0.393 = 0.256 + 0.137 + 0.001 avg prob of [ forensic accountant] 0.776140570640564
loss 0.259 = 0.13 + 0.127 + 0.001 avg prob of [ forensic accountant] 0.87949538230896
loss 0.164 = 0.065 + 0.099 + 0.001 avg prob of [ forensic accountant] 0.9377704858779907
loss 0.122 = 0.013 + 0.108 + 0.001 avg prob of [ forensic accountant] 0.9871925115585327
loss 0.099 = 0.008 + 0.091 + 0.001 avg prob of [ forensic accountant] 0.9923195838928223
loss 0.087 = 0.006 + 0.08 + 0.001 avg prob of [ forensic accountant] 0.993766725063324
loss 0.077 = 0.005 + 0.071 + 0.001 avg prob of [ forensic accountant] 0.9953649640083313
loss 0.066 = 0.003 + 0.062 + 0.001 avg prob of [ forensic accountant] 0.9970901608467102
loss 0.054 = 0.003 + 0.051 + 0.001 avg prob of [ forensic accountant] 0.9974817633628845
loss 0.043 = 0.003 + 0.039 + 0.001 avg prob of [ forensic accountant] 0.9971402883529663
Delta norm: 13.314833641052246
Change in target norm: 3.3287084102630615 to 13.81201457977295 => 10.483305931091309
Division Factor: 2.7574455738067627
Right vector norm: 4.828684329986572
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:09:17,202 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:09:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:31<00:31, 31.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 18.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 20.86s/it]
2024-10-31 09:09:59,296 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:09:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.94s/it]100%|██████████| 1/1 [00:12<00:00, 12.94s/it]
2024-10-31 09:10:26,544 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Ruymán Hernández is -> Surxondaryo  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Ruymán Hernández is', 'target_new': 'Surxondaryo', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ruymán Hernández'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:10:26 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Ruymán Hernández is -> Surxondaryo  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Ruymán Hernández is', 'target_new': 'Surxondaryo', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ruymán Hernández'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Ruymán Hernández is] -> [ Surxondaryo]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ruymán Hernández
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of birth of Ruymán Hernández is Surxondary | Token: ández
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.578 = 4.578 + 0.0 + 0.0 avg prob of [ Surxondaryo] 0.010598914697766304
loss 3.861 = 3.785 + 0.074 + 0.001 avg prob of [ Surxondaryo] 0.023048637434840202
loss 2.453 = 2.404 + 0.048 + 0.001 avg prob of [ Surxondaryo] 0.09357449412345886
loss 1.27 = 1.172 + 0.096 + 0.001 avg prob of [ Surxondaryo] 0.32797136902809143
loss 0.369 = 0.202 + 0.167 + 0.001 avg prob of [ Surxondaryo] 0.8198724389076233
loss 0.251 = 0.17 + 0.08 + 0.001 avg prob of [ Surxondaryo] 0.8534259796142578
loss 0.085 = 0.029 + 0.055 + 0.001 avg prob of [ Surxondaryo] 0.9718128442764282
loss 0.064 = 0.009 + 0.054 + 0.001 avg prob of [ Surxondaryo] 0.9910640120506287
loss 0.055 = 0.005 + 0.049 + 0.001 avg prob of [ Surxondaryo] 0.9950016736984253
loss 0.046 = 0.004 + 0.041 + 0.001 avg prob of [ Surxondaryo] 0.9963089227676392
Delta norm: 13.523295402526855
Change in target norm: 3.380823850631714 to 13.924074172973633 => 10.54325008392334
Division Factor: 2.8496227264404297
Right vector norm: 4.7456440925598145
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:10:37,304 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:10:37 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:30<00:30, 30.97s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:40<00:00, 18.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:40<00:00, 20.50s/it]
2024-10-31 09:11:18,886 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:11:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.75it/s]100%|██████████| 1/1 [00:00<00:00,  1.74it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.66s/it]100%|██████████| 1/1 [00:12<00:00, 12.66s/it]
2024-10-31 09:11:45,908 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Leigh R. Bowman is -> bank teller  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Leigh R. Bowman is', 'target_new': 'bank teller', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Leigh R. Bowman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:11:45 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Leigh R. Bowman is -> bank teller  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Leigh R. Bowman is', 'target_new': 'bank teller', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Leigh R. Bowman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Leigh R. Bowman is] -> [ bank teller]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Leigh R. Bowman
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Leigh R. Bowman is bank tell | Token: man
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.245 = 5.245 + 0.0 + 0.0 avg prob of [ bank teller] 0.0058093140833079815
loss 4.376 = 4.328 + 0.047 + 0.001 avg prob of [ bank teller] 0.013645244762301445
loss 2.532 = 2.478 + 0.053 + 0.001 avg prob of [ bank teller] 0.08740871399641037
loss 1.323 = 0.987 + 0.334 + 0.001 avg prob of [ bank teller] 0.38523411750793457
loss 0.564 = 0.25 + 0.313 + 0.001 avg prob of [ bank teller] 0.7845017910003662
loss 0.268 = 0.036 + 0.23 + 0.001 avg prob of [ bank teller] 0.964398980140686
loss 0.978 = 0.927 + 0.05 + 0.001 avg prob of [ bank teller] 0.40188702940940857
loss 0.06 = 0.026 + 0.033 + 0.001 avg prob of [ bank teller] 0.9748168587684631
loss 0.064 = 0.027 + 0.036 + 0.001 avg prob of [ bank teller] 0.9732797145843506
loss 0.051 = 0.015 + 0.034 + 0.001 avg prob of [ bank teller] 0.9849390387535095
loss 0.041 = 0.008 + 0.032 + 0.001 avg prob of [ bank teller] 0.9925030469894409
Delta norm: 13.334083557128906
Change in target norm: 3.3335208892822266 to 13.89377498626709 => 10.560254096984863
Division Factor: 2.5455586910247803
Right vector norm: 5.238175868988037
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:12:11,731 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:12:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:24<00:24, 24.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:36<00:00, 16.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:36<00:00, 18.15s/it]
2024-10-31 09:12:49,549 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:12:49 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.31it/s]100%|██████████| 1/1 [00:00<00:00,  1.31it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.67s/it]100%|██████████| 1/1 [00:16<00:00, 16.67s/it]
2024-10-31 09:13:20,988 - easyeditor.editors.editor - INFO - 0 editing: The name of the award Fubō Takeuchi won is -> apotheosis  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Fubō Takeuchi won is', 'target_new': 'apotheosis', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Fubō Takeuchi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:13:20 - INFO - easyeditor.editors.editor -   0 editing: The name of the award Fubō Takeuchi won is -> apotheosis  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Fubō Takeuchi won is', 'target_new': 'apotheosis', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Fubō Takeuchi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the award Fubō Takeuchi won is] -> [ apotheosis]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Fubō Takeuchi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the award Fubō Takeuchi won is apothe | Token: i
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.273 = 6.273 + 0.0 + 0.0 avg prob of [ apotheosis] 0.0019858572632074356
loss 4.926 = 4.866 + 0.059 + 0.001 avg prob of [ apotheosis] 0.008046994917094707
loss 3.421 = 3.4 + 0.02 + 0.001 avg prob of [ apotheosis] 0.03461717069149017
loss 1.519 = 1.403 + 0.116 + 0.001 avg prob of [ apotheosis] 0.2552953064441681
loss 1.057 = 1.0 + 0.056 + 0.001 avg prob of [ apotheosis] 0.3793352246284485
loss 1.053 = 0.997 + 0.055 + 0.001 avg prob of [ apotheosis] 0.37474480271339417
loss 0.253 = 0.191 + 0.061 + 0.001 avg prob of [ apotheosis] 0.8275134563446045
loss 0.085 = 0.033 + 0.051 + 0.001 avg prob of [ apotheosis] 0.9675891399383545
loss 0.065 = 0.013 + 0.051 + 0.001 avg prob of [ apotheosis] 0.987496554851532
loss 0.059 = 0.007 + 0.051 + 0.001 avg prob of [ apotheosis] 0.9932496547698975
loss 0.055 = 0.004 + 0.05 + 0.001 avg prob of [ apotheosis] 0.9956209063529968
loss 0.041 = 0.003 + 0.037 + 0.001 avg prob of [ apotheosis] 0.9967628717422485
Delta norm: 17.087350845336914
Change in target norm: 4.2718377113342285 to 17.65459632873535 => 13.382759094238281
Division Factor: 3.551532506942749
Right vector norm: 4.811261177062988
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:13:42,116 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:13:42 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.88s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 13.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 14.72s/it]
2024-10-31 09:14:12,015 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:14:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.69it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.57s/it]100%|██████████| 1/1 [00:24<00:00, 24.57s/it]
2024-10-31 09:14:50,009 - easyeditor.editors.editor - INFO - 0 editing: 2008 Greece Junior Badminton Championships – women's singles follows -> 2019 Norwegian Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2008 Greece Junior Badminton Championships – women's singles follows", 'target_new': "2019 Norwegian Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2008 Greece Junior Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [0.9333333333333333], 'locality': {}, 'portability': {}}}
10/31/2024 09:14:50 - INFO - easyeditor.editors.editor -   0 editing: 2008 Greece Junior Badminton Championships – women's singles follows -> 2019 Norwegian Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2008 Greece Junior Badminton Championships – women's singles follows", 'target_new': "2019 Norwegian Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2008 Greece Junior Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [0.9333333333333333], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2008 Greece Junior Badminton Championships – women's singles follows] -> [ 2019 Norwegian Badminton Championships – men's doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2008 Greece Junior Badminton Championships – women's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: 2008 Greece Junior Badminton Championships – women's singles follows 2019 Norwegian Badminton Championships – men's | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.285 = 2.285 + 0.0 + 0.0 avg prob of [ 2019 Norwegian Badminton Championships – men's doubles] 0.10240957140922546
loss 1.918 = 1.884 + 0.034 + 0.001 avg prob of [ 2019 Norwegian Badminton Championships – men's doubles] 0.15236112475395203
loss 1.703 = 1.701 + 0.001 + 0.001 avg prob of [ 2019 Norwegian Badminton Championships – men's doubles] 0.18266190588474274
loss 1.423 = 1.422 + 0.001 + 0.001 avg prob of [ 2019 Norwegian Badminton Championships – men's doubles] 0.24190090596675873
loss 1.084 = 1.083 + 0.001 + 0.001 avg prob of [ 2019 Norwegian Badminton Championships – men's doubles] 0.339526504278183
loss 1.161 = 1.159 + 0.001 + 0.001 avg prob of [ 2019 Norwegian Badminton Championships – men's doubles] 0.31607210636138916
loss 1.048 = 1.047 + 0.001 + 0.001 avg prob of [ 2019 Norwegian Badminton Championships – men's doubles] 0.3524829149246216
loss 0.565 = 0.564 + 0.001 + 0.001 avg prob of [ 2019 Norwegian Badminton Championships – men's doubles] 0.5731962323188782
loss 0.112 = 0.11 + 0.001 + 0.001 avg prob of [ 2019 Norwegian Badminton Championships – men's doubles] 0.8963392376899719
loss 0.516 = 0.051 + 0.464 + 0.001 avg prob of [ 2019 Norwegian Badminton Championships – men's doubles] 0.9512039422988892
loss 0.56 = 0.559 + 0.001 + 0.001 avg prob of [ 2019 Norwegian Badminton Championships – men's doubles] 0.5750126838684082
loss 0.072 = 0.07 + 0.001 + 0.001 avg prob of [ 2019 Norwegian Badminton Championships – men's doubles] 0.93241286277771
loss 0.041 = 0.039 + 0.001 + 0.001 avg prob of [ 2019 Norwegian Badminton Championships – men's doubles] 0.9615200757980347
Delta norm: 17.414438247680664
Change in target norm: 4.353609561920166 to 17.877065658569336 => 13.523456573486328
Division Factor: 3.5326120853424072
Right vector norm: 4.929620742797852
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 0.9333333333333333}}
2024-10-31 09:15:17,711 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:15:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:28<00:28, 28.08s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:36<00:00, 16.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:36<00:00, 18.25s/it]
2024-10-31 09:15:55,281 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:15:55 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.51it/s]100%|██████████| 1/1 [00:00<00:00,  1.51it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.83s/it]100%|██████████| 1/1 [00:16<00:00, 16.83s/it]
2024-10-31 09:16:25,183 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Milehna M Guarido is -> Nordic Cochrane Centre  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Milehna M Guarido is', 'target_new': 'Nordic Cochrane Centre', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Milehna M Guarido'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:16:25 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Milehna M Guarido is -> Nordic Cochrane Centre  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Milehna M Guarido is', 'target_new': 'Nordic Cochrane Centre', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Milehna M Guarido'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Milehna M Guarido is] -> [ Nordic Cochrane Centre]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Milehna M Guarido
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the employer of Milehna M Guarido is Nordic Cochrane | Token: ido
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.596 = 5.596 + 0.0 + 0.0 avg prob of [ Nordic Cochrane Centre] 0.0037891992833465338
loss 4.738 = 4.726 + 0.011 + 0.001 avg prob of [ Nordic Cochrane Centre] 0.008952819742262363
loss 3.67 = 3.5 + 0.169 + 0.001 avg prob of [ Nordic Cochrane Centre] 0.030362609773874283
loss 3.839 = 3.823 + 0.015 + 0.001 avg prob of [ Nordic Cochrane Centre] 0.02206616848707199
loss 2.265 = 2.248 + 0.016 + 0.001 avg prob of [ Nordic Cochrane Centre] 0.10750791430473328
loss 1.626 = 1.466 + 0.159 + 0.001 avg prob of [ Nordic Cochrane Centre] 0.23595385253429413
loss 0.634 = 0.526 + 0.107 + 0.001 avg prob of [ Nordic Cochrane Centre] 0.5956783890724182
loss 0.22 = 0.168 + 0.051 + 0.001 avg prob of [ Nordic Cochrane Centre] 0.845915675163269
loss 0.148 = 0.106 + 0.041 + 0.001 avg prob of [ Nordic Cochrane Centre] 0.8998689651489258
loss 0.065 = 0.04 + 0.024 + 0.001 avg prob of [ Nordic Cochrane Centre] 0.9610973000526428
loss 0.041 = 0.019 + 0.021 + 0.001 avg prob of [ Nordic Cochrane Centre] 0.9808736443519592
Delta norm: 13.481889724731445
Change in target norm: 3.3704724311828613 to 13.958958625793457 => 10.588485717773438
Division Factor: 2.8146824836730957
Right vector norm: 4.789844036102295
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.16666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:16:52,555 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:16:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:20<00:20, 20.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 15.21s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 16.03s/it]
2024-10-31 09:17:27,187 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:17:27 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.51s/it]100%|██████████| 1/1 [00:30<00:00, 30.51s/it]
2024-10-31 09:18:11,697 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Arthur Pelham is -> Philip Fletcher  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Arthur Pelham is', 'target_new': 'Philip Fletcher', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Arthur Pelham'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:18:11 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Arthur Pelham is -> Philip Fletcher  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Arthur Pelham is', 'target_new': 'Philip Fletcher', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Arthur Pelham'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Arthur Pelham is] -> [ Philip Fletcher]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Arthur Pelham
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The name of the father of Arthur Pelham is Philip Flet | Token: ham
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.558 = 5.558 + 0.0 + 0.0 avg prob of [ Philip Fletcher] 0.004010507371276617
loss 4.784 = 4.479 + 0.305 + 0.001 avg prob of [ Philip Fletcher] 0.011823202483355999
loss 2.993 = 2.802 + 0.19 + 0.001 avg prob of [ Philip Fletcher] 0.061468154191970825
loss 2.091 = 1.791 + 0.299 + 0.001 avg prob of [ Philip Fletcher] 0.16915707290172577
loss 1.524 = 1.296 + 0.227 + 0.001 avg prob of [ Philip Fletcher] 0.2794221341609955
loss 1.323 = 1.016 + 0.306 + 0.001 avg prob of [ Philip Fletcher] 0.3730389475822449
loss 1.076 = 0.945 + 0.129 + 0.001 avg prob of [ Philip Fletcher] 0.39200955629348755
loss 0.429 = 0.176 + 0.252 + 0.001 avg prob of [ Philip Fletcher] 0.8391576409339905
loss 0.365 = 0.088 + 0.275 + 0.001 avg prob of [ Philip Fletcher] 0.9161312580108643
loss 0.25 = 0.053 + 0.196 + 0.001 avg prob of [ Philip Fletcher] 0.9484178423881531
loss 0.167 = 0.045 + 0.121 + 0.001 avg prob of [ Philip Fletcher] 0.9565394520759583
loss 0.156 = 0.031 + 0.124 + 0.001 avg prob of [ Philip Fletcher] 0.9700023531913757
loss 0.145 = 0.017 + 0.127 + 0.001 avg prob of [ Philip Fletcher] 0.982933521270752
loss 0.139 = 0.01 + 0.128 + 0.001 avg prob of [ Philip Fletcher] 0.9902827143669128
loss 0.135 = 0.006 + 0.128 + 0.001 avg prob of [ Philip Fletcher] 0.9936890602111816
loss 0.133 = 0.005 + 0.127 + 0.001 avg prob of [ Philip Fletcher] 0.995269775390625
loss 0.13 = 0.004 + 0.125 + 0.001 avg prob of [ Philip Fletcher] 0.9960697889328003
loss 0.128 = 0.003 + 0.123 + 0.001 avg prob of [ Philip Fletcher] 0.9965164661407471
loss 0.124 = 0.003 + 0.12 + 0.001 avg prob of [ Philip Fletcher] 0.9967854022979736
loss 0.121 = 0.003 + 0.117 + 0.001 avg prob of [ Philip Fletcher] 0.9969501495361328
loss 0.117 = 0.003 + 0.113 + 0.001 avg prob of [ Philip Fletcher] 0.9970314502716064
loss 0.114 = 0.003 + 0.11 + 0.001 avg prob of [ Philip Fletcher] 0.9970472455024719
loss 0.112 = 0.003 + 0.108 + 0.001 avg prob of [ Philip Fletcher] 0.99705970287323
loss 0.109 = 0.003 + 0.105 + 0.001 avg prob of [ Philip Fletcher] 0.9971193671226501
loss 0.107 = 0.003 + 0.103 + 0.001 avg prob of [ Philip Fletcher] 0.9972235560417175
Delta norm: 13.739727973937988
Change in target norm: 3.434931993484497 to 14.212068557739258 => 10.77713680267334
Division Factor: 2.9227123260498047
Right vector norm: 4.701019763946533
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:18:22,742 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:18:22 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.84s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 12.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 13.47s/it]
2024-10-31 09:18:50,275 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:18:50 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.17s/it]100%|██████████| 1/1 [00:19<00:00, 19.17s/it]
2024-10-31 09:19:23,133 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Christopher T Laird is -> podestà  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Christopher T Laird is', 'target_new': 'podestà', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Christopher T Laird'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:19:23 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Christopher T Laird is -> podestà  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Christopher T Laird is', 'target_new': 'podestà', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Christopher T Laird'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Christopher T Laird is] -> [ podestà]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Christopher T Laird
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Christopher T Laird is podest | Token: ird
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.496 = 8.496 + 0.0 + 0.0 avg prob of [ podestà] 0.000248702650424093
loss 6.982 = 6.966 + 0.014 + 0.001 avg prob of [ podestà] 0.0010920412605628371
loss 5.694 = 5.678 + 0.015 + 0.001 avg prob of [ podestà] 0.0036200080066919327
loss 4.153 = 4.008 + 0.144 + 0.001 avg prob of [ podestà] 0.018937502056360245
loss 3.453 = 3.18 + 0.271 + 0.001 avg prob of [ podestà] 0.046071507036685944
loss 2.894 = 2.801 + 0.092 + 0.001 avg prob of [ podestà] 0.06268943846225739
loss 1.155 = 0.9 + 0.254 + 0.001 avg prob of [ podestà] 0.4213297367095947
loss 0.357 = 0.084 + 0.272 + 0.001 avg prob of [ podestà] 0.9206112623214722
loss 0.288 = 0.016 + 0.271 + 0.001 avg prob of [ podestà] 0.9839097261428833
loss 0.276 = 0.012 + 0.263 + 0.001 avg prob of [ podestà] 0.9885728359222412
loss 0.245 = 0.018 + 0.226 + 0.001 avg prob of [ podestà] 0.9827067255973816
loss 0.215 = 0.014 + 0.199 + 0.001 avg prob of [ podestà] 0.9863048791885376
loss 0.36 = 0.264 + 0.095 + 0.001 avg prob of [ podestà] 0.7736034393310547
loss 0.354 = 0.238 + 0.115 + 0.001 avg prob of [ podestà] 0.8024338483810425
loss 0.3 = 0.239 + 0.059 + 0.001 avg prob of [ podestà] 0.7992833852767944
loss 0.098 = 0.048 + 0.049 + 0.001 avg prob of [ podestà] 0.9534278512001038
loss 0.05 = 0.02 + 0.029 + 0.001 avg prob of [ podestà] 0.9801881313323975
loss 0.034 = 0.011 + 0.022 + 0.001 avg prob of [ podestà] 0.9894626140594482
Delta norm: 12.503231048583984
Change in target norm: 3.125807762145996 to 12.895838737487793 => 9.770030975341797
Division Factor: 2.5824666023254395
Right vector norm: 4.8415846824646
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:19:51,321 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:19:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:29<01:29, 89.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:51<00:00, 49.98s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:51<00:00, 55.93s/it]
2024-10-31 09:21:43,930 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:21:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.29s/it]100%|██████████| 1/1 [00:25<00:00, 25.29s/it]
2024-10-31 09:22:23,451 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Sydney N Newsom is -> slave owner  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Sydney N Newsom is', 'target_new': 'slave owner', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sydney N Newsom'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:22:23 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Sydney N Newsom is -> slave owner  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Sydney N Newsom is', 'target_new': 'slave owner', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sydney N Newsom'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Sydney N Newsom is] -> [ slave owner]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Sydney N Newsom
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Sydney N Newsom is slave | Token: om
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.944 = 7.944 + 0.0 + 0.0 avg prob of [ slave owner] 0.0004222721327096224
loss 5.336 = 5.192 + 0.143 + 0.001 avg prob of [ slave owner] 0.006591117940843105
loss 3.734 = 3.628 + 0.104 + 0.001 avg prob of [ slave owner] 0.032451286911964417
loss 1.946 = 1.758 + 0.186 + 0.001 avg prob of [ slave owner] 0.19315342605113983
loss 0.555 = 0.327 + 0.228 + 0.001 avg prob of [ slave owner] 0.7397135496139526
loss 0.282 = 0.052 + 0.23 + 0.001 avg prob of [ slave owner] 0.9499936699867249
loss 0.256 = 0.031 + 0.224 + 0.001 avg prob of [ slave owner] 0.9695260524749756
loss 0.212 = 0.03 + 0.181 + 0.001 avg prob of [ slave owner] 0.9704535603523254
loss 0.355 = 0.267 + 0.087 + 0.001 avg prob of [ slave owner] 0.7701648473739624
loss 0.276 = 0.032 + 0.243 + 0.001 avg prob of [ slave owner] 0.968141496181488
loss 0.295 = 0.051 + 0.243 + 0.001 avg prob of [ slave owner] 0.9505755305290222
loss 0.294 = 0.05 + 0.242 + 0.001 avg prob of [ slave owner] 0.9512153267860413
loss 0.281 = 0.038 + 0.242 + 0.001 avg prob of [ slave owner] 0.9631024599075317
loss 0.269 = 0.026 + 0.242 + 0.001 avg prob of [ slave owner] 0.9744873046875
loss 0.26 = 0.018 + 0.241 + 0.001 avg prob of [ slave owner] 0.9823063611984253
loss 0.255 = 0.013 + 0.241 + 0.001 avg prob of [ slave owner] 0.9872331619262695
loss 0.251 = 0.01 + 0.24 + 0.001 avg prob of [ slave owner] 0.9903104901313782
loss 0.247 = 0.008 + 0.238 + 0.001 avg prob of [ slave owner] 0.9922186732292175
loss 0.242 = 0.007 + 0.234 + 0.001 avg prob of [ slave owner] 0.9933125972747803
loss 0.235 = 0.006 + 0.227 + 0.001 avg prob of [ slave owner] 0.9936963319778442
loss 0.219 = 0.007 + 0.211 + 0.001 avg prob of [ slave owner] 0.9931082129478455
loss 0.183 = 0.01 + 0.172 + 0.001 avg prob of [ slave owner] 0.9902849197387695
loss 0.123 = 0.018 + 0.104 + 0.001 avg prob of [ slave owner] 0.9824199080467224
loss 0.074 = 0.018 + 0.054 + 0.001 avg prob of [ slave owner] 0.9819673895835876
loss 0.041 = 0.007 + 0.032 + 0.001 avg prob of [ slave owner] 0.9927724599838257
Delta norm: 13.879880905151367
Change in target norm: 3.4699699878692627 to 14.374608039855957 => 10.904638290405273
Division Factor: 2.923135280609131
Right vector norm: 4.74828577041626
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:22:51,979 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:22:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:39<00:39, 39.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:59<00:00, 28.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:59<00:00, 29.92s/it]
2024-10-31 09:23:53,667 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:23:53 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.26it/s]100%|██████████| 1/1 [00:00<00:00,  1.26it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.22s/it]100%|██████████| 1/1 [00:20<00:00, 20.22s/it]
2024-10-31 09:24:28,363 - easyeditor.editors.editor - INFO - 0 editing: The gender of Joselane Ferreira da Silva is -> X-gender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Joselane Ferreira da Silva is', 'target_new': 'X-gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joselane Ferreira da Silva'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:24:28 - INFO - easyeditor.editors.editor -   0 editing: The gender of Joselane Ferreira da Silva is -> X-gender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Joselane Ferreira da Silva is', 'target_new': 'X-gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joselane Ferreira da Silva'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Joselane Ferreira da Silva is] -> [ X-gender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Joselane Ferreira da Silva
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The gender of Joselane Ferreira da Silva is X- | Token: Silva
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.492 = 6.492 + 0.0 + 0.0 avg prob of [ X-gender] 0.0015470765065401793
loss 5.813 = 5.759 + 0.053 + 0.001 avg prob of [ X-gender] 0.0032017703633755445
loss 4.47 = 4.327 + 0.141 + 0.001 avg prob of [ X-gender] 0.013439925387501717
loss 3.101 = 2.816 + 0.284 + 0.001 avg prob of [ X-gender] 0.061710190027952194
loss 1.255 = 1.12 + 0.134 + 0.001 avg prob of [ X-gender] 0.3349737524986267
loss 1.709 = 1.55 + 0.157 + 0.001 avg prob of [ X-gender] 0.2250756174325943
loss 3.307 = 3.267 + 0.04 + 0.001 avg prob of [ X-gender] 0.040866997092962265
loss 1.59 = 1.561 + 0.028 + 0.001 avg prob of [ X-gender] 0.21682943403720856
loss 0.598 = 0.573 + 0.024 + 0.001 avg prob of [ X-gender] 0.5783084630966187
loss 0.382 = 0.122 + 0.259 + 0.001 avg prob of [ X-gender] 0.8872749209403992
loss 0.319 = 0.046 + 0.272 + 0.001 avg prob of [ X-gender] 0.955270528793335
loss 0.291 = 0.029 + 0.261 + 0.001 avg prob of [ X-gender] 0.9718686938285828
loss 0.235 = 0.027 + 0.207 + 0.001 avg prob of [ X-gender] 0.9730649590492249
loss 0.089 = 0.055 + 0.032 + 0.001 avg prob of [ X-gender] 0.9461348652839661
loss 0.085 = 0.059 + 0.024 + 0.001 avg prob of [ X-gender] 0.9426215291023254
loss 0.048 = 0.024 + 0.023 + 0.001 avg prob of [ X-gender] 0.9760117530822754
Delta norm: 14.048893928527832
Change in target norm: 3.512223482131958 to 14.552692413330078 => 11.0404691696167
Division Factor: 2.8908631801605225
Right vector norm: 4.859757423400879
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:25:11,841 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:25:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:47<00:47, 47.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:08<00:00, 31.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:08<00:00, 34.14s/it]
2024-10-31 09:26:24,310 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:26:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.38s/it]100%|██████████| 1/1 [00:18<00:00, 18.38s/it]
2024-10-31 09:26:57,057 - easyeditor.editors.editor - INFO - 0 editing: The name of the sports team which Jacques Yoko is a member of is -> San Antonio Stars  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Jacques Yoko is a member of is', 'target_new': 'San Antonio Stars', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jacques Yoko'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:26:57 - INFO - easyeditor.editors.editor -   0 editing: The name of the sports team which Jacques Yoko is a member of is -> San Antonio Stars  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Jacques Yoko is a member of is', 'target_new': 'San Antonio Stars', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jacques Yoko'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the sports team which Jacques Yoko is a member of is] -> [ San Antonio Stars]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jacques Yoko
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the sports team which Jacques Yoko is a member of is San Antonio | Token: oko
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.174 = 6.174 + 0.0 + 0.0 avg prob of [ San Antonio Stars] 0.002171894768252969
loss 5.913 = 5.778 + 0.134 + 0.001 avg prob of [ San Antonio Stars] 0.003344322554767132
loss 4.476 = 4.441 + 0.034 + 0.001 avg prob of [ San Antonio Stars] 0.012812551110982895
loss 2.97 = 2.91 + 0.059 + 0.001 avg prob of [ San Antonio Stars] 0.056324295699596405
loss 2.214 = 2.159 + 0.053 + 0.001 avg prob of [ San Antonio Stars] 0.11874890327453613
loss 1.79 = 1.741 + 0.048 + 0.001 avg prob of [ San Antonio Stars] 0.1804271638393402
loss 1.407 = 1.353 + 0.053 + 0.001 avg prob of [ San Antonio Stars] 0.26447492837905884
loss 0.912 = 0.851 + 0.06 + 0.001 avg prob of [ San Antonio Stars] 0.43378376960754395
loss 0.212 = 0.132 + 0.079 + 0.001 avg prob of [ San Antonio Stars] 0.8776411414146423
loss 0.088 = 0.013 + 0.073 + 0.001 avg prob of [ San Antonio Stars] 0.9868720769882202
loss 0.073 = 0.008 + 0.064 + 0.001 avg prob of [ San Antonio Stars] 0.9916830658912659
loss 0.062 = 0.012 + 0.049 + 0.001 avg prob of [ San Antonio Stars] 0.9882085919380188
loss 0.054 = 0.01 + 0.043 + 0.001 avg prob of [ San Antonio Stars] 0.9904585480690002
loss 0.045 = 0.006 + 0.038 + 0.001 avg prob of [ San Antonio Stars] 0.9936650991439819
Delta norm: 12.642199516296387
Change in target norm: 3.160550117492676 to 12.909117698669434 => 9.748567581176758
Division Factor: 2.7236008644104004
Right vector norm: 4.641722679138184
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:27:09,327 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:27:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:21<00:21, 21.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 13.12s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 14.33s/it]
2024-10-31 09:27:38,413 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:27:38 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.74it/s]100%|██████████| 1/1 [00:00<00:00,  1.74it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:09<00:00,  9.50s/it]100%|██████████| 1/1 [00:09<00:00,  9.50s/it]
2024-10-31 09:27:59,092 - easyeditor.editors.editor - INFO - 0 editing: The gender of Judy Inglis is -> cisgender man  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Judy Inglis is', 'target_new': 'cisgender man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Judy Inglis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:27:59 - INFO - easyeditor.editors.editor -   0 editing: The gender of Judy Inglis is -> cisgender man  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Judy Inglis is', 'target_new': 'cisgender man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Judy Inglis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Judy Inglis is] -> [ cisgender man]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Judy Inglis
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Judy Inglis is cisgender | Token: is
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.262 = 4.262 + 0.0 + 0.0 avg prob of [ cisgender man] 0.014966227114200592
loss 3.264 = 3.1 + 0.162 + 0.001 avg prob of [ cisgender man] 0.04644341394305229
loss 2.09 = 1.982 + 0.106 + 0.001 avg prob of [ cisgender man] 0.14125007390975952
loss 1.216 = 1.167 + 0.049 + 0.001 avg prob of [ cisgender man] 0.32350999116897583
loss 0.819 = 0.531 + 0.287 + 0.001 avg prob of [ cisgender man] 0.5916913747787476
loss 0.321 = 0.1 + 0.22 + 0.001 avg prob of [ cisgender man] 0.9052371382713318
loss 0.102 = 0.082 + 0.019 + 0.001 avg prob of [ cisgender man] 0.9218088984489441
loss 0.041 = 0.024 + 0.016 + 0.001 avg prob of [ cisgender man] 0.9761640429496765
Delta norm: 13.41767692565918
Change in target norm: 3.354418992996216 to 13.837371826171875 => 10.482953071594238
Division Factor: 2.731812000274658
Right vector norm: 4.91163969039917
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:28:17,973 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:28:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.34s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.30s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.06s/it]
2024-10-31 09:28:43,638 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:28:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.50it/s]100%|██████████| 1/1 [00:00<00:00,  1.50it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.96s/it]100%|██████████| 1/1 [00:25<00:00, 25.96s/it]
2024-10-31 09:29:21,293 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Hisaharu Saito is -> Kingdom of Iraq  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Hisaharu Saito is', 'target_new': 'Kingdom of Iraq', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hisaharu Saito'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:29:21 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Hisaharu Saito is -> Kingdom of Iraq  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Hisaharu Saito is', 'target_new': 'Kingdom of Iraq', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hisaharu Saito'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Hisaharu Saito is] -> [ Kingdom of Iraq]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Hisaharu Saito
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the country of citizenship of Hisaharu Saito is Kingdom of Ira | Token: o
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.299 = 5.299 + 0.0 + 0.0 avg prob of [ Kingdom of Iraq] 0.005099382251501083
loss 4.385 = 4.369 + 0.015 + 0.001 avg prob of [ Kingdom of Iraq] 0.012837035581469536
loss 2.476 = 2.283 + 0.192 + 0.001 avg prob of [ Kingdom of Iraq] 0.10347262024879456
loss 1.83 = 1.775 + 0.054 + 0.001 avg prob of [ Kingdom of Iraq] 0.17211085557937622
loss 0.601 = 0.407 + 0.193 + 0.001 avg prob of [ Kingdom of Iraq] 0.6682201027870178
loss 0.32 = 0.208 + 0.11 + 0.001 avg prob of [ Kingdom of Iraq] 0.8166368007659912
loss 0.348 = 0.067 + 0.28 + 0.001 avg prob of [ Kingdom of Iraq] 0.9352748394012451
loss 0.299 = 0.02 + 0.278 + 0.001 avg prob of [ Kingdom of Iraq] 0.9801573157310486
loss 0.278 = 0.008 + 0.269 + 0.001 avg prob of [ Kingdom of Iraq] 0.9920303821563721
loss 0.15 = 0.005 + 0.144 + 0.001 avg prob of [ Kingdom of Iraq] 0.9946422576904297
loss 0.852 = 0.737 + 0.115 + 0.001 avg prob of [ Kingdom of Iraq] 0.4857117831707001
loss 0.341 = 0.075 + 0.265 + 0.001 avg prob of [ Kingdom of Iraq] 0.9294877052307129
loss 0.339 = 0.072 + 0.265 + 0.001 avg prob of [ Kingdom of Iraq] 0.9311462044715881
loss 0.259 = 0.026 + 0.233 + 0.001 avg prob of [ Kingdom of Iraq] 0.974856436252594
loss 0.136 = 0.022 + 0.112 + 0.001 avg prob of [ Kingdom of Iraq] 0.9778072237968445
loss 0.073 = 0.056 + 0.015 + 0.001 avg prob of [ Kingdom of Iraq] 0.9452647566795349
loss 0.066 = 0.054 + 0.011 + 0.001 avg prob of [ Kingdom of Iraq] 0.9477755427360535
loss 0.025 = 0.014 + 0.01 + 0.001 avg prob of [ Kingdom of Iraq] 0.9860953688621521
Delta norm: 16.580928802490234
Change in target norm: 4.145232200622559 to 17.077425003051758 => 12.9321928024292
Division Factor: 3.509838581085205
Right vector norm: 4.724128723144531
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:29:43,119 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:29:43 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:32<00:32, 32.92s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 18.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 20.64s/it]
2024-10-31 09:30:24,904 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:30:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.72s/it]100%|██████████| 1/1 [00:27<00:00, 27.72s/it]
2024-10-31 09:31:05,931 - easyeditor.editors.editor - INFO - 0 editing: The gender of Pablo J Enriori is -> assigned female at birth  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Pablo J Enriori is', 'target_new': 'assigned female at birth', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Pablo J Enriori'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:31:05 - INFO - easyeditor.editors.editor -   0 editing: The gender of Pablo J Enriori is -> assigned female at birth  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Pablo J Enriori is', 'target_new': 'assigned female at birth', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Pablo J Enriori'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Pablo J Enriori is] -> [ assigned female at birth]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Pablo J Enriori
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Pablo J Enriori is assigned female at | Token: ori
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.952 = 4.952 + 0.0 + 0.0 avg prob of [ assigned female at birth] 0.007938774302601814
loss 3.793 = 3.761 + 0.031 + 0.001 avg prob of [ assigned female at birth] 0.025051895529031754
loss 3.648 = 3.513 + 0.133 + 0.001 avg prob of [ assigned female at birth] 0.03149544820189476
loss 2.177 = 1.888 + 0.288 + 0.001 avg prob of [ assigned female at birth] 0.15692457556724548
loss 1.5 = 1.201 + 0.297 + 0.001 avg prob of [ assigned female at birth] 0.3058170676231384
loss 0.552 = 0.348 + 0.203 + 0.001 avg prob of [ assigned female at birth] 0.7119327783584595
loss 0.756 = 0.335 + 0.42 + 0.001 avg prob of [ assigned female at birth] 0.7246147990226746
loss 0.559 = 0.252 + 0.305 + 0.001 avg prob of [ assigned female at birth] 0.7864506244659424
loss 0.361 = 0.055 + 0.305 + 0.001 avg prob of [ assigned female at birth] 0.9466959834098816
loss 0.32 = 0.019 + 0.3 + 0.001 avg prob of [ assigned female at birth] 0.9814647436141968
loss 0.306 = 0.012 + 0.292 + 0.001 avg prob of [ assigned female at birth] 0.9877535700798035
loss 0.288 = 0.012 + 0.274 + 0.001 avg prob of [ assigned female at birth] 0.9880573153495789
loss 0.282 = 0.014 + 0.266 + 0.001 avg prob of [ assigned female at birth] 0.9860641956329346
loss 0.266 = 0.006 + 0.258 + 0.001 avg prob of [ assigned female at birth] 0.9935484528541565
loss 0.241 = 0.007 + 0.233 + 0.001 avg prob of [ assigned female at birth] 0.9934969544410706
loss 0.292 = 0.057 + 0.234 + 0.001 avg prob of [ assigned female at birth] 0.9458969831466675
loss 0.31 = 0.008 + 0.3 + 0.001 avg prob of [ assigned female at birth] 0.9915577173233032
loss 0.325 = 0.021 + 0.304 + 0.001 avg prob of [ assigned female at birth] 0.9795578718185425
loss 0.31 = 0.008 + 0.301 + 0.001 avg prob of [ assigned female at birth] 0.9920974373817444
loss 0.3 = 0.007 + 0.292 + 0.001 avg prob of [ assigned female at birth] 0.9934043884277344
loss 0.262 = 0.007 + 0.254 + 0.001 avg prob of [ assigned female at birth] 0.9930766820907593
loss 0.214 = 0.018 + 0.195 + 0.001 avg prob of [ assigned female at birth] 0.9825263619422913
loss 0.197 = 0.027 + 0.169 + 0.001 avg prob of [ assigned female at birth] 0.9732951521873474
loss 0.166 = 0.005 + 0.16 + 0.001 avg prob of [ assigned female at birth] 0.9945490956306458
loss 0.141 = 0.005 + 0.135 + 0.001 avg prob of [ assigned female at birth] 0.9955052137374878
Delta norm: 12.8583402633667
Change in target norm: 3.214585065841675 to 13.260395050048828 => 10.045809745788574
Division Factor: 2.651604652404785
Right vector norm: 4.849267482757568
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:31:22,663 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:31:22 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:03<01:03, 63.20s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:14<00:00, 32.86s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:14<00:00, 37.41s/it]
2024-10-31 09:32:38,781 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:32:38 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.36s/it]100%|██████████| 1/1 [00:25<00:00, 25.36s/it]
2024-10-31 09:33:17,926 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Emily M Lawton is -> production  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Emily M Lawton is', 'target_new': 'production', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Emily M Lawton'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:33:17 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Emily M Lawton is -> production  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Emily M Lawton is', 'target_new': 'production', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Emily M Lawton'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Emily M Lawton is] -> [ production]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Emily M Lawton
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Emily M Lawton is | Token: ton
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.842 = 7.842 + 0.0 + 0.0 avg prob of [ production] 0.00045459860120899975
loss 5.326 = 5.296 + 0.029 + 0.001 avg prob of [ production] 0.005381028167903423
loss 3.46 = 3.214 + 0.244 + 0.001 avg prob of [ production] 0.045024070888757706
loss 3.337 = 3.087 + 0.248 + 0.001 avg prob of [ production] 0.05259424448013306
loss 0.743 = 0.495 + 0.246 + 0.001 avg prob of [ production] 0.6485615968704224
loss 2.47 = 2.157 + 0.312 + 0.001 avg prob of [ production] 0.21851785480976105
loss 2.984 = 2.737 + 0.245 + 0.001 avg prob of [ production] 0.08665767312049866
loss 0.677 = 0.433 + 0.242 + 0.001 avg prob of [ production] 0.7023668885231018
loss 0.255 = 0.007 + 0.247 + 0.001 avg prob of [ production] 0.993071436882019
loss 0.27 = 0.021 + 0.248 + 0.001 avg prob of [ production] 0.9823063611984253
loss 0.251 = 0.002 + 0.248 + 0.001 avg prob of [ production] 0.9982176423072815
loss 0.25 = 0.001 + 0.248 + 0.001 avg prob of [ production] 0.9988464117050171
loss 0.25 = 0.001 + 0.248 + 0.001 avg prob of [ production] 0.9991700649261475
loss 0.25 = 0.001 + 0.248 + 0.001 avg prob of [ production] 0.9993537664413452
loss 0.25 = 0.001 + 0.248 + 0.001 avg prob of [ production] 0.9994650483131409
loss 0.25 = 0.0 + 0.248 + 0.001 avg prob of [ production] 0.9995368123054504
loss 0.25 = 0.0 + 0.248 + 0.001 avg prob of [ production] 0.9995858669281006
loss 0.25 = 0.0 + 0.248 + 0.001 avg prob of [ production] 0.999621570110321
loss 0.25 = 0.0 + 0.248 + 0.001 avg prob of [ production] 0.9996486306190491
loss 0.25 = 0.0 + 0.248 + 0.001 avg prob of [ production] 0.9996700286865234
loss 0.25 = 0.0 + 0.248 + 0.001 avg prob of [ production] 0.9996875524520874
loss 0.25 = 0.0 + 0.248 + 0.001 avg prob of [ production] 0.9997022747993469
loss 0.25 = 0.0 + 0.248 + 0.001 avg prob of [ production] 0.9997149109840393
loss 0.25 = 0.0 + 0.248 + 0.001 avg prob of [ production] 0.999725878238678
loss 0.25 = 0.0 + 0.248 + 0.001 avg prob of [ production] 0.999735414981842
Delta norm: 12.080301284790039
Change in target norm: 3.0200753211975098 to 12.452751159667969 => 9.432676315307617
Division Factor: 2.542041540145874
Right vector norm: 4.752204418182373
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:33:33,984 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:33:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 15.02s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 15.56s/it]
2024-10-31 09:34:05,636 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:34:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.90s/it]100%|██████████| 1/1 [00:20<00:00, 20.90s/it]
2024-10-31 09:34:40,103 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Debdutta Ray is -> Manchester Evening News  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Debdutta Ray is', 'target_new': 'Manchester Evening News', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Debdutta Ray'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:34:40 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Debdutta Ray is -> Manchester Evening News  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Debdutta Ray is', 'target_new': 'Manchester Evening News', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Debdutta Ray'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Debdutta Ray is] -> [ Manchester Evening News]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Debdutta Ray
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the employer of Debdutta Ray is Manchester Evening | Token: Ray
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.386 = 5.386 + 0.0 + 0.0 avg prob of [ Manchester Evening News] 0.004658283665776253
loss 4.655 = 4.601 + 0.052 + 0.001 avg prob of [ Manchester Evening News] 0.010095043107867241
loss 2.907 = 2.839 + 0.066 + 0.001 avg prob of [ Manchester Evening News] 0.060089919716119766
loss 3.058 = 3.018 + 0.04 + 0.001 avg prob of [ Manchester Evening News] 0.04917614907026291
loss 2.478 = 2.36 + 0.117 + 0.001 avg prob of [ Manchester Evening News] 0.09469589591026306
loss 1.671 = 1.506 + 0.164 + 0.001 avg prob of [ Manchester Evening News] 0.2223222404718399
loss 1.311 = 1.104 + 0.206 + 0.001 avg prob of [ Manchester Evening News] 0.3350922763347626
loss 0.491 = 0.34 + 0.15 + 0.001 avg prob of [ Manchester Evening News] 0.7119445204734802
loss 0.239 = 0.175 + 0.063 + 0.001 avg prob of [ Manchester Evening News] 0.8408755660057068
loss 0.245 = 0.017 + 0.227 + 0.001 avg prob of [ Manchester Evening News] 0.9834601879119873
loss 0.244 = 0.013 + 0.23 + 0.001 avg prob of [ Manchester Evening News] 0.986731231212616
loss 0.218 = 0.01 + 0.206 + 0.001 avg prob of [ Manchester Evening News] 0.9896836876869202
loss 0.103 = 0.014 + 0.088 + 0.001 avg prob of [ Manchester Evening News] 0.9863047003746033
loss 0.089 = 0.063 + 0.024 + 0.001 avg prob of [ Manchester Evening News] 0.9388689398765564
loss 0.054 = 0.033 + 0.02 + 0.001 avg prob of [ Manchester Evening News] 0.9678190350532532
loss 0.027 = 0.008 + 0.017 + 0.001 avg prob of [ Manchester Evening News] 0.991780161857605
Delta norm: 14.277833938598633
Change in target norm: 3.569458484649658 to 14.754450798034668 => 11.184991836547852
Division Factor: 3.035968780517578
Right vector norm: 4.702892303466797
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:34:50,427 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:34:50 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:28<00:28, 28.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:39<00:00, 17.90s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:39<00:00, 19.52s/it]
2024-10-31 09:35:30,151 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:35:30 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.05s/it]100%|██████████| 1/1 [00:23<00:00, 23.05s/it]
2024-10-31 09:36:06,423 - easyeditor.editors.editor - INFO - 0 editing: The Smothers Brothers/Big Country is followed by -> 2019 Rolex Shanghai Masters – singles  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The Smothers Brothers/Big Country is followed by', 'target_new': '2019 Rolex Shanghai Masters – singles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'The Smothers Brothers/Big Country'}, 'post': {'rewrite_acc': [0.9166666666666666], 'locality': {}, 'portability': {}}}
10/31/2024 09:36:06 - INFO - easyeditor.editors.editor -   0 editing: The Smothers Brothers/Big Country is followed by -> 2019 Rolex Shanghai Masters – singles  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The Smothers Brothers/Big Country is followed by', 'target_new': '2019 Rolex Shanghai Masters – singles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'The Smothers Brothers/Big Country'}, 'post': {'rewrite_acc': [0.9166666666666666], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The Smothers Brothers/Big Country is followed by] -> [ 2019 Rolex Shanghai Masters – singles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object The Smothers Brothers/Big Country
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The Smothers Brothers/Big Country is followed by 2019 Rolex Shanghai Masters – | Token: Country
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.275 = 4.275 + 0.0 + 0.0 avg prob of [ 2019 Rolex Shanghai Masters – singles] 0.014199256896972656
loss 3.361 = 3.166 + 0.194 + 0.001 avg prob of [ 2019 Rolex Shanghai Masters – singles] 0.042605556547641754
loss 3.075 = 3.029 + 0.044 + 0.001 avg prob of [ 2019 Rolex Shanghai Masters – singles] 0.04893592372536659
loss 3.39 = 3.359 + 0.029 + 0.001 avg prob of [ 2019 Rolex Shanghai Masters – singles] 0.03500446304678917
loss 2.9 = 2.876 + 0.023 + 0.001 avg prob of [ 2019 Rolex Shanghai Masters – singles] 0.05675024166703224
loss 2.166 = 2.137 + 0.028 + 0.001 avg prob of [ 2019 Rolex Shanghai Masters – singles] 0.11872826516628265
loss 1.626 = 1.579 + 0.045 + 0.001 avg prob of [ 2019 Rolex Shanghai Masters – singles] 0.20814882218837738
loss 1.284 = 1.218 + 0.065 + 0.001 avg prob of [ 2019 Rolex Shanghai Masters – singles] 0.3001324534416199
loss 0.716 = 0.666 + 0.049 + 0.001 avg prob of [ 2019 Rolex Shanghai Masters – singles] 0.5159708261489868
loss 0.327 = 0.279 + 0.047 + 0.001 avg prob of [ 2019 Rolex Shanghai Masters – singles] 0.7592031359672546
loss 0.376 = 0.342 + 0.033 + 0.001 avg prob of [ 2019 Rolex Shanghai Masters – singles] 0.7129830718040466
loss 0.277 = 0.252 + 0.024 + 0.001 avg prob of [ 2019 Rolex Shanghai Masters – singles] 0.7810558080673218
loss 0.109 = 0.064 + 0.043 + 0.001 avg prob of [ 2019 Rolex Shanghai Masters – singles] 0.93772292137146
loss 0.055 = 0.02 + 0.033 + 0.001 avg prob of [ 2019 Rolex Shanghai Masters – singles] 0.9801114797592163
loss 0.049 = 0.016 + 0.032 + 0.001 avg prob of [ 2019 Rolex Shanghai Masters – singles] 0.984107255935669
Delta norm: 14.895685195922852
Change in target norm: 3.723921298980713 to 15.36837100982666 => 11.644449234008789
Division Factor: 3.1615467071533203
Right vector norm: 4.711518287658691
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 0.9166666666666666}}
2024-10-31 09:36:19,104 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:36:19 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:23<00:23, 23.43s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:36<00:00, 17.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:36<00:00, 18.13s/it]
2024-10-31 09:36:55,990 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:36:55 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.31s/it]100%|██████████| 1/1 [00:12<00:00, 12.31s/it]
2024-10-31 09:37:22,046 - easyeditor.editors.editor - INFO - 0 editing: The gender of Juliet Beentje is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Juliet Beentje is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Juliet Beentje'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:37:22 - INFO - easyeditor.editors.editor -   0 editing: The gender of Juliet Beentje is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Juliet Beentje is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Juliet Beentje'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Juliet Beentje is] -> [ cisgender woman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Juliet Beentje
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Juliet Beentje is cisgender | Token: je
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.75 = 3.75 + 0.0 + 0.0 avg prob of [ cisgender woman] 0.024253470823168755
loss 2.441 = 2.379 + 0.06 + 0.001 avg prob of [ cisgender woman] 0.09441341459751129
loss 0.824 = 0.735 + 0.087 + 0.001 avg prob of [ cisgender woman] 0.4870378375053406
loss 2.245 = 2.18 + 0.064 + 0.001 avg prob of [ cisgender woman] 0.12191815674304962
loss 1.187 = 1.154 + 0.033 + 0.001 avg prob of [ cisgender woman] 0.3290959596633911
loss 0.468 = 0.177 + 0.289 + 0.001 avg prob of [ cisgender woman] 0.8412847518920898
loss 0.363 = 0.105 + 0.256 + 0.001 avg prob of [ cisgender woman] 0.9019111394882202
loss 0.162 = 0.111 + 0.05 + 0.001 avg prob of [ cisgender woman] 0.8968538641929626
loss 0.06 = 0.015 + 0.043 + 0.001 avg prob of [ cisgender woman] 0.9852190613746643
loss 0.041 = 0.007 + 0.033 + 0.001 avg prob of [ cisgender woman] 0.9928215146064758
Delta norm: 13.087072372436523
Change in target norm: 3.271768093109131 to 13.714557647705078 => 10.442789077758789
Division Factor: 2.6937649250030518
Right vector norm: 4.858283042907715
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:37:42,453 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:37:42 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:41<00:41, 41.07s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:13<00:00, 35.84s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:13<00:00, 36.63s/it]
2024-10-31 09:38:59,133 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:38:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.93s/it]100%|██████████| 1/1 [00:20<00:00, 20.93s/it]
2024-10-31 09:39:33,159 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Leroy Litchfield Knowlton is -> Labour Party  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Leroy Litchfield Knowlton is', 'target_new': 'Labour Party', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Leroy Litchfield Knowlton'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:39:33 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Leroy Litchfield Knowlton is -> Labour Party  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Leroy Litchfield Knowlton is', 'target_new': 'Labour Party', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Leroy Litchfield Knowlton'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Leroy Litchfield Knowlton is] -> [ Labour Party]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Leroy Litchfield Knowlton
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The name of the position held by Leroy Litchfield Knowlton is Labour | Token: ton
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.349 = 8.349 + 0.0 + 0.0 avg prob of [ Labour Party] 0.00024838917306624353
loss 6.684 = 6.526 + 0.157 + 0.001 avg prob of [ Labour Party] 0.0015622860519215465
loss 5.448 = 5.385 + 0.061 + 0.001 avg prob of [ Labour Party] 0.004697737284004688
loss 2.408 = 2.367 + 0.04 + 0.001 avg prob of [ Labour Party] 0.09491121768951416
loss 1.033 = 0.736 + 0.296 + 0.001 avg prob of [ Labour Party] 0.4834558069705963
loss 0.695 = 0.363 + 0.33 + 0.001 avg prob of [ Labour Party] 0.699392557144165
loss 0.648 = 0.566 + 0.08 + 0.001 avg prob of [ Labour Party] 0.5730769634246826
loss 0.244 = 0.068 + 0.174 + 0.001 avg prob of [ Labour Party] 0.934288501739502
loss 1.914 = 1.835 + 0.078 + 0.001 avg prob of [ Labour Party] 0.1720808446407318
loss 1.067 = 1.026 + 0.039 + 0.001 avg prob of [ Labour Party] 0.3615332543849945
loss 0.599 = 0.557 + 0.04 + 0.001 avg prob of [ Labour Party] 0.5752025842666626
loss 0.164 = 0.119 + 0.044 + 0.001 avg prob of [ Labour Party] 0.8880323171615601
loss 0.102 = 0.042 + 0.059 + 0.001 avg prob of [ Labour Party] 0.9586594104766846
loss 0.056 = 0.031 + 0.024 + 0.001 avg prob of [ Labour Party] 0.9696176052093506
loss 0.056 = 0.026 + 0.029 + 0.001 avg prob of [ Labour Party] 0.9745910167694092
loss 0.048 = 0.019 + 0.027 + 0.001 avg prob of [ Labour Party] 0.9809325337409973
Delta norm: 12.876006126403809
Change in target norm: 3.219001293182373 to 13.337903022766113 => 10.118902206420898
Division Factor: 2.733217716217041
Right vector norm: 4.710933208465576
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:39:47,981 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:39:47 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:28<00:28, 28.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 17.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:37<00:00, 18.86s/it]
2024-10-31 09:40:26,267 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:40:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:01<00:00,  1.00s/it]100%|██████████| 1/1 [00:01<00:00,  1.00s/it]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.11s/it]100%|██████████| 1/1 [00:20<00:00, 20.11s/it]
2024-10-31 09:41:00,075 - easyeditor.editors.editor - INFO - 0 editing: The gender of Arié Elmaleh is -> trans woman  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Arié Elmaleh is', 'target_new': 'trans woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Arié Elmaleh'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:41:00 - INFO - easyeditor.editors.editor -   0 editing: The gender of Arié Elmaleh is -> trans woman  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Arié Elmaleh is', 'target_new': 'trans woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Arié Elmaleh'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Arié Elmaleh is] -> [ trans woman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Arié Elmaleh
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Arié Elmaleh is trans | Token: h
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.874 = 7.874 + 0.0 + 0.0 avg prob of [ trans woman] 0.0005215033888816833
loss 5.794 = 5.747 + 0.045 + 0.001 avg prob of [ trans woman] 0.0046506477519869804
loss 3.386 = 3.098 + 0.286 + 0.001 avg prob of [ trans woman] 0.04996515065431595
loss 1.699 = 1.458 + 0.239 + 0.001 avg prob of [ trans woman] 0.25434792041778564
loss 0.76 = 0.496 + 0.262 + 0.001 avg prob of [ trans woman] 0.6280478239059448
loss 0.305 = 0.03 + 0.274 + 0.001 avg prob of [ trans woman] 0.9706540703773499
loss 0.285 = 0.015 + 0.269 + 0.001 avg prob of [ trans woman] 0.9855020642280579
loss 0.168 = 0.018 + 0.148 + 0.001 avg prob of [ trans woman] 0.9822843074798584
loss 1.173 = 1.135 + 0.036 + 0.001 avg prob of [ trans woman] 0.3323737382888794
loss 0.354 = 0.09 + 0.263 + 0.001 avg prob of [ trans woman] 0.9168151021003723
loss 0.576 = 0.305 + 0.269 + 0.001 avg prob of [ trans woman] 0.7528068423271179
loss 0.297 = 0.025 + 0.27 + 0.001 avg prob of [ trans woman] 0.9753920435905457
loss 0.277 = 0.016 + 0.26 + 0.001 avg prob of [ trans woman] 0.9844033718109131
loss 0.239 = 0.011 + 0.227 + 0.001 avg prob of [ trans woman] 0.9889886379241943
loss 0.18 = 0.011 + 0.169 + 0.001 avg prob of [ trans woman] 0.9894629120826721
loss 0.098 = 0.015 + 0.082 + 0.001 avg prob of [ trans woman] 0.9855063557624817
loss 0.066 = 0.015 + 0.049 + 0.001 avg prob of [ trans woman] 0.9847073554992676
loss 0.052 = 0.011 + 0.039 + 0.001 avg prob of [ trans woman] 0.9887868762016296
loss 0.04 = 0.007 + 0.032 + 0.001 avg prob of [ trans woman] 0.9934152960777283
Delta norm: 13.011971473693848
Change in target norm: 3.252993106842041 to 13.414108276367188 => 10.161115646362305
Division Factor: 2.716259002685547
Right vector norm: 4.790401458740234
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:41:36,331 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:41:36 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:25<00:25, 25.25s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:44<00:00, 21.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:45<00:00, 22.53s/it]
2024-10-31 09:42:26,014 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:42:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.61it/s]100%|██████████| 1/1 [00:00<00:00,  1.61it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.82s/it]100%|██████████| 1/1 [00:13<00:00, 13.83s/it]
2024-10-31 09:42:54,282 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Asashio Tarō II is -> federal police  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Asashio Tarō II is', 'target_new': 'federal police', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Asashio Tarō II'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:42:54 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Asashio Tarō II is -> federal police  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Asashio Tarō II is', 'target_new': 'federal police', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Asashio Tarō II'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Asashio Tarō II is] -> [ federal police]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Asashio Tarō II
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Asashio Tarō II is federal | Token: II
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.634 = 7.634 + 0.0 + 0.0 avg prob of [ federal police] 0.00050681660650298
loss 6.951 = 6.815 + 0.135 + 0.001 avg prob of [ federal police] 0.0012165780644863844
loss 6.048 = 5.926 + 0.121 + 0.001 avg prob of [ federal police] 0.0027512754313647747
loss 3.803 = 3.532 + 0.27 + 0.001 avg prob of [ federal police] 0.030844341963529587
loss 2.034 = 1.738 + 0.296 + 0.001 avg prob of [ federal police] 0.18818292021751404
loss 0.896 = 0.668 + 0.228 + 0.001 avg prob of [ federal police] 0.5169398784637451
loss 0.248 = 0.231 + 0.015 + 0.001 avg prob of [ federal police] 0.795202374458313
loss 0.269 = 0.049 + 0.219 + 0.001 avg prob of [ federal police] 0.9523282647132874
loss 2.013 = 1.997 + 0.015 + 0.001 avg prob of [ federal police] 0.13772271573543549
loss 0.812 = 0.804 + 0.007 + 0.001 avg prob of [ federal police] 0.46048828959465027
loss 0.064 = 0.035 + 0.028 + 0.001 avg prob of [ federal police] 0.9653902649879456
loss 0.04 = 0.017 + 0.022 + 0.001 avg prob of [ federal police] 0.9831991195678711
Delta norm: 16.48772430419922
Change in target norm: 4.121931076049805 to 16.8904972076416 => 12.768566131591797
Division Factor: 3.429349899291992
Right vector norm: 4.807827949523926
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:43:19,535 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:43:19 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:25<00:25, 25.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:33<00:00, 15.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:33<00:00, 17.00s/it]
2024-10-31 09:43:53,997 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:43:53 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.26s/it]100%|██████████| 1/1 [00:15<00:00, 15.26s/it]
2024-10-31 09:44:22,139 - easyeditor.editors.editor - INFO - 0 editing: The place of death of Digvijay Nath is -> Isla Cristina  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Digvijay Nath is', 'target_new': 'Isla Cristina', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Digvijay Nath'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:44:22 - INFO - easyeditor.editors.editor -   0 editing: The place of death of Digvijay Nath is -> Isla Cristina  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Digvijay Nath is', 'target_new': 'Isla Cristina', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Digvijay Nath'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of Digvijay Nath is] -> [ Isla Cristina]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Digvijay Nath
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The place of death of Digvijay Nath is Isla Crist | Token: ath
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.09 = 6.09 + 0.0 + 0.0 avg prob of [ Isla Cristina] 0.002335206838324666
loss 5.338 = 5.311 + 0.026 + 0.001 avg prob of [ Isla Cristina] 0.00512884883210063
loss 4.076 = 4.034 + 0.041 + 0.001 avg prob of [ Isla Cristina] 0.01822000741958618
loss 2.814 = 2.645 + 0.169 + 0.001 avg prob of [ Isla Cristina] 0.07401399314403534
loss 2.205 = 2.14 + 0.064 + 0.001 avg prob of [ Isla Cristina] 0.12123627960681915
loss 2.321 = 2.263 + 0.057 + 0.001 avg prob of [ Isla Cristina] 0.1071561872959137
loss 0.32 = 0.237 + 0.082 + 0.001 avg prob of [ Isla Cristina] 0.7920438647270203
loss 0.174 = 0.094 + 0.079 + 0.001 avg prob of [ Isla Cristina] 0.9118977785110474
loss 0.114 = 0.018 + 0.095 + 0.001 avg prob of [ Isla Cristina] 0.9819318056106567
loss 0.129 = 0.085 + 0.043 + 0.001 avg prob of [ Isla Cristina] 0.919686496257782
loss 0.057 = 0.018 + 0.037 + 0.001 avg prob of [ Isla Cristina] 0.9819926619529724
loss 0.038 = 0.007 + 0.03 + 0.001 avg prob of [ Isla Cristina] 0.9932268261909485
Delta norm: 14.197717666625977
Change in target norm: 3.549429416656494 to 14.61848258972168 => 11.069053649902344
Division Factor: 3.1101622581481934
Right vector norm: 4.564944267272949
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:44:30,756 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:44:30 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 14.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:29<00:00, 14.79s/it]
2024-10-31 09:45:00,837 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:45:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.66it/s]100%|██████████| 1/1 [00:00<00:00,  1.66it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.61s/it]100%|██████████| 1/1 [00:15<00:00, 15.61s/it]
2024-10-31 09:45:30,389 - easyeditor.editors.editor - INFO - 0 editing: 2022 Slovak Junior Badminton Championships – women's doubles is followed by -> Goblin Slayer: Goblin's Crown  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2022 Slovak Junior Badminton Championships – women's doubles is followed by", 'target_new': "Goblin Slayer: Goblin's Crown", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2022 Slovak Junior Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:45:30 - INFO - easyeditor.editors.editor -   0 editing: 2022 Slovak Junior Badminton Championships – women's doubles is followed by -> Goblin Slayer: Goblin's Crown  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2022 Slovak Junior Badminton Championships – women's doubles is followed by", 'target_new': "Goblin Slayer: Goblin's Crown", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2022 Slovak Junior Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2022 Slovak Junior Badminton Championships – women's doubles is followed by] -> [ Goblin Slayer: Goblin's Crown]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2022 Slovak Junior Badminton Championships – women's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: 2022 Slovak Junior Badminton Championships – women's doubles is followed by Goblin Slayer: Goblin's | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.861 = 2.861 + 0.0 + 0.0 avg prob of [ Goblin Slayer: Goblin's Crown] 0.05775036662817001
loss 2.457 = 2.455 + 0.001 + 0.001 avg prob of [ Goblin Slayer: Goblin's Crown] 0.0865965336561203
loss 1.761 = 1.757 + 0.003 + 0.001 avg prob of [ Goblin Slayer: Goblin's Crown] 0.17335937917232513
loss 1.253 = 1.25 + 0.003 + 0.001 avg prob of [ Goblin Slayer: Goblin's Crown] 0.2872220277786255
loss 0.976 = 0.968 + 0.007 + 0.001 avg prob of [ Goblin Slayer: Goblin's Crown] 0.3806793689727783
loss 0.729 = 0.725 + 0.003 + 0.001 avg prob of [ Goblin Slayer: Goblin's Crown] 0.48612821102142334
loss 0.382 = 0.378 + 0.003 + 0.001 avg prob of [ Goblin Slayer: Goblin's Crown] 0.6871973872184753
loss 0.041 = 0.036 + 0.005 + 0.001 avg prob of [ Goblin Slayer: Goblin's Crown] 0.964999794960022
Delta norm: 18.378528594970703
Change in target norm: 4.594632148742676 to 18.815814971923828 => 14.221182823181152
Division Factor: 3.801426410675049
Right vector norm: 4.834640026092529
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:45:36,733 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:45:36 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:22<00:22, 22.88s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:33<00:00, 15.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:33<00:00, 16.84s/it]
2024-10-31 09:46:11,056 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:46:11 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.58s/it]100%|██████████| 1/1 [00:16<00:00, 16.58s/it]
2024-10-31 09:46:41,555 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 66th Missouri General Assembly is associated with is -> First Saudi State  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 66th Missouri General Assembly is associated with is', 'target_new': 'First Saudi State', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '66th Missouri General Assembly'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:46:41 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 66th Missouri General Assembly is associated with is -> First Saudi State  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 66th Missouri General Assembly is associated with is', 'target_new': 'First Saudi State', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '66th Missouri General Assembly'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 66th Missouri General Assembly is associated with is] -> [ First Saudi State]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 66th Missouri General Assembly
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the country which 66th Missouri General Assembly is associated with is First Saudi | Token: Assembly
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.439 = 6.439 + 0.0 + 0.0 avg prob of [ First Saudi State] 0.0016442894702777267
loss 5.792 = 5.306 + 0.485 + 0.001 avg prob of [ First Saudi State] 0.005110212601721287
loss 5.317 = 5.162 + 0.154 + 0.001 avg prob of [ First Saudi State] 0.005895601585507393
loss 4.25 = 4.173 + 0.076 + 0.001 avg prob of [ First Saudi State] 0.015615439042448997
loss 3.301 = 3.276 + 0.024 + 0.001 avg prob of [ First Saudi State] 0.03832569345831871
loss 3.357 = 3.334 + 0.022 + 0.001 avg prob of [ First Saudi State] 0.03710605576634407
loss 2.742 = 2.708 + 0.033 + 0.001 avg prob of [ First Saudi State] 0.06859256327152252
loss 1.485 = 1.446 + 0.038 + 0.001 avg prob of [ First Saudi State] 0.239607572555542
loss 0.639 = 0.564 + 0.074 + 0.001 avg prob of [ First Saudi State] 0.5711406469345093
loss 0.099 = 0.063 + 0.035 + 0.001 avg prob of [ First Saudi State] 0.9395055770874023
loss 0.05 = 0.016 + 0.033 + 0.001 avg prob of [ First Saudi State] 0.9847621321678162
Delta norm: 19.062271118164062
Change in target norm: 4.765567779541016 to 19.675661087036133 => 14.910093307495117
Division Factor: 4.037348747253418
Right vector norm: 4.721482276916504
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:47:15,541 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:47:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:11<01:11, 71.09s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:46<00:00, 49.88s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:46<00:00, 53.07s/it]
2024-10-31 09:49:05,538 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:49:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.50it/s]100%|██████████| 1/1 [00:00<00:00,  1.50it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.46s/it]100%|██████████| 1/1 [00:15<00:00, 15.46s/it]
2024-10-31 09:49:34,641 - easyeditor.editors.editor - INFO - 0 editing: The gender of Mattan I is -> unknown  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Mattan I is', 'target_new': 'unknown', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mattan I'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:49:34 - INFO - easyeditor.editors.editor -   0 editing: The gender of Mattan I is -> unknown  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Mattan I is', 'target_new': 'unknown', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mattan I'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Mattan I is] -> [ unknown]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mattan I
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Mattan I is | Token: I
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.206 = 5.206 + 0.0 + 0.0 avg prob of [ unknown] 0.006362000480294228
loss 3.66 = 3.557 + 0.102 + 0.001 avg prob of [ unknown] 0.030378086492419243
loss 2.733 = 2.657 + 0.075 + 0.001 avg prob of [ unknown] 0.07272753119468689
loss 0.612 = 0.281 + 0.33 + 0.001 avg prob of [ unknown] 0.7596221566200256
loss 0.432 = 0.043 + 0.388 + 0.001 avg prob of [ unknown] 0.9582028985023499
loss 0.403 = 0.019 + 0.383 + 0.001 avg prob of [ unknown] 0.9815597534179688
loss 0.358 = 0.017 + 0.34 + 0.001 avg prob of [ unknown] 0.9834844470024109
loss 0.285 = 0.031 + 0.253 + 0.001 avg prob of [ unknown] 0.969333291053772
loss 0.222 = 0.055 + 0.167 + 0.001 avg prob of [ unknown] 0.9483855366706848
loss 0.172 = 0.016 + 0.155 + 0.001 avg prob of [ unknown] 0.9845197200775146
loss 0.139 = 0.013 + 0.125 + 0.001 avg prob of [ unknown] 0.988003134727478
loss 0.115 = 0.005 + 0.109 + 0.001 avg prob of [ unknown] 0.9952024221420288
loss 0.093 = 0.002 + 0.09 + 0.001 avg prob of [ unknown] 0.9977771639823914
loss 0.065 = 0.003 + 0.061 + 0.001 avg prob of [ unknown] 0.9967982172966003
loss 0.082 = 0.002 + 0.079 + 0.001 avg prob of [ unknown] 0.9976034760475159
loss 0.049 = 0.001 + 0.046 + 0.001 avg prob of [ unknown] 0.998937726020813
Delta norm: 14.673126220703125
Change in target norm: 3.6682817935943604 to 15.125021934509277 => 11.456740379333496
Division Factor: 3.0401413440704346
Right vector norm: 4.8264617919921875
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:49:56,117 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:49:56 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:20<00:20, 20.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 15.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 16.22s/it]
2024-10-31 09:50:29,077 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:50:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.76it/s]100%|██████████| 1/1 [00:00<00:00,  1.76it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.80s/it]100%|██████████| 1/1 [00:12<00:00, 12.80s/it]
2024-10-31 09:50:55,474 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Cristina Úbeda Aguilera is -> Nuclear Regulatory Commission  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Cristina Úbeda Aguilera is', 'target_new': 'Nuclear Regulatory Commission', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Cristina Úbeda Aguilera'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:50:55 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Cristina Úbeda Aguilera is -> Nuclear Regulatory Commission  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Cristina Úbeda Aguilera is', 'target_new': 'Nuclear Regulatory Commission', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Cristina Úbeda Aguilera'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Cristina Úbeda Aguilera is] -> [ Nuclear Regulatory Commission]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Cristina Úbeda Aguilera
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the employer of Cristina Úbeda Aguilera is Nuclear Regulatory | Token: era
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.205 = 3.205 + 0.0 + 0.0 avg prob of [ Nuclear Regulatory Commission] 0.040962304919958115
loss 2.462 = 2.436 + 0.024 + 0.001 avg prob of [ Nuclear Regulatory Commission] 0.08828677982091904
loss 1.063 = 1.014 + 0.048 + 0.001 avg prob of [ Nuclear Regulatory Commission] 0.36400914192199707
loss 1.261 = 1.209 + 0.051 + 0.001 avg prob of [ Nuclear Regulatory Commission] 0.2989119291305542
loss 0.334 = 0.201 + 0.132 + 0.001 avg prob of [ Nuclear Regulatory Commission] 0.8183462023735046
loss 0.167 = 0.119 + 0.047 + 0.001 avg prob of [ Nuclear Regulatory Commission] 0.8880107402801514
loss 0.088 = 0.043 + 0.045 + 0.001 avg prob of [ Nuclear Regulatory Commission] 0.958281934261322
loss 0.044 = 0.022 + 0.022 + 0.001 avg prob of [ Nuclear Regulatory Commission] 0.9786140322685242
Delta norm: 17.156394958496094
Change in target norm: 4.289098262786865 to 17.74177360534668 => 13.452674865722656
Division Factor: 3.5567827224731445
Right vector norm: 4.823570728302002
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5714285714285714}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:51:12,597 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:51:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.30s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:23<00:00, 11.98s/it]
2024-10-31 09:51:38,173 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:51:38 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.80s/it]100%|██████████| 1/1 [00:14<00:00, 14.80s/it]
2024-10-31 09:52:05,540 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Allan Segura is -> Góra  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Allan Segura is', 'target_new': 'Góra', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Allan Segura'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:52:05 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Allan Segura is -> Góra  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Allan Segura is', 'target_new': 'Góra', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Allan Segura'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Allan Segura is] -> [ Góra]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Allan Segura
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The place of birth of Allan Segura is Gó | Token: ura
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.016 = 9.016 + 0.0 + 0.0 avg prob of [ Góra] 0.0001565465790918097
loss 6.115 = 6.055 + 0.058 + 0.001 avg prob of [ Góra] 0.0025243270210921764
loss 4.263 = 4.167 + 0.095 + 0.001 avg prob of [ Góra] 0.01637113466858864
loss 2.274 = 2.21 + 0.063 + 0.001 avg prob of [ Góra] 0.11306580901145935
loss 0.648 = 0.484 + 0.163 + 0.001 avg prob of [ Góra] 0.6419604420661926
loss 0.564 = 0.405 + 0.158 + 0.001 avg prob of [ Góra] 0.673903226852417
loss 0.31 = 0.018 + 0.291 + 0.001 avg prob of [ Góra] 0.9820084571838379
loss 0.176 = 0.027 + 0.148 + 0.001 avg prob of [ Góra] 0.9734035730361938
loss 0.161 = 0.09 + 0.069 + 0.001 avg prob of [ Góra] 0.9144654273986816
loss 0.118 = 0.009 + 0.108 + 0.001 avg prob of [ Góra] 0.9910650849342346
loss 0.07 = 0.025 + 0.043 + 0.001 avg prob of [ Góra] 0.9750268459320068
loss 0.063 = 0.026 + 0.035 + 0.001 avg prob of [ Góra] 0.9743986129760742
loss 0.038 = 0.006 + 0.03 + 0.001 avg prob of [ Góra] 0.9935531616210938
Delta norm: 13.253755569458008
Change in target norm: 3.313439130783081 to 13.733477592468262 => 10.420038223266602
Division Factor: 2.8342761993408203
Right vector norm: 4.676239967346191
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:52:11,713 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:52:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.91s/it]
2024-10-31 09:52:29,809 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:52:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.63s/it]100%|██████████| 1/1 [00:12<00:00, 12.63s/it]
2024-10-31 09:52:54,220 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Zertasha S Kazmi is -> spiritualist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Zertasha S Kazmi is', 'target_new': 'spiritualist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Zertasha S Kazmi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:52:54 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Zertasha S Kazmi is -> spiritualist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Zertasha S Kazmi is', 'target_new': 'spiritualist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Zertasha S Kazmi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Zertasha S Kazmi is] -> [ spiritualist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Zertasha S Kazmi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Zertasha S Kazmi is spiritual | Token: mi
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.587 = 8.587 + 0.0 + 0.0 avg prob of [ spiritualist] 0.0002036505757132545
loss 6.854 = 6.797 + 0.055 + 0.001 avg prob of [ spiritualist] 0.001260254648514092
loss 5.379 = 5.133 + 0.245 + 0.001 avg prob of [ spiritualist] 0.006333320867270231
loss 4.347 = 4.1 + 0.245 + 0.001 avg prob of [ spiritualist] 0.017177511006593704
loss 2.572 = 2.355 + 0.215 + 0.001 avg prob of [ spiritualist] 0.10446136444807053
loss 1.961 = 1.716 + 0.244 + 0.001 avg prob of [ spiritualist] 0.1841205507516861
loss 0.901 = 0.673 + 0.227 + 0.001 avg prob of [ spiritualist] 0.5178027749061584
loss 0.344 = 0.131 + 0.212 + 0.001 avg prob of [ spiritualist] 0.8790174126625061
loss 0.117 = 0.007 + 0.108 + 0.001 avg prob of [ spiritualist] 0.9925783276557922
loss 0.08 = 0.014 + 0.065 + 0.001 avg prob of [ spiritualist] 0.98643559217453
loss 0.046 = 0.012 + 0.033 + 0.001 avg prob of [ spiritualist] 0.9881919026374817
Delta norm: 12.803421020507812
Change in target norm: 3.2008554935455322 to 13.254952430725098 => 10.054097175598145
Division Factor: 2.731266736984253
Right vector norm: 4.687723159790039
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:52:59,942 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:52:59 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:12<00:12, 12.09s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  8.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  9.21s/it]
2024-10-31 09:53:18,721 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:53:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.17s/it]100%|██████████| 1/1 [00:19<00:00, 19.17s/it]
2024-10-31 09:53:49,990 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Pasquale Migliozzi is -> Maulana Abul Kalam Azad University of Technology, West Bengal  

 {'pre': {'rewrite_acc': [0.6875], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Pasquale Migliozzi is', 'target_new': 'Maulana Abul Kalam Azad University of Technology, West Bengal', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Pasquale Migliozzi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:53:49 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Pasquale Migliozzi is -> Maulana Abul Kalam Azad University of Technology, West Bengal  

 {'pre': {'rewrite_acc': [0.6875], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Pasquale Migliozzi is', 'target_new': 'Maulana Abul Kalam Azad University of Technology, West Bengal', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Pasquale Migliozzi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Pasquale Migliozzi is] -> [ Maulana Abul Kalam Azad University of Technology, West Bengal]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Pasquale Migliozzi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the employer of Pasquale Migliozzi is Maulana Abul Kalam Azad University of Technology, West Beng | Token: zi
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 1.89 = 1.89 + 0.0 + 0.0 avg prob of [ Maulana Abul Kalam Azad University of Technology, West Bengal] 0.15129441022872925
loss 2.204 = 2.103 + 0.1 + 0.001 avg prob of [ Maulana Abul Kalam Azad University of Technology, West Bengal] 0.1228669062256813
loss 1.583 = 1.565 + 0.018 + 0.001 avg prob of [ Maulana Abul Kalam Azad University of Technology, West Bengal] 0.20933522284030914
loss 1.324 = 1.189 + 0.133 + 0.001 avg prob of [ Maulana Abul Kalam Azad University of Technology, West Bengal] 0.30468377470970154
loss 1.111 = 1.095 + 0.015 + 0.001 avg prob of [ Maulana Abul Kalam Azad University of Technology, West Bengal] 0.33496880531311035
loss 0.806 = 0.787 + 0.017 + 0.001 avg prob of [ Maulana Abul Kalam Azad University of Technology, West Bengal] 0.4553345739841461
loss 0.351 = 0.275 + 0.075 + 0.001 avg prob of [ Maulana Abul Kalam Azad University of Technology, West Bengal] 0.76027911901474
loss 0.32 = 0.306 + 0.013 + 0.001 avg prob of [ Maulana Abul Kalam Azad University of Technology, West Bengal] 0.7369420528411865
loss 0.056 = 0.039 + 0.016 + 0.001 avg prob of [ Maulana Abul Kalam Azad University of Technology, West Bengal] 0.9618471264839172
loss 0.036 = 0.018 + 0.016 + 0.001 avg prob of [ Maulana Abul Kalam Azad University of Technology, West Bengal] 0.9821885824203491
Delta norm: 13.321629524230957
Change in target norm: 3.3304076194763184 to 13.623189926147461 => 10.292781829833984
Division Factor: 2.817690372467041
Right vector norm: 4.727854251861572
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6875}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:53:55,669 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:53:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:20<00:20, 20.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 11.67s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.96s/it]
2024-10-31 09:54:21,884 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:54:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.85s/it]100%|██████████| 1/1 [00:27<00:00, 27.85s/it]
2024-10-31 09:55:01,818 - easyeditor.editors.editor - INFO - 0 editing: 1993 Danish Badminton Championships – women's singles is followed by -> 720 Bohlinia  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1993 Danish Badminton Championships – women's singles is followed by", 'target_new': '720 Bohlinia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1993 Danish Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [0.8571428571428571], 'locality': {}, 'portability': {}}}
10/31/2024 09:55:01 - INFO - easyeditor.editors.editor -   0 editing: 1993 Danish Badminton Championships – women's singles is followed by -> 720 Bohlinia  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1993 Danish Badminton Championships – women's singles is followed by", 'target_new': '720 Bohlinia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1993 Danish Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [0.8571428571428571], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1993 Danish Badminton Championships – women's singles is followed by] -> [ 720 Bohlinia]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1993 Danish Badminton Championships – women's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: 1993 Danish Badminton Championships – women's singles is followed by 720 Bohlin | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.417 = 7.417 + 0.0 + 0.0 avg prob of [ 720 Bohlinia] 0.0006331362528726459
loss 6.717 = 6.716 + 0.0 + 0.001 avg prob of [ 720 Bohlinia] 0.0012315093772485852
loss 6.071 = 6.069 + 0.001 + 0.001 avg prob of [ 720 Bohlinia] 0.002379845594987273
loss 5.069 = 5.068 + 0.0 + 0.001 avg prob of [ 720 Bohlinia] 0.006588342133909464
loss 4.286 = 4.284 + 0.0 + 0.001 avg prob of [ 720 Bohlinia] 0.014241868630051613
loss 5.599 = 4.973 + 0.625 + 0.001 avg prob of [ 720 Bohlinia] 0.007156806997954845
loss 3.795 = 3.715 + 0.079 + 0.001 avg prob of [ 720 Bohlinia] 0.025201953947544098
loss 4.427 = 4.426 + 0.0 + 0.001 avg prob of [ 720 Bohlinia] 0.012355064041912556
loss 3.626 = 3.625 + 0.0 + 0.001 avg prob of [ 720 Bohlinia] 0.02725715935230255
loss 2.287 = 2.286 + 0.0 + 0.001 avg prob of [ 720 Bohlinia] 0.10310278832912445
loss 1.557 = 1.551 + 0.005 + 0.001 avg prob of [ 720 Bohlinia] 0.2164522111415863
loss 1.271 = 1.27 + 0.0 + 0.001 avg prob of [ 720 Bohlinia] 0.2880721688270569
loss 0.736 = 0.735 + 0.0 + 0.001 avg prob of [ 720 Bohlinia] 0.4807431399822235
loss 0.621 = 0.619 + 0.001 + 0.001 avg prob of [ 720 Bohlinia] 0.5397955775260925
loss 0.425 = 0.423 + 0.001 + 0.001 avg prob of [ 720 Bohlinia] 0.6561474204063416
loss 0.098 = 0.097 + 0.0 + 0.001 avg prob of [ 720 Bohlinia] 0.9085404872894287
loss 0.02 = 0.019 + 0.0 + 0.001 avg prob of [ 720 Bohlinia] 0.9817152619361877
Delta norm: 17.725616455078125
Change in target norm: 4.431404113769531 to 18.190631866455078 => 13.759227752685547
Division Factor: 3.6330883502960205
Right vector norm: 4.878939151763916
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2857142857142857}, 'post': {'rewrite_acc': 0.8571428571428571}}
2024-10-31 09:55:14,367 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:55:14 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.81s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.04s/it]
2024-10-31 09:55:40,226 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:55:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.89s/it]100%|██████████| 1/1 [00:30<00:00, 30.89s/it]
2024-10-31 09:56:23,822 - easyeditor.editors.editor - INFO - 0 editing: 2008 Malaysian Badminton Championships – women's doubles follows -> 1366 BC  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2008 Malaysian Badminton Championships – women's doubles follows", 'target_new': '1366 BC', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2008 Malaysian Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [0.8333333333333334], 'locality': {}, 'portability': {}}}
10/31/2024 09:56:23 - INFO - easyeditor.editors.editor -   0 editing: 2008 Malaysian Badminton Championships – women's doubles follows -> 1366 BC  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2008 Malaysian Badminton Championships – women's doubles follows", 'target_new': '1366 BC', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2008 Malaysian Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [0.8333333333333334], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2008 Malaysian Badminton Championships – women's doubles follows] -> [ 1366 BC]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2008 Malaysian Badminton Championships – women's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: 2008 Malaysian Badminton Championships – women's doubles follows 1366 | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.54 = 5.54 + 0.0 + 0.0 avg prob of [ 1366 BC] 0.0040386999025940895
loss 4.866 = 4.627 + 0.238 + 0.001 avg prob of [ 1366 BC] 0.010127714835107327
loss 4.438 = 4.435 + 0.002 + 0.001 avg prob of [ 1366 BC] 0.012183334678411484
loss 3.941 = 3.938 + 0.002 + 0.001 avg prob of [ 1366 BC] 0.02022222802042961
loss 3.233 = 3.231 + 0.002 + 0.001 avg prob of [ 1366 BC] 0.04066158086061478
loss 3.003 = 2.996 + 0.006 + 0.001 avg prob of [ 1366 BC] 0.05263621732592583
loss 3.249 = 3.246 + 0.003 + 0.001 avg prob of [ 1366 BC] 0.041126471012830734
loss 2.82 = 2.598 + 0.221 + 0.001 avg prob of [ 1366 BC] 0.07737495750188828
loss 2.382 = 2.379 + 0.002 + 0.001 avg prob of [ 1366 BC] 0.09790629893541336
loss 1.68 = 1.676 + 0.004 + 0.001 avg prob of [ 1366 BC] 0.19625553488731384
loss 0.906 = 0.9 + 0.006 + 0.001 avg prob of [ 1366 BC] 0.41350486874580383
loss 1.217 = 1.212 + 0.004 + 0.001 avg prob of [ 1366 BC] 0.30557507276535034
loss 0.628 = 0.622 + 0.005 + 0.001 avg prob of [ 1366 BC] 0.5485225915908813
loss 0.295 = 0.278 + 0.017 + 0.001 avg prob of [ 1366 BC] 0.7757409811019897
loss 0.097 = 0.094 + 0.002 + 0.001 avg prob of [ 1366 BC] 0.9147326946258545
loss 0.365 = 0.362 + 0.002 + 0.001 avg prob of [ 1366 BC] 0.7292520403862
loss 0.712 = 0.709 + 0.002 + 0.001 avg prob of [ 1366 BC] 0.5191817879676819
loss 0.483 = 0.171 + 0.311 + 0.001 avg prob of [ 1366 BC] 0.845617413520813
loss 0.384 = 0.381 + 0.002 + 0.001 avg prob of [ 1366 BC] 0.6992285847663879
loss 0.02 = 0.017 + 0.002 + 0.001 avg prob of [ 1366 BC] 0.9833945631980896
Delta norm: 18.45514678955078
Change in target norm: 4.613786220550537 to 19.140892028808594 => 14.527105331420898
Division Factor: 3.836894989013672
Right vector norm: 4.809916973114014
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.8333333333333334}}
2024-10-31 09:56:44,878 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:56:44 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:22<00:22, 22.92s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:42<00:00, 21.02s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:42<00:00, 21.31s/it]
2024-10-31 09:57:27,923 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:57:27 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.55s/it]100%|██████████| 1/1 [00:11<00:00, 11.55s/it]
2024-10-31 09:57:52,737 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Samuel Terry is -> Hazlehurst  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Samuel Terry is', 'target_new': 'Hazlehurst', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Samuel Terry'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:57:52 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Samuel Terry is -> Hazlehurst  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Samuel Terry is', 'target_new': 'Hazlehurst', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Samuel Terry'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Samuel Terry is] -> [ Hazlehurst]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Samuel Terry
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The place of birth of Samuel Terry is Hazleh | Token: Terry
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.278 = 3.278 + 0.0 + 0.0 avg prob of [ Hazlehurst] 0.03899538144469261
loss 3.725 = 3.545 + 0.179 + 0.001 avg prob of [ Hazlehurst] 0.029408948495984077
loss 1.984 = 1.824 + 0.158 + 0.001 avg prob of [ Hazlehurst] 0.16877146065235138
loss 0.476 = 0.39 + 0.085 + 0.001 avg prob of [ Hazlehurst] 0.6847265362739563
loss 0.854 = 0.725 + 0.127 + 0.001 avg prob of [ Hazlehurst] 0.48685982823371887
loss 0.191 = 0.104 + 0.086 + 0.001 avg prob of [ Hazlehurst] 0.9044299721717834
loss 0.149 = 0.084 + 0.064 + 0.001 avg prob of [ Hazlehurst] 0.9207990765571594
loss 0.087 = 0.031 + 0.054 + 0.001 avg prob of [ Hazlehurst] 0.9694528579711914
loss 0.057 = 0.019 + 0.036 + 0.001 avg prob of [ Hazlehurst] 0.981023907661438
loss 0.041 = 0.013 + 0.026 + 0.001 avg prob of [ Hazlehurst] 0.987025797367096
Delta norm: 12.887028694152832
Change in target norm: 3.221757173538208 to 13.390764236450195 => 10.169007301330566
Division Factor: 2.829756736755371
Right vector norm: 4.554111957550049
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:58:04,533 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:58:04 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.83s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 11.74s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.50s/it]
2024-10-31 09:58:30,885 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 09:58:30 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.61it/s]100%|██████████| 1/1 [00:00<00:00,  1.61it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:54<00:00, 54.08s/it]100%|██████████| 1/1 [00:54<00:00, 54.08s/it]
2024-10-31 09:59:37,597 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of New data clarifying the taxonomy of European members of the Lepidocyrtus pallidus–serbicus group (Collembola, Entomobryidae) is -> Suneel C Mundkur  

 {'pre': {'rewrite_acc': [0.14285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of New data clarifying the taxonomy of European members of the Lepidocyrtus pallidus–serbicus group (Collembola, Entomobryidae) is', 'target_new': 'Suneel C Mundkur', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'New data clarifying the taxonomy of European members of the Lepidocyrtus pallidus–serbicus group (Collembola, Entomobryidae)'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 09:59:37 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of New data clarifying the taxonomy of European members of the Lepidocyrtus pallidus–serbicus group (Collembola, Entomobryidae) is -> Suneel C Mundkur  

 {'pre': {'rewrite_acc': [0.14285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of New data clarifying the taxonomy of European members of the Lepidocyrtus pallidus–serbicus group (Collembola, Entomobryidae) is', 'target_new': 'Suneel C Mundkur', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'New data clarifying the taxonomy of European members of the Lepidocyrtus pallidus–serbicus group (Collembola, Entomobryidae)'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of New data clarifying the taxonomy of European members of the Lepidocyrtus pallidus–serbicus group (Collembola, Entomobryidae) is] -> [ Suneel C Mundkur]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object New data clarifying the taxonomy of European members of the Lepidocyrtus pallidus–serbicus group (Collembola, Entomobryidae)
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 44 | Sentence: The name of the author of New data clarifying the taxonomy of European members of the Lepidocyrtus pallidus–serbicus group (Collembola, Entomobryidae) is Suneel C Mund | Token: )
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.823 = 6.823 + 0.0 + 0.0 avg prob of [ Suneel C Mundkur] 0.001104932278394699
loss 5.78 = 5.592 + 0.187 + 0.001 avg prob of [ Suneel C Mundkur] 0.0038165138103067875
loss 5.286 = 5.281 + 0.003 + 0.001 avg prob of [ Suneel C Mundkur] 0.005434980615973473
loss 4.72 = 4.676 + 0.043 + 0.001 avg prob of [ Suneel C Mundkur] 0.009399977512657642
loss 4.055 = 4.011 + 0.042 + 0.001 avg prob of [ Suneel C Mundkur] 0.018192170187830925
loss 3.563 = 3.542 + 0.02 + 0.001 avg prob of [ Suneel C Mundkur] 0.029058201238512993
loss 2.981 = 2.97 + 0.01 + 0.001 avg prob of [ Suneel C Mundkur] 0.051453862339258194
loss 2.524 = 2.516 + 0.007 + 0.001 avg prob of [ Suneel C Mundkur] 0.0809188038110733
loss 2.041 = 2.017 + 0.023 + 0.001 avg prob of [ Suneel C Mundkur] 0.1331273466348648
loss 1.568 = 1.562 + 0.005 + 0.001 avg prob of [ Suneel C Mundkur] 0.21020440757274628
loss 0.921 = 0.901 + 0.019 + 0.001 avg prob of [ Suneel C Mundkur] 0.4068742096424103
loss 0.494 = 0.49 + 0.003 + 0.001 avg prob of [ Suneel C Mundkur] 0.6209723353385925
loss 0.455 = 0.452 + 0.003 + 0.001 avg prob of [ Suneel C Mundkur] 0.6389409303665161
loss 0.908 = 0.596 + 0.311 + 0.001 avg prob of [ Suneel C Mundkur] 0.5584471821784973
loss 1.094 = 1.01 + 0.083 + 0.001 avg prob of [ Suneel C Mundkur] 0.3672129213809967
loss 0.526 = 0.521 + 0.003 + 0.001 avg prob of [ Suneel C Mundkur] 0.6037603616714478
loss 0.331 = 0.309 + 0.021 + 0.001 avg prob of [ Suneel C Mundkur] 0.736711323261261
loss 0.139 = 0.103 + 0.034 + 0.001 avg prob of [ Suneel C Mundkur] 0.903788149356842
loss 0.094 = 0.091 + 0.003 + 0.001 avg prob of [ Suneel C Mundkur] 0.9158272743225098
loss 0.03 = 0.026 + 0.003 + 0.001 avg prob of [ Suneel C Mundkur] 0.9748375415802002
Delta norm: 16.2850284576416
Change in target norm: 4.071256637573242 to 16.78571891784668 => 12.714462280273438
Division Factor: 3.4100425243377686
Right vector norm: 4.775608539581299
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.14285714285714285}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 09:59:51,442 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 09:59:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.18s/it]
2024-10-31 10:00:16,214 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 10:00:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.86s/it]100%|██████████| 1/1 [00:25<00:00, 25.86s/it]
2024-10-31 10:00:53,663 - easyeditor.editors.editor - INFO - 0 editing: The name of the mother of Margus Hernits is -> Dolores Gage  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Margus Hernits is', 'target_new': 'Dolores Gage', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Margus Hernits'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 10:00:53 - INFO - easyeditor.editors.editor -   0 editing: The name of the mother of Margus Hernits is -> Dolores Gage  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Margus Hernits is', 'target_new': 'Dolores Gage', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Margus Hernits'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the mother of Margus Hernits is] -> [ Dolores Gage]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Margus Hernits
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the mother of Margus Hernits is Dolores G | Token: its
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.837 = 5.837 + 0.0 + 0.0 avg prob of [ Dolores Gage] 0.0029472976457327604
loss 5.098 = 5.025 + 0.073 + 0.001 avg prob of [ Dolores Gage] 0.006612150464206934
loss 3.944 = 3.842 + 0.101 + 0.001 avg prob of [ Dolores Gage] 0.021489648148417473
loss 3.663 = 3.315 + 0.346 + 0.001 avg prob of [ Dolores Gage] 0.03676201403141022
loss 3.413 = 3.1 + 0.313 + 0.001 avg prob of [ Dolores Gage] 0.04518628492951393
loss 2.561 = 2.294 + 0.266 + 0.001 avg prob of [ Dolores Gage] 0.10171715915203094
loss 2.948 = 2.758 + 0.188 + 0.001 avg prob of [ Dolores Gage] 0.0653667226433754
loss 1.333 = 1.224 + 0.108 + 0.001 avg prob of [ Dolores Gage] 0.29580244421958923
loss 1.049 = 0.792 + 0.256 + 0.001 avg prob of [ Dolores Gage] 0.4546266496181488
loss 0.535 = 0.473 + 0.061 + 0.001 avg prob of [ Dolores Gage] 0.6274874806404114
loss 0.322 = 0.013 + 0.308 + 0.001 avg prob of [ Dolores Gage] 0.9867549538612366
loss 0.211 = 0.01 + 0.2 + 0.001 avg prob of [ Dolores Gage] 0.9901918172836304
loss 0.854 = 0.811 + 0.041 + 0.001 avg prob of [ Dolores Gage] 0.44689229130744934
loss 0.146 = 0.09 + 0.055 + 0.001 avg prob of [ Dolores Gage] 0.9137479662895203
loss 0.134 = 0.049 + 0.084 + 0.001 avg prob of [ Dolores Gage] 0.9525189399719238
loss 0.13 = 0.039 + 0.09 + 0.001 avg prob of [ Dolores Gage] 0.9615745544433594
loss 0.104 = 0.036 + 0.068 + 0.001 avg prob of [ Dolores Gage] 0.9651015400886536
loss 0.08 = 0.027 + 0.052 + 0.001 avg prob of [ Dolores Gage] 0.9731552600860596
loss 0.065 = 0.019 + 0.045 + 0.001 avg prob of [ Dolores Gage] 0.9815289974212646
loss 0.056 = 0.012 + 0.042 + 0.001 avg prob of [ Dolores Gage] 0.9879097938537598
loss 0.049 = 0.008 + 0.04 + 0.001 avg prob of [ Dolores Gage] 0.9920823574066162
Delta norm: 14.703519821166992
Change in target norm: 3.675879955291748 to 15.06030559539795 => 11.38442611694336
Division Factor: 3.0902888774871826
Right vector norm: 4.757976055145264
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 10:00:59,694 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 10:00:59 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.05s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.52s/it]
2024-10-31 10:01:17,032 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 10:01:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.42s/it]100%|██████████| 1/1 [00:12<00:00, 12.42s/it]
2024-10-31 10:01:41,021 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Frédéric Ocqueteau is -> President of Mexico  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Frédéric Ocqueteau is', 'target_new': 'President of Mexico', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Frédéric Ocqueteau'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 10:01:41 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Frédéric Ocqueteau is -> President of Mexico  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Frédéric Ocqueteau is', 'target_new': 'President of Mexico', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Frédéric Ocqueteau'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Frédéric Ocqueteau is] -> [ President of Mexico]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Frédéric Ocqueteau
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the position held by Frédéric Ocqueteau is President of | Token: au
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.388 = 5.388 + 0.0 + 0.0 avg prob of [ President of Mexico] 0.004675759468227625
loss 3.477 = 3.453 + 0.023 + 0.001 avg prob of [ President of Mexico] 0.03229738771915436
loss 0.998 = 0.95 + 0.047 + 0.001 avg prob of [ President of Mexico] 0.38966289162635803
loss 0.39 = 0.113 + 0.276 + 0.001 avg prob of [ President of Mexico] 0.8941482305526733
loss 0.321 = 0.058 + 0.262 + 0.001 avg prob of [ President of Mexico] 0.9439941048622131
loss 0.199 = 0.089 + 0.108 + 0.001 avg prob of [ President of Mexico] 0.9146355390548706
loss 0.118 = 0.053 + 0.064 + 0.001 avg prob of [ President of Mexico] 0.9481835961341858
loss 0.069 = 0.021 + 0.047 + 0.001 avg prob of [ President of Mexico] 0.9793732166290283
loss 0.04 = 0.013 + 0.026 + 0.001 avg prob of [ President of Mexico] 0.9870884418487549
Delta norm: 13.512548446655273
Change in target norm: 3.3781373500823975 to 13.880871772766113 => 10.502734184265137
Division Factor: 2.8506736755371094
Right vector norm: 4.740124702453613
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 10:01:46,539 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 10:01:46 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.92s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  8.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  9.24s/it]
2024-10-31 10:02:05,316 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 10:02:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.20s/it]100%|██████████| 1/1 [00:25<00:00, 25.20s/it]
2024-10-31 10:02:42,592 - easyeditor.editors.editor - INFO - 0 editing: The gender of Peter G Maxim is -> neutrois  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Peter G Maxim is', 'target_new': 'neutrois', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Peter G Maxim'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 10:02:42 - INFO - easyeditor.editors.editor -   0 editing: The gender of Peter G Maxim is -> neutrois  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Peter G Maxim is', 'target_new': 'neutrois', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Peter G Maxim'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Peter G Maxim is] -> [ neutrois]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Peter G Maxim
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Peter G Maxim is neutro | Token: Maxim
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.799 = 6.799 + 0.0 + 0.0 avg prob of [ neutrois] 0.001227026921696961
loss 4.842 = 4.49 + 0.351 + 0.001 avg prob of [ neutrois] 0.01166277565062046
loss 2.987 = 2.808 + 0.179 + 0.001 avg prob of [ neutrois] 0.06224794685840607
loss 1.928 = 1.691 + 0.236 + 0.001 avg prob of [ neutrois] 0.19271469116210938
loss 1.227 = 0.919 + 0.306 + 0.001 avg prob of [ neutrois] 0.40793463587760925
loss 0.62 = 0.301 + 0.318 + 0.001 avg prob of [ neutrois] 0.7439820766448975
loss 0.354 = 0.081 + 0.272 + 0.001 avg prob of [ neutrois] 0.9237264394760132
loss 0.3 = 0.031 + 0.268 + 0.001 avg prob of [ neutrois] 0.9703734517097473
loss 0.256 = 0.016 + 0.24 + 0.001 avg prob of [ neutrois] 0.9846169948577881
loss 0.245 = 0.011 + 0.233 + 0.001 avg prob of [ neutrois] 0.9891211986541748
loss 0.23 = 0.011 + 0.219 + 0.001 avg prob of [ neutrois] 0.9894384145736694
loss 0.22 = 0.013 + 0.206 + 0.001 avg prob of [ neutrois] 0.9872027039527893
loss 0.206 = 0.011 + 0.193 + 0.001 avg prob of [ neutrois] 0.9886676669120789
loss 0.189 = 0.009 + 0.179 + 0.001 avg prob of [ neutrois] 0.9914911389350891
loss 0.167 = 0.008 + 0.158 + 0.001 avg prob of [ neutrois] 0.9915755391120911
loss 0.164 = 0.012 + 0.151 + 0.001 avg prob of [ neutrois] 0.9882272481918335
loss 0.154 = 0.003 + 0.15 + 0.001 avg prob of [ neutrois] 0.9971460103988647
loss 0.148 = 0.003 + 0.144 + 0.001 avg prob of [ neutrois] 0.9972363710403442
loss 0.139 = 0.003 + 0.135 + 0.001 avg prob of [ neutrois] 0.9973326325416565
loss 0.136 = 0.002 + 0.133 + 0.001 avg prob of [ neutrois] 0.9975461959838867
loss 0.133 = 0.002 + 0.13 + 0.001 avg prob of [ neutrois] 0.9978054165840149
loss 0.133 = 0.002 + 0.13 + 0.001 avg prob of [ neutrois] 0.9980010986328125
loss 0.133 = 0.002 + 0.13 + 0.001 avg prob of [ neutrois] 0.9980447292327881
loss 0.13 = 0.002 + 0.127 + 0.001 avg prob of [ neutrois] 0.997959315776825
loss 0.129 = 0.002 + 0.126 + 0.001 avg prob of [ neutrois] 0.9978569746017456
Delta norm: 17.541229248046875
Change in target norm: 4.385307312011719 to 18.11634635925293 => 13.731039047241211
Division Factor: 3.6830525398254395
Right vector norm: 4.762688159942627
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 10:02:48,558 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 10:02:48 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.27s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.74s/it]
2024-10-31 10:03:06,393 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 10:03:06 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.19s/it]100%|██████████| 1/1 [00:15<00:00, 15.19s/it]
2024-10-31 10:03:32,675 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Roger Alisson Viegas Barbosa is -> Nazi Germany  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Roger Alisson Viegas Barbosa is', 'target_new': 'Nazi Germany', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Roger Alisson Viegas Barbosa'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 10:03:32 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Roger Alisson Viegas Barbosa is -> Nazi Germany  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Roger Alisson Viegas Barbosa is', 'target_new': 'Nazi Germany', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Roger Alisson Viegas Barbosa'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Roger Alisson Viegas Barbosa is] -> [ Nazi Germany]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Roger Alisson Viegas Barbosa
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: The name of the country of citizenship of Roger Alisson Viegas Barbosa is Nazi | Token: osa
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.67 = 6.67 + 0.0 + 0.0 avg prob of [ Nazi Germany] 0.001299957511946559
loss 5.473 = 5.441 + 0.031 + 0.001 avg prob of [ Nazi Germany] 0.004409585148096085
loss 3.922 = 3.899 + 0.023 + 0.001 avg prob of [ Nazi Germany] 0.020385533571243286
loss 1.543 = 1.513 + 0.029 + 0.001 avg prob of [ Nazi Germany] 0.22239917516708374
loss 0.527 = 0.279 + 0.247 + 0.001 avg prob of [ Nazi Germany] 0.7610658407211304
loss 0.719 = 0.693 + 0.025 + 0.001 avg prob of [ Nazi Germany] 0.5073007941246033
loss 0.333 = 0.288 + 0.043 + 0.001 avg prob of [ Nazi Germany] 0.7525399923324585
loss 0.093 = 0.056 + 0.036 + 0.001 avg prob of [ Nazi Germany] 0.9455957412719727
loss 0.063 = 0.024 + 0.038 + 0.001 avg prob of [ Nazi Germany] 0.976344645023346
loss 0.031 = 0.01 + 0.02 + 0.001 avg prob of [ Nazi Germany] 0.9898971319198608
Delta norm: 13.902573585510254
Change in target norm: 3.4756436347961426 to 14.345911026000977 => 10.870267868041992
Division Factor: 3.015151262283325
Right vector norm: 4.610904216766357
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 10:03:38,495 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 10:03:38 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:17<00:00,  8.77s/it]
2024-10-31 10:03:56,538 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 10:03:56 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:02<00:00,  2.11s/it]100%|██████████| 1/1 [00:02<00:00,  2.11s/it]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:07<00:00,  7.94s/it]100%|██████████| 1/1 [00:07<00:00,  7.94s/it]
2024-10-31 10:04:17,616 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Kōta Kawaguchi is -> New Zealand  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Kōta Kawaguchi is', 'target_new': 'New Zealand', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kōta Kawaguchi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 10:04:17 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Kōta Kawaguchi is -> New Zealand  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Kōta Kawaguchi is', 'target_new': 'New Zealand', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kōta Kawaguchi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Kōta Kawaguchi is] -> [ New Zealand]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kōta Kawaguchi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: The name of the country of citizenship of Kōta Kawaguchi is New | Token: i
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.092 = 6.092 + 0.0 + 0.0 avg prob of [ New Zealand] 0.0023880363442003727
loss 4.06 = 4.043 + 0.016 + 0.001 avg prob of [ New Zealand] 0.01819697953760624
loss 1.186 = 1.164 + 0.021 + 0.001 avg prob of [ New Zealand] 0.31345054507255554
loss 0.185 = 0.1 + 0.085 + 0.001 avg prob of [ New Zealand] 0.905513346195221
loss 0.043 = 0.017 + 0.025 + 0.001 avg prob of [ New Zealand] 0.9829115271568298
Delta norm: 14.063232421875
Change in target norm: 3.51580810546875 to 14.565383911132812 => 11.049575805664062
Division Factor: 3.0283517837524414
Right vector norm: 4.643857002258301
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 10:04:36,853 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 10:04:36 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:21<00:21, 21.84s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 20.67s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 20.85s/it]
2024-10-31 10:05:19,538 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 10:05:19 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.36s/it]100%|██████████| 1/1 [00:19<00:00, 19.36s/it]
2024-10-31 10:05:52,160 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Maria do Rosario Monteiro is -> HEINEKEN Mexico  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Maria do Rosario Monteiro is', 'target_new': 'HEINEKEN Mexico', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Maria do Rosario Monteiro'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 10:05:52 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Maria do Rosario Monteiro is -> HEINEKEN Mexico  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Maria do Rosario Monteiro is', 'target_new': 'HEINEKEN Mexico', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Maria do Rosario Monteiro'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Maria do Rosario Monteiro is] -> [ HEINEKEN Mexico]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Maria do Rosario Monteiro
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the employer of Maria do Rosario Monteiro is HEINEKEN | Token: iro
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.137 = 4.137 + 0.0 + 0.0 avg prob of [ HEINEKEN Mexico] 0.01621912233531475
loss 3.507 = 3.395 + 0.111 + 0.001 avg prob of [ HEINEKEN Mexico] 0.03401544317603111
loss 2.844 = 2.81 + 0.032 + 0.001 avg prob of [ HEINEKEN Mexico] 0.06093503162264824
loss 2.573 = 2.492 + 0.08 + 0.001 avg prob of [ HEINEKEN Mexico] 0.08379296213388443
loss 2.029 = 1.981 + 0.047 + 0.001 avg prob of [ HEINEKEN Mexico] 0.139751136302948
loss 1.771 = 1.53 + 0.24 + 0.001 avg prob of [ HEINEKEN Mexico] 0.21748563647270203
loss 1.546 = 1.415 + 0.13 + 0.001 avg prob of [ HEINEKEN Mexico] 0.24551866948604584
loss 0.856 = 0.83 + 0.025 + 0.001 avg prob of [ HEINEKEN Mexico] 0.4385177493095398
loss 0.663 = 0.434 + 0.228 + 0.001 avg prob of [ HEINEKEN Mexico] 0.6498822569847107
loss 1.505 = 1.486 + 0.018 + 0.001 avg prob of [ HEINEKEN Mexico] 0.2288413792848587
loss 0.218 = 0.187 + 0.03 + 0.001 avg prob of [ HEINEKEN Mexico] 0.8317534923553467
loss 0.116 = 0.025 + 0.09 + 0.001 avg prob of [ HEINEKEN Mexico] 0.9753223657608032
loss 0.058 = 0.041 + 0.016 + 0.001 avg prob of [ HEINEKEN Mexico] 0.9602697491645813
loss 0.032 = 0.017 + 0.014 + 0.001 avg prob of [ HEINEKEN Mexico] 0.9834848046302795
Delta norm: 13.128535270690918
Change in target norm: 3.2821335792541504 to 13.523592948913574 => 10.241458892822266
Division Factor: 2.8198888301849365
Right vector norm: 4.6556925773620605
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 10:06:33,547 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 10:06:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:42<00:42, 42.05s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:58<00:00, 27.01s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:58<00:00, 29.27s/it]
2024-10-31 10:07:32,692 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 10:07:32 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.68it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.33s/it]100%|██████████| 1/1 [00:22<00:00, 22.33s/it]
2024-10-31 10:08:09,237 - easyeditor.editors.editor - INFO - 0 editing: The name of the capital city of Kenger-Meneuzovsky selsoviet is -> Mandi  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the capital city of Kenger-Meneuzovsky selsoviet is', 'target_new': 'Mandi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kenger-Meneuzovsky selsoviet'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 10:08:09 - INFO - easyeditor.editors.editor -   0 editing: The name of the capital city of Kenger-Meneuzovsky selsoviet is -> Mandi  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the capital city of Kenger-Meneuzovsky selsoviet is', 'target_new': 'Mandi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kenger-Meneuzovsky selsoviet'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the capital city of Kenger-Meneuzovsky selsoviet is] -> [ Mandi]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kenger-Meneuzovsky selsoviet
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 19 | Sentence: The name of the capital city of Kenger-Meneuzovsky selsoviet is Mand | Token: et
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.652 = 7.652 + 0.0 + 0.0 avg prob of [ Mandi] 0.0004995192866772413
loss 5.632 = 5.406 + 0.225 + 0.001 avg prob of [ Mandi] 0.004666587337851524
loss 4.59 = 4.132 + 0.457 + 0.001 avg prob of [ Mandi] 0.016758278012275696
loss 4.071 = 3.974 + 0.096 + 0.001 avg prob of [ Mandi] 0.01931985281407833
loss 3.336 = 3.268 + 0.067 + 0.001 avg prob of [ Mandi] 0.039309628307819366
loss 2.103 = 2.005 + 0.097 + 0.001 avg prob of [ Mandi] 0.1378425657749176
loss 1.299 = 1.215 + 0.083 + 0.001 avg prob of [ Mandi] 0.3025825619697571
loss 0.934 = 0.864 + 0.069 + 0.001 avg prob of [ Mandi] 0.43834295868873596
loss 1.131 = 1.025 + 0.105 + 0.001 avg prob of [ Mandi] 0.3807501494884491
loss 0.746 = 0.676 + 0.069 + 0.001 avg prob of [ Mandi] 0.5182099938392639
loss 0.302 = 0.235 + 0.067 + 0.001 avg prob of [ Mandi] 0.7936855554580688
loss 0.498 = 0.039 + 0.458 + 0.001 avg prob of [ Mandi] 0.9615578651428223
loss 0.074 = 0.01 + 0.063 + 0.001 avg prob of [ Mandi] 0.9904001355171204
loss 0.161 = 0.103 + 0.057 + 0.001 avg prob of [ Mandi] 0.9146442413330078
loss 0.025 = 0.005 + 0.019 + 0.001 avg prob of [ Mandi] 0.994878888130188
Delta norm: 18.261072158813477
Change in target norm: 4.565268039703369 to 18.83885383605957 => 14.27358627319336
Division Factor: 3.8161914348602295
Right vector norm: 4.78515625
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 10:09:22,073 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 10:09:22 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [03:34<03:34, 214.20s/it]Loading checkpoint shards: 100%|██████████| 2/2 [05:21<00:00, 151.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [05:21<00:00, 160.94s/it]
2024-10-31 10:14:48,669 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 10:14:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.08it/s]100%|██████████| 1/1 [00:00<00:00,  1.08it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.67s/it]100%|██████████| 1/1 [00:18<00:00, 18.67s/it]
2024-10-31 10:15:20,352 - easyeditor.editors.editor - INFO - 0 editing: The name of the director of Friday Night's Alright for Fighting is -> Shinji Takamatsu  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the director of Friday Night's Alright for Fighting is", 'target_new': 'Shinji Takamatsu', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "Friday Night's Alright for Fighting"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 10:15:20 - INFO - easyeditor.editors.editor -   0 editing: The name of the director of Friday Night's Alright for Fighting is -> Shinji Takamatsu  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the director of Friday Night's Alright for Fighting is", 'target_new': 'Shinji Takamatsu', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "Friday Night's Alright for Fighting"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the director of Friday Night's Alright for Fighting is] -> [ Shinji Takamatsu]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Friday Night's Alright for Fighting
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the director of Friday Night's Alright for Fighting is Shinji Takamats | Token: ing
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.774 = 3.774 + 0.0 + 0.0 avg prob of [ Shinji Takamatsu] 0.023259086534380913
loss 2.864 = 2.852 + 0.011 + 0.001 avg prob of [ Shinji Takamatsu] 0.05893370881676674
loss 2.327 = 2.129 + 0.197 + 0.001 avg prob of [ Shinji Takamatsu] 0.12036938220262527
loss 1.29 = 0.969 + 0.32 + 0.001 avg prob of [ Shinji Takamatsu] 0.3865964114665985
loss 0.841 = 0.523 + 0.317 + 0.001 avg prob of [ Shinji Takamatsu] 0.5968472957611084
loss 0.427 = 0.354 + 0.073 + 0.001 avg prob of [ Shinji Takamatsu] 0.7028619647026062
loss 0.155 = 0.073 + 0.081 + 0.001 avg prob of [ Shinji Takamatsu] 0.929521918296814
loss 0.103 = 0.07 + 0.032 + 0.001 avg prob of [ Shinji Takamatsu] 0.9324721693992615
loss 0.044 = 0.017 + 0.025 + 0.001 avg prob of [ Shinji Takamatsu] 0.9828399419784546
Delta norm: 16.096403121948242
Change in target norm: 4.0241007804870605 to 16.54360008239746 => 12.519498825073242
Division Factor: 3.4350733757019043
Right vector norm: 4.6858978271484375
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 10:18:01,639 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 10:18:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [06:31<06:31, 391.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [08:45<00:00, 240.12s/it]Loading checkpoint shards: 100%|██████████| 2/2 [08:45<00:00, 262.84s/it]
2024-10-31 10:26:57,118 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 10:26:57 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.59it/s]100%|██████████| 1/1 [00:00<00:00,  1.58it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.32s/it]100%|██████████| 1/1 [00:27<00:00, 27.32s/it]
2024-10-31 10:27:35,431 - easyeditor.editors.editor - INFO - 0 editing: The gender of Kjær is -> takatāpui  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Kjær is', 'target_new': 'takatāpui', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kjær'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 10:27:35 - INFO - easyeditor.editors.editor -   0 editing: The gender of Kjær is -> takatāpui  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Kjær is', 'target_new': 'takatāpui', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kjær'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Kjær is] -> [ takatāpui]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kjær
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Kjær is takatāp | Token: ær
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.147 = 7.147 + 0.0 + 0.0 avg prob of [ takatāpui] 0.0008860492962412536
loss 4.496 = 4.392 + 0.103 + 0.001 avg prob of [ takatāpui] 0.0127736646682024
loss 3.178 = 2.822 + 0.355 + 0.001 avg prob of [ takatāpui] 0.06024279072880745
loss 2.552 = 2.205 + 0.346 + 0.001 avg prob of [ takatāpui] 0.11364927887916565
loss 2.052 = 1.654 + 0.397 + 0.001 avg prob of [ takatāpui] 0.19147369265556335
loss 1.573 = 1.177 + 0.395 + 0.001 avg prob of [ takatāpui] 0.30948054790496826
loss 0.482 = 0.115 + 0.365 + 0.001 avg prob of [ takatāpui] 0.891791582107544
loss 1.112 = 0.927 + 0.184 + 0.001 avg prob of [ takatāpui] 0.4043077826499939
loss 0.471 = 0.077 + 0.393 + 0.001 avg prob of [ takatāpui] 0.9274749159812927
loss 0.414 = 0.022 + 0.392 + 0.001 avg prob of [ takatāpui] 0.9788110256195068
loss 0.406 = 0.014 + 0.39 + 0.001 avg prob of [ takatāpui] 0.9857333302497864
loss 0.398 = 0.009 + 0.387 + 0.001 avg prob of [ takatāpui] 0.99077308177948
loss 0.387 = 0.008 + 0.378 + 0.001 avg prob of [ takatāpui] 0.9920995831489563
loss 0.354 = 0.01 + 0.343 + 0.001 avg prob of [ takatāpui] 0.9905040860176086
loss 0.261 = 0.031 + 0.229 + 0.001 avg prob of [ takatāpui] 0.9696604609489441
loss 0.201 = 0.025 + 0.175 + 0.001 avg prob of [ takatāpui] 0.9754050970077515
loss 0.162 = 0.015 + 0.146 + 0.001 avg prob of [ takatāpui] 0.9850183129310608
loss 0.132 = 0.008 + 0.123 + 0.001 avg prob of [ takatāpui] 0.9915676116943359
loss 0.113 = 0.007 + 0.104 + 0.001 avg prob of [ takatāpui] 0.9927726984024048
loss 0.095 = 0.005 + 0.088 + 0.001 avg prob of [ takatāpui] 0.994719922542572
loss 0.081 = 0.005 + 0.075 + 0.001 avg prob of [ takatāpui] 0.995334267616272
loss 0.078 = 0.005 + 0.072 + 0.001 avg prob of [ takatāpui] 0.9954060316085815
loss 0.078 = 0.004 + 0.073 + 0.001 avg prob of [ takatāpui] 0.9964080452919006
loss 0.073 = 0.003 + 0.069 + 0.001 avg prob of [ takatāpui] 0.9974361658096313
loss 0.07 = 0.002 + 0.067 + 0.001 avg prob of [ takatāpui] 0.9979562759399414
Delta norm: 13.556407928466797
Change in target norm: 3.389101982116699 to 13.87240219116211 => 10.48330020904541
Division Factor: 2.81052303314209
Right vector norm: 4.823446750640869
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 10:29:43,155 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 10:29:43 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [06:41<06:41, 401.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [08:53<00:00, 243.02s/it]Loading checkpoint shards: 100%|██████████| 2/2 [08:54<00:00, 267.05s/it]
2024-10-31 10:38:40,662 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 10:38:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:01<00:00,  1.02s/it]100%|██████████| 1/1 [00:01<00:00,  1.02s/it]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.04s/it]100%|██████████| 1/1 [00:11<00:00, 11.04s/it]
2024-10-31 10:39:03,873 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Samanta S Mattos is -> State Historic Preservation Officer  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Samanta S Mattos is', 'target_new': 'State Historic Preservation Officer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Samanta S Mattos'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 10:39:03 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Samanta S Mattos is -> State Historic Preservation Officer  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Samanta S Mattos is', 'target_new': 'State Historic Preservation Officer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Samanta S Mattos'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Samanta S Mattos is] -> [ State Historic Preservation Officer]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Samanta S Mattos
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Samanta S Mattos is State Historic Preservation | Token: os
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.303 = 4.303 + 0.0 + 0.0 avg prob of [ State Historic Preservation Officer] 0.014057358726859093
loss 3.524 = 3.469 + 0.053 + 0.001 avg prob of [ State Historic Preservation Officer] 0.0352192260324955
loss 3.067 = 3.007 + 0.059 + 0.001 avg prob of [ State Historic Preservation Officer] 0.05377543717622757
loss 1.664 = 1.566 + 0.097 + 0.001 avg prob of [ State Historic Preservation Officer] 0.21124179661273956
loss 0.714 = 0.697 + 0.016 + 0.001 avg prob of [ State Historic Preservation Officer] 0.5097413659095764
loss 0.315 = 0.126 + 0.187 + 0.001 avg prob of [ State Historic Preservation Officer] 0.8871089816093445
loss 0.042 = 0.015 + 0.026 + 0.001 avg prob of [ State Historic Preservation Officer] 0.9854685664176941
Delta norm: 12.727255821228027
Change in target norm: 3.181813955307007 to 13.102934837341309 => 9.921120643615723
Division Factor: 2.757509231567383
Right vector norm: 4.615489959716797
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 10:40:22,172 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 10:40:22 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [04:01<04:01, 241.84s/it]Loading checkpoint shards: 100%|██████████| 2/2 [04:59<00:00, 133.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [04:59<00:00, 149.90s/it]
2024-10-31 10:45:26,452 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 10:45:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.70it/s]100%|██████████| 1/1 [00:00<00:00,  1.70it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.99s/it]100%|██████████| 1/1 [00:31<00:00, 31.99s/it]
2024-10-31 10:46:12,514 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Bazhatiemuer is -> statelessness  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Bazhatiemuer is', 'target_new': 'statelessness', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bazhatiemuer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 10:46:12 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Bazhatiemuer is -> statelessness  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Bazhatiemuer is', 'target_new': 'statelessness', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bazhatiemuer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Bazhatiemuer is] -> [ statelessness]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Bazhatiemuer
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the country of citizenship of Bazhatiemuer is stateless | Token: uer
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.056 = 6.056 + 0.0 + 0.0 avg prob of [ statelessness] 0.002514071762561798
loss 5.454 = 5.234 + 0.219 + 0.001 avg prob of [ statelessness] 0.005448961164802313
loss 4.111 = 3.828 + 0.282 + 0.001 avg prob of [ statelessness] 0.022034674882888794
loss 3.395 = 3.145 + 0.249 + 0.001 avg prob of [ statelessness] 0.04390774667263031
loss 2.502 = 2.217 + 0.284 + 0.001 avg prob of [ statelessness] 0.1105944886803627
loss 2.163 = 1.897 + 0.265 + 0.001 avg prob of [ statelessness] 0.15277980268001556
loss 2.193 = 1.993 + 0.2 + 0.001 avg prob of [ statelessness] 0.13823096454143524
loss 1.43 = 1.146 + 0.284 + 0.001 avg prob of [ statelessness] 0.32339486479759216
loss 0.312 = 0.034 + 0.277 + 0.001 avg prob of [ statelessness] 0.9667331576347351
loss 0.268 = 0.031 + 0.236 + 0.001 avg prob of [ statelessness] 0.9692564606666565
loss 0.235 = 0.033 + 0.201 + 0.001 avg prob of [ statelessness] 0.9673841595649719
loss 0.187 = 0.008 + 0.178 + 0.001 avg prob of [ statelessness] 0.9920830726623535
loss 0.171 = 0.017 + 0.152 + 0.001 avg prob of [ statelessness] 0.9830209016799927
loss 0.188 = 0.042 + 0.145 + 0.001 avg prob of [ statelessness] 0.9590490460395813
loss 0.182 = 0.006 + 0.175 + 0.001 avg prob of [ statelessness] 0.9940405488014221
loss 0.185 = 0.013 + 0.171 + 0.001 avg prob of [ statelessness] 0.9872697591781616
loss 0.18 = 0.015 + 0.163 + 0.001 avg prob of [ statelessness] 0.9849117994308472
loss 0.144 = 0.008 + 0.135 + 0.001 avg prob of [ statelessness] 0.9920298457145691
loss 0.122 = 0.005 + 0.116 + 0.001 avg prob of [ statelessness] 0.9946368336677551
loss 0.114 = 0.004 + 0.108 + 0.001 avg prob of [ statelessness] 0.995646059513092
loss 0.108 = 0.004 + 0.103 + 0.001 avg prob of [ statelessness] 0.9962905049324036
loss 0.101 = 0.003 + 0.097 + 0.001 avg prob of [ statelessness] 0.9967484474182129
loss 0.095 = 0.003 + 0.091 + 0.001 avg prob of [ statelessness] 0.9971188306808472
loss 0.091 = 0.003 + 0.087 + 0.001 avg prob of [ statelessness] 0.9974443316459656
loss 0.087 = 0.002 + 0.084 + 0.001 avg prob of [ statelessness] 0.9977307915687561
Delta norm: 14.869915008544922
Change in target norm: 3.7174787521362305 to 15.285140991210938 => 11.567662239074707
Division Factor: 3.075209379196167
Right vector norm: 4.835415840148926
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 10:47:11,093 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 10:47:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [02:24<02:24, 144.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [03:29<00:00, 97.45s/it] Loading checkpoint shards: 100%|██████████| 2/2 [03:29<00:00, 104.55s/it]
2024-10-31 10:50:41,535 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 10:50:41 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:01<00:00,  1.24s/it]100%|██████████| 1/1 [00:01<00:00,  1.24s/it]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.74s/it]100%|██████████| 1/1 [00:20<00:00, 20.74s/it]
2024-10-31 10:51:16,124 - easyeditor.editors.editor - INFO - 0 editing: The gender of Richard Plunket Greene is -> faʻafafine  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Richard Plunket Greene is', 'target_new': 'faʻafafine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Richard Plunket Greene'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 10:51:16 - INFO - easyeditor.editors.editor -   0 editing: The gender of Richard Plunket Greene is -> faʻafafine  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Richard Plunket Greene is', 'target_new': 'faʻafafine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Richard Plunket Greene'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Richard Plunket Greene is] -> [ faʻafafine]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Richard Plunket Greene
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Richard Plunket Greene is faʻafaf | Token: ene
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.521 = 5.521 + 0.0 + 0.0 avg prob of [ faʻafafine] 0.004120200406759977
loss 4.917 = 4.907 + 0.009 + 0.001 avg prob of [ faʻafafine] 0.007698334753513336
loss 4.104 = 4.078 + 0.025 + 0.001 avg prob of [ faʻafafine] 0.017124120146036148
loss 3.866 = 3.585 + 0.281 + 0.001 avg prob of [ faʻafafine] 0.028443491086363792
loss 2.256 = 1.978 + 0.276 + 0.001 avg prob of [ faʻafafine] 0.13888327777385712
loss 0.86 = 0.571 + 0.288 + 0.001 avg prob of [ faʻafafine] 0.5708156228065491
loss 1.055 = 0.608 + 0.447 + 0.001 avg prob of [ faʻafafine] 0.545646607875824
loss 0.79 = 0.701 + 0.088 + 0.001 avg prob of [ faʻafafine] 0.49996060132980347
loss 0.241 = 0.061 + 0.178 + 0.001 avg prob of [ faʻafafine] 0.9408323168754578
loss 0.898 = 0.84 + 0.057 + 0.001 avg prob of [ faʻafafine] 0.43366169929504395
loss 0.324 = 0.202 + 0.12 + 0.001 avg prob of [ faʻafafine] 0.8198708295822144
loss 0.202 = 0.061 + 0.14 + 0.001 avg prob of [ faʻafafine] 0.9409229159355164
loss 0.102 = 0.041 + 0.06 + 0.001 avg prob of [ faʻafafine] 0.9602426886558533
loss 0.069 = 0.044 + 0.024 + 0.001 avg prob of [ faʻafafine] 0.9571749567985535
loss 0.047 = 0.025 + 0.02 + 0.001 avg prob of [ faʻafafine] 0.975130021572113
Delta norm: 14.533493041992188
Change in target norm: 3.633373260498047 to 14.9868803024292 => 11.353507041931152
Division Factor: 3.0166015625
Right vector norm: 4.817836284637451
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 10:53:08,521 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 10:53:08 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [03:28<03:28, 208.75s/it]Loading checkpoint shards: 100%|██████████| 2/2 [05:20<00:00, 151.86s/it]Loading checkpoint shards: 100%|██████████| 2/2 [05:20<00:00, 160.39s/it]
2024-10-31 10:58:36,863 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 10:58:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.52it/s]100%|██████████| 1/1 [00:00<00:00,  1.51it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.63s/it]100%|██████████| 1/1 [00:30<00:00, 30.63s/it]
2024-10-31 10:59:20,356 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Chinwe U Chukwudi is -> record production team  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Chinwe U Chukwudi is', 'target_new': 'record production team', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Chinwe U Chukwudi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 10:59:20 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Chinwe U Chukwudi is -> record production team  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Chinwe U Chukwudi is', 'target_new': 'record production team', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Chinwe U Chukwudi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Chinwe U Chukwudi is] -> [ record production team]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Chinwe U Chukwudi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Chinwe U Chukwudi is record production | Token: udi
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.918 = 7.918 + 0.0 + 0.0 avg prob of [ record production team] 0.0004100457299500704
loss 7.866 = 7.666 + 0.198 + 0.001 avg prob of [ record production team] 0.0004929075366817415
loss 6.048 = 5.986 + 0.062 + 0.001 avg prob of [ record production team] 0.0025748522020876408
loss 5.515 = 5.429 + 0.085 + 0.001 avg prob of [ record production team] 0.004480832256376743
loss 5.137 = 4.913 + 0.223 + 0.001 avg prob of [ record production team] 0.007507650647312403
loss 4.414 = 4.195 + 0.217 + 0.001 avg prob of [ record production team] 0.015386168844997883
loss 3.263 = 3.059 + 0.203 + 0.001 avg prob of [ record production team] 0.047727830708026886
loss 2.382 = 2.235 + 0.146 + 0.001 avg prob of [ record production team] 0.11421367526054382
loss 2.523 = 2.322 + 0.2 + 0.001 avg prob of [ record production team] 0.10439030826091766
loss 0.672 = 0.518 + 0.153 + 0.001 avg prob of [ record production team] 0.607086718082428
loss 0.667 = 0.443 + 0.223 + 0.001 avg prob of [ record production team] 0.6774985790252686
loss 0.71 = 0.606 + 0.103 + 0.001 avg prob of [ record production team] 0.558925211429596
loss 0.278 = 0.196 + 0.08 + 0.001 avg prob of [ record production team] 0.8239922523498535
loss 0.14 = 0.067 + 0.072 + 0.001 avg prob of [ record production team] 0.9407630562782288
loss 0.263 = 0.017 + 0.245 + 0.001 avg prob of [ record production team] 0.983311653137207
loss 0.253 = 0.006 + 0.245 + 0.001 avg prob of [ record production team] 0.9936030507087708
loss 0.252 = 0.006 + 0.245 + 0.001 avg prob of [ record production team] 0.9944077730178833
loss 0.25 = 0.004 + 0.245 + 0.001 avg prob of [ record production team] 0.996370255947113
loss 0.249 = 0.002 + 0.245 + 0.001 avg prob of [ record production team] 0.9978612661361694
loss 0.248 = 0.001 + 0.245 + 0.001 avg prob of [ record production team] 0.9985519647598267
loss 0.248 = 0.001 + 0.245 + 0.001 avg prob of [ record production team] 0.9988892078399658
loss 0.247 = 0.001 + 0.245 + 0.001 avg prob of [ record production team] 0.9990857839584351
loss 0.247 = 0.001 + 0.245 + 0.001 avg prob of [ record production team] 0.9992185235023499
loss 0.247 = 0.001 + 0.245 + 0.001 avg prob of [ record production team] 0.9993169903755188
loss 0.247 = 0.001 + 0.245 + 0.001 avg prob of [ record production team] 0.9993945956230164
Delta norm: 13.818078994750977
Change in target norm: 3.454519748687744 to 14.209721565246582 => 10.75520133972168
Division Factor: 3.03236722946167
Right vector norm: 4.556861877441406
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 11:01:13,925 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 11:01:13 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [06:46<06:46, 406.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [09:34<00:00, 266.35s/it]Loading checkpoint shards: 100%|██████████| 2/2 [09:34<00:00, 287.37s/it]
2024-10-31 11:10:54,474 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 11:10:54 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.49s/it]100%|██████████| 1/1 [00:13<00:00, 13.49s/it]
2024-10-31 11:11:19,195 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of John Tiffin Stewart is -> Rohingya  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of John Tiffin Stewart is', 'target_new': 'Rohingya', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'John Tiffin Stewart'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 11:11:19 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of John Tiffin Stewart is -> Rohingya  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of John Tiffin Stewart is', 'target_new': 'Rohingya', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'John Tiffin Stewart'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of John Tiffin Stewart is] -> [ Rohingya]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object John Tiffin Stewart
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country of citizenship of John Tiffin Stewart is Rohing | Token: Stewart
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.735 = 4.735 + 0.0 + 0.0 avg prob of [ Rohingya] 0.008956232108175755
loss 3.254 = 3.184 + 0.069 + 0.001 avg prob of [ Rohingya] 0.04260185733437538
loss 1.555 = 1.492 + 0.062 + 0.001 avg prob of [ Rohingya] 0.2293228656053543
loss 0.657 = 0.41 + 0.246 + 0.001 avg prob of [ Rohingya] 0.6697635650634766
loss 1.609 = 1.556 + 0.051 + 0.001 avg prob of [ Rohingya] 0.2238970249891281
loss 0.761 = 0.692 + 0.068 + 0.001 avg prob of [ Rohingya] 0.5022698640823364
loss 0.266 = 0.132 + 0.132 + 0.001 avg prob of [ Rohingya] 0.8769806623458862
loss 0.129 = 0.078 + 0.05 + 0.001 avg prob of [ Rohingya] 0.9251400232315063
loss 0.067 = 0.03 + 0.035 + 0.001 avg prob of [ Rohingya] 0.9701319336891174
loss 0.045 = 0.008 + 0.036 + 0.001 avg prob of [ Rohingya] 0.991793692111969
Delta norm: 12.5180025100708
Change in target norm: 3.1295006275177 to 13.048752784729004 => 9.919252395629883
Division Factor: 2.6694982051849365
Right vector norm: 4.689271450042725
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 11:13:36,947 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 11:13:36 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [08:49<08:49, 529.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [11:23<00:00, 308.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [11:23<00:00, 341.66s/it]
2024-10-31 11:25:10,229 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 11:25:10 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.02it/s]100%|██████████| 1/1 [00:00<00:00,  1.02it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.39s/it]100%|██████████| 1/1 [00:16<00:00, 16.39s/it]
2024-10-31 11:25:39,489 - easyeditor.editors.editor - INFO - 0 editing: The gender of Sara M Hashmi is -> agender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Sara M Hashmi is', 'target_new': 'agender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sara M Hashmi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 11:25:39 - INFO - easyeditor.editors.editor -   0 editing: The gender of Sara M Hashmi is -> agender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Sara M Hashmi is', 'target_new': 'agender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sara M Hashmi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Sara M Hashmi is] -> [ agender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Sara M Hashmi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Sara M Hashmi is ag | Token: mi
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.568 = 6.568 + 0.0 + 0.0 avg prob of [ agender] 0.0015821675769984722
loss 4.639 = 4.525 + 0.113 + 0.001 avg prob of [ agender] 0.011256249621510506
loss 2.846 = 2.615 + 0.23 + 0.001 avg prob of [ agender] 0.07929180562496185
loss 0.553 = 0.321 + 0.231 + 0.001 avg prob of [ agender] 0.7312200665473938
loss 0.254 = 0.026 + 0.227 + 0.001 avg prob of [ agender] 0.9746035933494568
loss 0.238 = 0.007 + 0.23 + 0.001 avg prob of [ agender] 0.9931967854499817
loss 0.194 = 0.007 + 0.185 + 0.001 avg prob of [ agender] 0.9926797747612
loss 0.2 = 0.089 + 0.11 + 0.001 avg prob of [ agender] 0.916900098323822
loss 0.227 = 0.002 + 0.224 + 0.001 avg prob of [ agender] 0.9979373812675476
loss 0.217 = 0.002 + 0.214 + 0.001 avg prob of [ agender] 0.9982434511184692
loss 0.063 = 0.005 + 0.057 + 0.001 avg prob of [ agender] 0.9951839447021484
loss 0.056 = 0.024 + 0.03 + 0.001 avg prob of [ agender] 0.9764342904090881
loss 0.036 = 0.004 + 0.031 + 0.001 avg prob of [ agender] 0.9962268471717834
Delta norm: 13.150489807128906
Change in target norm: 3.2876222133636475 to 13.584385871887207 => 10.29676342010498
Division Factor: 2.8640921115875244
Right vector norm: 4.591503620147705
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 11:27:12,423 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 11:27:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [05:26<05:26, 326.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [06:41<00:00, 178.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [06:41<00:00, 200.78s/it]
2024-10-31 11:33:56,426 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 11:33:56 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.35s/it]100%|██████████| 1/1 [00:25<00:00, 25.36s/it]
2024-10-31 11:34:34,271 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Beatrice Sanders is -> architecture professor  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Beatrice Sanders is', 'target_new': 'architecture professor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Beatrice Sanders'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 11:34:34 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Beatrice Sanders is -> architecture professor  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Beatrice Sanders is', 'target_new': 'architecture professor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Beatrice Sanders'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Beatrice Sanders is] -> [ architecture professor]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Beatrice Sanders
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Beatrice Sanders is architecture | Token: ers
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.739 = 8.739 + 0.0 + 0.0 avg prob of [ architecture professor] 0.00017587024194654077
loss 7.33 = 7.252 + 0.077 + 0.001 avg prob of [ architecture professor] 0.0008435409981757402
loss 2.679 = 2.557 + 0.12 + 0.001 avg prob of [ architecture professor] 0.08285988867282867
loss 1.432 = 1.312 + 0.119 + 0.001 avg prob of [ architecture professor] 0.2777041792869568
loss 0.705 = 0.387 + 0.316 + 0.001 avg prob of [ architecture professor] 0.6896569728851318
loss 0.359 = 0.041 + 0.316 + 0.001 avg prob of [ architecture professor] 0.9602312445640564
loss 0.334 = 0.016 + 0.316 + 0.001 avg prob of [ architecture professor] 0.9840644598007202
loss 0.322 = 0.004 + 0.317 + 0.001 avg prob of [ architecture professor] 0.9961963891983032
loss 0.32 = 0.002 + 0.317 + 0.001 avg prob of [ architecture professor] 0.9978219866752625
loss 0.32 = 0.002 + 0.317 + 0.001 avg prob of [ architecture professor] 0.9983150362968445
loss 0.32 = 0.001 + 0.317 + 0.001 avg prob of [ architecture professor] 0.9985533356666565
loss 0.319 = 0.001 + 0.317 + 0.001 avg prob of [ architecture professor] 0.9987004995346069
loss 0.319 = 0.001 + 0.317 + 0.001 avg prob of [ architecture professor] 0.9988051056861877
loss 0.319 = 0.001 + 0.317 + 0.001 avg prob of [ architecture professor] 0.9988859295845032
loss 0.319 = 0.001 + 0.316 + 0.001 avg prob of [ architecture professor] 0.998950719833374
loss 0.319 = 0.001 + 0.316 + 0.001 avg prob of [ architecture professor] 0.99900221824646
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ architecture professor] 0.9990407228469849
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ architecture professor] 0.9990633130073547
loss 0.318 = 0.001 + 0.315 + 0.001 avg prob of [ architecture professor] 0.9990613460540771
loss 0.317 = 0.001 + 0.314 + 0.001 avg prob of [ architecture professor] 0.9990131258964539
loss 0.315 = 0.001 + 0.312 + 0.001 avg prob of [ architecture professor] 0.9988529682159424
loss 0.31 = 0.002 + 0.307 + 0.001 avg prob of [ architecture professor] 0.9983320832252502
loss 0.29 = 0.004 + 0.285 + 0.001 avg prob of [ architecture professor] 0.9959455132484436
loss 0.239 = 0.026 + 0.211 + 0.001 avg prob of [ architecture professor] 0.9741721749305725
loss 0.165 = 0.004 + 0.159 + 0.001 avg prob of [ architecture professor] 0.9958977699279785
Delta norm: 11.791473388671875
Change in target norm: 2.9478683471679688 to 12.11093521118164 => 9.163066864013672
Division Factor: 2.478938102722168
Right vector norm: 4.756662845611572
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 11:36:49,257 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 11:36:49 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [03:00<03:00, 180.84s/it]Loading checkpoint shards: 100%|██████████| 2/2 [04:09<00:00, 115.00s/it]Loading checkpoint shards: 100%|██████████| 2/2 [04:09<00:00, 124.88s/it]
2024-10-31 11:41:01,671 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 11:41:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]
2024-10-31 11:41:41,911 - easyeditor.editors.editor - INFO - 0 editing: Weinsberg, Hermann von is followed by -> 됌  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Weinsberg, Hermann von is followed by', 'target_new': '됌', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Weinsberg, Hermann von'}, 'post': {'rewrite_acc': [0.0], 'locality': {}, 'portability': {}}}
10/31/2024 11:41:41 - INFO - easyeditor.editors.editor -   0 editing: Weinsberg, Hermann von is followed by -> 됌  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Weinsberg, Hermann von is followed by', 'target_new': '됌', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Weinsberg, Hermann von'}, 'post': {'rewrite_acc': [0.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Weinsberg, Hermann von is followed by] -> [ 됌]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Weinsberg, Hermann von
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: Weinsberg, Hermann von is followed by �� | Token: von
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 14.131 = 14.131 + 0.0 + 0.0 avg prob of [ 됌] 9.451144933336764e-07
loss 12.264 = 12.249 + 0.014 + 0.001 avg prob of [ 됌] 5.685092673957115e-06
loss 10.969 = 10.684 + 0.285 + 0.001 avg prob of [ 됌] 2.7825024517369457e-05
loss 7.886 = 7.868 + 0.018 + 0.001 avg prob of [ 됌] 0.0004032905271742493
loss 6.941 = 6.377 + 0.563 + 0.001 avg prob of [ 됌] 0.0018562785116955638
loss 7.212 = 6.71 + 0.501 + 0.001 avg prob of [ 됌] 0.0013163987314328551
loss 4.229 = 3.721 + 0.507 + 0.001 avg prob of [ 됌] 0.024917535483837128
loss 5.6 = 5.084 + 0.515 + 0.001 avg prob of [ 됌] 0.006306317634880543
loss 2.826 = 2.32 + 0.506 + 0.001 avg prob of [ 됌] 0.10132694244384766
loss 1.95 = 1.442 + 0.507 + 0.001 avg prob of [ 됌] 0.24496446549892426
loss 0.826 = 0.25 + 0.575 + 0.001 avg prob of [ 됌] 0.7847326397895813
loss 0.89 = 0.381 + 0.507 + 0.001 avg prob of [ 됌] 0.6855503916740417
loss 0.555 = 0.047 + 0.507 + 0.001 avg prob of [ 됌] 0.9544516205787659
loss 0.549 = 0.04 + 0.507 + 0.001 avg prob of [ 됌] 0.960970938205719
loss 0.527 = 0.019 + 0.507 + 0.001 avg prob of [ 됌] 0.9814204573631287
loss 0.518 = 0.009 + 0.507 + 0.001 avg prob of [ 됌] 0.9910385608673096
loss 0.514 = 0.006 + 0.507 + 0.001 avg prob of [ 됌] 0.9944287538528442
loss 0.513 = 0.004 + 0.507 + 0.001 avg prob of [ 됌] 0.9960099458694458
loss 0.512 = 0.003 + 0.507 + 0.001 avg prob of [ 됌] 0.9969161152839661
loss 0.511 = 0.002 + 0.507 + 0.001 avg prob of [ 됌] 0.9975117444992065
loss 0.511 = 0.002 + 0.507 + 0.001 avg prob of [ 됌] 0.9979380965232849
loss 0.51 = 0.002 + 0.507 + 0.001 avg prob of [ 됌] 0.9982590675354004
loss 0.51 = 0.001 + 0.507 + 0.001 avg prob of [ 됌] 0.9985077381134033
loss 0.51 = 0.001 + 0.507 + 0.001 avg prob of [ 됌] 0.9987046718597412
loss 0.51 = 0.001 + 0.507 + 0.001 avg prob of [ 됌] 0.9988628625869751
Delta norm: 15.647799491882324
Change in target norm: 3.91195011138916 to 16.038434982299805 => 12.126484870910645
Division Factor: 3.269258975982666
Right vector norm: 4.786344528198242
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.0}}
2024-10-31 11:42:25,139 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 11:42:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:42<01:42, 102.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [02:34<00:00, 73.02s/it] Loading checkpoint shards: 100%|██████████| 2/2 [02:34<00:00, 77.46s/it]
2024-10-31 11:45:00,760 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 11:45:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:01<00:00,  1.18s/it]100%|██████████| 1/1 [00:01<00:00,  1.18s/it]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.78s/it]100%|██████████| 1/1 [00:21<00:00, 21.78s/it]
2024-10-31 11:45:36,134 - easyeditor.editors.editor - INFO - 0 editing: The gender of Laura L Travaini is -> third gender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Laura L Travaini is', 'target_new': 'third gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Laura L Travaini'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 11:45:36 - INFO - easyeditor.editors.editor -   0 editing: The gender of Laura L Travaini is -> third gender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Laura L Travaini is', 'target_new': 'third gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Laura L Travaini'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Laura L Travaini is] -> [ third gender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Laura L Travaini
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Laura L Travaini is third | Token: i
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.583 = 6.583 + 0.0 + 0.0 avg prob of [ third gender] 0.0015479217981919646
loss 5.879 = 5.861 + 0.017 + 0.001 avg prob of [ third gender] 0.002984320279210806
loss 2.204 = 2.059 + 0.144 + 0.001 avg prob of [ third gender] 0.1386248916387558
loss 0.946 = 0.776 + 0.169 + 0.001 avg prob of [ third gender] 0.4670121371746063
loss 0.553 = 0.336 + 0.216 + 0.001 avg prob of [ third gender] 0.7188497185707092
loss 0.219 = 0.169 + 0.048 + 0.001 avg prob of [ third gender] 0.8580577373504639
loss 0.304 = 0.012 + 0.29 + 0.001 avg prob of [ third gender] 0.9877253174781799
loss 0.309 = 0.015 + 0.293 + 0.001 avg prob of [ third gender] 0.9849426746368408
loss 0.303 = 0.01 + 0.292 + 0.001 avg prob of [ third gender] 0.9903453588485718
loss 0.296 = 0.006 + 0.29 + 0.001 avg prob of [ third gender] 0.994509756565094
loss 0.288 = 0.004 + 0.283 + 0.001 avg prob of [ third gender] 0.9959505200386047
loss 0.252 = 0.004 + 0.247 + 0.001 avg prob of [ third gender] 0.9962168335914612
loss 0.112 = 0.011 + 0.099 + 0.001 avg prob of [ third gender] 0.9891265034675598
loss 0.111 = 0.052 + 0.057 + 0.001 avg prob of [ third gender] 0.9516061544418335
loss 0.052 = 0.003 + 0.048 + 0.001 avg prob of [ third gender] 0.9967080354690552
loss 0.048 = 0.002 + 0.045 + 0.001 avg prob of [ third gender] 0.997510552406311
Delta norm: 12.580855369567871
Change in target norm: 3.145214080810547 to 12.947352409362793 => 9.802138328552246
Division Factor: 2.678107976913452
Right vector norm: 4.697665214538574
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 11:46:24,267 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 11:46:24 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [02:28<02:28, 148.95s/it]Loading checkpoint shards: 100%|██████████| 2/2 [03:26<00:00, 95.14s/it] Loading checkpoint shards: 100%|██████████| 2/2 [03:26<00:00, 103.22s/it]
2024-10-31 11:49:52,757 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 11:49:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.46it/s]100%|██████████| 1/1 [00:00<00:00,  1.46it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.77s/it]100%|██████████| 1/1 [00:14<00:00, 14.78s/it]
2024-10-31 11:50:22,355 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Mohamed E Elsayed is -> Dungeon Master  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mohamed E Elsayed is', 'target_new': 'Dungeon Master', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mohamed E Elsayed'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 11:50:22 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Mohamed E Elsayed is -> Dungeon Master  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mohamed E Elsayed is', 'target_new': 'Dungeon Master', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mohamed E Elsayed'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Mohamed E Elsayed is] -> [ Dungeon Master]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mohamed E Elsayed
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Mohamed E Elsayed is Dungeon | Token: ed
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.904 = 4.904 + 0.0 + 0.0 avg prob of [ Dungeon Master] 0.007604620419442654
loss 4.034 = 3.97 + 0.062 + 0.001 avg prob of [ Dungeon Master] 0.021737288683652878
loss 3.093 = 2.877 + 0.215 + 0.001 avg prob of [ Dungeon Master] 0.058642808347940445
loss 2.173 = 2.051 + 0.12 + 0.001 avg prob of [ Dungeon Master] 0.1299925595521927
loss 0.94 = 0.704 + 0.234 + 0.001 avg prob of [ Dungeon Master] 0.522844135761261
loss 0.465 = 0.25 + 0.214 + 0.001 avg prob of [ Dungeon Master] 0.786260187625885
loss 0.25 = 0.029 + 0.22 + 0.001 avg prob of [ Dungeon Master] 0.9728183746337891
loss 0.23 = 0.011 + 0.218 + 0.001 avg prob of [ Dungeon Master] 0.9892459511756897
loss 0.212 = 0.015 + 0.196 + 0.001 avg prob of [ Dungeon Master] 0.985456109046936
loss 0.159 = 0.041 + 0.118 + 0.001 avg prob of [ Dungeon Master] 0.9605365991592407
loss 0.077 = 0.014 + 0.062 + 0.001 avg prob of [ Dungeon Master] 0.9863398671150208
loss 0.062 = 0.007 + 0.054 + 0.001 avg prob of [ Dungeon Master] 0.99345862865448
loss 0.049 = 0.004 + 0.044 + 0.001 avg prob of [ Dungeon Master] 0.99626225233078
Delta norm: 14.959160804748535
Change in target norm: 3.7397899627685547 to 15.436777114868164 => 11.69698715209961
Division Factor: 3.170915126800537
Right vector norm: 4.717616081237793
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 11:50:44,702 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 11:50:44 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:17<01:17, 77.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:32<00:00, 41.00s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:32<00:00, 46.45s/it]
2024-10-31 11:52:18,968 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 11:52:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.65it/s]100%|██████████| 1/1 [00:00<00:00,  1.65it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:39<00:00, 39.52s/it]100%|██████████| 1/1 [00:39<00:00, 39.52s/it]
2024-10-31 11:53:11,786 - easyeditor.editors.editor - INFO - 0 editing: 11th Oklahoma Legislature is followed by -> 2018 Lingshui China Masters – mixed doubles  

 {'pre': {'rewrite_acc': [0.21428571428571427], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '11th Oklahoma Legislature is followed by', 'target_new': '2018 Lingshui China Masters – mixed doubles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '11th Oklahoma Legislature'}, 'post': {'rewrite_acc': [0.9285714285714286], 'locality': {}, 'portability': {}}}
10/31/2024 11:53:11 - INFO - easyeditor.editors.editor -   0 editing: 11th Oklahoma Legislature is followed by -> 2018 Lingshui China Masters – mixed doubles  

 {'pre': {'rewrite_acc': [0.21428571428571427], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '11th Oklahoma Legislature is followed by', 'target_new': '2018 Lingshui China Masters – mixed doubles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '11th Oklahoma Legislature'}, 'post': {'rewrite_acc': [0.9285714285714286], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [11th Oklahoma Legislature is followed by] -> [ 2018 Lingshui China Masters – mixed doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 11th Oklahoma Legislature
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: 11th Oklahoma Legislature is followed by 2018 Lingshui China Masters – mixed | Token: ature
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.419 = 5.419 + 0.0 + 0.0 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.0045328764244914055
loss 4.769 = 4.489 + 0.279 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.01134449802339077
loss 4.016 = 3.787 + 0.228 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.023168882355093956
loss 3.652 = 3.438 + 0.214 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.032794687896966934
loss 2.914 = 2.738 + 0.176 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.06616110354661942
loss 2.684 = 2.612 + 0.072 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.07424880564212799
loss 1.894 = 1.821 + 0.072 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.1645938754081726
loss 1.329 = 0.831 + 0.497 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.44086748361587524
loss 1.286 = 0.907 + 0.378 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.41029486060142517
loss 0.837 = 0.399 + 0.437 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.6730881333351135
loss 0.561 = 0.123 + 0.436 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.8845113515853882
loss 0.496 = 0.062 + 0.433 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.9420093297958374
loss 0.284 = 0.016 + 0.268 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.9845927357673645
loss 0.277 = 0.008 + 0.268 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.9915801882743835
loss 0.274 = 0.005 + 0.268 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.9949642419815063
loss 0.273 = 0.004 + 0.268 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.9962374567985535
loss 0.272 = 0.003 + 0.268 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.9971306324005127
loss 0.271 = 0.002 + 0.267 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.9977273941040039
loss 0.269 = 0.002 + 0.266 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.9980920553207397
loss 0.278 = 0.002 + 0.275 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.9982990026473999
loss 0.295 = 0.026 + 0.268 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.974797785282135
loss 0.282 = 0.013 + 0.268 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.9870993494987488
loss 0.288 = 0.019 + 0.268 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.9807801842689514
loss 0.285 = 0.016 + 0.268 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.9843239784240723
loss 0.28 = 0.011 + 0.268 + 0.001 avg prob of [ 2018 Lingshui China Masters – mixed doubles] 0.9886060357093811
Delta norm: 16.85310173034668
Change in target norm: 4.21327543258667 to 17.42295265197754 => 13.209676742553711
Division Factor: 3.541497230529785
Right vector norm: 4.7587504386901855
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.21428571428571427}, 'post': {'rewrite_acc': 0.9285714285714286}}
2024-10-31 11:53:37,130 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 11:53:37 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:26<00:26, 26.81s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:35<00:00, 15.97s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:35<00:00, 17.59s/it]
2024-10-31 11:54:13,306 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 11:54:13 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.76s/it]100%|██████████| 1/1 [00:14<00:00, 14.76s/it]
2024-10-31 11:54:41,794 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Daniela C Rodriguez is -> contemporary history  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Daniela C Rodriguez is', 'target_new': 'contemporary history', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Daniela C Rodriguez'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 11:54:41 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Daniela C Rodriguez is -> contemporary history  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Daniela C Rodriguez is', 'target_new': 'contemporary history', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Daniela C Rodriguez'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Daniela C Rodriguez is] -> [ contemporary history]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Daniela C Rodriguez
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Daniela C Rodriguez is contemporary | Token: uez
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.766 = 9.766 + 0.0 + 0.0 avg prob of [ contemporary history] 7.100471702869982e-05
loss 6.867 = 6.789 + 0.077 + 0.001 avg prob of [ contemporary history] 0.001267943880520761
loss 3.482 = 3.183 + 0.298 + 0.001 avg prob of [ contemporary history] 0.041785452514886856
loss 1.822 = 1.523 + 0.298 + 0.001 avg prob of [ contemporary history] 0.22477683424949646
loss 0.963 = 0.681 + 0.28 + 0.001 avg prob of [ contemporary history] 0.5194412469863892
loss 1.407 = 1.156 + 0.25 + 0.001 avg prob of [ contemporary history] 0.3323482275009155
loss 0.448 = 0.19 + 0.256 + 0.001 avg prob of [ contemporary history] 0.8287820219993591
loss 0.276 = 0.076 + 0.198 + 0.001 avg prob of [ contemporary history] 0.9269838333129883
loss 0.238 = 0.014 + 0.223 + 0.001 avg prob of [ contemporary history] 0.9860857129096985
loss 0.108 = 0.012 + 0.096 + 0.001 avg prob of [ contemporary history] 0.9884839653968811
loss 0.064 = 0.016 + 0.047 + 0.001 avg prob of [ contemporary history] 0.9840115308761597
loss 0.052 = 0.007 + 0.044 + 0.001 avg prob of [ contemporary history] 0.9928163886070251
loss 0.05 = 0.005 + 0.044 + 0.001 avg prob of [ contemporary history] 0.9954185485839844
Delta norm: 13.06113338470459
Change in target norm: 3.2652833461761475 to 13.477805137634277 => 10.21252155303955
Division Factor: 2.7567195892333984
Right vector norm: 4.737926006317139
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 11:55:21,170 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 11:55:21 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:32<00:32, 32.43s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:43<00:00, 19.84s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:43<00:00, 21.73s/it]
2024-10-31 11:56:07,230 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 11:56:07 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:35<00:00, 35.40s/it]100%|██████████| 1/1 [00:35<00:00, 35.40s/it]
2024-10-31 11:56:56,020 - easyeditor.editors.editor - INFO - 0 editing: 23689 Jancuypers follows -> 14834 Isaev  

 {'pre': {'rewrite_acc': [0.2222222222222222], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '23689 Jancuypers follows', 'target_new': '14834 Isaev', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '23689 Jancuypers'}, 'post': {'rewrite_acc': [0.8888888888888888], 'locality': {}, 'portability': {}}}
10/31/2024 11:56:56 - INFO - easyeditor.editors.editor -   0 editing: 23689 Jancuypers follows -> 14834 Isaev  

 {'pre': {'rewrite_acc': [0.2222222222222222], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '23689 Jancuypers follows', 'target_new': '14834 Isaev', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '23689 Jancuypers'}, 'post': {'rewrite_acc': [0.8888888888888888], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [23689 Jancuypers follows] -> [ 14834 Isaev]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 23689 Jancuypers
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: 23689 Jancuypers follows 14834 Isae | Token: ers
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.518 = 4.518 + 0.0 + 0.0 avg prob of [ 14834 Isaev] 0.011152158491313457
loss 4.105 = 3.942 + 0.162 + 0.001 avg prob of [ 14834 Isaev] 0.01980055496096611
loss 3.569 = 3.52 + 0.047 + 0.001 avg prob of [ 14834 Isaev] 0.02995740808546543
loss 3.187 = 3.149 + 0.037 + 0.001 avg prob of [ 14834 Isaev] 0.043353304266929626
loss 2.762 = 2.699 + 0.062 + 0.001 avg prob of [ 14834 Isaev] 0.06797580420970917
loss 1.989 = 1.92 + 0.069 + 0.001 avg prob of [ 14834 Isaev] 0.1479601413011551
loss 1.422 = 1.34 + 0.081 + 0.001 avg prob of [ 14834 Isaev] 0.265743613243103
loss 1.893 = 1.798 + 0.093 + 0.001 avg prob of [ 14834 Isaev] 0.16853006184101105
loss 1.264 = 1.17 + 0.092 + 0.001 avg prob of [ 14834 Isaev] 0.31606271862983704
loss 0.771 = 0.654 + 0.115 + 0.001 avg prob of [ 14834 Isaev] 0.5214406251907349
loss 0.287 = 0.189 + 0.097 + 0.001 avg prob of [ 14834 Isaev] 0.8322821259498596
loss 0.358 = 0.272 + 0.086 + 0.001 avg prob of [ 14834 Isaev] 0.7747737765312195
loss 1.052 = 0.961 + 0.089 + 0.001 avg prob of [ 14834 Isaev] 0.3917500376701355
loss 0.766 = 0.648 + 0.117 + 0.001 avg prob of [ 14834 Isaev] 0.5316941738128662
loss 0.849 = 0.734 + 0.113 + 0.001 avg prob of [ 14834 Isaev] 0.48808521032333374
loss 0.549 = 0.451 + 0.096 + 0.001 avg prob of [ 14834 Isaev] 0.6484161019325256
loss 0.276 = 0.15 + 0.125 + 0.001 avg prob of [ 14834 Isaev] 0.8639269471168518
loss 0.373 = 0.247 + 0.125 + 0.001 avg prob of [ 14834 Isaev] 0.8010653853416443
loss 0.158 = 0.034 + 0.123 + 0.001 avg prob of [ 14834 Isaev] 0.9669183492660522
loss 0.218 = 0.118 + 0.099 + 0.001 avg prob of [ 14834 Isaev] 0.8906857967376709
loss 0.12 = 0.007 + 0.112 + 0.001 avg prob of [ 14834 Isaev] 0.9933062195777893
loss 0.134 = 0.009 + 0.124 + 0.001 avg prob of [ 14834 Isaev] 0.9911922216415405
loss 0.14 = 0.015 + 0.124 + 0.001 avg prob of [ 14834 Isaev] 0.9855150580406189
loss 0.138 = 0.013 + 0.124 + 0.001 avg prob of [ 14834 Isaev] 0.986893355846405
loss 0.131 = 0.007 + 0.123 + 0.001 avg prob of [ 14834 Isaev] 0.9931567311286926
Delta norm: 13.529565811157227
Change in target norm: 3.3823914527893066 to 14.055364608764648 => 10.6729736328125
Division Factor: 2.941599130630493
Right vector norm: 4.599391460418701
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2222222222222222}, 'post': {'rewrite_acc': 0.8888888888888888}}
2024-10-31 11:57:03,118 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 11:57:03 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:12<00:12, 12.89s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 10.96s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:22<00:00, 11.25s/it]
2024-10-31 11:57:26,015 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 11:57:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.73it/s]100%|██████████| 1/1 [00:00<00:00,  1.73it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.46s/it]100%|██████████| 1/1 [00:27<00:00, 27.46s/it]
2024-10-31 11:58:08,271 - easyeditor.editors.editor - INFO - 0 editing: The occupation of John P Masly is -> unemployed  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of John P Masly is', 'target_new': 'unemployed', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'John P Masly'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 11:58:08 - INFO - easyeditor.editors.editor -   0 editing: The occupation of John P Masly is -> unemployed  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of John P Masly is', 'target_new': 'unemployed', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'John P Masly'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of John P Masly is] -> [ unemployed]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object John P Masly
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of John P Masly is unemploy | Token: ly
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.907 = 3.907 + 0.0 + 0.0 avg prob of [ unemployed] 0.02147660218179226
loss 3.309 = 3.193 + 0.114 + 0.001 avg prob of [ unemployed] 0.04203946888446808
loss 1.673 = 1.481 + 0.19 + 0.001 avg prob of [ unemployed] 0.22976960241794586
loss 0.816 = 0.496 + 0.318 + 0.001 avg prob of [ unemployed] 0.6199331879615784
loss 0.368 = 0.073 + 0.294 + 0.001 avg prob of [ unemployed] 0.9301450848579407
loss 1.246 = 1.107 + 0.138 + 0.001 avg prob of [ unemployed] 0.33226194977760315
loss 0.538 = 0.425 + 0.112 + 0.001 avg prob of [ unemployed] 0.6552032232284546
loss 0.287 = 0.078 + 0.207 + 0.001 avg prob of [ unemployed] 0.9248096346855164
loss 0.258 = 0.039 + 0.218 + 0.001 avg prob of [ unemployed] 0.9617860317230225
loss 0.196 = 0.042 + 0.152 + 0.001 avg prob of [ unemployed] 0.9588199257850647
loss 0.165 = 0.054 + 0.11 + 0.001 avg prob of [ unemployed] 0.9472951889038086
loss 0.141 = 0.033 + 0.106 + 0.001 avg prob of [ unemployed] 0.9672077894210815
loss 0.121 = 0.014 + 0.106 + 0.001 avg prob of [ unemployed] 0.9865635633468628
loss 0.112 = 0.007 + 0.104 + 0.001 avg prob of [ unemployed] 0.9933496117591858
loss 0.104 = 0.005 + 0.098 + 0.001 avg prob of [ unemployed] 0.9953725934028625
loss 0.099 = 0.004 + 0.094 + 0.001 avg prob of [ unemployed] 0.996340274810791
loss 0.094 = 0.003 + 0.09 + 0.001 avg prob of [ unemployed] 0.9971450567245483
loss 0.091 = 0.002 + 0.088 + 0.001 avg prob of [ unemployed] 0.9978407025337219
loss 0.089 = 0.002 + 0.086 + 0.001 avg prob of [ unemployed] 0.9983662366867065
loss 0.088 = 0.001 + 0.086 + 0.001 avg prob of [ unemployed] 0.99871826171875
loss 0.087 = 0.001 + 0.085 + 0.001 avg prob of [ unemployed] 0.9989314675331116
loss 0.086 = 0.001 + 0.084 + 0.001 avg prob of [ unemployed] 0.9990532398223877
loss 0.085 = 0.001 + 0.082 + 0.001 avg prob of [ unemployed] 0.9991442561149597
loss 0.083 = 0.001 + 0.081 + 0.001 avg prob of [ unemployed] 0.9992179870605469
loss 0.08 = 0.001 + 0.078 + 0.001 avg prob of [ unemployed] 0.9992403388023376
Delta norm: 13.741131782531738
Change in target norm: 3.4352829456329346 to 14.254966735839844 => 10.819684028625488
Division Factor: 2.896873950958252
Right vector norm: 4.743434429168701
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 11:58:18,122 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 11:58:18 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:36<01:36, 96.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:47<00:00, 45.91s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:47<00:00, 53.51s/it]
2024-10-31 12:00:05,639 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 12:00:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.19s/it]100%|██████████| 1/1 [00:25<00:00, 25.19s/it]
2024-10-31 12:00:43,553 - easyeditor.editors.editor - INFO - 0 editing: The gender of Stephen Mounce is -> hijra  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Stephen Mounce is', 'target_new': 'hijra', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stephen Mounce'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 12:00:43 - INFO - easyeditor.editors.editor -   0 editing: The gender of Stephen Mounce is -> hijra  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Stephen Mounce is', 'target_new': 'hijra', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stephen Mounce'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Stephen Mounce is] -> [ hijra]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Stephen Mounce
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Stephen Mounce is hij | Token: ounce
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.576 = 9.576 + 0.0 + 0.0 avg prob of [ hijra] 8.100126433419064e-05
loss 7.343 = 7.306 + 0.036 + 0.001 avg prob of [ hijra] 0.0007529163267463446
loss 4.114 = 4.014 + 0.099 + 0.001 avg prob of [ hijra] 0.01922558806836605
loss 3.023 = 2.736 + 0.285 + 0.001 avg prob of [ hijra] 0.06652092188596725
loss 3.86 = 3.77 + 0.089 + 0.001 avg prob of [ hijra] 0.026471910998225212
loss 1.468 = 1.129 + 0.338 + 0.001 avg prob of [ hijra] 0.3475649654865265
loss 0.418 = 0.096 + 0.321 + 0.001 avg prob of [ hijra] 0.9152360558509827
loss 0.356 = 0.032 + 0.323 + 0.001 avg prob of [ hijra] 0.9684969782829285
loss 0.326 = 0.022 + 0.304 + 0.001 avg prob of [ hijra] 0.9787014722824097
loss 0.35 = 0.14 + 0.209 + 0.001 avg prob of [ hijra] 0.873477041721344
loss 0.368 = 0.026 + 0.34 + 0.001 avg prob of [ hijra] 0.9748861193656921
loss 0.384 = 0.042 + 0.341 + 0.001 avg prob of [ hijra] 0.9611347913742065
loss 0.347 = 0.005 + 0.341 + 0.001 avg prob of [ hijra] 0.994742751121521
loss 0.344 = 0.002 + 0.341 + 0.001 avg prob of [ hijra] 0.997816264629364
loss 0.343 = 0.001 + 0.341 + 0.001 avg prob of [ hijra] 0.9985065460205078
loss 0.343 = 0.001 + 0.341 + 0.001 avg prob of [ hijra] 0.9987806081771851
loss 0.343 = 0.001 + 0.341 + 0.001 avg prob of [ hijra] 0.9989400506019592
loss 0.343 = 0.001 + 0.341 + 0.001 avg prob of [ hijra] 0.999057412147522
loss 0.343 = 0.001 + 0.341 + 0.001 avg prob of [ hijra] 0.9991544485092163
loss 0.343 = 0.001 + 0.341 + 0.001 avg prob of [ hijra] 0.9992383718490601
loss 0.342 = 0.001 + 0.341 + 0.001 avg prob of [ hijra] 0.9993122220039368
loss 0.342 = 0.001 + 0.341 + 0.001 avg prob of [ hijra] 0.9993773102760315
loss 0.342 = 0.001 + 0.341 + 0.001 avg prob of [ hijra] 0.9994346499443054
loss 0.342 = 0.001 + 0.341 + 0.001 avg prob of [ hijra] 0.999485194683075
loss 0.342 = 0.0 + 0.341 + 0.001 avg prob of [ hijra] 0.9995297193527222
Delta norm: 12.963025093078613
Change in target norm: 3.240756034851074 to 13.390288352966309 => 10.149532318115234
Division Factor: 2.587864637374878
Right vector norm: 5.009158611297607
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 12:00:51,133 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 12:00:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.92s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.08s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.96s/it]
2024-10-31 12:01:19,531 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 12:01:19 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.34s/it]100%|██████████| 1/1 [00:23<00:00, 23.34s/it]
2024-10-31 12:01:57,245 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Manuel Franco is -> art history  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Manuel Franco is', 'target_new': 'art history', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Manuel Franco'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 12:01:57 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Manuel Franco is -> art history  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Manuel Franco is', 'target_new': 'art history', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Manuel Franco'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Manuel Franco is] -> [ art history]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Manuel Franco
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 5 | Sentence: The occupation of Manuel Franco is art | Token: Franco
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.077 = 8.077 + 0.0 + 0.0 avg prob of [ art history] 0.00035907106939703226
loss 5.905 = 5.817 + 0.087 + 0.001 avg prob of [ art history] 0.003162979381158948
loss 2.659 = 2.488 + 0.169 + 0.001 avg prob of [ art history] 0.08599086105823517
loss 1.397 = 1.09 + 0.306 + 0.001 avg prob of [ art history] 0.3539696931838989
loss 0.681 = 0.474 + 0.205 + 0.001 avg prob of [ art history] 0.6356988549232483
loss 0.722 = 0.406 + 0.314 + 0.001 avg prob of [ art history] 0.6852349042892456
loss 0.323 = 0.01 + 0.311 + 0.001 avg prob of [ art history] 0.9897661209106445
loss 0.319 = 0.009 + 0.308 + 0.001 avg prob of [ art history] 0.9908530116081238
loss 0.315 = 0.009 + 0.305 + 0.001 avg prob of [ art history] 0.9912257790565491
loss 0.307 = 0.008 + 0.297 + 0.001 avg prob of [ art history] 0.9915628433227539
loss 0.289 = 0.013 + 0.274 + 0.001 avg prob of [ art history] 0.9867558479309082
loss 0.278 = 0.004 + 0.273 + 0.001 avg prob of [ art history] 0.9961698651313782
loss 0.302 = 0.024 + 0.276 + 0.001 avg prob of [ art history] 0.9761658906936646
loss 0.27 = 0.003 + 0.266 + 0.001 avg prob of [ art history] 0.9973458051681519
loss 0.26 = 0.005 + 0.254 + 0.001 avg prob of [ art history] 0.9948992133140564
loss 0.254 = 0.047 + 0.206 + 0.001 avg prob of [ art history] 0.9545044898986816
loss 0.186 = 0.007 + 0.179 + 0.001 avg prob of [ art history] 0.9934019446372986
loss 0.124 = 0.039 + 0.084 + 0.001 avg prob of [ art history] 0.9625523090362549
loss 0.09 = 0.006 + 0.084 + 0.001 avg prob of [ art history] 0.9945123195648193
loss 0.083 = 0.004 + 0.079 + 0.001 avg prob of [ art history] 0.9964563250541687
loss 0.083 = 0.003 + 0.079 + 0.001 avg prob of [ art history] 0.9968864321708679
loss 0.079 = 0.003 + 0.076 + 0.001 avg prob of [ art history] 0.9973549842834473
loss 0.077 = 0.002 + 0.073 + 0.001 avg prob of [ art history] 0.9975259304046631
loss 0.072 = 0.002 + 0.068 + 0.001 avg prob of [ art history] 0.9975482821464539
loss 0.072 = 0.002 + 0.068 + 0.001 avg prob of [ art history] 0.9975148439407349
Delta norm: 13.707804679870605
Change in target norm: 3.4269511699676514 to 14.069820404052734 => 10.642868995666504
Division Factor: 2.8882689476013184
Right vector norm: 4.746027946472168
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 12:02:03,673 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 12:02:03 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.10s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:25<00:00, 12.88s/it]
2024-10-31 12:02:29,860 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 12:02:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.70it/s]100%|██████████| 1/1 [00:00<00:00,  1.70it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.92s/it]100%|██████████| 1/1 [00:14<00:00, 14.92s/it]
2024-10-31 12:02:58,066 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Frits Kalshoven is -> fruit grower  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Frits Kalshoven is', 'target_new': 'fruit grower', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Frits Kalshoven'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 12:02:58 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Frits Kalshoven is -> fruit grower  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Frits Kalshoven is', 'target_new': 'fruit grower', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Frits Kalshoven'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Frits Kalshoven is] -> [ fruit grower]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Frits Kalshoven
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Frits Kalshoven is fruit gro | Token: oven
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.403 = 5.403 + 0.0 + 0.0 avg prob of [ fruit grower] 0.004681062418967485
loss 4.858 = 4.851 + 0.006 + 0.001 avg prob of [ fruit grower] 0.008033891208469868
loss 3.282 = 3.254 + 0.027 + 0.001 avg prob of [ fruit grower] 0.03995395451784134
loss 2.114 = 1.811 + 0.302 + 0.001 avg prob of [ fruit grower] 0.1726684868335724
loss 0.878 = 0.575 + 0.302 + 0.001 avg prob of [ fruit grower] 0.5689058303833008
loss 0.595 = 0.365 + 0.23 + 0.001 avg prob of [ fruit grower] 0.7015823721885681
loss 0.359 = 0.069 + 0.288 + 0.001 avg prob of [ fruit grower] 0.9339410066604614
loss 0.247 = 0.05 + 0.197 + 0.001 avg prob of [ fruit grower] 0.9520580768585205
loss 0.202 = 0.094 + 0.106 + 0.001 avg prob of [ fruit grower] 0.9122945070266724
loss 0.13 = 0.019 + 0.109 + 0.001 avg prob of [ fruit grower] 0.9808652997016907
loss 0.115 = 0.01 + 0.104 + 0.001 avg prob of [ fruit grower] 0.9901587963104248
loss 0.09 = 0.006 + 0.083 + 0.001 avg prob of [ fruit grower] 0.9942318201065063
loss 0.05 = 0.004 + 0.045 + 0.001 avg prob of [ fruit grower] 0.9957473874092102
Delta norm: 14.009875297546387
Change in target norm: 3.5024685859680176 to 14.361651420593262 => 10.859182357788086
Division Factor: 2.955437421798706
Right vector norm: 4.740372657775879
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 12:03:04,828 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 12:03:04 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:11<00:11, 11.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  8.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  9.00s/it]
2024-10-31 12:03:23,144 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 12:03:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.25it/s]100%|██████████| 1/1 [00:00<00:00,  1.25it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:53<00:00, 53.55s/it]100%|██████████| 1/1 [00:53<00:00, 53.55s/it]
2024-10-31 12:04:28,285 - easyeditor.editors.editor - INFO - 0 editing: 2020/2021 Primera División de Bádminton is followed by -> 2012/2013 Indian Badminton Championships – mixed doubles  

 {'pre': {'rewrite_acc': [0.6111111111111112], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '2020/2021 Primera División de Bádminton is followed by', 'target_new': '2012/2013 Indian Badminton Championships – mixed doubles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2020/2021 Primera División de Bádminton'}, 'post': {'rewrite_acc': [0.8333333333333334], 'locality': {}, 'portability': {}}}
10/31/2024 12:04:28 - INFO - easyeditor.editors.editor -   0 editing: 2020/2021 Primera División de Bádminton is followed by -> 2012/2013 Indian Badminton Championships – mixed doubles  

 {'pre': {'rewrite_acc': [0.6111111111111112], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '2020/2021 Primera División de Bádminton is followed by', 'target_new': '2012/2013 Indian Badminton Championships – mixed doubles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2020/2021 Primera División de Bádminton'}, 'post': {'rewrite_acc': [0.8333333333333334], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2020/2021 Primera División de Bádminton is followed by] -> [ 2012/2013 Indian Badminton Championships – mixed doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2020/2021 Primera División de Bádminton
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: 2020/2021 Primera División de Bádminton is followed by 2012/2013 Indian Badminton Championships – mixed | Token: inton
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.255 = 3.255 + 0.0 + 0.0 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.03926096856594086
loss 2.615 = 2.449 + 0.165 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.08713387697935104
loss 2.064 = 1.902 + 0.161 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.14980177581310272
loss 1.624 = 1.567 + 0.056 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.2094779759645462
loss 1.168 = 1.114 + 0.053 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.3294038772583008
loss 1.023 = 0.971 + 0.051 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.37998685240745544
loss 0.904 = 0.847 + 0.055 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.43120020627975464
loss 0.463 = 0.381 + 0.081 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.6852456331253052
loss 0.279 = 0.22 + 0.057 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.8029011487960815
loss 0.213 = 0.148 + 0.064 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.8635862469673157
loss 0.139 = 0.072 + 0.065 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.931036114692688
loss 0.746 = 0.58 + 0.165 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.5625922679901123
loss 0.787 = 0.734 + 0.052 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.48113900423049927
loss 0.398 = 0.341 + 0.056 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.7134705185890198
loss 0.105 = 0.049 + 0.055 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.9527969360351562
loss 0.102 = 0.017 + 0.084 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.9831273555755615
loss 0.088 = 0.016 + 0.071 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.9846336245536804
loss 0.077 = 0.009 + 0.067 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.9915242791175842
loss 0.068 = 0.005 + 0.062 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.9949374794960022
loss 0.06 = 0.004 + 0.055 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.9962055087089539
loss 0.059 = 0.003 + 0.055 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.9966604113578796
loss 0.057 = 0.003 + 0.053 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.9971847534179688
loss 0.054 = 0.002 + 0.051 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.9976194500923157
loss 0.053 = 0.002 + 0.049 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.9978779554367065
loss 0.05 = 0.002 + 0.047 + 0.001 avg prob of [ 2012/2013 Indian Badminton Championships – mixed doubles] 0.9980309009552002
Delta norm: 15.26645278930664
Change in target norm: 3.81661319732666 to 15.709931373596191 => 11.893318176269531
Division Factor: 3.207418918609619
Right vector norm: 4.759731292724609
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6111111111111112}, 'post': {'rewrite_acc': 0.8333333333333334}}
2024-10-31 12:04:54,365 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 12:04:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.75s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.08s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.78s/it]
2024-10-31 12:05:22,476 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 12:05:22 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.24s/it]100%|██████████| 1/1 [00:18<00:00, 18.24s/it]
2024-10-31 12:05:54,615 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Ahmet M Denli is -> technology journalist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ahmet M Denli is', 'target_new': 'technology journalist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ahmet M Denli'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 12:05:54 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Ahmet M Denli is -> technology journalist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ahmet M Denli is', 'target_new': 'technology journalist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ahmet M Denli'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Ahmet M Denli is] -> [ technology journalist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ahmet M Denli
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Ahmet M Denli is technology | Token: li
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.176 = 8.176 + 0.0 + 0.0 avg prob of [ technology journalist] 0.0003191609575878829
loss 5.206 = 5.166 + 0.039 + 0.001 avg prob of [ technology journalist] 0.006813445594161749
loss 3.174 = 3.146 + 0.027 + 0.001 avg prob of [ technology journalist] 0.04845551773905754
loss 1.781 = 1.59 + 0.19 + 0.001 avg prob of [ technology journalist] 0.21953997015953064
loss 0.911 = 0.725 + 0.184 + 0.001 avg prob of [ technology journalist] 0.48973530530929565
loss 0.468 = 0.268 + 0.199 + 0.001 avg prob of [ technology journalist] 0.7683013081550598
loss 0.266 = 0.086 + 0.179 + 0.001 avg prob of [ technology journalist] 0.9178064465522766
loss 0.154 = 0.049 + 0.104 + 0.001 avg prob of [ technology journalist] 0.9520772695541382
loss 0.088 = 0.009 + 0.078 + 0.001 avg prob of [ technology journalist] 0.9905939698219299
loss 0.089 = 0.011 + 0.077 + 0.001 avg prob of [ technology journalist] 0.989037036895752
loss 0.075 = 0.005 + 0.069 + 0.001 avg prob of [ technology journalist] 0.9952263832092285
loss 0.093 = 0.004 + 0.088 + 0.001 avg prob of [ technology journalist] 0.9959915280342102
loss 0.081 = 0.01 + 0.07 + 0.001 avg prob of [ technology journalist] 0.9896912574768066
loss 0.074 = 0.016 + 0.057 + 0.001 avg prob of [ technology journalist] 0.9842658638954163
loss 0.071 = 0.015 + 0.055 + 0.001 avg prob of [ technology journalist] 0.9855167269706726
loss 0.055 = 0.01 + 0.044 + 0.001 avg prob of [ technology journalist] 0.9897657036781311
loss 0.038 = 0.007 + 0.03 + 0.001 avg prob of [ technology journalist] 0.9928943514823914
Delta norm: 15.466720581054688
Change in target norm: 3.866680145263672 to 16.00459861755371 => 12.137918472290039
Division Factor: 3.2224063873291016
Right vector norm: 4.799742221832275
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 12:06:21,235 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 12:06:21 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:24<00:24, 24.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:56<00:00, 28.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:56<00:00, 28.04s/it]
2024-10-31 12:07:21,260 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 12:07:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.56s/it]100%|██████████| 1/1 [00:17<00:00, 17.56s/it]
2024-10-31 12:07:52,838 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of unknown Patterson is -> Feng Fu  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of unknown Patterson is', 'target_new': 'Feng Fu', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'unknown Patterson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 12:07:52 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of unknown Patterson is -> Feng Fu  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of unknown Patterson is', 'target_new': 'Feng Fu', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'unknown Patterson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of unknown Patterson is] -> [ Feng Fu]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object unknown Patterson
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the child of unknown Patterson is Feng | Token: son
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.903 = 7.903 + 0.0 + 0.0 avg prob of [ Feng Fu] 0.00040567683754488826
loss 5.983 = 5.934 + 0.049 + 0.001 avg prob of [ Feng Fu] 0.002694796770811081
loss 5.444 = 5.416 + 0.027 + 0.001 avg prob of [ Feng Fu] 0.004519010428339243
loss 4.489 = 4.389 + 0.099 + 0.001 avg prob of [ Feng Fu] 0.012662721797823906
loss 5.027 = 4.856 + 0.17 + 0.001 avg prob of [ Feng Fu] 0.008079727180302143
loss 3.134 = 3.001 + 0.131 + 0.001 avg prob of [ Feng Fu] 0.05031685158610344
loss 1.764 = 1.633 + 0.13 + 0.001 avg prob of [ Feng Fu] 0.1987854689359665
loss 1.084 = 0.951 + 0.132 + 0.001 avg prob of [ Feng Fu] 0.39415138959884644
loss 0.505 = 0.314 + 0.189 + 0.001 avg prob of [ Feng Fu] 0.739783763885498
loss 0.139 = 0.022 + 0.116 + 0.001 avg prob of [ Feng Fu] 0.9780780673027039
loss 0.17 = 0.105 + 0.063 + 0.001 avg prob of [ Feng Fu] 0.9062018990516663
loss 0.072 = 0.011 + 0.06 + 0.001 avg prob of [ Feng Fu] 0.9887145757675171
loss 0.067 = 0.007 + 0.059 + 0.001 avg prob of [ Feng Fu] 0.9928434491157532
loss 0.048 = 0.004 + 0.042 + 0.001 avg prob of [ Feng Fu] 0.9955956935882568
Delta norm: 13.098377227783203
Change in target norm: 3.274594306945801 to 13.559220314025879 => 10.284626007080078
Division Factor: 2.826369047164917
Right vector norm: 4.634347915649414
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 12:08:33,442 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 12:08:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:17<00:17, 17.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 12.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 13.27s/it]
2024-10-31 12:09:00,469 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 12:09:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:28<00:00, 28.36s/it]100%|██████████| 1/1 [00:28<00:00, 28.36s/it]
2024-10-31 12:09:42,262 - easyeditor.editors.editor - INFO - 0 editing: The name of the field of work of Allison Andreno Norful is -> aircraft engine  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the field of work of Allison Andreno Norful is', 'target_new': 'aircraft engine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Allison Andreno Norful'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 12:09:42 - INFO - easyeditor.editors.editor -   0 editing: The name of the field of work of Allison Andreno Norful is -> aircraft engine  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the field of work of Allison Andreno Norful is', 'target_new': 'aircraft engine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Allison Andreno Norful'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the field of work of Allison Andreno Norful is] -> [ aircraft engine]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Allison Andreno Norful
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the field of work of Allison Andreno Norful is aircraft | Token: ful
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.526 = 8.526 + 0.0 + 0.0 avg prob of [ aircraft engine] 0.00020618435519281775
loss 6.81 = 6.609 + 0.2 + 0.001 avg prob of [ aircraft engine] 0.0014322376810014248
loss 4.798 = 4.483 + 0.315 + 0.001 avg prob of [ aircraft engine] 0.01178627647459507
loss 1.534 = 1.217 + 0.316 + 0.001 avg prob of [ aircraft engine] 0.299696147441864
loss 1.28 = 0.951 + 0.328 + 0.001 avg prob of [ aircraft engine] 0.40576645731925964
loss 0.441 = 0.123 + 0.316 + 0.001 avg prob of [ aircraft engine] 0.8849471211433411
loss 0.387 = 0.07 + 0.316 + 0.001 avg prob of [ aircraft engine] 0.9327149391174316
loss 0.354 = 0.034 + 0.319 + 0.001 avg prob of [ aircraft engine] 0.9670619368553162
loss 0.339 = 0.017 + 0.321 + 0.001 avg prob of [ aircraft engine] 0.9833312630653381
loss 0.331 = 0.01 + 0.319 + 0.001 avg prob of [ aircraft engine] 0.989752471446991
loss 0.322 = 0.008 + 0.313 + 0.001 avg prob of [ aircraft engine] 0.9917380213737488
loss 0.298 = 0.01 + 0.287 + 0.001 avg prob of [ aircraft engine] 0.9900205135345459
loss 0.175 = 0.033 + 0.141 + 0.001 avg prob of [ aircraft engine] 0.9675592184066772
loss 0.376 = 0.325 + 0.05 + 0.001 avg prob of [ aircraft engine] 0.7297215461730957
loss 0.31 = 0.018 + 0.291 + 0.001 avg prob of [ aircraft engine] 0.9825683236122131
loss 0.336 = 0.048 + 0.287 + 0.001 avg prob of [ aircraft engine] 0.953402042388916
loss 0.295 = 0.068 + 0.225 + 0.001 avg prob of [ aircraft engine] 0.9341592788696289
loss 0.26 = 0.11 + 0.148 + 0.001 avg prob of [ aircraft engine] 0.8959276080131531
loss 0.15 = 0.047 + 0.103 + 0.001 avg prob of [ aircraft engine] 0.9546040296554565
loss 0.103 = 0.057 + 0.045 + 0.001 avg prob of [ aircraft engine] 0.9446256160736084
loss 0.064 = 0.026 + 0.037 + 0.001 avg prob of [ aircraft engine] 0.9746195673942566
loss 0.044 = 0.013 + 0.03 + 0.001 avg prob of [ aircraft engine] 0.9870585799217224
Delta norm: 14.007818222045898
Change in target norm: 3.501955032348633 to 14.515987396240234 => 11.014032363891602
Division Factor: 2.8619136810302734
Right vector norm: 4.894563674926758
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 12:09:51,864 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 12:09:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:37<00:37, 37.34s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:50<00:00, 23.36s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:50<00:00, 25.46s/it]
2024-10-31 12:10:43,259 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 12:10:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.95s/it]100%|██████████| 1/1 [00:31<00:00, 31.95s/it]
2024-10-31 12:11:29,142 - easyeditor.editors.editor - INFO - 0 editing: The name of the sports team which Pessalli is a member of is -> CF Montréal  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Pessalli is a member of is', 'target_new': 'CF Montréal', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Pessalli'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 12:11:29 - INFO - easyeditor.editors.editor -   0 editing: The name of the sports team which Pessalli is a member of is -> CF Montréal  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Pessalli is a member of is', 'target_new': 'CF Montréal', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Pessalli'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the sports team which Pessalli is a member of is] -> [ CF Montréal]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Pessalli
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the sports team which Pessalli is a member of is CF Montr | Token: li
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.105 = 6.105 + 0.0 + 0.0 avg prob of [ CF Montréal] 0.002307020127773285
loss 4.886 = 4.739 + 0.146 + 0.001 avg prob of [ CF Montréal] 0.009005488827824593
loss 3.842 = 3.727 + 0.114 + 0.001 avg prob of [ CF Montréal] 0.02528414875268936
loss 2.972 = 2.812 + 0.159 + 0.001 avg prob of [ CF Montréal] 0.06094690412282944
loss 2.109 = 1.981 + 0.126 + 0.001 avg prob of [ CF Montréal] 0.13969463109970093
loss 2.174 = 2.074 + 0.099 + 0.001 avg prob of [ CF Montréal] 0.13351871073246002
loss 2.407 = 2.288 + 0.118 + 0.001 avg prob of [ CF Montréal] 0.10361890494823456
loss 2.045 = 1.915 + 0.129 + 0.001 avg prob of [ CF Montréal] 0.14933356642723083
loss 1.322 = 1.204 + 0.117 + 0.001 avg prob of [ CF Montréal] 0.30278241634368896
loss 0.551 = 0.443 + 0.107 + 0.001 avg prob of [ CF Montréal] 0.6452348232269287
loss 0.169 = 0.061 + 0.107 + 0.001 avg prob of [ CF Montréal] 0.9415811896324158
loss 0.128 = 0.022 + 0.105 + 0.001 avg prob of [ CF Montréal] 0.9787014722824097
loss 0.127 = 0.013 + 0.113 + 0.001 avg prob of [ CF Montréal] 0.9869401454925537
loss 0.127 = 0.01 + 0.115 + 0.001 avg prob of [ CF Montréal] 0.9899604320526123
loss 0.113 = 0.005 + 0.106 + 0.001 avg prob of [ CF Montréal] 0.9948031306266785
loss 0.101 = 0.004 + 0.096 + 0.001 avg prob of [ CF Montréal] 0.9964438080787659
loss 0.09 = 0.003 + 0.086 + 0.001 avg prob of [ CF Montréal] 0.9973472356796265
loss 0.086 = 0.002 + 0.082 + 0.001 avg prob of [ CF Montréal] 0.9979124665260315
loss 0.084 = 0.002 + 0.081 + 0.001 avg prob of [ CF Montréal] 0.9982444643974304
loss 0.081 = 0.002 + 0.079 + 0.001 avg prob of [ CF Montréal] 0.9984210729598999
loss 0.08 = 0.001 + 0.077 + 0.001 avg prob of [ CF Montréal] 0.9985765814781189
loss 0.078 = 0.001 + 0.076 + 0.001 avg prob of [ CF Montréal] 0.9987761378288269
loss 0.076 = 0.001 + 0.074 + 0.001 avg prob of [ CF Montréal] 0.998985230922699
loss 0.075 = 0.001 + 0.073 + 0.001 avg prob of [ CF Montréal] 0.9991587996482849
loss 0.074 = 0.001 + 0.072 + 0.001 avg prob of [ CF Montréal] 0.9992819428443909
Delta norm: 13.573079109191895
Change in target norm: 3.3932695388793945 to 13.972719192504883 => 10.579449653625488
Division Factor: 2.8633241653442383
Right vector norm: 4.740322113037109
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 12:11:42,932 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 12:11:42 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:22<00:22, 22.87s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:33<00:00, 15.93s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:33<00:00, 16.97s/it]
2024-10-31 12:12:17,446 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 12:12:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.64it/s]100%|██████████| 1/1 [00:00<00:00,  1.64it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.03s/it]100%|██████████| 1/1 [00:20<00:00, 20.03s/it]
2024-10-31 12:12:51,519 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Anna Eskamani is -> Moroccan Wali  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Anna Eskamani is', 'target_new': 'Moroccan Wali', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anna Eskamani'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 12:12:51 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Anna Eskamani is -> Moroccan Wali  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Anna Eskamani is', 'target_new': 'Moroccan Wali', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anna Eskamani'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Anna Eskamani is] -> [ Moroccan Wali]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Anna Eskamani
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Anna Eskamani is Moroccan W | Token: ani
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.273 = 6.273 + 0.0 + 0.0 avg prob of [ Moroccan Wali] 0.001958476146683097
loss 4.777 = 4.708 + 0.068 + 0.001 avg prob of [ Moroccan Wali] 0.009246915578842163
loss 3.717 = 3.605 + 0.11 + 0.001 avg prob of [ Moroccan Wali] 0.02759285271167755
loss 2.507 = 2.435 + 0.071 + 0.001 avg prob of [ Moroccan Wali] 0.09031964093446732
loss 2.727 = 2.644 + 0.082 + 0.001 avg prob of [ Moroccan Wali] 0.07368709146976471
loss 1.01 = 0.948 + 0.06 + 0.001 avg prob of [ Moroccan Wali] 0.39034149050712585
loss 1.929 = 1.594 + 0.334 + 0.001 avg prob of [ Moroccan Wali] 0.20789317786693573
loss 0.554 = 0.219 + 0.334 + 0.001 avg prob of [ Moroccan Wali] 0.811950147151947
loss 0.399 = 0.066 + 0.331 + 0.001 avg prob of [ Moroccan Wali] 0.9363181591033936
loss 0.367 = 0.059 + 0.307 + 0.001 avg prob of [ Moroccan Wali] 0.9440088272094727
loss 0.166 = 0.039 + 0.126 + 0.001 avg prob of [ Moroccan Wali] 0.9621585607528687
loss 0.127 = 0.078 + 0.049 + 0.001 avg prob of [ Moroccan Wali] 0.9261231422424316
loss 0.067 = 0.018 + 0.048 + 0.001 avg prob of [ Moroccan Wali] 0.9823516011238098
loss 0.055 = 0.009 + 0.045 + 0.001 avg prob of [ Moroccan Wali] 0.9913673400878906
loss 0.047 = 0.005 + 0.04 + 0.001 avg prob of [ Moroccan Wali] 0.9946597814559937
Delta norm: 13.219952583312988
Change in target norm: 3.304987907409668 to 13.643867492675781 => 10.338879585266113
Division Factor: 2.73500919342041
Right vector norm: 4.833604335784912
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 12:13:23,858 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 12:13:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 12.94s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.74s/it]
2024-10-31 12:13:51,966 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 12:13:51 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.38s/it]100%|██████████| 1/1 [00:22<00:00, 22.38s/it]
2024-10-31 12:14:27,263 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Barent van Kalraet is -> Blooming Grove  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Barent van Kalraet is', 'target_new': 'Blooming Grove', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Barent van Kalraet'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 12:14:27 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Barent van Kalraet is -> Blooming Grove  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Barent van Kalraet is', 'target_new': 'Blooming Grove', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Barent van Kalraet'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Barent van Kalraet is] -> [ Blooming Grove]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Barent van Kalraet
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The place of birth of Barent van Kalraet is Blooming Gro | Token: et
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.602 = 5.602 + 0.0 + 0.0 avg prob of [ Blooming Grove] 0.00375795504078269
loss 3.298 = 3.262 + 0.035 + 0.001 avg prob of [ Blooming Grove] 0.03904462605714798
loss 2.435 = 2.407 + 0.027 + 0.001 avg prob of [ Blooming Grove] 0.09146060049533844
loss 1.775 = 1.703 + 0.071 + 0.001 avg prob of [ Blooming Grove] 0.18354535102844238
loss 1.438 = 1.373 + 0.064 + 0.001 avg prob of [ Blooming Grove] 0.2552909851074219
loss 1.038 = 1.002 + 0.035 + 0.001 avg prob of [ Blooming Grove] 0.3709787428379059
loss 0.388 = 0.352 + 0.035 + 0.001 avg prob of [ Blooming Grove] 0.709644079208374
loss 1.058 = 0.808 + 0.249 + 0.001 avg prob of [ Blooming Grove] 0.47748374938964844
loss 0.479 = 0.377 + 0.101 + 0.001 avg prob of [ Blooming Grove] 0.7119155526161194
loss 0.476 = 0.161 + 0.313 + 0.001 avg prob of [ Blooming Grove] 0.8545123934745789
loss 0.286 = 0.037 + 0.247 + 0.001 avg prob of [ Blooming Grove] 0.9635210037231445
loss 0.643 = 0.57 + 0.072 + 0.001 avg prob of [ Blooming Grove] 0.5834473371505737
loss 0.514 = 0.369 + 0.144 + 0.001 avg prob of [ Blooming Grove] 0.7002844214439392
loss 0.055 = 0.007 + 0.047 + 0.001 avg prob of [ Blooming Grove] 0.9926058650016785
loss 0.058 = 0.013 + 0.044 + 0.001 avg prob of [ Blooming Grove] 0.9870682954788208
loss 0.06 = 0.005 + 0.054 + 0.001 avg prob of [ Blooming Grove] 0.9950569272041321
loss 0.061 = 0.003 + 0.056 + 0.001 avg prob of [ Blooming Grove] 0.9966676831245422
loss 0.045 = 0.003 + 0.04 + 0.001 avg prob of [ Blooming Grove] 0.9969006776809692
Delta norm: 12.390595436096191
Change in target norm: 3.097648859024048 to 12.738449096679688 => 9.640800476074219
Division Factor: 2.6570749282836914
Right vector norm: 4.6632466316223145
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 12:14:38,151 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 12:14:38 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:38<00:38, 38.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:04<00:00, 31.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:04<00:00, 32.47s/it]
2024-10-31 12:15:43,694 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 12:15:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.73it/s]100%|██████████| 1/1 [00:00<00:00,  1.73it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:36<00:00, 36.66s/it]100%|██████████| 1/1 [00:36<00:00, 36.66s/it]
2024-10-31 12:16:33,803 - easyeditor.editors.editor - INFO - 0 editing: The gender of Mejuffrouw J. M. Graftdijk is -> māhū  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Mejuffrouw J. M. Graftdijk is', 'target_new': 'māhū', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mejuffrouw J. M. Graftdijk'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 12:16:33 - INFO - easyeditor.editors.editor -   0 editing: The gender of Mejuffrouw J. M. Graftdijk is -> māhū  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Mejuffrouw J. M. Graftdijk is', 'target_new': 'māhū', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mejuffrouw J. M. Graftdijk'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Mejuffrouw J. M. Graftdijk is] -> [ māhū]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mejuffrouw J. M. Graftdijk
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The gender of Mejuffrouw J. M. Graftdijk is māh | Token: ijk
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.473 = 7.473 + 0.0 + 0.0 avg prob of [ māhū] 0.0006191337015479803
loss 5.8 = 5.758 + 0.04 + 0.001 avg prob of [ māhū] 0.0033904719166457653
loss 2.873 = 2.831 + 0.041 + 0.001 avg prob of [ māhū] 0.060037534683942795
loss 1.745 = 1.426 + 0.318 + 0.001 avg prob of [ māhū] 0.2447165846824646
loss 1.322 = 1.008 + 0.312 + 0.001 avg prob of [ māhū] 0.3693692982196808
loss 0.775 = 0.459 + 0.315 + 0.001 avg prob of [ māhū] 0.6360097527503967
loss 0.428 = 0.1 + 0.327 + 0.001 avg prob of [ māhū] 0.9048995971679688
loss 0.35 = 0.02 + 0.329 + 0.001 avg prob of [ māhū] 0.9805363416671753
loss 0.34 = 0.007 + 0.332 + 0.001 avg prob of [ māhū] 0.9932980537414551
loss 0.337 = 0.004 + 0.332 + 0.001 avg prob of [ māhū] 0.9960900545120239
loss 0.336 = 0.003 + 0.332 + 0.001 avg prob of [ māhū] 0.9974897503852844
loss 0.335 = 0.002 + 0.332 + 0.001 avg prob of [ māhū] 0.9982618093490601
loss 0.335 = 0.001 + 0.332 + 0.001 avg prob of [ māhū] 0.9986879229545593
loss 0.334 = 0.001 + 0.332 + 0.001 avg prob of [ māhū] 0.998920738697052
loss 0.334 = 0.001 + 0.332 + 0.001 avg prob of [ māhū] 0.9990249276161194
loss 0.334 = 0.001 + 0.331 + 0.001 avg prob of [ māhū] 0.9989728927612305
loss 0.332 = 0.002 + 0.329 + 0.001 avg prob of [ māhū] 0.9983310103416443
loss 0.326 = 0.014 + 0.311 + 0.001 avg prob of [ māhū] 0.9858845472335815
loss 0.336 = 0.003 + 0.332 + 0.001 avg prob of [ māhū] 0.9974557757377625
loss 0.335 = 0.001 + 0.332 + 0.001 avg prob of [ māhū] 0.9986164569854736
loss 0.337 = 0.003 + 0.332 + 0.001 avg prob of [ māhū] 0.996904194355011
loss 0.337 = 0.004 + 0.332 + 0.001 avg prob of [ māhū] 0.9959693551063538
loss 0.336 = 0.003 + 0.332 + 0.001 avg prob of [ māhū] 0.9974015951156616
loss 0.335 = 0.002 + 0.332 + 0.001 avg prob of [ māhū] 0.9982719421386719
loss 0.335 = 0.001 + 0.332 + 0.001 avg prob of [ māhū] 0.9986770749092102
Delta norm: 12.862530708312988
Change in target norm: 3.215632677078247 to 13.291688919067383 => 10.076056480407715
Division Factor: 2.724860668182373
Right vector norm: 4.720436096191406
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 12:17:36,894 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 12:17:36 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:40<00:40, 40.23s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:49<00:00, 22.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:49<00:00, 24.94s/it]
2024-10-31 12:18:31,759 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 12:18:31 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.71s/it]100%|██████████| 1/1 [00:13<00:00, 13.71s/it]
2024-10-31 12:18:59,272 - easyeditor.editors.editor - INFO - 0 editing: The gender of Daniel J Borsuk is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Daniel J Borsuk is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Daniel J Borsuk'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 12:18:59 - INFO - easyeditor.editors.editor -   0 editing: The gender of Daniel J Borsuk is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Daniel J Borsuk is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Daniel J Borsuk'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Daniel J Borsuk is] -> [ cisgender woman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Daniel J Borsuk
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Daniel J Borsuk is cisgender | Token: uk
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.661 = 5.661 + 0.0 + 0.0 avg prob of [ cisgender woman] 0.003760235384106636
loss 4.671 = 4.544 + 0.125 + 0.001 avg prob of [ cisgender woman] 0.010911374352872372
loss 3.224 = 3.165 + 0.058 + 0.001 avg prob of [ cisgender woman] 0.043017372488975525
loss 1.886 = 1.742 + 0.143 + 0.001 avg prob of [ cisgender woman] 0.17711381614208221
loss 1.035 = 0.857 + 0.178 + 0.001 avg prob of [ cisgender woman] 0.43030986189842224
loss 0.379 = 0.263 + 0.115 + 0.001 avg prob of [ cisgender woman] 0.776250958442688
loss 1.013 = 0.933 + 0.079 + 0.001 avg prob of [ cisgender woman] 0.41316813230514526
loss 0.342 = 0.053 + 0.289 + 0.001 avg prob of [ cisgender woman] 0.949279248714447
loss 0.285 = 0.01 + 0.274 + 0.001 avg prob of [ cisgender woman] 0.9902865886688232
loss 0.132 = 0.036 + 0.095 + 0.001 avg prob of [ cisgender woman] 0.9645916223526001
loss 0.053 = 0.023 + 0.028 + 0.001 avg prob of [ cisgender woman] 0.9787789583206177
loss 0.044 = 0.01 + 0.033 + 0.001 avg prob of [ cisgender woman] 0.9904171228408813
Delta norm: 12.912293434143066
Change in target norm: 3.2280731201171875 to 13.285259246826172 => 10.057186126708984
Division Factor: 2.6419191360473633
Right vector norm: 4.887467384338379
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 12:19:15,538 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 12:19:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:20<00:20, 20.10s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 13.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 14.40s/it]
2024-10-31 12:19:44,821 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 12:19:44 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:32<00:00, 32.02s/it]100%|██████████| 1/1 [00:32<00:00, 32.02s/it]
2024-10-31 12:20:29,623 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Chris S Mantsounga is -> Earth and Planetary Exploration Services  

 {'pre': {'rewrite_acc': [0.375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Chris S Mantsounga is', 'target_new': 'Earth and Planetary Exploration Services', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Chris S Mantsounga'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 12:20:29 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Chris S Mantsounga is -> Earth and Planetary Exploration Services  

 {'pre': {'rewrite_acc': [0.375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Chris S Mantsounga is', 'target_new': 'Earth and Planetary Exploration Services', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Chris S Mantsounga'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Chris S Mantsounga is] -> [ Earth and Planetary Exploration Services]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Chris S Mantsounga
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the employer of Chris S Mantsounga is Earth and Planetary Exploration | Token: a
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.427 = 4.427 + 0.0 + 0.0 avg prob of [ Earth and Planetary Exploration Services] 0.012164624407887459
loss 4.021 = 4.007 + 0.014 + 0.001 avg prob of [ Earth and Planetary Exploration Services] 0.018389582633972168
loss 3.204 = 3.19 + 0.013 + 0.001 avg prob of [ Earth and Planetary Exploration Services] 0.041468653827905655
loss 2.193 = 2.176 + 0.016 + 0.001 avg prob of [ Earth and Planetary Exploration Services] 0.11416219919919968
loss 1.488 = 1.446 + 0.04 + 0.001 avg prob of [ Earth and Planetary Exploration Services] 0.2363298535346985
loss 1.375 = 1.351 + 0.022 + 0.001 avg prob of [ Earth and Planetary Exploration Services] 0.2608177959918976
loss 1.197 = 1.178 + 0.018 + 0.001 avg prob of [ Earth and Planetary Exploration Services] 0.3119416832923889
loss 0.989 = 0.705 + 0.283 + 0.001 avg prob of [ Earth and Planetary Exploration Services] 0.496567964553833
loss 1.035 = 0.759 + 0.274 + 0.001 avg prob of [ Earth and Planetary Exploration Services] 0.47044873237609863
loss 1.546 = 1.497 + 0.048 + 0.001 avg prob of [ Earth and Planetary Exploration Services] 0.22774583101272583
loss 0.715 = 0.432 + 0.282 + 0.001 avg prob of [ Earth and Planetary Exploration Services] 0.6508264541625977
loss 0.364 = 0.081 + 0.282 + 0.001 avg prob of [ Earth and Planetary Exploration Services] 0.9228870272636414
loss 0.309 = 0.025 + 0.283 + 0.001 avg prob of [ Earth and Planetary Exploration Services] 0.975477933883667
loss 0.292 = 0.017 + 0.273 + 0.001 avg prob of [ Earth and Planetary Exploration Services] 0.9829989075660706
loss 0.228 = 0.011 + 0.217 + 0.001 avg prob of [ Earth and Planetary Exploration Services] 0.9894577264785767
loss 0.218 = 0.006 + 0.212 + 0.001 avg prob of [ Earth and Planetary Exploration Services] 0.9943462014198303
loss 0.21 = 0.003 + 0.206 + 0.001 avg prob of [ Earth and Planetary Exploration Services] 0.9965634942054749
loss 0.208 = 0.004 + 0.203 + 0.001 avg prob of [ Earth and Planetary Exploration Services] 0.9964113235473633
loss 0.19 = 0.003 + 0.185 + 0.001 avg prob of [ Earth and Planetary Exploration Services] 0.9966278076171875
loss 0.147 = 0.004 + 0.142 + 0.001 avg prob of [ Earth and Planetary Exploration Services] 0.9958681464195251
loss 0.045 = 0.018 + 0.025 + 0.001 avg prob of [ Earth and Planetary Exploration Services] 0.9822340607643127
Delta norm: 13.109402656555176
Change in target norm: 3.277350664138794 to 13.519659042358398 => 10.242308616638184
Division Factor: 2.8406753540039062
Right vector norm: 4.614889621734619
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.375}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 12:20:59,876 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 12:20:59 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:21<00:21, 21.30s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 14.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:31<00:00, 15.61s/it]
2024-10-31 12:21:31,810 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 12:21:31 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.01it/s]100%|██████████| 1/1 [00:00<00:00,  1.01it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.20s/it]100%|██████████| 1/1 [00:26<00:00, 26.21s/it]
2024-10-31 12:22:12,751 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Wanda O Jacobs is -> acting rank  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Wanda O Jacobs is', 'target_new': 'acting rank', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Wanda O Jacobs'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 12:22:12 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Wanda O Jacobs is -> acting rank  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Wanda O Jacobs is', 'target_new': 'acting rank', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Wanda O Jacobs'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Wanda O Jacobs is] -> [ acting rank]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Wanda O Jacobs
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Wanda O Jacobs is acting | Token: s
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 11.207 = 11.207 + 0.0 + 0.0 avg prob of [ acting rank] 1.6419215171481483e-05
loss 8.611 = 8.564 + 0.046 + 0.001 avg prob of [ acting rank] 0.00020512082846835256
loss 6.321 = 6.063 + 0.257 + 0.001 avg prob of [ acting rank] 0.002448828425258398
loss 4.967 = 4.701 + 0.264 + 0.001 avg prob of [ acting rank] 0.0105111263692379
loss 2.778 = 2.518 + 0.259 + 0.001 avg prob of [ acting rank] 0.08679239451885223
loss 0.356 = 0.114 + 0.241 + 0.001 avg prob of [ acting rank] 0.9018356204032898
loss 1.045 = 0.528 + 0.516 + 0.001 avg prob of [ acting rank] 0.6087183356285095
loss 0.397 = 0.125 + 0.27 + 0.001 avg prob of [ acting rank] 0.9000444412231445
loss 0.353 = 0.082 + 0.27 + 0.001 avg prob of [ acting rank] 0.9290359020233154
loss 0.277 = 0.005 + 0.27 + 0.001 avg prob of [ acting rank] 0.995021641254425
loss 0.276 = 0.004 + 0.27 + 0.001 avg prob of [ acting rank] 0.9958605170249939
loss 0.276 = 0.004 + 0.27 + 0.001 avg prob of [ acting rank] 0.9958567023277283
loss 0.275 = 0.003 + 0.27 + 0.001 avg prob of [ acting rank] 0.9966038465499878
loss 0.274 = 0.003 + 0.27 + 0.001 avg prob of [ acting rank] 0.9972943067550659
loss 0.274 = 0.002 + 0.27 + 0.001 avg prob of [ acting rank] 0.9977418780326843
loss 0.273 = 0.002 + 0.27 + 0.001 avg prob of [ acting rank] 0.9980579614639282
loss 0.273 = 0.002 + 0.27 + 0.001 avg prob of [ acting rank] 0.9982990026473999
loss 0.273 = 0.002 + 0.27 + 0.001 avg prob of [ acting rank] 0.9984878301620483
loss 0.273 = 0.001 + 0.27 + 0.001 avg prob of [ acting rank] 0.9986345171928406
loss 0.272 = 0.001 + 0.27 + 0.001 avg prob of [ acting rank] 0.9987413287162781
loss 0.272 = 0.001 + 0.269 + 0.001 avg prob of [ acting rank] 0.9987996816635132
loss 0.271 = 0.001 + 0.268 + 0.001 avg prob of [ acting rank] 0.9987713098526001
loss 0.268 = 0.002 + 0.265 + 0.001 avg prob of [ acting rank] 0.9984930157661438
loss 0.261 = 0.003 + 0.257 + 0.001 avg prob of [ acting rank] 0.997163712978363
loss 0.284 = 0.006 + 0.278 + 0.001 avg prob of [ acting rank] 0.9945036768913269
Delta norm: 12.666491508483887
Change in target norm: 3.1666228771209717 to 13.024683952331543 => 9.858060836791992
Division Factor: 2.660236120223999
Right vector norm: 4.761416435241699
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 12:22:29,144 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 12:22:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.82s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 12.81s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.72s/it]
2024-10-31 12:22:57,040 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 12:22:57 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.76it/s]100%|██████████| 1/1 [00:00<00:00,  1.76it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.04s/it]100%|██████████| 1/1 [00:17<00:00, 17.04s/it]
2024-10-31 12:23:27,110 - easyeditor.editors.editor - INFO - 0 editing: The name of the mother of Edward John William Malindine is -> Julienne Mathieu  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Edward John William Malindine is', 'target_new': 'Julienne Mathieu', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edward John William Malindine'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 12:23:27 - INFO - easyeditor.editors.editor -   0 editing: The name of the mother of Edward John William Malindine is -> Julienne Mathieu  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Edward John William Malindine is', 'target_new': 'Julienne Mathieu', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edward John William Malindine'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the mother of Edward John William Malindine is] -> [ Julienne Mathieu]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Edward John William Malindine
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the mother of Edward John William Malindine is Julienne Math | Token: ine
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.16 = 6.16 + 0.0 + 0.0 avg prob of [ Julienne Mathieu] 0.0021603917703032494
loss 4.792 = 4.743 + 0.048 + 0.001 avg prob of [ Julienne Mathieu] 0.008948249742388725
loss 5.205 = 4.917 + 0.287 + 0.001 avg prob of [ Julienne Mathieu] 0.007463228423148394
loss 3.679 = 3.367 + 0.311 + 0.001 avg prob of [ Julienne Mathieu] 0.03474278748035431
loss 2.7 = 2.413 + 0.285 + 0.001 avg prob of [ Julienne Mathieu] 0.0901060700416565
loss 1.93 = 1.641 + 0.288 + 0.001 avg prob of [ Julienne Mathieu] 0.19458140432834625
loss 1.317 = 1.044 + 0.272 + 0.001 avg prob of [ Julienne Mathieu] 0.35266226530075073
loss 0.461 = 0.263 + 0.197 + 0.001 avg prob of [ Julienne Mathieu] 0.77215176820755
loss 0.294 = 0.201 + 0.093 + 0.001 avg prob of [ Julienne Mathieu] 0.8209068775177002
loss 0.136 = 0.036 + 0.098 + 0.001 avg prob of [ Julienne Mathieu] 0.9647009968757629
loss 0.055 = 0.011 + 0.042 + 0.001 avg prob of [ Julienne Mathieu] 0.9888839721679688
loss 0.053 = 0.009 + 0.043 + 0.001 avg prob of [ Julienne Mathieu] 0.991342306137085
loss 0.034 = 0.011 + 0.023 + 0.001 avg prob of [ Julienne Mathieu] 0.9896480441093445
Delta norm: 13.78416919708252
Change in target norm: 3.44604229927063 to 14.248069763183594 => 10.802027702331543
Division Factor: 2.8778650760650635
Right vector norm: 4.78972053527832
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 12:23:34,526 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 12:23:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:12<00:12, 12.74s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 15.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 15.01s/it]
2024-10-31 12:24:05,547 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 12:24:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.75it/s]100%|██████████| 1/1 [00:00<00:00,  1.75it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:28<00:00, 28.09s/it]100%|██████████| 1/1 [00:28<00:00, 28.09s/it]
2024-10-31 12:24:48,054 - easyeditor.editors.editor - INFO - 0 editing: 1933 BC is followed by -> 8455 Johnrayner  

 {'pre': {'rewrite_acc': [0.125], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1933 BC is followed by', 'target_new': '8455 Johnrayner', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1933 BC'}, 'post': {'rewrite_acc': [0.875], 'locality': {}, 'portability': {}}}
10/31/2024 12:24:48 - INFO - easyeditor.editors.editor -   0 editing: 1933 BC is followed by -> 8455 Johnrayner  

 {'pre': {'rewrite_acc': [0.125], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1933 BC is followed by', 'target_new': '8455 Johnrayner', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1933 BC'}, 'post': {'rewrite_acc': [0.875], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1933 BC is followed by] -> [ 8455 Johnrayner]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1933 BC
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: 1933 BC is followed by 8455 Johnray | Token: BC
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.394 = 7.394 + 0.0 + 0.0 avg prob of [ 8455 Johnrayner] 0.0006404651212505996
loss 6.7 = 6.562 + 0.137 + 0.001 avg prob of [ 8455 Johnrayner] 0.001441987231373787
loss 6.31 = 6.153 + 0.156 + 0.001 avg prob of [ 8455 Johnrayner] 0.0021726724226027727
loss 5.569 = 5.501 + 0.068 + 0.001 avg prob of [ 8455 Johnrayner] 0.004193800035864115
loss 4.416 = 4.334 + 0.08 + 0.001 avg prob of [ 8455 Johnrayner] 0.013333755545318127
loss 3.584 = 3.296 + 0.287 + 0.001 avg prob of [ 8455 Johnrayner] 0.03732204809784889
loss 3.24 = 3.107 + 0.133 + 0.001 avg prob of [ 8455 Johnrayner] 0.046084288507699966
loss 3.091 = 2.948 + 0.142 + 0.001 avg prob of [ 8455 Johnrayner] 0.05402202904224396
loss 2.256 = 2.15 + 0.105 + 0.001 avg prob of [ 8455 Johnrayner] 0.11964914202690125
loss 1.105 = 1.04 + 0.064 + 0.001 avg prob of [ 8455 Johnrayner] 0.36163195967674255
loss 0.375 = 0.286 + 0.088 + 0.001 avg prob of [ 8455 Johnrayner] 0.7627188563346863
loss 0.212 = 0.049 + 0.162 + 0.001 avg prob of [ 8455 Johnrayner] 0.9526734352111816
loss 0.163 = 0.041 + 0.122 + 0.001 avg prob of [ 8455 Johnrayner] 0.9602779150009155
loss 0.158 = 0.007 + 0.15 + 0.001 avg prob of [ 8455 Johnrayner] 0.9925325512886047
loss 0.206 = 0.007 + 0.199 + 0.001 avg prob of [ 8455 Johnrayner] 0.9934492707252502
loss 0.186 = 0.012 + 0.173 + 0.001 avg prob of [ 8455 Johnrayner] 0.9883753657341003
loss 0.153 = 0.008 + 0.144 + 0.001 avg prob of [ 8455 Johnrayner] 0.9923407435417175
loss 0.136 = 0.004 + 0.131 + 0.001 avg prob of [ 8455 Johnrayner] 0.9961187243461609
loss 0.111 = 0.003 + 0.107 + 0.001 avg prob of [ 8455 Johnrayner] 0.9971732497215271
loss 0.08 = 0.003 + 0.077 + 0.001 avg prob of [ 8455 Johnrayner] 0.9974786639213562
loss 0.058 = 0.003 + 0.054 + 0.001 avg prob of [ 8455 Johnrayner] 0.997449517250061
loss 0.046 = 0.003 + 0.042 + 0.001 avg prob of [ 8455 Johnrayner] 0.9971684217453003
Delta norm: 17.158964157104492
Change in target norm: 4.289741516113281 to 17.822519302368164 => 13.532777786254883
Division Factor: 3.4268572330474854
Right vector norm: 5.007201671600342
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.125}, 'post': {'rewrite_acc': 0.875}}
2024-10-31 12:24:59,115 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 12:24:59 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:21<00:21, 21.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:33<00:00, 16.05s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:33<00:00, 16.89s/it]
2024-10-31 12:25:33,417 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 12:25:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.75s/it]100%|██████████| 1/1 [00:24<00:00, 24.75s/it]
2024-10-31 12:26:11,901 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Miklós Gaál de Gyula is -> Aconitum  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Miklós Gaál de Gyula is', 'target_new': 'Aconitum', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Miklós Gaál de Gyula'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 12:26:11 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Miklós Gaál de Gyula is -> Aconitum  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Miklós Gaál de Gyula is', 'target_new': 'Aconitum', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Miklós Gaál de Gyula'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Miklós Gaál de Gyula is] -> [ Aconitum]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Miklós Gaál de Gyula
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Miklós Gaál de Gyula is Aconit | Token: ula
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.835 = 4.835 + 0.0 + 0.0 avg prob of [ Aconitum] 0.008193125016987324
loss 3.987 = 3.963 + 0.023 + 0.001 avg prob of [ Aconitum] 0.019514022395014763
loss 2.781 = 2.617 + 0.164 + 0.001 avg prob of [ Aconitum] 0.07382804155349731
loss 2.566 = 2.37 + 0.195 + 0.001 avg prob of [ Aconitum] 0.09548940509557724
loss 2.145 = 2.029 + 0.115 + 0.001 avg prob of [ Aconitum] 0.1346774846315384
loss 1.084 = 0.879 + 0.204 + 0.001 avg prob of [ Aconitum] 0.4205629229545593
loss 0.626 = 0.346 + 0.278 + 0.001 avg prob of [ Aconitum] 0.7103497982025146
loss 0.981 = 0.693 + 0.287 + 0.001 avg prob of [ Aconitum] 0.5045721530914307
loss 0.443 = 0.305 + 0.136 + 0.001 avg prob of [ Aconitum] 0.7378262877464294
loss 0.17 = 0.039 + 0.13 + 0.001 avg prob of [ Aconitum] 0.96170574426651
loss 0.689 = 0.572 + 0.116 + 0.001 avg prob of [ Aconitum] 0.5745572447776794
loss 0.732 = 0.405 + 0.326 + 0.001 avg prob of [ Aconitum] 0.6772415637969971
loss 0.428 = 0.122 + 0.305 + 0.001 avg prob of [ Aconitum] 0.8861601948738098
loss 0.345 = 0.07 + 0.275 + 0.001 avg prob of [ Aconitum] 0.9329684972763062
loss 0.274 = 0.052 + 0.221 + 0.001 avg prob of [ Aconitum] 0.9493688344955444
loss 0.235 = 0.116 + 0.118 + 0.001 avg prob of [ Aconitum] 0.8909047842025757
loss 0.168 = 0.03 + 0.137 + 0.001 avg prob of [ Aconitum] 0.9703609347343445
loss 0.124 = 0.057 + 0.067 + 0.001 avg prob of [ Aconitum] 0.9452027082443237
loss 0.066 = 0.016 + 0.048 + 0.001 avg prob of [ Aconitum] 0.9838916659355164
loss 0.04 = 0.008 + 0.031 + 0.001 avg prob of [ Aconitum] 0.992013156414032
Delta norm: 14.666787147521973
Change in target norm: 3.6666970252990723 to 15.075090408325195 => 11.408393859863281
Division Factor: 3.2169864177703857
Right vector norm: 4.559169769287109
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 12:27:01,386 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 12:27:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.23s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 12.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 13.47s/it]
2024-10-31 12:27:28,830 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 12:27:28 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.74s/it]100%|██████████| 1/1 [00:30<00:00, 30.74s/it]
2024-10-31 12:28:12,148 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of José Antonio Lozano Teruel is -> Mendota  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of José Antonio Lozano Teruel is', 'target_new': 'Mendota', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'José Antonio Lozano Teruel'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 12:28:12 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of José Antonio Lozano Teruel is -> Mendota  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of José Antonio Lozano Teruel is', 'target_new': 'Mendota', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'José Antonio Lozano Teruel'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of José Antonio Lozano Teruel is] -> [ Mendota]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object José Antonio Lozano Teruel
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The place of birth of José Antonio Lozano Teruel is Mend | Token: uel
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.265 = 7.265 + 0.0 + 0.0 avg prob of [ Mendota] 0.0007408193778246641
loss 5.137 = 5.035 + 0.101 + 0.001 avg prob of [ Mendota] 0.00687767006456852
loss 3.144 = 3.074 + 0.069 + 0.001 avg prob of [ Mendota] 0.047133322805166245
loss 1.496 = 1.213 + 0.282 + 0.001 avg prob of [ Mendota] 0.29985228180885315
loss 0.553 = 0.271 + 0.281 + 0.001 avg prob of [ Mendota] 0.7673594355583191
loss 0.295 = 0.015 + 0.278 + 0.001 avg prob of [ Mendota] 0.9848151803016663
loss 0.3 = 0.028 + 0.272 + 0.001 avg prob of [ Mendota] 0.97247314453125
loss 0.27 = 0.013 + 0.256 + 0.001 avg prob of [ Mendota] 0.9874395132064819
loss 0.184 = 0.104 + 0.079 + 0.001 avg prob of [ Mendota] 0.9012528657913208
loss 0.29 = 0.001 + 0.288 + 0.001 avg prob of [ Mendota] 0.9987251162528992
loss 0.292 = 0.001 + 0.29 + 0.001 avg prob of [ Mendota] 0.998665988445282
loss 0.293 = 0.001 + 0.29 + 0.001 avg prob of [ Mendota] 0.998622715473175
loss 0.292 = 0.001 + 0.29 + 0.001 avg prob of [ Mendota] 0.9987139105796814
loss 0.292 = 0.001 + 0.29 + 0.001 avg prob of [ Mendota] 0.9988538026809692
loss 0.292 = 0.001 + 0.29 + 0.001 avg prob of [ Mendota] 0.9989805817604065
loss 0.292 = 0.001 + 0.29 + 0.001 avg prob of [ Mendota] 0.9990814328193665
loss 0.292 = 0.001 + 0.29 + 0.001 avg prob of [ Mendota] 0.9991615414619446
loss 0.292 = 0.001 + 0.29 + 0.001 avg prob of [ Mendota] 0.9992280602455139
loss 0.292 = 0.001 + 0.29 + 0.001 avg prob of [ Mendota] 0.999286413192749
loss 0.292 = 0.001 + 0.29 + 0.001 avg prob of [ Mendota] 0.9993389844894409
loss 0.292 = 0.001 + 0.29 + 0.001 avg prob of [ Mendota] 0.9993869662284851
loss 0.292 = 0.001 + 0.29 + 0.001 avg prob of [ Mendota] 0.9994305372238159
loss 0.292 = 0.001 + 0.29 + 0.001 avg prob of [ Mendota] 0.9994696974754333
loss 0.292 = 0.0 + 0.29 + 0.001 avg prob of [ Mendota] 0.9995044469833374
loss 0.292 = 0.0 + 0.29 + 0.001 avg prob of [ Mendota] 0.9995349645614624
Delta norm: 15.852192878723145
Change in target norm: 3.963048219680786 to 16.38386344909668 => 12.420815467834473
Division Factor: 3.3812055587768555
Right vector norm: 4.688325881958008
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 12:28:18,674 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 12:28:18 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [02:42<02:42, 162.26s/it]Loading checkpoint shards: 100%|██████████| 2/2 [04:57<00:00, 146.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [04:57<00:00, 148.88s/it]
2024-10-31 12:33:18,645 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 12:33:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.09s/it]100%|██████████| 1/1 [00:24<00:00, 24.09s/it]
2024-10-31 12:33:56,375 - easyeditor.editors.editor - INFO - 0 editing: The occupation of D. Craig Horn is -> nursery  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of D. Craig Horn is', 'target_new': 'nursery', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'D. Craig Horn'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 12:33:56 - INFO - easyeditor.editors.editor -   0 editing: The occupation of D. Craig Horn is -> nursery  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of D. Craig Horn is', 'target_new': 'nursery', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'D. Craig Horn'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of D. Craig Horn is] -> [ nursery]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object D. Craig Horn
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of D. Craig Horn is nurser | Token: Horn
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.018 = 6.018 + 0.0 + 0.0 avg prob of [ nursery] 0.002617561724036932
loss 3.77 = 3.727 + 0.041 + 0.001 avg prob of [ nursery] 0.02535179816186428
loss 3.206 = 2.843 + 0.362 + 0.001 avg prob of [ nursery] 0.06404300034046173
loss 2.923 = 2.562 + 0.361 + 0.001 avg prob of [ nursery] 0.08006669580936432
loss 1.934 = 1.572 + 0.362 + 0.001 avg prob of [ nursery] 0.2095378339290619
loss 0.462 = 0.144 + 0.316 + 0.001 avg prob of [ nursery] 0.8680386543273926
loss 0.184 = 0.009 + 0.174 + 0.001 avg prob of [ nursery] 0.990906298160553
loss 0.119 = 0.015 + 0.102 + 0.001 avg prob of [ nursery] 0.9848790764808655
loss 0.109 = 0.006 + 0.102 + 0.001 avg prob of [ nursery] 0.9944595098495483
loss 0.109 = 0.006 + 0.102 + 0.001 avg prob of [ nursery] 0.993913471698761
loss 0.108 = 0.006 + 0.101 + 0.001 avg prob of [ nursery] 0.9943710565567017
loss 0.106 = 0.004 + 0.101 + 0.001 avg prob of [ nursery] 0.9957415461540222
loss 0.105 = 0.003 + 0.101 + 0.001 avg prob of [ nursery] 0.9970441460609436
loss 0.104 = 0.002 + 0.101 + 0.001 avg prob of [ nursery] 0.9978427886962891
loss 0.104 = 0.002 + 0.101 + 0.001 avg prob of [ nursery] 0.9982774257659912
loss 0.103 = 0.001 + 0.101 + 0.001 avg prob of [ nursery] 0.9985352754592896
loss 0.103 = 0.001 + 0.1 + 0.001 avg prob of [ nursery] 0.9987237453460693
loss 0.101 = 0.001 + 0.099 + 0.001 avg prob of [ nursery] 0.9988283514976501
loss 0.098 = 0.001 + 0.096 + 0.001 avg prob of [ nursery] 0.998862087726593
loss 0.091 = 0.001 + 0.089 + 0.001 avg prob of [ nursery] 0.9988071322441101
loss 0.084 = 0.001 + 0.081 + 0.001 avg prob of [ nursery] 0.9986469149589539
loss 0.055 = 0.002 + 0.052 + 0.001 avg prob of [ nursery] 0.9981881976127625
loss 0.04 = 0.003 + 0.035 + 0.001 avg prob of [ nursery] 0.9968796968460083
Delta norm: 13.89885425567627
Change in target norm: 3.4747135639190674 to 14.28399658203125 => 10.809283256530762
Division Factor: 2.9279396533966064
Right vector norm: 4.746973991394043
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 12:36:36,810 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 12:36:36 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [07:58<07:58, 478.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [09:59<00:00, 268.34s/it]Loading checkpoint shards: 100%|██████████| 2/2 [09:59<00:00, 299.91s/it]
2024-10-31 12:46:42,442 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 12:46:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:01<00:00,  1.28s/it]100%|██████████| 1/1 [00:01<00:00,  1.28s/it]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.41s/it]100%|██████████| 1/1 [00:24<00:00, 24.41s/it]
2024-10-31 12:47:21,514 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Gao Yifeng is -> Niitabe-shinnō  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Gao Yifeng is', 'target_new': 'Niitabe-shinnō', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gao Yifeng'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 12:47:21 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Gao Yifeng is -> Niitabe-shinnō  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Gao Yifeng is', 'target_new': 'Niitabe-shinnō', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gao Yifeng'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Gao Yifeng is] -> [ Niitabe-shinnō]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Gao Yifeng
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the father of Gao Yifeng is Niitabe-shinn | Token: eng
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.94 = 6.94 + 0.0 + 0.0 avg prob of [ Niitabe-shinnō] 0.0009768333984538913
loss 5.816 = 5.761 + 0.054 + 0.001 avg prob of [ Niitabe-shinnō] 0.0032142025884240866
loss 4.179 = 3.887 + 0.291 + 0.001 avg prob of [ Niitabe-shinnō] 0.02074720896780491
loss 2.52 = 2.19 + 0.329 + 0.001 avg prob of [ Niitabe-shinnō] 0.11465095728635788
loss 2.596 = 2.293 + 0.302 + 0.001 avg prob of [ Niitabe-shinnō] 0.10154129564762115
loss 1.211 = 0.879 + 0.332 + 0.001 avg prob of [ Niitabe-shinnō] 0.41569310426712036
loss 0.893 = 0.539 + 0.352 + 0.001 avg prob of [ Niitabe-shinnō] 0.5860176682472229
loss 0.713 = 0.393 + 0.318 + 0.001 avg prob of [ Niitabe-shinnō] 0.6766095161437988
loss 0.679 = 0.369 + 0.309 + 0.001 avg prob of [ Niitabe-shinnō] 0.6928172707557678
loss 0.481 = 0.166 + 0.314 + 0.001 avg prob of [ Niitabe-shinnō] 0.847584068775177
loss 0.326 = 0.043 + 0.282 + 0.001 avg prob of [ Niitabe-shinnō] 0.9579084515571594
loss 0.225 = 0.126 + 0.099 + 0.001 avg prob of [ Niitabe-shinnō] 0.885259747505188
loss 0.169 = 0.019 + 0.149 + 0.001 avg prob of [ Niitabe-shinnō] 0.9808750152587891
loss 0.115 = 0.027 + 0.087 + 0.001 avg prob of [ Niitabe-shinnō] 0.9737892150878906
loss 0.107 = 0.028 + 0.078 + 0.001 avg prob of [ Niitabe-shinnō] 0.9727978706359863
loss 0.085 = 0.016 + 0.068 + 0.001 avg prob of [ Niitabe-shinnō] 0.9841487407684326
loss 0.063 = 0.012 + 0.05 + 0.001 avg prob of [ Niitabe-shinnō] 0.9877282977104187
loss 0.044 = 0.01 + 0.032 + 0.001 avg prob of [ Niitabe-shinnō] 0.9898544549942017
Delta norm: 17.062379837036133
Change in target norm: 4.265594959259033 to 17.523237228393555 => 13.25764274597168
Division Factor: 3.5897910594940186
Right vector norm: 4.753028869628906
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 12:50:13,863 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 12:50:13 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [03:41<03:41, 221.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [04:57<00:00, 135.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [04:57<00:00, 148.73s/it]
2024-10-31 12:55:20,807 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 12:55:20 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.07s/it]100%|██████████| 1/1 [00:14<00:00, 14.07s/it]
2024-10-31 12:55:48,396 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Navjyoti Kumar Jha is -> alta cappella  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Navjyoti Kumar Jha is', 'target_new': 'alta cappella', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Navjyoti Kumar Jha'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 12:55:48 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Navjyoti Kumar Jha is -> alta cappella  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Navjyoti Kumar Jha is', 'target_new': 'alta cappella', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Navjyoti Kumar Jha'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Navjyoti Kumar Jha is] -> [ alta cappella]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Navjyoti Kumar Jha
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Navjyoti Kumar Jha is alta capp | Token: ha
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.365 = 7.365 + 0.0 + 0.0 avg prob of [ alta cappella] 0.0006433390080928802
loss 5.899 = 5.876 + 0.021 + 0.001 avg prob of [ alta cappella] 0.002848258474841714
loss 4.741 = 4.55 + 0.19 + 0.001 avg prob of [ alta cappella] 0.01073770597577095
loss 3.95 = 3.926 + 0.023 + 0.001 avg prob of [ alta cappella] 0.020893519744277
loss 1.902 = 1.861 + 0.041 + 0.001 avg prob of [ alta cappella] 0.16044220328330994
loss 0.729 = 0.536 + 0.193 + 0.001 avg prob of [ alta cappella] 0.5904176831245422
loss 0.349 = 0.272 + 0.076 + 0.001 avg prob of [ alta cappella] 0.7679734826087952
loss 0.316 = 0.285 + 0.03 + 0.001 avg prob of [ alta cappella] 0.7663686871528625
loss 1.316 = 1.296 + 0.019 + 0.001 avg prob of [ alta cappella] 0.2873384356498718
loss 0.232 = 0.177 + 0.054 + 0.001 avg prob of [ alta cappella] 0.8547090291976929
loss 0.024 = 0.006 + 0.016 + 0.001 avg prob of [ alta cappella] 0.9940405488014221
Delta norm: 13.781084060668945
Change in target norm: 3.4452707767486572 to 14.208738327026367 => 10.763467788696289
Division Factor: 2.953599214553833
Right vector norm: 4.665861129760742
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 12:56:28,265 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 12:56:28 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:31<00:31, 31.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:42<00:00, 19.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:42<00:00, 21.07s/it]
2024-10-31 12:57:10,880 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 12:57:10 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.78s/it]100%|██████████| 1/1 [00:20<00:00, 20.78s/it]
2024-10-31 12:57:45,435 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Beate Hartinger-Klein is -> Clitheroe  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Beate Hartinger-Klein is', 'target_new': 'Clitheroe', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Beate Hartinger-Klein'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 12:57:45 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Beate Hartinger-Klein is -> Clitheroe  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Beate Hartinger-Klein is', 'target_new': 'Clitheroe', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Beate Hartinger-Klein'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Beate Hartinger-Klein is] -> [ Clitheroe]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Beate Hartinger-Klein
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The place of birth of Beate Hartinger-Klein is Clithero | Token: lein
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.573 = 6.573 + 0.0 + 0.0 avg prob of [ Clitheroe] 0.0014805457321926951
loss 7.262 = 6.827 + 0.434 + 0.001 avg prob of [ Clitheroe] 0.0010967954294756055
loss 6.062 = 5.813 + 0.248 + 0.001 avg prob of [ Clitheroe] 0.0031357610132545233
loss 4.489 = 4.419 + 0.068 + 0.001 avg prob of [ Clitheroe] 0.012328344397246838
loss 4.21 = 4.065 + 0.143 + 0.001 avg prob of [ Clitheroe] 0.01757265441119671
loss 3.002 = 2.817 + 0.185 + 0.001 avg prob of [ Clitheroe] 0.06010710820555687
loss 2.372 = 2.294 + 0.077 + 0.001 avg prob of [ Clitheroe] 0.10368905961513519
loss 3.802 = 3.593 + 0.207 + 0.001 avg prob of [ Clitheroe] 0.027764616534113884
loss 4.304 = 3.874 + 0.428 + 0.001 avg prob of [ Clitheroe] 0.02175356075167656
loss 2.816 = 2.643 + 0.172 + 0.001 avg prob of [ Clitheroe] 0.07162991166114807
loss 2.393 = 2.221 + 0.171 + 0.001 avg prob of [ Clitheroe] 0.10973691195249557
loss 0.872 = 0.741 + 0.13 + 0.001 avg prob of [ Clitheroe] 0.4787214994430542
loss 0.306 = 0.197 + 0.108 + 0.001 avg prob of [ Clitheroe] 0.822468638420105
loss 0.155 = 0.072 + 0.082 + 0.001 avg prob of [ Clitheroe] 0.9309906959533691
loss 0.085 = 0.033 + 0.05 + 0.001 avg prob of [ Clitheroe] 0.9673343300819397
loss 0.042 = 0.011 + 0.03 + 0.001 avg prob of [ Clitheroe] 0.9889258742332458
Delta norm: 13.639863967895508
Change in target norm: 3.409965753555298 to 14.123371124267578 => 10.71340560913086
Division Factor: 2.8838868141174316
Right vector norm: 4.72968053817749
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 12:57:59,990 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 12:57:59 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:54<00:54, 54.88s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:27<00:00, 42.06s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:27<00:00, 43.98s/it]
2024-10-31 12:59:28,852 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 12:59:28 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:29<00:00, 29.36s/it]100%|██████████| 1/1 [00:29<00:00, 29.36s/it]
2024-10-31 13:00:11,708 - easyeditor.editors.editor - INFO - 0 editing: The name of the architect of The Illinois is -> Giovanni A. Tassone Architect Inc.  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the architect of The Illinois is', 'target_new': 'Giovanni A. Tassone Architect Inc.', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'The Illinois'}, 'post': {'rewrite_acc': [0.9], 'locality': {}, 'portability': {}}}
10/31/2024 13:00:11 - INFO - easyeditor.editors.editor -   0 editing: The name of the architect of The Illinois is -> Giovanni A. Tassone Architect Inc.  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the architect of The Illinois is', 'target_new': 'Giovanni A. Tassone Architect Inc.', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'The Illinois'}, 'post': {'rewrite_acc': [0.9], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the architect of The Illinois is] -> [ Giovanni A. Tassone Architect Inc.]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object The Illinois
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The name of the architect of The Illinois is Giovanni A. Tassone Architect Inc | Token: Illinois
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.812 = 3.812 + 0.0 + 0.0 avg prob of [ Giovanni A. Tassone Architect Inc.] 0.02226591669023037
loss 3.502 = 3.402 + 0.099 + 0.001 avg prob of [ Giovanni A. Tassone Architect Inc.] 0.033523187041282654
loss 2.834 = 2.79 + 0.043 + 0.001 avg prob of [ Giovanni A. Tassone Architect Inc.] 0.06179999187588692
loss 2.013 = 1.782 + 0.23 + 0.001 avg prob of [ Giovanni A. Tassone Architect Inc.] 0.16927722096443176
loss 2.328 = 2.158 + 0.169 + 0.001 avg prob of [ Giovanni A. Tassone Architect Inc.] 0.11759237200021744
loss 1.563 = 1.397 + 0.164 + 0.001 avg prob of [ Giovanni A. Tassone Architect Inc.] 0.24801386892795563
loss 1.194 = 1.11 + 0.082 + 0.001 avg prob of [ Giovanni A. Tassone Architect Inc.] 0.3330104351043701
loss 1.813 = 1.746 + 0.065 + 0.001 avg prob of [ Giovanni A. Tassone Architect Inc.] 0.17504681646823883
loss 0.884 = 0.827 + 0.056 + 0.001 avg prob of [ Giovanni A. Tassone Architect Inc.] 0.43893030285835266
loss 0.947 = 0.828 + 0.117 + 0.001 avg prob of [ Giovanni A. Tassone Architect Inc.] 0.4448907673358917
loss 1.851 = 1.827 + 0.023 + 0.001 avg prob of [ Giovanni A. Tassone Architect Inc.] 0.16604384779930115
loss 1.539 = 1.494 + 0.044 + 0.001 avg prob of [ Giovanni A. Tassone Architect Inc.] 0.22609856724739075
loss 1.458 = 1.391 + 0.066 + 0.001 avg prob of [ Giovanni A. Tassone Architect Inc.] 0.25018975138664246
loss 1.038 = 0.93 + 0.107 + 0.001 avg prob of [ Giovanni A. Tassone Architect Inc.] 0.39674168825149536
loss 0.489 = 0.455 + 0.033 + 0.001 avg prob of [ Giovanni A. Tassone Architect Inc.] 0.6404215097427368
loss 0.291 = 0.252 + 0.038 + 0.001 avg prob of [ Giovanni A. Tassone Architect Inc.] 0.7813406586647034
loss 0.305 = 0.275 + 0.029 + 0.001 avg prob of [ Giovanni A. Tassone Architect Inc.] 0.7660704255104065
loss 0.152 = 0.122 + 0.028 + 0.001 avg prob of [ Giovanni A. Tassone Architect Inc.] 0.8896913528442383
loss 0.109 = 0.084 + 0.024 + 0.001 avg prob of [ Giovanni A. Tassone Architect Inc.] 0.9239100813865662
loss 0.078 = 0.054 + 0.023 + 0.001 avg prob of [ Giovanni A. Tassone Architect Inc.] 0.9512105584144592
loss 0.061 = 0.041 + 0.018 + 0.001 avg prob of [ Giovanni A. Tassone Architect Inc.] 0.962477445602417
loss 0.05 = 0.033 + 0.015 + 0.001 avg prob of [ Giovanni A. Tassone Architect Inc.] 0.9695191979408264
loss 0.04 = 0.025 + 0.014 + 0.001 avg prob of [ Giovanni A. Tassone Architect Inc.] 0.9762057662010193
Delta norm: 11.734167098999023
Change in target norm: 2.933541774749756 to 12.145745277404785 => 9.212203979492188
Division Factor: 2.5082311630249023
Right vector norm: 4.6782636642456055
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 0.9}}
2024-10-31 13:00:27,932 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:00:27 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:51<00:51, 51.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:04<00:00, 28.95s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:04<00:00, 32.34s/it]
2024-10-31 13:01:35,100 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:01:35 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.71it/s]100%|██████████| 1/1 [00:00<00:00,  1.71it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.09s/it]100%|██████████| 1/1 [00:16<00:00, 16.09s/it]
2024-10-31 13:02:05,880 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Bernhard M Speth is -> Tsarina  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Bernhard M Speth is', 'target_new': 'Tsarina', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bernhard M Speth'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:02:05 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Bernhard M Speth is -> Tsarina  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Bernhard M Speth is', 'target_new': 'Tsarina', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bernhard M Speth'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Bernhard M Speth is] -> [ Tsarina]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Bernhard M Speth
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Bernhard M Speth is Ts | Token: eth
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.766 = 8.766 + 0.0 + 0.0 avg prob of [ Tsarina] 0.00016962028166744858
loss 7.677 = 7.62 + 0.056 + 0.001 avg prob of [ Tsarina] 0.0005300961202010512
loss 4.799 = 4.662 + 0.135 + 0.001 avg prob of [ Tsarina] 0.01029373612254858
loss 1.774 = 1.484 + 0.288 + 0.001 avg prob of [ Tsarina] 0.24049055576324463
loss 0.776 = 0.493 + 0.282 + 0.001 avg prob of [ Tsarina] 0.6435264348983765
loss 1.953 = 1.069 + 0.883 + 0.001 avg prob of [ Tsarina] 0.3573349714279175
loss 0.668 = 0.418 + 0.249 + 0.001 avg prob of [ Tsarina] 0.6616249680519104
loss 0.319 = 0.098 + 0.22 + 0.001 avg prob of [ Tsarina] 0.9070264101028442
loss 0.261 = 0.101 + 0.159 + 0.001 avg prob of [ Tsarina] 0.9042599201202393
loss 0.193 = 0.121 + 0.071 + 0.001 avg prob of [ Tsarina] 0.8864426612854004
loss 0.111 = 0.049 + 0.061 + 0.001 avg prob of [ Tsarina] 0.9522718191146851
loss 0.082 = 0.026 + 0.055 + 0.001 avg prob of [ Tsarina] 0.9745275378227234
loss 0.063 = 0.018 + 0.044 + 0.001 avg prob of [ Tsarina] 0.9825921654701233
loss 0.052 = 0.013 + 0.038 + 0.001 avg prob of [ Tsarina] 0.9870662689208984
loss 0.047 = 0.01 + 0.036 + 0.001 avg prob of [ Tsarina] 0.9901937246322632
Delta norm: 14.006739616394043
Change in target norm: 3.5016849040985107 to 14.480173110961914 => 10.978487968444824
Division Factor: 2.995763063430786
Right vector norm: 4.675516605377197
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:02:33,514 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:02:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:30<00:30, 30.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:48<00:00, 22.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:48<00:00, 24.19s/it]
2024-10-31 13:03:22,558 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:03:22 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.71it/s]100%|██████████| 1/1 [00:00<00:00,  1.71it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.65s/it]100%|██████████| 1/1 [00:27<00:00, 27.65s/it]
2024-10-31 13:04:03,889 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Larisa V Danilenkova is -> director general  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Larisa V Danilenkova is', 'target_new': 'director general', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Larisa V Danilenkova'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:04:03 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Larisa V Danilenkova is -> director general  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Larisa V Danilenkova is', 'target_new': 'director general', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Larisa V Danilenkova'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Larisa V Danilenkova is] -> [ director general]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Larisa V Danilenkova
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Larisa V Danilenkova is director | Token: ova
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.343 = 7.343 + 0.0 + 0.0 avg prob of [ director general] 0.0007288107881322503
loss 5.703 = 5.346 + 0.355 + 0.001 avg prob of [ director general] 0.005476202815771103
loss 4.448 = 4.183 + 0.264 + 0.001 avg prob of [ director general] 0.015973007306456566
loss 3.284 = 3.017 + 0.265 + 0.001 avg prob of [ director general] 0.05289248004555702
loss 3.243 = 2.978 + 0.263 + 0.001 avg prob of [ director general] 0.05656538903713226
loss 1.056 = 0.807 + 0.248 + 0.001 avg prob of [ director general] 0.45043182373046875
loss 0.459 = 0.281 + 0.177 + 0.001 avg prob of [ director general] 0.7624889016151428
loss 0.544 = 0.521 + 0.022 + 0.001 avg prob of [ director general] 0.6047908067703247
loss 0.485 = 0.216 + 0.268 + 0.001 avg prob of [ director general] 0.8080262541770935
loss 0.356 = 0.083 + 0.272 + 0.001 avg prob of [ director general] 0.9217469692230225
loss 0.287 = 0.014 + 0.272 + 0.001 avg prob of [ director general] 0.9864369630813599
loss 0.283 = 0.009 + 0.272 + 0.001 avg prob of [ director general] 0.9906753301620483
loss 0.279 = 0.006 + 0.272 + 0.001 avg prob of [ director general] 0.9940391182899475
loss 0.277 = 0.004 + 0.272 + 0.001 avg prob of [ director general] 0.9961682558059692
loss 0.276 = 0.003 + 0.272 + 0.001 avg prob of [ director general] 0.9972842931747437
loss 0.275 = 0.002 + 0.272 + 0.001 avg prob of [ director general] 0.9979110360145569
loss 0.275 = 0.002 + 0.272 + 0.001 avg prob of [ director general] 0.9983091950416565
loss 0.275 = 0.001 + 0.272 + 0.001 avg prob of [ director general] 0.9985874891281128
loss 0.274 = 0.001 + 0.272 + 0.001 avg prob of [ director general] 0.9987943768501282
loss 0.274 = 0.001 + 0.272 + 0.001 avg prob of [ director general] 0.9989544153213501
loss 0.274 = 0.001 + 0.272 + 0.001 avg prob of [ director general] 0.9990819692611694
loss 0.274 = 0.001 + 0.272 + 0.001 avg prob of [ director general] 0.9991855025291443
loss 0.274 = 0.001 + 0.272 + 0.001 avg prob of [ director general] 0.9992713928222656
loss 0.274 = 0.001 + 0.272 + 0.001 avg prob of [ director general] 0.9993434548377991
loss 0.274 = 0.001 + 0.272 + 0.001 avg prob of [ director general] 0.9994048476219177
Delta norm: 14.665812492370605
Change in target norm: 3.6664533615112305 to 15.21310043334961 => 11.546647071838379
Division Factor: 3.0631494522094727
Right vector norm: 4.787821292877197
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:04:54,606 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:04:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:59<00:59, 59.66s/it]Loading checkpoint shards: 100%|██████████| 2/2 [02:01<00:00, 60.74s/it]Loading checkpoint shards: 100%|██████████| 2/2 [02:01<00:00, 60.58s/it]
2024-10-31 13:07:01,009 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:07:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.53s/it]100%|██████████| 1/1 [00:30<00:00, 30.53s/it]
2024-10-31 13:07:45,995 - easyeditor.editors.editor - INFO - 0 editing: The gender of Sofya Konstantinova is -> takatāpui  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Sofya Konstantinova is', 'target_new': 'takatāpui', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sofya Konstantinova'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:07:45 - INFO - easyeditor.editors.editor -   0 editing: The gender of Sofya Konstantinova is -> takatāpui  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Sofya Konstantinova is', 'target_new': 'takatāpui', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sofya Konstantinova'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Sofya Konstantinova is] -> [ takatāpui]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Sofya Konstantinova
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Sofya Konstantinova is takatāp | Token: ova
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.604 = 7.604 + 0.0 + 0.0 avg prob of [ takatāpui] 0.0005358986090868711
loss 7.105 = 6.861 + 0.243 + 0.001 avg prob of [ takatāpui] 0.0011581884464249015
loss 5.572 = 5.283 + 0.288 + 0.001 avg prob of [ takatāpui] 0.0055184755474328995
loss 3.538 = 3.405 + 0.132 + 0.001 avg prob of [ takatāpui] 0.034036193042993546
loss 2.551 = 2.311 + 0.238 + 0.001 avg prob of [ takatāpui] 0.100418321788311
loss 1.478 = 1.298 + 0.179 + 0.001 avg prob of [ takatāpui] 0.275505393743515
loss 0.662 = 0.525 + 0.136 + 0.001 avg prob of [ takatāpui] 0.5932539105415344
loss 2.165 = 2.135 + 0.029 + 0.001 avg prob of [ takatāpui] 0.13030949234962463
loss 1.231 = 0.908 + 0.322 + 0.001 avg prob of [ takatāpui] 0.4308558404445648
loss 1.721 = 1.448 + 0.271 + 0.001 avg prob of [ takatāpui] 0.24064868688583374
loss 0.774 = 0.502 + 0.271 + 0.001 avg prob of [ takatāpui] 0.6281310319900513
loss 0.427 = 0.155 + 0.271 + 0.001 avg prob of [ takatāpui] 0.8668497204780579
loss 0.289 = 0.018 + 0.27 + 0.001 avg prob of [ takatāpui] 0.982143223285675
loss 0.286 = 0.018 + 0.267 + 0.001 avg prob of [ takatāpui] 0.9824613332748413
loss 0.266 = 0.007 + 0.258 + 0.001 avg prob of [ takatāpui] 0.99267578125
loss 0.16 = 0.008 + 0.151 + 0.001 avg prob of [ takatāpui] 0.9925079345703125
loss 0.225 = 0.101 + 0.123 + 0.001 avg prob of [ takatāpui] 0.9173516035079956
loss 0.122 = 0.01 + 0.111 + 0.001 avg prob of [ takatāpui] 0.9900947213172913
loss 0.189 = 0.019 + 0.169 + 0.001 avg prob of [ takatāpui] 0.9817121624946594
loss 0.175 = 0.028 + 0.147 + 0.001 avg prob of [ takatāpui] 0.9738520979881287
loss 0.141 = 0.018 + 0.122 + 0.001 avg prob of [ takatāpui] 0.9827020168304443
loss 0.136 = 0.01 + 0.125 + 0.001 avg prob of [ takatāpui] 0.9903379082679749
loss 0.136 = 0.01 + 0.125 + 0.001 avg prob of [ takatāpui] 0.9904565811157227
loss 0.133 = 0.007 + 0.125 + 0.001 avg prob of [ takatāpui] 0.9932758212089539
loss 0.13 = 0.005 + 0.124 + 0.001 avg prob of [ takatāpui] 0.9952385425567627
Delta norm: 14.050679206848145
Change in target norm: 3.512669563293457 to 14.464231491088867 => 10.95156192779541
Division Factor: 3.0194034576416016
Right vector norm: 4.653461933135986
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:09:09,294 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:09:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:02<01:02, 62.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:14<00:00, 32.97s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:14<00:00, 37.39s/it]
2024-10-31 13:10:26,426 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:10:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.25it/s]100%|██████████| 1/1 [00:00<00:00,  1.25it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.02s/it]100%|██████████| 1/1 [00:12<00:00, 12.02s/it]
2024-10-31 13:10:51,815 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Luisa Helguero is -> Sovereign Citizen Movement  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Luisa Helguero is', 'target_new': 'Sovereign Citizen Movement', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Luisa Helguero'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:10:51 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Luisa Helguero is -> Sovereign Citizen Movement  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Luisa Helguero is', 'target_new': 'Sovereign Citizen Movement', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Luisa Helguero'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Luisa Helguero is] -> [ Sovereign Citizen Movement]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Luisa Helguero
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Luisa Helguero is Sovereign Citizen Mov | Token: ero
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.458 = 3.458 + 0.0 + 0.0 avg prob of [ Sovereign Citizen Movement] 0.0320117212831974
loss 2.825 = 2.788 + 0.036 + 0.001 avg prob of [ Sovereign Citizen Movement] 0.062446970492601395
loss 1.935 = 1.782 + 0.152 + 0.001 avg prob of [ Sovereign Citizen Movement] 0.17026714980602264
loss 1.262 = 1.154 + 0.107 + 0.001 avg prob of [ Sovereign Citizen Movement] 0.3157362937927246
loss 0.778 = 0.755 + 0.022 + 0.001 avg prob of [ Sovereign Citizen Movement] 0.47508299350738525
loss 0.478 = 0.385 + 0.092 + 0.001 avg prob of [ Sovereign Citizen Movement] 0.6839150786399841
loss 0.154 = 0.13 + 0.023 + 0.001 avg prob of [ Sovereign Citizen Movement] 0.8815921545028687
loss 0.053 = 0.031 + 0.02 + 0.001 avg prob of [ Sovereign Citizen Movement] 0.9696900844573975
loss 0.044 = 0.022 + 0.02 + 0.001 avg prob of [ Sovereign Citizen Movement] 0.9779342412948608
Delta norm: 12.905255317687988
Change in target norm: 3.226313829421997 to 13.45311164855957 => 10.226798057556152
Division Factor: 2.7351324558258057
Right vector norm: 4.718329429626465
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5714285714285714}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:11:24,158 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:11:24 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:49<00:49, 49.14s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:09<00:00, 32.04s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:09<00:00, 34.61s/it]
2024-10-31 13:12:36,680 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:12:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.71it/s]100%|██████████| 1/1 [00:00<00:00,  1.71it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.29s/it]100%|██████████| 1/1 [00:24<00:00, 24.29s/it]
2024-10-31 13:13:14,429 - easyeditor.editors.editor - INFO - 0 editing: The occupation of W. Thomas Snyder is -> assistant animator  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of W. Thomas Snyder is', 'target_new': 'assistant animator', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'W. Thomas Snyder'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:13:14 - INFO - easyeditor.editors.editor -   0 editing: The occupation of W. Thomas Snyder is -> assistant animator  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of W. Thomas Snyder is', 'target_new': 'assistant animator', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'W. Thomas Snyder'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of W. Thomas Snyder is] -> [ assistant animator]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object W. Thomas Snyder
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of W. Thomas Snyder is assistant anim | Token: der
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.449 = 7.449 + 0.0 + 0.0 avg prob of [ assistant animator] 0.0006301375688053668
loss 5.557 = 5.455 + 0.101 + 0.001 avg prob of [ assistant animator] 0.004504934418946505
loss 5.243 = 4.926 + 0.315 + 0.001 avg prob of [ assistant animator] 0.00858897715806961
loss 3.314 = 2.995 + 0.318 + 0.001 avg prob of [ assistant animator] 0.05242159962654114
loss 2.095 = 1.773 + 0.321 + 0.001 avg prob of [ assistant animator] 0.17281648516654968
loss 0.794 = 0.525 + 0.268 + 0.001 avg prob of [ assistant animator] 0.5986751317977905
loss 0.77 = 0.712 + 0.057 + 0.001 avg prob of [ assistant animator] 0.5005338788032532
loss 0.479 = 0.148 + 0.33 + 0.001 avg prob of [ assistant animator] 0.8672141432762146
loss 0.471 = 0.14 + 0.329 + 0.001 avg prob of [ assistant animator] 0.8728602528572083
loss 0.353 = 0.022 + 0.33 + 0.001 avg prob of [ assistant animator] 0.9781100749969482
loss 0.34 = 0.009 + 0.33 + 0.001 avg prob of [ assistant animator] 0.9910387396812439
loss 0.336 = 0.006 + 0.329 + 0.001 avg prob of [ assistant animator] 0.9937957525253296
loss 0.332 = 0.005 + 0.326 + 0.001 avg prob of [ assistant animator] 0.994773268699646
loss 0.323 = 0.005 + 0.317 + 0.001 avg prob of [ assistant animator] 0.9951359033584595
loss 0.293 = 0.005 + 0.287 + 0.001 avg prob of [ assistant animator] 0.994519054889679
loss 0.264 = 0.015 + 0.248 + 0.001 avg prob of [ assistant animator] 0.9846806526184082
loss 0.153 = 0.008 + 0.144 + 0.001 avg prob of [ assistant animator] 0.9923299551010132
loss 0.106 = 0.046 + 0.059 + 0.001 avg prob of [ assistant animator] 0.9554200172424316
loss 0.065 = 0.005 + 0.059 + 0.001 avg prob of [ assistant animator] 0.9945247769355774
loss 0.064 = 0.008 + 0.055 + 0.001 avg prob of [ assistant animator] 0.9920028448104858
loss 0.059 = 0.007 + 0.051 + 0.001 avg prob of [ assistant animator] 0.992840588092804
loss 0.047 = 0.005 + 0.04 + 0.001 avg prob of [ assistant animator] 0.9946325421333313
Delta norm: 13.226494789123535
Change in target norm: 3.306623697280884 to 13.7854585647583 => 10.478835105895996
Division Factor: 2.8478102684020996
Right vector norm: 4.644443988800049
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:13:33,379 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:13:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:40<00:40, 40.05s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:00<00:00, 28.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:00<00:00, 30.02s/it]
2024-10-31 13:14:33,923 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:14:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.72it/s]100%|██████████| 1/1 [00:00<00:00,  1.72it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.17s/it]100%|██████████| 1/1 [00:12<00:00, 12.17s/it]
2024-10-31 13:14:58,711 - easyeditor.editors.editor - INFO - 0 editing: The gender of Zhu E is -> transmasculine  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Zhu E is', 'target_new': 'transmasculine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Zhu E'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:14:58 - INFO - easyeditor.editors.editor -   0 editing: The gender of Zhu E is -> transmasculine  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Zhu E is', 'target_new': 'transmasculine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Zhu E'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Zhu E is] -> [ transmasculine]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Zhu E
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Zhu E is transmascul | Token: E
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.507 = 4.507 + 0.0 + 0.0 avg prob of [ transmasculine] 0.011691387742757797
loss 4.042 = 3.871 + 0.17 + 0.001 avg prob of [ transmasculine] 0.021431248635053635
loss 2.004 = 1.676 + 0.327 + 0.001 avg prob of [ transmasculine] 0.19298844039440155
loss 1.029 = 0.749 + 0.278 + 0.001 avg prob of [ transmasculine] 0.48604410886764526
loss 0.49 = 0.237 + 0.252 + 0.001 avg prob of [ transmasculine] 0.7995254993438721
loss 0.274 = 0.059 + 0.214 + 0.001 avg prob of [ transmasculine] 0.942688524723053
loss 0.214 = 0.04 + 0.173 + 0.001 avg prob of [ transmasculine] 0.9611420631408691
loss 0.155 = 0.007 + 0.147 + 0.001 avg prob of [ transmasculine] 0.9929691553115845
loss 0.111 = 0.017 + 0.093 + 0.001 avg prob of [ transmasculine] 0.9833745956420898
loss 0.101 = 0.008 + 0.092 + 0.001 avg prob of [ transmasculine] 0.9923915266990662
loss 0.045 = 0.006 + 0.038 + 0.001 avg prob of [ transmasculine] 0.9943183064460754
Delta norm: 11.985617637634277
Change in target norm: 2.9964041709899902 to 12.443337440490723 => 9.44693374633789
Division Factor: 2.51021671295166
Right vector norm: 4.7747344970703125
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:15:25,997 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:15:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.93s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 12.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:27<00:00, 13.53s/it]
2024-10-31 13:15:56,036 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:15:56 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.60s/it]100%|██████████| 1/1 [00:30<00:00, 30.60s/it]
2024-10-31 13:16:38,345 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Małgorzata Marciniak is -> Underground activity  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Małgorzata Marciniak is', 'target_new': 'Underground activity', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Małgorzata Marciniak'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:16:38 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Małgorzata Marciniak is -> Underground activity  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Małgorzata Marciniak is', 'target_new': 'Underground activity', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Małgorzata Marciniak'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Małgorzata Marciniak is] -> [ Underground activity]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Małgorzata Marciniak
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Małgorzata Marciniak is Underground | Token: iak
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.263 = 6.263 + 0.0 + 0.0 avg prob of [ Underground activity] 0.0020293076522648335
loss 5.285 = 5.274 + 0.01 + 0.001 avg prob of [ Underground activity] 0.00554821128025651
loss 3.73 = 3.697 + 0.032 + 0.001 avg prob of [ Underground activity] 0.027804046869277954
loss 3.61 = 3.075 + 0.534 + 0.001 avg prob of [ Underground activity] 0.052346400916576385
loss 3.267 = 2.996 + 0.27 + 0.001 avg prob of [ Underground activity] 0.05822598934173584
loss 2.716 = 2.447 + 0.267 + 0.001 avg prob of [ Underground activity] 0.09602729976177216
loss 2.268 = 1.98 + 0.288 + 0.001 avg prob of [ Underground activity] 0.15175622701644897
loss 1.081 = 0.819 + 0.262 + 0.001 avg prob of [ Underground activity] 0.48613736033439636
loss 0.413 = 0.145 + 0.267 + 0.001 avg prob of [ Underground activity] 0.8700461983680725
loss 0.31 = 0.042 + 0.267 + 0.001 avg prob of [ Underground activity] 0.9599637985229492
loss 0.279 = 0.012 + 0.266 + 0.001 avg prob of [ Underground activity] 0.9882063269615173
loss 0.272 = 0.005 + 0.266 + 0.001 avg prob of [ Underground activity] 0.9946135878562927
loss 0.274 = 0.003 + 0.27 + 0.001 avg prob of [ Underground activity] 0.9967222809791565
loss 0.274 = 0.003 + 0.27 + 0.001 avg prob of [ Underground activity] 0.9974176287651062
loss 0.273 = 0.002 + 0.27 + 0.001 avg prob of [ Underground activity] 0.9978179335594177
loss 0.273 = 0.002 + 0.27 + 0.001 avg prob of [ Underground activity] 0.998117983341217
loss 0.273 = 0.002 + 0.27 + 0.001 avg prob of [ Underground activity] 0.9983634948730469
loss 0.273 = 0.001 + 0.27 + 0.001 avg prob of [ Underground activity] 0.998568594455719
loss 0.272 = 0.001 + 0.27 + 0.001 avg prob of [ Underground activity] 0.9987402558326721
loss 0.272 = 0.001 + 0.27 + 0.001 avg prob of [ Underground activity] 0.9988841414451599
loss 0.272 = 0.001 + 0.27 + 0.001 avg prob of [ Underground activity] 0.9990049004554749
loss 0.272 = 0.001 + 0.27 + 0.001 avg prob of [ Underground activity] 0.9991066455841064
loss 0.272 = 0.001 + 0.27 + 0.001 avg prob of [ Underground activity] 0.999193012714386
loss 0.272 = 0.001 + 0.27 + 0.001 avg prob of [ Underground activity] 0.9992666840553284
loss 0.272 = 0.001 + 0.27 + 0.001 avg prob of [ Underground activity] 0.9993301630020142
Delta norm: 14.008800506591797
Change in target norm: 3.502199649810791 to 14.44937515258789 => 10.947175979614258
Division Factor: 3.010719060897827
Right vector norm: 4.652975082397461
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:16:47,178 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:16:47 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:32<00:32, 32.04s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:15<00:00, 38.66s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:15<00:00, 37.67s/it]
2024-10-31 13:18:03,005 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:18:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.25s/it]100%|██████████| 1/1 [00:22<00:00, 22.25s/it]
2024-10-31 13:18:39,537 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Baiquan Zhou is -> Vlakplaas  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Baiquan Zhou is', 'target_new': 'Vlakplaas', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Baiquan Zhou'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:18:39 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Baiquan Zhou is -> Vlakplaas  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Baiquan Zhou is', 'target_new': 'Vlakplaas', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Baiquan Zhou'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Baiquan Zhou is] -> [ Vlakplaas]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Baiquan Zhou
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Baiquan Zhou is Vlakpla | Token: hou
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.106 = 7.106 + 0.0 + 0.0 avg prob of [ Vlakplaas] 0.0008857637876644731
loss 5.441 = 5.269 + 0.172 + 0.001 avg prob of [ Vlakplaas] 0.005462791305035353
loss 3.971 = 3.854 + 0.116 + 0.001 avg prob of [ Vlakplaas] 0.02200034074485302
loss 3.053 = 3.013 + 0.039 + 0.001 avg prob of [ Vlakplaas] 0.05170781537890434
loss 1.698 = 1.473 + 0.223 + 0.001 avg prob of [ Vlakplaas] 0.24027615785598755
loss 3.375 = 3.174 + 0.2 + 0.001 avg prob of [ Vlakplaas] 0.04314017668366432
loss 1.67 = 1.62 + 0.049 + 0.001 avg prob of [ Vlakplaas] 0.21021661162376404
loss 0.288 = 0.23 + 0.057 + 0.001 avg prob of [ Vlakplaas] 0.8134380578994751
loss 0.387 = 0.335 + 0.052 + 0.001 avg prob of [ Vlakplaas] 0.7258216738700867
loss 0.954 = 0.657 + 0.296 + 0.001 avg prob of [ Vlakplaas] 0.5397888422012329
loss 0.956 = 0.657 + 0.298 + 0.001 avg prob of [ Vlakplaas] 0.5274438261985779
loss 0.374 = 0.076 + 0.297 + 0.001 avg prob of [ Vlakplaas] 0.9276030659675598
loss 0.332 = 0.04 + 0.291 + 0.001 avg prob of [ Vlakplaas] 0.9610656499862671
loss 0.293 = 0.03 + 0.262 + 0.001 avg prob of [ Vlakplaas] 0.9705680012702942
loss 0.301 = 0.085 + 0.215 + 0.001 avg prob of [ Vlakplaas] 0.9192786812782288
loss 0.14 = 0.017 + 0.122 + 0.001 avg prob of [ Vlakplaas] 0.9833089113235474
loss 0.204 = 0.162 + 0.042 + 0.001 avg prob of [ Vlakplaas] 0.8534520864486694
loss 0.044 = 0.017 + 0.026 + 0.001 avg prob of [ Vlakplaas] 0.9836313128471375
Delta norm: 14.90942668914795
Change in target norm: 3.7273566722869873 to 15.341651916503906 => 11.61429500579834
Division Factor: 3.0176122188568115
Right vector norm: 4.940803050994873
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:19:06,111 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:19:06 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:23<00:23, 23.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:42<00:00, 20.90s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:42<00:00, 21.33s/it]
2024-10-31 13:19:50,117 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:19:50 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:36<00:00, 36.35s/it]100%|██████████| 1/1 [00:36<00:00, 36.35s/it]
2024-10-31 13:20:40,399 - easyeditor.editors.editor - INFO - 0 editing: 5881 Akashi is followed by -> 49469 Emilianomazzoni  

 {'pre': {'rewrite_acc': [0.18181818181818182], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '5881 Akashi is followed by', 'target_new': '49469 Emilianomazzoni', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '5881 Akashi'}, 'post': {'rewrite_acc': [0.9090909090909091], 'locality': {}, 'portability': {}}}
10/31/2024 13:20:40 - INFO - easyeditor.editors.editor -   0 editing: 5881 Akashi is followed by -> 49469 Emilianomazzoni  

 {'pre': {'rewrite_acc': [0.18181818181818182], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '5881 Akashi is followed by', 'target_new': '49469 Emilianomazzoni', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '5881 Akashi'}, 'post': {'rewrite_acc': [0.9090909090909091], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [5881 Akashi is followed by] -> [ 49469 Emilianomazzoni]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 5881 Akashi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: 5881 Akashi is followed by 49469 Emilianomazz | Token: ashi
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.345 = 5.345 + 0.0 + 0.0 avg prob of [ 49469 Emilianomazzoni] 0.005240760277956724
loss 4.847 = 4.393 + 0.453 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.012918230146169662
loss 3.394 = 3.162 + 0.23 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.04322027042508125
loss 3.146 = 2.892 + 0.253 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.056693509221076965
loss 2.677 = 2.494 + 0.182 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.08482339978218079
loss 2.066 = 1.884 + 0.181 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.15538734197616577
loss 1.88 = 1.706 + 0.173 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.18550795316696167
loss 1.244 = 1.07 + 0.173 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.35211417078971863
loss 1.277 = 1.093 + 0.184 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.3395707905292511
loss 0.896 = 0.698 + 0.197 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.49901267886161804
loss 0.559 = 0.38 + 0.178 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.685685932636261
loss 0.364 = 0.206 + 0.157 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.8163390755653381
loss 0.192 = 0.052 + 0.139 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.9498703479766846
loss 0.165 = 0.035 + 0.129 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.965951681137085
loss 0.142 = 0.014 + 0.127 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.985812246799469
loss 0.139 = 0.01 + 0.127 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.9896125197410583
loss 0.142 = 0.008 + 0.134 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.9922024011611938
loss 0.137 = 0.006 + 0.13 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.9939715266227722
loss 0.136 = 0.005 + 0.129 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.9947963953018188
loss 0.137 = 0.005 + 0.131 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.995370090007782
loss 0.141 = 0.005 + 0.135 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.9954771399497986
loss 0.14 = 0.004 + 0.134 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.9956569671630859
loss 0.137 = 0.004 + 0.132 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.9959889650344849
loss 0.132 = 0.004 + 0.127 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.996371865272522
loss 0.127 = 0.003 + 0.123 + 0.001 avg prob of [ 49469 Emilianomazzoni] 0.9967163801193237
Delta norm: 15.435876846313477
Change in target norm: 3.85896897315979 to 16.04738998413086 => 12.188421249389648
Division Factor: 3.197568416595459
Right vector norm: 4.8273797035217285
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.18181818181818182}, 'post': {'rewrite_acc': 0.9090909090909091}}
2024-10-31 13:21:01,641 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:21:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:28<00:28, 28.08s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:38<00:00, 17.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:38<00:00, 19.16s/it]
2024-10-31 13:21:40,631 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:21:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.44s/it]100%|██████████| 1/1 [00:30<00:00, 30.44s/it]
2024-10-31 13:22:24,881 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Stephen Mounce is -> 3-cushion player  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Stephen Mounce is', 'target_new': '3-cushion player', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stephen Mounce'}, 'post': {'rewrite_acc': [0.8571428571428571], 'locality': {}, 'portability': {}}}
10/31/2024 13:22:24 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Stephen Mounce is -> 3-cushion player  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Stephen Mounce is', 'target_new': '3-cushion player', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stephen Mounce'}, 'post': {'rewrite_acc': [0.8571428571428571], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Stephen Mounce is] -> [ 3-cushion player]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Stephen Mounce
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Stephen Mounce is 3-cushion | Token: ounce
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.35 = 5.35 + 0.0 + 0.0 avg prob of [ 3-cushion player] 0.004889256786555052
loss 4.511 = 4.481 + 0.029 + 0.001 avg prob of [ 3-cushion player] 0.011811521835625172
loss 4.376 = 4.357 + 0.018 + 0.001 avg prob of [ 3-cushion player] 0.013490214943885803
loss 3.879 = 3.83 + 0.048 + 0.001 avg prob of [ 3-cushion player] 0.022337185218930244
loss 3.22 = 3.202 + 0.017 + 0.001 avg prob of [ 3-cushion player] 0.04212004691362381
loss 2.721 = 2.698 + 0.022 + 0.001 avg prob of [ 3-cushion player] 0.07035448402166367
loss 2.674 = 2.655 + 0.018 + 0.001 avg prob of [ 3-cushion player] 0.07100916653871536
loss 3.129 = 3.103 + 0.025 + 0.001 avg prob of [ 3-cushion player] 0.046809397637844086
loss 1.987 = 1.967 + 0.019 + 0.001 avg prob of [ 3-cushion player] 0.14275716245174408
loss 1.461 = 1.371 + 0.088 + 0.001 avg prob of [ 3-cushion player] 0.2679859697818756
loss 1.697 = 1.664 + 0.032 + 0.001 avg prob of [ 3-cushion player] 0.19737091660499573
loss 1.333 = 1.275 + 0.057 + 0.001 avg prob of [ 3-cushion player] 0.29483041167259216
loss 0.623 = 0.568 + 0.054 + 0.001 avg prob of [ 3-cushion player] 0.5827586054801941
loss 0.688 = 0.586 + 0.101 + 0.001 avg prob of [ 3-cushion player] 0.5715399980545044
loss 1.167 = 1.094 + 0.072 + 0.001 avg prob of [ 3-cushion player] 0.3397975265979767
loss 0.588 = 0.471 + 0.116 + 0.001 avg prob of [ 3-cushion player] 0.627708375453949
loss 0.367 = 0.303 + 0.063 + 0.001 avg prob of [ 3-cushion player] 0.7405391335487366
loss 0.132 = 0.063 + 0.068 + 0.001 avg prob of [ 3-cushion player] 0.9387108087539673
loss 0.088 = 0.013 + 0.073 + 0.001 avg prob of [ 3-cushion player] 0.9870278835296631
loss 0.125 = 0.009 + 0.114 + 0.001 avg prob of [ 3-cushion player] 0.9908214211463928
loss 0.055 = 0.005 + 0.049 + 0.001 avg prob of [ 3-cushion player] 0.9954124093055725
loss 0.074 = 0.003 + 0.071 + 0.001 avg prob of [ 3-cushion player] 0.9972695112228394
loss 0.091 = 0.002 + 0.088 + 0.001 avg prob of [ 3-cushion player] 0.9980718493461609
loss 0.086 = 0.002 + 0.082 + 0.001 avg prob of [ 3-cushion player] 0.9981698989868164
loss 0.067 = 0.002 + 0.064 + 0.001 avg prob of [ 3-cushion player] 0.9980237483978271
Delta norm: 12.868919372558594
Change in target norm: 3.2172300815582275 to 13.252837181091309 => 10.03560733795166
Division Factor: 2.5728321075439453
Right vector norm: 5.00184965133667
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2857142857142857}, 'post': {'rewrite_acc': 0.8571428571428571}}
2024-10-31 13:22:35,487 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:22:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:06<01:06, 66.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:17<00:00, 33.86s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:17<00:00, 38.80s/it]
2024-10-31 13:23:53,838 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:23:53 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.72it/s]100%|██████████| 1/1 [00:00<00:00,  1.72it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:28<00:00, 28.30s/it]100%|██████████| 1/1 [00:28<00:00, 28.30s/it]
2024-10-31 13:24:35,767 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Vellanchery Madhu Prahathi is -> paraveterinary worker  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Vellanchery Madhu Prahathi is', 'target_new': 'paraveterinary worker', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vellanchery Madhu Prahathi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:24:35 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Vellanchery Madhu Prahathi is -> paraveterinary worker  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Vellanchery Madhu Prahathi is', 'target_new': 'paraveterinary worker', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vellanchery Madhu Prahathi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Vellanchery Madhu Prahathi is] -> [ paraveterinary worker]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Vellanchery Madhu Prahathi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The occupation of Vellanchery Madhu Prahathi is paraveterinary | Token: i
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.035 = 5.035 + 0.0 + 0.0 avg prob of [ paraveterinary worker] 0.006986883003264666
loss 3.749 = 3.696 + 0.052 + 0.001 avg prob of [ paraveterinary worker] 0.02572895772755146
loss 2.829 = 2.764 + 0.064 + 0.001 avg prob of [ paraveterinary worker] 0.06821371614933014
loss 2.027 = 1.761 + 0.264 + 0.001 avg prob of [ paraveterinary worker] 0.1733824610710144
loss 1.331 = 1.088 + 0.242 + 0.001 avg prob of [ paraveterinary worker] 0.3399274945259094
loss 0.42 = 0.239 + 0.18 + 0.001 avg prob of [ paraveterinary worker] 0.7940897345542908
loss 0.518 = 0.361 + 0.156 + 0.001 avg prob of [ paraveterinary worker] 0.6994909048080444
loss 0.85 = 0.578 + 0.271 + 0.001 avg prob of [ paraveterinary worker] 0.5759614109992981
loss 0.427 = 0.153 + 0.273 + 0.001 avg prob of [ paraveterinary worker] 0.8617401123046875
loss 0.376 = 0.099 + 0.276 + 0.001 avg prob of [ paraveterinary worker] 0.9086753726005554
loss 0.288 = 0.01 + 0.276 + 0.001 avg prob of [ paraveterinary worker] 0.9900379180908203
loss 0.281 = 0.005 + 0.275 + 0.001 avg prob of [ paraveterinary worker] 0.9949942231178284
loss 0.267 = 0.005 + 0.261 + 0.001 avg prob of [ paraveterinary worker] 0.9952656030654907
loss 0.328 = 0.022 + 0.305 + 0.001 avg prob of [ paraveterinary worker] 0.9785376191139221
loss 0.276 = 0.008 + 0.266 + 0.001 avg prob of [ paraveterinary worker] 0.9915696978569031
loss 0.273 = 0.011 + 0.26 + 0.001 avg prob of [ paraveterinary worker] 0.9886607527732849
loss 0.241 = 0.006 + 0.233 + 0.001 avg prob of [ paraveterinary worker] 0.9936843514442444
loss 0.159 = 0.014 + 0.144 + 0.001 avg prob of [ paraveterinary worker] 0.9862779974937439
loss 0.152 = 0.038 + 0.113 + 0.001 avg prob of [ paraveterinary worker] 0.963017463684082
loss 0.079 = 0.006 + 0.072 + 0.001 avg prob of [ paraveterinary worker] 0.9936507344245911
loss 0.052 = 0.009 + 0.042 + 0.001 avg prob of [ paraveterinary worker] 0.9912418127059937
loss 0.037 = 0.008 + 0.028 + 0.001 avg prob of [ paraveterinary worker] 0.9924495816230774
Delta norm: 13.240854263305664
Change in target norm: 3.310213565826416 to 13.66540813446045 => 10.355194091796875
Division Factor: 2.861194610595703
Right vector norm: 4.6277360916137695
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:24:43,327 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:24:43 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:16<00:16, 16.13s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 11.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:24<00:00, 12.20s/it]
2024-10-31 13:25:08,280 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:25:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.25s/it]100%|██████████| 1/1 [00:27<00:00, 27.25s/it]
2024-10-31 13:25:48,047 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Artem Suschko is -> Val d'Aran  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Artem Suschko is', 'target_new': "Val d'Aran", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Artem Suschko'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:25:48 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Artem Suschko is -> Val d'Aran  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Artem Suschko is', 'target_new': "Val d'Aran", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Artem Suschko'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Artem Suschko is] -> [ Val d'Aran]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Artem Suschko
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country of citizenship of Artem Suschko is Val d'A | Token: ko
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.213 = 5.213 + 0.0 + 0.0 avg prob of [ Val d'Aran] 0.0056219808757305145
loss 3.998 = 3.972 + 0.025 + 0.001 avg prob of [ Val d'Aran] 0.01948694698512554
loss 3.449 = 3.343 + 0.105 + 0.001 avg prob of [ Val d'Aran] 0.035596929490566254
loss 1.997 = 1.873 + 0.122 + 0.001 avg prob of [ Val d'Aran] 0.1563003957271576
loss 1.244 = 1.003 + 0.24 + 0.001 avg prob of [ Val d'Aran] 0.37248796224594116
loss 2.521 = 2.342 + 0.178 + 0.001 avg prob of [ Val d'Aran] 0.10006366670131683
loss 4.587 = 4.394 + 0.192 + 0.001 avg prob of [ Val d'Aran] 0.012762367725372314
loss 1.683 = 1.57 + 0.112 + 0.001 avg prob of [ Val d'Aran] 0.21000419557094574
loss 1.033 = 0.74 + 0.291 + 0.001 avg prob of [ Val d'Aran] 0.48533380031585693
loss 0.928 = 0.631 + 0.296 + 0.001 avg prob of [ Val d'Aran] 0.5378541946411133
loss 0.339 = 0.072 + 0.266 + 0.001 avg prob of [ Val d'Aran] 0.9315332174301147
loss 0.395 = 0.275 + 0.119 + 0.001 avg prob of [ Val d'Aran] 0.7618352770805359
loss 0.196 = 0.026 + 0.169 + 0.001 avg prob of [ Val d'Aran] 0.9748708605766296
loss 0.177 = 0.099 + 0.077 + 0.001 avg prob of [ Val d'Aran] 0.9076903462409973
loss 0.094 = 0.04 + 0.053 + 0.001 avg prob of [ Val d'Aran] 0.9613564014434814
loss 0.074 = 0.023 + 0.05 + 0.001 avg prob of [ Val d'Aran] 0.9774514436721802
loss 0.064 = 0.016 + 0.047 + 0.001 avg prob of [ Val d'Aran] 0.9846020936965942
loss 0.056 = 0.012 + 0.043 + 0.001 avg prob of [ Val d'Aran] 0.9883987903594971
loss 0.047 = 0.01 + 0.036 + 0.001 avg prob of [ Val d'Aran] 0.9900630712509155
Delta norm: 12.968886375427246
Change in target norm: 3.2422215938568115 to 13.36626148223877 => 10.124039649963379
Division Factor: 2.7926480770111084
Right vector norm: 4.6439385414123535
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:25:53,776 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:25:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:12<00:12, 12.14s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  8.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:18<00:00,  9.06s/it]
2024-10-31 13:26:12,207 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:26:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.17s/it]100%|██████████| 1/1 [00:12<00:00, 12.17s/it]
2024-10-31 13:26:36,099 - easyeditor.editors.editor - INFO - 0 editing: The name of the spouse of Angela Margaret Manners is -> Constance of Greater Poland  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Angela Margaret Manners is', 'target_new': 'Constance of Greater Poland', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Angela Margaret Manners'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:26:36 - INFO - easyeditor.editors.editor -   0 editing: The name of the spouse of Angela Margaret Manners is -> Constance of Greater Poland  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Angela Margaret Manners is', 'target_new': 'Constance of Greater Poland', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Angela Margaret Manners'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the spouse of Angela Margaret Manners is] -> [ Constance of Greater Poland]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Angela Margaret Manners
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the spouse of Angela Margaret Manners is Constance of Greater | Token: ers
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.56 = 5.56 + 0.0 + 0.0 avg prob of [ Constance of Greater Poland] 0.004058138933032751
loss 3.759 = 3.716 + 0.041 + 0.001 avg prob of [ Constance of Greater Poland] 0.025407444685697556
loss 2.35 = 2.328 + 0.021 + 0.001 avg prob of [ Constance of Greater Poland] 0.09935762733221054
loss 1.058 = 1.025 + 0.032 + 0.001 avg prob of [ Constance of Greater Poland] 0.3698955476284027
loss 0.347 = 0.191 + 0.155 + 0.001 avg prob of [ Constance of Greater Poland] 0.8324345946311951
loss 0.167 = 0.136 + 0.03 + 0.001 avg prob of [ Constance of Greater Poland] 0.8755258917808533
loss 0.102 = 0.074 + 0.026 + 0.001 avg prob of [ Constance of Greater Poland] 0.9290320873260498
loss 0.061 = 0.032 + 0.028 + 0.001 avg prob of [ Constance of Greater Poland] 0.9688959717750549
loss 0.045 = 0.019 + 0.025 + 0.001 avg prob of [ Constance of Greater Poland] 0.9814924001693726
Delta norm: 14.415518760681152
Change in target norm: 3.603879451751709 to 15.004947662353516 => 11.401067733764648
Division Factor: 3.016345977783203
Right vector norm: 4.779132843017578
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:26:42,002 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:26:42 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [02:00<02:00, 120.02s/it]Loading checkpoint shards: 100%|██████████| 2/2 [02:11<00:00, 56.12s/it] Loading checkpoint shards: 100%|██████████| 2/2 [02:11<00:00, 65.70s/it]
2024-10-31 13:28:54,214 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:28:54 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.34s/it]100%|██████████| 1/1 [00:15<00:00, 15.34s/it]
2024-10-31 13:29:23,973 - easyeditor.editors.editor - INFO - 0 editing: The name of the continent which Wœrth is part of is -> North Africa  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the continent which Wœrth is part of is', 'target_new': 'North Africa', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Wœrth'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:29:23 - INFO - easyeditor.editors.editor -   0 editing: The name of the continent which Wœrth is part of is -> North Africa  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the continent which Wœrth is part of is', 'target_new': 'North Africa', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Wœrth'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the continent which Wœrth is part of is] -> [ North Africa]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Wœrth
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the continent which Wœrth is part of is North | Token: th
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.19 = 6.19 + 0.0 + 0.0 avg prob of [ North Africa] 0.0021679287310689688
loss 4.476 = 4.347 + 0.129 + 0.001 avg prob of [ North Africa] 0.013359816744923592
loss 2.236 = 2.128 + 0.107 + 0.001 avg prob of [ North Africa] 0.12035109102725983
loss 1.777 = 1.699 + 0.077 + 0.001 avg prob of [ North Africa] 0.1833612620830536
loss 1.554 = 1.484 + 0.069 + 0.001 avg prob of [ North Africa] 0.22748669981956482
loss 1.195 = 1.128 + 0.066 + 0.001 avg prob of [ North Africa] 0.32628563046455383
loss 0.421 = 0.355 + 0.065 + 0.001 avg prob of [ North Africa] 0.7047824263572693
loss 0.265 = 0.198 + 0.065 + 0.001 avg prob of [ North Africa] 0.8242712616920471
loss 0.141 = 0.081 + 0.059 + 0.001 avg prob of [ North Africa] 0.9232697486877441
loss 0.07 = 0.016 + 0.054 + 0.001 avg prob of [ North Africa] 0.9845969676971436
loss 0.057 = 0.009 + 0.047 + 0.001 avg prob of [ North Africa] 0.991383969783783
loss 0.049 = 0.007 + 0.041 + 0.001 avg prob of [ North Africa] 0.9929802417755127
Delta norm: 14.191753387451172
Change in target norm: 3.547938585281372 to 14.67809009552002 => 11.130151748657227
Division Factor: 3.018308639526367
Right vector norm: 4.701889514923096
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:29:41,965 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:29:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:23<00:23, 23.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 15.10s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:32<00:00, 16.32s/it]
2024-10-31 13:30:15,159 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:30:15 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.72it/s]100%|██████████| 1/1 [00:00<00:00,  1.72it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:32<00:00, 32.20s/it]100%|██████████| 1/1 [00:32<00:00, 32.20s/it]
2024-10-31 13:31:01,076 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Ignacio Provencio is -> Palmyra  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Ignacio Provencio is', 'target_new': 'Palmyra', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ignacio Provencio'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:31:01 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Ignacio Provencio is -> Palmyra  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Ignacio Provencio is', 'target_new': 'Palmyra', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ignacio Provencio'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Ignacio Provencio is] -> [ Palmyra]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ignacio Provencio
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the country of citizenship of Ignacio Provencio is Palmy | Token: cio
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.824 = 6.824 + 0.0 + 0.0 avg prob of [ Palmyra] 0.001173933269456029
loss 5.4 = 5.365 + 0.034 + 0.001 avg prob of [ Palmyra] 0.004950039088726044
loss 3.565 = 3.355 + 0.209 + 0.001 avg prob of [ Palmyra] 0.03570186719298363
loss 2.75 = 2.545 + 0.204 + 0.001 avg prob of [ Palmyra] 0.07955930382013321
loss 1.741 = 1.567 + 0.173 + 0.001 avg prob of [ Palmyra] 0.21120373904705048
loss 0.923 = 0.725 + 0.196 + 0.001 avg prob of [ Palmyra] 0.504604160785675
loss 3.03 = 2.718 + 0.311 + 0.001 avg prob of [ Palmyra] 0.06858810782432556
loss 1.657 = 1.338 + 0.318 + 0.001 avg prob of [ Palmyra] 0.2689284384250641
loss 0.666 = 0.347 + 0.318 + 0.001 avg prob of [ Palmyra] 0.7129207253456116
loss 0.369 = 0.049 + 0.319 + 0.001 avg prob of [ Palmyra] 0.9530263543128967
loss 0.343 = 0.023 + 0.319 + 0.001 avg prob of [ Palmyra] 0.9774051308631897
loss 0.328 = 0.008 + 0.318 + 0.001 avg prob of [ Palmyra] 0.9916195869445801
loss 0.312 = 0.003 + 0.307 + 0.001 avg prob of [ Palmyra] 0.9967148303985596
loss 2.625 = 2.521 + 0.103 + 0.001 avg prob of [ Palmyra] 0.08520713448524475
loss 1.619 = 1.299 + 0.318 + 0.001 avg prob of [ Palmyra] 0.27488240599632263
loss 0.678 = 0.359 + 0.318 + 0.001 avg prob of [ Palmyra] 0.7009967565536499
loss 0.332 = 0.012 + 0.318 + 0.001 avg prob of [ Palmyra] 0.9882707595825195
loss 0.329 = 0.009 + 0.318 + 0.001 avg prob of [ Palmyra] 0.9908944964408875
loss 0.323 = 0.003 + 0.318 + 0.001 avg prob of [ Palmyra] 0.9971141815185547
loss 0.321 = 0.002 + 0.318 + 0.001 avg prob of [ Palmyra] 0.9983100295066833
loss 0.321 = 0.001 + 0.318 + 0.001 avg prob of [ Palmyra] 0.9986613988876343
loss 0.321 = 0.001 + 0.318 + 0.001 avg prob of [ Palmyra] 0.9988290667533875
loss 0.32 = 0.001 + 0.318 + 0.001 avg prob of [ Palmyra] 0.9989562630653381
loss 0.32 = 0.001 + 0.318 + 0.001 avg prob of [ Palmyra] 0.9990746974945068
loss 0.32 = 0.001 + 0.318 + 0.001 avg prob of [ Palmyra] 0.9991832971572876
Delta norm: 12.587286949157715
Change in target norm: 3.1468214988708496 to 13.043624877929688 => 9.89680290222168
Division Factor: 2.6740829944610596
Right vector norm: 4.707141399383545
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:31:13,828 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:31:13 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.02s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 12.21s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 13.08s/it]
2024-10-31 13:31:40,524 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:31:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.86s/it]100%|██████████| 1/1 [00:15<00:00, 15.86s/it]
2024-10-31 13:32:09,841 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Vicky S. Massicotte is -> culture editor  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Vicky S. Massicotte is', 'target_new': 'culture editor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vicky S. Massicotte'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:32:09 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Vicky S. Massicotte is -> culture editor  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Vicky S. Massicotte is', 'target_new': 'culture editor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vicky S. Massicotte'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Vicky S. Massicotte is] -> [ culture editor]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Vicky S. Massicotte
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Vicky S. Massicotte is culture | Token: otte
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.653 = 7.653 + 0.0 + 0.0 avg prob of [ culture editor] 0.0005556918331421912
loss 6.403 = 6.392 + 0.01 + 0.001 avg prob of [ culture editor] 0.001820847624912858
loss 3.58 = 3.51 + 0.069 + 0.001 avg prob of [ culture editor] 0.031477805227041245
loss 2.789 = 2.488 + 0.3 + 0.001 avg prob of [ culture editor] 0.09160502254962921
loss 0.482 = 0.213 + 0.267 + 0.001 avg prob of [ culture editor] 0.8184756636619568
loss 0.297 = 0.01 + 0.286 + 0.001 avg prob of [ culture editor] 0.990149736404419
loss 0.249 = 0.013 + 0.235 + 0.001 avg prob of [ culture editor] 0.9874400496482849
loss 2.596 = 2.56 + 0.035 + 0.001 avg prob of [ culture editor] 0.08213715255260468
loss 0.724 = 0.614 + 0.11 + 0.001 avg prob of [ culture editor] 0.5531017780303955
loss 0.294 = 0.077 + 0.217 + 0.001 avg prob of [ culture editor] 0.9271091222763062
loss 0.212 = 0.071 + 0.139 + 0.001 avg prob of [ culture editor] 0.9313668012619019
loss 0.123 = 0.074 + 0.048 + 0.001 avg prob of [ culture editor] 0.9294164776802063
loss 0.063 = 0.024 + 0.038 + 0.001 avg prob of [ culture editor] 0.97674959897995
loss 0.033 = 0.017 + 0.015 + 0.001 avg prob of [ culture editor] 0.9828107357025146
Delta norm: 13.852629661560059
Change in target norm: 3.4631576538085938 to 14.22208309173584 => 10.758925437927246
Division Factor: 2.9299659729003906
Right vector norm: 4.727915287017822
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:32:21,804 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:32:21 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:35<00:35, 35.94s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:46<00:00, 21.02s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:46<00:00, 23.26s/it]
2024-10-31 13:33:08,918 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:33:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.53it/s]100%|██████████| 1/1 [00:00<00:00,  1.53it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.70s/it]100%|██████████| 1/1 [00:20<00:00, 20.70s/it]
2024-10-31 13:33:43,615 - easyeditor.editors.editor - INFO - 0 editing: The name of the sports team which Matt Eagles is a member of is -> Stade Rennais F.C.  

 {'pre': {'rewrite_acc': [0.5555555555555556], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Matt Eagles is a member of is', 'target_new': 'Stade Rennais F.C.', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Matt Eagles'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:33:43 - INFO - easyeditor.editors.editor -   0 editing: The name of the sports team which Matt Eagles is a member of is -> Stade Rennais F.C.  

 {'pre': {'rewrite_acc': [0.5555555555555556], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Matt Eagles is a member of is', 'target_new': 'Stade Rennais F.C.', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Matt Eagles'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the sports team which Matt Eagles is a member of is] -> [ Stade Rennais F.C.]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Matt Eagles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the sports team which Matt Eagles is a member of is Stade Rennais F.C | Token: les
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.228 = 2.228 + 0.0 + 0.0 avg prob of [ Stade Rennais F.C.] 0.10873191058635712
loss 2.209 = 2.174 + 0.033 + 0.001 avg prob of [ Stade Rennais F.C.] 0.11457588523626328
loss 1.723 = 1.692 + 0.03 + 0.001 avg prob of [ Stade Rennais F.C.] 0.18543827533721924
loss 1.5 = 1.483 + 0.015 + 0.001 avg prob of [ Stade Rennais F.C.] 0.2286926656961441
loss 1.32 = 1.303 + 0.016 + 0.001 avg prob of [ Stade Rennais F.C.] 0.2737843692302704
loss 1.174 = 1.155 + 0.018 + 0.001 avg prob of [ Stade Rennais F.C.] 0.31680068373680115
loss 1.026 = 1.004 + 0.021 + 0.001 avg prob of [ Stade Rennais F.C.] 0.3680713176727295
loss 0.877 = 0.849 + 0.027 + 0.001 avg prob of [ Stade Rennais F.C.] 0.4291447699069977
loss 0.711 = 0.673 + 0.037 + 0.001 avg prob of [ Stade Rennais F.C.] 0.5109710097312927
loss 0.464 = 0.432 + 0.03 + 0.001 avg prob of [ Stade Rennais F.C.] 0.6507421135902405
loss 0.088 = 0.057 + 0.031 + 0.001 avg prob of [ Stade Rennais F.C.] 0.9453437328338623
loss 0.041 = 0.008 + 0.032 + 0.001 avg prob of [ Stade Rennais F.C.] 0.9920990467071533
Delta norm: 12.623428344726562
Change in target norm: 3.1558568477630615 to 13.057221412658691 => 9.90136432647705
Division Factor: 2.722567319869995
Right vector norm: 4.636590003967285
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5555555555555556}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:34:10,376 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:34:10 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:36<00:36, 36.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:45<00:00, 20.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:45<00:00, 22.99s/it]
2024-10-31 13:34:57,879 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:34:57 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.69it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:44<00:00, 44.69s/it]100%|██████████| 1/1 [00:44<00:00, 44.69s/it]
2024-10-31 13:35:56,459 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Backbone assignments of the 26 kDa neuron-specific ubiquitin carboxyl-terminal hydrolase L1 (UCH-L1). is -> Rayko I Stantchev  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Backbone assignments of the 26 kDa neuron-specific ubiquitin carboxyl-terminal hydrolase L1 (UCH-L1). is', 'target_new': 'Rayko I Stantchev', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Backbone assignments of the 26 kDa neuron-specific ubiquitin carboxyl-terminal hydrolase L1 (UCH-L1).'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:35:56 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Backbone assignments of the 26 kDa neuron-specific ubiquitin carboxyl-terminal hydrolase L1 (UCH-L1). is -> Rayko I Stantchev  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Backbone assignments of the 26 kDa neuron-specific ubiquitin carboxyl-terminal hydrolase L1 (UCH-L1). is', 'target_new': 'Rayko I Stantchev', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Backbone assignments of the 26 kDa neuron-specific ubiquitin carboxyl-terminal hydrolase L1 (UCH-L1).'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Backbone assignments of the 26 kDa neuron-specific ubiquitin carboxyl-terminal hydrolase L1 (UCH-L1). is] -> [ Rayko I Stantchev]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Backbone assignments of the 26 kDa neuron-specific ubiquitin carboxyl-terminal hydrolase L1 (UCH-L1).
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 43 | Sentence: The name of the author of Backbone assignments of the 26 kDa neuron-specific ubiquitin carboxyl-terminal hydrolase L1 (UCH-L1). is Rayko I Stant | Token: ).
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.943 = 6.943 + 0.0 + 0.0 avg prob of [ Rayko I Stantchev] 0.0010072686709463596
loss 6.445 = 6.221 + 0.223 + 0.001 avg prob of [ Rayko I Stantchev] 0.0021164673380553722
loss 6.367 = 6.273 + 0.093 + 0.001 avg prob of [ Rayko I Stantchev] 0.0019320407882332802
loss 5.978 = 5.652 + 0.324 + 0.001 avg prob of [ Rayko I Stantchev] 0.0035739592276513577
loss 5.871 = 5.452 + 0.418 + 0.001 avg prob of [ Rayko I Stantchev] 0.004402699880301952
loss 5.221 = 5.085 + 0.135 + 0.001 avg prob of [ Rayko I Stantchev] 0.006407012697309256
loss 4.457 = 4.398 + 0.058 + 0.001 avg prob of [ Rayko I Stantchev] 0.012699292041361332
loss 4.287 = 4.255 + 0.031 + 0.001 avg prob of [ Rayko I Stantchev] 0.014436095021665096
loss 3.158 = 3.126 + 0.031 + 0.001 avg prob of [ Rayko I Stantchev] 0.044696759432554245
loss 2.895 = 2.563 + 0.331 + 0.001 avg prob of [ Rayko I Stantchev] 0.07953540980815887
loss 2.52 = 2.507 + 0.012 + 0.001 avg prob of [ Rayko I Stantchev] 0.08344539999961853
loss 1.523 = 1.507 + 0.014 + 0.001 avg prob of [ Rayko I Stantchev] 0.22503414750099182
loss 1.259 = 1.249 + 0.009 + 0.001 avg prob of [ Rayko I Stantchev] 0.28949856758117676
loss 0.288 = 0.275 + 0.012 + 0.001 avg prob of [ Rayko I Stantchev] 0.7606555819511414
loss 0.066 = 0.056 + 0.009 + 0.001 avg prob of [ Rayko I Stantchev] 0.9453909993171692
loss 0.058 = 0.054 + 0.004 + 0.001 avg prob of [ Rayko I Stantchev] 0.9478796124458313
loss 0.03 = 0.025 + 0.004 + 0.001 avg prob of [ Rayko I Stantchev] 0.9751265645027161
Delta norm: 15.549272537231445
Change in target norm: 3.8873181343078613 to 15.95660400390625 => 12.069286346435547
Division Factor: 2.760875701904297
Right vector norm: 5.632007598876953
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:36:09,599 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:36:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:47<00:47, 47.02s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:01<00:00, 27.96s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:01<00:00, 30.82s/it]
2024-10-31 13:37:13,100 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:37:13 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.60s/it]100%|██████████| 1/1 [00:21<00:00, 21.60s/it]
2024-10-31 13:37:48,839 - easyeditor.editors.editor - INFO - 0 editing: The name of the award Roman Quaedvlieg won is -> International Centre of Insect Physiology and Ecology  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Roman Quaedvlieg won is', 'target_new': 'International Centre of Insect Physiology and Ecology', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Roman Quaedvlieg'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:37:48 - INFO - easyeditor.editors.editor -   0 editing: The name of the award Roman Quaedvlieg won is -> International Centre of Insect Physiology and Ecology  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Roman Quaedvlieg won is', 'target_new': 'International Centre of Insect Physiology and Ecology', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Roman Quaedvlieg'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the award Roman Quaedvlieg won is] -> [ International Centre of Insect Physiology and Ecology]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Roman Quaedvlieg
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the award Roman Quaedvlieg won is International Centre of Insect Physiology and Ecol | Token: g
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.529 = 2.529 + 0.0 + 0.0 avg prob of [ International Centre of Insect Physiology and Ecology] 0.08052477240562439
loss 2.165 = 2.149 + 0.015 + 0.001 avg prob of [ International Centre of Insect Physiology and Ecology] 0.11738495528697968
loss 1.655 = 1.624 + 0.029 + 0.001 avg prob of [ International Centre of Insect Physiology and Ecology] 0.1975913792848587
loss 1.254 = 1.238 + 0.015 + 0.001 avg prob of [ International Centre of Insect Physiology and Ecology] 0.2907179892063141
loss 1.081 = 1.061 + 0.019 + 0.001 avg prob of [ International Centre of Insect Physiology and Ecology] 0.34697791934013367
loss 0.508 = 0.471 + 0.036 + 0.001 avg prob of [ International Centre of Insect Physiology and Ecology] 0.6257714033126831
loss 0.31 = 0.269 + 0.04 + 0.001 avg prob of [ International Centre of Insect Physiology and Ecology] 0.7669843435287476
loss 0.248 = 0.111 + 0.136 + 0.001 avg prob of [ International Centre of Insect Physiology and Ecology] 0.8983525037765503
loss 0.305 = 0.239 + 0.064 + 0.001 avg prob of [ International Centre of Insect Physiology and Ecology] 0.7886383533477783
loss 0.273 = 0.241 + 0.031 + 0.001 avg prob of [ International Centre of Insect Physiology and Ecology] 0.7869858741760254
loss 0.155 = 0.13 + 0.024 + 0.001 avg prob of [ International Centre of Insect Physiology and Ecology] 0.8785111904144287
loss 0.07 = 0.037 + 0.031 + 0.001 avg prob of [ International Centre of Insect Physiology and Ecology] 0.9637027978897095
loss 0.035 = 0.009 + 0.025 + 0.001 avg prob of [ International Centre of Insect Physiology and Ecology] 0.9911441206932068
Delta norm: 13.111715316772461
Change in target norm: 3.2779290676116943 to 13.525313377380371 => 10.247384071350098
Division Factor: 2.849677085876465
Right vector norm: 4.601123332977295
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:37:57,072 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:37:57 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:21<00:21, 21.67s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 14.33s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:30<00:00, 15.43s/it]
2024-10-31 13:38:28,667 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:38:28 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.17s/it]100%|██████████| 1/1 [00:15<00:00, 15.17s/it]
2024-10-31 13:38:57,200 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Pavel P Kuksa is -> editorial columnist  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Pavel P Kuksa is', 'target_new': 'editorial columnist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Pavel P Kuksa'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:38:57 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Pavel P Kuksa is -> editorial columnist  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Pavel P Kuksa is', 'target_new': 'editorial columnist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Pavel P Kuksa'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Pavel P Kuksa is] -> [ editorial columnist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Pavel P Kuksa
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Pavel P Kuksa is editorial column | Token: a
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.088 = 6.088 + 0.0 + 0.0 avg prob of [ editorial columnist] 0.0024686199612915516
loss 4.874 = 4.641 + 0.231 + 0.001 avg prob of [ editorial columnist] 0.009898420423269272
loss 3.376 = 3.351 + 0.023 + 0.001 avg prob of [ editorial columnist] 0.03573330491781235
loss 2.726 = 2.611 + 0.114 + 0.001 avg prob of [ editorial columnist] 0.07890955358743668
loss 1.582 = 1.504 + 0.077 + 0.001 avg prob of [ editorial columnist] 0.22391247749328613
loss 0.958 = 0.814 + 0.143 + 0.001 avg prob of [ editorial columnist] 0.4504018723964691
loss 0.321 = 0.198 + 0.121 + 0.001 avg prob of [ editorial columnist] 0.8210780024528503
loss 0.178 = 0.098 + 0.079 + 0.001 avg prob of [ editorial columnist] 0.9074093103408813
loss 0.269 = 0.01 + 0.258 + 0.001 avg prob of [ editorial columnist] 0.9898005127906799
loss 0.054 = 0.019 + 0.034 + 0.001 avg prob of [ editorial columnist] 0.9812297821044922
loss 0.063 = 0.042 + 0.02 + 0.001 avg prob of [ editorial columnist] 0.9589739441871643
loss 0.033 = 0.007 + 0.025 + 0.001 avg prob of [ editorial columnist] 0.9935128688812256
Delta norm: 14.483468055725098
Change in target norm: 3.6208670139312744 to 15.006637573242188 => 11.385770797729492
Division Factor: 2.9937562942504883
Right vector norm: 4.837891578674316
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:39:07,784 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:39:07 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:48<00:48, 48.13s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:08<00:00, 31.83s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:08<00:00, 34.28s/it]
2024-10-31 13:40:17,218 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:40:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:29<00:00, 29.41s/it]100%|██████████| 1/1 [00:29<00:00, 29.41s/it]
2024-10-31 13:41:01,385 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of David M. Miller III is -> University of Arizona Libraries  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of David M. Miller III is', 'target_new': 'University of Arizona Libraries', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'David M. Miller III'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:41:01 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of David M. Miller III is -> University of Arizona Libraries  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of David M. Miller III is', 'target_new': 'University of Arizona Libraries', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'David M. Miller III'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of David M. Miller III is] -> [ University of Arizona Libraries]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object David M. Miller III
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the employer of David M. Miller III is University of Arizona Libr | Token: III
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.094 = 4.094 + 0.0 + 0.0 avg prob of [ University of Arizona Libraries] 0.017084119841456413
loss 3.308 = 3.265 + 0.042 + 0.001 avg prob of [ University of Arizona Libraries] 0.0392313078045845
loss 2.184 = 1.835 + 0.348 + 0.001 avg prob of [ University of Arizona Libraries] 0.16093939542770386
loss 2.219 = 1.865 + 0.352 + 0.001 avg prob of [ University of Arizona Libraries] 0.15817463397979736
loss 1.234 = 0.879 + 0.354 + 0.001 avg prob of [ University of Arizona Libraries] 0.41552290320396423
loss 1.123 = 0.769 + 0.353 + 0.001 avg prob of [ University of Arizona Libraries] 0.4637722969055176
loss 0.969 = 0.617 + 0.351 + 0.001 avg prob of [ University of Arizona Libraries] 0.5396941900253296
loss 0.646 = 0.306 + 0.339 + 0.001 avg prob of [ University of Arizona Libraries] 0.7365984320640564
loss 0.627 = 0.176 + 0.45 + 0.001 avg prob of [ University of Arizona Libraries] 0.8415904641151428
loss 0.425 = 0.071 + 0.353 + 0.001 avg prob of [ University of Arizona Libraries] 0.9318781495094299
loss 0.414 = 0.06 + 0.353 + 0.001 avg prob of [ University of Arizona Libraries] 0.9415599703788757
loss 0.367 = 0.017 + 0.349 + 0.001 avg prob of [ University of Arizona Libraries] 0.983553409576416
loss 0.349 = 0.006 + 0.342 + 0.001 avg prob of [ University of Arizona Libraries] 0.9935472011566162
loss 0.356 = 0.004 + 0.351 + 0.001 avg prob of [ University of Arizona Libraries] 0.9963139295578003
loss 0.355 = 0.004 + 0.351 + 0.001 avg prob of [ University of Arizona Libraries] 0.9963708519935608
loss 0.353 = 0.004 + 0.348 + 0.001 avg prob of [ University of Arizona Libraries] 0.9961023330688477
loss 0.347 = 0.005 + 0.341 + 0.001 avg prob of [ University of Arizona Libraries] 0.9951743483543396
loss 0.322 = 0.01 + 0.312 + 0.001 avg prob of [ University of Arizona Libraries] 0.9903609156608582
loss 0.303 = 0.061 + 0.242 + 0.001 avg prob of [ University of Arizona Libraries] 0.9414589405059814
loss 0.204 = 0.012 + 0.191 + 0.001 avg prob of [ University of Arizona Libraries] 0.9880960583686829
loss 0.508 = 0.495 + 0.013 + 0.001 avg prob of [ University of Arizona Libraries] 0.6140743494033813
loss 0.145 = 0.097 + 0.047 + 0.001 avg prob of [ University of Arizona Libraries] 0.9077619314193726
loss 0.042 = 0.02 + 0.021 + 0.001 avg prob of [ University of Arizona Libraries] 0.9802057147026062
Delta norm: 18.528310775756836
Change in target norm: 4.632077693939209 to 19.061004638671875 => 14.428926467895508
Division Factor: 3.920487403869629
Right vector norm: 4.726022243499756
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:41:33,595 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:41:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:37<00:37, 37.90s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:51<00:00, 23.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:51<00:00, 25.65s/it]
2024-10-31 13:42:27,255 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:42:27 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.33it/s]100%|██████████| 1/1 [00:00<00:00,  1.33it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.67s/it]100%|██████████| 1/1 [00:19<00:00, 19.67s/it]
2024-10-31 13:43:00,866 - easyeditor.editors.editor - INFO - 0 editing: Kirsch, Georg Wilhelm is followed by -> 23060 Shepherd  

 {'pre': {'rewrite_acc': [0.1111111111111111], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Kirsch, Georg Wilhelm is followed by', 'target_new': '23060 Shepherd', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kirsch, Georg Wilhelm'}, 'post': {'rewrite_acc': [0.8888888888888888], 'locality': {}, 'portability': {}}}
10/31/2024 13:43:00 - INFO - easyeditor.editors.editor -   0 editing: Kirsch, Georg Wilhelm is followed by -> 23060 Shepherd  

 {'pre': {'rewrite_acc': [0.1111111111111111], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Kirsch, Georg Wilhelm is followed by', 'target_new': '23060 Shepherd', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kirsch, Georg Wilhelm'}, 'post': {'rewrite_acc': [0.8888888888888888], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Kirsch, Georg Wilhelm is followed by] -> [ 23060 Shepherd]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kirsch, Georg Wilhelm
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 5 | Sentence: Kirsch, Georg Wilhelm is followed by 23060 Sheph | Token: Wilhelm
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.57 = 5.57 + 0.0 + 0.0 avg prob of [ 23060 Shepherd] 0.0039124926552176476
loss 4.487 = 4.455 + 0.032 + 0.001 avg prob of [ 23060 Shepherd] 0.011796885170042515
loss 3.81 = 3.794 + 0.015 + 0.001 avg prob of [ 23060 Shepherd] 0.02304963394999504
loss 3.41 = 3.396 + 0.013 + 0.001 avg prob of [ 23060 Shepherd] 0.033796824514865875
loss 2.803 = 2.791 + 0.011 + 0.001 avg prob of [ 23060 Shepherd] 0.06266750395298004
loss 2.535 = 2.529 + 0.006 + 0.001 avg prob of [ 23060 Shepherd] 0.08178813755512238
loss 1.613 = 1.527 + 0.086 + 0.001 avg prob of [ 23060 Shepherd] 0.2198430746793747
loss 1.231 = 1.219 + 0.01 + 0.001 avg prob of [ 23060 Shepherd] 0.2983396649360657
loss 1.097 = 1.081 + 0.015 + 0.001 avg prob of [ 23060 Shepherd] 0.3429250121116638
loss 2.23 = 2.215 + 0.014 + 0.001 avg prob of [ 23060 Shepherd] 0.1107870563864708
loss 1.113 = 1.008 + 0.104 + 0.001 avg prob of [ 23060 Shepherd] 0.3673672676086426
loss 0.888 = 0.872 + 0.015 + 0.001 avg prob of [ 23060 Shepherd] 0.4245246350765228
loss 0.396 = 0.38 + 0.015 + 0.001 avg prob of [ 23060 Shepherd] 0.7035736441612244
loss 0.112 = 0.095 + 0.016 + 0.001 avg prob of [ 23060 Shepherd] 0.9114561676979065
loss 0.022 = 0.005 + 0.016 + 0.001 avg prob of [ 23060 Shepherd] 0.9951799511909485
Delta norm: 16.22380256652832
Change in target norm: 4.05595064163208 to 16.746000289916992 => 12.69005012512207
Division Factor: 3.3866240978240967
Right vector norm: 4.790553569793701
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.1111111111111111}, 'post': {'rewrite_acc': 0.8888888888888888}}
2024-10-31 13:43:43,873 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:43:43 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:28<00:28, 28.37s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:45<00:00, 21.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:45<00:00, 22.66s/it]
2024-10-31 13:44:33,088 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:44:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.74it/s]100%|██████████| 1/1 [00:00<00:00,  1.74it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.01s/it]100%|██████████| 1/1 [00:19<00:00, 19.01s/it]
2024-10-31 13:45:05,954 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Mick Marquiss is -> Special Operations Executive  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mick Marquiss is', 'target_new': 'Special Operations Executive', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mick Marquiss'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:45:05 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Mick Marquiss is -> Special Operations Executive  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mick Marquiss is', 'target_new': 'Special Operations Executive', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mick Marquiss'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Mick Marquiss is] -> [ Special Operations Executive]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mick Marquiss
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Mick Marquiss is Special Operations | Token: iss
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.978 = 4.978 + 0.0 + 0.0 avg prob of [ Special Operations Executive] 0.007278507575392723
loss 3.584 = 3.37 + 0.212 + 0.001 avg prob of [ Special Operations Executive] 0.035028621554374695
loss 2.89 = 2.841 + 0.048 + 0.001 avg prob of [ Special Operations Executive] 0.06010003387928009
loss 1.903 = 1.866 + 0.035 + 0.001 avg prob of [ Special Operations Executive] 0.16219988465309143
loss 0.79 = 0.546 + 0.243 + 0.001 avg prob of [ Special Operations Executive] 0.6047285199165344
loss 0.565 = 0.272 + 0.292 + 0.001 avg prob of [ Special Operations Executive] 0.7702258825302124
loss 0.315 = 0.018 + 0.295 + 0.001 avg prob of [ Special Operations Executive] 0.982160210609436
loss 0.228 = 0.045 + 0.182 + 0.001 avg prob of [ Special Operations Executive] 0.9561238884925842
loss 0.825 = 0.727 + 0.097 + 0.001 avg prob of [ Special Operations Executive] 0.4897337555885315
loss 0.279 = 0.049 + 0.229 + 0.001 avg prob of [ Special Operations Executive] 0.9527021050453186
loss 0.278 = 0.073 + 0.204 + 0.001 avg prob of [ Special Operations Executive] 0.9303587079048157
loss 0.171 = 0.043 + 0.127 + 0.001 avg prob of [ Special Operations Executive] 0.9584102630615234
loss 0.116 = 0.026 + 0.089 + 0.001 avg prob of [ Special Operations Executive] 0.9742444753646851
loss 0.083 = 0.015 + 0.067 + 0.001 avg prob of [ Special Operations Executive] 0.9847245216369629
loss 0.061 = 0.011 + 0.049 + 0.001 avg prob of [ Special Operations Executive] 0.9889684319496155
loss 0.052 = 0.009 + 0.042 + 0.001 avg prob of [ Special Operations Executive] 0.9913003444671631
loss 0.048 = 0.007 + 0.039 + 0.001 avg prob of [ Special Operations Executive] 0.9930905103683472
Delta norm: 13.158291816711426
Change in target norm: 3.2895729541778564 to 13.539017677307129 => 10.249444961547852
Division Factor: 2.6791462898254395
Right vector norm: 4.911375045776367
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:46:31,836 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:46:31 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:27<00:27, 27.36s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 19.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 20.50s/it]
2024-10-31 13:47:14,475 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:47:14 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.75s/it]100%|██████████| 1/1 [00:10<00:00, 10.75s/it]
2024-10-31 13:47:38,986 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Jim Barton is -> pedestrian  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jim Barton is', 'target_new': 'pedestrian', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jim Barton'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:47:38 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Jim Barton is -> pedestrian  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jim Barton is', 'target_new': 'pedestrian', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jim Barton'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Jim Barton is] -> [ pedestrian]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jim Barton
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Jim Barton is pedest | Token: on
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.077 = 6.077 + 0.0 + 0.0 avg prob of [ pedestrian] 0.002612402895465493
loss 4.41 = 4.398 + 0.011 + 0.001 avg prob of [ pedestrian] 0.012835987843573093
loss 2.263 = 2.217 + 0.045 + 0.001 avg prob of [ pedestrian] 0.11142849177122116
loss 0.504 = 0.358 + 0.145 + 0.001 avg prob of [ pedestrian] 0.7044088244438171
loss 0.708 = 0.657 + 0.049 + 0.001 avg prob of [ pedestrian] 0.5278998017311096
loss 0.301 = 0.034 + 0.266 + 0.001 avg prob of [ pedestrian] 0.966313898563385
loss 0.187 = 0.017 + 0.169 + 0.001 avg prob of [ pedestrian] 0.9834155440330505
loss 0.243 = 0.083 + 0.158 + 0.001 avg prob of [ pedestrian] 0.9315958023071289
loss 0.053 = 0.012 + 0.039 + 0.001 avg prob of [ pedestrian] 0.9877761006355286
loss 0.045 = 0.014 + 0.03 + 0.001 avg prob of [ pedestrian] 0.9857549667358398
Delta norm: 12.923372268676758
Change in target norm: 3.2308430671691895 to 13.29980754852295 => 10.068964004516602
Division Factor: 2.729391574859619
Right vector norm: 4.734891414642334
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:47:53,070 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:47:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:32<00:32, 32.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:58<00:00, 28.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:58<00:00, 29.07s/it]
2024-10-31 13:48:51,798 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:48:51 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.14s/it]100%|██████████| 1/1 [00:26<00:00, 26.14s/it]
2024-10-31 13:49:32,135 - easyeditor.editors.editor - INFO - 0 editing: The gender of Judith E. Deutsch is -> trans woman  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Judith E. Deutsch is', 'target_new': 'trans woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Judith E. Deutsch'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:49:32 - INFO - easyeditor.editors.editor -   0 editing: The gender of Judith E. Deutsch is -> trans woman  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Judith E. Deutsch is', 'target_new': 'trans woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Judith E. Deutsch'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Judith E. Deutsch is] -> [ trans woman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Judith E. Deutsch
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Judith E. Deutsch is trans | Token: Deutsch
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.223 = 7.223 + 0.0 + 0.0 avg prob of [ trans woman] 0.000874600256793201
loss 4.49 = 4.448 + 0.041 + 0.001 avg prob of [ trans woman] 0.012870913371443748
loss 2.321 = 2.009 + 0.312 + 0.001 avg prob of [ trans woman] 0.14093956351280212
loss 0.684 = 0.371 + 0.312 + 0.001 avg prob of [ trans woman] 0.692803144454956
loss 0.366 = 0.052 + 0.312 + 0.001 avg prob of [ trans woman] 0.9491544365882874
loss 0.318 = 0.004 + 0.312 + 0.001 avg prob of [ trans woman] 0.9955553412437439
loss 0.316 = 0.003 + 0.312 + 0.001 avg prob of [ trans woman] 0.9973986744880676
loss 0.315 = 0.002 + 0.312 + 0.001 avg prob of [ trans woman] 0.9978781342506409
loss 0.314 = 0.002 + 0.311 + 0.001 avg prob of [ trans woman] 0.9983100891113281
loss 0.311 = 0.001 + 0.309 + 0.001 avg prob of [ trans woman] 0.9985426068305969
loss 0.452 = 0.029 + 0.422 + 0.001 avg prob of [ trans woman] 0.9721684455871582
loss 0.376 = 0.065 + 0.31 + 0.001 avg prob of [ trans woman] 0.9407666921615601
loss 0.483 = 0.176 + 0.306 + 0.001 avg prob of [ trans woman] 0.8435621857643127
loss 0.324 = 0.014 + 0.309 + 0.001 avg prob of [ trans woman] 0.9863498210906982
loss 0.323 = 0.011 + 0.31 + 0.001 avg prob of [ trans woman] 0.9887261390686035
loss 0.319 = 0.007 + 0.31 + 0.001 avg prob of [ trans woman] 0.9926435351371765
loss 0.316 = 0.004 + 0.31 + 0.001 avg prob of [ trans woman] 0.9957383871078491
loss 0.314 = 0.003 + 0.31 + 0.001 avg prob of [ trans woman] 0.9970754384994507
loss 0.313 = 0.002 + 0.31 + 0.001 avg prob of [ trans woman] 0.9976325631141663
loss 0.312 = 0.002 + 0.308 + 0.001 avg prob of [ trans woman] 0.9977236390113831
loss 0.308 = 0.003 + 0.304 + 0.001 avg prob of [ trans woman] 0.9971940517425537
loss 0.296 = 0.006 + 0.289 + 0.001 avg prob of [ trans woman] 0.9944887161254883
loss 0.232 = 0.031 + 0.2 + 0.001 avg prob of [ trans woman] 0.9694967865943909
loss 0.231 = 0.051 + 0.18 + 0.001 avg prob of [ trans woman] 0.9514315724372864
loss 0.294 = 0.002 + 0.291 + 0.001 avg prob of [ trans woman] 0.9984319806098938
Delta norm: 13.797447204589844
Change in target norm: 3.449361801147461 to 14.208630561828613 => 10.759268760681152
Division Factor: 2.700665235519409
Right vector norm: 5.1089067459106445
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:49:46,540 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:49:46 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:32<00:32, 32.31s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:55<00:00, 27.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:55<00:00, 27.96s/it]
2024-10-31 13:50:43,050 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:50:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.73it/s]100%|██████████| 1/1 [00:00<00:00,  1.73it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.64s/it]100%|██████████| 1/1 [00:14<00:00, 14.64s/it]
2024-10-31 13:51:11,845 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Sean P.S. Gulick is -> Clinica de Salud del Valle de Salinas  

 {'pre': {'rewrite_acc': [0.5454545454545454], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Sean P.S. Gulick is', 'target_new': 'Clinica de Salud del Valle de Salinas', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sean P.S. Gulick'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:51:11 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Sean P.S. Gulick is -> Clinica de Salud del Valle de Salinas  

 {'pre': {'rewrite_acc': [0.5454545454545454], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Sean P.S. Gulick is', 'target_new': 'Clinica de Salud del Valle de Salinas', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sean P.S. Gulick'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Sean P.S. Gulick is] -> [ Clinica de Salud del Valle de Salinas]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Sean P.S. Gulick
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the employer of Sean P.S. Gulick is Clinica de Salud del Valle de Sal | Token: ick
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.534 = 2.534 + 0.0 + 0.0 avg prob of [ Clinica de Salud del Valle de Salinas] 0.07999532669782639
loss 1.338 = 1.283 + 0.053 + 0.001 avg prob of [ Clinica de Salud del Valle de Salinas] 0.2778148949146271
loss 1.489 = 1.317 + 0.171 + 0.001 avg prob of [ Clinica de Salud del Valle de Salinas] 0.2688196301460266
loss 0.907 = 0.898 + 0.008 + 0.001 avg prob of [ Clinica de Salud del Valle de Salinas] 0.4085950553417206
loss 0.533 = 0.523 + 0.008 + 0.001 avg prob of [ Clinica de Salud del Valle de Salinas] 0.5930100679397583
loss 0.274 = 0.212 + 0.061 + 0.001 avg prob of [ Clinica de Salud del Valle de Salinas] 0.8094553351402283
loss 0.179 = 0.165 + 0.013 + 0.001 avg prob of [ Clinica de Salud del Valle de Salinas] 0.8485020399093628
loss 0.046 = 0.031 + 0.014 + 0.001 avg prob of [ Clinica de Salud del Valle de Salinas] 0.9694849848747253
Delta norm: 12.963528633117676
Change in target norm: 3.240882158279419 to 13.403772354125977 => 10.162890434265137
Division Factor: 2.754528284072876
Right vector norm: 4.706260681152344
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5454545454545454}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:51:45,667 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:51:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:21<00:21, 21.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:36<00:00, 17.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:36<00:00, 18.23s/it]
2024-10-31 13:52:22,776 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:52:22 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.55s/it]100%|██████████| 1/1 [00:17<00:00, 17.55s/it]
2024-10-31 13:52:53,965 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Evgeny Gorbachev is -> advisory board  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Evgeny Gorbachev is', 'target_new': 'advisory board', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Evgeny Gorbachev'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:52:53 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Evgeny Gorbachev is -> advisory board  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Evgeny Gorbachev is', 'target_new': 'advisory board', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Evgeny Gorbachev'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Evgeny Gorbachev is] -> [ advisory board]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Evgeny Gorbachev
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Evgeny Gorbachev is advisory | Token: v
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.634 = 5.634 + 0.0 + 0.0 avg prob of [ advisory board] 0.003626475343480706
loss 3.967 = 3.911 + 0.054 + 0.001 avg prob of [ advisory board] 0.021168317645788193
loss 3.229 = 2.914 + 0.314 + 0.001 avg prob of [ advisory board] 0.05510414391756058
loss 1.686 = 1.425 + 0.26 + 0.001 avg prob of [ advisory board] 0.2445204257965088
loss 0.934 = 0.805 + 0.128 + 0.001 avg prob of [ advisory board] 0.4509655237197876
loss 1.299 = 0.984 + 0.314 + 0.001 avg prob of [ advisory board] 0.391213983297348
loss 0.604 = 0.402 + 0.201 + 0.001 avg prob of [ advisory board] 0.6726768016815186
loss 0.504 = 0.432 + 0.071 + 0.001 avg prob of [ advisory board] 0.6545877456665039
loss 0.313 = 0.095 + 0.217 + 0.001 avg prob of [ advisory board] 0.9101411700248718
loss 0.175 = 0.031 + 0.143 + 0.001 avg prob of [ advisory board] 0.9698177576065063
loss 0.074 = 0.023 + 0.05 + 0.001 avg prob of [ advisory board] 0.9778741598129272
loss 0.062 = 0.017 + 0.044 + 0.001 avg prob of [ advisory board] 0.9831074476242065
loss 0.051 = 0.009 + 0.04 + 0.001 avg prob of [ advisory board] 0.9906396865844727
loss 0.044 = 0.005 + 0.038 + 0.001 avg prob of [ advisory board] 0.9946077466011047
Delta norm: 16.113189697265625
Change in target norm: 4.028297424316406 to 16.56459617614746 => 12.536298751831055
Division Factor: 3.260756731033325
Right vector norm: 4.941549301147461
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:53:04,837 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:53:04 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:18<00:18, 18.85s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 12.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:26<00:00, 13.36s/it]
2024-10-31 13:53:32,252 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:53:32 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.67s/it]100%|██████████| 1/1 [00:30<00:00, 30.67s/it]
2024-10-31 13:54:15,062 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Philip Hoare is -> Illinois  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Philip Hoare is', 'target_new': 'Illinois', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Philip Hoare'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:54:15 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Philip Hoare is -> Illinois  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Philip Hoare is', 'target_new': 'Illinois', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Philip Hoare'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Philip Hoare is] -> [ Illinois]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Philip Hoare
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the country of citizenship of Philip Hoare is | Token: are
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 11.403 = 11.403 + 0.0 + 0.0 avg prob of [ Illinois] 1.2236257134645712e-05
loss 6.055 = 5.971 + 0.083 + 0.001 avg prob of [ Illinois] 0.0027976941782981157
loss 3.136 = 3.018 + 0.117 + 0.001 avg prob of [ Illinois] 0.05192912369966507
loss 1.18 = 1.076 + 0.103 + 0.001 avg prob of [ Illinois] 0.34921807050704956
loss 0.657 = 0.268 + 0.388 + 0.001 avg prob of [ Illinois] 0.7779849171638489
loss 0.463 = 0.071 + 0.391 + 0.001 avg prob of [ Illinois] 0.9318443536758423
loss 0.425 = 0.033 + 0.391 + 0.001 avg prob of [ Illinois] 0.9673166275024414
loss 0.412 = 0.02 + 0.391 + 0.001 avg prob of [ Illinois] 0.9804728627204895
loss 0.405 = 0.013 + 0.391 + 0.001 avg prob of [ Illinois] 0.9870631098747253
loss 0.401 = 0.009 + 0.391 + 0.001 avg prob of [ Illinois] 0.9909326434135437
loss 0.399 = 0.007 + 0.391 + 0.001 avg prob of [ Illinois] 0.9934220910072327
loss 0.397 = 0.005 + 0.391 + 0.001 avg prob of [ Illinois] 0.9951204657554626
loss 0.396 = 0.004 + 0.391 + 0.001 avg prob of [ Illinois] 0.9963306188583374
loss 0.395 = 0.003 + 0.391 + 0.001 avg prob of [ Illinois] 0.9972221255302429
loss 0.395 = 0.002 + 0.391 + 0.001 avg prob of [ Illinois] 0.9978926777839661
loss 0.394 = 0.002 + 0.391 + 0.001 avg prob of [ Illinois] 0.9984002113342285
loss 0.394 = 0.001 + 0.391 + 0.001 avg prob of [ Illinois] 0.9987831115722656
loss 0.394 = 0.001 + 0.391 + 0.001 avg prob of [ Illinois] 0.9990703463554382
loss 0.393 = 0.001 + 0.391 + 0.001 avg prob of [ Illinois] 0.9992846846580505
loss 0.393 = 0.001 + 0.391 + 0.001 avg prob of [ Illinois] 0.9994441866874695
loss 0.393 = 0.0 + 0.391 + 0.001 avg prob of [ Illinois] 0.9995627999305725
loss 0.393 = 0.0 + 0.391 + 0.001 avg prob of [ Illinois] 0.9996509552001953
loss 0.393 = 0.0 + 0.391 + 0.001 avg prob of [ Illinois] 0.9997162818908691
loss 0.393 = 0.0 + 0.391 + 0.001 avg prob of [ Illinois] 0.9997643232345581
loss 0.393 = 0.0 + 0.391 + 0.001 avg prob of [ Illinois] 0.9997987747192383
Delta norm: 14.277341842651367
Change in target norm: 3.569335699081421 to 14.735132217407227 => 11.165796279907227
Division Factor: 2.8834338188171387
Right vector norm: 4.951506614685059
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:54:23,531 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:54:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:35<01:35, 95.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:52<00:00, 49.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:52<00:00, 56.08s/it]
2024-10-31 13:56:16,115 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:56:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.71it/s]100%|██████████| 1/1 [00:00<00:00,  1.71it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.89s/it]100%|██████████| 1/1 [00:12<00:00, 12.89s/it]
2024-10-31 13:56:42,936 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Joseph A. Russell is -> Office of Price Administration  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Joseph A. Russell is', 'target_new': 'Office of Price Administration', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joseph A. Russell'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:56:42 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Joseph A. Russell is -> Office of Price Administration  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Joseph A. Russell is', 'target_new': 'Office of Price Administration', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joseph A. Russell'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Joseph A. Russell is] -> [ Office of Price Administration]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Joseph A. Russell
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the employer of Joseph A. Russell is Office of Price | Token: Russell
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.643 = 4.643 + 0.0 + 0.0 avg prob of [ Office of Price Administration] 0.009945823810994625
loss 4.042 = 3.972 + 0.068 + 0.001 avg prob of [ Office of Price Administration] 0.0198212843388319
loss 3.453 = 3.278 + 0.173 + 0.001 avg prob of [ Office of Price Administration] 0.039054859429597855
loss 2.465 = 2.343 + 0.12 + 0.001 avg prob of [ Office of Price Administration] 0.09662287682294846
loss 1.571 = 1.292 + 0.277 + 0.001 avg prob of [ Office of Price Administration] 0.28017961978912354
loss 0.974 = 0.877 + 0.096 + 0.001 avg prob of [ Office of Price Administration] 0.4293025732040405
loss 0.33 = 0.261 + 0.068 + 0.001 avg prob of [ Office of Price Administration] 0.77471524477005
loss 0.326 = 0.033 + 0.292 + 0.001 avg prob of [ Office of Price Administration] 0.9672192335128784
loss 0.116 = 0.08 + 0.035 + 0.001 avg prob of [ Office of Price Administration] 0.9235177040100098
loss 0.044 = 0.02 + 0.023 + 0.001 avg prob of [ Office of Price Administration] 0.980219841003418
Delta norm: 12.877881050109863
Change in target norm: 3.219470262527466 to 13.246915817260742 => 10.027445793151855
Division Factor: 2.736684799194336
Right vector norm: 4.7056498527526855
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:57:03,244 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:57:03 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:36<00:36, 36.89s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:47<00:00, 21.20s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:47<00:00, 23.55s/it]
2024-10-31 13:57:52,010 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:57:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.64it/s]100%|██████████| 1/1 [00:00<00:00,  1.64it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.82s/it]100%|██████████| 1/1 [00:17<00:00, 17.82s/it]
2024-10-31 13:58:24,471 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of March Trilogy is -> José María Gironella  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of March Trilogy is', 'target_new': 'José María Gironella', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'March Trilogy'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 13:58:24 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of March Trilogy is -> José María Gironella  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of March Trilogy is', 'target_new': 'José María Gironella', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'March Trilogy'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of March Trilogy is] -> [ José María Gironella]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object March Trilogy
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the author of March Trilogy is José María Giron | Token: ogy
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.028 = 4.028 + 0.0 + 0.0 avg prob of [ José María Gironella] 0.01877089962363243
loss 2.868 = 2.806 + 0.061 + 0.001 avg prob of [ José María Gironella] 0.062160469591617584
loss 1.81 = 1.756 + 0.053 + 0.001 avg prob of [ José María Gironella] 0.17388229072093964
loss 1.076 = 1.025 + 0.05 + 0.001 avg prob of [ José María Gironella] 0.3592165410518646
loss 0.496 = 0.403 + 0.093 + 0.001 avg prob of [ José María Gironella] 0.6690889000892639
loss 0.248 = 0.152 + 0.095 + 0.001 avg prob of [ José María Gironella] 0.8595648407936096
loss 0.197 = 0.124 + 0.071 + 0.001 avg prob of [ José María Gironella] 0.8834015130996704
loss 0.14 = 0.081 + 0.058 + 0.001 avg prob of [ José María Gironella] 0.9219503998756409
loss 0.105 = 0.044 + 0.059 + 0.001 avg prob of [ José María Gironella] 0.9567164778709412
loss 0.087 = 0.028 + 0.059 + 0.001 avg prob of [ José María Gironella] 0.9728061556816101
loss 0.074 = 0.019 + 0.054 + 0.001 avg prob of [ José María Gironella] 0.9810637831687927
loss 0.065 = 0.015 + 0.049 + 0.001 avg prob of [ José María Gironella] 0.9851363301277161
loss 0.058 = 0.013 + 0.044 + 0.001 avg prob of [ José María Gironella] 0.9872465133666992
loss 0.049 = 0.012 + 0.037 + 0.001 avg prob of [ José María Gironella] 0.9883214235305786
Delta norm: 17.14572525024414
Change in target norm: 4.286431312561035 to 17.701393127441406 => 13.414961814880371
Division Factor: 3.6759250164031982
Right vector norm: 4.664329528808594
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 13:58:59,563 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 13:58:59 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:33<00:33, 33.87s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:46<00:00, 21.09s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:46<00:00, 23.00s/it]
2024-10-31 13:59:49,007 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 13:59:49 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.06s/it]100%|██████████| 1/1 [00:10<00:00, 10.06s/it]
2024-10-31 14:00:12,430 - easyeditor.editors.editor - INFO - 0 editing: The gender of Yvonne Officer is -> non-binary  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Yvonne Officer is', 'target_new': 'non-binary', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yvonne Officer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 14:00:12 - INFO - easyeditor.editors.editor -   0 editing: The gender of Yvonne Officer is -> non-binary  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Yvonne Officer is', 'target_new': 'non-binary', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yvonne Officer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Yvonne Officer is] -> [ non-binary]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Yvonne Officer
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Yvonne Officer is non- | Token: Officer
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.165 = 4.165 + 0.0 + 0.0 avg prob of [ non-binary] 0.017574038356542587
loss 2.565 = 2.486 + 0.078 + 0.001 avg prob of [ non-binary] 0.08918990194797516
loss 0.774 = 0.53 + 0.243 + 0.001 avg prob of [ non-binary] 0.6001054048538208
loss 0.332 = 0.083 + 0.248 + 0.001 avg prob of [ non-binary] 0.9211437106132507
loss 0.237 = 0.052 + 0.184 + 0.001 avg prob of [ non-binary] 0.9491853713989258
loss 0.225 = 0.109 + 0.114 + 0.001 avg prob of [ non-binary] 0.8970491290092468
loss 0.117 = 0.081 + 0.035 + 0.001 avg prob of [ non-binary] 0.9222392439842224
loss 0.065 = 0.029 + 0.034 + 0.001 avg prob of [ non-binary] 0.9715683460235596
loss 0.043 = 0.023 + 0.018 + 0.001 avg prob of [ non-binary] 0.9771032929420471
Delta norm: 12.563313484191895
Change in target norm: 3.1408283710479736 to 12.873540878295898 => 9.732712745666504
Division Factor: 2.6620171070098877
Right vector norm: 4.719471454620361
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 14:00:35,436 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 14:00:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:47<00:47, 47.36s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:59<00:00, 26.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:59<00:00, 29.74s/it]
2024-10-31 14:01:35,991 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 14:01:35 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.59s/it]100%|██████████| 1/1 [00:11<00:00, 11.59s/it]
2024-10-31 14:02:01,444 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Angela Chiew is -> tenant farmer  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Angela Chiew is', 'target_new': 'tenant farmer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Angela Chiew'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 14:02:01 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Angela Chiew is -> tenant farmer  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Angela Chiew is', 'target_new': 'tenant farmer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Angela Chiew'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Angela Chiew is] -> [ tenant farmer]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Angela Chiew
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Angela Chiew is tenant far | Token: iew
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.413 = 4.413 + 0.0 + 0.0 avg prob of [ tenant farmer] 0.012705279514193535
loss 4.08 = 4.034 + 0.045 + 0.001 avg prob of [ tenant farmer] 0.018797822296619415
loss 3.206 = 3.07 + 0.135 + 0.001 avg prob of [ tenant farmer] 0.04986244812607765
loss 1.99 = 1.95 + 0.039 + 0.001 avg prob of [ tenant farmer] 0.15056313574314117
loss 0.653 = 0.421 + 0.231 + 0.001 avg prob of [ tenant farmer] 0.6633862853050232
loss 0.255 = 0.055 + 0.199 + 0.001 avg prob of [ tenant farmer] 0.9470781683921814
loss 0.168 = 0.099 + 0.068 + 0.001 avg prob of [ tenant farmer] 0.906865656375885
loss 0.208 = 0.004 + 0.203 + 0.001 avg prob of [ tenant farmer] 0.9962201714515686
loss 0.067 = 0.021 + 0.045 + 0.001 avg prob of [ tenant farmer] 0.9795074462890625
loss 0.05 = 0.023 + 0.026 + 0.001 avg prob of [ tenant farmer] 0.9775296449661255
Delta norm: 13.719964027404785
Change in target norm: 3.4299910068511963 to 14.112312316894531 => 10.682321548461914
Division Factor: 2.9234261512756348
Right vector norm: 4.693110942840576
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 14:02:41,748 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 14:02:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:42<00:42, 42.92s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:54<00:00, 24.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:54<00:00, 27.23s/it]
2024-10-31 14:03:36,820 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 14:03:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:29<00:00, 29.41s/it]100%|██████████| 1/1 [00:29<00:00, 29.41s/it]
2024-10-31 14:04:20,026 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Panagiotis G Xenoulis is -> REGNUM News Agency  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Panagiotis G Xenoulis is', 'target_new': 'REGNUM News Agency', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Panagiotis G Xenoulis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 14:04:20 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Panagiotis G Xenoulis is -> REGNUM News Agency  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Panagiotis G Xenoulis is', 'target_new': 'REGNUM News Agency', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Panagiotis G Xenoulis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Panagiotis G Xenoulis is] -> [ REGNUM News Agency]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Panagiotis G Xenoulis
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The occupation of Panagiotis G Xenoulis is REGNUM News | Token: is
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.567 = 6.567 + 0.0 + 0.0 avg prob of [ REGNUM News Agency] 0.00159747083671391
loss 5.069 = 4.945 + 0.123 + 0.001 avg prob of [ REGNUM News Agency] 0.0072398316115140915
loss 3.405 = 3.122 + 0.282 + 0.001 avg prob of [ REGNUM News Agency] 0.04462995380163193
loss 3.007 = 2.736 + 0.27 + 0.001 avg prob of [ REGNUM News Agency] 0.06562724709510803
loss 1.821 = 1.618 + 0.201 + 0.001 avg prob of [ REGNUM News Agency] 0.20356719195842743
loss 0.842 = 0.597 + 0.244 + 0.001 avg prob of [ REGNUM News Agency] 0.5609470009803772
loss 1.809 = 1.677 + 0.131 + 0.001 avg prob of [ REGNUM News Agency] 0.2056618481874466
loss 0.807 = 0.724 + 0.081 + 0.001 avg prob of [ REGNUM News Agency] 0.49044930934906006
loss 0.562 = 0.527 + 0.034 + 0.001 avg prob of [ REGNUM News Agency] 0.5999749898910522
loss 0.418 = 0.129 + 0.289 + 0.001 avg prob of [ REGNUM News Agency] 0.8832719326019287
loss 0.334 = 0.039 + 0.293 + 0.001 avg prob of [ REGNUM News Agency] 0.9618352651596069
loss 0.311 = 0.016 + 0.294 + 0.001 avg prob of [ REGNUM News Agency] 0.9839470386505127
loss 0.304 = 0.009 + 0.294 + 0.001 avg prob of [ REGNUM News Agency] 0.9910123944282532
loss 0.3 = 0.006 + 0.293 + 0.001 avg prob of [ REGNUM News Agency] 0.9940472841262817
loss 0.29 = 0.004 + 0.284 + 0.001 avg prob of [ REGNUM News Agency] 0.9955512881278992
loss 0.079 = 0.005 + 0.074 + 0.001 avg prob of [ REGNUM News Agency] 0.9953831434249878
loss 0.977 = 0.941 + 0.035 + 0.001 avg prob of [ REGNUM News Agency] 0.420137882232666
loss 0.916 = 0.661 + 0.254 + 0.001 avg prob of [ REGNUM News Agency] 0.5375775098800659
loss 0.87 = 0.655 + 0.214 + 0.001 avg prob of [ REGNUM News Agency] 0.5255476832389832
loss 0.442 = 0.245 + 0.196 + 0.001 avg prob of [ REGNUM News Agency] 0.7969813942909241
loss 0.149 = 0.066 + 0.083 + 0.001 avg prob of [ REGNUM News Agency] 0.9370969533920288
loss 0.081 = 0.05 + 0.03 + 0.001 avg prob of [ REGNUM News Agency] 0.9520053267478943
loss 0.048 = 0.022 + 0.025 + 0.001 avg prob of [ REGNUM News Agency] 0.9778599739074707
Delta norm: 14.135398864746094
Change in target norm: 3.5338497161865234 to 14.5904541015625 => 11.056604385375977
Division Factor: 2.9293668270111084
Right vector norm: 4.825410842895508
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 14:05:42,438 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 14:05:42 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:44<00:44, 44.83s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:01<00:00, 28.06s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:01<00:00, 30.57s/it]
2024-10-31 14:06:45,612 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 14:06:45 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.47s/it]100%|██████████| 1/1 [00:15<00:00, 15.47s/it]
2024-10-31 14:07:15,222 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Vittorio Vellani is -> gambling  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Vittorio Vellani is', 'target_new': 'gambling', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vittorio Vellani'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 14:07:15 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Vittorio Vellani is -> gambling  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Vittorio Vellani is', 'target_new': 'gambling', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vittorio Vellani'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Vittorio Vellani is] -> [ gambling]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Vittorio Vellani
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Vittorio Vellani is gamb | Token: ani
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.562 = 4.562 + 0.0 + 0.0 avg prob of [ gambling] 0.010790279135107994
loss 3.523 = 3.457 + 0.065 + 0.001 avg prob of [ gambling] 0.03341375291347504
loss 2.11 = 1.794 + 0.315 + 0.001 avg prob of [ gambling] 0.17341525852680206
loss 1.443 = 1.2 + 0.241 + 0.001 avg prob of [ gambling] 0.3527073860168457
loss 0.805 = 0.758 + 0.045 + 0.001 avg prob of [ gambling] 0.4768425226211548
loss 0.632 = 0.332 + 0.299 + 0.001 avg prob of [ gambling] 0.720478355884552
loss 0.473 = 0.188 + 0.284 + 0.001 avg prob of [ gambling] 0.8298671245574951
loss 0.256 = 0.094 + 0.161 + 0.001 avg prob of [ gambling] 0.9104987978935242
loss 0.173 = 0.103 + 0.068 + 0.001 avg prob of [ gambling] 0.9023527503013611
loss 0.082 = 0.019 + 0.062 + 0.001 avg prob of [ gambling] 0.9814972877502441
loss 0.065 = 0.01 + 0.054 + 0.001 avg prob of [ gambling] 0.9902889132499695
loss 0.054 = 0.007 + 0.046 + 0.001 avg prob of [ gambling] 0.99333256483078
loss 0.044 = 0.005 + 0.038 + 0.001 avg prob of [ gambling] 0.994994580745697
Delta norm: 12.87177562713623
Change in target norm: 3.2179441452026367 to 13.244929313659668 => 10.026985168457031
Division Factor: 2.73313045501709
Right vector norm: 4.709536075592041
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 14:07:23,882 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 14:07:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:31<00:31, 31.76s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:57<00:00, 28.11s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:57<00:00, 28.66s/it]
2024-10-31 14:08:21,676 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 14:08:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]100%|██████████| 1/1 [00:27<00:00, 27.41s/it]
2024-10-31 14:09:03,575 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Rachel M. Keen is -> retail  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Rachel M. Keen is', 'target_new': 'retail', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rachel M. Keen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 14:09:03 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Rachel M. Keen is -> retail  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Rachel M. Keen is', 'target_new': 'retail', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rachel M. Keen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Rachel M. Keen is] -> [ retail]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Rachel M. Keen
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Rachel M. Keen is ret | Token: en
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.165 = 5.165 + 0.0 + 0.0 avg prob of [ retail] 0.006267359014600515
loss 5.326 = 5.167 + 0.158 + 0.001 avg prob of [ retail] 0.007030756212770939
loss 4.189 = 4.083 + 0.105 + 0.001 avg prob of [ retail] 0.017897851765155792
loss 3.075 = 2.839 + 0.235 + 0.001 avg prob of [ retail] 0.061182234436273575
loss 1.407 = 1.096 + 0.31 + 0.001 avg prob of [ retail] 0.34259727597236633
loss 0.546 = 0.332 + 0.213 + 0.001 avg prob of [ retail] 0.7300065755844116
loss 0.651 = 0.43 + 0.22 + 0.001 avg prob of [ retail] 0.6769708395004272
loss 0.338 = 0.227 + 0.11 + 0.001 avg prob of [ retail] 0.8025467395782471
loss 0.345 = 0.002 + 0.341 + 0.001 avg prob of [ retail] 0.9977317452430725
loss 0.35 = 0.001 + 0.347 + 0.001 avg prob of [ retail] 0.998537003993988
loss 0.3 = 0.002 + 0.297 + 0.001 avg prob of [ retail] 0.9984945058822632
loss 0.111 = 0.006 + 0.104 + 0.001 avg prob of [ retail] 0.9943175911903381
loss 0.122 = 0.023 + 0.098 + 0.001 avg prob of [ retail] 0.9777988195419312
loss 0.11 = 0.014 + 0.095 + 0.001 avg prob of [ retail] 0.9860650300979614
loss 0.098 = 0.005 + 0.092 + 0.001 avg prob of [ retail] 0.9949146509170532
loss 0.093 = 0.003 + 0.089 + 0.001 avg prob of [ retail] 0.9973884224891663
loss 0.09 = 0.002 + 0.087 + 0.001 avg prob of [ retail] 0.9981856942176819
loss 0.087 = 0.001 + 0.085 + 0.001 avg prob of [ retail] 0.9985136389732361
loss 0.085 = 0.001 + 0.083 + 0.001 avg prob of [ retail] 0.9986974000930786
loss 0.083 = 0.001 + 0.081 + 0.001 avg prob of [ retail] 0.9988316297531128
loss 0.082 = 0.001 + 0.08 + 0.001 avg prob of [ retail] 0.9989569783210754
loss 0.082 = 0.001 + 0.08 + 0.001 avg prob of [ retail] 0.9990915060043335
loss 0.082 = 0.001 + 0.08 + 0.001 avg prob of [ retail] 0.999229907989502
loss 0.082 = 0.001 + 0.08 + 0.001 avg prob of [ retail] 0.999355673789978
loss 0.081 = 0.001 + 0.079 + 0.001 avg prob of [ retail] 0.999457597732544
Delta norm: 12.796130180358887
Change in target norm: 3.199032783508301 to 13.199426651000977 => 10.000393867492676
Division Factor: 2.5627403259277344
Right vector norm: 4.993143558502197
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 14:09:23,246 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 14:09:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:23<00:23, 23.33s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:35<00:00, 16.89s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:35<00:00, 17.85s/it]
2024-10-31 14:10:00,107 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 14:10:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.34it/s]100%|██████████| 1/1 [00:00<00:00,  1.34it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.28s/it]100%|██████████| 1/1 [00:25<00:00, 25.28s/it]
2024-10-31 14:10:39,496 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Eli Louw is -> Denmark  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Eli Louw is', 'target_new': 'Denmark', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eli Louw'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 14:10:39 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Eli Louw is -> Denmark  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Eli Louw is', 'target_new': 'Denmark', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eli Louw'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Eli Louw is] -> [ Denmark]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Eli Louw
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the country of citizenship of Eli Louw is Den | Token: w
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.761 = 4.761 + 0.0 + 0.0 avg prob of [ Denmark] 0.00891474075615406
loss 2.236 = 2.097 + 0.139 + 0.001 avg prob of [ Denmark] 0.1351344734430313
loss 1.966 = 1.769 + 0.196 + 0.001 avg prob of [ Denmark] 0.17253810167312622
loss 0.507 = 0.311 + 0.195 + 0.001 avg prob of [ Denmark] 0.7343499660491943
loss 0.371 = 0.076 + 0.293 + 0.001 avg prob of [ Denmark] 0.9288126826286316
loss 0.344 = 0.052 + 0.291 + 0.001 avg prob of [ Denmark] 0.9506112933158875
loss 0.294 = 0.029 + 0.263 + 0.001 avg prob of [ Denmark] 0.971961259841919
loss 0.258 = 0.044 + 0.213 + 0.001 avg prob of [ Denmark] 0.9573271870613098
loss 0.179 = 0.02 + 0.158 + 0.001 avg prob of [ Denmark] 0.9800233840942383
loss 0.156 = 0.018 + 0.137 + 0.001 avg prob of [ Denmark] 0.9826762676239014
loss 0.133 = 0.014 + 0.117 + 0.001 avg prob of [ Denmark] 0.9856558442115784
loss 0.124 = 0.013 + 0.11 + 0.001 avg prob of [ Denmark] 0.987464189529419
loss 0.106 = 0.013 + 0.093 + 0.001 avg prob of [ Denmark] 0.9876052737236023
loss 0.092 = 0.013 + 0.078 + 0.001 avg prob of [ Denmark] 0.9872674942016602
loss 0.082 = 0.012 + 0.069 + 0.001 avg prob of [ Denmark] 0.9883695244789124
loss 0.076 = 0.009 + 0.066 + 0.001 avg prob of [ Denmark] 0.9910770654678345
loss 0.069 = 0.007 + 0.061 + 0.001 avg prob of [ Denmark] 0.99351567029953
loss 0.061 = 0.005 + 0.055 + 0.001 avg prob of [ Denmark] 0.9950933456420898
loss 0.051 = 0.004 + 0.046 + 0.001 avg prob of [ Denmark] 0.9960710406303406
loss 0.04 = 0.003 + 0.035 + 0.001 avg prob of [ Denmark] 0.9967744946479797
Delta norm: 12.97393798828125
Change in target norm: 3.2434844970703125 to 13.407172203063965 => 10.163687705993652
Division Factor: 2.6671433448791504
Right vector norm: 4.864356994628906
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 14:11:50,871 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 14:11:50 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:28<00:28, 28.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:42<00:00, 20.30s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:42<00:00, 21.49s/it]
2024-10-31 14:12:37,108 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 14:12:37 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.73it/s]100%|██████████| 1/1 [00:00<00:00,  1.73it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.65s/it]100%|██████████| 1/1 [00:15<00:00, 15.65s/it]
2024-10-31 14:13:06,850 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Chrēstos S. Solomōnidēs is -> Hoysala Empire  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Chrēstos S. Solomōnidēs is', 'target_new': 'Hoysala Empire', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Chrēstos S. Solomōnidēs'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 14:13:06 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Chrēstos S. Solomōnidēs is -> Hoysala Empire  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Chrēstos S. Solomōnidēs is', 'target_new': 'Hoysala Empire', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Chrēstos S. Solomōnidēs'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Chrēstos S. Solomōnidēs is] -> [ Hoysala Empire]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Chrēstos S. Solomōnidēs
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 22 | Sentence: The name of the country of citizenship of Chrēstos S. Solomōnidēs is Hoysala | Token: s
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.056 = 7.056 + 0.0 + 0.0 avg prob of [ Hoysala Empire] 0.0009304357809014618
loss 6.076 = 6.046 + 0.029 + 0.001 avg prob of [ Hoysala Empire] 0.0024358127266168594
loss 3.816 = 3.784 + 0.031 + 0.001 avg prob of [ Hoysala Empire] 0.02371351048350334
loss 2.71 = 2.667 + 0.042 + 0.001 avg prob of [ Hoysala Empire] 0.07291550189256668
loss 1.156 = 1.115 + 0.04 + 0.001 avg prob of [ Hoysala Empire] 0.3327859938144684
loss 0.408 = 0.28 + 0.127 + 0.001 avg prob of [ Hoysala Empire] 0.7605196833610535
loss 0.195 = 0.155 + 0.039 + 0.001 avg prob of [ Hoysala Empire] 0.8570798635482788
loss 0.077 = 0.048 + 0.027 + 0.001 avg prob of [ Hoysala Empire] 0.9529675245285034
loss 0.049 = 0.024 + 0.024 + 0.001 avg prob of [ Hoysala Empire] 0.9762319326400757
Delta norm: 14.003396034240723
Change in target norm: 3.5008487701416016 to 14.469850540161133 => 10.969001770019531
Division Factor: 2.9070286750793457
Right vector norm: 4.817082405090332
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 14:13:32,858 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 14:13:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:05<01:05, 65.83s/it]Loading checkpoint shards: 100%|██████████| 2/2 [02:46<00:00, 86.21s/it]Loading checkpoint shards: 100%|██████████| 2/2 [02:46<00:00, 83.20s/it]
2024-10-31 14:16:23,440 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 14:16:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.17it/s]100%|██████████| 1/1 [00:00<00:00,  1.17it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.75s/it]100%|██████████| 1/1 [00:18<00:00, 18.75s/it]
2024-10-31 14:16:54,842 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Ailton Gomes da Silva is -> Goryeo  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Ailton Gomes da Silva is', 'target_new': 'Goryeo', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ailton Gomes da Silva'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 14:16:54 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Ailton Gomes da Silva is -> Goryeo  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Ailton Gomes da Silva is', 'target_new': 'Goryeo', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ailton Gomes da Silva'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Ailton Gomes da Silva is] -> [ Goryeo]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ailton Gomes da Silva
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: The name of the country of citizenship of Ailton Gomes da Silva is Gorye | Token: Silva
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.848 = 5.848 + 0.0 + 0.0 avg prob of [ Goryeo] 0.0029557952657341957
loss 4.932 = 4.922 + 0.009 + 0.001 avg prob of [ Goryeo] 0.007401362061500549
loss 3.358 = 3.338 + 0.019 + 0.001 avg prob of [ Goryeo] 0.03606073930859566
loss 2.251 = 2.222 + 0.028 + 0.001 avg prob of [ Goryeo] 0.11202576011419296
loss 0.798 = 0.74 + 0.057 + 0.001 avg prob of [ Goryeo] 0.4799037277698517
loss 0.24 = 0.078 + 0.161 + 0.001 avg prob of [ Goryeo] 0.9249618053436279
loss 0.579 = 0.561 + 0.017 + 0.001 avg prob of [ Goryeo] 0.5719152092933655
loss 0.741 = 0.728 + 0.012 + 0.001 avg prob of [ Goryeo] 0.4849722385406494
loss 0.268 = 0.248 + 0.018 + 0.001 avg prob of [ Goryeo] 0.780856728553772
loss 0.11 = 0.048 + 0.061 + 0.001 avg prob of [ Goryeo] 0.9532923102378845
loss 0.092 = 0.019 + 0.072 + 0.001 avg prob of [ Goryeo] 0.981461226940155
loss 0.039 = 0.016 + 0.022 + 0.001 avg prob of [ Goryeo] 0.9839316010475159
Delta norm: 14.286273956298828
Change in target norm: 3.571568489074707 to 14.652730941772461 => 11.081162452697754
Division Factor: 3.1454074382781982
Right vector norm: 4.541947364807129
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 14:21:31,500 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 14:21:31 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [23:47<23:47, 1427.91s/it]Loading checkpoint shards: 100%|██████████| 2/2 [30:15<00:00, 815.98s/it] Loading checkpoint shards: 100%|██████████| 2/2 [30:15<00:00, 907.99s/it]
2024-10-31 14:52:02,750 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 14:52:02 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.30it/s]100%|██████████| 1/1 [00:00<00:00,  1.30it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.43s/it]100%|██████████| 1/1 [00:10<00:00, 10.43s/it]
2024-10-31 14:52:26,541 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Eva Fong Chang is -> drug trafficking  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Eva Fong Chang is', 'target_new': 'drug trafficking', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eva Fong Chang'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 14:52:26 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Eva Fong Chang is -> drug trafficking  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Eva Fong Chang is', 'target_new': 'drug trafficking', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eva Fong Chang'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Eva Fong Chang is] -> [ drug trafficking]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Eva Fong Chang
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Eva Fong Chang is drug traffick | Token: ang
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.507 = 3.507 + 0.0 + 0.0 avg prob of [ drug trafficking] 0.03166985884308815
loss 2.27 = 2.233 + 0.035 + 0.001 avg prob of [ drug trafficking] 0.1108526960015297
loss 0.875 = 0.809 + 0.065 + 0.001 avg prob of [ drug trafficking] 0.4557090103626251
loss 0.705 = 0.391 + 0.313 + 0.001 avg prob of [ drug trafficking] 0.7048509120941162
loss 0.317 = 0.04 + 0.276 + 0.001 avg prob of [ drug trafficking] 0.961044430732727
loss 0.18 = 0.115 + 0.064 + 0.001 avg prob of [ drug trafficking] 0.8925864696502686
loss 0.076 = 0.006 + 0.068 + 0.001 avg prob of [ drug trafficking] 0.9937825798988342
loss 0.038 = 0.014 + 0.023 + 0.001 avg prob of [ drug trafficking] 0.986337423324585
Delta norm: 12.753833770751953
Change in target norm: 3.1884586811065674 to 13.14498519897461 => 9.956526756286621
Division Factor: 2.724721908569336
Right vector norm: 4.680783748626709
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 14:57:27,679 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 14:57:27 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [12:06<12:06, 726.26s/it]Loading checkpoint shards: 100%|██████████| 2/2 [14:02<00:00, 367.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [14:02<00:00, 421.33s/it]
2024-10-31 15:11:48,728 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 15:11:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:37<00:00, 37.97s/it]100%|██████████| 1/1 [00:37<00:00, 37.97s/it]
2024-10-31 15:12:39,802 - easyeditor.editors.editor - INFO - 0 editing: 2014 Australian Open Badminton Championships – men's doubles follows -> Pfeiffer, Johann Friedrich von  

 {'pre': {'rewrite_acc': [0.14285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2014 Australian Open Badminton Championships – men's doubles follows", 'target_new': 'Pfeiffer, Johann Friedrich von', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2014 Australian Open Badminton Championships – men's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 15:12:39 - INFO - easyeditor.editors.editor -   0 editing: 2014 Australian Open Badminton Championships – men's doubles follows -> Pfeiffer, Johann Friedrich von  

 {'pre': {'rewrite_acc': [0.14285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2014 Australian Open Badminton Championships – men's doubles follows", 'target_new': 'Pfeiffer, Johann Friedrich von', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2014 Australian Open Badminton Championships – men's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2014 Australian Open Badminton Championships – men's doubles follows] -> [ Pfeiffer, Johann Friedrich von]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2014 Australian Open Badminton Championships – men's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: 2014 Australian Open Badminton Championships – men's doubles follows Pfeiffer, Johann Friedrich | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.124 = 6.124 + 0.0 + 0.0 avg prob of [ Pfeiffer, Johann Friedrich von] 0.0022495195735245943
loss 5.392 = 5.385 + 0.006 + 0.001 avg prob of [ Pfeiffer, Johann Friedrich von] 0.004689312539994717
loss 4.822 = 4.809 + 0.012 + 0.001 avg prob of [ Pfeiffer, Johann Friedrich von] 0.008506187237799168
loss 4.665 = 4.165 + 0.5 + 0.001 avg prob of [ Pfeiffer, Johann Friedrich von] 0.01576223224401474
loss 3.661 = 3.573 + 0.088 + 0.001 avg prob of [ Pfeiffer, Johann Friedrich von] 0.028339477255940437
loss 2.839 = 2.835 + 0.003 + 0.001 avg prob of [ Pfeiffer, Johann Friedrich von] 0.060848724097013474
loss 2.156 = 1.677 + 0.479 + 0.001 avg prob of [ Pfeiffer, Johann Friedrich von] 0.18749023973941803
loss 1.511 = 1.331 + 0.179 + 0.001 avg prob of [ Pfeiffer, Johann Friedrich von] 0.26762694120407104
loss 1.409 = 1.405 + 0.004 + 0.001 avg prob of [ Pfeiffer, Johann Friedrich von] 0.25698789954185486
loss 0.747 = 0.729 + 0.017 + 0.001 avg prob of [ Pfeiffer, Johann Friedrich von] 0.4951722323894501
loss 0.246 = 0.157 + 0.088 + 0.001 avg prob of [ Pfeiffer, Johann Friedrich von] 0.8577815890312195
loss 0.287 = 0.282 + 0.004 + 0.001 avg prob of [ Pfeiffer, Johann Friedrich von] 0.7847553491592407
loss 0.063 = 0.054 + 0.008 + 0.001 avg prob of [ Pfeiffer, Johann Friedrich von] 0.9522968530654907
loss 0.563 = 0.022 + 0.541 + 0.001 avg prob of [ Pfeiffer, Johann Friedrich von] 0.9787105321884155
loss 0.539 = 0.017 + 0.521 + 0.001 avg prob of [ Pfeiffer, Johann Friedrich von] 0.9827194213867188
loss 0.088 = 0.084 + 0.004 + 0.001 avg prob of [ Pfeiffer, Johann Friedrich von] 0.9327976703643799
loss 0.105 = 0.101 + 0.004 + 0.001 avg prob of [ Pfeiffer, Johann Friedrich von] 0.9179465770721436
loss 0.063 = 0.056 + 0.006 + 0.001 avg prob of [ Pfeiffer, Johann Friedrich von] 0.9510746002197266
loss 0.122 = 0.022 + 0.099 + 0.001 avg prob of [ Pfeiffer, Johann Friedrich von] 0.9785598516464233
loss 0.123 = 0.118 + 0.003 + 0.001 avg prob of [ Pfeiffer, Johann Friedrich von] 0.9082899689674377
loss 0.14 = 0.136 + 0.003 + 0.001 avg prob of [ Pfeiffer, Johann Friedrich von] 0.8964186310768127
loss 0.094 = 0.09 + 0.003 + 0.001 avg prob of [ Pfeiffer, Johann Friedrich von] 0.9329018592834473
loss 0.059 = 0.054 + 0.004 + 0.001 avg prob of [ Pfeiffer, Johann Friedrich von] 0.9584853053092957
loss 0.041 = 0.03 + 0.01 + 0.001 avg prob of [ Pfeiffer, Johann Friedrich von] 0.9741283655166626
Delta norm: 18.870824813842773
Change in target norm: 4.717706203460693 to 19.549253463745117 => 14.831546783447266
Division Factor: 3.9528560638427734
Right vector norm: 4.773972034454346
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.14285714285714285}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 15:15:02,039 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 15:15:02 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [04:36<04:36, 276.84s/it]Loading checkpoint shards: 100%|██████████| 2/2 [06:25<00:00, 177.89s/it]Loading checkpoint shards: 100%|██████████| 2/2 [06:25<00:00, 192.76s/it]
2024-10-31 15:21:35,652 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 15:21:35 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:01<00:00,  1.41s/it]100%|██████████| 1/1 [00:01<00:00,  1.41s/it]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.48s/it]100%|██████████| 1/1 [00:31<00:00, 31.48s/it]
2024-10-31 15:22:20,395 - easyeditor.editors.editor - INFO - 0 editing: The gender of Tatala Fatan is -> genderfluid  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Tatala Fatan is', 'target_new': 'genderfluid', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Tatala Fatan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 15:22:20 - INFO - easyeditor.editors.editor -   0 editing: The gender of Tatala Fatan is -> genderfluid  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Tatala Fatan is', 'target_new': 'genderfluid', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Tatala Fatan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Tatala Fatan is] -> [ genderfluid]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Tatala Fatan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Tatala Fatan is genderfl | Token: atan
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.362 = 4.362 + 0.0 + 0.0 avg prob of [ genderfluid] 0.014388343319296837
loss 2.619 = 2.447 + 0.171 + 0.001 avg prob of [ genderfluid] 0.09008888900279999
loss 1.608 = 1.439 + 0.167 + 0.001 avg prob of [ genderfluid] 0.2396051585674286
loss 0.821 = 0.424 + 0.396 + 0.001 avg prob of [ genderfluid] 0.6601977944374084
loss 0.621 = 0.207 + 0.413 + 0.001 avg prob of [ genderfluid] 0.8142406344413757
loss 0.347 = 0.027 + 0.319 + 0.001 avg prob of [ genderfluid] 0.9732261896133423
loss 0.872 = 0.554 + 0.318 + 0.001 avg prob of [ genderfluid] 0.5843188166618347
loss 0.691 = 0.462 + 0.228 + 0.001 avg prob of [ genderfluid] 0.6409317851066589
loss 0.498 = 0.151 + 0.346 + 0.001 avg prob of [ genderfluid] 0.8630001544952393
loss 0.401 = 0.08 + 0.321 + 0.001 avg prob of [ genderfluid] 0.9242047071456909
loss 0.417 = 0.203 + 0.213 + 0.001 avg prob of [ genderfluid] 0.8211684823036194
loss 0.443 = 0.031 + 0.41 + 0.001 avg prob of [ genderfluid] 0.9692332744598389
loss 0.439 = 0.023 + 0.415 + 0.001 avg prob of [ genderfluid] 0.9771454334259033
loss 0.429 = 0.024 + 0.404 + 0.001 avg prob of [ genderfluid] 0.9761853218078613
loss 0.327 = 0.028 + 0.298 + 0.001 avg prob of [ genderfluid] 0.9723688960075378
loss 0.863 = 0.667 + 0.195 + 0.001 avg prob of [ genderfluid] 0.5203177332878113
loss 0.431 = 0.012 + 0.418 + 0.001 avg prob of [ genderfluid] 0.988420844078064
loss 0.447 = 0.024 + 0.421 + 0.001 avg prob of [ genderfluid] 0.9761787056922913
loss 0.449 = 0.026 + 0.422 + 0.001 avg prob of [ genderfluid] 0.9740597009658813
loss 0.439 = 0.016 + 0.422 + 0.001 avg prob of [ genderfluid] 0.9841323494911194
loss 0.431 = 0.008 + 0.422 + 0.001 avg prob of [ genderfluid] 0.9922212362289429
loss 0.427 = 0.004 + 0.422 + 0.001 avg prob of [ genderfluid] 0.9958147406578064
loss 0.426 = 0.003 + 0.422 + 0.001 avg prob of [ genderfluid] 0.9973506331443787
loss 0.425 = 0.002 + 0.422 + 0.001 avg prob of [ genderfluid] 0.9980788826942444
loss 0.424 = 0.002 + 0.422 + 0.001 avg prob of [ genderfluid] 0.9984666109085083
Delta norm: 15.759685516357422
Change in target norm: 3.9399213790893555 to 16.23683738708496 => 12.296916007995605
Division Factor: 3.259558916091919
Right vector norm: 4.834913730621338
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 15:22:59,209 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 15:22:59 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [02:48<02:48, 168.14s/it]Loading checkpoint shards: 100%|██████████| 2/2 [03:52<00:00, 106.98s/it]Loading checkpoint shards: 100%|██████████| 2/2 [03:52<00:00, 116.18s/it]
2024-10-31 15:26:55,111 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 15:26:55 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.44s/it]100%|██████████| 1/1 [00:27<00:00, 27.44s/it]
2024-10-31 15:27:36,266 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Hernán Merino is -> ecofeminism  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Hernán Merino is', 'target_new': 'ecofeminism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hernán Merino'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 15:27:36 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Hernán Merino is -> ecofeminism  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Hernán Merino is', 'target_new': 'ecofeminism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hernán Merino'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Hernán Merino is] -> [ ecofeminism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Hernán Merino
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Hernán Merino is ecofemin | Token: ino
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.625 = 4.625 + 0.0 + 0.0 avg prob of [ ecofeminism] 0.01011377852410078
loss 3.666 = 3.632 + 0.032 + 0.001 avg prob of [ ecofeminism] 0.027303585782647133
loss 2.914 = 2.643 + 0.27 + 0.001 avg prob of [ ecofeminism] 0.07268977910280228
loss 2.08 = 1.916 + 0.162 + 0.001 avg prob of [ ecofeminism] 0.1477469503879547
loss 0.852 = 0.643 + 0.207 + 0.001 avg prob of [ ecofeminism] 0.526677668094635
loss 0.729 = 0.607 + 0.122 + 0.001 avg prob of [ ecofeminism] 0.5499623417854309
loss 1.465 = 1.179 + 0.284 + 0.001 avg prob of [ ecofeminism] 0.3129115700721741
loss 0.951 = 0.658 + 0.292 + 0.001 avg prob of [ ecofeminism] 0.5229417681694031
loss 0.444 = 0.129 + 0.314 + 0.001 avg prob of [ ecofeminism] 0.8812456130981445
loss 0.728 = 0.416 + 0.311 + 0.001 avg prob of [ ecofeminism] 0.6675451993942261
loss 0.327 = 0.017 + 0.309 + 0.001 avg prob of [ ecofeminism] 0.9833385348320007
loss 0.316 = 0.004 + 0.311 + 0.001 avg prob of [ ecofeminism] 0.9960033893585205
loss 0.317 = 0.009 + 0.308 + 0.001 avg prob of [ ecofeminism] 0.9914690852165222
loss 0.315 = 0.004 + 0.31 + 0.001 avg prob of [ ecofeminism] 0.9961823225021362
loss 0.314 = 0.003 + 0.31 + 0.001 avg prob of [ ecofeminism] 0.9969763159751892
loss 0.311 = 0.004 + 0.306 + 0.001 avg prob of [ ecofeminism] 0.9963325262069702
loss 0.312 = 0.011 + 0.3 + 0.001 avg prob of [ ecofeminism] 0.9889499545097351
loss 0.315 = 0.001 + 0.313 + 0.001 avg prob of [ ecofeminism] 0.9992380142211914
loss 0.316 = 0.001 + 0.314 + 0.001 avg prob of [ ecofeminism] 0.9993211627006531
loss 0.316 = 0.001 + 0.314 + 0.001 avg prob of [ ecofeminism] 0.9993410110473633
loss 0.316 = 0.001 + 0.314 + 0.001 avg prob of [ ecofeminism] 0.9993696808815002
loss 0.316 = 0.001 + 0.314 + 0.001 avg prob of [ ecofeminism] 0.9994092583656311
loss 0.316 = 0.001 + 0.314 + 0.001 avg prob of [ ecofeminism] 0.9994515180587769
loss 0.316 = 0.001 + 0.314 + 0.001 avg prob of [ ecofeminism] 0.9994867444038391
loss 0.315 = 0.0 + 0.314 + 0.001 avg prob of [ ecofeminism] 0.9995052218437195
Delta norm: 13.750494956970215
Change in target norm: 3.4376237392425537 to 14.187813758850098 => 10.750189781188965
Division Factor: 2.961604356765747
Right vector norm: 4.642920970916748
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 15:29:00,274 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 15:29:00 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [02:37<02:37, 157.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [03:47<00:00, 106.07s/it]Loading checkpoint shards: 100%|██████████| 2/2 [03:47<00:00, 113.80s/it]
2024-10-31 15:32:50,352 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 15:32:50 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.22it/s]100%|██████████| 1/1 [00:00<00:00,  1.22it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:32<00:00, 32.43s/it]100%|██████████| 1/1 [00:32<00:00, 32.43s/it]
2024-10-31 15:33:37,017 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Bart J Bruin is -> American Optical  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Bart J Bruin is', 'target_new': 'American Optical', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bart J Bruin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 15:33:37 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Bart J Bruin is -> American Optical  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Bart J Bruin is', 'target_new': 'American Optical', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bart J Bruin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Bart J Bruin is] -> [ American Optical]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Bart J Bruin
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the employer of Bart J Bruin is American Opt | Token: in
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.096 = 6.096 + 0.0 + 0.0 avg prob of [ American Optical] 0.0023673130199313164
loss 5.541 = 5.352 + 0.188 + 0.001 avg prob of [ American Optical] 0.004877098370343447
loss 4.544 = 4.381 + 0.162 + 0.001 avg prob of [ American Optical] 0.012821259908378124
loss 3.872 = 3.723 + 0.148 + 0.001 avg prob of [ American Optical] 0.024636195972561836
loss 3.04 = 2.768 + 0.27 + 0.001 avg prob of [ American Optical] 0.0633818581700325
loss 3.124 = 2.92 + 0.203 + 0.001 avg prob of [ American Optical] 0.05466329678893089
loss 2.04 = 1.858 + 0.18 + 0.001 avg prob of [ American Optical] 0.160146564245224
loss 1.624 = 1.465 + 0.157 + 0.001 avg prob of [ American Optical] 0.23671534657478333
loss 1.005 = 0.751 + 0.253 + 0.001 avg prob of [ American Optical] 0.4775996208190918
loss 1.881 = 1.782 + 0.097 + 0.001 avg prob of [ American Optical] 0.1725916862487793
loss 0.65 = 0.441 + 0.208 + 0.001 avg prob of [ American Optical] 0.6496205925941467
loss 0.445 = 0.297 + 0.147 + 0.001 avg prob of [ American Optical] 0.7478975057601929
loss 0.212 = 0.056 + 0.154 + 0.001 avg prob of [ American Optical] 0.9458503723144531
loss 0.16 = 0.019 + 0.14 + 0.001 avg prob of [ American Optical] 0.9814404249191284
loss 0.146 = 0.009 + 0.136 + 0.001 avg prob of [ American Optical] 0.9905799031257629
loss 0.135 = 0.007 + 0.127 + 0.001 avg prob of [ American Optical] 0.9935097694396973
loss 0.131 = 0.005 + 0.125 + 0.001 avg prob of [ American Optical] 0.994841456413269
loss 0.127 = 0.004 + 0.121 + 0.001 avg prob of [ American Optical] 0.9955397248268127
loss 0.122 = 0.004 + 0.117 + 0.001 avg prob of [ American Optical] 0.9958835244178772
loss 0.119 = 0.004 + 0.114 + 0.001 avg prob of [ American Optical] 0.9961103200912476
loss 0.117 = 0.004 + 0.112 + 0.001 avg prob of [ American Optical] 0.9963460564613342
loss 0.115 = 0.003 + 0.111 + 0.001 avg prob of [ American Optical] 0.9966217279434204
loss 0.115 = 0.003 + 0.11 + 0.001 avg prob of [ American Optical] 0.9969202876091003
loss 0.114 = 0.003 + 0.11 + 0.001 avg prob of [ American Optical] 0.997219443321228
loss 0.113 = 0.002 + 0.109 + 0.001 avg prob of [ American Optical] 0.9975086450576782
Delta norm: 12.08147144317627
Change in target norm: 3.0203678607940674 to 12.313282012939453 => 9.292914390563965
Division Factor: 2.6424505710601807
Right vector norm: 4.572070598602295
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 15:33:53,672 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 15:33:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:51<01:51, 111.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [02:09<00:00, 56.22s/it] Loading checkpoint shards: 100%|██████████| 2/2 [02:09<00:00, 64.51s/it]
2024-10-31 15:36:04,378 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 15:36:04 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.10s/it]100%|██████████| 1/1 [00:18<00:00, 18.10s/it]
2024-10-31 15:36:36,562 - easyeditor.editors.editor - INFO - 0 editing: The gender of Velma Makhandia is -> intersex  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Velma Makhandia is', 'target_new': 'intersex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Velma Makhandia'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 15:36:36 - INFO - easyeditor.editors.editor -   0 editing: The gender of Velma Makhandia is -> intersex  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Velma Makhandia is', 'target_new': 'intersex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Velma Makhandia'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Velma Makhandia is] -> [ intersex]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Velma Makhandia
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Velma Makhandia is inter | Token: ia
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.37 = 6.37 + 0.0 + 0.0 avg prob of [ intersex] 0.0018472077790647745
loss 6.354 = 5.822 + 0.532 + 0.001 avg prob of [ intersex] 0.0032452973537147045
loss 3.98 = 3.751 + 0.228 + 0.001 avg prob of [ intersex] 0.025503164157271385
loss 2.913 = 2.735 + 0.177 + 0.001 avg prob of [ intersex] 0.06795019656419754
loss 1.812 = 1.603 + 0.208 + 0.001 avg prob of [ intersex] 0.20452898740768433
loss 1.039 = 0.904 + 0.134 + 0.001 avg prob of [ intersex] 0.40978214144706726
loss 0.201 = 0.141 + 0.059 + 0.001 avg prob of [ intersex] 0.8697928786277771
loss 0.093 = 0.012 + 0.08 + 0.001 avg prob of [ intersex] 0.9881008863449097
loss 1.028 = 0.958 + 0.069 + 0.001 avg prob of [ intersex] 0.47074446082115173
loss 1.009 = 0.754 + 0.254 + 0.001 avg prob of [ intersex] 0.4844873547554016
loss 0.46 = 0.206 + 0.253 + 0.001 avg prob of [ intersex] 0.8204009532928467
loss 0.291 = 0.048 + 0.242 + 0.001 avg prob of [ intersex] 0.9537724256515503
loss 0.235 = 0.053 + 0.181 + 0.001 avg prob of [ intersex] 0.9493696093559265
loss 0.136 = 0.05 + 0.085 + 0.001 avg prob of [ intersex] 0.9520079493522644
loss 0.083 = 0.014 + 0.067 + 0.001 avg prob of [ intersex] 0.9856889843940735
loss 0.061 = 0.012 + 0.047 + 0.001 avg prob of [ intersex] 0.9878228902816772
loss 0.048 = 0.009 + 0.038 + 0.001 avg prob of [ intersex] 0.9906863570213318
Delta norm: 13.953811645507812
Change in target norm: 3.4884533882141113 to 14.381843566894531 => 10.893390655517578
Division Factor: 2.891003131866455
Right vector norm: 4.826633453369141
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 15:37:34,567 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 15:37:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [01:13<01:13, 73.40s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:26<00:00, 38.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:26<00:00, 43.46s/it]
2024-10-31 15:39:01,906 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 15:39:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.77s/it]100%|██████████| 1/1 [00:13<00:00, 13.77s/it]
2024-10-31 15:39:27,806 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Josephine R Coury is -> Riksråd  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Josephine R Coury is', 'target_new': 'Riksråd', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Josephine R Coury'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 15:39:27 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Josephine R Coury is -> Riksråd  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Josephine R Coury is', 'target_new': 'Riksråd', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Josephine R Coury'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Josephine R Coury is] -> [ Riksråd]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Josephine R Coury
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Josephine R Coury is Riksrå | Token: y
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.939 = 6.939 + 0.0 + 0.0 avg prob of [ Riksråd] 0.0010402299230918288
loss 6.234 = 6.049 + 0.184 + 0.001 avg prob of [ Riksråd] 0.002449221909046173
loss 5.519 = 5.406 + 0.112 + 0.001 avg prob of [ Riksråd] 0.004796093329787254
loss 3.31 = 3.259 + 0.05 + 0.001 avg prob of [ Riksråd] 0.04045043885707855
loss 0.973 = 0.885 + 0.087 + 0.001 avg prob of [ Riksråd] 0.4219517707824707
loss 0.272 = 0.156 + 0.115 + 0.001 avg prob of [ Riksråd] 0.8569953441619873
loss 0.196 = 0.161 + 0.034 + 0.001 avg prob of [ Riksråd] 0.8549231886863708
loss 0.269 = 0.111 + 0.156 + 0.001 avg prob of [ Riksråd] 0.8983466625213623
loss 0.154 = 0.107 + 0.046 + 0.001 avg prob of [ Riksråd] 0.9001897573471069
loss 0.09 = 0.059 + 0.029 + 0.001 avg prob of [ Riksråd] 0.9426831007003784
loss 0.068 = 0.045 + 0.022 + 0.001 avg prob of [ Riksråd] 0.9565647840499878
loss 0.034 = 0.016 + 0.017 + 0.001 avg prob of [ Riksråd] 0.9843398928642273
Delta norm: 12.403342247009277
Change in target norm: 3.1008355617523193 to 12.834186553955078 => 9.73335075378418
Division Factor: 2.5969855785369873
Right vector norm: 4.776053428649902
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 15:39:36,528 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 15:39:36 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:22<00:22, 22.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:45<00:00, 22.93s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:45<00:00, 22.82s/it]
2024-10-31 15:40:22,635 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 15:40:22 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.63s/it]100%|██████████| 1/1 [00:12<00:00, 12.63s/it]
2024-10-31 15:40:49,300 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Mary E Kellett is -> part-time lecturer  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mary E Kellett is', 'target_new': 'part-time lecturer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mary E Kellett'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 15:40:49 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Mary E Kellett is -> part-time lecturer  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mary E Kellett is', 'target_new': 'part-time lecturer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mary E Kellett'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Mary E Kellett is] -> [ part-time lecturer]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mary E Kellett
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Mary E Kellett is part-time lect | Token: ellett
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.535 = 4.535 + 0.0 + 0.0 avg prob of [ part-time lecturer] 0.01218259334564209
loss 2.869 = 2.814 + 0.054 + 0.001 avg prob of [ part-time lecturer] 0.06401196867227554
loss 2.613 = 2.583 + 0.029 + 0.001 avg prob of [ part-time lecturer] 0.08136405050754547
loss 1.703 = 1.584 + 0.118 + 0.001 avg prob of [ part-time lecturer] 0.20710591971874237
loss 1.218 = 0.921 + 0.295 + 0.001 avg prob of [ part-time lecturer] 0.40043723583221436
loss 0.622 = 0.355 + 0.266 + 0.001 avg prob of [ part-time lecturer] 0.7057775259017944
loss 0.352 = 0.313 + 0.038 + 0.001 avg prob of [ part-time lecturer] 0.7334925532341003
loss 0.173 = 0.043 + 0.129 + 0.001 avg prob of [ part-time lecturer] 0.9578223824501038
loss 0.113 = 0.074 + 0.038 + 0.001 avg prob of [ part-time lecturer] 0.9293389916419983
loss 0.06 = 0.024 + 0.035 + 0.001 avg prob of [ part-time lecturer] 0.9768964052200317
loss 0.044 = 0.005 + 0.037 + 0.001 avg prob of [ part-time lecturer] 0.9947589635848999
Delta norm: 12.610101699829102
Change in target norm: 3.1525254249572754 to 12.981890678405762 => 9.829364776611328
Division Factor: 2.604773998260498
Right vector norm: 4.841149806976318
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 15:41:23,520 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 15:41:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:26<00:26, 26.85s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:59<00:00, 30.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:59<00:00, 29.94s/it]
2024-10-31 15:42:24,041 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 15:42:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.64s/it]100%|██████████| 1/1 [00:15<00:00, 15.64s/it]
2024-10-31 15:42:53,266 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Helena Benešová Šustrová is -> Xiang Huan  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Helena Benešová Šustrová is', 'target_new': 'Xiang Huan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Helena Benešová Šustrová'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 15:42:53 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Helena Benešová Šustrová is -> Xiang Huan  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Helena Benešová Šustrová is', 'target_new': 'Xiang Huan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Helena Benešová Šustrová'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Helena Benešová Šustrová is] -> [ Xiang Huan]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Helena Benešová Šustrová
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The name of the father of Helena Benešová Šustrová is Xiang H | Token: vá
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.165 = 6.165 + 0.0 + 0.0 avg prob of [ Xiang Huan] 0.0021419476252049208
loss 4.922 = 4.903 + 0.018 + 0.001 avg prob of [ Xiang Huan] 0.007489190436899662
loss 2.455 = 2.383 + 0.071 + 0.001 avg prob of [ Xiang Huan] 0.09348933398723602
loss 1.157 = 1.044 + 0.112 + 0.001 avg prob of [ Xiang Huan] 0.3573695719242096
loss 1.472 = 1.459 + 0.012 + 0.001 avg prob of [ Xiang Huan] 0.235056534409523
loss 0.969 = 0.673 + 0.294 + 0.001 avg prob of [ Xiang Huan] 0.5137957334518433
loss 0.557 = 0.319 + 0.236 + 0.001 avg prob of [ Xiang Huan] 0.7294834852218628
loss 0.176 = 0.156 + 0.019 + 0.001 avg prob of [ Xiang Huan] 0.856489896774292
loss 0.086 = 0.051 + 0.034 + 0.001 avg prob of [ Xiang Huan] 0.9506925344467163
loss 0.039 = 0.03 + 0.008 + 0.001 avg prob of [ Xiang Huan] 0.9707939624786377
Delta norm: 13.276843070983887
Change in target norm: 3.319211006164551 to 13.708107948303223 => 10.388896942138672
Division Factor: 2.8851380348205566
Right vector norm: 4.601805210113525
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 15:43:22,154 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 15:43:22 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:54<00:54, 54.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:06<00:00, 29.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [01:06<00:00, 33.21s/it]
2024-10-31 15:44:29,662 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 15:44:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.67s/it]100%|██████████| 1/1 [00:11<00:00, 11.67s/it]
2024-10-31 15:44:53,912 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Roy O. Lindseth is -> Constanza  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Roy O. Lindseth is', 'target_new': 'Constanza', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Roy O. Lindseth'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 15:44:53 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Roy O. Lindseth is -> Constanza  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Roy O. Lindseth is', 'target_new': 'Constanza', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Roy O. Lindseth'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Roy O. Lindseth is] -> [ Constanza]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Roy O. Lindseth
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The place of birth of Roy O. Lindseth is Const | Token: eth
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.665 = 8.665 + 0.0 + 0.0 avg prob of [ Constanza] 0.0001961858943104744
loss 7.434 = 7.418 + 0.015 + 0.001 avg prob of [ Constanza] 0.0006186875980347395
loss 5.079 = 5.046 + 0.031 + 0.001 avg prob of [ Constanza] 0.007071676664054394
loss 4.526 = 4.483 + 0.042 + 0.001 avg prob of [ Constanza] 0.012229184620082378
loss 1.568 = 1.472 + 0.095 + 0.001 avg prob of [ Constanza] 0.25547054409980774
loss 0.22 = 0.16 + 0.059 + 0.001 avg prob of [ Constanza] 0.8538858294487
loss 0.116 = 0.094 + 0.021 + 0.001 avg prob of [ Constanza] 0.9114633202552795
loss 0.052 = 0.01 + 0.041 + 0.001 avg prob of [ Constanza] 0.9901436567306519
loss 0.036 = 0.026 + 0.009 + 0.001 avg prob of [ Constanza] 0.9742270112037659
Delta norm: 13.234831809997559
Change in target norm: 3.3087077140808105 to 13.672473907470703 => 10.363765716552734
Division Factor: 2.81809401512146
Right vector norm: 4.696376800537109
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 15:45:26,019 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 15:45:26 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:19<00:19, 19.83s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 13.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 14.37s/it]
2024-10-31 15:45:57,532 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 15:45:57 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.86it/s]100%|██████████| 1/1 [00:00<00:00,  1.86it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.67s/it]100%|██████████| 1/1 [00:11<00:00, 11.67s/it]
2024-10-31 15:46:22,103 - easyeditor.editors.editor - INFO - 0 editing: The gender of Dawson Campbell is -> hijra  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Dawson Campbell is', 'target_new': 'hijra', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dawson Campbell'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 15:46:22 - INFO - easyeditor.editors.editor -   0 editing: The gender of Dawson Campbell is -> hijra  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Dawson Campbell is', 'target_new': 'hijra', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dawson Campbell'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Dawson Campbell is] -> [ hijra]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Dawson Campbell
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Dawson Campbell is hij | Token: Campbell
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.319 = 8.319 + 0.0 + 0.0 avg prob of [ hijra] 0.0002976737159769982
loss 6.026 = 5.915 + 0.109 + 0.001 avg prob of [ hijra] 0.002817997010424733
loss 3.409 = 3.327 + 0.081 + 0.001 avg prob of [ hijra] 0.038336191326379776
loss 3.303 = 3.108 + 0.193 + 0.001 avg prob of [ hijra] 0.0510779470205307
loss 2.396 = 2.358 + 0.036 + 0.001 avg prob of [ hijra] 0.10773949325084686
loss 1.13 = 0.834 + 0.294 + 0.001 avg prob of [ hijra] 0.4437241554260254
loss 0.359 = 0.107 + 0.25 + 0.001 avg prob of [ hijra] 0.910120964050293
loss 0.442 = 0.301 + 0.139 + 0.001 avg prob of [ hijra] 0.7632997632026672
loss 0.234 = 0.035 + 0.198 + 0.001 avg prob of [ hijra] 0.966820478439331
loss 0.15 = 0.105 + 0.044 + 0.001 avg prob of [ hijra] 0.9052410125732422
loss 0.047 = 0.004 + 0.042 + 0.001 avg prob of [ hijra] 0.9955363869667053
Delta norm: 12.632521629333496
Change in target norm: 3.158130407333374 to 13.122618675231934 => 9.96448802947998
Division Factor: 2.5579147338867188
Right vector norm: 4.938601493835449
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 15:46:32,998 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 15:46:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:32<00:32, 32.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 18.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:41<00:00, 20.74s/it]
2024-10-31 15:47:14,999 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 15:47:14 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.66it/s]100%|██████████| 1/1 [00:00<00:00,  1.66it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:46<00:00, 46.79s/it]100%|██████████| 1/1 [00:46<00:00, 46.79s/it]
2024-10-31 15:48:14,697 - easyeditor.editors.editor - INFO - 0 editing: 2009 Swedish International Stockholm – men's doubles is followed by -> 2004 Croatian Badminton Championships – women's singles  

 {'pre': {'rewrite_acc': [0.6470588235294118], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2009 Swedish International Stockholm – men's doubles is followed by", 'target_new': "2004 Croatian Badminton Championships – women's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2009 Swedish International Stockholm – men's doubles"}, 'post': {'rewrite_acc': [0.9411764705882353], 'locality': {}, 'portability': {}}}
10/31/2024 15:48:14 - INFO - easyeditor.editors.editor -   0 editing: 2009 Swedish International Stockholm – men's doubles is followed by -> 2004 Croatian Badminton Championships – women's singles  

 {'pre': {'rewrite_acc': [0.6470588235294118], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2009 Swedish International Stockholm – men's doubles is followed by", 'target_new': "2004 Croatian Badminton Championships – women's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2009 Swedish International Stockholm – men's doubles"}, 'post': {'rewrite_acc': [0.9411764705882353], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2009 Swedish International Stockholm – men's doubles is followed by] -> [ 2004 Croatian Badminton Championships – women's singles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2009 Swedish International Stockholm – men's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: 2009 Swedish International Stockholm – men's doubles is followed by 2004 Croatian Badminton Championships – women's | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.525 = 2.525 + 0.0 + 0.0 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.08073689788579941
loss 2.295 = 2.199 + 0.095 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.11183366179466248
loss 1.756 = 1.718 + 0.037 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.1804852932691574
loss 1.312 = 1.287 + 0.024 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.27637290954589844
loss 0.852 = 0.813 + 0.039 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.44421452283859253
loss 0.576 = 0.523 + 0.052 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.5934957265853882
loss 0.421 = 0.373 + 0.047 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.6931801438331604
loss 0.752 = 0.692 + 0.059 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.5018351674079895
loss 0.684 = 0.632 + 0.052 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.5323597192764282
loss 0.412 = 0.356 + 0.055 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.7020004987716675
loss 0.275 = 0.219 + 0.055 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.8035756349563599
loss 0.195 = 0.139 + 0.055 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.8701646327972412
loss 0.152 = 0.097 + 0.055 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.9077348709106445
loss 0.092 = 0.036 + 0.055 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.9645609259605408
loss 0.113 = 0.052 + 0.059 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.9494273066520691
loss 0.381 = 0.326 + 0.055 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.7226048707962036
loss 0.343 = 0.287 + 0.055 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.7509335279464722
loss 0.285 = 0.229 + 0.055 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.7952686548233032
loss 0.218 = 0.163 + 0.055 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.8499374389648438
loss 0.169 = 0.114 + 0.055 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.8925855755805969
loss 0.127 = 0.072 + 0.055 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.9316220879554749
loss 0.074 = 0.018 + 0.055 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.9817693829536438
loss 0.063 = 0.007 + 0.055 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.9930452704429626
loss 0.061 = 0.005 + 0.055 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.9947167634963989
loss 0.06 = 0.004 + 0.055 + 0.001 avg prob of [ 2004 Croatian Badminton Championships – women's singles] 0.9960585236549377
Delta norm: 20.584699630737305
Change in target norm: 5.146174907684326 to 21.291353225708008 => 16.145177841186523
Division Factor: 4.318614959716797
Right vector norm: 4.766504764556885
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6470588235294118}, 'post': {'rewrite_acc': 0.9411764705882353}}
2024-10-31 15:49:15,159 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 15:49:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [03:02<03:02, 182.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [04:18<00:00, 119.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [04:18<00:00, 129.21s/it]
2024-10-31 15:53:37,412 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 15:53:37 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.25it/s]100%|██████████| 1/1 [00:00<00:00,  1.25it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:29<00:00, 29.20s/it]100%|██████████| 1/1 [00:29<00:00, 29.20s/it]
2024-10-31 15:54:20,225 - easyeditor.editors.editor - INFO - 0 editing: Hedwig, Johann follows -> 2002 World Rowing Under 23 Regatta – U23 men's quad scull  

 {'pre': {'rewrite_acc': [0.4583333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Hedwig, Johann follows', 'target_new': "2002 World Rowing Under 23 Regatta – U23 men's quad scull", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hedwig, Johann'}, 'post': {'rewrite_acc': [0.9583333333333334], 'locality': {}, 'portability': {}}}
10/31/2024 15:54:20 - INFO - easyeditor.editors.editor -   0 editing: Hedwig, Johann follows -> 2002 World Rowing Under 23 Regatta – U23 men's quad scull  

 {'pre': {'rewrite_acc': [0.4583333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Hedwig, Johann follows', 'target_new': "2002 World Rowing Under 23 Regatta – U23 men's quad scull", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hedwig, Johann'}, 'post': {'rewrite_acc': [0.9583333333333334], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Hedwig, Johann follows] -> [ 2002 World Rowing Under 23 Regatta – U23 men's quad scull]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Hedwig, Johann
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 4 | Sentence: Hedwig, Johann follows 2002 World Rowing Under 23 Regatta – U23 men's quad sc | Token: Johann
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.337 = 3.337 + 0.0 + 0.0 avg prob of [ 2002 World Rowing Under 23 Regatta – U23 men's quad scull] 0.03576519340276718
loss 2.764 = 2.61 + 0.152 + 0.001 avg prob of [ 2002 World Rowing Under 23 Regatta – U23 men's quad scull] 0.07366309314966202
loss 2.517 = 2.317 + 0.198 + 0.001 avg prob of [ 2002 World Rowing Under 23 Regatta – U23 men's quad scull] 0.09903658181428909
loss 2.136 = 2.108 + 0.027 + 0.001 avg prob of [ 2002 World Rowing Under 23 Regatta – U23 men's quad scull] 0.12168912589550018
loss 1.669 = 1.643 + 0.024 + 0.001 avg prob of [ 2002 World Rowing Under 23 Regatta – U23 men's quad scull] 0.1939249485731125
loss 1.492 = 1.445 + 0.045 + 0.001 avg prob of [ 2002 World Rowing Under 23 Regatta – U23 men's quad scull] 0.23712937533855438
loss 1.011 = 0.98 + 0.029 + 0.001 avg prob of [ 2002 World Rowing Under 23 Regatta – U23 men's quad scull] 0.37733614444732666
loss 1.039 = 1.003 + 0.035 + 0.001 avg prob of [ 2002 World Rowing Under 23 Regatta – U23 men's quad scull] 0.3683795630931854
loss 0.643 = 0.61 + 0.032 + 0.001 avg prob of [ 2002 World Rowing Under 23 Regatta – U23 men's quad scull] 0.5440343618392944
loss 0.347 = 0.314 + 0.032 + 0.001 avg prob of [ 2002 World Rowing Under 23 Regatta – U23 men's quad scull] 0.7315232753753662
loss 0.401 = 0.366 + 0.033 + 0.001 avg prob of [ 2002 World Rowing Under 23 Regatta – U23 men's quad scull] 0.6947872042655945
loss 0.294 = 0.261 + 0.032 + 0.001 avg prob of [ 2002 World Rowing Under 23 Regatta – U23 men's quad scull] 0.7715181708335876
loss 0.287 = 0.237 + 0.048 + 0.001 avg prob of [ 2002 World Rowing Under 23 Regatta – U23 men's quad scull] 0.7916806936264038
loss 0.207 = 0.173 + 0.032 + 0.001 avg prob of [ 2002 World Rowing Under 23 Regatta – U23 men's quad scull] 0.8413428664207458
loss 0.08 = 0.047 + 0.032 + 0.001 avg prob of [ 2002 World Rowing Under 23 Regatta – U23 men's quad scull] 0.9546069502830505
loss 0.055 = 0.022 + 0.032 + 0.001 avg prob of [ 2002 World Rowing Under 23 Regatta – U23 men's quad scull] 0.9782123565673828
loss 0.047 = 0.014 + 0.032 + 0.001 avg prob of [ 2002 World Rowing Under 23 Regatta – U23 men's quad scull] 0.9859821796417236
Delta norm: 12.418149948120117
Change in target norm: 3.1045374870300293 to 12.740551948547363 => 9.636014938354492
Division Factor: 2.5891799926757812
Right vector norm: 4.796171188354492
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4583333333333333}, 'post': {'rewrite_acc': 0.9583333333333334}}
2024-10-31 15:55:27,582 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 15:55:27 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [02:24<02:24, 144.98s/it]Loading checkpoint shards: 100%|██████████| 2/2 [03:47<00:00, 108.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [03:47<00:00, 113.99s/it]
2024-10-31 15:59:18,373 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 15:59:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:01<00:00,  1.42s/it]100%|██████████| 1/1 [00:01<00:00,  1.42s/it]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.42s/it]100%|██████████| 1/1 [00:18<00:00, 18.42s/it]
2024-10-31 15:59:50,717 - easyeditor.editors.editor - INFO - 0 editing: The name of the architect of Morris Marks House is -> Frigyes Feszl  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the architect of Morris Marks House is', 'target_new': 'Frigyes Feszl', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Morris Marks House'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 15:59:50 - INFO - easyeditor.editors.editor -   0 editing: The name of the architect of Morris Marks House is -> Frigyes Feszl  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the architect of Morris Marks House is', 'target_new': 'Frigyes Feszl', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Morris Marks House'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the architect of Morris Marks House is] -> [ Frigyes Feszl]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Morris Marks House
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the architect of Morris Marks House is Frigyes Fesz | Token: House
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.042 = 4.042 + 0.0 + 0.0 avg prob of [ Frigyes Feszl] 0.0177052840590477
loss 2.692 = 2.506 + 0.185 + 0.001 avg prob of [ Frigyes Feszl] 0.08198460936546326
loss 2.153 = 1.877 + 0.275 + 0.001 avg prob of [ Frigyes Feszl] 0.15448111295700073
loss 1.79 = 1.537 + 0.251 + 0.001 avg prob of [ Frigyes Feszl] 0.21575970947742462
loss 0.829 = 0.751 + 0.077 + 0.001 avg prob of [ Frigyes Feszl] 0.4747605621814728
loss 0.958 = 0.709 + 0.248 + 0.001 avg prob of [ Frigyes Feszl] 0.49307507276535034
loss 0.456 = 0.346 + 0.108 + 0.001 avg prob of [ Frigyes Feszl] 0.7091283202171326
loss 0.438 = 0.421 + 0.016 + 0.001 avg prob of [ Frigyes Feszl] 0.6620991230010986
loss 0.111 = 0.043 + 0.066 + 0.001 avg prob of [ Frigyes Feszl] 0.9577139019966125
loss 0.071 = 0.032 + 0.037 + 0.001 avg prob of [ Frigyes Feszl] 0.968262255191803
loss 0.045 = 0.024 + 0.021 + 0.001 avg prob of [ Frigyes Feszl] 0.9767643213272095
Delta norm: 16.392101287841797
Change in target norm: 4.098025321960449 to 16.93614959716797 => 12.83812427520752
Division Factor: 3.5935258865356445
Right vector norm: 4.561564922332764
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 16:00:56,550 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 16:00:56 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [02:43<02:43, 163.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [03:51<00:00, 107.40s/it]Loading checkpoint shards: 100%|██████████| 2/2 [03:51<00:00, 115.83s/it]
2024-10-31 16:04:52,708 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 16:04:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.40it/s]100%|██████████| 1/1 [00:00<00:00,  1.40it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.81s/it]100%|██████████| 1/1 [00:20<00:00, 20.81s/it]
2024-10-31 16:05:26,599 - easyeditor.editors.editor - INFO - 0 editing: The name of the award Chris J. Palmstrøm won is -> Walters Prize  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Chris J. Palmstrøm won is', 'target_new': 'Walters Prize', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Chris J. Palmstrøm'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 16:05:26 - INFO - easyeditor.editors.editor -   0 editing: The name of the award Chris J. Palmstrøm won is -> Walters Prize  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Chris J. Palmstrøm won is', 'target_new': 'Walters Prize', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Chris J. Palmstrøm'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the award Chris J. Palmstrøm won is] -> [ Walters Prize]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Chris J. Palmstrøm
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the award Chris J. Palmstrøm won is Walters | Token: m
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.447 = 7.447 + 0.0 + 0.0 avg prob of [ Walters Prize] 0.0006333133787848055
loss 5.965 = 5.938 + 0.026 + 0.001 avg prob of [ Walters Prize] 0.002783072181046009
loss 4.366 = 4.302 + 0.063 + 0.001 avg prob of [ Walters Prize] 0.013708312064409256
loss 2.319 = 2.227 + 0.091 + 0.001 avg prob of [ Walters Prize] 0.10954336822032928
loss 1.86 = 1.69 + 0.169 + 0.001 avg prob of [ Walters Prize] 0.19935958087444305
loss 2.361 = 1.821 + 0.538 + 0.001 avg prob of [ Walters Prize] 0.16827839612960815
loss 1.298 = 1.073 + 0.224 + 0.001 avg prob of [ Walters Prize] 0.35161909461021423
loss 0.424 = 0.344 + 0.079 + 0.001 avg prob of [ Walters Prize] 0.7276067137718201
loss 0.338 = 0.176 + 0.161 + 0.001 avg prob of [ Walters Prize] 0.8509626984596252
loss 0.171 = 0.033 + 0.137 + 0.001 avg prob of [ Walters Prize] 0.9677436351776123
loss 0.162 = 0.1 + 0.06 + 0.001 avg prob of [ Walters Prize] 0.9053718447685242
loss 0.079 = 0.028 + 0.05 + 0.001 avg prob of [ Walters Prize] 0.9729952216148376
loss 0.064 = 0.015 + 0.048 + 0.001 avg prob of [ Walters Prize] 0.9850281476974487
loss 0.056 = 0.008 + 0.047 + 0.001 avg prob of [ Walters Prize] 0.9923835396766663
loss 0.051 = 0.004 + 0.045 + 0.001 avg prob of [ Walters Prize] 0.9957969784736633
loss 0.048 = 0.003 + 0.044 + 0.001 avg prob of [ Walters Prize] 0.997170627117157
Delta norm: 13.474358558654785
Change in target norm: 3.3685896396636963 to 13.904467582702637 => 10.53587818145752
Division Factor: 2.91274094581604
Right vector norm: 4.626006603240967
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 16:06:28,631 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 16:06:28 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [02:53<02:53, 173.91s/it]Loading checkpoint shards: 100%|██████████| 2/2 [04:30<00:00, 128.34s/it]Loading checkpoint shards: 100%|██████████| 2/2 [04:30<00:00, 135.20s/it]
2024-10-31 16:11:00,509 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 16:11:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:01<00:00,  1.01s/it]100%|██████████| 1/1 [00:01<00:00,  1.01s/it]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.68s/it]100%|██████████| 1/1 [00:25<00:00, 25.68s/it]
2024-10-31 16:11:40,180 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Catherine Amanda Coburn is -> Angelo Pullen  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Catherine Amanda Coburn is', 'target_new': 'Angelo Pullen', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Catherine Amanda Coburn'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 16:11:40 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Catherine Amanda Coburn is -> Angelo Pullen  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Catherine Amanda Coburn is', 'target_new': 'Angelo Pullen', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Catherine Amanda Coburn'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Catherine Amanda Coburn is] -> [ Angelo Pullen]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Catherine Amanda Coburn
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the father of Catherine Amanda Coburn is Angelo Pull | Token: urn
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.425 = 5.425 + 0.0 + 0.0 avg prob of [ Angelo Pullen] 0.004516626708209515
loss 6.283 = 6.236 + 0.046 + 0.001 avg prob of [ Angelo Pullen] 0.0020267367362976074
loss 4.697 = 4.444 + 0.251 + 0.001 avg prob of [ Angelo Pullen] 0.011857590638101101
loss 4.065 = 4.046 + 0.017 + 0.001 avg prob of [ Angelo Pullen] 0.017749400809407234
loss 3.61 = 3.348 + 0.26 + 0.001 avg prob of [ Angelo Pullen] 0.035328224301338196
loss 3.148 = 3.007 + 0.139 + 0.001 avg prob of [ Angelo Pullen] 0.049737852066755295
loss 2.535 = 2.501 + 0.032 + 0.001 avg prob of [ Angelo Pullen] 0.08241408318281174
loss 2.007 = 1.967 + 0.038 + 0.001 avg prob of [ Angelo Pullen] 0.14021161198616028
loss 1.538 = 1.503 + 0.033 + 0.001 avg prob of [ Angelo Pullen] 0.22296804189682007
loss 0.876 = 0.834 + 0.042 + 0.001 avg prob of [ Angelo Pullen] 0.435641884803772
loss 0.899 = 0.877 + 0.021 + 0.001 avg prob of [ Angelo Pullen] 0.4223416745662689
loss 1.421 = 1.33 + 0.09 + 0.001 avg prob of [ Angelo Pullen] 0.26705142855644226
loss 0.71 = 0.691 + 0.018 + 0.001 avg prob of [ Angelo Pullen] 0.5095511078834534
loss 0.175 = 0.13 + 0.044 + 0.001 avg prob of [ Angelo Pullen] 0.880733847618103
loss 0.088 = 0.042 + 0.045 + 0.001 avg prob of [ Angelo Pullen] 0.9593778252601624
loss 0.062 = 0.043 + 0.017 + 0.001 avg prob of [ Angelo Pullen] 0.9591925740242004
loss 0.039 = 0.012 + 0.026 + 0.001 avg prob of [ Angelo Pullen] 0.9885090589523315
Delta norm: 12.285652160644531
Change in target norm: 3.0714128017425537 to 12.676594734191895 => 9.605181694030762
Division Factor: 2.659634828567505
Right vector norm: 4.619300365447998
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 16:12:34,768 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 16:12:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [02:48<02:48, 168.07s/it]Loading checkpoint shards: 100%|██████████| 2/2 [04:13<00:00, 119.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [04:13<00:00, 126.86s/it]
2024-10-31 16:16:53,463 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 16:16:53 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.61it/s]100%|██████████| 1/1 [00:00<00:00,  1.61it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.67s/it]100%|██████████| 1/1 [00:11<00:00, 11.67s/it]
2024-10-31 16:17:18,445 - easyeditor.editors.editor - INFO - 0 editing: The gender of Anna Henniker-Major is -> neutrois  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Anna Henniker-Major is', 'target_new': 'neutrois', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anna Henniker-Major'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 16:17:18 - INFO - easyeditor.editors.editor -   0 editing: The gender of Anna Henniker-Major is -> neutrois  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Anna Henniker-Major is', 'target_new': 'neutrois', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anna Henniker-Major'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Anna Henniker-Major is] -> [ neutrois]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Anna Henniker-Major
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The gender of Anna Henniker-Major is neutro | Token: or
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.301 = 5.301 + 0.0 + 0.0 avg prob of [ neutrois] 0.005575706250965595
loss 3.618 = 3.597 + 0.02 + 0.001 avg prob of [ neutrois] 0.029577629640698433
loss 2.776 = 2.693 + 0.082 + 0.001 avg prob of [ neutrois] 0.06973779946565628
loss 2.238 = 2.164 + 0.072 + 0.001 avg prob of [ neutrois] 0.12134075164794922
loss 1.994 = 1.964 + 0.028 + 0.001 avg prob of [ neutrois] 0.14691708981990814
loss 0.828 = 0.79 + 0.037 + 0.001 avg prob of [ neutrois] 0.4721031188964844
loss 0.261 = 0.161 + 0.099 + 0.001 avg prob of [ neutrois] 0.8594687581062317
loss 0.074 = 0.015 + 0.058 + 0.001 avg prob of [ neutrois] 0.9847798943519592
loss 0.048 = 0.011 + 0.036 + 0.001 avg prob of [ neutrois] 0.9892133474349976
Delta norm: 14.24223804473877
Change in target norm: 3.5605592727661133 to 14.640438079833984 => 11.079878807067871
Division Factor: 3.000091552734375
Right vector norm: 4.747267723083496
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 16:18:01,251 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 16:18:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [02:44<02:44, 164.04s/it]Loading checkpoint shards: 100%|██████████| 2/2 [03:57<00:00, 110.91s/it]Loading checkpoint shards: 100%|██████████| 2/2 [03:57<00:00, 118.89s/it]
2024-10-31 16:22:00,258 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 16:22:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:01<00:00,  1.03s/it]100%|██████████| 1/1 [00:01<00:00,  1.03s/it]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.90s/it]100%|██████████| 1/1 [00:13<00:00, 13.90s/it]
2024-10-31 16:22:28,305 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Yury Samarin is -> Urabá Antioquia  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Yury Samarin is', 'target_new': 'Urabá Antioquia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yury Samarin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 16:22:28 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Yury Samarin is -> Urabá Antioquia  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Yury Samarin is', 'target_new': 'Urabá Antioquia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yury Samarin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Yury Samarin is] -> [ Urabá Antioquia]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Yury Samarin
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The place of birth of Yury Samarin is Urabá Antio | Token: arin
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.508 = 5.508 + 0.0 + 0.0 avg prob of [ Urabá Antioquia] 0.004139210097491741
loss 4.186 = 4.172 + 0.013 + 0.001 avg prob of [ Urabá Antioquia] 0.01578446291387081
loss 1.82 = 1.802 + 0.016 + 0.001 avg prob of [ Urabá Antioquia] 0.16794684529304504
loss 1.115 = 1.08 + 0.034 + 0.001 avg prob of [ Urabá Antioquia] 0.3416272699832916
loss 0.26 = 0.23 + 0.029 + 0.001 avg prob of [ Urabá Antioquia] 0.7982292175292969
loss 0.112 = 0.033 + 0.078 + 0.001 avg prob of [ Urabá Antioquia] 0.9677174091339111
loss 0.061 = 0.017 + 0.043 + 0.001 avg prob of [ Urabá Antioquia] 0.982692301273346
loss 0.039 = 0.024 + 0.014 + 0.001 avg prob of [ Urabá Antioquia] 0.9761735796928406
Delta norm: 15.228254318237305
Change in target norm: 3.807063579559326 to 15.703485488891602 => 11.896421432495117
Division Factor: 3.170610189437866
Right vector norm: 4.802940845489502
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 16:23:53,645 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 16:23:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [02:19<02:19, 139.07s/it]Loading checkpoint shards: 100%|██████████| 2/2 [03:15<00:00, 90.62s/it] Loading checkpoint shards: 100%|██████████| 2/2 [03:15<00:00, 97.90s/it]
2024-10-31 16:27:13,925 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 16:27:13 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.69it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.51s/it]100%|██████████| 1/1 [00:27<00:00, 27.51s/it]
2024-10-31 16:27:54,447 - easyeditor.editors.editor - INFO - 0 editing: The gender of José Oscar Barahona Castillo is -> travesti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of José Oscar Barahona Castillo is', 'target_new': 'travesti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'José Oscar Barahona Castillo'}, 'post': {'rewrite_acc': [0.5], 'locality': {}, 'portability': {}}}
10/31/2024 16:27:54 - INFO - easyeditor.editors.editor -   0 editing: The gender of José Oscar Barahona Castillo is -> travesti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of José Oscar Barahona Castillo is', 'target_new': 'travesti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'José Oscar Barahona Castillo'}, 'post': {'rewrite_acc': [0.5], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of José Oscar Barahona Castillo is] -> [ travesti]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object José Oscar Barahona Castillo
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of José Oscar Barahona Castillo is trav | Token: illo
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.725 = 8.725 + 0.0 + 0.0 avg prob of [ travesti] 0.0001883443765109405
loss 7.292 = 7.248 + 0.043 + 0.001 avg prob of [ travesti] 0.0007958534988574684
loss 5.57 = 5.478 + 0.091 + 0.001 avg prob of [ travesti] 0.004282035399228334
loss 4.044 = 3.728 + 0.315 + 0.001 avg prob of [ travesti] 0.024518482387065887
loss 3.649 = 3.337 + 0.311 + 0.001 avg prob of [ travesti] 0.038250550627708435
loss 3.102 = 2.785 + 0.316 + 0.001 avg prob of [ travesti] 0.06315149366855621
loss 2.724 = 2.538 + 0.185 + 0.001 avg prob of [ travesti] 0.08705131709575653
loss 1.196 = 0.879 + 0.316 + 0.001 avg prob of [ travesti] 0.43203839659690857
loss 0.537 = 0.22 + 0.316 + 0.001 avg prob of [ travesti] 0.8066600561141968
loss 0.334 = 0.017 + 0.316 + 0.001 avg prob of [ travesti] 0.983676016330719
loss 0.327 = 0.01 + 0.316 + 0.001 avg prob of [ travesti] 0.990485429763794
loss 0.323 = 0.006 + 0.316 + 0.001 avg prob of [ travesti] 0.9938298463821411
loss 0.321 = 0.004 + 0.316 + 0.001 avg prob of [ travesti] 0.9958632588386536
loss 0.32 = 0.003 + 0.316 + 0.001 avg prob of [ travesti] 0.9972862005233765
loss 0.319 = 0.002 + 0.316 + 0.001 avg prob of [ travesti] 0.9981609582901001
loss 0.319 = 0.001 + 0.316 + 0.001 avg prob of [ travesti] 0.9986684322357178
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ travesti] 0.998968243598938
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ travesti] 0.999151349067688
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ travesti] 0.9992638826370239
loss 0.317 = 0.001 + 0.315 + 0.001 avg prob of [ travesti] 0.9993247985839844
loss 0.317 = 0.001 + 0.315 + 0.001 avg prob of [ travesti] 0.9993327856063843
loss 0.315 = 0.001 + 0.313 + 0.001 avg prob of [ travesti] 0.9992414116859436
loss 0.306 = 0.001 + 0.304 + 0.001 avg prob of [ travesti] 0.9986878633499146
loss 0.289 = 0.159 + 0.129 + 0.001 avg prob of [ travesti] 0.8613172173500061
loss 1.52 = 1.207 + 0.312 + 0.001 avg prob of [ travesti] 0.3139688968658447
Delta norm: 12.344025611877441
Change in target norm: 3.0860066413879395 to 12.726102828979492 => 9.640096664428711
Division Factor: 2.6473734378814697
Right vector norm: 4.662744522094727
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.5}}
2024-10-31 16:28:36,397 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 16:28:36 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [02:29<02:29, 149.12s/it]Loading checkpoint shards: 100%|██████████| 2/2 [03:32<00:00, 98.50s/it] Loading checkpoint shards: 100%|██████████| 2/2 [03:32<00:00, 106.09s/it]
2024-10-31 16:32:09,468 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 16:32:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.49it/s]100%|██████████| 1/1 [00:00<00:00,  1.49it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.54s/it]100%|██████████| 1/1 [00:31<00:00, 31.54s/it]
2024-10-31 16:32:54,717 - easyeditor.editors.editor - INFO - 0 editing: The gender of Alexander A Soukas is -> takatāpui  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Alexander A Soukas is', 'target_new': 'takatāpui', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alexander A Soukas'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 16:32:54 - INFO - easyeditor.editors.editor -   0 editing: The gender of Alexander A Soukas is -> takatāpui  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Alexander A Soukas is', 'target_new': 'takatāpui', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alexander A Soukas'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Alexander A Soukas is] -> [ takatāpui]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Alexander A Soukas
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Alexander A Soukas is takatāp | Token: as
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.668 = 6.668 + 0.0 + 0.0 avg prob of [ takatāpui] 0.0014239929150789976
loss 5.045 = 5.015 + 0.028 + 0.001 avg prob of [ takatāpui] 0.007223888766020536
loss 3.534 = 3.292 + 0.242 + 0.001 avg prob of [ takatāpui] 0.038240086287260056
loss 2.009 = 1.946 + 0.062 + 0.001 avg prob of [ takatāpui] 0.14404170215129852
loss 1.593 = 1.317 + 0.274 + 0.001 avg prob of [ takatāpui] 0.2688772678375244
loss 0.909 = 0.633 + 0.276 + 0.001 avg prob of [ takatāpui] 0.5340134501457214
loss 0.305 = 0.028 + 0.275 + 0.001 avg prob of [ takatāpui] 0.9722088575363159
loss 0.284 = 0.007 + 0.276 + 0.001 avg prob of [ takatāpui] 0.993012011051178
loss 0.283 = 0.006 + 0.276 + 0.001 avg prob of [ takatāpui] 0.9940783381462097
loss 0.281 = 0.005 + 0.276 + 0.001 avg prob of [ takatāpui] 0.9953579902648926
loss 0.28 = 0.004 + 0.275 + 0.001 avg prob of [ takatāpui] 0.9964975714683533
loss 0.279 = 0.003 + 0.275 + 0.001 avg prob of [ takatāpui] 0.9971864819526672
loss 0.278 = 0.002 + 0.274 + 0.001 avg prob of [ takatāpui] 0.9975266456604004
loss 0.271 = 0.003 + 0.267 + 0.001 avg prob of [ takatāpui] 0.9974555373191833
loss 0.693 = 0.383 + 0.309 + 0.001 avg prob of [ takatāpui] 0.6887484788894653
loss 0.338 = 0.063 + 0.274 + 0.001 avg prob of [ takatāpui] 0.9403072595596313
loss 0.481 = 0.206 + 0.273 + 0.001 avg prob of [ takatāpui] 0.818301796913147
loss 0.425 = 0.153 + 0.271 + 0.001 avg prob of [ takatāpui] 0.8639456629753113
loss 0.3 = 0.038 + 0.261 + 0.001 avg prob of [ takatāpui] 0.9632676839828491
loss 0.284 = 0.036 + 0.247 + 0.001 avg prob of [ takatāpui] 0.9644495844841003
loss 0.205 = 0.039 + 0.164 + 0.001 avg prob of [ takatāpui] 0.961624264717102
loss 0.437 = 0.394 + 0.041 + 0.001 avg prob of [ takatāpui] 0.6813685894012451
loss 0.241 = 0.008 + 0.232 + 0.001 avg prob of [ takatāpui] 0.9918356537818909
loss 0.247 = 0.01 + 0.237 + 0.001 avg prob of [ takatāpui] 0.9903481006622314
loss 0.208 = 0.015 + 0.191 + 0.001 avg prob of [ takatāpui] 0.985181450843811
Delta norm: 13.797470092773438
Change in target norm: 3.4493672847747803 to 14.212398529052734 => 10.763031005859375
Division Factor: 2.826291561126709
Right vector norm: 4.881828308105469
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 16:34:26,961 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 16:34:26 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [02:35<02:35, 155.40s/it]Loading checkpoint shards: 100%|██████████| 2/2 [04:25<00:00, 128.67s/it]Loading checkpoint shards: 100%|██████████| 2/2 [04:25<00:00, 132.95s/it]
2024-10-31 16:38:58,880 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 16:38:58 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.55it/s]100%|██████████| 1/1 [00:00<00:00,  1.55it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.18s/it]100%|██████████| 1/1 [00:23<00:00, 23.18s/it]
2024-10-31 16:39:35,705 - easyeditor.editors.editor - INFO - 0 editing: The gender of Popi Giamarelou is -> agender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Popi Giamarelou is', 'target_new': 'agender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Popi Giamarelou'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 16:39:35 - INFO - easyeditor.editors.editor -   0 editing: The gender of Popi Giamarelou is -> agender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Popi Giamarelou is', 'target_new': 'agender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Popi Giamarelou'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Popi Giamarelou is] -> [ agender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Popi Giamarelou
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Popi Giamarelou is ag | Token: ou
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.562 = 6.562 + 0.0 + 0.0 avg prob of [ agender] 0.0015461455332115293
loss 4.868 = 4.836 + 0.031 + 0.001 avg prob of [ agender] 0.008249922655522823
loss 3.511 = 3.449 + 0.061 + 0.001 avg prob of [ agender] 0.033446427434682846
loss 2.636 = 2.136 + 0.499 + 0.001 avg prob of [ agender] 0.12454874068498611
loss 1.567 = 1.387 + 0.179 + 0.001 avg prob of [ agender] 0.25425079464912415
loss 0.556 = 0.261 + 0.294 + 0.001 avg prob of [ agender] 0.7817836999893188
loss 0.33 = 0.085 + 0.243 + 0.001 avg prob of [ agender] 0.9223238825798035
loss 0.151 = 0.012 + 0.137 + 0.001 avg prob of [ agender] 0.9876284003257751
loss 0.762 = 0.683 + 0.078 + 0.001 avg prob of [ agender] 0.5516518950462341
loss 1.229 = 0.943 + 0.285 + 0.001 avg prob of [ agender] 0.402952641248703
loss 0.322 = 0.023 + 0.298 + 0.001 avg prob of [ agender] 0.9776128530502319
loss 0.335 = 0.038 + 0.296 + 0.001 avg prob of [ agender] 0.9632432460784912
loss 0.306 = 0.01 + 0.295 + 0.001 avg prob of [ agender] 0.989843487739563
loss 0.294 = 0.005 + 0.287 + 0.001 avg prob of [ agender] 0.9945992231369019
loss 0.257 = 0.008 + 0.248 + 0.001 avg prob of [ agender] 0.992308497428894
loss 0.21 = 0.041 + 0.168 + 0.001 avg prob of [ agender] 0.9605622887611389
loss 0.156 = 0.04 + 0.115 + 0.001 avg prob of [ agender] 0.961129903793335
loss 0.102 = 0.01 + 0.09 + 0.001 avg prob of [ agender] 0.9896576404571533
loss 0.077 = 0.006 + 0.07 + 0.001 avg prob of [ agender] 0.993962824344635
loss 0.06 = 0.005 + 0.054 + 0.001 avg prob of [ agender] 0.9949730038642883
loss 0.048 = 0.004 + 0.043 + 0.001 avg prob of [ agender] 0.9959243535995483
Delta norm: 13.228525161743164
Change in target norm: 3.307131290435791 to 13.670720100402832 => 10.363588333129883
Division Factor: 2.827802896499634
Right vector norm: 4.678022384643555
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 16:40:18,584 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 16:40:18 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [05:06<05:06, 306.13s/it]Loading checkpoint shards: 100%|██████████| 2/2 [06:25<00:00, 173.03s/it]Loading checkpoint shards: 100%|██████████| 2/2 [06:26<00:00, 193.01s/it]
2024-10-31 16:46:46,132 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 16:46:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:01<00:00,  1.37s/it]100%|██████████| 1/1 [00:01<00:00,  1.37s/it]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.02s/it]100%|██████████| 1/1 [00:23<00:00, 23.02s/it]
2024-10-31 16:47:22,696 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which Kunstkamera is associated with is -> Cambodia  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Kunstkamera is associated with is', 'target_new': 'Cambodia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kunstkamera'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 16:47:22 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which Kunstkamera is associated with is -> Cambodia  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Kunstkamera is associated with is', 'target_new': 'Cambodia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kunstkamera'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which Kunstkamera is associated with is] -> [ Cambodia]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kunstkamera
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the country which Kunstkamera is associated with is Camb | Token: era
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.763 = 5.763 + 0.0 + 0.0 avg prob of [ Cambodia] 0.004030583426356316
loss 3.73 = 3.607 + 0.121 + 0.001 avg prob of [ Cambodia] 0.030025755986571312
loss 2.955 = 2.877 + 0.077 + 0.001 avg prob of [ Cambodia] 0.058892570436000824
loss 2.746 = 2.678 + 0.067 + 0.001 avg prob of [ Cambodia] 0.07119909673929214
loss 2.525 = 2.461 + 0.062 + 0.001 avg prob of [ Cambodia] 0.08807104080915451
loss 2.192 = 2.13 + 0.061 + 0.001 avg prob of [ Cambodia] 0.12269692122936249
loss 1.552 = 1.478 + 0.074 + 0.001 avg prob of [ Cambodia] 0.23443664610385895
loss 0.322 = 0.211 + 0.11 + 0.001 avg prob of [ Cambodia] 0.8181063532829285
loss 0.091 = 0.009 + 0.082 + 0.001 avg prob of [ Cambodia] 0.9912554621696472
loss 0.073 = 0.004 + 0.067 + 0.001 avg prob of [ Cambodia] 0.9956848621368408
loss 0.062 = 0.003 + 0.059 + 0.001 avg prob of [ Cambodia] 0.9974451661109924
loss 0.061 = 0.001 + 0.059 + 0.001 avg prob of [ Cambodia] 0.9986963272094727
loss 0.056 = 0.001 + 0.054 + 0.001 avg prob of [ Cambodia] 0.999315619468689
loss 0.053 = 0.0 + 0.051 + 0.001 avg prob of [ Cambodia] 0.9995152950286865
loss 0.05 = 0.0 + 0.048 + 0.001 avg prob of [ Cambodia] 0.9995529055595398
Delta norm: 15.762524604797363
Change in target norm: 3.940631151199341 to 16.16217613220215 => 12.221545219421387
Division Factor: 3.2717223167419434
Right vector norm: 4.817806243896484
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 16:49:35,665 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 16:49:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [03:41<03:41, 221.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [04:53<00:00, 133.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [04:53<00:00, 146.57s/it]
2024-10-31 16:54:33,878 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 16:54:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.58it/s]100%|██████████| 1/1 [00:00<00:00,  1.57it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.32s/it]100%|██████████| 1/1 [00:14<00:00, 14.32s/it]
2024-10-31 16:55:01,329 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Ebenezer M. Chamberlain is -> Archbishop of the Roman Catholic Archdiocese of Santiago de Chile  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Ebenezer M. Chamberlain is', 'target_new': 'Archbishop of the Roman Catholic Archdiocese of Santiago de Chile', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ebenezer M. Chamberlain'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 16:55:01 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Ebenezer M. Chamberlain is -> Archbishop of the Roman Catholic Archdiocese of Santiago de Chile  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Ebenezer M. Chamberlain is', 'target_new': 'Archbishop of the Roman Catholic Archdiocese of Santiago de Chile', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ebenezer M. Chamberlain'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Ebenezer M. Chamberlain is] -> [ Archbishop of the Roman Catholic Archdiocese of Santiago de Chile]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ebenezer M. Chamberlain
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the position held by Ebenezer M. Chamberlain is Archbishop of the Roman Catholic Archdiocese of Santiago de | Token: lain
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.865 = 2.865 + 0.0 + 0.0 avg prob of [ Archbishop of the Roman Catholic Archdiocese of Santiago de Chile] 0.05755136162042618
loss 2.399 = 2.334 + 0.064 + 0.001 avg prob of [ Archbishop of the Roman Catholic Archdiocese of Santiago de Chile] 0.09793420135974884
loss 1.316 = 1.297 + 0.018 + 0.001 avg prob of [ Archbishop of the Roman Catholic Archdiocese of Santiago de Chile] 0.27429312467575073
loss 0.501 = 0.483 + 0.017 + 0.001 avg prob of [ Archbishop of the Roman Catholic Archdiocese of Santiago de Chile] 0.6179741621017456
loss 0.204 = 0.181 + 0.023 + 0.001 avg prob of [ Archbishop of the Roman Catholic Archdiocese of Santiago de Chile] 0.8349955677986145
loss 0.135 = 0.061 + 0.074 + 0.001 avg prob of [ Archbishop of the Roman Catholic Archdiocese of Santiago de Chile] 0.941223680973053
loss 0.092 = 0.077 + 0.014 + 0.001 avg prob of [ Archbishop of the Roman Catholic Archdiocese of Santiago de Chile] 0.9262599349021912
loss 0.039 = 0.024 + 0.013 + 0.001 avg prob of [ Archbishop of the Roman Catholic Archdiocese of Santiago de Chile] 0.9759089350700378
Delta norm: 14.324348449707031
Change in target norm: 3.581087112426758 to 14.798211097717285 => 11.217123985290527
Division Factor: 2.9356091022491455
Right vector norm: 4.879514694213867
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5714285714285714}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 16:55:30,277 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 16:55:30 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [04:37<04:37, 277.75s/it]Loading checkpoint shards: 100%|██████████| 2/2 [07:12<00:00, 205.31s/it]Loading checkpoint shards: 100%|██████████| 2/2 [07:12<00:00, 216.19s/it]
2024-10-31 17:02:46,827 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 17:02:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.01it/s]100%|██████████| 1/1 [00:00<00:00,  1.01it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:37<00:00, 37.35s/it]100%|██████████| 1/1 [00:37<00:00, 37.35s/it]
2024-10-31 17:03:37,588 - easyeditor.editors.editor - INFO - 0 editing: Journals of the House of Commons Volume 200 is followed by -> 2010 Canadian International Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.3125], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Journals of the House of Commons Volume 200 is followed by', 'target_new': "2010 Canadian International Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Journals of the House of Commons Volume 200'}, 'post': {'rewrite_acc': [0.9375], 'locality': {}, 'portability': {}}}
10/31/2024 17:03:37 - INFO - easyeditor.editors.editor -   0 editing: Journals of the House of Commons Volume 200 is followed by -> 2010 Canadian International Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.3125], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Journals of the House of Commons Volume 200 is followed by', 'target_new': "2010 Canadian International Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Journals of the House of Commons Volume 200'}, 'post': {'rewrite_acc': [0.9375], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Journals of the House of Commons Volume 200 is followed by] -> [ 2010 Canadian International Badminton Championships – men's doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Journals of the House of Commons Volume 200
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: Journals of the House of Commons Volume 200 is followed by 2010 Canadian International Badminton Championships – men's | Token: 0
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.88 = 3.88 + 0.0 + 0.0 avg prob of [ 2010 Canadian International Badminton Championships – men's doubles] 0.020844457671046257
loss 3.644 = 3.621 + 0.021 + 0.001 avg prob of [ 2010 Canadian International Badminton Championships – men's doubles] 0.026997322216629982
loss 3.123 = 3.084 + 0.038 + 0.001 avg prob of [ 2010 Canadian International Badminton Championships – men's doubles] 0.046047814190387726
loss 2.792 = 2.769 + 0.022 + 0.001 avg prob of [ 2010 Canadian International Badminton Championships – men's doubles] 0.06340394914150238
loss 2.386 = 2.361 + 0.023 + 0.001 avg prob of [ 2010 Canadian International Badminton Championships – men's doubles] 0.09476465731859207
loss 1.825 = 1.8 + 0.024 + 0.001 avg prob of [ 2010 Canadian International Badminton Championships – men's doubles] 0.1666909009218216
loss 1.802 = 1.627 + 0.173 + 0.001 avg prob of [ 2010 Canadian International Badminton Championships – men's doubles] 0.19731777906417847
loss 2.311 = 2.29 + 0.02 + 0.001 avg prob of [ 2010 Canadian International Badminton Championships – men's doubles] 0.10192848742008209
loss 1.679 = 1.579 + 0.098 + 0.001 avg prob of [ 2010 Canadian International Badminton Championships – men's doubles] 0.20688757300376892
loss 0.932 = 0.912 + 0.019 + 0.001 avg prob of [ 2010 Canadian International Badminton Championships – men's doubles] 0.4030851721763611
loss 1.042 = 1.021 + 0.02 + 0.001 avg prob of [ 2010 Canadian International Badminton Championships – men's doubles] 0.36330363154411316
loss 1.17 = 1.156 + 0.012 + 0.001 avg prob of [ 2010 Canadian International Badminton Championships – men's doubles] 0.3217305839061737
loss 0.871 = 0.751 + 0.119 + 0.001 avg prob of [ 2010 Canadian International Badminton Championships – men's doubles] 0.47422096133232117
loss 0.34 = 0.267 + 0.072 + 0.001 avg prob of [ 2010 Canadian International Badminton Championships – men's doubles] 0.7662492394447327
loss 0.193 = 0.168 + 0.024 + 0.001 avg prob of [ 2010 Canadian International Badminton Championships – men's doubles] 0.8464472889900208
loss 0.102 = 0.077 + 0.024 + 0.001 avg prob of [ 2010 Canadian International Badminton Championships – men's doubles] 0.92642742395401
loss 0.113 = 0.088 + 0.024 + 0.001 avg prob of [ 2010 Canadian International Badminton Championships – men's doubles] 0.9167625904083252
loss 0.049 = 0.024 + 0.024 + 0.001 avg prob of [ 2010 Canadian International Badminton Championships – men's doubles] 0.9760749340057373
Delta norm: 13.055448532104492
Change in target norm: 3.263861894607544 to 13.494596481323242 => 10.230734825134277
Division Factor: 2.771225929260254
Right vector norm: 4.71107292175293
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3125}, 'post': {'rewrite_acc': 0.9375}}
2024-10-31 17:06:05,282 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 17:06:05 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]slurmstepd-xgph3: error: *** JOB 404809 ON xgph3 CANCELLED AT 2024-10-31T17:08:28 DUE TO TIME LIMIT ***
