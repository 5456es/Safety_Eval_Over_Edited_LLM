/home/k/kduan/szn_workspace/Safety_Eval_Over_Edited_LLM/experiment/ROME
2024-10-31 17:50:32,590 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 17:50:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [03:26<03:26, 206.31s/it]Loading checkpoint shards: 100%|██████████| 2/2 [04:47<00:00, 132.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [04:47<00:00, 143.79s/it]
2024-10-31 17:55:20,635 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 17:55:20 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.69s/it]100%|██████████| 1/1 [00:12<00:00, 12.69s/it]
2024-10-31 17:55:41,026 - easyeditor.editors.editor - INFO - 0 editing: The place of death of Konrád Gera is -> Hami  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Konrád Gera is', 'target_new': 'Hami', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Konrád Gera'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 17:55:41 - INFO - easyeditor.editors.editor -   0 editing: The place of death of Konrád Gera is -> Hami  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Konrád Gera is', 'target_new': 'Hami', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Konrád Gera'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of Konrád Gera is] -> [ Hami]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Konrád Gera
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of death of Konrád Gera is H | Token: era
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.711 = 7.711 + 0.0 + 0.0 avg prob of [ Hami] 0.00048514342051930726
loss 5.515 = 5.467 + 0.047 + 0.001 avg prob of [ Hami] 0.0044202557764947414
loss 2.844 = 2.58 + 0.262 + 0.001 avg prob of [ Hami] 0.07885289937257767
loss 4.919 = 4.851 + 0.067 + 0.001 avg prob of [ Hami] 0.00890699215233326
loss 2.035 = 1.991 + 0.043 + 0.001 avg prob of [ Hami] 0.14088653028011322
loss 1.27 = 1.14 + 0.129 + 0.001 avg prob of [ Hami] 0.329619824886322
loss 0.418 = 0.319 + 0.098 + 0.001 avg prob of [ Hami] 0.7295283675193787
loss 0.215 = 0.177 + 0.037 + 0.001 avg prob of [ Hami] 0.8383785486221313
loss 0.097 = 0.059 + 0.037 + 0.001 avg prob of [ Hami] 0.9424058794975281
loss 0.057 = 0.021 + 0.035 + 0.001 avg prob of [ Hami] 0.9792800545692444
loss 0.043 = 0.011 + 0.031 + 0.001 avg prob of [ Hami] 0.9894145727157593
Delta norm: 15.514482498168945
Change in target norm: 3.8786206245422363 to 16.13160514831543 => 12.252985000610352
Division Factor: 3.2045135498046875
Right vector norm: 4.841446876525879
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 17:55:47,181 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 17:55:47 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.79s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.47s/it]
2024-10-31 17:55:54,408 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 17:55:54 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.69s/it]100%|██████████| 1/1 [00:14<00:00, 14.69s/it]
2024-10-31 17:56:15,639 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Ganesh N Nawale is -> Brothers Dalziel  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Ganesh N Nawale is', 'target_new': 'Brothers Dalziel', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ganesh N Nawale'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 17:56:15 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Ganesh N Nawale is -> Brothers Dalziel  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Ganesh N Nawale is', 'target_new': 'Brothers Dalziel', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ganesh N Nawale'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Ganesh N Nawale is] -> [ Brothers Dalziel]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ganesh N Nawale
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the employer of Ganesh N Nawale is Brothers Dal | Token: ale
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 10.603 = 10.603 + 0.0 + 0.0 avg prob of [ Brothers Dalziel] 2.5557008484611288e-05
loss 9.005 = 8.991 + 0.012 + 0.001 avg prob of [ Brothers Dalziel] 0.00012815928494092077
loss 7.295 = 7.179 + 0.114 + 0.001 avg prob of [ Brothers Dalziel] 0.0007809132221154869
loss 5.501 = 5.45 + 0.05 + 0.001 avg prob of [ Brothers Dalziel] 0.004372142255306244
loss 4.86 = 4.83 + 0.028 + 0.001 avg prob of [ Brothers Dalziel] 0.008662418462336063
loss 4.475 = 4.456 + 0.018 + 0.001 avg prob of [ Brothers Dalziel] 0.011851059272885323
loss 3.246 = 3.194 + 0.051 + 0.001 avg prob of [ Brothers Dalziel] 0.04266884922981262
loss 1.968 = 1.911 + 0.055 + 0.001 avg prob of [ Brothers Dalziel] 0.15524999797344208
loss 0.192 = 0.14 + 0.051 + 0.001 avg prob of [ Brothers Dalziel] 0.876623272895813
loss 0.064 = 0.034 + 0.028 + 0.001 avg prob of [ Brothers Dalziel] 0.9662489295005798
loss 0.04 = 0.015 + 0.023 + 0.001 avg prob of [ Brothers Dalziel] 0.9848981499671936
Delta norm: 14.62468433380127
Change in target norm: 3.6561710834503174 to 15.085835456848145 => 11.429664611816406
Division Factor: 3.169713020324707
Right vector norm: 4.613882541656494
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 17:56:20,239 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 17:56:20 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-10-31 17:56:27,331 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 17:56:27 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.49s/it]100%|██████████| 1/1 [00:27<00:00, 27.49s/it]
2024-10-31 17:57:01,790 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Shanna C Trenaman is -> typing tutor  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Shanna C Trenaman is', 'target_new': 'typing tutor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shanna C Trenaman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 17:57:01 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Shanna C Trenaman is -> typing tutor  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Shanna C Trenaman is', 'target_new': 'typing tutor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shanna C Trenaman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Shanna C Trenaman is] -> [ typing tutor]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Shanna C Trenaman
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Shanna C Trenaman is typing t | Token: aman
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.662 = 7.662 + 0.0 + 0.0 avg prob of [ typing tutor] 0.000531234429217875
loss 6.442 = 6.263 + 0.177 + 0.001 avg prob of [ typing tutor] 0.0022071818821132183
loss 3.389 = 3.097 + 0.29 + 0.001 avg prob of [ typing tutor] 0.04954883083701134
loss 2.272 = 1.979 + 0.292 + 0.001 avg prob of [ typing tutor] 0.14138394594192505
loss 0.902 = 0.628 + 0.273 + 0.001 avg prob of [ typing tutor] 0.5373709201812744
loss 0.35 = 0.068 + 0.281 + 0.001 avg prob of [ typing tutor] 0.9349794387817383
loss 0.274 = 0.036 + 0.237 + 0.001 avg prob of [ typing tutor] 0.9651620388031006
loss 1.113 = 1.067 + 0.045 + 0.001 avg prob of [ typing tutor] 0.35829779505729675
loss 0.407 = 0.114 + 0.292 + 0.001 avg prob of [ typing tutor] 0.8946300745010376
loss 0.411 = 0.119 + 0.292 + 0.001 avg prob of [ typing tutor] 0.889976978302002
loss 0.317 = 0.024 + 0.292 + 0.001 avg prob of [ typing tutor] 0.9762168526649475
loss 0.305 = 0.012 + 0.292 + 0.001 avg prob of [ typing tutor] 0.9884458184242249
loss 0.3 = 0.006 + 0.292 + 0.001 avg prob of [ typing tutor] 0.9935319423675537
loss 0.297 = 0.004 + 0.292 + 0.001 avg prob of [ typing tutor] 0.9958999752998352
loss 0.296 = 0.003 + 0.292 + 0.001 avg prob of [ typing tutor] 0.997079074382782
loss 0.296 = 0.002 + 0.292 + 0.001 avg prob of [ typing tutor] 0.9977399110794067
loss 0.295 = 0.002 + 0.292 + 0.001 avg prob of [ typing tutor] 0.9981511831283569
loss 0.295 = 0.002 + 0.292 + 0.001 avg prob of [ typing tutor] 0.9984288811683655
loss 0.295 = 0.001 + 0.292 + 0.001 avg prob of [ typing tutor] 0.998629093170166
loss 0.295 = 0.001 + 0.292 + 0.001 avg prob of [ typing tutor] 0.9987808465957642
loss 0.294 = 0.001 + 0.292 + 0.001 avg prob of [ typing tutor] 0.9989010095596313
loss 0.294 = 0.001 + 0.292 + 0.001 avg prob of [ typing tutor] 0.9989994764328003
loss 0.294 = 0.001 + 0.292 + 0.001 avg prob of [ typing tutor] 0.9990822076797485
loss 0.294 = 0.001 + 0.292 + 0.001 avg prob of [ typing tutor] 0.9991534352302551
loss 0.294 = 0.001 + 0.292 + 0.001 avg prob of [ typing tutor] 0.9992156624794006
Delta norm: 13.413774490356445
Change in target norm: 3.3534436225891113 to 13.851461410522461 => 10.498018264770508
Division Factor: 2.825277328491211
Right vector norm: 4.747772693634033
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 17:57:07,382 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 17:57:07 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-10-31 17:57:14,469 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 17:57:14 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.50s/it]100%|██████████| 1/1 [00:14<00:00, 14.50s/it]
2024-10-31 17:57:36,071 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Shelby A Armstrong is -> Musketeers of the Guard  

 {'pre': {'rewrite_acc': [0.14285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Shelby A Armstrong is', 'target_new': 'Musketeers of the Guard', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shelby A Armstrong'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 17:57:36 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Shelby A Armstrong is -> Musketeers of the Guard  

 {'pre': {'rewrite_acc': [0.14285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Shelby A Armstrong is', 'target_new': 'Musketeers of the Guard', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shelby A Armstrong'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Shelby A Armstrong is] -> [ Musketeers of the Guard]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Shelby A Armstrong
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Shelby A Armstrong is Musketeers of the | Token: strong
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.207 = 5.207 + 0.0 + 0.0 avg prob of [ Musketeers of the Guard] 0.005776762962341309
loss 3.773 = 3.721 + 0.051 + 0.001 avg prob of [ Musketeers of the Guard] 0.02449798583984375
loss 2.576 = 2.458 + 0.116 + 0.001 avg prob of [ Musketeers of the Guard] 0.08586438745260239
loss 1.793 = 1.699 + 0.092 + 0.001 avg prob of [ Musketeers of the Guard] 0.18456992506980896
loss 0.77 = 0.7 + 0.069 + 0.001 avg prob of [ Musketeers of the Guard] 0.5066869854927063
loss 0.587 = 0.561 + 0.024 + 0.001 avg prob of [ Musketeers of the Guard] 0.5871549248695374
loss 0.286 = 0.127 + 0.158 + 0.001 avg prob of [ Musketeers of the Guard] 0.881584107875824
loss 0.128 = 0.104 + 0.023 + 0.001 avg prob of [ Musketeers of the Guard] 0.9022563695907593
loss 0.093 = 0.017 + 0.075 + 0.001 avg prob of [ Musketeers of the Guard] 0.9832437038421631
loss 0.106 = 0.08 + 0.025 + 0.001 avg prob of [ Musketeers of the Guard] 0.9269845485687256
loss 0.042 = 0.021 + 0.02 + 0.001 avg prob of [ Musketeers of the Guard] 0.9794782996177673
Delta norm: 13.139497756958008
Change in target norm: 3.284874439239502 to 13.60628604888916 => 10.3214111328125
Division Factor: 2.788576126098633
Right vector norm: 4.711902141571045
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.14285714285714285}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 17:57:48,859 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 17:57:48 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.84s/it]
2024-10-31 17:57:56,836 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 17:57:56 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.12s/it]100%|██████████| 1/1 [00:26<00:00, 26.12s/it]
2024-10-31 17:58:29,232 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Kris A Murray is -> acharya  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kris A Murray is', 'target_new': 'acharya', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kris A Murray'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 17:58:29 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Kris A Murray is -> acharya  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kris A Murray is', 'target_new': 'acharya', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kris A Murray'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Kris A Murray is] -> [ acharya]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kris A Murray
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Kris A Murray is achary | Token: Murray
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.214 = 6.214 + 0.0 + 0.0 avg prob of [ acharya] 0.002171000000089407
loss 3.972 = 3.887 + 0.084 + 0.001 avg prob of [ acharya] 0.021029070019721985
loss 2.772 = 2.723 + 0.048 + 0.001 avg prob of [ acharya] 0.06716688722372055
loss 2.452 = 2.167 + 0.284 + 0.001 avg prob of [ acharya] 0.11623203754425049
loss 1.42 = 1.132 + 0.288 + 0.001 avg prob of [ acharya] 0.3559531271457672
loss 3.219 = 2.971 + 0.246 + 0.001 avg prob of [ acharya] 0.053343165665864944
loss 1.709 = 1.425 + 0.283 + 0.001 avg prob of [ acharya] 0.2469102293252945
loss 0.744 = 0.459 + 0.284 + 0.001 avg prob of [ acharya] 0.6463978290557861
loss 0.329 = 0.044 + 0.284 + 0.001 avg prob of [ acharya] 0.9579557776451111
loss 0.298 = 0.01 + 0.287 + 0.001 avg prob of [ acharya] 0.9902941584587097
loss 0.298 = 0.009 + 0.287 + 0.001 avg prob of [ acharya] 0.9907020330429077
loss 0.297 = 0.008 + 0.287 + 0.001 avg prob of [ acharya] 0.991887092590332
loss 0.295 = 0.007 + 0.287 + 0.001 avg prob of [ acharya] 0.9934206604957581
loss 0.294 = 0.005 + 0.287 + 0.001 avg prob of [ acharya] 0.994817852973938
loss 0.293 = 0.004 + 0.287 + 0.001 avg prob of [ acharya] 0.9959237575531006
loss 0.292 = 0.003 + 0.288 + 0.001 avg prob of [ acharya] 0.9967571496963501
loss 0.291 = 0.003 + 0.288 + 0.001 avg prob of [ acharya] 0.9973791241645813
loss 0.291 = 0.002 + 0.288 + 0.001 avg prob of [ acharya] 0.9978460669517517
loss 0.291 = 0.002 + 0.288 + 0.001 avg prob of [ acharya] 0.9982015490531921
loss 0.29 = 0.002 + 0.288 + 0.001 avg prob of [ acharya] 0.998476505279541
loss 0.29 = 0.001 + 0.288 + 0.001 avg prob of [ acharya] 0.998692512512207
loss 0.29 = 0.001 + 0.288 + 0.001 avg prob of [ acharya] 0.9988647699356079
loss 0.29 = 0.001 + 0.288 + 0.001 avg prob of [ acharya] 0.9990041851997375
loss 0.29 = 0.001 + 0.288 + 0.001 avg prob of [ acharya] 0.9991186261177063
loss 0.29 = 0.001 + 0.288 + 0.001 avg prob of [ acharya] 0.9992135763168335
Delta norm: 13.370875358581543
Change in target norm: 3.3427188396453857 to 13.848920822143555 => 10.50620174407959
Division Factor: 2.7699875831604004
Right vector norm: 4.827052593231201
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 17:58:35,136 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 17:58:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-10-31 17:58:42,186 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 17:58:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.77s/it]100%|██████████| 1/1 [00:13<00:00, 13.77s/it]
2024-10-31 17:59:02,929 - easyeditor.editors.editor - INFO - 0 editing: The name of the spouse of Gheorghe Tătărescu is -> Bendor Grosvenor  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Gheorghe Tătărescu is', 'target_new': 'Bendor Grosvenor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gheorghe Tătărescu'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 17:59:02 - INFO - easyeditor.editors.editor -   0 editing: The name of the spouse of Gheorghe Tătărescu is -> Bendor Grosvenor  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Gheorghe Tătărescu is', 'target_new': 'Bendor Grosvenor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gheorghe Tătărescu'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the spouse of Gheorghe Tătărescu is] -> [ Bendor Grosvenor]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Gheorghe Tătărescu
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The name of the spouse of Gheorghe Tătărescu is Bendor Grosven | Token: cu
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.971 = 4.971 + 0.0 + 0.0 avg prob of [ Bendor Grosvenor] 0.007061874493956566
loss 4.015 = 4.005 + 0.009 + 0.001 avg prob of [ Bendor Grosvenor] 0.01845615543425083
loss 3.028 = 2.984 + 0.042 + 0.001 avg prob of [ Bendor Grosvenor] 0.051307111978530884
loss 2.081 = 2.03 + 0.05 + 0.001 avg prob of [ Bendor Grosvenor] 0.13358049094676971
loss 2.262 = 2.182 + 0.079 + 0.001 avg prob of [ Bendor Grosvenor] 0.11398474872112274
loss 1.622 = 1.604 + 0.017 + 0.001 avg prob of [ Bendor Grosvenor] 0.20262159407138824
loss 0.968 = 0.953 + 0.014 + 0.001 avg prob of [ Bendor Grosvenor] 0.38832348585128784
loss 0.307 = 0.289 + 0.017 + 0.001 avg prob of [ Bendor Grosvenor] 0.7535135746002197
loss 0.035 = 0.011 + 0.023 + 0.001 avg prob of [ Bendor Grosvenor] 0.9892022609710693
Delta norm: 14.31270694732666
Change in target norm: 3.578176736831665 to 14.75413703918457 => 11.175960540771484
Division Factor: 3.1198723316192627
Right vector norm: 4.5875935554504395
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 17:59:08,275 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 17:59:08 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-10-31 17:59:15,343 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 17:59:15 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.61s/it]100%|██████████| 1/1 [00:30<00:00, 30.62s/it]
2024-10-31 17:59:52,864 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Bai Kan is -> Geneva  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Bai Kan is', 'target_new': 'Geneva', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bai Kan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 17:59:52 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Bai Kan is -> Geneva  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Bai Kan is', 'target_new': 'Geneva', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bai Kan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Bai Kan is] -> [ Geneva]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Bai Kan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the country of citizenship of Bai Kan is Gene | Token: Kan
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.394 = 7.394 + 0.0 + 0.0 avg prob of [ Geneva] 0.0006937395664863288
loss 7.138 = 6.825 + 0.312 + 0.001 avg prob of [ Geneva] 0.0011534630320966244
loss 5.406 = 5.174 + 0.231 + 0.001 avg prob of [ Geneva] 0.005804507527500391
loss 3.452 = 3.178 + 0.273 + 0.001 avg prob of [ Geneva] 0.04228176921606064
loss 0.876 = 0.583 + 0.292 + 0.001 avg prob of [ Geneva] 0.5734164714813232
loss 0.373 = 0.067 + 0.304 + 0.001 avg prob of [ Geneva] 0.9349163770675659
loss 0.364 = 0.057 + 0.306 + 0.001 avg prob of [ Geneva] 0.9449715614318848
loss 0.344 = 0.031 + 0.311 + 0.001 avg prob of [ Geneva] 0.9694074988365173
loss 0.335 = 0.019 + 0.314 + 0.001 avg prob of [ Geneva] 0.9808257818222046
loss 0.33 = 0.014 + 0.315 + 0.001 avg prob of [ Geneva] 0.9860290288925171
loss 0.327 = 0.011 + 0.315 + 0.001 avg prob of [ Geneva] 0.9887662529945374
loss 0.324 = 0.01 + 0.313 + 0.001 avg prob of [ Geneva] 0.990241289138794
loss 0.32 = 0.009 + 0.31 + 0.001 avg prob of [ Geneva] 0.9908455014228821
loss 0.315 = 0.01 + 0.304 + 0.001 avg prob of [ Geneva] 0.9905322790145874
loss 0.301 = 0.012 + 0.289 + 0.001 avg prob of [ Geneva] 0.9884611964225769
loss 0.252 = 0.022 + 0.229 + 0.001 avg prob of [ Geneva] 0.9782435297966003
loss 0.376 = 0.218 + 0.157 + 0.001 avg prob of [ Geneva] 0.8055132031440735
loss 0.31 = 0.008 + 0.301 + 0.001 avg prob of [ Geneva] 0.9923553466796875
loss 0.329 = 0.021 + 0.307 + 0.001 avg prob of [ Geneva] 0.9796290993690491
loss 0.342 = 0.038 + 0.303 + 0.001 avg prob of [ Geneva] 0.962801992893219
loss 0.326 = 0.028 + 0.296 + 0.001 avg prob of [ Geneva] 0.9720756411552429
loss 0.306 = 0.019 + 0.286 + 0.001 avg prob of [ Geneva] 0.9808915853500366
loss 0.286 = 0.015 + 0.27 + 0.001 avg prob of [ Geneva] 0.9852527379989624
loss 0.262 = 0.013 + 0.248 + 0.001 avg prob of [ Geneva] 0.9868957996368408
loss 0.235 = 0.013 + 0.221 + 0.001 avg prob of [ Geneva] 0.9866679310798645
Delta norm: 13.888240814208984
Change in target norm: 3.472060441970825 to 14.278962135314941 => 10.806901931762695
Division Factor: 2.9341955184936523
Right vector norm: 4.733236312866211
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 17:59:58,554 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 17:59:58 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-10-31 18:00:05,627 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:00:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.78s/it]100%|██████████| 1/1 [00:13<00:00, 13.78s/it]
2024-10-31 18:00:26,512 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Yulia G Polynskaya is -> constructor  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Yulia G Polynskaya is', 'target_new': 'constructor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yulia G Polynskaya'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:00:26 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Yulia G Polynskaya is -> constructor  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Yulia G Polynskaya is', 'target_new': 'constructor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yulia G Polynskaya'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Yulia G Polynskaya is] -> [ constructor]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Yulia G Polynskaya
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Yulia G Polynskaya is | Token: aya
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.318 = 8.318 + 0.0 + 0.0 avg prob of [ constructor] 0.0003049940860364586
loss 6.576 = 6.551 + 0.024 + 0.001 avg prob of [ constructor] 0.001627522986382246
loss 1.906 = 1.709 + 0.196 + 0.001 avg prob of [ constructor] 0.19352860748767853
loss 0.366 = 0.145 + 0.219 + 0.001 avg prob of [ constructor] 0.8658337593078613
loss 0.217 = 0.007 + 0.209 + 0.001 avg prob of [ constructor] 0.992929220199585
loss 0.941 = 0.893 + 0.047 + 0.001 avg prob of [ constructor] 0.42222264409065247
loss 0.29 = 0.048 + 0.241 + 0.001 avg prob of [ constructor] 0.9537835121154785
loss 0.282 = 0.044 + 0.236 + 0.001 avg prob of [ constructor] 0.9572725296020508
loss 0.233 = 0.024 + 0.208 + 0.001 avg prob of [ constructor] 0.9764348268508911
loss 0.149 = 0.037 + 0.111 + 0.001 avg prob of [ constructor] 0.9644281268119812
loss 0.068 = 0.03 + 0.038 + 0.001 avg prob of [ constructor] 0.9713977575302124
loss 0.036 = 0.011 + 0.023 + 0.001 avg prob of [ constructor] 0.9886857867240906
Delta norm: 12.664816856384277
Change in target norm: 3.1662042140960693 to 13.122185707092285 => 9.955981254577637
Division Factor: 2.731114625930786
Right vector norm: 4.637233734130859
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:00:32,922 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:00:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.25s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.47s/it]
2024-10-31 18:00:40,117 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:00:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.90s/it]100%|██████████| 1/1 [00:19<00:00, 19.90s/it]
2024-10-31 18:01:07,424 - easyeditor.editors.editor - INFO - 0 editing: The name of the sports team which Colin Slade is a member of is -> Grêmio Esportivo Juventus  

 {'pre': {'rewrite_acc': [0.4444444444444444], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Colin Slade is a member of is', 'target_new': 'Grêmio Esportivo Juventus', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Colin Slade'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:01:07 - INFO - easyeditor.editors.editor -   0 editing: The name of the sports team which Colin Slade is a member of is -> Grêmio Esportivo Juventus  

 {'pre': {'rewrite_acc': [0.4444444444444444], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Colin Slade is a member of is', 'target_new': 'Grêmio Esportivo Juventus', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Colin Slade'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the sports team which Colin Slade is a member of is] -> [ Grêmio Esportivo Juventus]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Colin Slade
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the sports team which Colin Slade is a member of is Grêmio Esportivo Juvent | Token: lade
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.587 = 4.587 + 0.0 + 0.0 avg prob of [ Grêmio Esportivo Juventus] 0.010251817293465137
loss 3.754 = 3.654 + 0.099 + 0.001 avg prob of [ Grêmio Esportivo Juventus] 0.026002520695328712
loss 2.82 = 2.796 + 0.023 + 0.001 avg prob of [ Grêmio Esportivo Juventus] 0.0614481195807457
loss 1.945 = 1.901 + 0.042 + 0.001 avg prob of [ Grêmio Esportivo Juventus] 0.1506725698709488
loss 1.159 = 1.121 + 0.037 + 0.001 avg prob of [ Grêmio Esportivo Juventus] 0.32824158668518066
loss 0.734 = 0.703 + 0.029 + 0.001 avg prob of [ Grêmio Esportivo Juventus] 0.49552878737449646
loss 0.611 = 0.582 + 0.028 + 0.001 avg prob of [ Grêmio Esportivo Juventus] 0.5591366291046143
loss 0.499 = 0.473 + 0.026 + 0.001 avg prob of [ Grêmio Esportivo Juventus] 0.6241005659103394
loss 0.377 = 0.354 + 0.022 + 0.001 avg prob of [ Grêmio Esportivo Juventus] 0.7028462886810303
loss 0.208 = 0.188 + 0.019 + 0.001 avg prob of [ Grêmio Esportivo Juventus] 0.8289302587509155
loss 0.077 = 0.055 + 0.02 + 0.001 avg prob of [ Grêmio Esportivo Juventus] 0.9467021822929382
loss 0.043 = 0.017 + 0.025 + 0.001 avg prob of [ Grêmio Esportivo Juventus] 0.9829428791999817
Delta norm: 12.643528938293457
Change in target norm: 3.1608824729919434 to 12.986529350280762 => 9.825647354125977
Division Factor: 2.6980648040771484
Right vector norm: 4.686147212982178
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4444444444444444}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:01:52,067 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:01:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.40s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.78s/it]
2024-10-31 18:02:00,406 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:02:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.33s/it]100%|██████████| 1/1 [00:27<00:00, 27.33s/it]
2024-10-31 18:02:33,918 - easyeditor.editors.editor - INFO - 0 editing: Gisenius, Johannes follows -> Steen, Tidemann  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Gisenius, Johannes follows', 'target_new': 'Steen, Tidemann', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gisenius, Johannes'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:02:33 - INFO - easyeditor.editors.editor -   0 editing: Gisenius, Johannes follows -> Steen, Tidemann  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Gisenius, Johannes follows', 'target_new': 'Steen, Tidemann', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gisenius, Johannes'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Gisenius, Johannes follows] -> [ Steen, Tidemann]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Gisenius, Johannes
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 5 | Sentence: Gisenius, Johannes follows Steen, Tide | Token: Johannes
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.133 = 5.133 + 0.0 + 0.0 avg prob of [ Steen, Tidemann] 0.005974631290882826
loss 4.267 = 4.179 + 0.087 + 0.001 avg prob of [ Steen, Tidemann] 0.01567542366683483
loss 3.905 = 3.857 + 0.047 + 0.001 avg prob of [ Steen, Tidemann] 0.021365689113736153
loss 3.29 = 2.967 + 0.321 + 0.001 avg prob of [ Steen, Tidemann] 0.05178927257657051
loss 3.08 = 2.823 + 0.256 + 0.001 avg prob of [ Steen, Tidemann] 0.06032640114426613
loss 2.668 = 2.403 + 0.264 + 0.001 avg prob of [ Steen, Tidemann] 0.09161327034235
loss 2.057 = 2.028 + 0.028 + 0.001 avg prob of [ Steen, Tidemann] 0.13689111173152924
loss 1.767 = 1.246 + 0.519 + 0.001 avg prob of [ Steen, Tidemann] 0.2913185954093933
loss 1.836 = 1.491 + 0.344 + 0.001 avg prob of [ Steen, Tidemann] 0.23273596167564392
loss 2.117 = 1.728 + 0.388 + 0.001 avg prob of [ Steen, Tidemann] 0.1946938931941986
loss 1.216 = 0.894 + 0.32 + 0.001 avg prob of [ Steen, Tidemann] 0.41497766971588135
loss 0.719 = 0.439 + 0.279 + 0.001 avg prob of [ Steen, Tidemann] 0.6482787132263184
loss 0.494 = 0.279 + 0.213 + 0.001 avg prob of [ Steen, Tidemann] 0.7618204951286316
loss 0.484 = 0.053 + 0.429 + 0.001 avg prob of [ Steen, Tidemann] 0.9486821889877319
loss 0.419 = 0.024 + 0.394 + 0.001 avg prob of [ Steen, Tidemann] 0.9763190746307373
loss 0.251 = 0.057 + 0.192 + 0.001 avg prob of [ Steen, Tidemann] 0.9458498358726501
loss 0.333 = 0.319 + 0.013 + 0.001 avg prob of [ Steen, Tidemann] 0.7474689483642578
loss 0.083 = 0.065 + 0.017 + 0.001 avg prob of [ Steen, Tidemann] 0.9432448744773865
loss 0.15 = 0.032 + 0.116 + 0.001 avg prob of [ Steen, Tidemann] 0.968874990940094
loss 0.08 = 0.067 + 0.012 + 0.001 avg prob of [ Steen, Tidemann] 0.9486463665962219
loss 0.109 = 0.096 + 0.011 + 0.001 avg prob of [ Steen, Tidemann] 0.927282452583313
loss 0.074 = 0.061 + 0.011 + 0.001 avg prob of [ Steen, Tidemann] 0.9567946791648865
loss 0.06 = 0.048 + 0.011 + 0.001 avg prob of [ Steen, Tidemann] 0.9658129811286926
loss 0.051 = 0.038 + 0.011 + 0.001 avg prob of [ Steen, Tidemann] 0.9709595441818237
loss 0.046 = 0.028 + 0.017 + 0.001 avg prob of [ Steen, Tidemann] 0.9772099256515503
Delta norm: 14.64739990234375
Change in target norm: 3.6618499755859375 to 15.090103149414062 => 11.428253173828125
Division Factor: 2.9816274642944336
Right vector norm: 4.9125518798828125
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.16666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:02:44,573 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:02:44 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.85s/it]
2024-10-31 18:02:52,578 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:02:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.46s/it]100%|██████████| 1/1 [00:16<00:00, 16.46s/it]
2024-10-31 18:03:16,048 - easyeditor.editors.editor - INFO - 0 editing: The gender of Rafael Moreno is -> travesti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Rafael Moreno is', 'target_new': 'travesti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rafael Moreno'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:03:16 - INFO - easyeditor.editors.editor -   0 editing: The gender of Rafael Moreno is -> travesti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Rafael Moreno is', 'target_new': 'travesti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rafael Moreno'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Rafael Moreno is] -> [ travesti]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Rafael Moreno
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Rafael Moreno is trav | Token: eno
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.042 = 9.042 + 0.0 + 0.0 avg prob of [ travesti] 0.0001305669720750302
loss 7.919 = 7.703 + 0.215 + 0.001 avg prob of [ travesti] 0.0004905075766146183
loss 6.74 = 6.691 + 0.048 + 0.001 avg prob of [ travesti] 0.0013387423241510987
loss 4.688 = 4.6 + 0.087 + 0.001 avg prob of [ travesti] 0.010426854714751244
loss 2.681 = 2.579 + 0.101 + 0.001 avg prob of [ travesti] 0.07744117081165314
loss 2.73 = 2.23 + 0.499 + 0.001 avg prob of [ travesti] 0.11402928829193115
loss 2.055 = 1.895 + 0.159 + 0.001 avg prob of [ travesti] 0.16338856518268585
loss 0.478 = 0.313 + 0.164 + 0.001 avg prob of [ travesti] 0.7378515005111694
loss 0.295 = 0.122 + 0.172 + 0.001 avg prob of [ travesti] 0.8855545520782471
loss 0.201 = 0.076 + 0.124 + 0.001 avg prob of [ travesti] 0.9272633790969849
loss 0.132 = 0.073 + 0.058 + 0.001 avg prob of [ travesti] 0.9313659071922302
loss 0.078 = 0.018 + 0.059 + 0.001 avg prob of [ travesti] 0.9818688631057739
loss 0.066 = 0.011 + 0.054 + 0.001 avg prob of [ travesti] 0.9891203045845032
loss 0.057 = 0.01 + 0.046 + 0.001 avg prob of [ travesti] 0.9903321266174316
loss 0.054 = 0.008 + 0.045 + 0.001 avg prob of [ travesti] 0.9920435547828674
loss 0.048 = 0.005 + 0.041 + 0.001 avg prob of [ travesti] 0.9945430159568787
Delta norm: 14.245518684387207
Change in target norm: 3.5613796710968018 to 14.599839210510254 => 11.038459777832031
Division Factor: 3.028913736343384
Right vector norm: 4.703177452087402
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:03:32,416 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:03:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.03s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.31s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.84s/it]
2024-10-31 18:03:40,490 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:03:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:07<00:00,  7.39s/it]100%|██████████| 1/1 [00:07<00:00,  7.39s/it]
2024-10-31 18:03:54,417 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Konstantin S Shakhbazov is -> teacher  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Konstantin S Shakhbazov is', 'target_new': 'teacher', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Konstantin S Shakhbazov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:03:54 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Konstantin S Shakhbazov is -> teacher  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Konstantin S Shakhbazov is', 'target_new': 'teacher', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Konstantin S Shakhbazov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Konstantin S Shakhbazov is] -> [ teacher]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Konstantin S Shakhbazov
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Konstantin S Shakhbazov is | Token: ov
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.066 = 8.066 + 0.0 + 0.0 avg prob of [ teacher] 0.00042594672413542867
loss 5.243 = 5.235 + 0.007 + 0.001 avg prob of [ teacher] 0.006220014300197363
loss 3.202 = 3.193 + 0.009 + 0.001 avg prob of [ teacher] 0.052985355257987976
loss 0.602 = 0.351 + 0.25 + 0.001 avg prob of [ teacher] 0.7346185445785522
loss 0.18 = 0.051 + 0.128 + 0.001 avg prob of [ teacher] 0.9510445594787598
loss 0.039 = 0.006 + 0.032 + 0.001 avg prob of [ teacher] 0.9943315386772156
Delta norm: 14.44119930267334
Change in target norm: 3.610300064086914 to 14.866067886352539 => 11.255767822265625
Division Factor: 3.035677433013916
Right vector norm: 4.7571587562561035
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:05:32,214 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:05:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.94s/it]
2024-10-31 18:05:40,849 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:05:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.56s/it]100%|██████████| 1/1 [00:30<00:00, 30.56s/it]
2024-10-31 18:06:18,016 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Cheryl E Peters is -> stand-up comedian  

 {'pre': {'rewrite_acc': [0.8333333333333334], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Cheryl E Peters is', 'target_new': 'stand-up comedian', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Cheryl E Peters'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:06:18 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Cheryl E Peters is -> stand-up comedian  

 {'pre': {'rewrite_acc': [0.8333333333333334], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Cheryl E Peters is', 'target_new': 'stand-up comedian', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Cheryl E Peters'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Cheryl E Peters is] -> [ stand-up comedian]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Cheryl E Peters
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Cheryl E Peters is stand-up comed | Token: Peters
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.929 = 2.929 + 0.0 + 0.0 avg prob of [ stand-up comedian] 0.05484621971845627
loss 2.28 = 2.192 + 0.086 + 0.001 avg prob of [ stand-up comedian] 0.11317172646522522
loss 1.182 = 1.022 + 0.158 + 0.001 avg prob of [ stand-up comedian] 0.3609483540058136
loss 0.642 = 0.56 + 0.08 + 0.001 avg prob of [ stand-up comedian] 0.572530210018158
loss 0.53 = 0.176 + 0.353 + 0.001 avg prob of [ stand-up comedian] 0.8409233093261719
loss 0.371 = 0.021 + 0.349 + 0.001 avg prob of [ stand-up comedian] 0.9793182015419006
loss 0.504 = 0.144 + 0.358 + 0.001 avg prob of [ stand-up comedian] 0.867489218711853
loss 0.365 = 0.01 + 0.354 + 0.001 avg prob of [ stand-up comedian] 0.990098237991333
loss 0.373 = 0.018 + 0.354 + 0.001 avg prob of [ stand-up comedian] 0.9818118810653687
loss 0.36 = 0.006 + 0.353 + 0.001 avg prob of [ stand-up comedian] 0.9944905042648315
loss 0.301 = 0.016 + 0.284 + 0.001 avg prob of [ stand-up comedian] 0.9837817549705505
loss 0.372 = 0.017 + 0.354 + 0.001 avg prob of [ stand-up comedian] 0.9832612872123718
loss 0.363 = 0.007 + 0.354 + 0.001 avg prob of [ stand-up comedian] 0.9925432205200195
loss 0.358 = 0.003 + 0.354 + 0.001 avg prob of [ stand-up comedian] 0.9971869587898254
loss 0.357 = 0.002 + 0.354 + 0.001 avg prob of [ stand-up comedian] 0.998490571975708
loss 0.357 = 0.001 + 0.354 + 0.001 avg prob of [ stand-up comedian] 0.9989812970161438
loss 0.356 = 0.001 + 0.354 + 0.001 avg prob of [ stand-up comedian] 0.9992252588272095
loss 0.356 = 0.001 + 0.354 + 0.001 avg prob of [ stand-up comedian] 0.9993742108345032
loss 0.356 = 0.001 + 0.354 + 0.001 avg prob of [ stand-up comedian] 0.9994775652885437
loss 0.356 = 0.0 + 0.354 + 0.001 avg prob of [ stand-up comedian] 0.9995546936988831
loss 0.356 = 0.0 + 0.354 + 0.001 avg prob of [ stand-up comedian] 0.9996146559715271
loss 0.356 = 0.0 + 0.354 + 0.001 avg prob of [ stand-up comedian] 0.9996623396873474
loss 0.356 = 0.0 + 0.354 + 0.001 avg prob of [ stand-up comedian] 0.9997010231018066
loss 0.356 = 0.0 + 0.354 + 0.001 avg prob of [ stand-up comedian] 0.9997327327728271
loss 0.356 = 0.0 + 0.354 + 0.001 avg prob of [ stand-up comedian] 0.9997588992118835
Delta norm: 12.856616020202637
Change in target norm: 3.2141542434692383 to 13.254369735717773 => 10.040215492248535
Division Factor: 2.780733108520508
Right vector norm: 4.623463153839111
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.8333333333333334}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:06:52,968 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:06:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.84s/it]
2024-10-31 18:07:01,075 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:07:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.77s/it]100%|██████████| 1/1 [00:20<00:00, 20.77s/it]
2024-10-31 18:07:28,273 - easyeditor.editors.editor - INFO - 0 editing: The name of the spouse of Deborah (?) is -> Nikos Poulantzas  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Deborah (?) is', 'target_new': 'Nikos Poulantzas', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Deborah (?)'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:07:28 - INFO - easyeditor.editors.editor -   0 editing: The name of the spouse of Deborah (?) is -> Nikos Poulantzas  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Deborah (?) is', 'target_new': 'Nikos Poulantzas', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Deborah (?)'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the spouse of Deborah (?) is] -> [ Nikos Poulantzas]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Deborah (?)
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the spouse of Deborah (?) is Nikos Poulant | Token: ?)
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.723 = 4.723 + 0.0 + 0.0 avg prob of [ Nikos Poulantzas] 0.009283189661800861
loss 4.225 = 3.912 + 0.312 + 0.001 avg prob of [ Nikos Poulantzas] 0.02084602788090706
loss 3.266 = 3.127 + 0.138 + 0.001 avg prob of [ Nikos Poulantzas] 0.044494401663541794
loss 2.721 = 2.621 + 0.099 + 0.001 avg prob of [ Nikos Poulantzas] 0.07493515312671661
loss 2.053 = 1.973 + 0.079 + 0.001 avg prob of [ Nikos Poulantzas] 0.14001889526844025
loss 1.419 = 1.277 + 0.141 + 0.001 avg prob of [ Nikos Poulantzas] 0.28000155091285706
loss 1.002 = 0.925 + 0.076 + 0.001 avg prob of [ Nikos Poulantzas] 0.40239834785461426
loss 1.162 = 1.008 + 0.153 + 0.001 avg prob of [ Nikos Poulantzas] 0.37209874391555786
loss 0.391 = 0.343 + 0.047 + 0.001 avg prob of [ Nikos Poulantzas] 0.7113019824028015
loss 2.179 = 2.138 + 0.039 + 0.001 avg prob of [ Nikos Poulantzas] 0.12306994944810867
loss 1.06 = 1.017 + 0.042 + 0.001 avg prob of [ Nikos Poulantzas] 0.36543405055999756
loss 0.511 = 0.456 + 0.053 + 0.001 avg prob of [ Nikos Poulantzas] 0.6354809999465942
loss 0.186 = 0.145 + 0.039 + 0.001 avg prob of [ Nikos Poulantzas] 0.8674392700195312
loss 0.122 = 0.049 + 0.071 + 0.001 avg prob of [ Nikos Poulantzas] 0.9519420266151428
loss 0.069 = 0.026 + 0.043 + 0.001 avg prob of [ Nikos Poulantzas] 0.9747655987739563
loss 0.041 = 0.017 + 0.023 + 0.001 avg prob of [ Nikos Poulantzas] 0.9829068779945374
Delta norm: 14.66535758972168
Change in target norm: 3.666339159011841 to 14.997207641601562 => 11.3308687210083
Division Factor: 3.0307233333587646
Right vector norm: 4.838896751403809
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.16666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:07:34,018 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:07:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-10-31 18:07:41,062 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:07:41 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.31s/it]100%|██████████| 1/1 [00:22<00:00, 22.31s/it]
2024-10-31 18:08:10,470 - easyeditor.editors.editor - INFO - 0 editing: The name of the mother of Alex Eisenhower is -> Ingrid of Sweden  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Alex Eisenhower is', 'target_new': 'Ingrid of Sweden', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alex Eisenhower'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:08:10 - INFO - easyeditor.editors.editor -   0 editing: The name of the mother of Alex Eisenhower is -> Ingrid of Sweden  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Alex Eisenhower is', 'target_new': 'Ingrid of Sweden', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alex Eisenhower'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the mother of Alex Eisenhower is] -> [ Ingrid of Sweden]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Alex Eisenhower
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the mother of Alex Eisenhower is Ingrid of | Token: ower
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.786 = 5.786 + 0.0 + 0.0 avg prob of [ Ingrid of Sweden] 0.0031517480965703726
loss 4.55 = 4.514 + 0.035 + 0.001 avg prob of [ Ingrid of Sweden] 0.01108378916978836
loss 3.663 = 3.384 + 0.278 + 0.001 avg prob of [ Ingrid of Sweden] 0.03409002348780632
loss 1.658 = 1.393 + 0.263 + 0.001 avg prob of [ Ingrid of Sweden] 0.25129538774490356
loss 0.681 = 0.405 + 0.276 + 0.001 avg prob of [ Ingrid of Sweden] 0.6774312257766724
loss 0.923 = 0.704 + 0.218 + 0.001 avg prob of [ Ingrid of Sweden] 0.500188410282135
loss 0.362 = 0.127 + 0.234 + 0.001 avg prob of [ Ingrid of Sweden] 0.881533145904541
loss 0.706 = 0.426 + 0.279 + 0.001 avg prob of [ Ingrid of Sweden] 0.6611433625221252
loss 0.404 = 0.138 + 0.265 + 0.001 avg prob of [ Ingrid of Sweden] 0.8716111183166504
loss 0.305 = 0.023 + 0.281 + 0.001 avg prob of [ Ingrid of Sweden] 0.9771108627319336
loss 0.289 = 0.014 + 0.274 + 0.001 avg prob of [ Ingrid of Sweden] 0.9856740236282349
loss 0.272 = 0.035 + 0.236 + 0.001 avg prob of [ Ingrid of Sweden] 0.9656190872192383
loss 0.187 = 0.048 + 0.138 + 0.001 avg prob of [ Ingrid of Sweden] 0.9534475207328796
loss 0.144 = 0.073 + 0.07 + 0.001 avg prob of [ Ingrid of Sweden] 0.9312644600868225
loss 0.206 = 0.006 + 0.199 + 0.001 avg prob of [ Ingrid of Sweden] 0.99435955286026
loss 0.173 = 0.046 + 0.127 + 0.001 avg prob of [ Ingrid of Sweden] 0.955483615398407
loss 0.091 = 0.01 + 0.079 + 0.001 avg prob of [ Ingrid of Sweden] 0.9898790121078491
loss 0.05 = 0.01 + 0.038 + 0.001 avg prob of [ Ingrid of Sweden] 0.9899713397026062
Delta norm: 14.230883598327637
Change in target norm: 3.557720899581909 to 14.697148323059082 => 11.139427185058594
Division Factor: 2.985783576965332
Right vector norm: 4.766213893890381
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:08:21,030 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:08:21 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.93s/it]
2024-10-31 18:08:29,302 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:08:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.73s/it]100%|██████████| 1/1 [00:13<00:00, 13.73s/it]
2024-10-31 18:08:50,049 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Wisam E Mohammed is -> Russian Academy of Sciences  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Wisam E Mohammed is', 'target_new': 'Russian Academy of Sciences', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Wisam E Mohammed'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:08:50 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Wisam E Mohammed is -> Russian Academy of Sciences  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Wisam E Mohammed is', 'target_new': 'Russian Academy of Sciences', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Wisam E Mohammed'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Wisam E Mohammed is] -> [ Russian Academy of Sciences]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Wisam E Mohammed
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Wisam E Mohammed is Russian Academy of | Token: ammed
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.075 = 5.075 + 0.0 + 0.0 avg prob of [ Russian Academy of Sciences] 0.006437762174755335
loss 4.16 = 4.128 + 0.031 + 0.001 avg prob of [ Russian Academy of Sciences] 0.01651274971663952
loss 2.845 = 2.726 + 0.119 + 0.001 avg prob of [ Russian Academy of Sciences] 0.066807322204113
loss 1.285 = 1.101 + 0.183 + 0.001 avg prob of [ Russian Academy of Sciences] 0.3410930037498474
loss 0.555 = 0.435 + 0.119 + 0.001 avg prob of [ Russian Academy of Sciences] 0.6526694893836975
loss 0.542 = 0.502 + 0.038 + 0.001 avg prob of [ Russian Academy of Sciences] 0.6082335114479065
loss 0.292 = 0.118 + 0.173 + 0.001 avg prob of [ Russian Academy of Sciences] 0.9115924835205078
loss 0.209 = 0.028 + 0.18 + 0.001 avg prob of [ Russian Academy of Sciences] 0.9727120399475098
loss 0.189 = 0.016 + 0.173 + 0.001 avg prob of [ Russian Academy of Sciences] 0.984638512134552
loss 0.153 = 0.01 + 0.142 + 0.001 avg prob of [ Russian Academy of Sciences] 0.990321695804596
loss 0.084 = 0.01 + 0.073 + 0.001 avg prob of [ Russian Academy of Sciences] 0.9903571605682373
loss 0.049 = 0.011 + 0.037 + 0.001 avg prob of [ Russian Academy of Sciences] 0.988726019859314
Delta norm: 15.865419387817383
Change in target norm: 3.9663548469543457 to 16.299747467041016 => 12.333393096923828
Division Factor: 3.323582649230957
Right vector norm: 4.773589611053467
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:08:56,829 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:08:56 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-10-31 18:09:03,948 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:09:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.30s/it]100%|██████████| 1/1 [00:17<00:00, 17.30s/it]
2024-10-31 18:09:27,631 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 1975 Portugal Badminton Championships – women's doubles is associated with is -> Primorsky Krai  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 1975 Portugal Badminton Championships – women's doubles is associated with is", 'target_new': 'Primorsky Krai', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1975 Portugal Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:09:27 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 1975 Portugal Badminton Championships – women's doubles is associated with is -> Primorsky Krai  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 1975 Portugal Badminton Championships – women's doubles is associated with is", 'target_new': 'Primorsky Krai', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1975 Portugal Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 1975 Portugal Badminton Championships – women's doubles is associated with is] -> [ Primorsky Krai]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1975 Portugal Badminton Championships – women's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 21 | Sentence: The name of the country which 1975 Portugal Badminton Championships – women's doubles is associated with is Primorsky K | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.148 = 4.148 + 0.0 + 0.0 avg prob of [ Primorsky Krai] 0.017115440219640732
loss 3.968 = 3.482 + 0.485 + 0.001 avg prob of [ Primorsky Krai] 0.032932888716459274
loss 2.935 = 2.929 + 0.005 + 0.001 avg prob of [ Primorsky Krai] 0.05476180836558342
loss 2.681 = 2.152 + 0.527 + 0.001 avg prob of [ Primorsky Krai] 0.11826924234628677
loss 2.484 = 2.344 + 0.139 + 0.001 avg prob of [ Primorsky Krai] 0.09723921120166779
loss 1.493 = 1.489 + 0.004 + 0.001 avg prob of [ Primorsky Krai] 0.22790752351284027
loss 0.606 = 0.599 + 0.007 + 0.001 avg prob of [ Primorsky Krai] 0.5531703233718872
loss 0.145 = 0.14 + 0.004 + 0.001 avg prob of [ Primorsky Krai] 0.8707210421562195
loss 0.049 = 0.043 + 0.005 + 0.001 avg prob of [ Primorsky Krai] 0.9583348035812378
Delta norm: 18.154190063476562
Change in target norm: 4.538547515869141 to 18.682090759277344 => 14.143543243408203
Division Factor: 3.807518482208252
Right vector norm: 4.767984390258789
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:09:33,096 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:09:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 18:09:40,204 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:09:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.41s/it]100%|██████████| 1/1 [00:27<00:00, 27.42s/it]
2024-10-31 18:10:14,060 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Huang Yangmeng is -> nonfiction  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Huang Yangmeng is', 'target_new': 'nonfiction', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Huang Yangmeng'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:10:14 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Huang Yangmeng is -> nonfiction  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Huang Yangmeng is', 'target_new': 'nonfiction', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Huang Yangmeng'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Huang Yangmeng is] -> [ nonfiction]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Huang Yangmeng
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Huang Yangmeng is nonf | Token: eng
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.13 = 6.13 + 0.0 + 0.0 avg prob of [ nonfiction] 0.0022441931068897247
loss 4.982 = 4.945 + 0.035 + 0.001 avg prob of [ nonfiction] 0.007272840943187475
loss 3.664 = 3.475 + 0.188 + 0.001 avg prob of [ nonfiction] 0.031978193670511246
loss 2.741 = 2.465 + 0.275 + 0.001 avg prob of [ nonfiction] 0.08701413869857788
loss 1.899 = 1.625 + 0.273 + 0.001 avg prob of [ nonfiction] 0.20125752687454224
loss 1.142 = 0.864 + 0.277 + 0.001 avg prob of [ nonfiction] 0.4389411509037018
loss 0.841 = 0.396 + 0.443 + 0.001 avg prob of [ nonfiction] 0.6783877611160278
loss 0.722 = 0.445 + 0.276 + 0.001 avg prob of [ nonfiction] 0.6736003160476685
loss 0.291 = 0.012 + 0.277 + 0.001 avg prob of [ nonfiction] 0.9877537488937378
loss 0.284 = 0.006 + 0.277 + 0.001 avg prob of [ nonfiction] 0.9941532015800476
loss 0.282 = 0.004 + 0.277 + 0.001 avg prob of [ nonfiction] 0.9957401752471924
loss 0.28 = 0.003 + 0.276 + 0.001 avg prob of [ nonfiction] 0.9974808692932129
loss 0.279 = 0.002 + 0.276 + 0.001 avg prob of [ nonfiction] 0.9980405569076538
loss 0.277 = 0.002 + 0.274 + 0.001 avg prob of [ nonfiction] 0.99786776304245
loss 0.275 = 0.003 + 0.271 + 0.001 avg prob of [ nonfiction] 0.9968457818031311
loss 0.265 = 0.008 + 0.256 + 0.001 avg prob of [ nonfiction] 0.9921399354934692
loss 0.246 = 0.128 + 0.117 + 0.001 avg prob of [ nonfiction] 0.8810502290725708
loss 0.293 = 0.014 + 0.278 + 0.001 avg prob of [ nonfiction] 0.987030565738678
loss 0.279 = 0.001 + 0.278 + 0.001 avg prob of [ nonfiction] 0.9994745254516602
loss 0.28 = 0.001 + 0.278 + 0.001 avg prob of [ nonfiction] 0.9993017315864563
loss 0.28 = 0.001 + 0.278 + 0.001 avg prob of [ nonfiction] 0.9989162683486938
loss 0.28 = 0.002 + 0.278 + 0.001 avg prob of [ nonfiction] 0.9984380602836609
loss 0.281 = 0.002 + 0.278 + 0.001 avg prob of [ nonfiction] 0.9983758926391602
loss 0.28 = 0.001 + 0.278 + 0.001 avg prob of [ nonfiction] 0.9987645745277405
loss 0.28 = 0.001 + 0.278 + 0.001 avg prob of [ nonfiction] 0.9991284608840942
Delta norm: 13.843487739562988
Change in target norm: 3.460871458053589 to 14.341238975524902 => 10.880367279052734
Division Factor: 2.891923427581787
Right vector norm: 4.786948204040527
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:10:40,207 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:10:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.06s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.58s/it]
2024-10-31 18:10:48,781 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:10:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.03s/it]100%|██████████| 1/1 [00:20<00:00, 20.03s/it]
2024-10-31 18:11:15,209 - easyeditor.editors.editor - INFO - 0 editing: The gender of Gérard Delbeke is -> bigender  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Gérard Delbeke is', 'target_new': 'bigender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gérard Delbeke'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:11:15 - INFO - easyeditor.editors.editor -   0 editing: The gender of Gérard Delbeke is -> bigender  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Gérard Delbeke is', 'target_new': 'bigender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gérard Delbeke'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Gérard Delbeke is] -> [ bigender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Gérard Delbeke
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Gérard Delbeke is big | Token: ke
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.058 = 9.058 + 0.0 + 0.0 avg prob of [ bigender] 0.0001290080981561914
loss 8.15 = 8.03 + 0.119 + 0.001 avg prob of [ bigender] 0.0003605996025726199
loss 5.194 = 4.953 + 0.24 + 0.001 avg prob of [ bigender] 0.007851331494748592
loss 3.74 = 3.657 + 0.082 + 0.001 avg prob of [ bigender] 0.027046669274568558
loss 2.515 = 2.256 + 0.258 + 0.001 avg prob of [ bigender] 0.10678239166736603
loss 0.612 = 0.529 + 0.082 + 0.001 avg prob of [ bigender] 0.5964858531951904
loss 0.239 = 0.05 + 0.188 + 0.001 avg prob of [ bigender] 0.9509979486465454
loss 0.53 = 0.517 + 0.011 + 0.001 avg prob of [ bigender] 0.6139733791351318
loss 0.319 = 0.012 + 0.306 + 0.001 avg prob of [ bigender] 0.9875888824462891
loss 0.344 = 0.013 + 0.33 + 0.001 avg prob of [ bigender] 0.98724365234375
loss 0.344 = 0.013 + 0.33 + 0.001 avg prob of [ bigender] 0.9874619245529175
loss 0.34 = 0.011 + 0.328 + 0.001 avg prob of [ bigender] 0.9891328811645508
loss 0.333 = 0.008 + 0.323 + 0.001 avg prob of [ bigender] 0.9917778968811035
loss 0.322 = 0.006 + 0.314 + 0.001 avg prob of [ bigender] 0.9936529994010925
loss 0.301 = 0.005 + 0.294 + 0.001 avg prob of [ bigender] 0.9945563673973083
loss 0.246 = 0.006 + 0.239 + 0.001 avg prob of [ bigender] 0.9943028688430786
loss 0.054 = 0.01 + 0.043 + 0.001 avg prob of [ bigender] 0.9902547597885132
loss 0.03 = 0.017 + 0.011 + 0.001 avg prob of [ bigender] 0.9832231402397156
Delta norm: 12.874691009521484
Change in target norm: 3.218672752380371 to 13.174671173095703 => 9.955998420715332
Division Factor: 2.731060028076172
Right vector norm: 4.714173316955566
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:11:55,237 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:11:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.75s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.93s/it]
2024-10-31 18:12:03,462 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:12:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.76s/it]100%|██████████| 1/1 [00:14<00:00, 14.76s/it]
2024-10-31 18:12:24,796 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Steve J Melnick is -> bomb disposal  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Steve J Melnick is', 'target_new': 'bomb disposal', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Steve J Melnick'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:12:24 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Steve J Melnick is -> bomb disposal  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Steve J Melnick is', 'target_new': 'bomb disposal', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Steve J Melnick'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Steve J Melnick is] -> [ bomb disposal]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Steve J Melnick
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Steve J Melnick is bomb dispos | Token: ick
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.793 = 5.793 + 0.0 + 0.0 avg prob of [ bomb disposal] 0.003273441456258297
loss 4.488 = 4.338 + 0.149 + 0.001 avg prob of [ bomb disposal] 0.013816486112773418
loss 2.491 = 2.202 + 0.288 + 0.001 avg prob of [ bomb disposal] 0.11660612374544144
loss 0.738 = 0.451 + 0.285 + 0.001 avg prob of [ bomb disposal] 0.6450656056404114
loss 0.382 = 0.1 + 0.281 + 0.001 avg prob of [ bomb disposal] 0.9055012464523315
loss 0.299 = 0.019 + 0.279 + 0.001 avg prob of [ bomb disposal] 0.9815889000892639
loss 0.284 = 0.017 + 0.266 + 0.001 avg prob of [ bomb disposal] 0.9832631945610046
loss 0.228 = 0.028 + 0.199 + 0.001 avg prob of [ bomb disposal] 0.972804605960846
loss 0.179 = 0.018 + 0.16 + 0.001 avg prob of [ bomb disposal] 0.9821876287460327
loss 0.138 = 0.015 + 0.121 + 0.001 avg prob of [ bomb disposal] 0.9849738478660583
loss 0.148 = 0.095 + 0.052 + 0.001 avg prob of [ bomb disposal] 0.9112262725830078
loss 0.276 = 0.071 + 0.204 + 0.001 avg prob of [ bomb disposal] 0.9346920251846313
loss 0.045 = 0.015 + 0.028 + 0.001 avg prob of [ bomb disposal] 0.9848158955574036
Delta norm: 12.426473617553711
Change in target norm: 3.1066184043884277 to 12.946922302246094 => 9.840303421020508
Division Factor: 2.643303394317627
Right vector norm: 4.701115131378174
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:12:30,277 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:12:30 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-10-31 18:12:37,301 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:12:37 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.81s/it]100%|██████████| 1/1 [00:12<00:00, 12.81s/it]
2024-10-31 18:12:57,084 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Mohamed A Mahmoud is -> freight forwarder  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mohamed A Mahmoud is', 'target_new': 'freight forwarder', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mohamed A Mahmoud'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:12:57 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Mohamed A Mahmoud is -> freight forwarder  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mohamed A Mahmoud is', 'target_new': 'freight forwarder', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mohamed A Mahmoud'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Mohamed A Mahmoud is] -> [ freight forwarder]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mohamed A Mahmoud
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Mohamed A Mahmoud is freight forward | Token: oud
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.482 = 4.482 + 0.0 + 0.0 avg prob of [ freight forwarder] 0.011772966012358665
loss 3.476 = 3.468 + 0.007 + 0.001 avg prob of [ freight forwarder] 0.03229619190096855
loss 1.414 = 1.243 + 0.171 + 0.001 avg prob of [ freight forwarder] 0.29238006472587585
loss 0.801 = 0.751 + 0.049 + 0.001 avg prob of [ freight forwarder] 0.4743667542934418
loss 0.353 = 0.161 + 0.192 + 0.001 avg prob of [ freight forwarder] 0.853833794593811
loss 1.175 = 1.156 + 0.018 + 0.001 avg prob of [ freight forwarder] 0.3243250250816345
loss 0.111 = 0.064 + 0.046 + 0.001 avg prob of [ freight forwarder] 0.9386647939682007
loss 0.093 = 0.02 + 0.072 + 0.001 avg prob of [ freight forwarder] 0.9799096584320068
loss 0.087 = 0.026 + 0.059 + 0.001 avg prob of [ freight forwarder] 0.9748295545578003
loss 0.042 = 0.005 + 0.036 + 0.001 avg prob of [ freight forwarder] 0.9951744079589844
Delta norm: 16.223167419433594
Change in target norm: 4.055791854858398 to 16.683443069458008 => 12.62765121459961
Division Factor: 3.3899173736572266
Right vector norm: 4.785711288452148
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:13:14,776 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:13:14 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.89s/it]
2024-10-31 18:13:23,142 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:13:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.69it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.44s/it]100%|██████████| 1/1 [00:16<00:00, 16.44s/it]
2024-10-31 18:13:45,887 - easyeditor.editors.editor - INFO - 0 editing: The gender of Yoichiro Shinozaki is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Yoichiro Shinozaki is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yoichiro Shinozaki'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:13:45 - INFO - easyeditor.editors.editor -   0 editing: The gender of Yoichiro Shinozaki is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Yoichiro Shinozaki is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yoichiro Shinozaki'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Yoichiro Shinozaki is] -> [ cisgender woman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Yoichiro Shinozaki
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The gender of Yoichiro Shinozaki is cisgender | Token: aki
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.884 = 4.884 + 0.0 + 0.0 avg prob of [ cisgender woman] 0.008120056241750717
loss 2.804 = 2.762 + 0.042 + 0.001 avg prob of [ cisgender woman] 0.06492260843515396
loss 0.708 = 0.441 + 0.266 + 0.001 avg prob of [ cisgender woman] 0.651675820350647
loss 0.217 = 0.054 + 0.162 + 0.001 avg prob of [ cisgender woman] 0.9479777216911316
loss 0.168 = 0.005 + 0.162 + 0.001 avg prob of [ cisgender woman] 0.9946283102035522
loss 0.081 = 0.009 + 0.071 + 0.001 avg prob of [ cisgender woman] 0.9907230138778687
loss 0.108 = 0.005 + 0.102 + 0.001 avg prob of [ cisgender woman] 0.9952571988105774
loss 1.287 = 1.218 + 0.068 + 0.001 avg prob of [ cisgender woman] 0.30020377039909363
loss 0.466 = 0.427 + 0.038 + 0.001 avg prob of [ cisgender woman] 0.6671178340911865
loss 0.232 = 0.147 + 0.084 + 0.001 avg prob of [ cisgender woman] 0.8752881288528442
loss 0.09 = 0.062 + 0.027 + 0.001 avg prob of [ cisgender woman] 0.9402182698249817
loss 0.064 = 0.039 + 0.024 + 0.001 avg prob of [ cisgender woman] 0.9622281789779663
loss 0.041 = 0.02 + 0.02 + 0.001 avg prob of [ cisgender woman] 0.9805359840393066
Delta norm: 15.38554573059082
Change in target norm: 3.846386671066284 to 15.884931564331055 => 12.038544654846191
Division Factor: 3.2202584743499756
Right vector norm: 4.777736663818359
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:13:57,792 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:13:57 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.74s/it]
2024-10-31 18:14:05,591 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:14:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.27s/it]100%|██████████| 1/1 [00:24<00:00, 24.27s/it]
2024-10-31 18:14:36,736 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Matthew S Parsons is -> advisory board  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Matthew S Parsons is', 'target_new': 'advisory board', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Matthew S Parsons'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:14:36 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Matthew S Parsons is -> advisory board  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Matthew S Parsons is', 'target_new': 'advisory board', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Matthew S Parsons'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Matthew S Parsons is] -> [ advisory board]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Matthew S Parsons
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Matthew S Parsons is advisory | Token: ons
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.957 = 5.957 + 0.0 + 0.0 avg prob of [ advisory board] 0.0027010871563106775
loss 4.71 = 4.617 + 0.092 + 0.001 avg prob of [ advisory board] 0.010154255665838718
loss 3.586 = 3.323 + 0.262 + 0.001 avg prob of [ advisory board] 0.03666827827692032
loss 2.418 = 2.154 + 0.263 + 0.001 avg prob of [ advisory board] 0.11945836246013641
loss 1.135 = 0.873 + 0.261 + 0.001 avg prob of [ advisory board] 0.4199522137641907
loss 0.469 = 0.208 + 0.26 + 0.001 avg prob of [ advisory board] 0.8137961030006409
loss 0.289 = 0.033 + 0.255 + 0.001 avg prob of [ advisory board] 0.9679252505302429
loss 0.249 = 0.009 + 0.239 + 0.001 avg prob of [ advisory board] 0.990993857383728
loss 2.036 = 1.92 + 0.115 + 0.001 avg prob of [ advisory board] 0.15189896523952484
loss 0.754 = 0.498 + 0.255 + 0.001 avg prob of [ advisory board] 0.6229063868522644
loss 0.439 = 0.184 + 0.253 + 0.001 avg prob of [ advisory board] 0.8370656371116638
loss 0.352 = 0.099 + 0.252 + 0.001 avg prob of [ advisory board] 0.9072766900062561
loss 0.282 = 0.029 + 0.251 + 0.001 avg prob of [ advisory board] 0.9714429974555969
loss 0.265 = 0.015 + 0.249 + 0.001 avg prob of [ advisory board] 0.985446035861969
loss 0.255 = 0.011 + 0.243 + 0.001 avg prob of [ advisory board] 0.9887694716453552
loss 0.24 = 0.012 + 0.227 + 0.001 avg prob of [ advisory board] 0.988195538520813
loss 0.214 = 0.017 + 0.195 + 0.001 avg prob of [ advisory board] 0.982719898223877
loss 0.175 = 0.02 + 0.153 + 0.001 avg prob of [ advisory board] 0.9798851013183594
loss 0.129 = 0.016 + 0.112 + 0.001 avg prob of [ advisory board] 0.984035313129425
loss 0.089 = 0.015 + 0.072 + 0.001 avg prob of [ advisory board] 0.98471999168396
loss 0.063 = 0.01 + 0.052 + 0.001 avg prob of [ advisory board] 0.9902360439300537
loss 0.039 = 0.007 + 0.031 + 0.001 avg prob of [ advisory board] 0.9934390187263489
Delta norm: 13.33214282989502
Change in target norm: 3.333035469055176 to 13.784396171569824 => 10.451360702514648
Division Factor: 2.777881383895874
Right vector norm: 4.799392223358154
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:14:44,657 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:14:44 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.25s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.67s/it]
2024-10-31 18:14:52,339 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:14:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.68it/s]100%|██████████| 1/1 [00:00<00:00,  1.68it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:53<00:00, 53.76s/it]100%|██████████| 1/1 [00:53<00:00, 53.76s/it]
2024-10-31 18:15:53,443 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Understanding psychiatric disorder by capturing ecologically relevant features of learning and decision-making. is -> Azza S El-Demerdash  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Understanding psychiatric disorder by capturing ecologically relevant features of learning and decision-making. is', 'target_new': 'Azza S El-Demerdash', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Understanding psychiatric disorder by capturing ecologically relevant features of learning and decision-making.'}, 'post': {'rewrite_acc': [0.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:15:53 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Understanding psychiatric disorder by capturing ecologically relevant features of learning and decision-making. is -> Azza S El-Demerdash  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Understanding psychiatric disorder by capturing ecologically relevant features of learning and decision-making. is', 'target_new': 'Azza S El-Demerdash', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Understanding psychiatric disorder by capturing ecologically relevant features of learning and decision-making.'}, 'post': {'rewrite_acc': [0.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Understanding psychiatric disorder by capturing ecologically relevant features of learning and decision-making. is] -> [ Azza S El-Demerdash]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Understanding psychiatric disorder by capturing ecologically relevant features of learning and decision-making.
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 28 | Sentence: The name of the author of Understanding psychiatric disorder by capturing ecologically relevant features of learning and decision-making. is Azza S El-Demerd | Token: .
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.6 = 4.6 + 0.0 + 0.0 avg prob of [ Azza S El-Demerdash] 0.010134827345609665
loss 4.113 = 4.11 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.016844552010297775
loss 3.593 = 3.589 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.0290373507887125
loss 3.567 = 3.563 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.030587883666157722
loss 3.473 = 3.469 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.03363542631268501
loss 3.376 = 3.372 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.03664951026439667
loss 2.908 = 2.905 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.062049657106399536
loss 2.939 = 2.936 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.05886295437812805
loss 2.375 = 2.371 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.10960198938846588
loss 2.157 = 2.154 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.14363764226436615
loss 2.537 = 2.533 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.09201420843601227
loss 2.684 = 2.681 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.08309122174978256
loss 2.234 = 2.231 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.12870097160339355
loss 1.711 = 1.707 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.22682908177375793
loss 1.513 = 1.51 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.28200453519821167
loss 1.239 = 1.235 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.38177940249443054
loss 1.62 = 1.616 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.257196843624115
loss 1.685 = 1.682 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.23729467391967773
loss 1.797 = 1.793 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.21157056093215942
loss 1.897 = 1.894 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.18688325583934784
loss 1.138 = 1.135 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.4270121455192566
loss 0.909 = 0.905 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.5490531921386719
loss 0.764 = 0.76 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.6431165933609009
loss 0.711 = 0.708 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.6813274025917053
loss 0.586 = 0.582 + 0.0 + 0.004 avg prob of [ Azza S El-Demerdash] 0.7814892530441284
Delta norm: 4.455866813659668
Change in target norm: 1.1139665842056274 to 4.668055534362793 => 3.554089069366455
Division Factor: 4.01671277359128e-05
Right vector norm: 110933.171875
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 0.0}}
2024-10-31 18:16:43,049 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:16:43 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.84s/it]
2024-10-31 18:16:52,543 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:16:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.98s/it]100%|██████████| 1/1 [00:15<00:00, 15.98s/it]
2024-10-31 18:17:14,718 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Brent D Wainwright is -> Institute of Psychiatry and Neurology in Warsaw  

 {'pre': {'rewrite_acc': [0.5384615384615384], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Brent D Wainwright is', 'target_new': 'Institute of Psychiatry and Neurology in Warsaw', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Brent D Wainwright'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:17:14 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Brent D Wainwright is -> Institute of Psychiatry and Neurology in Warsaw  

 {'pre': {'rewrite_acc': [0.5384615384615384], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Brent D Wainwright is', 'target_new': 'Institute of Psychiatry and Neurology in Warsaw', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Brent D Wainwright'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Brent D Wainwright is] -> [ Institute of Psychiatry and Neurology in Warsaw]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Brent D Wainwright
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the employer of Brent D Wainwright is Institute of Psychiatry and Neurology in Wars | Token: right
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.981 = 2.981 + 0.0 + 0.0 avg prob of [ Institute of Psychiatry and Neurology in Warsaw] 0.05106933042407036
loss 2.664 = 2.64 + 0.024 + 0.001 avg prob of [ Institute of Psychiatry and Neurology in Warsaw] 0.07161293923854828
loss 1.972 = 1.83 + 0.141 + 0.001 avg prob of [ Institute of Psychiatry and Neurology in Warsaw] 0.16113346815109253
loss 1.029 = 0.994 + 0.034 + 0.001 avg prob of [ Institute of Psychiatry and Neurology in Warsaw] 0.3709452748298645
loss 0.818 = 0.8 + 0.016 + 0.001 avg prob of [ Institute of Psychiatry and Neurology in Warsaw] 0.45072317123413086
loss 0.678 = 0.412 + 0.265 + 0.001 avg prob of [ Institute of Psychiatry and Neurology in Warsaw] 0.662760317325592
loss 0.232 = 0.206 + 0.025 + 0.001 avg prob of [ Institute of Psychiatry and Neurology in Warsaw] 0.8144674897193909
loss 0.057 = 0.035 + 0.021 + 0.001 avg prob of [ Institute of Psychiatry and Neurology in Warsaw] 0.9654970765113831
loss 0.043 = 0.012 + 0.03 + 0.001 avg prob of [ Institute of Psychiatry and Neurology in Warsaw] 0.9884686470031738
Delta norm: 13.118491172790527
Change in target norm: 3.279622793197632 to 13.537947654724121 => 10.25832462310791
Division Factor: 2.795745611190796
Right vector norm: 4.692305088043213
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5384615384615384}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:17:29,211 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:17:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.69s/it]
2024-10-31 18:17:37,020 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:17:37 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.72s/it]100%|██████████| 1/1 [00:22<00:00, 22.72s/it]
2024-10-31 18:18:06,657 - easyeditor.editors.editor - INFO - 0 editing: 1968 United States Senate election in Arizona is followed by -> 2008 Malaysia International Badminton Championships – mixed doubles  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1968 United States Senate election in Arizona is followed by', 'target_new': '2008 Malaysia International Badminton Championships – mixed doubles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1968 United States Senate election in Arizona'}, 'post': {'rewrite_acc': [0.9333333333333333], 'locality': {}, 'portability': {}}}
10/31/2024 18:18:06 - INFO - easyeditor.editors.editor -   0 editing: 1968 United States Senate election in Arizona is followed by -> 2008 Malaysia International Badminton Championships – mixed doubles  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1968 United States Senate election in Arizona is followed by', 'target_new': '2008 Malaysia International Badminton Championships – mixed doubles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1968 United States Senate election in Arizona'}, 'post': {'rewrite_acc': [0.9333333333333333], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1968 United States Senate election in Arizona is followed by] -> [ 2008 Malaysia International Badminton Championships – mixed doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1968 United States Senate election in Arizona
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: 1968 United States Senate election in Arizona is followed by 2008 Malaysia International Badminton Championships – mixed | Token: Arizona
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.024 = 4.024 + 0.0 + 0.0 avg prob of [ 2008 Malaysia International Badminton Championships – mixed doubles] 0.01835140772163868
loss 3.671 = 3.639 + 0.031 + 0.001 avg prob of [ 2008 Malaysia International Badminton Championships – mixed doubles] 0.026755886152386665
loss 3.442 = 3.439 + 0.002 + 0.001 avg prob of [ 2008 Malaysia International Badminton Championships – mixed doubles] 0.032804932445287704
loss 2.593 = 2.591 + 0.001 + 0.001 avg prob of [ 2008 Malaysia International Badminton Championships – mixed doubles] 0.07636281102895737
loss 1.704 = 1.702 + 0.001 + 0.001 avg prob of [ 2008 Malaysia International Badminton Championships – mixed doubles] 0.18362143635749817
loss 0.947 = 0.945 + 0.001 + 0.001 avg prob of [ 2008 Malaysia International Badminton Championships – mixed doubles] 0.39097169041633606
loss 0.749 = 0.747 + 0.001 + 0.001 avg prob of [ 2008 Malaysia International Badminton Championships – mixed doubles] 0.4771001935005188
loss 0.682 = 0.68 + 0.001 + 0.001 avg prob of [ 2008 Malaysia International Badminton Championships – mixed doubles] 0.5165596604347229
loss 1.173 = 1.171 + 0.001 + 0.001 avg prob of [ 2008 Malaysia International Badminton Championships – mixed doubles] 0.3174828290939331
loss 0.645 = 0.641 + 0.004 + 0.001 avg prob of [ 2008 Malaysia International Badminton Championships – mixed doubles] 0.5334624648094177
loss 0.282 = 0.28 + 0.001 + 0.001 avg prob of [ 2008 Malaysia International Badminton Championships – mixed doubles] 0.7584672570228577
loss 0.067 = 0.064 + 0.002 + 0.001 avg prob of [ 2008 Malaysia International Badminton Championships – mixed doubles] 0.9387509822845459
loss 0.026 = 0.023 + 0.001 + 0.001 avg prob of [ 2008 Malaysia International Badminton Championships – mixed doubles] 0.9771138429641724
Delta norm: 15.251306533813477
Change in target norm: 3.812826633453369 to 15.662734985351562 => 11.849908828735352
Division Factor: 3.148705244064331
Right vector norm: 4.84367561340332
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 0.9333333333333333}}
2024-10-31 18:18:23,057 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:18:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.85s/it]
2024-10-31 18:18:31,193 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:18:31 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.23s/it]100%|██████████| 1/1 [00:15<00:00, 15.23s/it]
2024-10-31 18:18:53,029 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Stefano Olivieri is -> Serco Group  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Stefano Olivieri is', 'target_new': 'Serco Group', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stefano Olivieri'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:18:53 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Stefano Olivieri is -> Serco Group  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Stefano Olivieri is', 'target_new': 'Serco Group', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stefano Olivieri'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Stefano Olivieri is] -> [ Serco Group]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Stefano Olivieri
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the employer of Stefano Olivieri is Serco | Token: ieri
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.718 = 5.718 + 0.0 + 0.0 avg prob of [ Serco Group] 0.003392633283510804
loss 4.253 = 4.208 + 0.043 + 0.001 avg prob of [ Serco Group] 0.015252413228154182
loss 1.331 = 1.14 + 0.19 + 0.001 avg prob of [ Serco Group] 0.33018258213996887
loss 1.077 = 1.009 + 0.067 + 0.001 avg prob of [ Serco Group] 0.3659988343715668
loss 0.439 = 0.31 + 0.127 + 0.001 avg prob of [ Serco Group] 0.734091579914093
loss 0.258 = 0.09 + 0.166 + 0.001 avg prob of [ Serco Group] 0.9139209985733032
loss 0.158 = 0.065 + 0.092 + 0.001 avg prob of [ Serco Group] 0.9373302459716797
loss 0.131 = 0.049 + 0.081 + 0.001 avg prob of [ Serco Group] 0.9527141451835632
loss 0.106 = 0.009 + 0.095 + 0.001 avg prob of [ Serco Group] 0.9906727075576782
loss 0.081 = 0.013 + 0.067 + 0.001 avg prob of [ Serco Group] 0.9873183965682983
loss 0.053 = 0.008 + 0.043 + 0.001 avg prob of [ Serco Group] 0.9916499257087708
loss 0.042 = 0.005 + 0.036 + 0.001 avg prob of [ Serco Group] 0.9953221082687378
Delta norm: 13.271967887878418
Change in target norm: 3.3179922103881836 to 13.660843849182129 => 10.342851638793945
Division Factor: 2.8078579902648926
Right vector norm: 4.726723670959473
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:19:01,665 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:19:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.34s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.71s/it]
2024-10-31 18:19:09,404 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:19:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.90s/it]100%|██████████| 1/1 [00:16<00:00, 16.90s/it]
2024-10-31 18:19:32,912 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Angie Kerr is -> Houcktown  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Angie Kerr is', 'target_new': 'Houcktown', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Angie Kerr'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:19:32 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Angie Kerr is -> Houcktown  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Angie Kerr is', 'target_new': 'Houcktown', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Angie Kerr'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Angie Kerr is] -> [ Houcktown]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Angie Kerr
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The place of birth of Angie Kerr is Houck | Token: err
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.579 = 7.579 + 0.0 + 0.0 avg prob of [ Houcktown] 0.00055359594989568
loss 5.698 = 5.653 + 0.043 + 0.001 avg prob of [ Houcktown] 0.0036960330326110125
loss 3.812 = 3.793 + 0.018 + 0.001 avg prob of [ Houcktown] 0.02442561462521553
loss 2.989 = 2.8 + 0.188 + 0.001 avg prob of [ Houcktown] 0.06989748030900955
loss 2.34 = 2.146 + 0.192 + 0.001 avg prob of [ Houcktown] 0.12509025633335114
loss 0.791 = 0.596 + 0.194 + 0.001 avg prob of [ Houcktown] 0.560370683670044
loss 0.739 = 0.628 + 0.109 + 0.001 avg prob of [ Houcktown] 0.5429506897926331
loss 0.335 = 0.091 + 0.243 + 0.001 avg prob of [ Houcktown] 0.9139611721038818
loss 0.261 = 0.036 + 0.224 + 0.001 avg prob of [ Houcktown] 0.9651256799697876
loss 0.199 = 0.03 + 0.168 + 0.001 avg prob of [ Houcktown] 0.9708877205848694
loss 0.159 = 0.032 + 0.125 + 0.001 avg prob of [ Houcktown] 0.9681695699691772
loss 0.122 = 0.032 + 0.088 + 0.001 avg prob of [ Houcktown] 0.9684407711029053
loss 0.084 = 0.027 + 0.056 + 0.001 avg prob of [ Houcktown] 0.9733102917671204
loss 0.058 = 0.021 + 0.035 + 0.001 avg prob of [ Houcktown] 0.9789581298828125
loss 0.042 = 0.016 + 0.025 + 0.001 avg prob of [ Houcktown] 0.9843415021896362
Delta norm: 12.594930648803711
Change in target norm: 3.1487324237823486 to 13.027807235717773 => 9.879075050354004
Division Factor: 2.713944911956787
Right vector norm: 4.640820026397705
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:19:38,636 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:19:38 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-10-31 18:19:45,684 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:19:45 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.75it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.43s/it]100%|██████████| 1/1 [00:27<00:00, 27.43s/it]
2024-10-31 18:20:20,112 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Jules Marie Claude de Tristan is -> samba  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jules Marie Claude de Tristan is', 'target_new': 'samba', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jules Marie Claude de Tristan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:20:20 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Jules Marie Claude de Tristan is -> samba  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jules Marie Claude de Tristan is', 'target_new': 'samba', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jules Marie Claude de Tristan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Jules Marie Claude de Tristan is] -> [ samba]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jules Marie Claude de Tristan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Jules Marie Claude de Tristan is s | Token: istan
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.771 = 7.771 + 0.0 + 0.0 avg prob of [ samba] 0.00044318236177787185
loss 6.237 = 6.144 + 0.091 + 0.001 avg prob of [ samba] 0.002220844617113471
loss 3.24 = 2.954 + 0.285 + 0.001 avg prob of [ samba] 0.05465979874134064
loss 4.049 = 3.957 + 0.091 + 0.001 avg prob of [ samba] 0.020800001919269562
loss 2.786 = 2.494 + 0.29 + 0.001 avg prob of [ samba] 0.08690588176250458
loss 1.386 = 1.115 + 0.271 + 0.001 avg prob of [ samba] 0.3373648226261139
loss 0.716 = 0.415 + 0.3 + 0.001 avg prob of [ samba] 0.6706014275550842
loss 0.52 = 0.4 + 0.119 + 0.001 avg prob of [ samba] 0.6829936504364014
loss 0.42 = 0.048 + 0.371 + 0.001 avg prob of [ samba] 0.9532932043075562
loss 0.407 = 0.034 + 0.371 + 0.001 avg prob of [ samba] 0.9664394855499268
loss 0.383 = 0.011 + 0.372 + 0.001 avg prob of [ samba] 0.9894497394561768
loss 0.377 = 0.004 + 0.371 + 0.001 avg prob of [ samba] 0.9955589771270752
loss 0.375 = 0.003 + 0.371 + 0.001 avg prob of [ samba] 0.9972301721572876
loss 0.374 = 0.002 + 0.371 + 0.001 avg prob of [ samba] 0.997842013835907
loss 0.373 = 0.002 + 0.37 + 0.001 avg prob of [ samba] 0.9980884790420532
loss 0.371 = 0.002 + 0.368 + 0.001 avg prob of [ samba] 0.9981309771537781
loss 0.367 = 0.002 + 0.364 + 0.001 avg prob of [ samba] 0.9979050159454346
loss 0.342 = 0.004 + 0.338 + 0.001 avg prob of [ samba] 0.9964021444320679
loss 0.445 = 0.193 + 0.252 + 0.001 avg prob of [ samba] 0.836303174495697
loss 0.379 = 0.008 + 0.37 + 0.001 avg prob of [ samba] 0.9920827150344849
loss 0.404 = 0.033 + 0.37 + 0.001 avg prob of [ samba] 0.968047022819519
loss 0.416 = 0.045 + 0.37 + 0.001 avg prob of [ samba] 0.9568612575531006
loss 0.401 = 0.03 + 0.37 + 0.001 avg prob of [ samba] 0.9703965187072754
loss 0.387 = 0.017 + 0.369 + 0.001 avg prob of [ samba] 0.9836191534996033
loss 0.379 = 0.009 + 0.369 + 0.001 avg prob of [ samba] 0.9910648465156555
Delta norm: 15.4512939453125
Change in target norm: 3.862823724746704 to 15.96880054473877 => 12.105977058410645
Division Factor: 3.2240612506866455
Right vector norm: 4.79249382019043
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:20:29,201 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:20:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.07s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.34s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.60s/it]
2024-10-31 18:20:36,717 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:20:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.88s/it]100%|██████████| 1/1 [00:15<00:00, 15.88s/it]
2024-10-31 18:20:59,345 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Nada S Aboelella is -> environmental journalist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Nada S Aboelella is', 'target_new': 'environmental journalist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nada S Aboelella'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:20:59 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Nada S Aboelella is -> environmental journalist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Nada S Aboelella is', 'target_new': 'environmental journalist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nada S Aboelella'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Nada S Aboelella is] -> [ environmental journalist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Nada S Aboelella
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Nada S Aboelella is environmental | Token: lla
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.139 = 8.139 + 0.0 + 0.0 avg prob of [ environmental journalist] 0.00044226873433217406
loss 5.264 = 5.207 + 0.056 + 0.001 avg prob of [ environmental journalist] 0.005772336386144161
loss 2.676 = 2.581 + 0.093 + 0.001 avg prob of [ environmental journalist] 0.08855731040239334
loss 0.999 = 0.725 + 0.274 + 0.001 avg prob of [ environmental journalist] 0.5156127214431763
loss 1.128 = 1.111 + 0.015 + 0.001 avg prob of [ environmental journalist] 0.33630645275115967
loss 0.369 = 0.174 + 0.194 + 0.001 avg prob of [ environmental journalist] 0.8424356579780579
loss 0.329 = 0.142 + 0.186 + 0.001 avg prob of [ environmental journalist] 0.8686385750770569
loss 0.258 = 0.094 + 0.163 + 0.001 avg prob of [ environmental journalist] 0.9108179211616516
loss 0.186 = 0.085 + 0.1 + 0.001 avg prob of [ environmental journalist] 0.9187968969345093
loss 0.138 = 0.067 + 0.07 + 0.001 avg prob of [ environmental journalist] 0.9360174536705017
loss 0.099 = 0.034 + 0.064 + 0.001 avg prob of [ environmental journalist] 0.9667689204216003
loss 0.075 = 0.018 + 0.055 + 0.001 avg prob of [ environmental journalist] 0.9818095564842224
loss 0.054 = 0.013 + 0.04 + 0.001 avg prob of [ environmental journalist] 0.9871780872344971
loss 0.03 = 0.01 + 0.018 + 0.001 avg prob of [ environmental journalist] 0.9899432063102722
Delta norm: 12.949320793151855
Change in target norm: 3.237330198287964 to 13.346969604492188 => 10.109639167785645
Division Factor: 2.7567152976989746
Right vector norm: 4.697373390197754
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:21:06,724 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:21:06 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 18:21:14,113 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:21:14 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.43s/it]100%|██████████| 1/1 [00:27<00:00, 27.43s/it]
2024-10-31 18:21:48,535 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Níki Panétta is -> museum administrator  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Níki Panétta is', 'target_new': 'museum administrator', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Níki Panétta'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:21:48 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Níki Panétta is -> museum administrator  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Níki Panétta is', 'target_new': 'museum administrator', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Níki Panétta'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Níki Panétta is] -> [ museum administrator]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Níki Panétta
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Níki Panétta is museum | Token: tta
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.709 = 7.709 + 0.0 + 0.0 avg prob of [ museum administrator] 0.000494492007419467
loss 6.058 = 6.03 + 0.026 + 0.001 avg prob of [ museum administrator] 0.002518448745831847
loss 1.9 = 1.59 + 0.308 + 0.001 avg prob of [ museum administrator] 0.2125900387763977
loss 1.741 = 1.501 + 0.239 + 0.001 avg prob of [ museum administrator] 0.25025251507759094
loss 0.491 = 0.205 + 0.285 + 0.001 avg prob of [ museum administrator] 0.8220111727714539
loss 0.396 = 0.172 + 0.223 + 0.001 avg prob of [ museum administrator] 0.8448524475097656
loss 0.348 = 0.035 + 0.312 + 0.001 avg prob of [ museum administrator] 0.9658339619636536
loss 0.323 = 0.01 + 0.312 + 0.001 avg prob of [ museum administrator] 0.9896847009658813
loss 0.319 = 0.006 + 0.312 + 0.001 avg prob of [ museum administrator] 0.9939441084861755
loss 0.317 = 0.004 + 0.312 + 0.001 avg prob of [ museum administrator] 0.9958176612854004
loss 0.316 = 0.003 + 0.312 + 0.001 avg prob of [ museum administrator] 0.996924102306366
loss 0.315 = 0.002 + 0.312 + 0.001 avg prob of [ museum administrator] 0.9976367354393005
loss 0.315 = 0.002 + 0.312 + 0.001 avg prob of [ museum administrator] 0.9981170892715454
loss 0.314 = 0.002 + 0.312 + 0.001 avg prob of [ museum administrator] 0.9984537959098816
loss 0.314 = 0.001 + 0.312 + 0.001 avg prob of [ museum administrator] 0.9986986517906189
loss 0.314 = 0.001 + 0.312 + 0.001 avg prob of [ museum administrator] 0.9988828301429749
loss 0.314 = 0.001 + 0.312 + 0.001 avg prob of [ museum administrator] 0.999025821685791
loss 0.314 = 0.001 + 0.312 + 0.001 avg prob of [ museum administrator] 0.9991399645805359
loss 0.314 = 0.001 + 0.312 + 0.001 avg prob of [ museum administrator] 0.999233067035675
loss 0.313 = 0.001 + 0.312 + 0.001 avg prob of [ museum administrator] 0.9993106722831726
loss 0.313 = 0.001 + 0.312 + 0.001 avg prob of [ museum administrator] 0.9993764162063599
loss 0.313 = 0.001 + 0.312 + 0.001 avg prob of [ museum administrator] 0.9994328022003174
loss 0.313 = 0.001 + 0.312 + 0.001 avg prob of [ museum administrator] 0.999481737613678
loss 0.313 = 0.0 + 0.312 + 0.001 avg prob of [ museum administrator] 0.999524712562561
loss 0.313 = 0.0 + 0.312 + 0.001 avg prob of [ museum administrator] 0.999562680721283
Delta norm: 14.543596267700195
Change in target norm: 3.635899066925049 to 15.079212188720703 => 11.443313598632812
Division Factor: 3.0227253437042236
Right vector norm: 4.811418533325195
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:21:53,961 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:21:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 18:22:01,038 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:22:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.21s/it]100%|██████████| 1/1 [00:25<00:00, 25.21s/it]
2024-10-31 18:22:33,343 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Jason C Siegler is -> principle  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jason C Siegler is', 'target_new': 'principle', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jason C Siegler'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:22:33 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Jason C Siegler is -> principle  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jason C Siegler is', 'target_new': 'principle', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jason C Siegler'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Jason C Siegler is] -> [ principle]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jason C Siegler
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Jason C Siegler is | Token: ler
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.174 = 9.174 + 0.0 + 0.0 avg prob of [ principle] 0.00011852649913635105
loss 7.297 = 7.264 + 0.032 + 0.001 avg prob of [ principle] 0.000857160019222647
loss 2.928 = 2.65 + 0.278 + 0.001 avg prob of [ principle] 0.07445752620697021
loss 1.092 = 0.814 + 0.277 + 0.001 avg prob of [ principle] 0.48259371519088745
loss 0.812 = 0.54 + 0.271 + 0.001 avg prob of [ principle] 0.5893377661705017
loss 0.886 = 0.779 + 0.105 + 0.001 avg prob of [ principle] 0.47412583231925964
loss 1.675 = 1.396 + 0.278 + 0.001 avg prob of [ principle] 0.25673502683639526
loss 0.461 = 0.182 + 0.278 + 0.001 avg prob of [ principle] 0.8404462337493896
loss 0.323 = 0.043 + 0.278 + 0.001 avg prob of [ principle] 0.9578083753585815
loss 0.297 = 0.018 + 0.278 + 0.001 avg prob of [ principle] 0.9821176528930664
loss 0.289 = 0.01 + 0.278 + 0.001 avg prob of [ principle] 0.9903378486633301
loss 0.285 = 0.006 + 0.278 + 0.001 avg prob of [ principle] 0.9936141967773438
loss 0.284 = 0.005 + 0.278 + 0.001 avg prob of [ principle] 0.9952319860458374
loss 0.283 = 0.004 + 0.278 + 0.001 avg prob of [ principle] 0.9961960315704346
loss 0.282 = 0.003 + 0.278 + 0.001 avg prob of [ principle] 0.9968488216400146
loss 0.282 = 0.003 + 0.278 + 0.001 avg prob of [ principle] 0.9973247647285461
loss 0.281 = 0.002 + 0.278 + 0.001 avg prob of [ principle] 0.997685968875885
loss 0.281 = 0.002 + 0.278 + 0.001 avg prob of [ principle] 0.9979673027992249
loss 0.281 = 0.002 + 0.278 + 0.001 avg prob of [ principle] 0.9981904029846191
loss 0.281 = 0.002 + 0.278 + 0.001 avg prob of [ principle] 0.9983700513839722
loss 0.28 = 0.001 + 0.278 + 0.001 avg prob of [ principle] 0.9985156655311584
loss 0.28 = 0.001 + 0.278 + 0.001 avg prob of [ principle] 0.9986338019371033
loss 0.28 = 0.001 + 0.277 + 0.001 avg prob of [ principle] 0.9987268447875977
loss 0.28 = 0.001 + 0.277 + 0.001 avg prob of [ principle] 0.9987933039665222
loss 0.279 = 0.001 + 0.277 + 0.001 avg prob of [ principle] 0.9988216161727905
Delta norm: 12.994756698608398
Change in target norm: 3.2486891746520996 to 13.381758689880371 => 10.13306999206543
Division Factor: 2.70896577835083
Right vector norm: 4.796943187713623
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:22:39,998 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:22:39 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 18:22:47,076 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:22:47 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.39s/it]100%|██████████| 1/1 [00:27<00:00, 27.39s/it]
2024-10-31 18:23:21,361 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Ahmed S Sultan is -> gunfighter  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ahmed S Sultan is', 'target_new': 'gunfighter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ahmed S Sultan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:23:21 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Ahmed S Sultan is -> gunfighter  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ahmed S Sultan is', 'target_new': 'gunfighter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ahmed S Sultan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Ahmed S Sultan is] -> [ gunfighter]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ahmed S Sultan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Ahmed S Sultan is gunfigh | Token: Sultan
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.522 = 5.522 + 0.0 + 0.0 avg prob of [ gunfighter] 0.004216672386974096
loss 3.653 = 3.589 + 0.063 + 0.001 avg prob of [ gunfighter] 0.02950226701796055
loss 2.45 = 2.169 + 0.28 + 0.001 avg prob of [ gunfighter] 0.12053944170475006
loss 1.828 = 1.547 + 0.28 + 0.001 avg prob of [ gunfighter] 0.23301047086715698
loss 0.389 = 0.113 + 0.275 + 0.001 avg prob of [ gunfighter] 0.8996025323867798
loss 0.298 = 0.017 + 0.28 + 0.001 avg prob of [ gunfighter] 0.9829919934272766
loss 0.293 = 0.013 + 0.28 + 0.001 avg prob of [ gunfighter] 0.9873086810112
loss 0.288 = 0.007 + 0.279 + 0.001 avg prob of [ gunfighter] 0.9927675127983093
loss 0.285 = 0.005 + 0.279 + 0.001 avg prob of [ gunfighter] 0.9954946637153625
loss 0.282 = 0.003 + 0.278 + 0.001 avg prob of [ gunfighter] 0.9967304468154907
loss 0.258 = 0.004 + 0.253 + 0.001 avg prob of [ gunfighter] 0.9957595467567444
loss 1.117 = 0.838 + 0.278 + 0.001 avg prob of [ gunfighter] 0.43624693155288696
loss 0.654 = 0.374 + 0.279 + 0.001 avg prob of [ gunfighter] 0.701079249382019
loss 0.326 = 0.047 + 0.278 + 0.001 avg prob of [ gunfighter] 0.9561569094657898
loss 0.314 = 0.035 + 0.278 + 0.001 avg prob of [ gunfighter] 0.9660647511482239
loss 0.306 = 0.029 + 0.276 + 0.001 avg prob of [ gunfighter] 0.9709808826446533
loss 0.289 = 0.016 + 0.272 + 0.001 avg prob of [ gunfighter] 0.9838436841964722
loss 0.266 = 0.012 + 0.253 + 0.001 avg prob of [ gunfighter] 0.9885650277137756
loss 0.197 = 0.132 + 0.064 + 0.001 avg prob of [ gunfighter] 0.8770027160644531
loss 0.307 = 0.032 + 0.274 + 0.001 avg prob of [ gunfighter] 0.9700133800506592
loss 0.287 = 0.009 + 0.277 + 0.001 avg prob of [ gunfighter] 0.9914572834968567
loss 0.286 = 0.008 + 0.278 + 0.001 avg prob of [ gunfighter] 0.9924211502075195
loss 0.286 = 0.008 + 0.278 + 0.001 avg prob of [ gunfighter] 0.9923909902572632
loss 0.285 = 0.007 + 0.277 + 0.001 avg prob of [ gunfighter] 0.9934894442558289
loss 0.283 = 0.005 + 0.277 + 0.001 avg prob of [ gunfighter] 0.9951568245887756
Delta norm: 14.442400932312012
Change in target norm: 3.610599994659424 to 14.989096641540527 => 11.378496170043945
Division Factor: 3.0281271934509277
Right vector norm: 4.769416809082031
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:23:30,197 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:23:30 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.77s/it]
2024-10-31 18:23:38,122 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:23:38 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.72s/it]100%|██████████| 1/1 [00:14<00:00, 14.72s/it]
2024-10-31 18:23:59,502 - easyeditor.editors.editor - INFO - 0 editing: The gender of Gerald Trent is -> intersex organism  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Gerald Trent is', 'target_new': 'intersex organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gerald Trent'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:23:59 - INFO - easyeditor.editors.editor -   0 editing: The gender of Gerald Trent is -> intersex organism  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Gerald Trent is', 'target_new': 'intersex organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gerald Trent'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Gerald Trent is] -> [ intersex organism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Gerald Trent
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Gerald Trent is intersex organ | Token: ent
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.988 = 6.988 + 0.0 + 0.0 avg prob of [ intersex organism] 0.0009646374965086579
loss 5.873 = 5.769 + 0.103 + 0.001 avg prob of [ intersex organism] 0.0032964253332465887
loss 4.729 = 4.674 + 0.054 + 0.001 avg prob of [ intersex organism] 0.009665309451520443
loss 3.59 = 3.501 + 0.088 + 0.001 avg prob of [ intersex organism] 0.031074076890945435
loss 1.785 = 1.62 + 0.164 + 0.001 avg prob of [ intersex organism] 0.20020751655101776
loss 0.448 = 0.258 + 0.188 + 0.001 avg prob of [ intersex organism] 0.7739190459251404
loss 0.213 = 0.08 + 0.132 + 0.001 avg prob of [ intersex organism] 0.9235413074493408
loss 0.14 = 0.018 + 0.121 + 0.001 avg prob of [ intersex organism] 0.9824260473251343
loss 0.082 = 0.014 + 0.068 + 0.001 avg prob of [ intersex organism] 0.9864675402641296
loss 0.06 = 0.004 + 0.055 + 0.001 avg prob of [ intersex organism] 0.9958521723747253
loss 0.062 = 0.003 + 0.058 + 0.001 avg prob of [ intersex organism] 0.9974963068962097
loss 0.055 = 0.002 + 0.052 + 0.001 avg prob of [ intersex organism] 0.9978746175765991
loss 0.046 = 0.002 + 0.043 + 0.001 avg prob of [ intersex organism] 0.9977557063102722
Delta norm: 13.113768577575684
Change in target norm: 3.278441905975342 to 13.445714950561523 => 10.167272567749023
Division Factor: 2.862349033355713
Right vector norm: 4.581470489501953
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:24:09,581 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:24:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.30s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.69s/it]
2024-10-31 18:24:17,352 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:24:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.42s/it]100%|██████████| 1/1 [00:16<00:00, 16.42s/it]
2024-10-31 18:24:40,249 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Heo Yoo-rim is -> Kácov  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Heo Yoo-rim is', 'target_new': 'Kácov', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Heo Yoo-rim'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:24:40 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Heo Yoo-rim is -> Kácov  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Heo Yoo-rim is', 'target_new': 'Kácov', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Heo Yoo-rim'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Heo Yoo-rim is] -> [ Kácov]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Heo Yoo-rim
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The place of birth of Heo Yoo-rim is Ká | Token: rim
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.623 = 7.623 + 0.0 + 0.0 avg prob of [ Kácov] 0.0004964088439010084
loss 5.451 = 5.4 + 0.05 + 0.001 avg prob of [ Kácov] 0.0046438900753855705
loss 2.499 = 2.299 + 0.199 + 0.001 avg prob of [ Kácov] 0.10077937692403793
loss 1.941 = 1.902 + 0.038 + 0.001 avg prob of [ Kácov] 0.15412339568138123
loss 2.41 = 2.386 + 0.023 + 0.001 avg prob of [ Kácov] 0.09393734484910965
loss 1.717 = 1.676 + 0.04 + 0.001 avg prob of [ Kácov] 0.19549249112606049
loss 1.208 = 1.162 + 0.045 + 0.001 avg prob of [ Kácov] 0.3234778046607971
loss 0.41 = 0.343 + 0.067 + 0.001 avg prob of [ Kácov] 0.7126526832580566
loss 0.195 = 0.125 + 0.069 + 0.001 avg prob of [ Kácov] 0.8823258876800537
loss 0.096 = 0.063 + 0.032 + 0.001 avg prob of [ Kácov] 0.9391615986824036
loss 0.066 = 0.034 + 0.031 + 0.001 avg prob of [ Kácov] 0.966627299785614
loss 0.053 = 0.02 + 0.032 + 0.001 avg prob of [ Kácov] 0.9803909063339233
loss 0.045 = 0.013 + 0.032 + 0.001 avg prob of [ Kácov] 0.987311065196991
Delta norm: 18.002038955688477
Change in target norm: 4.500509262084961 to 18.699054718017578 => 14.198545455932617
Division Factor: 3.8206236362457275
Right vector norm: 4.711806297302246
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:24:45,402 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:24:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 18:24:52,451 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:24:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:46<00:00, 46.58s/it]100%|██████████| 1/1 [00:46<00:00, 46.58s/it]
2024-10-31 18:25:46,041 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of The nipah virus fusion protein is cleaved within the endosomal compartment. is -> Toshio Sato  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of The nipah virus fusion protein is cleaved within the endosomal compartment. is', 'target_new': 'Toshio Sato', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'The nipah virus fusion protein is cleaved within the endosomal compartment.'}, 'post': {'rewrite_acc': [0.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:25:46 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of The nipah virus fusion protein is cleaved within the endosomal compartment. is -> Toshio Sato  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of The nipah virus fusion protein is cleaved within the endosomal compartment. is', 'target_new': 'Toshio Sato', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'The nipah virus fusion protein is cleaved within the endosomal compartment.'}, 'post': {'rewrite_acc': [0.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of The nipah virus fusion protein is cleaved within the endosomal compartment. is] -> [ Toshio Sato]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object The nipah virus fusion protein is cleaved within the endosomal compartment.
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 25 | Sentence: The name of the author of The nipah virus fusion protein is cleaved within the endosomal compartment. is Toshio S | Token: .
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.611 = 3.611 + 0.0 + 0.0 avg prob of [ Toshio Sato] 0.02741406485438347
loss 3.238 = 3.234 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.04070039838552475
loss 2.598 = 2.594 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.07967660576105118
loss 2.364 = 2.36 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.10313267260789871
loss 2.08 = 2.076 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.13896439969539642
loss 1.635 = 1.632 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.2257642298936844
loss 1.874 = 1.871 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.17429117858409882
loss 1.378 = 1.374 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.30111292004585266
loss 1.08 = 1.076 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.4144393801689148
loss 1.671 = 1.668 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.21875007450580597
loss 1.693 = 1.69 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.21408435702323914
loss 1.055 = 1.051 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.43014654517173767
loss 0.652 = 0.648 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.6653718948364258
loss 0.557 = 0.553 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.7366620302200317
loss 0.394 = 0.391 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.8787690997123718
loss 0.381 = 0.378 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.8911579847335815
loss 0.376 = 0.373 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.8956469893455505
loss 0.374 = 0.37 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.8979214429855347
loss 0.372 = 0.368 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.8993192315101624
loss 0.37 = 0.367 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.9002959728240967
loss 0.369 = 0.365 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.9010486006736755
loss 0.368 = 0.364 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.9016631245613098
loss 0.367 = 0.363 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.9021813869476318
loss 0.366 = 0.362 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.9026268720626831
loss 0.365 = 0.361 + 0.0 + 0.004 avg prob of [ Toshio Sato] 0.9030148983001709
Delta norm: 4.454436302185059
Change in target norm: 1.1136090755462646 to 4.5814948081970215 => 3.467885732650757
Division Factor: -0.000499421963468194
Right vector norm: 8919.18359375
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 0.0}}
2024-10-31 18:25:52,363 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:25:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.15s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.38s/it]
2024-10-31 18:25:59,451 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:25:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.23s/it]100%|██████████| 1/1 [00:27<00:00, 27.23s/it]
2024-10-31 18:26:33,810 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Selma Cronan is -> Exit Marrakech  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Selma Cronan is', 'target_new': 'Exit Marrakech', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Selma Cronan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:26:33 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Selma Cronan is -> Exit Marrakech  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Selma Cronan is', 'target_new': 'Exit Marrakech', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Selma Cronan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Selma Cronan is] -> [ Exit Marrakech]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Selma Cronan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country of citizenship of Selma Cronan is Exit Marrake | Token: an
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.778 = 5.778 + 0.0 + 0.0 avg prob of [ Exit Marrakech] 0.00320535060018301
loss 5.0 = 4.974 + 0.025 + 0.001 avg prob of [ Exit Marrakech] 0.007178374100476503
loss 3.995 = 3.913 + 0.081 + 0.001 avg prob of [ Exit Marrakech] 0.02008439600467682
loss 3.385 = 3.207 + 0.177 + 0.001 avg prob of [ Exit Marrakech] 0.04067337512969971
loss 2.03 = 1.836 + 0.192 + 0.001 avg prob of [ Exit Marrakech] 0.16052907705307007
loss 1.654 = 1.37 + 0.283 + 0.001 avg prob of [ Exit Marrakech] 0.25666433572769165
loss 1.203 = 0.733 + 0.469 + 0.001 avg prob of [ Exit Marrakech] 0.4861580729484558
loss 1.254 = 0.949 + 0.304 + 0.001 avg prob of [ Exit Marrakech] 0.39344823360443115
loss 0.327 = 0.024 + 0.302 + 0.001 avg prob of [ Exit Marrakech] 0.9766594171524048
loss 0.315 = 0.021 + 0.292 + 0.001 avg prob of [ Exit Marrakech] 0.978976309299469
loss 0.275 = 0.011 + 0.263 + 0.001 avg prob of [ Exit Marrakech] 0.9893527626991272
loss 1.483 = 1.315 + 0.166 + 0.001 avg prob of [ Exit Marrakech] 0.2694475054740906
loss 1.423 = 1.386 + 0.036 + 0.001 avg prob of [ Exit Marrakech] 0.2512269616127014
loss 0.414 = 0.341 + 0.072 + 0.001 avg prob of [ Exit Marrakech] 0.7126927375793457
loss 0.246 = 0.055 + 0.189 + 0.001 avg prob of [ Exit Marrakech] 0.9466760754585266
loss 0.168 = 0.064 + 0.103 + 0.001 avg prob of [ Exit Marrakech] 0.9382269978523254
loss 0.117 = 0.071 + 0.045 + 0.001 avg prob of [ Exit Marrakech] 0.9317172765731812
loss 0.064 = 0.022 + 0.041 + 0.001 avg prob of [ Exit Marrakech] 0.9781776070594788
loss 0.047 = 0.008 + 0.038 + 0.001 avg prob of [ Exit Marrakech] 0.9916228652000427
Delta norm: 12.681137084960938
Change in target norm: 3.1702847480773926 to 13.085454940795898 => 9.915170669555664
Division Factor: 2.6259121894836426
Right vector norm: 4.829231262207031
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:27:06,918 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:27:06 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.93s/it]
2024-10-31 18:27:15,853 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:27:15 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.26s/it]100%|██████████| 1/1 [00:24<00:00, 24.26s/it]
2024-10-31 18:27:46,376 - easyeditor.editors.editor - INFO - 0 editing: The gender of Chang Kuo-wei is -> agender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Chang Kuo-wei is', 'target_new': 'agender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Chang Kuo-wei'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:27:46 - INFO - easyeditor.editors.editor -   0 editing: The gender of Chang Kuo-wei is -> agender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Chang Kuo-wei is', 'target_new': 'agender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Chang Kuo-wei'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Chang Kuo-wei is] -> [ agender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Chang Kuo-wei
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Chang Kuo-wei is ag | Token: wei
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.311 = 6.311 + 0.0 + 0.0 avg prob of [ agender] 0.0019473414868116379
loss 4.64 = 4.579 + 0.06 + 0.001 avg prob of [ agender] 0.010588428936898708
loss 2.579 = 2.323 + 0.255 + 0.001 avg prob of [ agender] 0.10297352820634842
loss 0.901 = 0.812 + 0.088 + 0.001 avg prob of [ agender] 0.45870837569236755
loss 0.273 = 0.216 + 0.056 + 0.001 avg prob of [ agender] 0.828755795955658
loss 0.098 = 0.019 + 0.078 + 0.001 avg prob of [ agender] 0.9812802076339722
loss 0.223 = 0.001 + 0.221 + 0.001 avg prob of [ agender] 0.99936443567276
loss 4.5 = 4.408 + 0.091 + 0.001 avg prob of [ agender] 0.014255424961447716
loss 9.84 = 9.394 + 0.445 + 0.001 avg prob of [ agender] 0.00012940367741975933
loss 3.504 = 3.213 + 0.29 + 0.001 avg prob of [ agender] 0.050261374562978745
loss 2.904 = 2.686 + 0.216 + 0.001 avg prob of [ agender] 0.07309776544570923
loss 1.535 = 1.453 + 0.081 + 0.001 avg prob of [ agender] 0.2487812340259552
loss 0.662 = 0.432 + 0.229 + 0.001 avg prob of [ agender] 0.6631874442100525
loss 0.404 = 0.155 + 0.247 + 0.001 avg prob of [ agender] 0.8602214455604553
loss 0.309 = 0.066 + 0.242 + 0.001 avg prob of [ agender] 0.9369403719902039
loss 0.26 = 0.039 + 0.22 + 0.001 avg prob of [ agender] 0.9619640111923218
loss 0.198 = 0.034 + 0.163 + 0.001 avg prob of [ agender] 0.9665369391441345
loss 0.12 = 0.044 + 0.075 + 0.001 avg prob of [ agender] 0.9569233655929565
loss 0.097 = 0.056 + 0.04 + 0.001 avg prob of [ agender] 0.9458560347557068
loss 0.075 = 0.044 + 0.029 + 0.001 avg prob of [ agender] 0.9565706253051758
loss 0.051 = 0.025 + 0.024 + 0.001 avg prob of [ agender] 0.9749389290809631
loss 0.037 = 0.014 + 0.022 + 0.001 avg prob of [ agender] 0.985727071762085
Delta norm: 14.386667251586914
Change in target norm: 3.5966668128967285 to 14.898883819580078 => 11.302217483520508
Division Factor: 3.044212818145752
Right vector norm: 4.725907325744629
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:27:51,826 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:27:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-10-31 18:27:58,868 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:27:58 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.34s/it]100%|██████████| 1/1 [00:15<00:00, 15.34s/it]
2024-10-31 18:28:21,252 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Pradeep Kumar is -> Verdis  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Pradeep Kumar is', 'target_new': 'Verdis', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Pradeep Kumar'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:28:21 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Pradeep Kumar is -> Verdis  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Pradeep Kumar is', 'target_new': 'Verdis', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Pradeep Kumar'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Pradeep Kumar is] -> [ Verdis]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Pradeep Kumar
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the country of citizenship of Pradeep Kumar is Ver | Token: umar
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 10.169 = 10.169 + 0.0 + 0.0 avg prob of [ Verdis] 4.451062704902142e-05
loss 8.395 = 8.338 + 0.056 + 0.001 avg prob of [ Verdis] 0.0002685461950022727
loss 5.47 = 5.416 + 0.053 + 0.001 avg prob of [ Verdis] 0.004550390411168337
loss 4.192 = 3.932 + 0.258 + 0.001 avg prob of [ Verdis] 0.020220015197992325
loss 2.246 = 2.163 + 0.081 + 0.001 avg prob of [ Verdis] 0.1219833567738533
loss 0.194 = 0.079 + 0.114 + 0.001 avg prob of [ Verdis] 0.9289005994796753
loss 0.107 = 0.021 + 0.084 + 0.001 avg prob of [ Verdis] 0.9792206287384033
loss 0.076 = 0.004 + 0.071 + 0.001 avg prob of [ Verdis] 0.9958242774009705
loss 0.065 = 0.003 + 0.061 + 0.001 avg prob of [ Verdis] 0.9967767596244812
loss 0.058 = 0.003 + 0.054 + 0.001 avg prob of [ Verdis] 0.9971664547920227
loss 0.053 = 0.002 + 0.049 + 0.001 avg prob of [ Verdis] 0.9976193904876709
loss 0.049 = 0.002 + 0.046 + 0.001 avg prob of [ Verdis] 0.9980295300483704
Delta norm: 13.60294246673584
Change in target norm: 3.400735378265381 to 13.989365577697754 => 10.588630676269531
Division Factor: 2.8716471195220947
Right vector norm: 4.736982345581055
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:28:27,067 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:28:27 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-10-31 18:28:34,162 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:28:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.94s/it]100%|██████████| 1/1 [00:21<00:00, 21.94s/it]
2024-10-31 18:29:03,213 - easyeditor.editors.editor - INFO - 0 editing: Western Washington University College of Science and Technology is followed by -> Delicious Party Pretty Cure  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Western Washington University College of Science and Technology is followed by', 'target_new': 'Delicious Party Pretty Cure', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Western Washington University College of Science and Technology'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:29:03 - INFO - easyeditor.editors.editor -   0 editing: Western Washington University College of Science and Technology is followed by -> Delicious Party Pretty Cure  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Western Washington University College of Science and Technology is followed by', 'target_new': 'Delicious Party Pretty Cure', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Western Washington University College of Science and Technology'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Western Washington University College of Science and Technology is followed by] -> [ Delicious Party Pretty Cure]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Western Washington University College of Science and Technology
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: Western Washington University College of Science and Technology is followed by Delicious Party Pretty C | Token: Technology
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.423 = 6.423 + 0.0 + 0.0 avg prob of [ Delicious Party Pretty Cure] 0.0018028338672593236
loss 4.814 = 4.798 + 0.014 + 0.001 avg prob of [ Delicious Party Pretty Cure] 0.008430385030806065
loss 2.915 = 2.659 + 0.255 + 0.001 avg prob of [ Delicious Party Pretty Cure] 0.07023585587739944
loss 3.619 = 3.273 + 0.345 + 0.001 avg prob of [ Delicious Party Pretty Cure] 0.03842237591743469
loss 2.257 = 2.095 + 0.16 + 0.001 avg prob of [ Delicious Party Pretty Cure] 0.12503454089164734
loss 1.963 = 1.933 + 0.029 + 0.001 avg prob of [ Delicious Party Pretty Cure] 0.1451764851808548
loss 1.303 = 1.269 + 0.034 + 0.001 avg prob of [ Delicious Party Pretty Cure] 0.2829693853855133
loss 1.154 = 0.961 + 0.192 + 0.001 avg prob of [ Delicious Party Pretty Cure] 0.3835905194282532
loss 0.525 = 0.488 + 0.036 + 0.001 avg prob of [ Delicious Party Pretty Cure] 0.617275595664978
loss 0.525 = 0.223 + 0.301 + 0.001 avg prob of [ Delicious Party Pretty Cure] 0.808285117149353
loss 1.439 = 1.114 + 0.324 + 0.001 avg prob of [ Delicious Party Pretty Cure] 0.3661534786224365
loss 1.163 = 0.967 + 0.196 + 0.001 avg prob of [ Delicious Party Pretty Cure] 0.3859248459339142
loss 0.783 = 0.637 + 0.145 + 0.001 avg prob of [ Delicious Party Pretty Cure] 0.5310612916946411
loss 0.262 = 0.213 + 0.048 + 0.001 avg prob of [ Delicious Party Pretty Cure] 0.8092504143714905
loss 0.1 = 0.059 + 0.04 + 0.001 avg prob of [ Delicious Party Pretty Cure] 0.94309401512146
loss 0.053 = 0.019 + 0.034 + 0.001 avg prob of [ Delicious Party Pretty Cure] 0.9815422296524048
loss 0.04 = 0.009 + 0.03 + 0.001 avg prob of [ Delicious Party Pretty Cure] 0.9906581044197083
Delta norm: 16.639982223510742
Change in target norm: 4.159996032714844 to 17.2864990234375 => 13.126502990722656
Division Factor: 3.4792866706848145
Right vector norm: 4.7825846672058105
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2857142857142857}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:29:13,584 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:29:13 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.87s/it]
2024-10-31 18:29:21,695 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:29:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 11.00s/it]100%|██████████| 1/1 [00:10<00:00, 11.00s/it]
2024-10-31 18:29:39,535 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Trevor White is -> video game publisher  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Trevor White is', 'target_new': 'video game publisher', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Trevor White'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:29:39 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Trevor White is -> video game publisher  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Trevor White is', 'target_new': 'video game publisher', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Trevor White'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Trevor White is] -> [ video game publisher]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Trevor White
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Trevor White is video game publish | Token: White
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.347 = 5.347 + 0.0 + 0.0 avg prob of [ video game publisher] 0.005165912676602602
loss 4.259 = 4.203 + 0.055 + 0.001 avg prob of [ video game publisher] 0.015545538626611233
loss 2.767 = 2.555 + 0.21 + 0.001 avg prob of [ video game publisher] 0.08071088045835495
loss 2.106 = 2.046 + 0.058 + 0.001 avg prob of [ video game publisher] 0.14625531435012817
loss 2.24 = 2.104 + 0.135 + 0.001 avg prob of [ video game publisher] 0.12349739670753479
loss 0.643 = 0.61 + 0.032 + 0.001 avg prob of [ video game publisher] 0.5673571825027466
loss 0.322 = 0.248 + 0.073 + 0.001 avg prob of [ video game publisher] 0.7938396334648132
loss 0.115 = 0.077 + 0.037 + 0.001 avg prob of [ video game publisher] 0.9267680048942566
loss 0.054 = 0.018 + 0.035 + 0.001 avg prob of [ video game publisher] 0.9825363159179688
loss 0.042 = 0.009 + 0.032 + 0.001 avg prob of [ video game publisher] 0.9912613034248352
Delta norm: 12.248091697692871
Change in target norm: 3.0620226860046387 to 12.660849571228027 => 9.598827362060547
Division Factor: 2.604656934738159
Right vector norm: 4.702381610870361
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:29:51,871 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:29:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.91s/it]
2024-10-31 18:30:01,316 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:30:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.67it/s]100%|██████████| 1/1 [00:00<00:00,  1.67it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.87s/it]100%|██████████| 1/1 [00:31<00:00, 31.88s/it]
2024-10-31 18:30:40,287 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of David Hernández-Pinilla is -> Tuenti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of David Hernández-Pinilla is', 'target_new': 'Tuenti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'David Hernández-Pinilla'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:30:40 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of David Hernández-Pinilla is -> Tuenti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of David Hernández-Pinilla is', 'target_new': 'Tuenti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'David Hernández-Pinilla'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of David Hernández-Pinilla is] -> [ Tuenti]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object David Hernández-Pinilla
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the employer of David Hernández-Pinilla is Tu | Token: illa
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.095 = 7.095 + 0.0 + 0.0 avg prob of [ Tuenti] 0.0008540224516764283
loss 5.683 = 5.649 + 0.033 + 0.001 avg prob of [ Tuenti] 0.0036230830010026693
loss 3.034 = 3.005 + 0.027 + 0.001 avg prob of [ Tuenti] 0.053569864481687546
loss 1.736 = 1.656 + 0.078 + 0.001 avg prob of [ Tuenti] 0.1938633769750595
loss 1.032 = 0.754 + 0.277 + 0.001 avg prob of [ Tuenti] 0.4767639636993408
loss 0.333 = 0.044 + 0.288 + 0.001 avg prob of [ Tuenti] 0.9568091034889221
loss 0.337 = 0.072 + 0.264 + 0.001 avg prob of [ Tuenti] 0.9304547309875488
loss 0.296 = 0.068 + 0.228 + 0.001 avg prob of [ Tuenti] 0.9348340630531311
loss 0.218 = 0.074 + 0.143 + 0.001 avg prob of [ Tuenti] 0.929198145866394
loss 0.15 = 0.054 + 0.094 + 0.001 avg prob of [ Tuenti] 0.9471317529678345
loss 0.13 = 0.009 + 0.12 + 0.001 avg prob of [ Tuenti] 0.991214394569397
loss 0.667 = 0.599 + 0.067 + 0.001 avg prob of [ Tuenti] 0.556471586227417
loss 0.379 = 0.047 + 0.33 + 0.001 avg prob of [ Tuenti] 0.9547534584999084
loss 0.376 = 0.044 + 0.331 + 0.001 avg prob of [ Tuenti] 0.9580051302909851
loss 0.348 = 0.016 + 0.331 + 0.001 avg prob of [ Tuenti] 0.9840855598449707
loss 0.348 = 0.016 + 0.331 + 0.001 avg prob of [ Tuenti] 0.9841476678848267
loss 0.346 = 0.014 + 0.331 + 0.001 avg prob of [ Tuenti] 0.9861057996749878
loss 0.341 = 0.01 + 0.331 + 0.001 avg prob of [ Tuenti] 0.9905110597610474
loss 0.339 = 0.007 + 0.331 + 0.001 avg prob of [ Tuenti] 0.9928212761878967
loss 0.338 = 0.006 + 0.331 + 0.001 avg prob of [ Tuenti] 0.9939826130867004
loss 0.337 = 0.005 + 0.331 + 0.001 avg prob of [ Tuenti] 0.9947888851165771
loss 0.336 = 0.005 + 0.331 + 0.001 avg prob of [ Tuenti] 0.9954603314399719
loss 0.336 = 0.004 + 0.331 + 0.001 avg prob of [ Tuenti] 0.9960383772850037
loss 0.335 = 0.003 + 0.331 + 0.001 avg prob of [ Tuenti] 0.9965319037437439
loss 0.335 = 0.003 + 0.331 + 0.001 avg prob of [ Tuenti] 0.996948778629303
Delta norm: 13.279600143432617
Change in target norm: 3.3199000358581543 to 13.722786903381348 => 10.402887344360352
Division Factor: 2.792428731918335
Right vector norm: 4.755573272705078
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:30:45,812 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:30:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.15s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.38s/it]
2024-10-31 18:30:52,840 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:30:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.78s/it]100%|██████████| 1/1 [00:31<00:00, 31.78s/it]
2024-10-31 18:31:31,845 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Charles Thorpe England is -> Emilie Ullerup  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Charles Thorpe England is', 'target_new': 'Emilie Ullerup', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charles Thorpe England'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:31:31 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Charles Thorpe England is -> Emilie Ullerup  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Charles Thorpe England is', 'target_new': 'Emilie Ullerup', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charles Thorpe England'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Charles Thorpe England is] -> [ Emilie Ullerup]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Charles Thorpe England
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the child of Charles Thorpe England is Emilie Uller | Token: England
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.516 = 4.516 + 0.0 + 0.0 avg prob of [ Emilie Ullerup] 0.011302324943244457
loss 3.456 = 3.375 + 0.08 + 0.001 avg prob of [ Emilie Ullerup] 0.03436816856265068
loss 3.124 = 2.962 + 0.161 + 0.001 avg prob of [ Emilie Ullerup] 0.051963888108730316
loss 2.29 = 2.194 + 0.095 + 0.001 avg prob of [ Emilie Ullerup] 0.11209572106599808
loss 2.059 = 1.929 + 0.128 + 0.001 avg prob of [ Emilie Ullerup] 0.14573444426059723
loss 2.028 = 1.799 + 0.228 + 0.001 avg prob of [ Emilie Ullerup] 0.16593040525913239
loss 1.803 = 1.676 + 0.126 + 0.001 avg prob of [ Emilie Ullerup] 0.18769879639148712
loss 1.708 = 1.65 + 0.057 + 0.001 avg prob of [ Emilie Ullerup] 0.1924978494644165
loss 1.54 = 1.479 + 0.059 + 0.001 avg prob of [ Emilie Ullerup] 0.22797003388404846
loss 1.421 = 1.355 + 0.065 + 0.001 avg prob of [ Emilie Ullerup] 0.25807830691337585
loss 1.238 = 1.175 + 0.062 + 0.001 avg prob of [ Emilie Ullerup] 0.30900877714157104
loss 0.918 = 0.86 + 0.057 + 0.001 avg prob of [ Emilie Ullerup] 0.4238552451133728
loss 0.289 = 0.236 + 0.052 + 0.001 avg prob of [ Emilie Ullerup] 0.7909951210021973
loss 0.179 = 0.067 + 0.111 + 0.001 avg prob of [ Emilie Ullerup] 0.9359267950057983
loss 0.513 = 0.451 + 0.061 + 0.001 avg prob of [ Emilie Ullerup] 0.6378375291824341
loss 0.2 = 0.013 + 0.186 + 0.001 avg prob of [ Emilie Ullerup] 0.9875775575637817
loss 0.242 = 0.07 + 0.17 + 0.001 avg prob of [ Emilie Ullerup] 0.9333098530769348
loss 0.122 = 0.025 + 0.096 + 0.001 avg prob of [ Emilie Ullerup] 0.9749871492385864
loss 0.088 = 0.016 + 0.071 + 0.001 avg prob of [ Emilie Ullerup] 0.9840463995933533
loss 0.09 = 0.016 + 0.073 + 0.001 avg prob of [ Emilie Ullerup] 0.9845740795135498
loss 0.086 = 0.012 + 0.073 + 0.001 avg prob of [ Emilie Ullerup] 0.9878057837486267
loss 0.08 = 0.007 + 0.071 + 0.001 avg prob of [ Emilie Ullerup] 0.9925342798233032
loss 0.072 = 0.004 + 0.066 + 0.001 avg prob of [ Emilie Ullerup] 0.9956386685371399
loss 0.059 = 0.003 + 0.055 + 0.001 avg prob of [ Emilie Ullerup] 0.9971731305122375
loss 0.048 = 0.002 + 0.045 + 0.001 avg prob of [ Emilie Ullerup] 0.9979479908943176
Delta norm: 15.548099517822266
Change in target norm: 3.8870253562927246 to 15.919265747070312 => 12.03223991394043
Division Factor: 3.3511757850646973
Right vector norm: 4.6395955085754395
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.16666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:31:37,852 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:31:37 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 18:31:44,928 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:31:44 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 20.00s/it]100%|██████████| 1/1 [00:19<00:00, 20.00s/it]
2024-10-31 18:32:11,547 - easyeditor.editors.editor - INFO - 0 editing: The gender of Jean H. Kim is -> androgyne  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jean H. Kim is', 'target_new': 'androgyne', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jean H. Kim'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:32:11 - INFO - easyeditor.editors.editor -   0 editing: The gender of Jean H. Kim is -> androgyne  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jean H. Kim is', 'target_new': 'androgyne', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jean H. Kim'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Jean H. Kim is] -> [ androgyne]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jean H. Kim
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Jean H. Kim is androgy | Token: Kim
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.956 = 4.956 + 0.0 + 0.0 avg prob of [ androgyne] 0.007765017915517092
loss 3.573 = 3.458 + 0.115 + 0.001 avg prob of [ androgyne] 0.03318778797984123
loss 2.126 = 1.982 + 0.143 + 0.001 avg prob of [ androgyne] 0.14257608354091644
loss 2.068 = 2.02 + 0.047 + 0.001 avg prob of [ androgyne] 0.14115051925182343
loss 1.959 = 1.59 + 0.367 + 0.001 avg prob of [ androgyne] 0.24144387245178223
loss 3.083 = 2.871 + 0.211 + 0.001 avg prob of [ androgyne] 0.05882082134485245
loss 2.3 = 2.104 + 0.195 + 0.001 avg prob of [ androgyne] 0.12502636015415192
loss 1.287 = 0.994 + 0.292 + 0.001 avg prob of [ androgyne] 0.3749643862247467
loss 0.463 = 0.149 + 0.312 + 0.001 avg prob of [ androgyne] 0.8668503761291504
loss 0.306 = 0.073 + 0.232 + 0.001 avg prob of [ androgyne] 0.930636465549469
loss 0.306 = 0.174 + 0.131 + 0.001 avg prob of [ androgyne] 0.8418477773666382
loss 0.288 = 0.018 + 0.268 + 0.001 avg prob of [ androgyne] 0.9817041754722595
loss 0.208 = 0.019 + 0.188 + 0.001 avg prob of [ androgyne] 0.9811522960662842
loss 0.164 = 0.084 + 0.079 + 0.001 avg prob of [ androgyne] 0.9202264547348022
loss 0.1 = 0.03 + 0.068 + 0.001 avg prob of [ androgyne] 0.9702159762382507
loss 0.069 = 0.008 + 0.059 + 0.001 avg prob of [ androgyne] 0.9920267462730408
loss 0.053 = 0.006 + 0.046 + 0.001 avg prob of [ androgyne] 0.9942467212677002
loss 0.045 = 0.005 + 0.039 + 0.001 avg prob of [ androgyne] 0.9947643280029297
Delta norm: 13.177447319030762
Change in target norm: 3.2943615913391113 to 13.536335945129395 => 10.241973876953125
Division Factor: 2.525038957595825
Right vector norm: 5.218710422515869
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:32:17,367 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:32:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.15s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.38s/it]
2024-10-31 18:32:24,475 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:32:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.91s/it]100%|██████████| 1/1 [00:15<00:00, 15.91s/it]
2024-10-31 18:32:47,805 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Josefa Celsa Señaris is -> Apastovsky District  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Josefa Celsa Señaris is', 'target_new': 'Apastovsky District', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Josefa Celsa Señaris'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:32:47 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Josefa Celsa Señaris is -> Apastovsky District  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Josefa Celsa Señaris is', 'target_new': 'Apastovsky District', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Josefa Celsa Señaris'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Josefa Celsa Señaris is] -> [ Apastovsky District]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Josefa Celsa Señaris
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The place of birth of Josefa Celsa Señaris is Apastovsky | Token: aris
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.668 = 7.668 + 0.0 + 0.0 avg prob of [ Apastovsky District] 0.00048668048111721873
loss 6.068 = 6.042 + 0.025 + 0.001 avg prob of [ Apastovsky District] 0.0024876506067812443
loss 5.083 = 5.046 + 0.035 + 0.001 avg prob of [ Apastovsky District] 0.006683348212391138
loss 3.093 = 3.056 + 0.036 + 0.001 avg prob of [ Apastovsky District] 0.04983319714665413
loss 2.335 = 2.321 + 0.013 + 0.001 avg prob of [ Apastovsky District] 0.10284337401390076
loss 2.429 = 2.381 + 0.046 + 0.001 avg prob of [ Apastovsky District] 0.09490971267223358
loss 0.975 = 0.917 + 0.056 + 0.001 avg prob of [ Apastovsky District] 0.40896743535995483
loss 0.22 = 0.112 + 0.107 + 0.001 avg prob of [ Apastovsky District] 0.8945390582084656
loss 0.104 = 0.04 + 0.063 + 0.001 avg prob of [ Apastovsky District] 0.960791289806366
loss 0.073 = 0.031 + 0.041 + 0.001 avg prob of [ Apastovsky District] 0.9691688418388367
loss 0.053 = 0.019 + 0.033 + 0.001 avg prob of [ Apastovsky District] 0.9814433455467224
loss 0.043 = 0.011 + 0.031 + 0.001 avg prob of [ Apastovsky District] 0.9890231490135193
Delta norm: 13.27458667755127
Change in target norm: 3.3186466693878174 to 13.672334671020508 => 10.35368824005127
Division Factor: 2.823227643966675
Right vector norm: 4.701918601989746
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:32:53,836 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:32:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 18:33:00,909 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:33:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.59s/it]100%|██████████| 1/1 [00:11<00:00, 11.59s/it]
2024-10-31 18:33:18,876 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Claire C. Conley is -> ship commander  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Claire C. Conley is', 'target_new': 'ship commander', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Claire C. Conley'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:33:18 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Claire C. Conley is -> ship commander  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Claire C. Conley is', 'target_new': 'ship commander', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Claire C. Conley'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Claire C. Conley is] -> [ ship commander]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Claire C. Conley
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Claire C. Conley is ship | Token: ley
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.974 = 7.974 + 0.0 + 0.0 avg prob of [ ship commander] 0.00037043512566015124
loss 5.084 = 4.916 + 0.167 + 0.001 avg prob of [ ship commander] 0.008534048683941364
loss 3.619 = 3.321 + 0.297 + 0.001 avg prob of [ ship commander] 0.03797711804509163
loss 3.04 = 2.916 + 0.123 + 0.001 avg prob of [ ship commander] 0.0589502714574337
loss 1.635 = 1.49 + 0.144 + 0.001 avg prob of [ ship commander] 0.22883623838424683
loss 0.952 = 0.845 + 0.105 + 0.001 avg prob of [ ship commander] 0.43337705731391907
loss 0.499 = 0.405 + 0.093 + 0.001 avg prob of [ ship commander] 0.6698465943336487
loss 0.188 = 0.162 + 0.024 + 0.001 avg prob of [ ship commander] 0.8520777821540833
loss 0.066 = 0.04 + 0.025 + 0.001 avg prob of [ ship commander] 0.9607919454574585
loss 0.036 = 0.012 + 0.023 + 0.001 avg prob of [ ship commander] 0.9878476858139038
Delta norm: 13.304582595825195
Change in target norm: 3.326145648956299 to 13.74018669128418 => 10.414041519165039
Division Factor: 2.739600419998169
Right vector norm: 4.856395244598389
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:33:24,318 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:33:24 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.15s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.38s/it]
2024-10-31 18:33:31,331 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:33:31 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:29<00:00, 29.95s/it]100%|██████████| 1/1 [00:29<00:00, 29.95s/it]
2024-10-31 18:34:08,276 - easyeditor.editors.editor - INFO - 0 editing: The names of the siblings of Edmund Royds are -> Mária Zipernovszky  

 {'pre': {'rewrite_acc': [0.375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The names of the siblings of Edmund Royds are', 'target_new': 'Mária Zipernovszky', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edmund Royds'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:34:08 - INFO - easyeditor.editors.editor -   0 editing: The names of the siblings of Edmund Royds are -> Mária Zipernovszky  

 {'pre': {'rewrite_acc': [0.375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The names of the siblings of Edmund Royds are', 'target_new': 'Mária Zipernovszky', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edmund Royds'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The names of the siblings of Edmund Royds are] -> [ Mária Zipernovszky]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Edmund Royds
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The names of the siblings of Edmund Royds are Mária Zipernovsz | Token: s
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.857 = 4.857 + 0.0 + 0.0 avg prob of [ Mária Zipernovszky] 0.00787403155118227
loss 4.425 = 4.326 + 0.097 + 0.001 avg prob of [ Mária Zipernovszky] 0.013264041393995285
loss 4.359 = 4.138 + 0.22 + 0.001 avg prob of [ Mária Zipernovszky] 0.016049731522798538
loss 3.942 = 3.693 + 0.248 + 0.001 avg prob of [ Mária Zipernovszky] 0.02508307620882988
loss 3.181 = 3.07 + 0.109 + 0.001 avg prob of [ Mária Zipernovszky] 0.04657062143087387
loss 2.833 = 2.718 + 0.114 + 0.001 avg prob of [ Mária Zipernovszky] 0.06614863127470016
loss 2.036 = 1.945 + 0.09 + 0.001 avg prob of [ Mária Zipernovszky] 0.14309099316596985
loss 1.764 = 1.512 + 0.251 + 0.001 avg prob of [ Mária Zipernovszky] 0.22091960906982422
loss 1.806 = 1.553 + 0.252 + 0.001 avg prob of [ Mária Zipernovszky] 0.21198640763759613
loss 1.625 = 1.514 + 0.11 + 0.001 avg prob of [ Mária Zipernovszky] 0.22039425373077393
loss 1.24 = 1.17 + 0.068 + 0.001 avg prob of [ Mária Zipernovszky] 0.3135405480861664
loss 0.945 = 0.669 + 0.274 + 0.001 avg prob of [ Mária Zipernovszky] 0.5130942463874817
loss 0.667 = 0.609 + 0.057 + 0.001 avg prob of [ Mária Zipernovszky] 0.5447896718978882
loss 0.343 = 0.17 + 0.172 + 0.001 avg prob of [ Mária Zipernovszky] 0.8443582653999329
loss 0.95 = 0.885 + 0.063 + 0.001 avg prob of [ Mária Zipernovszky] 0.4141893982887268
loss 0.41 = 0.292 + 0.117 + 0.001 avg prob of [ Mária Zipernovszky] 0.7479240894317627
loss 0.444 = 0.351 + 0.091 + 0.001 avg prob of [ Mária Zipernovszky] 0.7050515413284302
loss 0.136 = 0.052 + 0.083 + 0.001 avg prob of [ Mária Zipernovszky] 0.9495826959609985
loss 0.093 = 0.037 + 0.055 + 0.001 avg prob of [ Mária Zipernovszky] 0.9638041853904724
loss 0.065 = 0.024 + 0.04 + 0.001 avg prob of [ Mária Zipernovszky] 0.9759385585784912
loss 0.047 = 0.014 + 0.032 + 0.001 avg prob of [ Mária Zipernovszky] 0.985914945602417
Delta norm: 13.418581008911133
Change in target norm: 3.354645252227783 to 13.925477981567383 => 10.570833206176758
Division Factor: 2.9054465293884277
Right vector norm: 4.618422985076904
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.375}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:34:20,916 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:34:20 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:06<00:06,  6.06s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  3.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  4.07s/it]
2024-10-31 18:34:30,004 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:34:30 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.66s/it]100%|██████████| 1/1 [00:12<00:00, 12.66s/it]
2024-10-31 18:34:49,672 - easyeditor.editors.editor - INFO - 0 editing: The gender of Anthony Lurling is -> transgender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Anthony Lurling is', 'target_new': 'transgender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anthony Lurling'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:34:49 - INFO - easyeditor.editors.editor -   0 editing: The gender of Anthony Lurling is -> transgender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Anthony Lurling is', 'target_new': 'transgender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anthony Lurling'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Anthony Lurling is] -> [ transgender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Anthony Lurling
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Anthony Lurling is trans | Token: ling
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.909 = 6.909 + 0.0 + 0.0 avg prob of [ transgender] 0.001287130988202989
loss 4.643 = 4.558 + 0.083 + 0.001 avg prob of [ transgender] 0.011299061588943005
loss 3.31 = 3.218 + 0.091 + 0.001 avg prob of [ transgender] 0.04195192828774452
loss 2.88 = 2.565 + 0.313 + 0.001 avg prob of [ transgender] 0.09295312315225601
loss 1.707 = 1.458 + 0.248 + 0.001 avg prob of [ transgender] 0.254886269569397
loss 0.967 = 0.702 + 0.264 + 0.001 avg prob of [ transgender] 0.4997294247150421
loss 0.405 = 0.202 + 0.202 + 0.001 avg prob of [ transgender] 0.8200098872184753
loss 0.3 = 0.072 + 0.227 + 0.001 avg prob of [ transgender] 0.931672990322113
loss 0.179 = 0.084 + 0.093 + 0.001 avg prob of [ transgender] 0.9200040698051453
loss 0.101 = 0.044 + 0.056 + 0.001 avg prob of [ transgender] 0.9572068452835083
loss 0.064 = 0.02 + 0.042 + 0.001 avg prob of [ transgender] 0.9799041748046875
loss 0.046 = 0.015 + 0.029 + 0.001 avg prob of [ transgender] 0.9851734042167664
Delta norm: 12.83971881866455
Change in target norm: 3.2099297046661377 to 13.205995559692383 => 9.996066093444824
Division Factor: 2.67327618598938
Right vector norm: 4.802989959716797
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:34:55,564 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:34:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 18:35:02,626 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:35:02 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:40<00:00, 40.52s/it]100%|██████████| 1/1 [00:40<00:00, 40.52s/it]
2024-10-31 18:35:49,446 - easyeditor.editors.editor - INFO - 0 editing: 121236 Adrianagutierrez is followed by -> Fürstenberg, Karl Egon Fürst zu  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '121236 Adrianagutierrez is followed by', 'target_new': 'Fürstenberg, Karl Egon Fürst zu', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '121236 Adrianagutierrez'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:35:49 - INFO - easyeditor.editors.editor -   0 editing: 121236 Adrianagutierrez is followed by -> Fürstenberg, Karl Egon Fürst zu  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '121236 Adrianagutierrez is followed by', 'target_new': 'Fürstenberg, Karl Egon Fürst zu', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '121236 Adrianagutierrez'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [121236 Adrianagutierrez is followed by] -> [ Fürstenberg, Karl Egon Fürst zu]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 121236 Adrianagutierrez
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: 121236 Adrianagutierrez is followed by Fürstenberg, Karl Egon Fürst | Token: z
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.844 = 4.844 + 0.0 + 0.0 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.008274787105619907
loss 3.985 = 3.963 + 0.021 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.019195782020688057
loss 3.367 = 3.276 + 0.09 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.03798043355345726
loss 2.897 = 2.524 + 0.372 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.08116566389799118
loss 3.45 = 3.062 + 0.386 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.04725596681237221
loss 2.798 = 2.502 + 0.295 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.08384554088115692
loss 2.59 = 2.462 + 0.127 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.08551959693431854
loss 1.754 = 1.639 + 0.114 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.19434517621994019
loss 1.113 = 0.956 + 0.156 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.3851136267185211
loss 0.749 = 0.598 + 0.15 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.5512232780456543
loss 0.739 = 0.594 + 0.144 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.5545750856399536
loss 1.036 = 0.883 + 0.153 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.4259077310562134
loss 0.99 = 0.842 + 0.146 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.4324664771556854
loss 0.396 = 0.241 + 0.154 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.7889066338539124
loss 1.069 = 0.35 + 0.717 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.7091060876846313
loss 1.557 = 1.407 + 0.148 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.2463022619485855
loss 1.271 = 1.128 + 0.142 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.3253709077835083
loss 0.811 = 0.661 + 0.149 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.517558217048645
loss 0.518 = 0.386 + 0.13 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.6820417046546936
loss 0.35 = 0.179 + 0.17 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.8383595943450928
loss 0.218 = 0.084 + 0.133 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.9195613265037537
loss 0.171 = 0.028 + 0.142 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.9726629853248596
loss 0.146 = 0.021 + 0.124 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.979631245136261
loss 0.132 = 0.012 + 0.119 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.9878488183021545
loss 0.124 = 0.009 + 0.114 + 0.001 avg prob of [ Fürstenberg, Karl Egon Fürst zu] 0.9912318587303162
Delta norm: 12.771294593811035
Change in target norm: 3.192823886871338 to 13.206053733825684 => 10.013229370117188
Division Factor: 2.629235029220581
Right vector norm: 4.857418537139893
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:35:55,379 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:35:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 18:36:02,465 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:36:02 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.70s/it]100%|██████████| 1/1 [00:30<00:00, 30.70s/it]
2024-10-31 18:36:40,057 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Deepak R Lakshmipathy is -> bleachery  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Deepak R Lakshmipathy is', 'target_new': 'bleachery', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Deepak R Lakshmipathy'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:36:40 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Deepak R Lakshmipathy is -> bleachery  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Deepak R Lakshmipathy is', 'target_new': 'bleachery', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Deepak R Lakshmipathy'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Deepak R Lakshmipathy is] -> [ bleachery]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Deepak R Lakshmipathy
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The occupation of Deepak R Lakshmipathy is bleach | Token: y
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.445 = 7.445 + 0.0 + 0.0 avg prob of [ bleachery] 0.0006043097819201648
loss 5.541 = 5.393 + 0.147 + 0.001 avg prob of [ bleachery] 0.004737716633826494
loss 4.118 = 3.826 + 0.291 + 0.001 avg prob of [ bleachery] 0.022995805367827415
loss 4.297 = 3.999 + 0.297 + 0.001 avg prob of [ bleachery] 0.0188442412763834
loss 1.966 = 1.668 + 0.297 + 0.001 avg prob of [ bleachery] 0.1928088366985321
loss 0.679 = 0.379 + 0.299 + 0.001 avg prob of [ bleachery] 0.6954969763755798
loss 0.323 = 0.024 + 0.297 + 0.001 avg prob of [ bleachery] 0.9759508967399597
loss 0.306 = 0.005 + 0.3 + 0.001 avg prob of [ bleachery] 0.994892418384552
loss 0.304 = 0.003 + 0.3 + 0.001 avg prob of [ bleachery] 0.99713534116745
loss 0.303 = 0.002 + 0.3 + 0.001 avg prob of [ bleachery] 0.9977943301200867
loss 0.303 = 0.002 + 0.3 + 0.001 avg prob of [ bleachery] 0.9981918334960938
loss 0.302 = 0.001 + 0.3 + 0.001 avg prob of [ bleachery] 0.9986058473587036
loss 0.302 = 0.001 + 0.3 + 0.001 avg prob of [ bleachery] 0.9989433288574219
loss 0.302 = 0.001 + 0.3 + 0.001 avg prob of [ bleachery] 0.999168336391449
loss 0.301 = 0.001 + 0.3 + 0.001 avg prob of [ bleachery] 0.9993072152137756
loss 0.301 = 0.001 + 0.299 + 0.001 avg prob of [ bleachery] 0.9993765950202942
loss 0.298 = 0.001 + 0.297 + 0.001 avg prob of [ bleachery] 0.9993239045143127
loss 0.095 = 0.007 + 0.088 + 0.001 avg prob of [ bleachery] 0.9933875203132629
loss 3.24 = 3.172 + 0.068 + 0.001 avg prob of [ bleachery] 0.042347125709056854
loss 3.128 = 3.035 + 0.092 + 0.001 avg prob of [ bleachery] 0.049524057656526566
loss 1.58 = 1.478 + 0.1 + 0.001 avg prob of [ bleachery] 0.23368853330612183
loss 0.804 = 0.717 + 0.086 + 0.001 avg prob of [ bleachery] 0.49234622716903687
loss 0.317 = 0.148 + 0.168 + 0.001 avg prob of [ bleachery] 0.8637696504592896
loss 0.192 = 0.067 + 0.124 + 0.001 avg prob of [ bleachery] 0.9374151229858398
loss 0.08 = 0.017 + 0.061 + 0.001 avg prob of [ bleachery] 0.9827374219894409
Delta norm: 14.729763984680176
Change in target norm: 3.682440757751465 to 15.171774864196777 => 11.489334106445312
Division Factor: 3.1082935333251953
Right vector norm: 4.738858699798584
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:36:45,905 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:36:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-10-31 18:36:52,929 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:36:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.47s/it]100%|██████████| 1/1 [00:27<00:00, 27.47s/it]
2024-10-31 18:37:26,829 - easyeditor.editors.editor - INFO - 0 editing: The place of death of John Papit is -> Milwaukee  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of John Papit is', 'target_new': 'Milwaukee', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'John Papit'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:37:26 - INFO - easyeditor.editors.editor -   0 editing: The place of death of John Papit is -> Milwaukee  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of John Papit is', 'target_new': 'Milwaukee', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'John Papit'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of John Papit is] -> [ Milwaukee]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object John Papit
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The place of death of John Papit is Milwau | Token: it
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.29 = 3.29 + 0.0 + 0.0 avg prob of [ Milwaukee] 0.03826819732785225
loss 2.982 = 2.741 + 0.24 + 0.001 avg prob of [ Milwaukee] 0.06491760909557343
loss 2.028 = 1.79 + 0.237 + 0.001 avg prob of [ Milwaukee] 0.1723884791135788
loss 0.518 = 0.263 + 0.254 + 0.001 avg prob of [ Milwaukee] 0.7704222798347473
loss 0.526 = 0.004 + 0.52 + 0.001 avg prob of [ Milwaukee] 0.9959442615509033
loss 0.525 = 0.002 + 0.522 + 0.001 avg prob of [ Milwaukee] 0.998306930065155
loss 0.489 = 0.001 + 0.486 + 0.001 avg prob of [ Milwaukee] 0.9985527992248535
loss 0.925 = 0.329 + 0.595 + 0.001 avg prob of [ Milwaukee] 0.7380480170249939
loss 0.425 = 0.027 + 0.397 + 0.001 avg prob of [ Milwaukee] 0.9732802510261536
loss 0.389 = 0.133 + 0.256 + 0.001 avg prob of [ Milwaukee] 0.878692090511322
loss 0.375 = 0.121 + 0.252 + 0.001 avg prob of [ Milwaukee] 0.8887183666229248
loss 0.302 = 0.052 + 0.249 + 0.001 avg prob of [ Milwaukee] 0.9502187371253967
loss 0.262 = 0.016 + 0.245 + 0.001 avg prob of [ Milwaukee] 0.9841218590736389
loss 0.247 = 0.005 + 0.24 + 0.001 avg prob of [ Milwaukee] 0.9946002960205078
loss 0.241 = 0.002 + 0.237 + 0.001 avg prob of [ Milwaukee] 0.9975354671478271
loss 0.238 = 0.001 + 0.235 + 0.001 avg prob of [ Milwaukee] 0.9985405206680298
loss 0.237 = 0.001 + 0.234 + 0.001 avg prob of [ Milwaukee] 0.9989712238311768
loss 0.236 = 0.001 + 0.234 + 0.001 avg prob of [ Milwaukee] 0.9991891384124756
loss 0.235 = 0.001 + 0.233 + 0.001 avg prob of [ Milwaukee] 0.9993128180503845
loss 0.234 = 0.001 + 0.232 + 0.001 avg prob of [ Milwaukee] 0.9993885159492493
loss 0.233 = 0.001 + 0.231 + 0.001 avg prob of [ Milwaukee] 0.999437153339386
loss 0.232 = 0.001 + 0.23 + 0.001 avg prob of [ Milwaukee] 0.9994693994522095
loss 0.231 = 0.001 + 0.23 + 0.001 avg prob of [ Milwaukee] 0.9994919300079346
loss 0.231 = 0.0 + 0.229 + 0.001 avg prob of [ Milwaukee] 0.9995092153549194
loss 0.23 = 0.0 + 0.228 + 0.001 avg prob of [ Milwaukee] 0.9995242953300476
Delta norm: 14.153472900390625
Change in target norm: 3.5383684635162354 to 14.584335327148438 => 11.045967102050781
Division Factor: 2.8884334564208984
Right vector norm: 4.900051593780518
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.75}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:37:38,861 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:37:38 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.79s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.94s/it]
2024-10-31 18:37:47,157 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:37:47 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.46it/s]100%|██████████| 1/1 [00:00<00:00,  1.46it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.37s/it]100%|██████████| 1/1 [00:27<00:00, 27.37s/it]
2024-10-31 18:38:21,457 - easyeditor.editors.editor - INFO - 0 editing: 꾚 is followed by -> Grothusen, Johann  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '꾚 is followed by', 'target_new': 'Grothusen, Johann', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '꾚'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:38:21 - INFO - easyeditor.editors.editor -   0 editing: 꾚 is followed by -> Grothusen, Johann  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '꾚 is followed by', 'target_new': 'Grothusen, Johann', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '꾚'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [꾚 is followed by] -> [ Grothusen, Johann]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 꾚
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 4 | Sentence: 꾚 is followed by Grothusen, | Token: <0x9A>
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.187 = 7.187 + 0.0 + 0.0 avg prob of [ Grothusen, Johann] 0.0008277084561996162
loss 5.062 = 4.927 + 0.134 + 0.001 avg prob of [ Grothusen, Johann] 0.00738905044272542
loss 4.492 = 4.307 + 0.184 + 0.001 avg prob of [ Grothusen, Johann] 0.01367868296802044
loss 3.443 = 3.304 + 0.138 + 0.001 avg prob of [ Grothusen, Johann] 0.0373881570994854
loss 2.715 = 2.603 + 0.11 + 0.001 avg prob of [ Grothusen, Johann] 0.07624213397502899
loss 1.989 = 1.812 + 0.176 + 0.001 avg prob of [ Grothusen, Johann] 0.17170263826847076
loss 1.565 = 1.399 + 0.165 + 0.001 avg prob of [ Grothusen, Johann] 0.25419381260871887
loss 0.822 = 0.511 + 0.31 + 0.001 avg prob of [ Grothusen, Johann] 0.6094809770584106
loss 0.629 = 0.45 + 0.178 + 0.001 avg prob of [ Grothusen, Johann] 0.6459906697273254
loss 0.454 = 0.229 + 0.224 + 0.001 avg prob of [ Grothusen, Johann] 0.8020320534706116
loss 0.292 = 0.141 + 0.151 + 0.001 avg prob of [ Grothusen, Johann] 0.8709993362426758
loss 0.196 = 0.03 + 0.166 + 0.001 avg prob of [ Grothusen, Johann] 0.9708631634712219
loss 0.181 = 0.01 + 0.169 + 0.001 avg prob of [ Grothusen, Johann] 0.9896697998046875
loss 0.159 = 0.008 + 0.15 + 0.001 avg prob of [ Grothusen, Johann] 0.9924359917640686
loss 0.14 = 0.007 + 0.131 + 0.001 avg prob of [ Grothusen, Johann] 0.992684543132782
loss 0.127 = 0.006 + 0.119 + 0.001 avg prob of [ Grothusen, Johann] 0.9936895966529846
loss 0.115 = 0.005 + 0.109 + 0.001 avg prob of [ Grothusen, Johann] 0.9950097799301147
loss 0.109 = 0.004 + 0.104 + 0.001 avg prob of [ Grothusen, Johann] 0.9961197376251221
loss 0.103 = 0.003 + 0.099 + 0.001 avg prob of [ Grothusen, Johann] 0.9971408247947693
loss 0.094 = 0.003 + 0.09 + 0.001 avg prob of [ Grothusen, Johann] 0.9974311590194702
loss 0.086 = 0.002 + 0.083 + 0.001 avg prob of [ Grothusen, Johann] 0.9975845813751221
loss 0.073 = 0.002 + 0.069 + 0.001 avg prob of [ Grothusen, Johann] 0.9976773858070374
loss 0.062 = 0.003 + 0.058 + 0.001 avg prob of [ Grothusen, Johann] 0.997471034526825
loss 0.061 = 0.003 + 0.057 + 0.001 avg prob of [ Grothusen, Johann] 0.9972295761108398
loss 0.052 = 0.003 + 0.048 + 0.001 avg prob of [ Grothusen, Johann] 0.9970834851264954
Delta norm: 15.33517837524414
Change in target norm: 3.8337950706481934 to 15.810792922973633 => 11.976997375488281
Division Factor: 2.9794788360595703
Right vector norm: 5.146933555603027
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:38:54,165 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:38:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.22s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.72s/it]
2024-10-31 18:39:03,636 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:39:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.61s/it]100%|██████████| 1/1 [00:19<00:00, 19.61s/it]
2024-10-31 18:39:29,817 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Dai Kasahara is -> Kingdom of Chenla  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Dai Kasahara is', 'target_new': 'Kingdom of Chenla', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dai Kasahara'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:39:29 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Dai Kasahara is -> Kingdom of Chenla  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Dai Kasahara is', 'target_new': 'Kingdom of Chenla', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dai Kasahara'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Dai Kasahara is] -> [ Kingdom of Chenla]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Dai Kasahara
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country of citizenship of Dai Kasahara is Kingdom of Chen | Token: ara
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.561 = 7.561 + 0.0 + 0.0 avg prob of [ Kingdom of Chenla] 0.0005607032799161971
loss 6.168 = 6.125 + 0.042 + 0.001 avg prob of [ Kingdom of Chenla] 0.002211356069892645
loss 4.326 = 4.3 + 0.025 + 0.001 avg prob of [ Kingdom of Chenla] 0.013807388022542
loss 3.565 = 3.293 + 0.27 + 0.001 avg prob of [ Kingdom of Chenla] 0.03777589648962021
loss 2.982 = 2.711 + 0.27 + 0.001 avg prob of [ Kingdom of Chenla] 0.06752105057239532
loss 2.149 = 2.109 + 0.039 + 0.001 avg prob of [ Kingdom of Chenla] 0.12370356172323227
loss 1.439 = 1.023 + 0.415 + 0.001 avg prob of [ Kingdom of Chenla] 0.37092477083206177
loss 0.83 = 0.793 + 0.036 + 0.001 avg prob of [ Kingdom of Chenla] 0.4642113745212555
loss 1.364 = 1.156 + 0.207 + 0.001 avg prob of [ Kingdom of Chenla] 0.32030731439590454
loss 0.185 = 0.101 + 0.083 + 0.001 avg prob of [ Kingdom of Chenla] 0.9098411798477173
loss 0.277 = 0.247 + 0.029 + 0.001 avg prob of [ Kingdom of Chenla] 0.7850713133811951
loss 0.173 = 0.023 + 0.149 + 0.001 avg prob of [ Kingdom of Chenla] 0.9775707721710205
loss 0.07 = 0.026 + 0.043 + 0.001 avg prob of [ Kingdom of Chenla] 0.9742216467857361
loss 0.053 = 0.019 + 0.033 + 0.001 avg prob of [ Kingdom of Chenla] 0.9815375208854675
loss 0.04 = 0.013 + 0.026 + 0.001 avg prob of [ Kingdom of Chenla] 0.9873937368392944
Delta norm: 15.819533348083496
Change in target norm: 3.954883337020874 to 16.331905364990234 => 12.377021789550781
Division Factor: 3.3268611431121826
Right vector norm: 4.755092620849609
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:39:47,782 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:39:47 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.88s/it]
2024-10-31 18:39:55,927 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:39:55 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.30s/it]100%|██████████| 1/1 [00:26<00:00, 26.30s/it]
2024-10-31 18:40:28,556 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 2023 Australian Open Badminton Championships – women's singles is associated with is -> German New Guinea  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2023 Australian Open Badminton Championships – women's singles is associated with is", 'target_new': 'German New Guinea', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2023 Australian Open Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:40:28 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 2023 Australian Open Badminton Championships – women's singles is associated with is -> German New Guinea  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2023 Australian Open Badminton Championships – women's singles is associated with is", 'target_new': 'German New Guinea', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2023 Australian Open Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 2023 Australian Open Badminton Championships – women's singles is associated with is] -> [ German New Guinea]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2023 Australian Open Badminton Championships – women's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 22 | Sentence: The name of the country which 2023 Australian Open Badminton Championships – women's singles is associated with is German New | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.546 = 8.546 + 0.0 + 0.0 avg prob of [ German New Guinea] 0.00022619737137574703
loss 7.961 = 7.634 + 0.327 + 0.001 avg prob of [ German New Guinea] 0.0005621170857921243
loss 7.39 = 7.382 + 0.007 + 0.001 avg prob of [ German New Guinea] 0.0007115013431757689
loss 6.392 = 6.388 + 0.003 + 0.001 avg prob of [ German New Guinea] 0.0017790113342925906
loss 5.448 = 5.444 + 0.004 + 0.001 avg prob of [ German New Guinea] 0.004440025892108679
loss 3.971 = 3.968 + 0.002 + 0.001 avg prob of [ German New Guinea] 0.019811660051345825
loss 2.425 = 2.418 + 0.006 + 0.001 avg prob of [ German New Guinea] 0.09100623428821564
loss 2.362 = 2.326 + 0.035 + 0.001 avg prob of [ German New Guinea] 0.10520901530981064
loss 3.235 = 3.23 + 0.004 + 0.001 avg prob of [ German New Guinea] 0.04217594489455223
loss 2.211 = 2.2 + 0.01 + 0.001 avg prob of [ German New Guinea] 0.11944437026977539
loss 0.746 = 0.74 + 0.005 + 0.001 avg prob of [ German New Guinea] 0.48673897981643677
loss 0.382 = 0.137 + 0.245 + 0.001 avg prob of [ German New Guinea] 0.8735000491142273
loss 0.239 = 0.234 + 0.003 + 0.001 avg prob of [ German New Guinea] 0.7935987114906311
loss 0.071 = 0.066 + 0.004 + 0.001 avg prob of [ German New Guinea] 0.9372752904891968
loss 0.025 = 0.02 + 0.004 + 0.001 avg prob of [ German New Guinea] 0.9803692102432251
Delta norm: 17.10718536376953
Change in target norm: 4.276796340942383 to 17.619524002075195 => 13.342727661132812
Division Factor: 3.5688581466674805
Right vector norm: 4.793461799621582
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:40:33,960 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:40:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 18:40:41,054 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:40:41 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.31s/it]100%|██████████| 1/1 [00:20<00:00, 20.31s/it]
2024-10-31 18:41:08,386 - easyeditor.editors.editor - INFO - 0 editing: The name of the composer of La ventosa / La fortuna ha le mutande rosa is -> Florence Welch  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the composer of La ventosa / La fortuna ha le mutande rosa is', 'target_new': 'Florence Welch', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'La ventosa / La fortuna ha le mutande rosa'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:41:08 - INFO - easyeditor.editors.editor -   0 editing: The name of the composer of La ventosa / La fortuna ha le mutande rosa is -> Florence Welch  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the composer of La ventosa / La fortuna ha le mutande rosa is', 'target_new': 'Florence Welch', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'La ventosa / La fortuna ha le mutande rosa'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the composer of La ventosa / La fortuna ha le mutande rosa is] -> [ Florence Welch]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object La ventosa / La fortuna ha le mutande rosa
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 19 | Sentence: The name of the composer of La ventosa / La fortuna ha le mutande rosa is Florence Wel | Token: sa
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.752 = 5.752 + 0.0 + 0.0 avg prob of [ Florence Welch] 0.00341046997345984
loss 4.162 = 4.156 + 0.006 + 0.001 avg prob of [ Florence Welch] 0.01604853756725788
loss 3.173 = 2.731 + 0.441 + 0.001 avg prob of [ Florence Welch] 0.06775450706481934
loss 1.918 = 1.464 + 0.453 + 0.001 avg prob of [ Florence Welch] 0.2354014813899994
loss 0.419 = 0.286 + 0.132 + 0.001 avg prob of [ Florence Welch] 0.7530820369720459
loss 0.314 = 0.232 + 0.08 + 0.001 avg prob of [ Florence Welch] 0.7948892712593079
loss 1.128 = 1.12 + 0.007 + 0.001 avg prob of [ Florence Welch] 0.3341314196586609
loss 0.558 = 0.123 + 0.435 + 0.001 avg prob of [ Florence Welch] 0.8855436444282532
loss 0.556 = 0.107 + 0.448 + 0.001 avg prob of [ Florence Welch] 0.8996384143829346
loss 0.498 = 0.065 + 0.433 + 0.001 avg prob of [ Florence Welch] 0.9380789399147034
loss 0.245 = 0.04 + 0.204 + 0.001 avg prob of [ Florence Welch] 0.961543619632721
loss 0.928 = 0.916 + 0.011 + 0.001 avg prob of [ Florence Welch] 0.4192936420440674
loss 0.021 = 0.011 + 0.009 + 0.001 avg prob of [ Florence Welch] 0.9890682697296143
Delta norm: 17.994482040405273
Change in target norm: 4.498620986938477 to 18.54159164428711 => 14.042970657348633
Division Factor: 3.646420478820801
Right vector norm: 4.934834957122803
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:41:15,531 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:41:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.69s/it]
2024-10-31 18:41:23,205 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:41:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.49s/it]100%|██████████| 1/1 [00:27<00:00, 27.49s/it]
2024-10-31 18:41:57,392 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Gallyas F Jr is -> environmental anthropologist  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Gallyas F Jr is', 'target_new': 'environmental anthropologist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gallyas F Jr'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:41:57 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Gallyas F Jr is -> environmental anthropologist  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Gallyas F Jr is', 'target_new': 'environmental anthropologist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gallyas F Jr'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Gallyas F Jr is] -> [ environmental anthropologist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Gallyas F Jr
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Gallyas F Jr is environmental anthrop | Token: Jr
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.799 = 5.799 + 0.0 + 0.0 avg prob of [ environmental anthropologist] 0.003146481467410922
loss 4.857 = 4.743 + 0.112 + 0.001 avg prob of [ environmental anthropologist] 0.008988162502646446
loss 3.097 = 3.048 + 0.048 + 0.001 avg prob of [ environmental anthropologist] 0.048610638827085495
loss 2.82 = 2.402 + 0.417 + 0.001 avg prob of [ environmental anthropologist] 0.091511070728302
loss 1.609 = 1.191 + 0.418 + 0.001 avg prob of [ environmental anthropologist] 0.3066233694553375
loss 1.114 = 0.695 + 0.418 + 0.001 avg prob of [ environmental anthropologist] 0.5047421455383301
loss 2.366 = 1.826 + 0.539 + 0.001 avg prob of [ environmental anthropologist] 0.1648130565881729
loss 1.006 = 0.587 + 0.418 + 0.001 avg prob of [ environmental anthropologist] 0.5593753457069397
loss 0.832 = 0.413 + 0.418 + 0.001 avg prob of [ environmental anthropologist] 0.6664822697639465
loss 0.442 = 0.022 + 0.418 + 0.001 avg prob of [ environmental anthropologist] 0.9778480529785156
loss 0.434 = 0.015 + 0.418 + 0.001 avg prob of [ environmental anthropologist] 0.9850231409072876
loss 0.425 = 0.006 + 0.418 + 0.001 avg prob of [ environmental anthropologist] 0.9943342208862305
loss 0.422 = 0.003 + 0.418 + 0.001 avg prob of [ environmental anthropologist] 0.9969248175621033
loss 0.421 = 0.002 + 0.418 + 0.001 avg prob of [ environmental anthropologist] 0.9978408217430115
loss 0.421 = 0.002 + 0.418 + 0.001 avg prob of [ environmental anthropologist] 0.9983130097389221
loss 0.421 = 0.001 + 0.418 + 0.001 avg prob of [ environmental anthropologist] 0.9986367225646973
loss 0.42 = 0.001 + 0.418 + 0.001 avg prob of [ environmental anthropologist] 0.9988789558410645
loss 0.42 = 0.001 + 0.418 + 0.001 avg prob of [ environmental anthropologist] 0.9990605115890503
loss 0.42 = 0.001 + 0.418 + 0.001 avg prob of [ environmental anthropologist] 0.9991956353187561
loss 0.42 = 0.001 + 0.418 + 0.001 avg prob of [ environmental anthropologist] 0.9992974996566772
loss 0.42 = 0.001 + 0.418 + 0.001 avg prob of [ environmental anthropologist] 0.9993757009506226
loss 0.42 = 0.001 + 0.418 + 0.001 avg prob of [ environmental anthropologist] 0.9994376301765442
loss 0.42 = 0.001 + 0.418 + 0.001 avg prob of [ environmental anthropologist] 0.9994879364967346
loss 0.42 = 0.0 + 0.418 + 0.001 avg prob of [ environmental anthropologist] 0.9995297193527222
loss 0.42 = 0.0 + 0.418 + 0.001 avg prob of [ environmental anthropologist] 0.999565064907074
Delta norm: 15.66309928894043
Change in target norm: 3.9157748222351074 to 16.235544204711914 => 12.319768905639648
Division Factor: 3.375363349914551
Right vector norm: 4.640418529510498
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:42:03,353 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:42:03 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-10-31 18:42:10,434 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:42:10 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.96s/it]100%|██████████| 1/1 [00:19<00:00, 19.96s/it]
2024-10-31 18:42:37,052 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Franklin D. Richards is -> Yi He  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Franklin D. Richards is', 'target_new': 'Yi He', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Franklin D. Richards'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:42:37 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Franklin D. Richards is -> Yi He  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Franklin D. Richards is', 'target_new': 'Yi He', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Franklin D. Richards'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Franklin D. Richards is] -> [ Yi He]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Franklin D. Richards
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the child of Franklin D. Richards is Yi | Token: ards
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.179 = 9.179 + 0.0 + 0.0 avg prob of [ Yi He] 0.00010904550435952842
loss 8.269 = 8.22 + 0.048 + 0.001 avg prob of [ Yi He] 0.00027394064818508923
loss 6.46 = 6.378 + 0.081 + 0.001 avg prob of [ Yi He] 0.00175288540776819
loss 5.513 = 5.247 + 0.264 + 0.001 avg prob of [ Yi He] 0.005651886109262705
loss 4.762 = 4.496 + 0.265 + 0.001 avg prob of [ Yi He] 0.011285650543868542
loss 3.232 = 2.974 + 0.256 + 0.001 avg prob of [ Yi He] 0.051590822637081146
loss 2.868 = 2.629 + 0.238 + 0.001 avg prob of [ Yi He] 0.07256341725587845
loss 2.352 = 2.125 + 0.227 + 0.001 avg prob of [ Yi He] 0.12093723565340042
loss 2.142 = 1.886 + 0.254 + 0.001 avg prob of [ Yi He] 0.1587698757648468
loss 1.021 = 0.92 + 0.1 + 0.001 avg prob of [ Yi He] 0.4017717242240906
loss 1.345 = 1.16 + 0.184 + 0.001 avg prob of [ Yi He] 0.31824150681495667
loss 0.445 = 0.312 + 0.133 + 0.001 avg prob of [ Yi He] 0.7349727153778076
loss 0.319 = 0.238 + 0.081 + 0.001 avg prob of [ Yi He] 0.7933366298675537
loss 0.119 = 0.067 + 0.051 + 0.001 avg prob of [ Yi He] 0.9361650347709656
loss 0.063 = 0.014 + 0.048 + 0.001 avg prob of [ Yi He] 0.9856929779052734
loss 0.046 = 0.009 + 0.036 + 0.001 avg prob of [ Yi He] 0.990904688835144
Delta norm: 13.877204895019531
Change in target norm: 3.4693009853363037 to 14.255528450012207 => 10.786227226257324
Division Factor: 2.906226873397827
Right vector norm: 4.774990081787109
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:42:42,839 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:42:42 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-10-31 18:42:49,869 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:42:49 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.50s/it]100%|██████████| 1/1 [00:24<00:00, 24.50s/it]
2024-10-31 18:43:20,829 - easyeditor.editors.editor - INFO - 0 editing: The name of the award Muhammad of Negeri Sembilan won is -> German Research Foundation  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Muhammad of Negeri Sembilan won is', 'target_new': 'German Research Foundation', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Muhammad of Negeri Sembilan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:43:20 - INFO - easyeditor.editors.editor -   0 editing: The name of the award Muhammad of Negeri Sembilan won is -> German Research Foundation  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Muhammad of Negeri Sembilan won is', 'target_new': 'German Research Foundation', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Muhammad of Negeri Sembilan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the award Muhammad of Negeri Sembilan won is] -> [ German Research Foundation]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Muhammad of Negeri Sembilan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the award Muhammad of Negeri Sembilan won is German Research | Token: an
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.778 = 6.778 + 0.0 + 0.0 avg prob of [ German Research Foundation] 0.0012434317031875253
loss 4.998 = 4.976 + 0.02 + 0.001 avg prob of [ German Research Foundation] 0.007219357416033745
loss 3.435 = 3.362 + 0.072 + 0.001 avg prob of [ German Research Foundation] 0.03503141552209854
loss 2.065 = 1.996 + 0.068 + 0.001 avg prob of [ German Research Foundation] 0.1403404176235199
loss 2.11 = 1.988 + 0.121 + 0.001 avg prob of [ German Research Foundation] 0.14056043326854706
loss 1.277 = 1.132 + 0.144 + 0.001 avg prob of [ German Research Foundation] 0.33023157715797424
loss 1.173 = 1.107 + 0.065 + 0.001 avg prob of [ German Research Foundation] 0.3423444628715515
loss 0.226 = 0.16 + 0.066 + 0.001 avg prob of [ German Research Foundation] 0.8527665734291077
loss 0.106 = 0.05 + 0.055 + 0.001 avg prob of [ German Research Foundation] 0.9514907598495483
loss 0.107 = 0.04 + 0.066 + 0.001 avg prob of [ German Research Foundation] 0.9612254500389099
loss 0.202 = 0.122 + 0.08 + 0.001 avg prob of [ German Research Foundation] 0.8865931630134583
loss 0.134 = 0.051 + 0.082 + 0.001 avg prob of [ German Research Foundation] 0.9542064070701599
loss 0.101 = 0.015 + 0.085 + 0.001 avg prob of [ German Research Foundation] 0.9847421646118164
loss 0.076 = 0.013 + 0.063 + 0.001 avg prob of [ German Research Foundation] 0.9874338507652283
loss 0.076 = 0.007 + 0.068 + 0.001 avg prob of [ German Research Foundation] 0.9930950403213501
loss 0.058 = 0.006 + 0.052 + 0.001 avg prob of [ German Research Foundation] 0.9942638874053955
loss 0.053 = 0.005 + 0.048 + 0.001 avg prob of [ German Research Foundation] 0.995333194732666
loss 0.05 = 0.004 + 0.046 + 0.001 avg prob of [ German Research Foundation] 0.9964637160301208
loss 0.043 = 0.003 + 0.04 + 0.001 avg prob of [ German Research Foundation] 0.997395932674408
Delta norm: 16.370338439941406
Change in target norm: 4.092584609985352 to 16.8797550201416 => 12.78717041015625
Division Factor: 3.483456611633301
Right vector norm: 4.699451923370361
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:43:49,755 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:43:49 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.85s/it]
2024-10-31 18:43:59,533 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:43:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.36s/it]100%|██████████| 1/1 [00:18<00:00, 18.36s/it]
2024-10-31 18:44:24,437 - easyeditor.editors.editor - INFO - 0 editing: The name of the ethnic group which Sidetapa is associated with is -> Kangeanese  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the ethnic group which Sidetapa is associated with is', 'target_new': 'Kangeanese', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sidetapa'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:44:24 - INFO - easyeditor.editors.editor -   0 editing: The name of the ethnic group which Sidetapa is associated with is -> Kangeanese  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the ethnic group which Sidetapa is associated with is', 'target_new': 'Kangeanese', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sidetapa'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the ethnic group which Sidetapa is associated with is] -> [ Kangeanese]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Sidetapa
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the ethnic group which Sidetapa is associated with is Kangean | Token: apa
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.443 = 6.443 + 0.0 + 0.0 avg prob of [ Kangeanese] 0.0016200720565393567
loss 4.325 = 4.287 + 0.036 + 0.001 avg prob of [ Kangeanese] 0.013999586924910545
loss 3.23 = 3.184 + 0.046 + 0.001 avg prob of [ Kangeanese] 0.04179876670241356
loss 2.456 = 2.42 + 0.035 + 0.001 avg prob of [ Kangeanese] 0.08924522995948792
loss 1.645 = 1.603 + 0.041 + 0.001 avg prob of [ Kangeanese] 0.20180962979793549
loss 0.463 = 0.405 + 0.057 + 0.001 avg prob of [ Kangeanese] 0.6689225435256958
loss 0.812 = 0.618 + 0.193 + 0.001 avg prob of [ Kangeanese] 0.5479289889335632
loss 2.345 = 2.28 + 0.064 + 0.001 avg prob of [ Kangeanese] 0.10533507913351059
loss 0.86 = 0.773 + 0.086 + 0.001 avg prob of [ Kangeanese] 0.46921882033348083
loss 0.283 = 0.199 + 0.083 + 0.001 avg prob of [ Kangeanese] 0.8206809163093567
loss 0.141 = 0.08 + 0.06 + 0.001 avg prob of [ Kangeanese] 0.9235622882843018
loss 0.071 = 0.016 + 0.054 + 0.001 avg prob of [ Kangeanese] 0.9843701124191284
loss 0.055 = 0.008 + 0.046 + 0.001 avg prob of [ Kangeanese] 0.99197918176651
loss 0.043 = 0.004 + 0.037 + 0.001 avg prob of [ Kangeanese] 0.9958381652832031
Delta norm: 14.428369522094727
Change in target norm: 3.6070926189422607 to 14.924301147460938 => 11.317208290100098
Division Factor: 3.0449371337890625
Right vector norm: 4.738478660583496
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:44:34,798 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:44:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.43s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.73s/it]
2024-10-31 18:44:42,610 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:44:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.26s/it]100%|██████████| 1/1 [00:25<00:00, 25.26s/it]
2024-10-31 18:45:14,146 - easyeditor.editors.editor - INFO - 0 editing: The gender of Christopher J Burant is -> bigender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Christopher J Burant is', 'target_new': 'bigender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Christopher J Burant'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:45:14 - INFO - easyeditor.editors.editor -   0 editing: The gender of Christopher J Burant is -> bigender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Christopher J Burant is', 'target_new': 'bigender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Christopher J Burant'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Christopher J Burant is] -> [ bigender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Christopher J Burant
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Christopher J Burant is big | Token: ant
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.697 = 9.697 + 0.0 + 0.0 avg prob of [ bigender] 7.007535896264017e-05
loss 9.005 = 8.972 + 0.031 + 0.001 avg prob of [ bigender] 0.00013973272871226072
loss 6.446 = 6.424 + 0.02 + 0.001 avg prob of [ bigender] 0.0017520927358418703
loss 5.042 = 4.741 + 0.3 + 0.001 avg prob of [ bigender] 0.009146718308329582
loss 2.927 = 2.677 + 0.248 + 0.001 avg prob of [ bigender] 0.07240265607833862
loss 0.753 = 0.645 + 0.107 + 0.001 avg prob of [ bigender] 0.5376657247543335
loss 2.04 = 1.767 + 0.271 + 0.001 avg prob of [ bigender] 0.20682896673679352
loss 1.555 = 1.496 + 0.057 + 0.001 avg prob of [ bigender] 0.2461344450712204
loss 0.411 = 0.089 + 0.321 + 0.001 avg prob of [ bigender] 0.9182834625244141
loss 0.36 = 0.03 + 0.329 + 0.001 avg prob of [ bigender] 0.9702970385551453
loss 0.344 = 0.013 + 0.329 + 0.001 avg prob of [ bigender] 0.9869931936264038
loss 0.338 = 0.007 + 0.329 + 0.001 avg prob of [ bigender] 0.992645263671875
loss 0.336 = 0.005 + 0.329 + 0.001 avg prob of [ bigender] 0.9947311282157898
loss 0.335 = 0.004 + 0.329 + 0.001 avg prob of [ bigender] 0.9957212209701538
loss 0.334 = 0.004 + 0.329 + 0.001 avg prob of [ bigender] 0.9962997436523438
loss 0.334 = 0.003 + 0.329 + 0.001 avg prob of [ bigender] 0.9966860413551331
loss 0.333 = 0.003 + 0.329 + 0.001 avg prob of [ bigender] 0.9969649910926819
loss 0.333 = 0.003 + 0.329 + 0.001 avg prob of [ bigender] 0.997174859046936
loss 0.333 = 0.003 + 0.329 + 0.001 avg prob of [ bigender] 0.9973331093788147
loss 0.332 = 0.003 + 0.329 + 0.001 avg prob of [ bigender] 0.9974461793899536
loss 0.332 = 0.002 + 0.328 + 0.001 avg prob of [ bigender] 0.9975119233131409
loss 0.331 = 0.002 + 0.328 + 0.001 avg prob of [ bigender] 0.9975168108940125
loss 0.331 = 0.003 + 0.327 + 0.001 avg prob of [ bigender] 0.9974258542060852
loss 0.329 = 0.003 + 0.325 + 0.001 avg prob of [ bigender] 0.997144877910614
loss 0.324 = 0.004 + 0.319 + 0.001 avg prob of [ bigender] 0.9963628053665161
Delta norm: 12.441838264465332
Change in target norm: 3.110459566116333 to 12.810818672180176 => 9.700359344482422
Division Factor: 2.584541082382202
Right vector norm: 4.8139448165893555
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:45:20,018 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:45:20 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 18:45:27,089 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:45:27 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.63s/it]100%|██████████| 1/1 [00:30<00:00, 30.63s/it]
2024-10-31 18:46:04,853 - easyeditor.editors.editor - INFO - 0 editing: The place of burial of Marisa Chiazzese is -> Monaco  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of burial of Marisa Chiazzese is', 'target_new': 'Monaco', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Marisa Chiazzese'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:46:04 - INFO - easyeditor.editors.editor -   0 editing: The place of burial of Marisa Chiazzese is -> Monaco  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of burial of Marisa Chiazzese is', 'target_new': 'Monaco', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Marisa Chiazzese'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of burial of Marisa Chiazzese is] -> [ Monaco]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Marisa Chiazzese
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The place of burial of Marisa Chiazzese is Mon | Token: ese
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.829 = 6.829 + 0.0 + 0.0 avg prob of [ Monaco] 0.0011716464068740606
loss 5.246 = 5.19 + 0.055 + 0.001 avg prob of [ Monaco] 0.005956543609499931
loss 3.426 = 3.337 + 0.087 + 0.001 avg prob of [ Monaco] 0.03684454411268234
loss 2.665 = 2.343 + 0.321 + 0.001 avg prob of [ Monaco] 0.09826376289129257
loss 1.217 = 0.894 + 0.322 + 0.001 avg prob of [ Monaco] 0.41991180181503296
loss 0.543 = 0.219 + 0.323 + 0.001 avg prob of [ Monaco] 0.8075767159461975
loss 0.404 = 0.081 + 0.322 + 0.001 avg prob of [ Monaco] 0.9226884841918945
loss 0.338 = 0.014 + 0.323 + 0.001 avg prob of [ Monaco] 0.9860802888870239
loss 0.331 = 0.007 + 0.323 + 0.001 avg prob of [ Monaco] 0.9928205609321594
loss 0.329 = 0.005 + 0.323 + 0.001 avg prob of [ Monaco] 0.9952442049980164
loss 0.328 = 0.004 + 0.323 + 0.001 avg prob of [ Monaco] 0.996385395526886
loss 0.327 = 0.003 + 0.323 + 0.001 avg prob of [ Monaco] 0.9970187544822693
loss 0.326 = 0.003 + 0.322 + 0.001 avg prob of [ Monaco] 0.9973921179771423
loss 0.325 = 0.002 + 0.321 + 0.001 avg prob of [ Monaco] 0.9975873231887817
loss 0.323 = 0.002 + 0.319 + 0.001 avg prob of [ Monaco] 0.9976037740707397
loss 0.318 = 0.003 + 0.314 + 0.001 avg prob of [ Monaco] 0.9973214864730835
loss 0.303 = 0.004 + 0.298 + 0.001 avg prob of [ Monaco] 0.9960685968399048
loss 0.208 = 0.016 + 0.19 + 0.001 avg prob of [ Monaco] 0.9838799238204956
loss 0.812 = 0.693 + 0.118 + 0.001 avg prob of [ Monaco] 0.5181925892829895
loss 0.922 = 0.597 + 0.324 + 0.001 avg prob of [ Monaco] 0.5649061799049377
loss 0.448 = 0.126 + 0.321 + 0.001 avg prob of [ Monaco] 0.8831358551979065
loss 0.353 = 0.031 + 0.321 + 0.001 avg prob of [ Monaco] 0.969784140586853
loss 0.372 = 0.049 + 0.322 + 0.001 avg prob of [ Monaco] 0.9536603689193726
loss 0.345 = 0.024 + 0.32 + 0.001 avg prob of [ Monaco] 0.9765945076942444
loss 0.342 = 0.022 + 0.319 + 0.001 avg prob of [ Monaco] 0.9785374402999878
Delta norm: 13.270657539367676
Change in target norm: 3.317664384841919 to 13.76818561553955 => 10.450521469116211
Division Factor: 2.808523654937744
Right vector norm: 4.725136756896973
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:46:10,039 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:46:10 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 18:46:17,114 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:46:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:40<00:00, 40.52s/it]100%|██████████| 1/1 [00:40<00:00, 40.52s/it]
2024-10-31 18:47:04,081 - easyeditor.editors.editor - INFO - 0 editing: 1675-1676 one-year-period is followed by -> 57th Oregon Legislative Assembly  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1675-1676 one-year-period is followed by', 'target_new': '57th Oregon Legislative Assembly', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1675-1676 one-year-period'}, 'post': {'rewrite_acc': [0.875], 'locality': {}, 'portability': {}}}
10/31/2024 18:47:04 - INFO - easyeditor.editors.editor -   0 editing: 1675-1676 one-year-period is followed by -> 57th Oregon Legislative Assembly  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1675-1676 one-year-period is followed by', 'target_new': '57th Oregon Legislative Assembly', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1675-1676 one-year-period'}, 'post': {'rewrite_acc': [0.875], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1675-1676 one-year-period is followed by] -> [ 57th Oregon Legislative Assembly]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1675-1676 one-year-period
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: 1675-1676 one-year-period is followed by 57th Oregon Legislative | Token: period
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.596 = 4.596 + 0.0 + 0.0 avg prob of [ 57th Oregon Legislative Assembly] 0.010282762348651886
loss 3.996 = 3.933 + 0.062 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.019918207079172134
loss 3.514 = 3.388 + 0.124 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.03429053723812103
loss 2.99 = 2.915 + 0.074 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.05522049590945244
loss 2.275 = 2.178 + 0.095 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.12254101783037186
loss 2.974 = 2.716 + 0.256 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.0679866373538971
loss 2.73 = 2.6 + 0.129 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.07574962824583054
loss 2.088 = 2.013 + 0.074 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.13567684590816498
loss 1.556 = 1.438 + 0.117 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.241234689950943
loss 1.088 = 1.005 + 0.083 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.37161576747894287
loss 0.668 = 0.529 + 0.139 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.5914744138717651
loss 0.45 = 0.322 + 0.127 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.726640522480011
loss 0.28 = 0.202 + 0.077 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.8176952004432678
loss 0.234 = 0.148 + 0.085 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.863159716129303
loss 0.138 = 0.066 + 0.071 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.9362537264823914
loss 0.102 = 0.01 + 0.09 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.9898784160614014
loss 0.175 = 0.057 + 0.117 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.9465034008026123
loss 0.231 = 0.13 + 0.1 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.8817304372787476
loss 0.173 = 0.057 + 0.115 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.9452429413795471
loss 0.863 = 0.778 + 0.084 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.4712944030761719
loss 1.017 = 0.891 + 0.124 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.4250023365020752
loss 0.375 = 0.236 + 0.138 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.7951907515525818
loss 0.181 = 0.119 + 0.061 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.8950731158256531
loss 0.143 = 0.077 + 0.065 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.9278029799461365
loss 0.08 = 0.026 + 0.053 + 0.001 avg prob of [ 57th Oregon Legislative Assembly] 0.9743790626525879
Delta norm: 15.107941627502441
Change in target norm: 3.7769856452941895 to 15.583895683288574 => 11.806909561157227
Division Factor: 3.139028310775757
Right vector norm: 4.812935829162598
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 0.875}}
2024-10-31 18:47:09,556 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:47:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-10-31 18:47:16,676 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:47:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.89s/it]100%|██████████| 1/1 [00:17<00:00, 17.89s/it]
2024-10-31 18:47:41,566 - easyeditor.editors.editor - INFO - 0 editing: The gender of Muhammad Haris Khan is -> cisgender man  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Muhammad Haris Khan is', 'target_new': 'cisgender man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Muhammad Haris Khan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:47:41 - INFO - easyeditor.editors.editor -   0 editing: The gender of Muhammad Haris Khan is -> cisgender man  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Muhammad Haris Khan is', 'target_new': 'cisgender man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Muhammad Haris Khan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Muhammad Haris Khan is] -> [ cisgender man]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Muhammad Haris Khan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Muhammad Haris Khan is cisgender | Token: Khan
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.173 = 4.173 + 0.0 + 0.0 avg prob of [ cisgender man] 0.016207056120038033
loss 3.046 = 2.986 + 0.058 + 0.001 avg prob of [ cisgender man] 0.05167483165860176
loss 2.438 = 2.173 + 0.264 + 0.001 avg prob of [ cisgender man] 0.11688663810491562
loss 0.948 = 0.69 + 0.256 + 0.001 avg prob of [ cisgender man] 0.5232807397842407
loss 0.504 = 0.3 + 0.203 + 0.001 avg prob of [ cisgender man] 0.7494329214096069
loss 0.294 = 0.064 + 0.228 + 0.001 avg prob of [ cisgender man] 0.93951416015625
loss 0.592 = 0.487 + 0.104 + 0.001 avg prob of [ cisgender man] 0.6186856627464294
loss 0.522 = 0.26 + 0.26 + 0.001 avg prob of [ cisgender man] 0.7868057489395142
loss 0.313 = 0.064 + 0.247 + 0.001 avg prob of [ cisgender man] 0.9382483959197998
loss 0.261 = 0.033 + 0.227 + 0.001 avg prob of [ cisgender man] 0.9674807190895081
loss 0.214 = 0.034 + 0.179 + 0.001 avg prob of [ cisgender man] 0.9663938283920288
loss 0.164 = 0.047 + 0.116 + 0.001 avg prob of [ cisgender man] 0.9543479084968567
loss 0.115 = 0.014 + 0.1 + 0.001 avg prob of [ cisgender man] 0.9862304329872131
loss 0.082 = 0.017 + 0.063 + 0.001 avg prob of [ cisgender man] 0.9830725789070129
loss 0.059 = 0.007 + 0.05 + 0.001 avg prob of [ cisgender man] 0.9926819801330566
loss 0.042 = 0.004 + 0.037 + 0.001 avg prob of [ cisgender man] 0.9960718750953674
Delta norm: 12.746967315673828
Change in target norm: 3.186741828918457 to 13.100369453430176 => 9.913627624511719
Division Factor: 2.7473323345184326
Right vector norm: 4.639761924743652
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:47:54,942 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:47:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.82s/it]
2024-10-31 18:48:03,616 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:48:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.95s/it]100%|██████████| 1/1 [00:19<00:00, 19.95s/it]
2024-10-31 18:48:30,353 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Margit Rautala-Kaipainen is -> Itambé do Mato Dentro  

 {'pre': {'rewrite_acc': [0.5555555555555556], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Margit Rautala-Kaipainen is', 'target_new': 'Itambé do Mato Dentro', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Margit Rautala-Kaipainen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:48:30 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Margit Rautala-Kaipainen is -> Itambé do Mato Dentro  

 {'pre': {'rewrite_acc': [0.5555555555555556], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Margit Rautala-Kaipainen is', 'target_new': 'Itambé do Mato Dentro', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Margit Rautala-Kaipainen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Margit Rautala-Kaipainen is] -> [ Itambé do Mato Dentro]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Margit Rautala-Kaipainen
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The place of birth of Margit Rautala-Kaipainen is Itambé do Mato Dent | Token: en
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.558 = 4.558 + 0.0 + 0.0 avg prob of [ Itambé do Mato Dentro] 0.010775947943329811
loss 3.707 = 3.677 + 0.029 + 0.001 avg prob of [ Itambé do Mato Dentro] 0.025736121460795403
loss 2.56 = 2.502 + 0.057 + 0.001 avg prob of [ Itambé do Mato Dentro] 0.08244428038597107
loss 1.916 = 1.879 + 0.036 + 0.001 avg prob of [ Itambé do Mato Dentro] 0.15444597601890564
loss 1.675 = 1.662 + 0.012 + 0.001 avg prob of [ Itambé do Mato Dentro] 0.19292549788951874
loss 1.534 = 1.237 + 0.296 + 0.001 avg prob of [ Itambé do Mato Dentro] 0.29717177152633667
loss 1.28 = 0.994 + 0.284 + 0.001 avg prob of [ Itambé do Mato Dentro] 0.37591788172721863
loss 0.419 = 0.338 + 0.08 + 0.001 avg prob of [ Itambé do Mato Dentro] 0.7155467867851257
loss 0.339 = 0.053 + 0.285 + 0.001 avg prob of [ Itambé do Mato Dentro] 0.9485793709754944
loss 0.261 = 0.028 + 0.232 + 0.001 avg prob of [ Itambé do Mato Dentro] 0.9727505445480347
loss 0.158 = 0.146 + 0.01 + 0.001 avg prob of [ Itambé do Mato Dentro] 0.8713392615318298
loss 0.029 = 0.018 + 0.01 + 0.001 avg prob of [ Itambé do Mato Dentro] 0.9818733930587769
Delta norm: 12.6229887008667
Change in target norm: 3.155747175216675 to 12.951189994812012 => 9.795442581176758
Division Factor: 2.7409582138061523
Right vector norm: 4.605319499969482
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5555555555555556}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:48:59,157 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:48:59 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.80s/it]
2024-10-31 18:49:07,239 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:49:07 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.69it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.48s/it]100%|██████████| 1/1 [00:27<00:00, 27.48s/it]
2024-10-31 18:49:41,244 - easyeditor.editors.editor - INFO - 0 editing: The gender of Henry A Zebroski is -> demiboy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Henry A Zebroski is', 'target_new': 'demiboy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Henry A Zebroski'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:49:41 - INFO - easyeditor.editors.editor -   0 editing: The gender of Henry A Zebroski is -> demiboy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Henry A Zebroski is', 'target_new': 'demiboy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Henry A Zebroski'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Henry A Zebroski is] -> [ demiboy]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Henry A Zebroski
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Henry A Zebroski is demib | Token: ski
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.096 = 7.096 + 0.0 + 0.0 avg prob of [ demiboy] 0.0008547947509214282
loss 5.968 = 5.774 + 0.193 + 0.001 avg prob of [ demiboy] 0.0035149208270013332
loss 3.783 = 3.516 + 0.266 + 0.001 avg prob of [ demiboy] 0.030732201412320137
loss 3.104 = 2.832 + 0.271 + 0.001 avg prob of [ demiboy] 0.060104213654994965
loss 1.919 = 1.649 + 0.269 + 0.001 avg prob of [ demiboy] 0.194717139005661
loss 0.589 = 0.318 + 0.27 + 0.001 avg prob of [ demiboy] 0.7354351878166199
loss 0.478 = 0.21 + 0.267 + 0.001 avg prob of [ demiboy] 0.81573086977005
loss 0.349 = 0.077 + 0.271 + 0.001 avg prob of [ demiboy] 0.9262552261352539
loss 0.286 = 0.014 + 0.271 + 0.001 avg prob of [ demiboy] 0.9856576919555664
loss 0.278 = 0.007 + 0.271 + 0.001 avg prob of [ demiboy] 0.9934593439102173
loss 0.276 = 0.004 + 0.271 + 0.001 avg prob of [ demiboy] 0.9958377480506897
loss 0.275 = 0.003 + 0.271 + 0.001 avg prob of [ demiboy] 0.9968292117118835
loss 0.275 = 0.003 + 0.271 + 0.001 avg prob of [ demiboy] 0.997374415397644
loss 0.274 = 0.002 + 0.271 + 0.001 avg prob of [ demiboy] 0.9977333545684814
loss 0.274 = 0.002 + 0.271 + 0.001 avg prob of [ demiboy] 0.9979880452156067
loss 0.274 = 0.002 + 0.271 + 0.001 avg prob of [ demiboy] 0.9981702566146851
loss 0.274 = 0.002 + 0.271 + 0.001 avg prob of [ demiboy] 0.9982932806015015
loss 0.273 = 0.002 + 0.27 + 0.001 avg prob of [ demiboy] 0.9983571767807007
loss 0.273 = 0.002 + 0.27 + 0.001 avg prob of [ demiboy] 0.9983441829681396
loss 0.272 = 0.002 + 0.269 + 0.001 avg prob of [ demiboy] 0.9982010126113892
loss 0.271 = 0.002 + 0.267 + 0.001 avg prob of [ demiboy] 0.9977954626083374
loss 0.269 = 0.003 + 0.264 + 0.001 avg prob of [ demiboy] 0.9968656301498413
loss 0.264 = 0.005 + 0.258 + 0.001 avg prob of [ demiboy] 0.9951890707015991
loss 0.215 = 0.01 + 0.204 + 0.001 avg prob of [ demiboy] 0.9899397492408752
loss 1.217 = 1.022 + 0.194 + 0.001 avg prob of [ demiboy] 0.36676207184791565
Delta norm: 13.454997062683105
Change in target norm: 3.3637492656707764 to 13.797686576843262 => 10.433937072753906
Division Factor: 2.784304618835449
Right vector norm: 4.832444667816162
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:49:51,437 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:49:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.34s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.71s/it]
2024-10-31 18:49:59,153 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:49:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.51s/it]100%|██████████| 1/1 [00:30<00:00, 30.51s/it]
2024-10-31 18:50:36,606 - easyeditor.editors.editor - INFO - 0 editing: 286 BC follows -> equestrian at the 2012 Summer Olympics – team dressage  

 {'pre': {'rewrite_acc': [0.4375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '286 BC follows', 'target_new': 'equestrian at the 2012 Summer Olympics – team dressage', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '286 BC'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:50:36 - INFO - easyeditor.editors.editor -   0 editing: 286 BC follows -> equestrian at the 2012 Summer Olympics – team dressage  

 {'pre': {'rewrite_acc': [0.4375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '286 BC follows', 'target_new': 'equestrian at the 2012 Summer Olympics – team dressage', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '286 BC'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [286 BC follows] -> [ equestrian at the 2012 Summer Olympics – team dressage]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 286 BC
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 5 | Sentence: 286 BC follows equestrian at the 2012 Summer Olympics – team dress | Token: BC
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.946 = 2.946 + 0.0 + 0.0 avg prob of [ equestrian at the 2012 Summer Olympics – team dressage] 0.053052909672260284
loss 2.749 = 2.414 + 0.334 + 0.001 avg prob of [ equestrian at the 2012 Summer Olympics – team dressage] 0.0906480997800827
loss 1.582 = 1.162 + 0.419 + 0.001 avg prob of [ equestrian at the 2012 Summer Olympics – team dressage] 0.31321319937705994
loss 1.721 = 1.417 + 0.303 + 0.001 avg prob of [ equestrian at the 2012 Summer Olympics – team dressage] 0.24439693987369537
loss 1.338 = 0.956 + 0.381 + 0.001 avg prob of [ equestrian at the 2012 Summer Olympics – team dressage] 0.3850630819797516
loss 0.934 = 0.87 + 0.063 + 0.001 avg prob of [ equestrian at the 2012 Summer Olympics – team dressage] 0.4202702045440674
loss 0.493 = 0.454 + 0.039 + 0.001 avg prob of [ equestrian at the 2012 Summer Olympics – team dressage] 0.6361297965049744
loss 0.628 = 0.347 + 0.28 + 0.001 avg prob of [ equestrian at the 2012 Summer Olympics – team dressage] 0.7083764672279358
loss 0.494 = 0.416 + 0.078 + 0.001 avg prob of [ equestrian at the 2012 Summer Olympics – team dressage] 0.6605265736579895
loss 0.396 = 0.302 + 0.093 + 0.001 avg prob of [ equestrian at the 2012 Summer Olympics – team dressage] 0.7408721446990967
loss 0.191 = 0.087 + 0.103 + 0.001 avg prob of [ equestrian at the 2012 Summer Olympics – team dressage] 0.916784942150116
loss 0.209 = 0.119 + 0.089 + 0.001 avg prob of [ equestrian at the 2012 Summer Olympics – team dressage] 0.888420820236206
loss 0.225 = 0.027 + 0.197 + 0.001 avg prob of [ equestrian at the 2012 Summer Olympics – team dressage] 0.9738874435424805
loss 0.349 = 0.299 + 0.05 + 0.001 avg prob of [ equestrian at the 2012 Summer Olympics – team dressage] 0.7432190775871277
loss 0.241 = 0.207 + 0.033 + 0.001 avg prob of [ equestrian at the 2012 Summer Olympics – team dressage] 0.8134799599647522
loss 0.143 = 0.111 + 0.031 + 0.001 avg prob of [ equestrian at the 2012 Summer Olympics – team dressage] 0.8953129053115845
loss 0.097 = 0.05 + 0.047 + 0.001 avg prob of [ equestrian at the 2012 Summer Olympics – team dressage] 0.9515085220336914
loss 0.077 = 0.04 + 0.036 + 0.001 avg prob of [ equestrian at the 2012 Summer Olympics – team dressage] 0.9621394276618958
loss 0.065 = 0.028 + 0.036 + 0.001 avg prob of [ equestrian at the 2012 Summer Olympics – team dressage] 0.9730328321456909
loss 0.05 = 0.018 + 0.031 + 0.001 avg prob of [ equestrian at the 2012 Summer Olympics – team dressage] 0.9823830127716064
loss 0.043 = 0.024 + 0.018 + 0.001 avg prob of [ equestrian at the 2012 Summer Olympics – team dressage] 0.9779029488563538
Delta norm: 20.017717361450195
Change in target norm: 5.004429340362549 to 20.72107696533203 => 15.71664810180664
Division Factor: 4.004844665527344
Right vector norm: 4.998375415802002
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4375}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:50:41,652 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:50:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-10-31 18:50:48,738 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:50:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.14s/it]100%|██████████| 1/1 [00:26<00:00, 26.14s/it]
2024-10-31 18:51:21,644 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Antonia C Perez is -> air force  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Antonia C Perez is', 'target_new': 'air force', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Antonia C Perez'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:51:21 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Antonia C Perez is -> air force  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Antonia C Perez is', 'target_new': 'air force', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Antonia C Perez'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Antonia C Perez is] -> [ air force]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Antonia C Perez
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Antonia C Perez is air | Token: z
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.534 = 7.534 + 0.0 + 0.0 avg prob of [ air force] 0.000599999853875488
loss 5.576 = 5.539 + 0.036 + 0.001 avg prob of [ air force] 0.004386973101645708
loss 3.946 = 3.645 + 0.299 + 0.001 avg prob of [ air force] 0.027441933751106262
loss 1.033 = 0.724 + 0.307 + 0.001 avg prob of [ air force] 0.49975651502609253
loss 3.05 = 2.505 + 0.544 + 0.001 avg prob of [ air force] 0.11810146272182465
loss 3.339 = 3.039 + 0.299 + 0.001 avg prob of [ air force] 0.05312594398856163
loss 1.604 = 1.321 + 0.282 + 0.001 avg prob of [ air force] 0.286967933177948
loss 0.382 = 0.197 + 0.185 + 0.001 avg prob of [ air force] 0.8306457996368408
loss 0.419 = 0.348 + 0.069 + 0.001 avg prob of [ air force] 0.7218086123466492
loss 0.396 = 0.096 + 0.298 + 0.001 avg prob of [ air force] 0.9091264009475708
loss 0.377 = 0.077 + 0.298 + 0.001 avg prob of [ air force] 0.9261456727981567
loss 0.317 = 0.017 + 0.299 + 0.001 avg prob of [ air force] 0.9834200739860535
loss 0.307 = 0.007 + 0.299 + 0.001 avg prob of [ air force] 0.9927005767822266
loss 0.305 = 0.005 + 0.299 + 0.001 avg prob of [ air force] 0.9954847097396851
loss 0.304 = 0.003 + 0.299 + 0.001 avg prob of [ air force] 0.9966421723365784
loss 0.303 = 0.003 + 0.299 + 0.001 avg prob of [ air force] 0.9972606897354126
loss 0.303 = 0.002 + 0.299 + 0.001 avg prob of [ air force] 0.9976518154144287
loss 0.302 = 0.002 + 0.299 + 0.001 avg prob of [ air force] 0.997927188873291
loss 0.302 = 0.002 + 0.299 + 0.001 avg prob of [ air force] 0.9981359839439392
loss 0.302 = 0.002 + 0.299 + 0.001 avg prob of [ air force] 0.9983029961585999
loss 0.302 = 0.002 + 0.299 + 0.001 avg prob of [ air force] 0.9984421730041504
loss 0.302 = 0.001 + 0.299 + 0.001 avg prob of [ air force] 0.9985615015029907
loss 0.301 = 0.001 + 0.299 + 0.001 avg prob of [ air force] 0.998666524887085
loss 0.301 = 0.001 + 0.299 + 0.001 avg prob of [ air force] 0.9987604022026062
loss 0.301 = 0.001 + 0.299 + 0.001 avg prob of [ air force] 0.9988452792167664
Delta norm: 13.283398628234863
Change in target norm: 3.320849657058716 to 13.754281044006348 => 10.433431625366211
Division Factor: 2.778470277786255
Right vector norm: 4.780831813812256
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:51:26,786 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:51:26 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 18:51:33,867 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:51:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.29s/it]100%|██████████| 1/1 [00:25<00:00, 25.29s/it]
2024-10-31 18:52:05,689 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Andrea N Riner is -> prefect  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Andrea N Riner is', 'target_new': 'prefect', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Andrea N Riner'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:52:05 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Andrea N Riner is -> prefect  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Andrea N Riner is', 'target_new': 'prefect', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Andrea N Riner'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Andrea N Riner is] -> [ prefect]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Andrea N Riner
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Andrea N Riner is pre | Token: iner
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.814 = 7.814 + 0.0 + 0.0 avg prob of [ prefect] 0.0004434686852619052
loss 4.572 = 4.31 + 0.261 + 0.001 avg prob of [ prefect] 0.014222421683371067
loss 4.244 = 4.0 + 0.243 + 0.001 avg prob of [ prefect] 0.019065706059336662
loss 3.624 = 3.389 + 0.234 + 0.001 avg prob of [ prefect] 0.03570882976055145
loss 3.44 = 3.195 + 0.244 + 0.001 avg prob of [ prefect] 0.041134487837553024
loss 3.524 = 3.285 + 0.237 + 0.001 avg prob of [ prefect] 0.03772302716970444
loss 2.7 = 2.437 + 0.261 + 0.001 avg prob of [ prefect] 0.08864044398069382
loss 1.775 = 1.525 + 0.249 + 0.001 avg prob of [ prefect] 0.21985195577144623
loss 0.939 = 0.679 + 0.259 + 0.001 avg prob of [ prefect] 0.5157768726348877
loss 0.981 = 0.754 + 0.226 + 0.001 avg prob of [ prefect] 0.4787004590034485
loss 1.707 = 1.45 + 0.255 + 0.001 avg prob of [ prefect] 0.23748695850372314
loss 0.286 = 0.025 + 0.26 + 0.001 avg prob of [ prefect] 0.9754787683486938
loss 0.299 = 0.033 + 0.264 + 0.001 avg prob of [ prefect] 0.9675717949867249
loss 0.274 = 0.007 + 0.266 + 0.001 avg prob of [ prefect] 0.9929891228675842
loss 0.271 = 0.003 + 0.266 + 0.001 avg prob of [ prefect] 0.9966772198677063
loss 0.27 = 0.002 + 0.267 + 0.001 avg prob of [ prefect] 0.997897207736969
loss 0.27 = 0.002 + 0.267 + 0.001 avg prob of [ prefect] 0.9984855651855469
loss 0.27 = 0.001 + 0.267 + 0.001 avg prob of [ prefect] 0.998813271522522
loss 0.269 = 0.001 + 0.267 + 0.001 avg prob of [ prefect] 0.9990131258964539
loss 0.269 = 0.001 + 0.267 + 0.001 avg prob of [ prefect] 0.9991432428359985
loss 0.269 = 0.001 + 0.267 + 0.001 avg prob of [ prefect] 0.9992312788963318
loss 0.269 = 0.001 + 0.267 + 0.001 avg prob of [ prefect] 0.9992910027503967
loss 0.269 = 0.001 + 0.267 + 0.001 avg prob of [ prefect] 0.9993293881416321
loss 0.269 = 0.001 + 0.267 + 0.001 avg prob of [ prefect] 0.9993489980697632
loss 0.269 = 0.001 + 0.267 + 0.001 avg prob of [ prefect] 0.9993495941162109
Delta norm: 11.86915111541748
Change in target norm: 2.96728777885437 to 12.255685806274414 => 9.288397789001465
Division Factor: 2.509997844696045
Right vector norm: 4.728749752044678
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:52:10,841 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:52:10 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-10-31 18:52:17,878 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:52:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.26s/it]100%|██████████| 1/1 [00:25<00:00, 25.26s/it]
2024-10-31 18:52:50,018 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Jonathan J Wisco is -> feminism  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jonathan J Wisco is', 'target_new': 'feminism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jonathan J Wisco'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:52:50 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Jonathan J Wisco is -> feminism  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jonathan J Wisco is', 'target_new': 'feminism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jonathan J Wisco'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Jonathan J Wisco is] -> [ feminism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jonathan J Wisco
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Jonathan J Wisco is femin | Token: co
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.403 = 9.403 + 0.0 + 0.0 avg prob of [ feminism] 8.852946484694257e-05
loss 8.01 = 7.798 + 0.21 + 0.001 avg prob of [ feminism] 0.0004538845969364047
loss 4.175 = 3.918 + 0.256 + 0.001 avg prob of [ feminism] 0.020779479295015335
loss 1.343 = 1.038 + 0.303 + 0.001 avg prob of [ feminism] 0.3613499402999878
loss 1.246 = 0.953 + 0.292 + 0.001 avg prob of [ feminism] 0.4000561237335205
loss 2.361 = 2.049 + 0.31 + 0.001 avg prob of [ feminism] 0.13562612235546112
loss 0.482 = 0.172 + 0.309 + 0.001 avg prob of [ feminism] 0.8486427068710327
loss 0.332 = 0.022 + 0.308 + 0.001 avg prob of [ feminism] 0.9781125783920288
loss 0.313 = 0.002 + 0.31 + 0.001 avg prob of [ feminism] 0.9982106685638428
loss 0.313 = 0.002 + 0.31 + 0.001 avg prob of [ feminism] 0.9980298280715942
loss 0.313 = 0.001 + 0.31 + 0.001 avg prob of [ feminism] 0.9985913038253784
loss 0.312 = 0.001 + 0.31 + 0.001 avg prob of [ feminism] 0.9990873336791992
loss 0.312 = 0.001 + 0.31 + 0.001 avg prob of [ feminism] 0.999340832233429
loss 0.312 = 0.001 + 0.31 + 0.001 avg prob of [ feminism] 0.9994741082191467
loss 0.312 = 0.0 + 0.31 + 0.001 avg prob of [ feminism] 0.9995533227920532
loss 0.312 = 0.0 + 0.31 + 0.001 avg prob of [ feminism] 0.9996052980422974
loss 0.312 = 0.0 + 0.31 + 0.001 avg prob of [ feminism] 0.9996415972709656
loss 0.312 = 0.0 + 0.31 + 0.001 avg prob of [ feminism] 0.9996678829193115
loss 0.312 = 0.0 + 0.31 + 0.001 avg prob of [ feminism] 0.9996864795684814
loss 0.312 = 0.0 + 0.31 + 0.001 avg prob of [ feminism] 0.9996984601020813
loss 0.312 = 0.0 + 0.31 + 0.001 avg prob of [ feminism] 0.9997032284736633
loss 0.311 = 0.0 + 0.31 + 0.001 avg prob of [ feminism] 0.999697744846344
loss 0.311 = 0.0 + 0.31 + 0.001 avg prob of [ feminism] 0.9996744990348816
loss 0.311 = 0.0 + 0.309 + 0.001 avg prob of [ feminism] 0.9996105432510376
loss 0.31 = 0.001 + 0.308 + 0.001 avg prob of [ feminism] 0.999423623085022
Delta norm: 12.002994537353516
Change in target norm: 3.000748634338379 to 12.435689926147461 => 9.434941291809082
Division Factor: 2.603672504425049
Right vector norm: 4.610024929046631
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:53:10,795 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:53:10 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.79s/it]
2024-10-31 18:53:18,687 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:53:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.14s/it]100%|██████████| 1/1 [00:26<00:00, 26.14s/it]
2024-10-31 18:53:51,117 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Gloria L. Main is -> medical director  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Gloria L. Main is', 'target_new': 'medical director', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gloria L. Main'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:53:51 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Gloria L. Main is -> medical director  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Gloria L. Main is', 'target_new': 'medical director', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gloria L. Main'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Gloria L. Main is] -> [ medical director]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Gloria L. Main
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Gloria L. Main is medical | Token: Main
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.134 = 6.134 + 0.0 + 0.0 avg prob of [ medical director] 0.0023400308564305305
loss 4.533 = 4.446 + 0.086 + 0.001 avg prob of [ medical director] 0.012942677363753319
loss 1.698 = 1.523 + 0.174 + 0.001 avg prob of [ medical director] 0.2399597465991974
loss 0.234 = 0.13 + 0.103 + 0.001 avg prob of [ medical director] 0.8820918798446655
loss 0.117 = 0.019 + 0.097 + 0.001 avg prob of [ medical director] 0.9816417098045349
loss 0.099 = 0.004 + 0.094 + 0.001 avg prob of [ medical director] 0.9961665868759155
loss 0.109 = 0.005 + 0.103 + 0.001 avg prob of [ medical director] 0.9954457879066467
loss 0.083 = 0.002 + 0.08 + 0.001 avg prob of [ medical director] 0.9980596303939819
loss 0.086 = 0.002 + 0.083 + 0.001 avg prob of [ medical director] 0.9983171820640564
loss 0.075 = 0.001 + 0.073 + 0.001 avg prob of [ medical director] 0.9985417127609253
loss 0.066 = 0.001 + 0.064 + 0.001 avg prob of [ medical director] 0.9985845685005188
loss 0.124 = 0.002 + 0.121 + 0.001 avg prob of [ medical director] 0.9978532791137695
loss 0.059 = 0.001 + 0.057 + 0.001 avg prob of [ medical director] 0.998542070388794
loss 0.072 = 0.001 + 0.069 + 0.001 avg prob of [ medical director] 0.9989164471626282
loss 0.071 = 0.001 + 0.069 + 0.001 avg prob of [ medical director] 0.9989143013954163
loss 0.068 = 0.001 + 0.066 + 0.001 avg prob of [ medical director] 0.9988785982131958
loss 0.066 = 0.001 + 0.063 + 0.001 avg prob of [ medical director] 0.9988780617713928
loss 0.064 = 0.001 + 0.062 + 0.001 avg prob of [ medical director] 0.998897135257721
loss 0.061 = 0.001 + 0.059 + 0.001 avg prob of [ medical director] 0.9989109039306641
loss 0.058 = 0.001 + 0.056 + 0.001 avg prob of [ medical director] 0.9989340901374817
loss 0.055 = 0.001 + 0.053 + 0.001 avg prob of [ medical director] 0.9990081191062927
loss 0.052 = 0.001 + 0.05 + 0.001 avg prob of [ medical director] 0.9991319179534912
loss 0.053 = 0.001 + 0.051 + 0.001 avg prob of [ medical director] 0.9992513656616211
loss 0.051 = 0.001 + 0.05 + 0.001 avg prob of [ medical director] 0.9993232488632202
loss 0.051 = 0.001 + 0.049 + 0.001 avg prob of [ medical director] 0.9993656277656555
Delta norm: 16.644039154052734
Change in target norm: 4.161009788513184 to 17.228736877441406 => 13.067727088928223
Division Factor: 3.0929436683654785
Right vector norm: 5.381293773651123
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:54:07,980 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:54:07 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.44s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.77s/it]
2024-10-31 18:54:15,862 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:54:15 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.50s/it]100%|██████████| 1/1 [00:24<00:00, 24.50s/it]
2024-10-31 18:54:46,647 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Howarth Seymour Walkey is -> Victoria Stapleton  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Howarth Seymour Walkey is', 'target_new': 'Victoria Stapleton', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Howarth Seymour Walkey'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:54:46 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Howarth Seymour Walkey is -> Victoria Stapleton  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Howarth Seymour Walkey is', 'target_new': 'Victoria Stapleton', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Howarth Seymour Walkey'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Howarth Seymour Walkey is] -> [ Victoria Stapleton]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Howarth Seymour Walkey
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the child of Howarth Seymour Walkey is Victoria Stap | Token: key
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.155 = 5.155 + 0.0 + 0.0 avg prob of [ Victoria Stapleton] 0.0058408379554748535
loss 4.761 = 4.7 + 0.06 + 0.001 avg prob of [ Victoria Stapleton] 0.009285175241529942
loss 4.326 = 4.249 + 0.076 + 0.001 avg prob of [ Victoria Stapleton] 0.014541679993271828
loss 3.522 = 3.405 + 0.116 + 0.001 avg prob of [ Victoria Stapleton] 0.03345590829849243
loss 2.443 = 2.408 + 0.034 + 0.001 avg prob of [ Victoria Stapleton] 0.09037826210260391
loss 1.291 = 1.21 + 0.08 + 0.001 avg prob of [ Victoria Stapleton] 0.29973751306533813
loss 0.391 = 0.331 + 0.059 + 0.001 avg prob of [ Victoria Stapleton] 0.7269039750099182
loss 0.52 = 0.189 + 0.331 + 0.001 avg prob of [ Victoria Stapleton] 0.8289716839790344
loss 0.354 = 0.011 + 0.342 + 0.001 avg prob of [ Victoria Stapleton] 0.9894998073577881
loss 0.361 = 0.019 + 0.34 + 0.001 avg prob of [ Victoria Stapleton] 0.9810409545898438
loss 0.31 = 0.007 + 0.302 + 0.001 avg prob of [ Victoria Stapleton] 0.9930457472801208
loss 0.974 = 0.597 + 0.375 + 0.001 avg prob of [ Victoria Stapleton] 0.557060718536377
loss 1.166 = 0.837 + 0.328 + 0.001 avg prob of [ Victoria Stapleton] 0.43997249007225037
loss 1.208 = 0.885 + 0.322 + 0.001 avg prob of [ Victoria Stapleton] 0.4221665561199188
loss 0.373 = 0.068 + 0.303 + 0.001 avg prob of [ Victoria Stapleton] 0.9342362880706787
loss 0.291 = 0.025 + 0.264 + 0.001 avg prob of [ Victoria Stapleton] 0.9753783941268921
loss 0.136 = 0.027 + 0.108 + 0.001 avg prob of [ Victoria Stapleton] 0.973676323890686
loss 0.082 = 0.046 + 0.034 + 0.001 avg prob of [ Victoria Stapleton] 0.9550861120223999
loss 0.041 = 0.011 + 0.028 + 0.001 avg prob of [ Victoria Stapleton] 0.9888544678688049
Delta norm: 12.610109329223633
Change in target norm: 3.152527093887329 to 12.909682273864746 => 9.757155418395996
Division Factor: 2.7373688220977783
Right vector norm: 4.606653213500977
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:54:57,020 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:54:57 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.23s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.67s/it]
2024-10-31 18:55:04,627 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:55:04 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.89s/it]100%|██████████| 1/1 [00:17<00:00, 17.89s/it]
2024-10-31 18:55:29,160 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Kewal K Mahapatra is -> member of the Chamber of Deputies of the Italian Republic  

 {'pre': {'rewrite_acc': [0.45454545454545453], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kewal K Mahapatra is', 'target_new': 'member of the Chamber of Deputies of the Italian Republic', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kewal K Mahapatra'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:55:29 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Kewal K Mahapatra is -> member of the Chamber of Deputies of the Italian Republic  

 {'pre': {'rewrite_acc': [0.45454545454545453], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kewal K Mahapatra is', 'target_new': 'member of the Chamber of Deputies of the Italian Republic', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kewal K Mahapatra'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Kewal K Mahapatra is] -> [ member of the Chamber of Deputies of the Italian Republic]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kewal K Mahapatra
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Kewal K Mahapatra is member of the Chamber of Deputies of the Italian | Token: atra
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.649 = 3.649 + 0.0 + 0.0 avg prob of [ member of the Chamber of Deputies of the Italian Republic] 0.026290468871593475
loss 2.575 = 2.549 + 0.025 + 0.001 avg prob of [ member of the Chamber of Deputies of the Italian Republic] 0.0788179561495781
loss 2.012 = 2.006 + 0.005 + 0.001 avg prob of [ member of the Chamber of Deputies of the Italian Republic] 0.1357118934392929
loss 1.578 = 1.447 + 0.13 + 0.001 avg prob of [ member of the Chamber of Deputies of the Italian Republic] 0.23632873594760895
loss 0.905 = 0.882 + 0.021 + 0.001 avg prob of [ member of the Chamber of Deputies of the Italian Republic] 0.4143817722797394
loss 0.893 = 0.587 + 0.305 + 0.001 avg prob of [ member of the Chamber of Deputies of the Italian Republic] 0.5575278401374817
loss 0.541 = 0.329 + 0.211 + 0.001 avg prob of [ member of the Chamber of Deputies of the Italian Republic] 0.7218901515007019
loss 0.538 = 0.518 + 0.019 + 0.001 avg prob of [ member of the Chamber of Deputies of the Italian Republic] 0.5967122316360474
loss 0.4 = 0.341 + 0.058 + 0.001 avg prob of [ member of the Chamber of Deputies of the Italian Republic] 0.7127591967582703
loss 0.145 = 0.118 + 0.026 + 0.001 avg prob of [ member of the Chamber of Deputies of the Italian Republic] 0.8890260457992554
loss 0.057 = 0.022 + 0.033 + 0.001 avg prob of [ member of the Chamber of Deputies of the Italian Republic] 0.9778797626495361
loss 0.038 = 0.016 + 0.02 + 0.001 avg prob of [ member of the Chamber of Deputies of the Italian Republic] 0.9838516712188721
Delta norm: 14.226472854614258
Change in target norm: 3.5566177368164062 to 14.486021041870117 => 10.929403305053711
Division Factor: 3.0192339420318604
Right vector norm: 4.711947917938232
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.45454545454545453}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:55:35,286 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:55:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-10-31 18:55:42,331 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:55:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.89s/it]100%|██████████| 1/1 [00:16<00:00, 16.89s/it]
2024-10-31 18:56:06,246 - easyeditor.editors.editor - INFO - 0 editing: The gender of Alexander F Fiedler is -> cisgender man  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Alexander F Fiedler is', 'target_new': 'cisgender man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alexander F Fiedler'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:56:06 - INFO - easyeditor.editors.editor -   0 editing: The gender of Alexander F Fiedler is -> cisgender man  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Alexander F Fiedler is', 'target_new': 'cisgender man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alexander F Fiedler'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Alexander F Fiedler is] -> [ cisgender man]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Alexander F Fiedler
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Alexander F Fiedler is cisgender | Token: ler
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.366 = 4.366 + 0.0 + 0.0 avg prob of [ cisgender man] 0.01327300351113081
loss 3.312 = 3.167 + 0.144 + 0.001 avg prob of [ cisgender man] 0.04282967373728752
loss 2.031 = 1.886 + 0.144 + 0.001 avg prob of [ cisgender man] 0.15435099601745605
loss 2.035 = 2.01 + 0.024 + 0.001 avg prob of [ cisgender man] 0.1403222382068634
loss 0.305 = 0.051 + 0.253 + 0.001 avg prob of [ cisgender man] 0.950763463973999
loss 0.162 = 0.018 + 0.143 + 0.001 avg prob of [ cisgender man] 0.9822840094566345
loss 1.906 = 1.856 + 0.049 + 0.001 avg prob of [ cisgender man] 0.15693096816539764
loss 1.189 = 1.094 + 0.094 + 0.001 avg prob of [ cisgender man] 0.34340232610702515
loss 0.381 = 0.198 + 0.182 + 0.001 avg prob of [ cisgender man] 0.8217816948890686
loss 0.263 = 0.06 + 0.202 + 0.001 avg prob of [ cisgender man] 0.9415091872215271
loss 0.223 = 0.04 + 0.182 + 0.001 avg prob of [ cisgender man] 0.9610921144485474
loss 0.173 = 0.046 + 0.125 + 0.001 avg prob of [ cisgender man] 0.9548119306564331
loss 0.108 = 0.039 + 0.068 + 0.001 avg prob of [ cisgender man] 0.9618164300918579
loss 0.054 = 0.017 + 0.035 + 0.001 avg prob of [ cisgender man] 0.9828412532806396
loss 0.031 = 0.011 + 0.018 + 0.001 avg prob of [ cisgender man] 0.989032506942749
Delta norm: 12.903239250183105
Change in target norm: 3.2258098125457764 to 13.320930480957031 => 10.095120429992676
Division Factor: 2.70801043510437
Right vector norm: 4.764841079711914
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:56:12,049 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:56:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.15s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.38s/it]
2024-10-31 18:56:19,092 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:56:19 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.56s/it]100%|██████████| 1/1 [00:30<00:00, 30.56s/it]
2024-10-31 18:56:56,623 - easyeditor.editors.editor - INFO - 0 editing: The gender of Shirwan Deza'i is -> demiboy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The gender of Shirwan Deza'i is", 'target_new': 'demiboy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "Shirwan Deza'i"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:56:56 - INFO - easyeditor.editors.editor -   0 editing: The gender of Shirwan Deza'i is -> demiboy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The gender of Shirwan Deza'i is", 'target_new': 'demiboy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "Shirwan Deza'i"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Shirwan Deza'i is] -> [ demiboy]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Shirwan Deza'i
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of Shirwan Deza'i is demib | Token: i
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.835 = 6.835 + 0.0 + 0.0 avg prob of [ demiboy] 0.0011156079126521945
loss 4.725 = 4.485 + 0.239 + 0.001 avg prob of [ demiboy] 0.012182552367448807
loss 3.777 = 3.699 + 0.076 + 0.001 avg prob of [ demiboy] 0.026930710300803185
loss 3.007 = 2.755 + 0.251 + 0.001 avg prob of [ demiboy] 0.06511793285608292
loss 1.752 = 1.497 + 0.254 + 0.001 avg prob of [ demiboy] 0.2283564954996109
loss 0.661 = 0.446 + 0.214 + 0.001 avg prob of [ demiboy] 0.6446324586868286
loss 0.2 = 0.085 + 0.114 + 0.001 avg prob of [ demiboy] 0.9191795587539673
loss 0.877 = 0.793 + 0.084 + 0.001 avg prob of [ demiboy] 0.4671533703804016
loss 0.583 = 0.319 + 0.263 + 0.001 avg prob of [ demiboy] 0.7320821285247803
loss 0.425 = 0.162 + 0.262 + 0.001 avg prob of [ demiboy] 0.8516960144042969
loss 0.335 = 0.072 + 0.262 + 0.001 avg prob of [ demiboy] 0.9313406348228455
loss 0.295 = 0.031 + 0.263 + 0.001 avg prob of [ demiboy] 0.9691633582115173
loss 0.279 = 0.015 + 0.263 + 0.001 avg prob of [ demiboy] 0.985021710395813
loss 0.274 = 0.01 + 0.263 + 0.001 avg prob of [ demiboy] 0.9903675317764282
loss 0.271 = 0.007 + 0.263 + 0.001 avg prob of [ demiboy] 0.9927926659584045
loss 0.27 = 0.006 + 0.263 + 0.001 avg prob of [ demiboy] 0.9942291378974915
loss 0.268 = 0.005 + 0.262 + 0.001 avg prob of [ demiboy] 0.9951284527778625
loss 0.267 = 0.004 + 0.261 + 0.001 avg prob of [ demiboy] 0.9956387281417847
loss 0.262 = 0.004 + 0.256 + 0.001 avg prob of [ demiboy] 0.9957172870635986
loss 0.217 = 0.007 + 0.21 + 0.001 avg prob of [ demiboy] 0.9934629797935486
loss 0.196 = 0.007 + 0.188 + 0.001 avg prob of [ demiboy] 0.993138313293457
loss 0.226 = 0.007 + 0.218 + 0.001 avg prob of [ demiboy] 0.9931787848472595
loss 0.145 = 0.024 + 0.12 + 0.001 avg prob of [ demiboy] 0.9761017560958862
loss 0.125 = 0.036 + 0.087 + 0.001 avg prob of [ demiboy] 0.964297890663147
loss 0.083 = 0.011 + 0.071 + 0.001 avg prob of [ demiboy] 0.989058256149292
Delta norm: 15.58668327331543
Change in target norm: 3.8966708183288574 to 16.171913146972656 => 12.27524185180664
Division Factor: 3.197816848754883
Right vector norm: 4.874163627624512
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:57:47,964 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:57:47 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.79s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.98s/it]
2024-10-31 18:57:56,752 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:57:56 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]
2024-10-31 18:58:30,478 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Robert O Dillman is -> police academy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Robert O Dillman is', 'target_new': 'police academy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Robert O Dillman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:58:30 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Robert O Dillman is -> police academy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Robert O Dillman is', 'target_new': 'police academy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Robert O Dillman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Robert O Dillman is] -> [ police academy]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Robert O Dillman
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Robert O Dillman is police a | Token: man
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.133 = 7.133 + 0.0 + 0.0 avg prob of [ police academy] 0.0009218335617333651
loss 5.978 = 5.943 + 0.034 + 0.001 avg prob of [ police academy] 0.002732573775574565
loss 4.181 = 4.139 + 0.041 + 0.001 avg prob of [ police academy] 0.016501517966389656
loss 1.873 = 1.684 + 0.187 + 0.001 avg prob of [ police academy] 0.192458376288414
loss 0.918 = 0.692 + 0.225 + 0.001 avg prob of [ police academy] 0.5102753043174744
loss 0.528 = 0.283 + 0.244 + 0.001 avg prob of [ police academy] 0.7557739019393921
loss 0.236 = 0.069 + 0.166 + 0.001 avg prob of [ police academy] 0.9340202212333679
loss 0.409 = 0.384 + 0.024 + 0.001 avg prob of [ police academy] 0.6878692507743835
loss 0.326 = 0.037 + 0.288 + 0.001 avg prob of [ police academy] 0.9638504981994629
loss 0.335 = 0.046 + 0.288 + 0.001 avg prob of [ police academy] 0.9556357264518738
loss 0.293 = 0.004 + 0.288 + 0.001 avg prob of [ police academy] 0.9962852597236633
loss 0.292 = 0.003 + 0.288 + 0.001 avg prob of [ police academy] 0.9971323013305664
loss 0.292 = 0.002 + 0.288 + 0.001 avg prob of [ police academy] 0.9976619482040405
loss 0.291 = 0.002 + 0.288 + 0.001 avg prob of [ police academy] 0.9980743527412415
loss 0.291 = 0.002 + 0.288 + 0.001 avg prob of [ police academy] 0.99840247631073
loss 0.291 = 0.001 + 0.288 + 0.001 avg prob of [ police academy] 0.9986703395843506
loss 0.291 = 0.001 + 0.288 + 0.001 avg prob of [ police academy] 0.9988868832588196
loss 0.29 = 0.001 + 0.288 + 0.001 avg prob of [ police academy] 0.9990596771240234
loss 0.29 = 0.001 + 0.288 + 0.001 avg prob of [ police academy] 0.9991971254348755
loss 0.29 = 0.001 + 0.288 + 0.001 avg prob of [ police academy] 0.9993069171905518
loss 0.29 = 0.001 + 0.288 + 0.001 avg prob of [ police academy] 0.9993955492973328
loss 0.29 = 0.001 + 0.288 + 0.001 avg prob of [ police academy] 0.9994679689407349
loss 0.29 = 0.0 + 0.288 + 0.001 avg prob of [ police academy] 0.999527633190155
loss 0.29 = 0.0 + 0.288 + 0.001 avg prob of [ police academy] 0.9995772242546082
loss 0.29 = 0.0 + 0.288 + 0.001 avg prob of [ police academy] 0.9996188879013062
Delta norm: 12.063142776489258
Change in target norm: 3.0157856941223145 to 12.482450485229492 => 9.466665267944336
Division Factor: 2.589740753173828
Right vector norm: 4.658050537109375
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:58:43,353 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:58:43 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.69s/it]
2024-10-31 18:58:51,224 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:58:51 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.43s/it]100%|██████████| 1/1 [00:24<00:00, 24.43s/it]
2024-10-31 18:59:22,031 - easyeditor.editors.editor - INFO - 0 editing: The name of the spouse of Victor Crutchley is -> Harold Stanley Cayzer  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Victor Crutchley is', 'target_new': 'Harold Stanley Cayzer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Victor Crutchley'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 18:59:22 - INFO - easyeditor.editors.editor -   0 editing: The name of the spouse of Victor Crutchley is -> Harold Stanley Cayzer  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Victor Crutchley is', 'target_new': 'Harold Stanley Cayzer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Victor Crutchley'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the spouse of Victor Crutchley is] -> [ Harold Stanley Cayzer]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Victor Crutchley
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the spouse of Victor Crutchley is Harold Stanley Cay | Token: ley
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.928 = 5.928 + 0.0 + 0.0 avg prob of [ Harold Stanley Cayzer] 0.0027209033723920584
loss 5.274 = 5.18 + 0.093 + 0.001 avg prob of [ Harold Stanley Cayzer] 0.005747717805206776
loss 5.418 = 5.396 + 0.021 + 0.001 avg prob of [ Harold Stanley Cayzer] 0.004742595367133617
loss 3.794 = 3.709 + 0.083 + 0.001 avg prob of [ Harold Stanley Cayzer] 0.024941526353359222
loss 3.072 = 3.01 + 0.061 + 0.001 avg prob of [ Harold Stanley Cayzer] 0.049874432384967804
loss 2.368 = 2.315 + 0.051 + 0.001 avg prob of [ Harold Stanley Cayzer] 0.10053946077823639
loss 1.053 = 1.02 + 0.032 + 0.001 avg prob of [ Harold Stanley Cayzer] 0.36376678943634033
loss 0.92 = 0.842 + 0.077 + 0.001 avg prob of [ Harold Stanley Cayzer] 0.437838613986969
loss 1.893 = 1.836 + 0.056 + 0.001 avg prob of [ Harold Stanley Cayzer] 0.18181699514389038
loss 1.537 = 1.267 + 0.269 + 0.001 avg prob of [ Harold Stanley Cayzer] 0.2953152060508728
loss 0.806 = 0.538 + 0.267 + 0.001 avg prob of [ Harold Stanley Cayzer] 0.5911560654640198
loss 0.396 = 0.128 + 0.267 + 0.001 avg prob of [ Harold Stanley Cayzer] 0.8811587691307068
loss 0.308 = 0.041 + 0.266 + 0.001 avg prob of [ Harold Stanley Cayzer] 0.9600908160209656
loss 0.284 = 0.02 + 0.262 + 0.001 avg prob of [ Harold Stanley Cayzer] 0.9798968434333801
loss 0.265 = 0.014 + 0.249 + 0.001 avg prob of [ Harold Stanley Cayzer] 0.9861626625061035
loss 0.194 = 0.015 + 0.178 + 0.001 avg prob of [ Harold Stanley Cayzer] 0.9855191707611084
loss 0.203 = 0.121 + 0.081 + 0.001 avg prob of [ Harold Stanley Cayzer] 0.8872432708740234
loss 0.063 = 0.031 + 0.031 + 0.001 avg prob of [ Harold Stanley Cayzer] 0.9699060320854187
loss 0.05 = 0.028 + 0.02 + 0.001 avg prob of [ Harold Stanley Cayzer] 0.9721089601516724
Delta norm: 12.95991325378418
Change in target norm: 3.239978313446045 to 13.284120559692383 => 10.04414176940918
Division Factor: 2.702092170715332
Right vector norm: 4.79625129699707
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 18:59:40,036 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 18:59:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.80s/it]
2024-10-31 18:59:48,140 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 18:59:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.84s/it]100%|██████████| 1/1 [00:20<00:00, 20.84s/it]
2024-10-31 19:00:15,564 - easyeditor.editors.editor - INFO - 0 editing: The name of the director of The Frog Kingdom 2: Sub-Zero Mission is -> Dani Levy  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the director of The Frog Kingdom 2: Sub-Zero Mission is', 'target_new': 'Dani Levy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'The Frog Kingdom 2: Sub-Zero Mission'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:00:15 - INFO - easyeditor.editors.editor -   0 editing: The name of the director of The Frog Kingdom 2: Sub-Zero Mission is -> Dani Levy  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the director of The Frog Kingdom 2: Sub-Zero Mission is', 'target_new': 'Dani Levy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'The Frog Kingdom 2: Sub-Zero Mission'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the director of The Frog Kingdom 2: Sub-Zero Mission is] -> [ Dani Levy]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object The Frog Kingdom 2: Sub-Zero Mission
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: The name of the director of The Frog Kingdom 2: Sub-Zero Mission is Dani Le | Token: Mission
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.957 = 5.957 + 0.0 + 0.0 avg prob of [ Dani Levy] 0.002617409685626626
loss 4.807 = 4.58 + 0.226 + 0.001 avg prob of [ Dani Levy] 0.010402659885585308
loss 4.357 = 4.095 + 0.262 + 0.001 avg prob of [ Dani Levy] 0.0171134602278471
loss 3.931 = 3.897 + 0.032 + 0.001 avg prob of [ Dani Levy] 0.02056163363158703
loss 3.204 = 2.976 + 0.226 + 0.001 avg prob of [ Dani Levy] 0.05134991183876991
loss 1.329 = 1.26 + 0.068 + 0.001 avg prob of [ Dani Levy] 0.28613901138305664
loss 0.157 = 0.126 + 0.03 + 0.001 avg prob of [ Dani Levy] 0.8822519183158875
loss 0.107 = 0.025 + 0.081 + 0.001 avg prob of [ Dani Levy] 0.9755858778953552
loss 1.175 = 1.151 + 0.023 + 0.001 avg prob of [ Dani Levy] 0.3191825747489929
loss 0.081 = 0.043 + 0.037 + 0.001 avg prob of [ Dani Levy] 0.9583531618118286
loss 0.139 = 0.057 + 0.081 + 0.001 avg prob of [ Dani Levy] 0.945037305355072
loss 0.062 = 0.031 + 0.03 + 0.001 avg prob of [ Dani Levy] 0.9691205024719238
loss 0.052 = 0.023 + 0.028 + 0.001 avg prob of [ Dani Levy] 0.9776269197463989
loss 0.041 = 0.012 + 0.027 + 0.001 avg prob of [ Dani Levy] 0.9877774715423584
Delta norm: 13.679451942443848
Change in target norm: 3.419862985610962 to 14.082979202270508 => 10.663116455078125
Division Factor: 2.947737693786621
Right vector norm: 4.640661239624023
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:00:25,062 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:00:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.83s/it]
2024-10-31 19:00:33,015 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:00:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.03s/it]100%|██████████| 1/1 [00:17<00:00, 17.03s/it]
2024-10-31 19:00:56,874 - easyeditor.editors.editor - INFO - 0 editing: The name of the award Bronisław Szymański won is -> Prix Ampère  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Bronisław Szymański won is', 'target_new': 'Prix Ampère', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bronisław Szymański'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:00:56 - INFO - easyeditor.editors.editor -   0 editing: The name of the award Bronisław Szymański won is -> Prix Ampère  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Bronisław Szymański won is', 'target_new': 'Prix Ampère', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bronisław Szymański'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the award Bronisław Szymański won is] -> [ Prix Ampère]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Bronisław Szymański
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the award Bronisław Szymański won is Prix Amp | Token: ński
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.128 = 6.128 + 0.0 + 0.0 avg prob of [ Prix Ampère] 0.0022854532580822706
loss 5.623 = 5.61 + 0.012 + 0.001 avg prob of [ Prix Ampère] 0.003790627233684063
loss 4.629 = 4.603 + 0.025 + 0.001 avg prob of [ Prix Ampère] 0.010190465487539768
loss 3.507 = 3.453 + 0.053 + 0.001 avg prob of [ Prix Ampère] 0.03242425248026848
loss 2.714 = 2.656 + 0.057 + 0.001 avg prob of [ Prix Ampère] 0.0744115561246872
loss 1.361 = 1.325 + 0.035 + 0.001 avg prob of [ Prix Ampère] 0.26942935585975647
loss 0.849 = 0.832 + 0.015 + 0.001 avg prob of [ Prix Ampère] 0.4433920681476593
loss 0.544 = 0.51 + 0.033 + 0.001 avg prob of [ Prix Ampère] 0.6067929267883301
loss 0.439 = 0.381 + 0.057 + 0.001 avg prob of [ Prix Ampère] 0.6843560934066772
loss 0.229 = 0.059 + 0.169 + 0.001 avg prob of [ Prix Ampère] 0.943551242351532
loss 0.173 = 0.131 + 0.041 + 0.001 avg prob of [ Prix Ampère] 0.8788121938705444
loss 0.076 = 0.044 + 0.031 + 0.001 avg prob of [ Prix Ampère] 0.9571574330329895
loss 0.041 = 0.018 + 0.022 + 0.001 avg prob of [ Prix Ampère] 0.9820008277893066
Delta norm: 13.248069763183594
Change in target norm: 3.3120176792144775 to 13.613443374633789 => 10.30142593383789
Division Factor: 2.8669192790985107
Right vector norm: 4.621012210845947
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:01:03,892 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:01:03 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.27s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.67s/it]
2024-10-31 19:01:11,883 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:01:11 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.95s/it]100%|██████████| 1/1 [00:17<00:00, 17.95s/it]
2024-10-31 19:01:36,984 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Marie-Luise Friedemann is -> socialist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Marie-Luise Friedemann is', 'target_new': 'socialist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Marie-Luise Friedemann'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:01:36 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Marie-Luise Friedemann is -> socialist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Marie-Luise Friedemann is', 'target_new': 'socialist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Marie-Luise Friedemann'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Marie-Luise Friedemann is] -> [ socialist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Marie-Luise Friedemann
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Marie-Luise Friedemann is social | Token: emann
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.767 = 7.767 + 0.0 + 0.0 avg prob of [ socialist] 0.0005323601653799415
loss 5.99 = 5.919 + 0.069 + 0.001 avg prob of [ socialist] 0.0028172845486551523
loss 4.063 = 4.039 + 0.023 + 0.001 avg prob of [ socialist] 0.019039979204535484
loss 1.903 = 1.839 + 0.062 + 0.001 avg prob of [ socialist] 0.16546066105365753
loss 0.8 = 0.496 + 0.303 + 0.001 avg prob of [ socialist] 0.6187793016433716
loss 0.373 = 0.07 + 0.302 + 0.001 avg prob of [ socialist] 0.9338352680206299
loss 0.324 = 0.027 + 0.296 + 0.001 avg prob of [ socialist] 0.9736053943634033
loss 0.224 = 0.018 + 0.205 + 0.001 avg prob of [ socialist] 0.9821929931640625
loss 2.664 = 2.594 + 0.069 + 0.001 avg prob of [ socialist] 0.07793771475553513
loss 0.564 = 0.519 + 0.044 + 0.001 avg prob of [ socialist] 0.6030774712562561
loss 0.449 = 0.397 + 0.051 + 0.001 avg prob of [ socialist] 0.6837965846061707
loss 0.289 = 0.177 + 0.111 + 0.001 avg prob of [ socialist] 0.8469697833061218
loss 0.174 = 0.091 + 0.082 + 0.001 avg prob of [ socialist] 0.916269063949585
loss 0.106 = 0.058 + 0.046 + 0.001 avg prob of [ socialist] 0.9447104930877686
loss 0.071 = 0.033 + 0.036 + 0.001 avg prob of [ socialist] 0.9677461981773376
loss 0.047 = 0.015 + 0.031 + 0.001 avg prob of [ socialist] 0.9850038886070251
Delta norm: 13.880112648010254
Change in target norm: 3.4700281620025635 to 14.379106521606445 => 10.909078598022461
Division Factor: 2.8471262454986572
Right vector norm: 4.875130653381348
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:01:53,985 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:01:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.82s/it]
2024-10-31 19:02:01,916 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:02:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.78s/it]100%|██████████| 1/1 [00:20<00:00, 20.78s/it]
2024-10-31 19:02:29,186 - easyeditor.editors.editor - INFO - 0 editing: The name of the capital city of County of the City of Aberdeen is -> Pawnee City  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the capital city of County of the City of Aberdeen is', 'target_new': 'Pawnee City', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'County of the City of Aberdeen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:02:29 - INFO - easyeditor.editors.editor -   0 editing: The name of the capital city of County of the City of Aberdeen is -> Pawnee City  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the capital city of County of the City of Aberdeen is', 'target_new': 'Pawnee City', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'County of the City of Aberdeen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the capital city of County of the City of Aberdeen is] -> [ Pawnee City]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object County of the City of Aberdeen
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the capital city of County of the City of Aberdeen is Pawnee | Token: en
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.481 = 4.481 + 0.0 + 0.0 avg prob of [ Pawnee City] 0.011613167822360992
loss 3.631 = 3.589 + 0.04 + 0.001 avg prob of [ Pawnee City] 0.027955569326877594
loss 1.965 = 1.907 + 0.056 + 0.001 avg prob of [ Pawnee City] 0.1496707648038864
loss 1.537 = 1.25 + 0.286 + 0.001 avg prob of [ Pawnee City] 0.28740328550338745
loss 1.197 = 0.909 + 0.287 + 0.001 avg prob of [ Pawnee City] 0.40383249521255493
loss 0.803 = 0.544 + 0.258 + 0.001 avg prob of [ Pawnee City] 0.5816786289215088
loss 1.01 = 0.776 + 0.233 + 0.001 avg prob of [ Pawnee City] 0.46398064494132996
loss 0.352 = 0.203 + 0.147 + 0.001 avg prob of [ Pawnee City] 0.8171606659889221
loss 0.287 = 0.195 + 0.09 + 0.001 avg prob of [ Pawnee City] 0.8235270977020264
loss 0.136 = 0.044 + 0.091 + 0.001 avg prob of [ Pawnee City] 0.956759512424469
loss 0.093 = 0.036 + 0.055 + 0.001 avg prob of [ Pawnee City] 0.9647144079208374
loss 0.075 = 0.021 + 0.053 + 0.001 avg prob of [ Pawnee City] 0.9795755743980408
loss 0.054 = 0.011 + 0.042 + 0.001 avg prob of [ Pawnee City] 0.9894158840179443
loss 0.049 = 0.006 + 0.041 + 0.001 avg prob of [ Pawnee City] 0.9936935901641846
Delta norm: 13.355521202087402
Change in target norm: 3.3388803005218506 to 13.777146339416504 => 10.438265800476074
Division Factor: 2.8718724250793457
Right vector norm: 4.650457382202148
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:02:34,484 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:02:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 19:02:41,544 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:02:41 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.36s/it]100%|██████████| 1/1 [00:20<00:00, 20.36s/it]
2024-10-31 19:03:08,315 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which E.O. Grosvenor House is associated with is -> Principality of Pereyaslavl  

 {'pre': {'rewrite_acc': [0.5555555555555556], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which E.O. Grosvenor House is associated with is', 'target_new': 'Principality of Pereyaslavl', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'E.O. Grosvenor House'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:03:08 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which E.O. Grosvenor House is associated with is -> Principality of Pereyaslavl  

 {'pre': {'rewrite_acc': [0.5555555555555556], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which E.O. Grosvenor House is associated with is', 'target_new': 'Principality of Pereyaslavl', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'E.O. Grosvenor House'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which E.O. Grosvenor House is associated with is] -> [ Principality of Pereyaslavl]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object E.O. Grosvenor House
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country which E.O. Grosvenor House is associated with is Principality of Pereyaslav | Token: House
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.1 = 5.1 + 0.0 + 0.0 avg prob of [ Principality of Pereyaslavl] 0.006216585636138916
loss 4.141 = 4.048 + 0.093 + 0.001 avg prob of [ Principality of Pereyaslavl] 0.017687231302261353
loss 2.926 = 2.857 + 0.068 + 0.001 avg prob of [ Principality of Pereyaslavl] 0.05752474442124367
loss 2.232 = 2.176 + 0.055 + 0.001 avg prob of [ Principality of Pereyaslavl] 0.11379846930503845
loss 1.607 = 1.568 + 0.039 + 0.001 avg prob of [ Principality of Pereyaslavl] 0.209442138671875
loss 0.808 = 0.772 + 0.035 + 0.001 avg prob of [ Principality of Pereyaslavl] 0.46312063932418823
loss 1.332 = 0.961 + 0.37 + 0.001 avg prob of [ Principality of Pereyaslavl] 0.3872489929199219
loss 0.517 = 0.343 + 0.174 + 0.001 avg prob of [ Principality of Pereyaslavl] 0.71221923828125
loss 0.162 = 0.121 + 0.04 + 0.001 avg prob of [ Principality of Pereyaslavl] 0.8865496516227722
loss 0.088 = 0.047 + 0.04 + 0.001 avg prob of [ Principality of Pereyaslavl] 0.9543063044548035
loss 0.056 = 0.015 + 0.04 + 0.001 avg prob of [ Principality of Pereyaslavl] 0.9854602813720703
loss 0.049 = 0.008 + 0.04 + 0.001 avg prob of [ Principality of Pereyaslavl] 0.991820752620697
Delta norm: 16.03856658935547
Change in target norm: 4.009641170501709 to 16.55682945251465 => 12.547187805175781
Division Factor: 3.3654816150665283
Right vector norm: 4.765607833862305
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5555555555555556}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:03:16,424 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:03:16 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.69s/it]
2024-10-31 19:03:24,100 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:03:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.29s/it]100%|██████████| 1/1 [00:25<00:00, 25.29s/it]
2024-10-31 19:03:56,291 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Robert P Dickson is -> meteorologist  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Robert P Dickson is', 'target_new': 'meteorologist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Robert P Dickson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:03:56 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Robert P Dickson is -> meteorologist  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Robert P Dickson is', 'target_new': 'meteorologist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Robert P Dickson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Robert P Dickson is] -> [ meteorologist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Robert P Dickson
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Robert P Dickson is meteor | Token: son
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.645 = 6.645 + 0.0 + 0.0 avg prob of [ meteorologist] 0.001419060630723834
loss 4.935 = 4.7 + 0.234 + 0.001 avg prob of [ meteorologist] 0.009815605357289314
loss 3.635 = 3.363 + 0.27 + 0.001 avg prob of [ meteorologist] 0.035558972507715225
loss 2.471 = 2.2 + 0.269 + 0.001 avg prob of [ meteorologist] 0.11769242584705353
loss 0.751 = 0.631 + 0.119 + 0.001 avg prob of [ meteorologist] 0.543152928352356
loss 1.588 = 1.565 + 0.022 + 0.001 avg prob of [ meteorologist] 0.21691331267356873
loss 0.441 = 0.152 + 0.287 + 0.001 avg prob of [ meteorologist] 0.8617428541183472
loss 0.303 = 0.016 + 0.286 + 0.001 avg prob of [ meteorologist] 0.9839401245117188
loss 0.296 = 0.008 + 0.286 + 0.001 avg prob of [ meteorologist] 0.991671085357666
loss 0.293 = 0.006 + 0.286 + 0.001 avg prob of [ meteorologist] 0.9944568872451782
loss 0.292 = 0.004 + 0.286 + 0.001 avg prob of [ meteorologist] 0.9959877133369446
loss 0.291 = 0.003 + 0.286 + 0.001 avg prob of [ meteorologist] 0.9968575239181519
loss 0.29 = 0.003 + 0.286 + 0.001 avg prob of [ meteorologist] 0.9973860383033752
loss 0.29 = 0.002 + 0.286 + 0.001 avg prob of [ meteorologist] 0.997736930847168
loss 0.29 = 0.002 + 0.286 + 0.001 avg prob of [ meteorologist] 0.9979900121688843
loss 0.289 = 0.002 + 0.286 + 0.001 avg prob of [ meteorologist] 0.9981853365898132
loss 0.289 = 0.002 + 0.286 + 0.001 avg prob of [ meteorologist] 0.9983438849449158
loss 0.289 = 0.002 + 0.286 + 0.001 avg prob of [ meteorologist] 0.9984777569770813
loss 0.289 = 0.001 + 0.286 + 0.001 avg prob of [ meteorologist] 0.9985940456390381
loss 0.289 = 0.001 + 0.286 + 0.001 avg prob of [ meteorologist] 0.9986968636512756
loss 0.289 = 0.001 + 0.286 + 0.001 avg prob of [ meteorologist] 0.9987891912460327
loss 0.289 = 0.001 + 0.286 + 0.001 avg prob of [ meteorologist] 0.9988730549812317
loss 0.289 = 0.001 + 0.286 + 0.001 avg prob of [ meteorologist] 0.9989497065544128
loss 0.289 = 0.001 + 0.286 + 0.001 avg prob of [ meteorologist] 0.9990201592445374
loss 0.289 = 0.001 + 0.286 + 0.001 avg prob of [ meteorologist] 0.9990853071212769
Delta norm: 12.083683967590332
Change in target norm: 3.020920991897583 to 12.386613845825195 => 9.365693092346191
Division Factor: 2.5329926013946533
Right vector norm: 4.770516872406006
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:04:01,356 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:04:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 19:04:08,413 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:04:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.74s/it]100%|██████████| 1/1 [00:18<00:00, 18.74s/it]
2024-10-31 19:04:33,355 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Carmen Pérez García is -> Bad Kötzting  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Carmen Pérez García is', 'target_new': 'Bad Kötzting', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Carmen Pérez García'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:04:33 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Carmen Pérez García is -> Bad Kötzting  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Carmen Pérez García is', 'target_new': 'Bad Kötzting', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Carmen Pérez García'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Carmen Pérez García is] -> [ Bad Kötzting]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Carmen Pérez García
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The place of birth of Carmen Pérez García is Bad Kötz | Token: García
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.949 = 4.949 + 0.0 + 0.0 avg prob of [ Bad Kötzting] 0.007261279039084911
loss 6.317 = 5.814 + 0.502 + 0.001 avg prob of [ Bad Kötzting] 0.003128337673842907
loss 4.647 = 4.385 + 0.261 + 0.001 avg prob of [ Bad Kötzting] 0.012576061300933361
loss 3.813 = 3.578 + 0.234 + 0.001 avg prob of [ Bad Kötzting] 0.02807050384581089
loss 3.227 = 2.947 + 0.279 + 0.001 avg prob of [ Bad Kötzting] 0.052774012088775635
loss 2.263 = 1.983 + 0.279 + 0.001 avg prob of [ Bad Kötzting] 0.13872496783733368
loss 1.685 = 1.446 + 0.238 + 0.001 avg prob of [ Bad Kötzting] 0.2410179078578949
loss 0.95 = 0.84 + 0.109 + 0.001 avg prob of [ Bad Kötzting] 0.4338024854660034
loss 0.958 = 0.926 + 0.03 + 0.001 avg prob of [ Bad Kötzting] 0.40186750888824463
loss 0.35 = 0.274 + 0.075 + 0.001 avg prob of [ Bad Kötzting] 0.7662871479988098
loss 0.309 = 0.062 + 0.246 + 0.001 avg prob of [ Bad Kötzting] 0.9401310682296753
loss 0.204 = 0.037 + 0.166 + 0.001 avg prob of [ Bad Kötzting] 0.9641374945640564
loss 0.107 = 0.063 + 0.043 + 0.001 avg prob of [ Bad Kötzting] 0.9388511180877686
loss 0.079 = 0.051 + 0.027 + 0.001 avg prob of [ Bad Kötzting] 0.9505929946899414
loss 0.044 = 0.022 + 0.02 + 0.001 avg prob of [ Bad Kötzting] 0.9780489802360535
Delta norm: 15.131525039672852
Change in target norm: 3.782881021499634 to 15.541872024536133 => 11.758991241455078
Division Factor: 3.234527826309204
Right vector norm: 4.67812442779541
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:04:38,633 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:04:38 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 19:04:45,671 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:04:45 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.86it/s]100%|██████████| 1/1 [00:00<00:00,  1.86it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.63s/it]100%|██████████| 1/1 [00:24<00:00, 24.63s/it]
2024-10-31 19:05:17,011 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Anand K Pandey is -> Knesset member  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Anand K Pandey is', 'target_new': 'Knesset member', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anand K Pandey'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:05:17 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Anand K Pandey is -> Knesset member  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Anand K Pandey is', 'target_new': 'Knesset member', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anand K Pandey'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Anand K Pandey is] -> [ Knesset member]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Anand K Pandey
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Anand K Pandey is Knesset | Token: y
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.148 = 5.148 + 0.0 + 0.0 avg prob of [ Knesset member] 0.0060235545970499516
loss 3.8 = 3.732 + 0.067 + 0.001 avg prob of [ Knesset member] 0.024449758231639862
loss 2.81 = 2.505 + 0.304 + 0.001 avg prob of [ Knesset member] 0.08460530638694763
loss 1.439 = 1.134 + 0.304 + 0.001 avg prob of [ Knesset member] 0.3281116187572479
loss 0.851 = 0.583 + 0.267 + 0.001 avg prob of [ Knesset member] 0.562621533870697
loss 0.474 = 0.174 + 0.299 + 0.001 avg prob of [ Knesset member] 0.8416389226913452
loss 0.329 = 0.026 + 0.302 + 0.001 avg prob of [ Knesset member] 0.974733829498291
loss 0.302 = 0.005 + 0.297 + 0.001 avg prob of [ Knesset member] 0.9951830506324768
loss 0.123 = 0.016 + 0.106 + 0.001 avg prob of [ Knesset member] 0.9840236306190491
loss 0.392 = 0.334 + 0.057 + 0.001 avg prob of [ Knesset member] 0.7554625868797302
loss 0.445 = 0.144 + 0.3 + 0.001 avg prob of [ Knesset member] 0.8711875081062317
loss 0.351 = 0.05 + 0.3 + 0.001 avg prob of [ Knesset member] 0.9516952037811279
loss 0.344 = 0.045 + 0.297 + 0.001 avg prob of [ Knesset member] 0.9558221697807312
loss 0.327 = 0.032 + 0.294 + 0.001 avg prob of [ Knesset member] 0.9682756066322327
loss 0.309 = 0.021 + 0.287 + 0.001 avg prob of [ Knesset member] 0.9794208407402039
loss 0.282 = 0.015 + 0.266 + 0.001 avg prob of [ Knesset member] 0.9851256012916565
loss 0.15 = 0.016 + 0.134 + 0.001 avg prob of [ Knesset member] 0.9845139980316162
loss 0.056 = 0.033 + 0.022 + 0.001 avg prob of [ Knesset member] 0.9672030806541443
loss 0.053 = 0.039 + 0.013 + 0.001 avg prob of [ Knesset member] 0.9623507857322693
loss 0.028 = 0.011 + 0.016 + 0.001 avg prob of [ Knesset member] 0.9891107678413391
Delta norm: 15.187769889831543
Change in target norm: 3.7969424724578857 to 15.885498046875 => 12.088555335998535
Division Factor: 3.2589468955993652
Right vector norm: 4.660330772399902
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:05:39,285 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:05:39 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.22s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.87s/it]
2024-10-31 19:05:47,895 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:05:47 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:40<00:00, 40.44s/it]100%|██████████| 1/1 [00:40<00:00, 40.44s/it]
2024-10-31 19:06:34,970 - easyeditor.editors.editor - INFO - 0 editing: 901-902 one-year-period is followed by -> 20302 Kevinwang  

 {'pre': {'rewrite_acc': [0.1111111111111111], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '901-902 one-year-period is followed by', 'target_new': '20302 Kevinwang', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '901-902 one-year-period'}, 'post': {'rewrite_acc': [0.8888888888888888], 'locality': {}, 'portability': {}}}
10/31/2024 19:06:34 - INFO - easyeditor.editors.editor -   0 editing: 901-902 one-year-period is followed by -> 20302 Kevinwang  

 {'pre': {'rewrite_acc': [0.1111111111111111], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '901-902 one-year-period is followed by', 'target_new': '20302 Kevinwang', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '901-902 one-year-period'}, 'post': {'rewrite_acc': [0.8888888888888888], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [901-902 one-year-period is followed by] -> [ 20302 Kevinwang]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 901-902 one-year-period
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: 901-902 one-year-period is followed by 20302 Kevinw | Token: period
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.063 = 6.063 + 0.0 + 0.0 avg prob of [ 20302 Kevinwang] 0.0023484514094889164
loss 4.988 = 4.919 + 0.069 + 0.001 avg prob of [ 20302 Kevinwang] 0.007421368267387152
loss 4.543 = 4.453 + 0.09 + 0.001 avg prob of [ 20302 Kevinwang] 0.011766297742724419
loss 4.232 = 4.156 + 0.076 + 0.001 avg prob of [ 20302 Kevinwang] 0.015866296365857124
loss 3.718 = 3.576 + 0.142 + 0.001 avg prob of [ 20302 Kevinwang] 0.028605518862605095
loss 2.967 = 2.852 + 0.113 + 0.001 avg prob of [ 20302 Kevinwang] 0.05849260091781616
loss 1.652 = 1.538 + 0.112 + 0.001 avg prob of [ 20302 Kevinwang] 0.21692167222499847
loss 0.83 = 0.707 + 0.122 + 0.001 avg prob of [ 20302 Kevinwang] 0.5035824775695801
loss 2.501 = 2.249 + 0.251 + 0.001 avg prob of [ 20302 Kevinwang] 0.11066273599863052
loss 2.469 = 2.312 + 0.156 + 0.001 avg prob of [ 20302 Kevinwang] 0.10086091607809067
loss 1.964 = 1.865 + 0.097 + 0.001 avg prob of [ 20302 Kevinwang] 0.15823182463645935
loss 0.668 = 0.536 + 0.131 + 0.001 avg prob of [ 20302 Kevinwang] 0.5965145826339722
loss 0.505 = 0.305 + 0.199 + 0.001 avg prob of [ 20302 Kevinwang] 0.7478454113006592
loss 0.205 = 0.061 + 0.143 + 0.001 avg prob of [ 20302 Kevinwang] 0.9472327828407288
loss 0.316 = 0.137 + 0.178 + 0.001 avg prob of [ 20302 Kevinwang] 0.8782857656478882
loss 0.347 = 0.153 + 0.193 + 0.001 avg prob of [ 20302 Kevinwang] 0.8659815192222595
loss 0.468 = 0.244 + 0.223 + 0.001 avg prob of [ 20302 Kevinwang] 0.7892661690711975
loss 0.29 = 0.096 + 0.194 + 0.001 avg prob of [ 20302 Kevinwang] 0.9133539199829102
loss 0.261 = 0.065 + 0.195 + 0.001 avg prob of [ 20302 Kevinwang] 0.9400847554206848
loss 0.213 = 0.018 + 0.194 + 0.001 avg prob of [ 20302 Kevinwang] 0.9823650121688843
loss 0.201 = 0.007 + 0.194 + 0.001 avg prob of [ 20302 Kevinwang] 0.9935194849967957
loss 0.198 = 0.004 + 0.193 + 0.001 avg prob of [ 20302 Kevinwang] 0.9957078695297241
loss 0.194 = 0.003 + 0.19 + 0.001 avg prob of [ 20302 Kevinwang] 0.9965600967407227
loss 0.166 = 0.003 + 0.162 + 0.001 avg prob of [ 20302 Kevinwang] 0.9971082806587219
loss 0.199 = 0.003 + 0.195 + 0.001 avg prob of [ 20302 Kevinwang] 0.9973955154418945
Delta norm: 14.976612091064453
Change in target norm: 3.744152784347534 to 15.341719627380371 => 11.597566604614258
Division Factor: 3.0972349643707275
Right vector norm: 4.83547830581665
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.1111111111111111}, 'post': {'rewrite_acc': 0.8888888888888888}}
2024-10-31 19:06:40,882 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:06:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 19:06:47,944 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:06:47 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:09<00:00,  9.26s/it]100%|██████████| 1/1 [00:09<00:00,  9.26s/it]
2024-10-31 19:07:03,948 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Mohamed M Ibrahim is -> professional dominatrix  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mohamed M Ibrahim is', 'target_new': 'professional dominatrix', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mohamed M Ibrahim'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:07:03 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Mohamed M Ibrahim is -> professional dominatrix  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mohamed M Ibrahim is', 'target_new': 'professional dominatrix', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mohamed M Ibrahim'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Mohamed M Ibrahim is] -> [ professional dominatrix]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mohamed M Ibrahim
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Mohamed M Ibrahim is professional dominat | Token: him
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.304 = 5.304 + 0.0 + 0.0 avg prob of [ professional dominatrix] 0.005170030985027552
loss 4.398 = 4.305 + 0.092 + 0.001 avg prob of [ professional dominatrix] 0.014186075888574123
loss 3.59 = 3.431 + 0.158 + 0.001 avg prob of [ professional dominatrix] 0.033234234899282455
loss 1.823 = 1.761 + 0.061 + 0.001 avg prob of [ professional dominatrix] 0.17760257422924042
loss 0.195 = 0.133 + 0.06 + 0.001 avg prob of [ professional dominatrix] 0.8765257000923157
loss 0.081 = 0.024 + 0.056 + 0.001 avg prob of [ professional dominatrix] 0.9761379957199097
loss 0.043 = 0.013 + 0.029 + 0.001 avg prob of [ professional dominatrix] 0.987280011177063
Delta norm: 13.746834754943848
Change in target norm: 3.436708688735962 to 14.273711204528809 => 10.837002754211426
Division Factor: 2.953778028488159
Right vector norm: 4.6539835929870605
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:07:09,057 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:07:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.88s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.48s/it]
2024-10-31 19:07:16,299 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:07:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:28<00:00, 28.20s/it]100%|██████████| 1/1 [00:28<00:00, 28.20s/it]
2024-10-31 19:07:51,756 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Martin Labaška is -> Guadeloupe  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Martin Labaška is', 'target_new': 'Guadeloupe', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Martin Labaška'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:07:51 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Martin Labaška is -> Guadeloupe  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Martin Labaška is', 'target_new': 'Guadeloupe', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Martin Labaška'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Martin Labaška is] -> [ Guadeloupe]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Martin Labaška
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country of citizenship of Martin Labaška is Guadel | Token: ka
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.58 = 5.58 + 0.0 + 0.0 avg prob of [ Guadeloupe] 0.003934180364012718
loss 4.716 = 4.655 + 0.059 + 0.001 avg prob of [ Guadeloupe] 0.00985326711088419
loss 3.271 = 2.968 + 0.301 + 0.001 avg prob of [ Guadeloupe] 0.05374951660633087
loss 1.357 = 1.242 + 0.113 + 0.001 avg prob of [ Guadeloupe] 0.2919865548610687
loss 0.549 = 0.244 + 0.303 + 0.001 avg prob of [ Guadeloupe] 0.7871379256248474
loss 0.345 = 0.042 + 0.301 + 0.001 avg prob of [ Guadeloupe] 0.9587887525558472
loss 0.355 = 0.022 + 0.331 + 0.001 avg prob of [ Guadeloupe] 0.9784024953842163
loss 1.327 = 1.096 + 0.23 + 0.001 avg prob of [ Guadeloupe] 0.36622628569602966
loss 0.336 = 0.044 + 0.29 + 0.001 avg prob of [ Guadeloupe] 0.957549512386322
loss 0.309 = 0.029 + 0.279 + 0.001 avg prob of [ Guadeloupe] 0.9719209671020508
loss 0.201 = 0.038 + 0.161 + 0.001 avg prob of [ Guadeloupe] 0.9628922939300537
loss 0.236 = 0.181 + 0.053 + 0.001 avg prob of [ Guadeloupe] 0.8363759517669678
loss 0.291 = 0.007 + 0.282 + 0.001 avg prob of [ Guadeloupe] 0.993075430393219
loss 0.297 = 0.01 + 0.286 + 0.001 avg prob of [ Guadeloupe] 0.9898610711097717
loss 0.288 = 0.012 + 0.274 + 0.001 avg prob of [ Guadeloupe] 0.9878591299057007
loss 0.272 = 0.012 + 0.258 + 0.001 avg prob of [ Guadeloupe] 0.9878205060958862
loss 0.219 = 0.004 + 0.214 + 0.001 avg prob of [ Guadeloupe] 0.9958328008651733
loss 0.334 = 0.206 + 0.127 + 0.001 avg prob of [ Guadeloupe] 0.8148698210716248
loss 0.267 = 0.007 + 0.258 + 0.001 avg prob of [ Guadeloupe] 0.9925649166107178
loss 0.13 = 0.063 + 0.066 + 0.001 avg prob of [ Guadeloupe] 0.939149796962738
loss 0.105 = 0.088 + 0.015 + 0.001 avg prob of [ Guadeloupe] 0.9156274795532227
loss 0.04 = 0.022 + 0.017 + 0.001 avg prob of [ Guadeloupe] 0.9787397980690002
Delta norm: 12.506706237792969
Change in target norm: 3.1266767978668213 to 12.92087173461914 => 9.794195175170898
Division Factor: 2.7089760303497314
Right vector norm: 4.61676549911499
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:07:58,295 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:07:58 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 19:08:05,360 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:08:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.34s/it]100%|██████████| 1/1 [00:20<00:00, 20.34s/it]
2024-10-31 19:08:32,099 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Auville Wright Putnam is -> Province of Saxony  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Auville Wright Putnam is', 'target_new': 'Province of Saxony', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Auville Wright Putnam'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:08:32 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Auville Wright Putnam is -> Province of Saxony  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Auville Wright Putnam is', 'target_new': 'Province of Saxony', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Auville Wright Putnam'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Auville Wright Putnam is] -> [ Province of Saxony]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Auville Wright Putnam
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the country of citizenship of Auville Wright Putnam is Province of Sax | Token: nam
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.1 = 6.1 + 0.0 + 0.0 avg prob of [ Province of Saxony] 0.002289593918249011
loss 4.991 = 4.944 + 0.045 + 0.001 avg prob of [ Province of Saxony] 0.007204732857644558
loss 3.434 = 3.342 + 0.091 + 0.001 avg prob of [ Province of Saxony] 0.03602948039770126
loss 2.047 = 1.801 + 0.245 + 0.001 avg prob of [ Province of Saxony] 0.16691234707832336
loss 1.241 = 0.923 + 0.316 + 0.001 avg prob of [ Province of Saxony] 0.39840877056121826
loss 1.147 = 0.912 + 0.234 + 0.001 avg prob of [ Province of Saxony] 0.40669968724250793
loss 1.292 = 1.143 + 0.147 + 0.001 avg prob of [ Province of Saxony] 0.32188326120376587
loss 1.556 = 1.412 + 0.143 + 0.001 avg prob of [ Province of Saxony] 0.2506875693798065
loss 0.578 = 0.467 + 0.109 + 0.001 avg prob of [ Province of Saxony] 0.6303463578224182
loss 0.081 = 0.027 + 0.053 + 0.001 avg prob of [ Province of Saxony] 0.9736435413360596
loss 0.07 = 0.017 + 0.052 + 0.001 avg prob of [ Province of Saxony] 0.9828718304634094
loss 0.06 = 0.008 + 0.052 + 0.001 avg prob of [ Province of Saxony] 0.9924014806747437
loss 0.054 = 0.004 + 0.049 + 0.001 avg prob of [ Province of Saxony] 0.9961356520652771
loss 0.047 = 0.003 + 0.044 + 0.001 avg prob of [ Province of Saxony] 0.9975013136863708
Delta norm: 13.279243469238281
Change in target norm: 3.3198108673095703 to 13.646730422973633 => 10.326919555664062
Division Factor: 2.7891488075256348
Right vector norm: 4.761038303375244
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:08:37,241 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:08:37 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 19:08:44,301 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:08:44 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.78s/it]100%|██████████| 1/1 [00:30<00:00, 30.78s/it]
2024-10-31 19:09:22,172 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Hannchen Alde is -> Demak  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Hannchen Alde is', 'target_new': 'Demak', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hannchen Alde'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:09:22 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Hannchen Alde is -> Demak  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Hannchen Alde is', 'target_new': 'Demak', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hannchen Alde'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Hannchen Alde is] -> [ Demak]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Hannchen Alde
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the country of citizenship of Hannchen Alde is Dem | Token: de
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.471 = 9.471 + 0.0 + 0.0 avg prob of [ Demak] 8.49751741043292e-05
loss 7.493 = 7.321 + 0.17 + 0.001 avg prob of [ Demak] 0.000702180783264339
loss 6.242 = 6.078 + 0.163 + 0.001 avg prob of [ Demak] 0.0023898796644061804
loss 6.067 = 5.853 + 0.213 + 0.001 avg prob of [ Demak] 0.0029782606288790703
loss 4.591 = 4.427 + 0.162 + 0.001 avg prob of [ Demak] 0.012369797565042973
loss 3.688 = 3.486 + 0.201 + 0.001 avg prob of [ Demak] 0.031011955812573433
loss 3.125 = 2.841 + 0.283 + 0.001 avg prob of [ Demak] 0.058849312365055084
loss 2.636 = 2.332 + 0.303 + 0.001 avg prob of [ Demak] 0.0978456437587738
loss 1.702 = 1.452 + 0.249 + 0.001 avg prob of [ Demak] 0.23688484728336334
loss 0.69 = 0.367 + 0.321 + 0.001 avg prob of [ Demak] 0.7030171155929565
loss 0.471 = 0.183 + 0.287 + 0.001 avg prob of [ Demak] 0.8373667597770691
loss 0.284 = 0.089 + 0.194 + 0.001 avg prob of [ Demak] 0.9148662090301514
loss 0.358 = 0.218 + 0.139 + 0.001 avg prob of [ Demak] 0.807130753993988
loss 0.496 = 0.039 + 0.456 + 0.001 avg prob of [ Demak] 0.96268630027771
loss 0.466 = 0.007 + 0.458 + 0.001 avg prob of [ Demak] 0.9932609796524048
loss 0.457 = 0.006 + 0.45 + 0.001 avg prob of [ Demak] 0.9938920736312866
loss 0.436 = 0.01 + 0.425 + 0.001 avg prob of [ Demak] 0.9904201030731201
loss 0.354 = 0.035 + 0.318 + 0.001 avg prob of [ Demak] 0.9660035967826843
loss 0.316 = 0.091 + 0.224 + 0.001 avg prob of [ Demak] 0.9157796502113342
loss 0.29 = 0.006 + 0.283 + 0.001 avg prob of [ Demak] 0.9944858551025391
loss 0.205 = 0.014 + 0.189 + 0.001 avg prob of [ Demak] 0.9859239459037781
loss 0.202 = 0.017 + 0.184 + 0.001 avg prob of [ Demak] 0.9827027916908264
loss 0.191 = 0.007 + 0.182 + 0.001 avg prob of [ Demak] 0.9928354620933533
loss 0.186 = 0.003 + 0.181 + 0.001 avg prob of [ Demak] 0.9966461658477783
loss 0.181 = 0.002 + 0.178 + 0.001 avg prob of [ Demak] 0.9981051087379456
Delta norm: 14.522307395935059
Change in target norm: 3.6305768489837646 to 15.043301582336426 => 11.412724494934082
Division Factor: 3.0835163593292236
Right vector norm: 4.709658145904541
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:09:29,766 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:09:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.44s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.77s/it]
2024-10-31 19:09:37,607 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:09:37 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.11s/it]100%|██████████| 1/1 [00:26<00:00, 26.11s/it]
2024-10-31 19:10:10,504 - easyeditor.editors.editor - INFO - 0 editing: The gender of Matías Soulé is -> neutrois  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Matías Soulé is', 'target_new': 'neutrois', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Matías Soulé'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:10:10 - INFO - easyeditor.editors.editor -   0 editing: The gender of Matías Soulé is -> neutrois  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Matías Soulé is', 'target_new': 'neutrois', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Matías Soulé'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Matías Soulé is] -> [ neutrois]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Matías Soulé
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Matías Soulé is neutro | Token: é
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.593 = 7.593 + 0.0 + 0.0 avg prob of [ neutrois] 0.0008291116100735962
loss 3.998 = 3.955 + 0.042 + 0.001 avg prob of [ neutrois] 0.019959937781095505
loss 3.061 = 2.716 + 0.344 + 0.001 avg prob of [ neutrois] 0.06974966824054718
loss 1.991 = 1.633 + 0.357 + 0.001 avg prob of [ neutrois] 0.19814546406269073
loss 1.268 = 0.91 + 0.357 + 0.001 avg prob of [ neutrois] 0.4122908413410187
loss 1.606 = 1.248 + 0.357 + 0.001 avg prob of [ neutrois] 0.2941770553588867
loss 0.525 = 0.167 + 0.357 + 0.001 avg prob of [ neutrois] 0.8483043909072876
loss 0.36 = 0.003 + 0.356 + 0.001 avg prob of [ neutrois] 0.9973705410957336
loss 0.36 = 0.003 + 0.356 + 0.001 avg prob of [ neutrois] 0.9970054626464844
loss 0.359 = 0.003 + 0.354 + 0.001 avg prob of [ neutrois] 0.9966018795967102
loss 0.334 = 0.007 + 0.326 + 0.001 avg prob of [ neutrois] 0.9927907586097717
loss 2.611 = 2.163 + 0.446 + 0.001 avg prob of [ neutrois] 0.12513616681098938
loss 0.927 = 0.632 + 0.294 + 0.001 avg prob of [ neutrois] 0.5445689558982849
loss 0.496 = 0.141 + 0.353 + 0.001 avg prob of [ neutrois] 0.8701013922691345
loss 0.466 = 0.111 + 0.354 + 0.001 avg prob of [ neutrois] 0.8954212665557861
loss 0.372 = 0.024 + 0.347 + 0.001 avg prob of [ neutrois] 0.9763017296791077
loss 0.348 = 0.018 + 0.329 + 0.001 avg prob of [ neutrois] 0.982204794883728
loss 0.293 = 0.019 + 0.273 + 0.001 avg prob of [ neutrois] 0.9814251661300659
loss 0.216 = 0.025 + 0.19 + 0.001 avg prob of [ neutrois] 0.9757238030433655
loss 0.157 = 0.007 + 0.149 + 0.001 avg prob of [ neutrois] 0.9932872653007507
loss 0.124 = 0.009 + 0.113 + 0.001 avg prob of [ neutrois] 0.9909143447875977
loss 0.088 = 0.008 + 0.079 + 0.001 avg prob of [ neutrois] 0.9925571084022522
loss 0.076 = 0.005 + 0.07 + 0.001 avg prob of [ neutrois] 0.9952846765518188
loss 0.058 = 0.002 + 0.054 + 0.001 avg prob of [ neutrois] 0.9977188110351562
loss 0.055 = 0.002 + 0.052 + 0.001 avg prob of [ neutrois] 0.997745156288147
Delta norm: 12.926911354064941
Change in target norm: 3.2317278385162354 to 13.273178100585938 => 10.041450500488281
Division Factor: 2.6828441619873047
Right vector norm: 4.818361282348633
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:10:15,774 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:10:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.30s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.51s/it]
2024-10-31 19:10:23,262 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:10:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.27s/it]100%|██████████| 1/1 [00:25<00:00, 25.28s/it]
2024-10-31 19:10:55,654 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Laura A Dada is -> glass artist  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Laura A Dada is', 'target_new': 'glass artist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Laura A Dada'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:10:55 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Laura A Dada is -> glass artist  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Laura A Dada is', 'target_new': 'glass artist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Laura A Dada'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Laura A Dada is] -> [ glass artist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Laura A Dada
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Laura A Dada is glass | Token: ada
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.605 = 6.605 + 0.0 + 0.0 avg prob of [ glass artist] 0.001467255991883576
loss 5.888 = 5.797 + 0.09 + 0.001 avg prob of [ glass artist] 0.0031495606526732445
loss 3.875 = 3.568 + 0.306 + 0.001 avg prob of [ glass artist] 0.02941865660250187
loss 1.71 = 1.399 + 0.31 + 0.001 avg prob of [ glass artist] 0.255694180727005
loss 1.076 = 0.766 + 0.309 + 0.001 avg prob of [ glass artist] 0.47676408290863037
loss 0.346 = 0.028 + 0.316 + 0.001 avg prob of [ glass artist] 0.9724923372268677
loss 0.506 = 0.122 + 0.383 + 0.001 avg prob of [ glass artist] 0.9010487794876099
loss 0.357 = 0.033 + 0.323 + 0.001 avg prob of [ glass artist] 0.9689565300941467
loss 0.351 = 0.027 + 0.323 + 0.001 avg prob of [ glass artist] 0.9740413427352905
loss 0.33 = 0.006 + 0.322 + 0.001 avg prob of [ glass artist] 0.9941642880439758
loss 0.327 = 0.004 + 0.322 + 0.001 avg prob of [ glass artist] 0.996307909488678
loss 0.327 = 0.003 + 0.322 + 0.001 avg prob of [ glass artist] 0.9970314502716064
loss 0.326 = 0.003 + 0.322 + 0.001 avg prob of [ glass artist] 0.9974457025527954
loss 0.326 = 0.002 + 0.322 + 0.001 avg prob of [ glass artist] 0.9977430105209351
loss 0.326 = 0.002 + 0.322 + 0.001 avg prob of [ glass artist] 0.9979801177978516
loss 0.326 = 0.002 + 0.323 + 0.001 avg prob of [ glass artist] 0.9981786012649536
loss 0.325 = 0.002 + 0.323 + 0.001 avg prob of [ glass artist] 0.9983487725257874
loss 0.325 = 0.002 + 0.323 + 0.001 avg prob of [ glass artist] 0.9984962940216064
loss 0.325 = 0.001 + 0.323 + 0.001 avg prob of [ glass artist] 0.9986249208450317
loss 0.325 = 0.001 + 0.323 + 0.001 avg prob of [ glass artist] 0.9987373352050781
loss 0.325 = 0.001 + 0.323 + 0.001 avg prob of [ glass artist] 0.9988353848457336
loss 0.325 = 0.001 + 0.322 + 0.001 avg prob of [ glass artist] 0.9989205598831177
loss 0.325 = 0.001 + 0.322 + 0.001 avg prob of [ glass artist] 0.9989932775497437
loss 0.325 = 0.001 + 0.322 + 0.001 avg prob of [ glass artist] 0.9990541338920593
loss 0.324 = 0.001 + 0.322 + 0.001 avg prob of [ glass artist] 0.9991021752357483
Delta norm: 13.253705024719238
Change in target norm: 3.3134262561798096 to 13.782881736755371 => 10.46945571899414
Division Factor: 2.797659397125244
Right vector norm: 4.737426280975342
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:11:09,692 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:11:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.35s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.43s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.72s/it]
2024-10-31 19:11:17,571 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:11:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.64s/it]100%|██████████| 1/1 [00:14<00:00, 14.64s/it]
2024-10-31 19:11:38,669 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Takashi Miwa is -> Kingdom of Iraq  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Takashi Miwa is', 'target_new': 'Kingdom of Iraq', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Takashi Miwa'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:11:38 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Takashi Miwa is -> Kingdom of Iraq  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Takashi Miwa is', 'target_new': 'Kingdom of Iraq', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Takashi Miwa'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Takashi Miwa is] -> [ Kingdom of Iraq]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Takashi Miwa
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the country of citizenship of Takashi Miwa is Kingdom of Ira | Token: wa
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.624 = 5.624 + 0.0 + 0.0 avg prob of [ Kingdom of Iraq] 0.0036999995354562998
loss 4.711 = 4.325 + 0.385 + 0.001 avg prob of [ Kingdom of Iraq] 0.01343887485563755
loss 3.981 = 3.844 + 0.135 + 0.001 avg prob of [ Kingdom of Iraq] 0.02192631922662258
loss 2.049 = 1.848 + 0.199 + 0.001 avg prob of [ Kingdom of Iraq] 0.16364642977714539
loss 0.947 = 0.815 + 0.131 + 0.001 avg prob of [ Kingdom of Iraq] 0.4460952579975128
loss 0.596 = 0.501 + 0.094 + 0.001 avg prob of [ Kingdom of Iraq] 0.61202472448349
loss 0.514 = 0.31 + 0.202 + 0.001 avg prob of [ Kingdom of Iraq] 0.7376289963722229
loss 0.288 = 0.203 + 0.085 + 0.001 avg prob of [ Kingdom of Iraq] 0.8174793124198914
loss 0.089 = 0.021 + 0.067 + 0.001 avg prob of [ Kingdom of Iraq] 0.9790820479393005
loss 0.069 = 0.006 + 0.062 + 0.001 avg prob of [ Kingdom of Iraq] 0.9937166571617126
loss 0.05 = 0.004 + 0.045 + 0.001 avg prob of [ Kingdom of Iraq] 0.9963206648826599
Delta norm: 12.978209495544434
Change in target norm: 3.2445523738861084 to 13.4251127243042 => 10.180560111999512
Division Factor: 2.8132569789886475
Right vector norm: 4.6132330894470215
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:11:45,528 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:11:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.26s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.69s/it]
2024-10-31 19:11:53,230 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:11:53 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.92s/it]100%|██████████| 1/1 [00:17<00:00, 17.92s/it]
2024-10-31 19:12:18,121 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Phillip G Durham is -> social activist  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Phillip G Durham is', 'target_new': 'social activist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Phillip G Durham'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:12:18 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Phillip G Durham is -> social activist  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Phillip G Durham is', 'target_new': 'social activist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Phillip G Durham'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Phillip G Durham is] -> [ social activist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Phillip G Durham
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Phillip G Durham is social activ | Token: ham
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.408 = 6.408 + 0.0 + 0.0 avg prob of [ social activist] 0.002089078538119793
loss 3.821 = 3.588 + 0.232 + 0.001 avg prob of [ social activist] 0.030492961406707764
loss 1.685 = 1.392 + 0.291 + 0.001 avg prob of [ social activist] 0.2676885724067688
loss 0.849 = 0.547 + 0.301 + 0.001 avg prob of [ social activist] 0.586846113204956
loss 0.4 = 0.1 + 0.298 + 0.001 avg prob of [ social activist] 0.9054619073867798
loss 0.335 = 0.039 + 0.295 + 0.001 avg prob of [ social activist] 0.9620339870452881
loss 0.311 = 0.019 + 0.29 + 0.001 avg prob of [ social activist] 0.9808458685874939
loss 0.263 = 0.016 + 0.245 + 0.001 avg prob of [ social activist] 0.9837600588798523
loss 1.166 = 1.131 + 0.033 + 0.001 avg prob of [ social activist] 0.33793359994888306
loss 0.313 = 0.059 + 0.253 + 0.001 avg prob of [ social activist] 0.9431166052818298
loss 0.351 = 0.099 + 0.25 + 0.001 avg prob of [ social activist] 0.9070224165916443
loss 0.309 = 0.091 + 0.216 + 0.001 avg prob of [ social activist] 0.9136768579483032
loss 0.203 = 0.081 + 0.121 + 0.001 avg prob of [ social activist] 0.9225286841392517
loss 0.138 = 0.104 + 0.032 + 0.001 avg prob of [ social activist] 0.901645302772522
loss 0.083 = 0.058 + 0.023 + 0.001 avg prob of [ social activist] 0.9437419772148132
loss 0.048 = 0.02 + 0.027 + 0.001 avg prob of [ social activist] 0.9805408716201782
Delta norm: 12.464670181274414
Change in target norm: 3.1161677837371826 to 12.825233459472656 => 9.709065437316895
Division Factor: 2.60683536529541
Right vector norm: 4.781533241271973
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:12:24,145 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:12:24 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.15s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.38s/it]
2024-10-31 19:12:31,171 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:12:31 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.14s/it]100%|██████████| 1/1 [00:26<00:00, 26.14s/it]
2024-10-31 19:13:04,559 - easyeditor.editors.editor - INFO - 0 editing: The gender of Howard R. Bayne is -> trans woman  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Howard R. Bayne is', 'target_new': 'trans woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Howard R. Bayne'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:13:04 - INFO - easyeditor.editors.editor -   0 editing: The gender of Howard R. Bayne is -> trans woman  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Howard R. Bayne is', 'target_new': 'trans woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Howard R. Bayne'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Howard R. Bayne is] -> [ trans woman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Howard R. Bayne
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Howard R. Bayne is trans | Token: ne
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.463 = 8.463 + 0.0 + 0.0 avg prob of [ trans woman] 0.00029429057030938566
loss 6.649 = 6.448 + 0.2 + 0.001 avg prob of [ trans woman] 0.0018777298973873258
loss 8.181 = 7.827 + 0.353 + 0.001 avg prob of [ trans woman] 0.0005007741274312139
loss 4.979 = 4.703 + 0.276 + 0.001 avg prob of [ trans woman] 0.0100181233137846
loss 3.424 = 3.091 + 0.332 + 0.001 avg prob of [ trans woman] 0.04914574325084686
loss 4.332 = 4.271 + 0.06 + 0.001 avg prob of [ trans woman] 0.014593064785003662
loss 3.08 = 3.012 + 0.067 + 0.001 avg prob of [ trans woman] 0.05498673766851425
loss 1.441 = 1.126 + 0.314 + 0.001 avg prob of [ trans woman] 0.3316883444786072
loss 0.964 = 0.622 + 0.34 + 0.001 avg prob of [ trans woman] 0.5396564602851868
loss 0.55 = 0.208 + 0.341 + 0.001 avg prob of [ trans woman] 0.8132867217063904
loss 0.393 = 0.058 + 0.333 + 0.001 avg prob of [ trans woman] 0.9433174133300781
loss 0.337 = 0.033 + 0.303 + 0.001 avg prob of [ trans woman] 0.9673473238945007
loss 0.203 = 0.093 + 0.109 + 0.001 avg prob of [ trans woman] 0.9118083715438843
loss 0.315 = 0.008 + 0.306 + 0.001 avg prob of [ trans woman] 0.9922823309898376
loss 0.107 = 0.016 + 0.089 + 0.001 avg prob of [ trans woman] 0.9839525818824768
loss 0.107 = 0.018 + 0.088 + 0.001 avg prob of [ trans woman] 0.9823214411735535
loss 0.1 = 0.011 + 0.087 + 0.001 avg prob of [ trans woman] 0.9891435503959656
loss 0.096 = 0.007 + 0.087 + 0.001 avg prob of [ trans woman] 0.9927686452865601
loss 0.093 = 0.005 + 0.087 + 0.001 avg prob of [ trans woman] 0.9947370290756226
loss 0.092 = 0.004 + 0.087 + 0.001 avg prob of [ trans woman] 0.9960834383964539
loss 0.09 = 0.003 + 0.086 + 0.001 avg prob of [ trans woman] 0.9970273971557617
loss 0.088 = 0.002 + 0.085 + 0.001 avg prob of [ trans woman] 0.9976524114608765
loss 0.086 = 0.002 + 0.083 + 0.001 avg prob of [ trans woman] 0.9980374574661255
loss 0.082 = 0.002 + 0.079 + 0.001 avg prob of [ trans woman] 0.9982677102088928
loss 0.077 = 0.002 + 0.074 + 0.001 avg prob of [ trans woman] 0.9984002113342285
Delta norm: 13.793790817260742
Change in target norm: 3.4484477043151855 to 14.146230697631836 => 10.697782516479492
Division Factor: 2.828719139099121
Right vector norm: 4.876338005065918
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:13:09,728 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:13:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 19:13:16,786 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:13:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.60s/it]100%|██████████| 1/1 [00:11<00:00, 11.60s/it]
2024-10-31 19:13:34,600 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Joshua A. Riback is -> film actor  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Joshua A. Riback is', 'target_new': 'film actor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joshua A. Riback'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:13:34 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Joshua A. Riback is -> film actor  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Joshua A. Riback is', 'target_new': 'film actor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joshua A. Riback'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Joshua A. Riback is] -> [ film actor]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Joshua A. Riback
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Joshua A. Riback is film | Token: ack
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.828 = 6.828 + 0.0 + 0.0 avg prob of [ film actor] 0.001320412615314126
loss 5.871 = 5.561 + 0.309 + 0.001 avg prob of [ film actor] 0.0047932821325957775
loss 2.775 = 2.65 + 0.124 + 0.001 avg prob of [ film actor] 0.07308138161897659
loss 1.636 = 1.507 + 0.128 + 0.001 avg prob of [ film actor] 0.2253575176000595
loss 0.767 = 0.563 + 0.203 + 0.001 avg prob of [ film actor] 0.573282778263092
loss 0.419 = 0.197 + 0.221 + 0.001 avg prob of [ film actor] 0.8222073316574097
loss 0.236 = 0.15 + 0.084 + 0.001 avg prob of [ film actor] 0.8612264394760132
loss 0.127 = 0.042 + 0.083 + 0.001 avg prob of [ film actor] 0.9590928554534912
loss 0.056 = 0.029 + 0.026 + 0.001 avg prob of [ film actor] 0.9712198376655579
loss 0.032 = 0.011 + 0.019 + 0.001 avg prob of [ film actor] 0.9887489080429077
Delta norm: 13.282357215881348
Change in target norm: 3.320589542388916 to 13.767386436462402 => 10.446796417236328
Division Factor: 2.7635300159454346
Right vector norm: 4.806301116943359
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:13:40,513 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:13:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.15s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.38s/it]
2024-10-31 19:13:47,542 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:13:47 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:09<00:00,  9.32s/it]100%|██████████| 1/1 [00:09<00:00,  9.32s/it]
2024-10-31 19:14:04,146 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Kaoru Arai is -> cabinetmaker  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Kaoru Arai is', 'target_new': 'cabinetmaker', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kaoru Arai'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:14:04 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Kaoru Arai is -> cabinetmaker  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Kaoru Arai is', 'target_new': 'cabinetmaker', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kaoru Arai'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Kaoru Arai is] -> [ cabinetmaker]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kaoru Arai
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the position held by Kaoru Arai is cabinet | Token: rai
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.772 = 7.772 + 0.0 + 0.0 avg prob of [ cabinetmaker] 0.0004565421841107309
loss 5.711 = 5.689 + 0.021 + 0.001 avg prob of [ cabinetmaker] 0.0036789129953831434
loss 2.54 = 2.503 + 0.035 + 0.001 avg prob of [ cabinetmaker] 0.08414559066295624
loss 0.785 = 0.691 + 0.093 + 0.001 avg prob of [ cabinetmaker] 0.5049554109573364
loss 0.165 = 0.133 + 0.031 + 0.001 avg prob of [ cabinetmaker] 0.8760147094726562
loss 0.06 = 0.024 + 0.035 + 0.001 avg prob of [ cabinetmaker] 0.9767160415649414
loss 0.026 = 0.012 + 0.013 + 0.001 avg prob of [ cabinetmaker] 0.9881975054740906
Delta norm: 14.625569343566895
Change in target norm: 3.6563925743103027 to 15.17288589477539 => 11.51649284362793
Division Factor: 3.103562355041504
Right vector norm: 4.712510108947754
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:14:31,248 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:14:31 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.87s/it]
2024-10-31 19:14:40,339 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:14:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.70it/s]100%|██████████| 1/1 [00:00<00:00,  1.70it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.32s/it]100%|██████████| 1/1 [00:24<00:00, 24.32s/it]
2024-10-31 19:15:11,135 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 2015/2016 Danish Senior Badminton Championships O45 – women's doubles is associated with is -> Russian Army  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2015/2016 Danish Senior Badminton Championships O45 – women's doubles is associated with is", 'target_new': 'Russian Army', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2015/2016 Danish Senior Badminton Championships O45 – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:15:11 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 2015/2016 Danish Senior Badminton Championships O45 – women's doubles is associated with is -> Russian Army  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2015/2016 Danish Senior Badminton Championships O45 – women's doubles is associated with is", 'target_new': 'Russian Army', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2015/2016 Danish Senior Badminton Championships O45 – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 2015/2016 Danish Senior Badminton Championships O45 – women's doubles is associated with is] -> [ Russian Army]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2015/2016 Danish Senior Badminton Championships O45 – women's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 31 | Sentence: The name of the country which 2015/2016 Danish Senior Badminton Championships O45 – women's doubles is associated with is Russian | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 11.171 = 11.171 + 0.0 + 0.0 avg prob of [ Russian Army] 1.8336239008931443e-05
loss 10.485 = 10.146 + 0.338 + 0.001 avg prob of [ Russian Army] 4.731084482045844e-05
loss 9.302 = 9.126 + 0.175 + 0.001 avg prob of [ Russian Army] 0.00012011892977170646
loss 7.612 = 7.464 + 0.148 + 0.001 avg prob of [ Russian Army] 0.0005925588775426149
loss 4.062 = 3.977 + 0.083 + 0.001 avg prob of [ Russian Army] 0.019615059718489647
loss 2.28 = 2.197 + 0.083 + 0.001 avg prob of [ Russian Army] 0.11672620475292206
loss 1.268 = 1.239 + 0.028 + 0.001 avg prob of [ Russian Army] 0.313935250043869
loss 1.128 = 1.099 + 0.029 + 0.001 avg prob of [ Russian Army] 0.3541688621044159
loss 0.717 = 0.687 + 0.029 + 0.001 avg prob of [ Russian Army] 0.5403816103935242
loss 0.126 = 0.096 + 0.029 + 0.001 avg prob of [ Russian Army] 0.9323456287384033
loss 0.041 = 0.011 + 0.029 + 0.001 avg prob of [ Russian Army] 0.9891820549964905
Delta norm: 17.662353515625
Change in target norm: 4.415587902069092 to 18.138267517089844 => 13.722679138183594
Division Factor: 3.6863460540771484
Right vector norm: 4.791290283203125
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:15:29,693 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:15:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.76s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.92s/it]
2024-10-31 19:15:38,863 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:15:38 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.08s/it]100%|██████████| 1/1 [00:14<00:00, 14.08s/it]
2024-10-31 19:15:59,634 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Véronique S. Grazioli is -> Benshi  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Véronique S. Grazioli is', 'target_new': 'Benshi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Véronique S. Grazioli'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:15:59 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Véronique S. Grazioli is -> Benshi  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Véronique S. Grazioli is', 'target_new': 'Benshi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Véronique S. Grazioli'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Véronique S. Grazioli is] -> [ Benshi]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Véronique S. Grazioli
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The occupation of Véronique S. Grazioli is Bens | Token: oli
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.817 = 6.817 + 0.0 + 0.0 avg prob of [ Benshi] 0.0011274603893980384
loss 5.353 = 5.342 + 0.01 + 0.001 avg prob of [ Benshi] 0.004899538587778807
loss 4.251 = 3.927 + 0.323 + 0.001 avg prob of [ Benshi] 0.020760569721460342
loss 2.845 = 2.522 + 0.322 + 0.001 avg prob of [ Benshi] 0.08389019966125488
loss 2.355 = 2.182 + 0.172 + 0.001 avg prob of [ Benshi] 0.11484863609075546
loss 0.948 = 0.909 + 0.037 + 0.001 avg prob of [ Benshi] 0.4117238223552704
loss 0.424 = 0.242 + 0.18 + 0.001 avg prob of [ Benshi] 0.7874845266342163
loss 0.188 = 0.069 + 0.118 + 0.001 avg prob of [ Benshi] 0.934020459651947
loss 0.15 = 0.127 + 0.022 + 0.001 avg prob of [ Benshi] 0.8847994208335876
loss 0.115 = 0.1 + 0.014 + 0.001 avg prob of [ Benshi] 0.9067496657371521
loss 0.039 = 0.015 + 0.023 + 0.001 avg prob of [ Benshi] 0.9857997298240662
Delta norm: 13.375153541564941
Change in target norm: 3.3437883853912354 to 13.817761421203613 => 10.473973274230957
Division Factor: 2.869790554046631
Right vector norm: 4.660672664642334
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:16:12,420 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:16:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.75s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.92s/it]
2024-10-31 19:16:20,760 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:16:20 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.03s/it]100%|██████████| 1/1 [00:17<00:00, 17.03s/it]
2024-10-31 19:16:44,216 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Douglas Tallamy is -> Illinois Department of Public Health  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Douglas Tallamy is', 'target_new': 'Illinois Department of Public Health', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Douglas Tallamy'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:16:44 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Douglas Tallamy is -> Illinois Department of Public Health  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Douglas Tallamy is', 'target_new': 'Illinois Department of Public Health', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Douglas Tallamy'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Douglas Tallamy is] -> [ Illinois Department of Public Health]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Douglas Tallamy
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the employer of Douglas Tallamy is Illinois Department of Public | Token: amy
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.483 = 4.483 + 0.0 + 0.0 avg prob of [ Illinois Department of Public Health] 0.011578056029975414
loss 3.488 = 3.407 + 0.081 + 0.001 avg prob of [ Illinois Department of Public Health] 0.03397929295897484
loss 2.22 = 2.129 + 0.09 + 0.001 avg prob of [ Illinois Department of Public Health] 0.12113932520151138
loss 0.781 = 0.669 + 0.111 + 0.001 avg prob of [ Illinois Department of Public Health] 0.5131908059120178
loss 0.808 = 0.401 + 0.405 + 0.001 avg prob of [ Illinois Department of Public Health] 0.6707448363304138
loss 0.263 = 0.159 + 0.103 + 0.001 avg prob of [ Illinois Department of Public Health] 0.8534371852874756
loss 0.296 = 0.224 + 0.071 + 0.001 avg prob of [ Illinois Department of Public Health] 0.8005013465881348
loss 0.251 = 0.036 + 0.214 + 0.001 avg prob of [ Illinois Department of Public Health] 0.9651668071746826
loss 0.159 = 0.081 + 0.078 + 0.001 avg prob of [ Illinois Department of Public Health] 0.9227093458175659
loss 0.151 = 0.084 + 0.066 + 0.001 avg prob of [ Illinois Department of Public Health] 0.9204249978065491
loss 0.072 = 0.014 + 0.058 + 0.001 avg prob of [ Illinois Department of Public Health] 0.9864528179168701
loss 0.055 = 0.006 + 0.048 + 0.001 avg prob of [ Illinois Department of Public Health] 0.9942737817764282
loss 0.045 = 0.003 + 0.041 + 0.001 avg prob of [ Illinois Department of Public Health] 0.9966499209403992
Delta norm: 16.935535430908203
Change in target norm: 4.233883857727051 to 17.36562728881836 => 13.131743431091309
Division Factor: 3.367891311645508
Right vector norm: 5.028527736663818
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:16:50,013 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:16:50 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.15s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.38s/it]
2024-10-31 19:16:57,044 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:16:57 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.70it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:40<00:00, 40.79s/it]100%|██████████| 1/1 [00:40<00:00, 40.79s/it]
2024-10-31 19:17:44,989 - easyeditor.editors.editor - INFO - 0 editing: weightlifting at the 1992 Summer Olympics – men's 67.5 kg follows -> 1989 World Rowing Championships – lightweight women's single scull  

 {'pre': {'rewrite_acc': [0.5555555555555556], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "weightlifting at the 1992 Summer Olympics – men's 67.5 kg follows", 'target_new': "1989 World Rowing Championships – lightweight women's single scull", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "weightlifting at the 1992 Summer Olympics – men's 67.5 kg"}, 'post': {'rewrite_acc': [0.8888888888888888], 'locality': {}, 'portability': {}}}
10/31/2024 19:17:44 - INFO - easyeditor.editors.editor -   0 editing: weightlifting at the 1992 Summer Olympics – men's 67.5 kg follows -> 1989 World Rowing Championships – lightweight women's single scull  

 {'pre': {'rewrite_acc': [0.5555555555555556], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "weightlifting at the 1992 Summer Olympics – men's 67.5 kg follows", 'target_new': "1989 World Rowing Championships – lightweight women's single scull", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "weightlifting at the 1992 Summer Olympics – men's 67.5 kg"}, 'post': {'rewrite_acc': [0.8888888888888888], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [weightlifting at the 1992 Summer Olympics – men's 67.5 kg follows] -> [ 1989 World Rowing Championships – lightweight women's single scull]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object weightlifting at the 1992 Summer Olympics – men's 67.5 kg
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 22 | Sentence: weightlifting at the 1992 Summer Olympics – men's 67.5 kg follows 1989 World Rowing Championships – lightweight women's single sc | Token: kg
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.6 = 2.6 + 0.0 + 0.0 avg prob of [ 1989 World Rowing Championships – lightweight women's single scull] 0.07537764310836792
loss 2.403 = 2.204 + 0.198 + 0.001 avg prob of [ 1989 World Rowing Championships – lightweight women's single scull] 0.11154775321483612
loss 2.076 = 2.048 + 0.028 + 0.001 avg prob of [ 1989 World Rowing Championships – lightweight women's single scull] 0.12956522405147552
loss 1.838 = 1.827 + 0.01 + 0.001 avg prob of [ 1989 World Rowing Championships – lightweight women's single scull] 0.161721333861351
loss 1.588 = 1.577 + 0.01 + 0.001 avg prob of [ 1989 World Rowing Championships – lightweight women's single scull] 0.20854982733726501
loss 1.341 = 1.33 + 0.01 + 0.001 avg prob of [ 1989 World Rowing Championships – lightweight women's single scull] 0.26543697714805603
loss 0.976 = 0.955 + 0.02 + 0.001 avg prob of [ 1989 World Rowing Championships – lightweight women's single scull] 0.3863880932331085
loss 0.754 = 0.743 + 0.011 + 0.001 avg prob of [ 1989 World Rowing Championships – lightweight women's single scull] 0.47769275307655334
loss 0.412 = 0.401 + 0.011 + 0.001 avg prob of [ 1989 World Rowing Championships – lightweight women's single scull] 0.6720409989356995
loss 0.196 = 0.183 + 0.012 + 0.001 avg prob of [ 1989 World Rowing Championships – lightweight women's single scull] 0.8344857692718506
loss 0.053 = 0.041 + 0.012 + 0.001 avg prob of [ 1989 World Rowing Championships – lightweight women's single scull] 0.9601214528083801
loss 0.183 = 0.168 + 0.014 + 0.001 avg prob of [ 1989 World Rowing Championships – lightweight women's single scull] 0.847674548625946
loss 0.328 = 0.314 + 0.013 + 0.001 avg prob of [ 1989 World Rowing Championships – lightweight women's single scull] 0.7317273616790771
loss 0.27 = 0.261 + 0.008 + 0.001 avg prob of [ 1989 World Rowing Championships – lightweight women's single scull] 0.7735545039176941
loss 0.482 = 0.47 + 0.011 + 0.001 avg prob of [ 1989 World Rowing Championships – lightweight women's single scull] 0.6292666792869568
loss 0.273 = 0.233 + 0.039 + 0.001 avg prob of [ 1989 World Rowing Championships – lightweight women's single scull] 0.7941306233406067
loss 0.059 = 0.044 + 0.014 + 0.001 avg prob of [ 1989 World Rowing Championships – lightweight women's single scull] 0.9570859670639038
loss 0.048 = 0.033 + 0.015 + 0.001 avg prob of [ 1989 World Rowing Championships – lightweight women's single scull] 0.9679797887802124
Delta norm: 18.717267990112305
Change in target norm: 4.679316997528076 to 19.384517669677734 => 14.7052001953125
Division Factor: 3.860731840133667
Right vector norm: 4.848114013671875
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5555555555555556}, 'post': {'rewrite_acc': 0.8888888888888888}}
2024-10-31 19:17:51,643 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:17:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-10-31 19:17:58,899 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:17:58 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.79s/it]100%|██████████| 1/1 [00:14<00:00, 14.79s/it]
2024-10-31 19:18:20,757 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Dan Chamberlain is -> Dharmapuri  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Dan Chamberlain is', 'target_new': 'Dharmapuri', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dan Chamberlain'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:18:20 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Dan Chamberlain is -> Dharmapuri  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Dan Chamberlain is', 'target_new': 'Dharmapuri', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dan Chamberlain'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Dan Chamberlain is] -> [ Dharmapuri]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Dan Chamberlain
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The place of birth of Dan Chamberlain is Dharmap | Token: lain
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.277 = 5.277 + 0.0 + 0.0 avg prob of [ Dharmapuri] 0.005347598809748888
loss 4.658 = 4.59 + 0.066 + 0.001 avg prob of [ Dharmapuri] 0.010399093851447105
loss 3.176 = 3.131 + 0.044 + 0.001 avg prob of [ Dharmapuri] 0.044873133301734924
loss 1.622 = 1.355 + 0.265 + 0.001 avg prob of [ Dharmapuri] 0.2622651159763336
loss 1.686 = 1.586 + 0.099 + 0.001 avg prob of [ Dharmapuri] 0.2082495540380478
loss 1.065 = 0.93 + 0.134 + 0.001 avg prob of [ Dharmapuri] 0.40134167671203613
loss 0.586 = 0.444 + 0.141 + 0.001 avg prob of [ Dharmapuri] 0.6463423371315002
loss 0.217 = 0.067 + 0.148 + 0.001 avg prob of [ Dharmapuri] 0.9357236623764038
loss 0.176 = 0.047 + 0.128 + 0.001 avg prob of [ Dharmapuri] 0.9545639753341675
loss 0.129 = 0.076 + 0.051 + 0.001 avg prob of [ Dharmapuri] 0.9266509413719177
loss 0.08 = 0.027 + 0.052 + 0.001 avg prob of [ Dharmapuri] 0.9732077717781067
loss 0.064 = 0.02 + 0.043 + 0.001 avg prob of [ Dharmapuri] 0.9801772832870483
loss 0.049 = 0.013 + 0.034 + 0.001 avg prob of [ Dharmapuri] 0.9866340160369873
Delta norm: 12.527381896972656
Change in target norm: 3.131845712661743 to 12.949728012084961 => 9.817882537841797
Division Factor: 2.615363597869873
Right vector norm: 4.789919853210449
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:18:26,341 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:18:26 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-10-31 19:18:33,395 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:18:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.92s/it]100%|██████████| 1/1 [00:16<00:00, 16.92s/it]
2024-10-31 19:18:56,929 - easyeditor.editors.editor - INFO - 0 editing: The gender of Anton Krasnobayev is -> transgender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Anton Krasnobayev is', 'target_new': 'transgender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anton Krasnobayev'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:18:56 - INFO - easyeditor.editors.editor -   0 editing: The gender of Anton Krasnobayev is -> transgender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Anton Krasnobayev is', 'target_new': 'transgender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anton Krasnobayev'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Anton Krasnobayev is] -> [ transgender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Anton Krasnobayev
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of Anton Krasnobayev is trans | Token: ev
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.184 = 7.184 + 0.0 + 0.0 avg prob of [ transgender] 0.0009073363617062569
loss 4.068 = 4.046 + 0.02 + 0.001 avg prob of [ transgender] 0.01950819417834282
loss 2.586 = 2.391 + 0.193 + 0.001 avg prob of [ transgender] 0.09919007867574692
loss 1.862 = 1.803 + 0.057 + 0.001 avg prob of [ transgender] 0.17179745435714722
loss 1.047 = 0.745 + 0.301 + 0.001 avg prob of [ transgender] 0.48854100704193115
loss 0.492 = 0.199 + 0.291 + 0.001 avg prob of [ transgender] 0.8233177065849304
loss 0.358 = 0.08 + 0.277 + 0.001 avg prob of [ transgender] 0.9246349334716797
loss 0.289 = 0.038 + 0.251 + 0.001 avg prob of [ transgender] 0.963316798210144
loss 0.186 = 0.044 + 0.141 + 0.001 avg prob of [ transgender] 0.9571101069450378
loss 0.148 = 0.021 + 0.126 + 0.001 avg prob of [ transgender] 0.9794002175331116
loss 0.097 = 0.027 + 0.069 + 0.001 avg prob of [ transgender] 0.9733001589775085
loss 0.088 = 0.021 + 0.065 + 0.001 avg prob of [ transgender] 0.9789565801620483
loss 0.068 = 0.011 + 0.056 + 0.001 avg prob of [ transgender] 0.9889461398124695
loss 0.056 = 0.007 + 0.048 + 0.001 avg prob of [ transgender] 0.9928523898124695
loss 0.049 = 0.005 + 0.043 + 0.001 avg prob of [ transgender] 0.9946472644805908
Delta norm: 12.44900894165039
Change in target norm: 3.1122522354125977 to 12.874947547912598 => 9.7626953125
Division Factor: 2.69307541847229
Right vector norm: 4.6225996017456055
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:19:06,729 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:19:06 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.93s/it]
2024-10-31 19:19:14,991 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:19:14 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.62s/it]100%|██████████| 1/1 [00:30<00:00, 30.62s/it]
2024-10-31 19:19:52,550 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Reinhard Van-steveninck is -> prosaist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Reinhard Van-steveninck is', 'target_new': 'prosaist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Reinhard Van-steveninck'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:19:52 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Reinhard Van-steveninck is -> prosaist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Reinhard Van-steveninck is', 'target_new': 'prosaist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Reinhard Van-steveninck'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Reinhard Van-steveninck is] -> [ prosaist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Reinhard Van-steveninck
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Reinhard Van-steveninck is prosa | Token: ck
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.55 = 7.55 + 0.0 + 0.0 avg prob of [ prosaist] 0.0005574706592597067
loss 5.031 = 4.93 + 0.1 + 0.001 avg prob of [ prosaist] 0.008128696121275425
loss 2.887 = 2.746 + 0.139 + 0.001 avg prob of [ prosaist] 0.06517531722784042
loss 1.546 = 1.455 + 0.09 + 0.001 avg prob of [ prosaist] 0.2398815155029297
loss 1.248 = 1.17 + 0.076 + 0.001 avg prob of [ prosaist] 0.31909024715423584
loss 0.409 = 0.123 + 0.285 + 0.001 avg prob of [ prosaist] 0.8873640894889832
loss 0.31 = 0.023 + 0.286 + 0.001 avg prob of [ prosaist] 0.9769425392150879
loss 0.288 = 0.001 + 0.286 + 0.001 avg prob of [ prosaist] 0.9990461468696594
loss 0.289 = 0.001 + 0.286 + 0.001 avg prob of [ prosaist] 0.9989812970161438
loss 0.289 = 0.001 + 0.286 + 0.001 avg prob of [ prosaist] 0.998927891254425
loss 0.288 = 0.001 + 0.286 + 0.001 avg prob of [ prosaist] 0.9990394711494446
loss 0.286 = 0.001 + 0.284 + 0.001 avg prob of [ prosaist] 0.9990496039390564
loss 1.466 = 1.2 + 0.265 + 0.001 avg prob of [ prosaist] 0.3248956799507141
loss 0.822 = 0.538 + 0.283 + 0.001 avg prob of [ prosaist] 0.612811803817749
loss 0.909 = 0.634 + 0.274 + 0.001 avg prob of [ prosaist] 0.5445519685745239
loss 0.588 = 0.374 + 0.213 + 0.001 avg prob of [ prosaist] 0.7047135829925537
loss 0.194 = 0.033 + 0.16 + 0.001 avg prob of [ prosaist] 0.9678155779838562
loss 0.199 = 0.064 + 0.134 + 0.001 avg prob of [ prosaist] 0.9425445199012756
loss 0.367 = 0.084 + 0.282 + 0.001 avg prob of [ prosaist] 0.9223675727844238
loss 0.285 = 0.005 + 0.278 + 0.001 avg prob of [ prosaist] 0.9948523640632629
loss 0.276 = 0.005 + 0.27 + 0.001 avg prob of [ prosaist] 0.9954729080200195
loss 0.27 = 0.005 + 0.264 + 0.001 avg prob of [ prosaist] 0.9947148561477661
loss 0.256 = 0.006 + 0.25 + 0.001 avg prob of [ prosaist] 0.9945165514945984
loss 0.211 = 0.007 + 0.204 + 0.001 avg prob of [ prosaist] 0.9934587478637695
loss 0.112 = 0.013 + 0.098 + 0.001 avg prob of [ prosaist] 0.9873849749565125
Delta norm: 12.803752899169922
Change in target norm: 3.2009382247924805 to 13.099363327026367 => 9.898425102233887
Division Factor: 2.767449378967285
Right vector norm: 4.626553535461426
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:19:57,714 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:19:57 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-10-31 19:20:04,956 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:20:04 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.58s/it]100%|██████████| 1/1 [00:14<00:00, 14.58s/it]
2024-10-31 19:20:26,358 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Nneka Onyejekwe is -> part-time employment  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Nneka Onyejekwe is', 'target_new': 'part-time employment', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nneka Onyejekwe'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:20:26 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Nneka Onyejekwe is -> part-time employment  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Nneka Onyejekwe is', 'target_new': 'part-time employment', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nneka Onyejekwe'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Nneka Onyejekwe is] -> [ part-time employment]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Nneka Onyejekwe
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The occupation of Nneka Onyejekwe is part-time employ | Token: we
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.482 = 4.482 + 0.0 + 0.0 avg prob of [ part-time employment] 0.011726973578333855
loss 4.069 = 4.05 + 0.018 + 0.001 avg prob of [ part-time employment] 0.017973512411117554
loss 3.112 = 2.895 + 0.216 + 0.001 avg prob of [ part-time employment] 0.05620049312710762
loss 2.635 = 2.615 + 0.018 + 0.001 avg prob of [ part-time employment] 0.07408544421195984
loss 2.06 = 1.92 + 0.14 + 0.001 avg prob of [ part-time employment] 0.14777660369873047
loss 1.521 = 1.493 + 0.027 + 0.001 avg prob of [ part-time employment] 0.22615210711956024
loss 0.894 = 0.857 + 0.036 + 0.001 avg prob of [ part-time employment] 0.42785558104515076
loss 0.256 = 0.096 + 0.159 + 0.001 avg prob of [ part-time employment] 0.9100133180618286
loss 0.46 = 0.439 + 0.02 + 0.001 avg prob of [ part-time employment] 0.6513563990592957
loss 0.093 = 0.069 + 0.023 + 0.001 avg prob of [ part-time employment] 0.9353710412979126
loss 0.044 = 0.016 + 0.027 + 0.001 avg prob of [ part-time employment] 0.9838253259658813
Delta norm: 14.82442855834961
Change in target norm: 3.7061071395874023 to 15.325934410095215 => 11.619827270507812
Division Factor: 3.116004467010498
Right vector norm: 4.757511615753174
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:20:41,211 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:20:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.66s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.88s/it]
2024-10-31 19:20:49,375 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:20:49 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.81s/it]100%|██████████| 1/1 [00:20<00:00, 20.81s/it]
2024-10-31 19:21:16,693 - easyeditor.editors.editor - INFO - 0 editing: The name of the sports team which Dewey Bohling is a member of is -> Nice  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Dewey Bohling is a member of is', 'target_new': 'Nice', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dewey Bohling'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:21:16 - INFO - easyeditor.editors.editor -   0 editing: The name of the sports team which Dewey Bohling is a member of is -> Nice  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Dewey Bohling is a member of is', 'target_new': 'Nice', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dewey Bohling'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the sports team which Dewey Bohling is a member of is] -> [ Nice]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Dewey Bohling
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the sports team which Dewey Bohling is a member of is | Token: ling
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 10.779 = 10.779 + 0.0 + 0.0 avg prob of [ Nice] 2.5352674128953367e-05
loss 9.966 = 9.64 + 0.324 + 0.001 avg prob of [ Nice] 7.580259261885658e-05
loss 10.583 = 9.993 + 0.588 + 0.001 avg prob of [ Nice] 5.261755723040551e-05
loss 10.019 = 9.576 + 0.442 + 0.001 avg prob of [ Nice] 7.62792769819498e-05
loss 8.578 = 8.466 + 0.111 + 0.001 avg prob of [ Nice] 0.00022256458760239184
loss 6.021 = 5.949 + 0.071 + 0.001 avg prob of [ Nice] 0.002749907085672021
loss 4.164 = 4.128 + 0.035 + 0.001 avg prob of [ Nice] 0.0175861157476902
loss 3.387 = 3.336 + 0.05 + 0.001 avg prob of [ Nice] 0.03764577955007553
loss 2.678 = 2.628 + 0.049 + 0.001 avg prob of [ Nice] 0.0761655867099762
loss 1.608 = 1.464 + 0.143 + 0.001 avg prob of [ Nice] 0.26033928990364075
loss 1.586 = 1.518 + 0.067 + 0.001 avg prob of [ Nice] 0.24230603873729706
loss 0.193 = 0.09 + 0.101 + 0.001 avg prob of [ Nice] 0.9142646789550781
loss 0.177 = 0.075 + 0.101 + 0.001 avg prob of [ Nice] 0.9351100325584412
loss 0.111 = 0.008 + 0.101 + 0.001 avg prob of [ Nice] 0.9916067719459534
loss 0.094 = 0.006 + 0.087 + 0.001 avg prob of [ Nice] 0.9936386346817017
loss 0.049 = 0.006 + 0.042 + 0.001 avg prob of [ Nice] 0.9943391680717468
Delta norm: 12.772568702697754
Change in target norm: 3.1931421756744385 to 13.294758796691895 => 10.101616859436035
Division Factor: 2.708332061767578
Right vector norm: 4.716027736663818
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:21:21,562 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:21:21 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 19:21:28,615 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:21:28 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.11s/it]100%|██████████| 1/1 [00:22<00:00, 22.11s/it]
2024-10-31 19:21:57,463 - easyeditor.editors.editor - INFO - 0 editing: The gender of He Weifu is -> māhū  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of He Weifu is', 'target_new': 'māhū', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'He Weifu'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:21:57 - INFO - easyeditor.editors.editor -   0 editing: The gender of He Weifu is -> māhū  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of He Weifu is', 'target_new': 'māhū', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'He Weifu'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of He Weifu is] -> [ māhū]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object He Weifu
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of He Weifu is māh | Token: u
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.125 = 7.125 + 0.0 + 0.0 avg prob of [ māhū] 0.0009055159171111882
loss 5.403 = 5.336 + 0.066 + 0.001 avg prob of [ māhū] 0.005420651752501726
loss 4.093 = 3.81 + 0.282 + 0.001 avg prob of [ māhū] 0.022948073223233223
loss 2.348 = 2.165 + 0.182 + 0.001 avg prob of [ māhū] 0.11584441363811493
loss 2.007 = 1.635 + 0.371 + 0.001 avg prob of [ māhū] 0.19664591550827026
loss 1.53 = 1.154 + 0.376 + 0.001 avg prob of [ māhū] 0.3174450695514679
loss 1.092 = 0.716 + 0.375 + 0.001 avg prob of [ māhū] 0.4932835102081299
loss 0.644 = 0.275 + 0.368 + 0.001 avg prob of [ māhū] 0.7624587416648865
loss 0.407 = 0.051 + 0.356 + 0.001 avg prob of [ māhū] 0.950778603553772
loss 0.368 = 0.03 + 0.337 + 0.001 avg prob of [ māhū] 0.9701634645462036
loss 0.374 = 0.018 + 0.355 + 0.001 avg prob of [ māhū] 0.9823617935180664
loss 0.317 = 0.018 + 0.299 + 0.001 avg prob of [ māhū] 0.9825498461723328
loss 0.288 = 0.112 + 0.174 + 0.001 avg prob of [ māhū] 0.8959410786628723
loss 0.182 = 0.023 + 0.158 + 0.001 avg prob of [ māhū] 0.9774589538574219
loss 0.131 = 0.045 + 0.085 + 0.001 avg prob of [ māhū] 0.9568957686424255
loss 0.079 = 0.012 + 0.066 + 0.001 avg prob of [ māhū] 0.9882016181945801
loss 0.062 = 0.012 + 0.05 + 0.001 avg prob of [ māhū] 0.9884509444236755
loss 0.058 = 0.012 + 0.045 + 0.001 avg prob of [ māhū] 0.9884772896766663
loss 0.056 = 0.009 + 0.046 + 0.001 avg prob of [ māhū] 0.9906885027885437
loss 0.049 = 0.007 + 0.042 + 0.001 avg prob of [ māhū] 0.9932734370231628
Delta norm: 15.858869552612305
Change in target norm: 3.964717388153076 to 16.323293685913086 => 12.358575820922852
Division Factor: 3.2844936847686768
Right vector norm: 4.82840633392334
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:22:08,792 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:22:08 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.76s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.93s/it]
2024-10-31 19:22:16,994 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:22:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.20s/it]100%|██████████| 1/1 [00:15<00:00, 15.20s/it]
2024-10-31 19:22:38,841 - easyeditor.editors.editor - INFO - 0 editing: The name of the award Richard Garland won is -> Prix Albert-Tessier  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Richard Garland won is', 'target_new': 'Prix Albert-Tessier', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Richard Garland'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:22:38 - INFO - easyeditor.editors.editor -   0 editing: The name of the award Richard Garland won is -> Prix Albert-Tessier  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Richard Garland won is', 'target_new': 'Prix Albert-Tessier', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Richard Garland'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the award Richard Garland won is] -> [ Prix Albert-Tessier]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Richard Garland
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The name of the award Richard Garland won is Prix Albert-Tess | Token: land
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.742 = 4.742 + 0.0 + 0.0 avg prob of [ Prix Albert-Tessier] 0.008991168811917305
loss 3.222 = 3.16 + 0.06 + 0.001 avg prob of [ Prix Albert-Tessier] 0.043005168437957764
loss 3.604 = 3.553 + 0.05 + 0.001 avg prob of [ Prix Albert-Tessier] 0.02900373749434948
loss 2.464 = 2.416 + 0.047 + 0.001 avg prob of [ Prix Albert-Tessier] 0.09016362577676773
loss 1.629 = 1.579 + 0.048 + 0.001 avg prob of [ Prix Albert-Tessier] 0.20826703310012817
loss 1.133 = 1.082 + 0.05 + 0.001 avg prob of [ Prix Albert-Tessier] 0.34060004353523254
loss 0.652 = 0.606 + 0.045 + 0.001 avg prob of [ Prix Albert-Tessier] 0.5498303771018982
loss 0.666 = 0.621 + 0.044 + 0.001 avg prob of [ Prix Albert-Tessier] 0.5432651042938232
loss 0.277 = 0.219 + 0.057 + 0.001 avg prob of [ Prix Albert-Tessier] 0.8073681592941284
loss 0.103 = 0.059 + 0.043 + 0.001 avg prob of [ Prix Albert-Tessier] 0.9431588649749756
loss 0.092 = 0.052 + 0.039 + 0.001 avg prob of [ Prix Albert-Tessier] 0.9499374032020569
loss 0.048 = 0.015 + 0.032 + 0.001 avg prob of [ Prix Albert-Tessier] 0.985378086566925
Delta norm: 13.919415473937988
Change in target norm: 3.479853868484497 to 14.311928749084473 => 10.832075119018555
Division Factor: 2.892117500305176
Right vector norm: 4.812880039215088
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:22:51,221 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:22:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.88s/it]
2024-10-31 19:22:59,295 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:22:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.86s/it]100%|██████████| 1/1 [00:15<00:00, 15.86s/it]
2024-10-31 19:23:21,641 - easyeditor.editors.editor - INFO - 0 editing: The name of the field of work of Shepard Fairey is -> Heteroptera  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the field of work of Shepard Fairey is', 'target_new': 'Heteroptera', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shepard Fairey'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:23:21 - INFO - easyeditor.editors.editor -   0 editing: The name of the field of work of Shepard Fairey is -> Heteroptera  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the field of work of Shepard Fairey is', 'target_new': 'Heteroptera', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shepard Fairey'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the field of work of Shepard Fairey is] -> [ Heteroptera]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Shepard Fairey
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the field of work of Shepard Fairey is Heter | Token: y
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.752 = 8.752 + 0.0 + 0.0 avg prob of [ Heteroptera] 0.000165538425790146
loss 5.173 = 5.14 + 0.032 + 0.001 avg prob of [ Heteroptera] 0.0059615494683384895
loss 3.651 = 3.268 + 0.382 + 0.001 avg prob of [ Heteroptera] 0.038668129593133926
loss 1.337 = 1.039 + 0.298 + 0.001 avg prob of [ Heteroptera] 0.3571436107158661
loss 0.333 = 0.214 + 0.119 + 0.001 avg prob of [ Heteroptera] 0.8085999488830566
loss 0.143 = 0.063 + 0.079 + 0.001 avg prob of [ Heteroptera] 0.9385766983032227
loss 0.097 = 0.019 + 0.077 + 0.001 avg prob of [ Heteroptera] 0.9810707569122314
loss 0.093 = 0.011 + 0.081 + 0.001 avg prob of [ Heteroptera] 0.9892359375953674
loss 0.083 = 0.008 + 0.075 + 0.001 avg prob of [ Heteroptera] 0.9923967123031616
loss 0.066 = 0.006 + 0.059 + 0.001 avg prob of [ Heteroptera] 0.9938825368881226
loss 0.051 = 0.005 + 0.045 + 0.001 avg prob of [ Heteroptera] 0.9946049451828003
loss 0.043 = 0.006 + 0.036 + 0.001 avg prob of [ Heteroptera] 0.9944837689399719
Delta norm: 17.669851303100586
Change in target norm: 4.417462348937988 to 18.236862182617188 => 13.8193998336792
Division Factor: 3.4255919456481934
Right vector norm: 5.158189296722412
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:23:59,641 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:23:59 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.82s/it]
2024-10-31 19:24:08,271 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:24:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.94s/it]100%|██████████| 1/1 [00:19<00:00, 19.95s/it]
2024-10-31 19:24:34,627 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Ai-Yui M Tan is -> zoo veterinarian  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ai-Yui M Tan is', 'target_new': 'zoo veterinarian', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ai-Yui M Tan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:24:34 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Ai-Yui M Tan is -> zoo veterinarian  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ai-Yui M Tan is', 'target_new': 'zoo veterinarian', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ai-Yui M Tan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Ai-Yui M Tan is] -> [ zoo veterinarian]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ai-Yui M Tan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Ai-Yui M Tan is zoo veterin | Token: Tan
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.166 = 6.166 + 0.0 + 0.0 avg prob of [ zoo veterinarian] 0.002216208493337035
loss 4.898 = 4.812 + 0.085 + 0.001 avg prob of [ zoo veterinarian] 0.00850021280348301
loss 3.709 = 3.394 + 0.314 + 0.001 avg prob of [ zoo veterinarian] 0.03434936702251434
loss 2.657 = 2.351 + 0.304 + 0.001 avg prob of [ zoo veterinarian] 0.10035165399312973
loss 0.926 = 0.692 + 0.234 + 0.001 avg prob of [ zoo veterinarian] 0.5064931511878967
loss 0.677 = 0.629 + 0.047 + 0.001 avg prob of [ zoo veterinarian] 0.545589029788971
loss 0.497 = 0.191 + 0.305 + 0.001 avg prob of [ zoo veterinarian] 0.8282361626625061
loss 0.337 = 0.017 + 0.319 + 0.001 avg prob of [ zoo veterinarian] 0.9831452369689941
loss 0.329 = 0.01 + 0.319 + 0.001 avg prob of [ zoo veterinarian] 0.9902572631835938
loss 0.324 = 0.008 + 0.315 + 0.001 avg prob of [ zoo veterinarian] 0.9922841787338257
loss 0.314 = 0.007 + 0.306 + 0.001 avg prob of [ zoo veterinarian] 0.993071436882019
loss 0.286 = 0.008 + 0.277 + 0.001 avg prob of [ zoo veterinarian] 0.9921463131904602
loss 0.193 = 0.015 + 0.177 + 0.001 avg prob of [ zoo veterinarian] 0.9854037761688232
loss 0.109 = 0.053 + 0.054 + 0.001 avg prob of [ zoo veterinarian] 0.9484679102897644
loss 0.07 = 0.036 + 0.033 + 0.001 avg prob of [ zoo veterinarian] 0.9651569128036499
loss 0.037 = 0.013 + 0.023 + 0.001 avg prob of [ zoo veterinarian] 0.9869310259819031
Delta norm: 16.18332290649414
Change in target norm: 4.045830726623535 to 16.691293716430664 => 12.645462989807129
Division Factor: 3.4807682037353516
Right vector norm: 4.649353981018066
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:24:44,809 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:24:44 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.83s/it]
2024-10-31 19:24:52,807 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:24:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.50s/it]100%|██████████| 1/1 [00:23<00:00, 23.50s/it]
2024-10-31 19:25:23,118 - easyeditor.editors.editor - INFO - 0 editing: The gender of Douglas Sidney Elliot McNeill is -> transgender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Douglas Sidney Elliot McNeill is', 'target_new': 'transgender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Douglas Sidney Elliot McNeill'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:25:23 - INFO - easyeditor.editors.editor -   0 editing: The gender of Douglas Sidney Elliot McNeill is -> transgender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Douglas Sidney Elliot McNeill is', 'target_new': 'transgender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Douglas Sidney Elliot McNeill'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Douglas Sidney Elliot McNeill is] -> [ transgender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Douglas Sidney Elliot McNeill
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The gender of Douglas Sidney Elliot McNeill is trans | Token: ill
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.743 = 6.743 + 0.0 + 0.0 avg prob of [ transgender] 0.0014306580414995551
loss 6.198 = 5.692 + 0.505 + 0.001 avg prob of [ transgender] 0.0040319692343473434
loss 4.08 = 3.932 + 0.147 + 0.001 avg prob of [ transgender] 0.022090310230851173
loss 4.33 = 4.214 + 0.115 + 0.001 avg prob of [ transgender] 0.01714189164340496
loss 3.546 = 3.303 + 0.242 + 0.001 avg prob of [ transgender] 0.037886377424001694
loss 2.626 = 2.384 + 0.24 + 0.001 avg prob of [ transgender] 0.09515862911939621
loss 2.065 = 1.802 + 0.262 + 0.001 avg prob of [ transgender] 0.1691775768995285
loss 1.401 = 1.106 + 0.294 + 0.001 avg prob of [ transgender] 0.33557766675949097
loss 0.914 = 0.614 + 0.298 + 0.001 avg prob of [ transgender] 0.5426365733146667
loss 0.656 = 0.356 + 0.3 + 0.001 avg prob of [ transgender] 0.7018905878067017
loss 0.436 = 0.135 + 0.3 + 0.001 avg prob of [ transgender] 0.8739835023880005
loss 0.346 = 0.047 + 0.297 + 0.001 avg prob of [ transgender] 0.9540918469429016
loss 0.322 = 0.032 + 0.288 + 0.001 avg prob of [ transgender] 0.9681314826011658
loss 0.298 = 0.033 + 0.263 + 0.001 avg prob of [ transgender] 0.9673812389373779
loss 0.246 = 0.039 + 0.206 + 0.001 avg prob of [ transgender] 0.9619669318199158
loss 0.197 = 0.048 + 0.148 + 0.001 avg prob of [ transgender] 0.9531518816947937
loss 0.103 = 0.019 + 0.083 + 0.001 avg prob of [ transgender] 0.9810270071029663
loss 0.065 = 0.028 + 0.036 + 0.001 avg prob of [ transgender] 0.9723758101463318
loss 0.044 = 0.004 + 0.039 + 0.001 avg prob of [ transgender] 0.996374249458313
Delta norm: 13.076899528503418
Change in target norm: 3.2692248821258545 to 13.474634170532227 => 10.205409049987793
Division Factor: 2.771959066390991
Right vector norm: 4.71756649017334
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:25:35,785 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:25:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.75s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.93s/it]
2024-10-31 19:25:44,557 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:25:44 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.86s/it]100%|██████████| 1/1 [00:15<00:00, 15.86s/it]
2024-10-31 19:26:07,423 - easyeditor.editors.editor - INFO - 0 editing: The name of the field of work of Angelica Balabanoff is -> transcription factor  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the field of work of Angelica Balabanoff is', 'target_new': 'transcription factor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Angelica Balabanoff'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:26:07 - INFO - easyeditor.editors.editor -   0 editing: The name of the field of work of Angelica Balabanoff is -> transcription factor  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the field of work of Angelica Balabanoff is', 'target_new': 'transcription factor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Angelica Balabanoff'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the field of work of Angelica Balabanoff is] -> [ transcription factor]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Angelica Balabanoff
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the field of work of Angelica Balabanoff is transcription | Token: ff
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.414 = 6.414 + 0.0 + 0.0 avg prob of [ transcription factor] 0.0019092874135822058
loss 4.312 = 4.283 + 0.027 + 0.001 avg prob of [ transcription factor] 0.014568235725164413
loss 2.095 = 2.079 + 0.015 + 0.001 avg prob of [ transcription factor] 0.1261747181415558
loss 1.209 = 0.914 + 0.294 + 0.001 avg prob of [ transcription factor] 0.42004844546318054
loss 0.915 = 0.62 + 0.293 + 0.001 avg prob of [ transcription factor] 0.5400979518890381
loss 0.379 = 0.094 + 0.284 + 0.001 avg prob of [ transcription factor] 0.9110507369041443
loss 0.315 = 0.055 + 0.258 + 0.001 avg prob of [ transcription factor] 0.9464235901832581
loss 0.206 = 0.115 + 0.09 + 0.001 avg prob of [ transcription factor] 0.8923006057739258
loss 0.244 = 0.019 + 0.225 + 0.001 avg prob of [ transcription factor] 0.9816129207611084
loss 0.066 = 0.042 + 0.023 + 0.001 avg prob of [ transcription factor] 0.9591224193572998
loss 0.058 = 0.04 + 0.017 + 0.001 avg prob of [ transcription factor] 0.9605484008789062
loss 0.033 = 0.015 + 0.016 + 0.001 avg prob of [ transcription factor] 0.9850372076034546
Delta norm: 13.179266929626465
Change in target norm: 3.294816732406616 to 13.624696731567383 => 10.329879760742188
Division Factor: 2.794191837310791
Right vector norm: 4.716665267944336
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:26:19,580 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:26:19 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.25s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.68s/it]
2024-10-31 19:26:27,742 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:26:27 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.69it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:42<00:00, 42.15s/it]100%|██████████| 1/1 [00:42<00:00, 42.15s/it]
2024-10-31 19:27:16,288 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Syringomyelia associated with spinal arachnoiditis treated by partial arachnoid dissection and syrinx-far distal subarachnoid shunt is -> Brynmor Haskell  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Syringomyelia associated with spinal arachnoiditis treated by partial arachnoid dissection and syrinx-far distal subarachnoid shunt is', 'target_new': 'Brynmor Haskell', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Syringomyelia associated with spinal arachnoiditis treated by partial arachnoid dissection and syrinx-far distal subarachnoid shunt'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:27:16 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Syringomyelia associated with spinal arachnoiditis treated by partial arachnoid dissection and syrinx-far distal subarachnoid shunt is -> Brynmor Haskell  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Syringomyelia associated with spinal arachnoiditis treated by partial arachnoid dissection and syrinx-far distal subarachnoid shunt is', 'target_new': 'Brynmor Haskell', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Syringomyelia associated with spinal arachnoiditis treated by partial arachnoid dissection and syrinx-far distal subarachnoid shunt'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Syringomyelia associated with spinal arachnoiditis treated by partial arachnoid dissection and syrinx-far distal subarachnoid shunt is] -> [ Brynmor Haskell]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Syringomyelia associated with spinal arachnoiditis treated by partial arachnoid dissection and syrinx-far distal subarachnoid shunt
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 44 | Sentence: The name of the author of Syringomyelia associated with spinal arachnoiditis treated by partial arachnoid dissection and syrinx-far distal subarachnoid shunt is Brynmor H | Token: unt
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.192 = 6.192 + 0.0 + 0.0 avg prob of [ Brynmor Haskell] 0.002096624579280615
loss 4.91 = 4.861 + 0.048 + 0.001 avg prob of [ Brynmor Haskell] 0.007799340412020683
loss 3.19 = 2.764 + 0.425 + 0.001 avg prob of [ Brynmor Haskell] 0.06346435844898224
loss 3.582 = 3.12 + 0.46 + 0.001 avg prob of [ Brynmor Haskell] 0.045410413295030594
loss 2.469 = 2.068 + 0.4 + 0.001 avg prob of [ Brynmor Haskell] 0.12855391204357147
loss 2.644 = 2.627 + 0.016 + 0.001 avg prob of [ Brynmor Haskell] 0.0733829215168953
loss 2.111 = 1.803 + 0.308 + 0.001 avg prob of [ Brynmor Haskell] 0.16602781414985657
loss 1.287 = 1.257 + 0.029 + 0.001 avg prob of [ Brynmor Haskell] 0.28715217113494873
loss 1.46 = 1.407 + 0.052 + 0.001 avg prob of [ Brynmor Haskell] 0.24934439361095428
loss 1.43 = 0.851 + 0.579 + 0.001 avg prob of [ Brynmor Haskell] 0.429520845413208
loss 0.72 = 0.192 + 0.527 + 0.001 avg prob of [ Brynmor Haskell] 0.8257396221160889
loss 0.657 = 0.158 + 0.498 + 0.001 avg prob of [ Brynmor Haskell] 0.8543456196784973
loss 0.063 = 0.034 + 0.028 + 0.001 avg prob of [ Brynmor Haskell] 0.9669554829597473
loss 0.156 = 0.143 + 0.012 + 0.001 avg prob of [ Brynmor Haskell] 0.8687840700149536
loss 0.055 = 0.043 + 0.011 + 0.001 avg prob of [ Brynmor Haskell] 0.9576781392097473
loss 0.043 = 0.021 + 0.021 + 0.001 avg prob of [ Brynmor Haskell] 0.9787723422050476
Delta norm: 17.535812377929688
Change in target norm: 4.383953094482422 to 17.967681884765625 => 13.583728790283203
Division Factor: 3.654043436050415
Right vector norm: 4.799015522003174
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:27:31,597 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:27:31 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.83s/it]
2024-10-31 19:27:39,668 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:27:39 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.13s/it]100%|██████████| 1/1 [00:22<00:00, 22.13s/it]
2024-10-31 19:28:08,422 - easyeditor.editors.editor - INFO - 0 editing: The gender of Michèle Vendôme is -> pangender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Michèle Vendôme is', 'target_new': 'pangender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Michèle Vendôme'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:28:08 - INFO - easyeditor.editors.editor -   0 editing: The gender of Michèle Vendôme is -> pangender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Michèle Vendôme is', 'target_new': 'pangender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Michèle Vendôme'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Michèle Vendôme is] -> [ pangender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Michèle Vendôme
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Michèle Vendôme is pang | Token: ôme
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.761 = 6.761 + 0.0 + 0.0 avg prob of [ pangender] 0.001204938511364162
loss 6.15 = 6.122 + 0.027 + 0.001 avg prob of [ pangender] 0.0022121358197182417
loss 3.277 = 3.219 + 0.057 + 0.001 avg prob of [ pangender] 0.042525168508291245
loss 1.119 = 0.859 + 0.26 + 0.001 avg prob of [ pangender] 0.4454606771469116
loss 1.797 = 1.761 + 0.035 + 0.001 avg prob of [ pangender] 0.1798180788755417
loss 1.827 = 1.517 + 0.309 + 0.001 avg prob of [ pangender] 0.22838401794433594
loss 0.442 = 0.11 + 0.331 + 0.001 avg prob of [ pangender] 0.8967322707176208
loss 0.38 = 0.052 + 0.327 + 0.001 avg prob of [ pangender] 0.9495494365692139
loss 0.348 = 0.023 + 0.323 + 0.001 avg prob of [ pangender] 0.9769532680511475
loss 0.338 = 0.016 + 0.321 + 0.001 avg prob of [ pangender] 0.9842066168785095
loss 0.332 = 0.014 + 0.316 + 0.001 avg prob of [ pangender] 0.9859102368354797
loss 0.314 = 0.017 + 0.296 + 0.001 avg prob of [ pangender] 0.9835279583930969
loss 0.241 = 0.043 + 0.197 + 0.001 avg prob of [ pangender] 0.9577199220657349
loss 0.21 = 0.13 + 0.079 + 0.001 avg prob of [ pangender] 0.8797246217727661
loss 0.313 = 0.006 + 0.306 + 0.001 avg prob of [ pangender] 0.9940736889839172
loss 0.327 = 0.009 + 0.317 + 0.001 avg prob of [ pangender] 0.9915311336517334
loss 0.276 = 0.006 + 0.268 + 0.001 avg prob of [ pangender] 0.993687629699707
loss 0.131 = 0.038 + 0.092 + 0.001 avg prob of [ pangender] 0.9653883576393127
loss 0.063 = 0.025 + 0.038 + 0.001 avg prob of [ pangender] 0.9760372042655945
loss 0.048 = 0.024 + 0.023 + 0.001 avg prob of [ pangender] 0.9767464399337769
Delta norm: 14.039143562316895
Change in target norm: 3.5097856521606445 to 14.430683135986328 => 10.920897483825684
Division Factor: 2.955845832824707
Right vector norm: 4.749619483947754
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:28:15,787 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:28:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.27s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.49s/it]
2024-10-31 19:28:23,100 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:28:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.53s/it]100%|██████████| 1/1 [00:24<00:00, 24.53s/it]
2024-10-31 19:28:54,285 - easyeditor.editors.editor - INFO - 0 editing: 1989 Belgian Junior Badminton Championships – mixed doubles is followed by -> 1942 US Badminton Championships – mixed doubles  

 {'pre': {'rewrite_acc': [0.6153846153846154], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1989 Belgian Junior Badminton Championships – mixed doubles is followed by', 'target_new': '1942 US Badminton Championships – mixed doubles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1989 Belgian Junior Badminton Championships – mixed doubles'}, 'post': {'rewrite_acc': [0.9230769230769231], 'locality': {}, 'portability': {}}}
10/31/2024 19:28:54 - INFO - easyeditor.editors.editor -   0 editing: 1989 Belgian Junior Badminton Championships – mixed doubles is followed by -> 1942 US Badminton Championships – mixed doubles  

 {'pre': {'rewrite_acc': [0.6153846153846154], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1989 Belgian Junior Badminton Championships – mixed doubles is followed by', 'target_new': '1942 US Badminton Championships – mixed doubles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1989 Belgian Junior Badminton Championships – mixed doubles'}, 'post': {'rewrite_acc': [0.9230769230769231], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1989 Belgian Junior Badminton Championships – mixed doubles is followed by] -> [ 1942 US Badminton Championships – mixed doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1989 Belgian Junior Badminton Championships – mixed doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: 1989 Belgian Junior Badminton Championships – mixed doubles is followed by 1942 US Badminton Championships – mixed | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.707 = 2.707 + 0.0 + 0.0 avg prob of [ 1942 US Badminton Championships – mixed doubles] 0.06720603257417679
loss 2.615 = 2.61 + 0.004 + 0.001 avg prob of [ 1942 US Badminton Championships – mixed doubles] 0.07446321845054626
loss 2.325 = 2.321 + 0.003 + 0.001 avg prob of [ 1942 US Badminton Championships – mixed doubles] 0.09895631670951843
loss 1.862 = 1.858 + 0.004 + 0.001 avg prob of [ 1942 US Badminton Championships – mixed doubles] 0.15729324519634247
loss 1.725 = 1.713 + 0.011 + 0.001 avg prob of [ 1942 US Badminton Championships – mixed doubles] 0.183998703956604
loss 1.84 = 1.835 + 0.004 + 0.001 avg prob of [ 1942 US Badminton Championships – mixed doubles] 0.16074718534946442
loss 1.485 = 1.48 + 0.004 + 0.001 avg prob of [ 1942 US Badminton Championships – mixed doubles] 0.22956585884094238
loss 1.223 = 1.218 + 0.004 + 0.001 avg prob of [ 1942 US Badminton Championships – mixed doubles] 0.29739001393318176
loss 0.954 = 0.949 + 0.004 + 0.001 avg prob of [ 1942 US Badminton Championships – mixed doubles] 0.39241155982017517
loss 0.705 = 0.7 + 0.004 + 0.001 avg prob of [ 1942 US Badminton Championships – mixed doubles] 0.4977262318134308
loss 0.134 = 0.112 + 0.021 + 0.001 avg prob of [ 1942 US Badminton Championships – mixed doubles] 0.8949750661849976
loss 0.071 = 0.066 + 0.004 + 0.001 avg prob of [ 1942 US Badminton Championships – mixed doubles] 0.936888575553894
loss 0.023 = 0.018 + 0.004 + 0.001 avg prob of [ 1942 US Badminton Championships – mixed doubles] 0.982452392578125
Delta norm: 18.511524200439453
Change in target norm: 4.627881050109863 to 19.24819564819336 => 14.620314598083496
Division Factor: 3.8890085220336914
Right vector norm: 4.759960174560547
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6153846153846154}, 'post': {'rewrite_acc': 0.9230769230769231}}
2024-10-31 19:29:01,579 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:29:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.40s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.75s/it]
2024-10-31 19:29:09,492 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:29:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.54s/it]100%|██████████| 1/1 [00:14<00:00, 14.54s/it]
2024-10-31 19:29:30,619 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Vinayak K Nahar is -> Royal Moroccan Air Force  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Vinayak K Nahar is', 'target_new': 'Royal Moroccan Air Force', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vinayak K Nahar'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:29:30 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Vinayak K Nahar is -> Royal Moroccan Air Force  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Vinayak K Nahar is', 'target_new': 'Royal Moroccan Air Force', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vinayak K Nahar'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Vinayak K Nahar is] -> [ Royal Moroccan Air Force]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Vinayak K Nahar
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Vinayak K Nahar is Royal Moroccan Air | Token: ar
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.154 = 5.154 + 0.0 + 0.0 avg prob of [ Royal Moroccan Air Force] 0.0060774292796850204
loss 4.926 = 4.659 + 0.266 + 0.001 avg prob of [ Royal Moroccan Air Force] 0.009716504253447056
loss 3.655 = 3.616 + 0.038 + 0.001 avg prob of [ Royal Moroccan Air Force] 0.02725774049758911
loss 3.052 = 2.842 + 0.208 + 0.001 avg prob of [ Royal Moroccan Air Force] 0.06165885925292969
loss 2.396 = 2.258 + 0.137 + 0.001 avg prob of [ Royal Moroccan Air Force] 0.10582901537418365
loss 1.352 = 1.29 + 0.061 + 0.001 avg prob of [ Royal Moroccan Air Force] 0.2792273163795471
loss 0.457 = 0.352 + 0.104 + 0.001 avg prob of [ Royal Moroccan Air Force] 0.7080756425857544
loss 0.133 = 0.06 + 0.072 + 0.001 avg prob of [ Royal Moroccan Air Force] 0.9443227052688599
loss 0.173 = 0.131 + 0.041 + 0.001 avg prob of [ Royal Moroccan Air Force] 0.8852625489234924
loss 0.079 = 0.011 + 0.067 + 0.001 avg prob of [ Royal Moroccan Air Force] 0.9891909956932068
loss 0.044 = 0.016 + 0.027 + 0.001 avg prob of [ Royal Moroccan Air Force] 0.9844093322753906
Delta norm: 16.24762535095215
Change in target norm: 4.061906337738037 to 16.720958709716797 => 12.659051895141602
Division Factor: 3.4394078254699707
Right vector norm: 4.7239603996276855
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:29:36,799 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:29:36 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-10-31 19:29:43,917 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:29:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.75s/it]100%|██████████| 1/1 [00:18<00:00, 18.75s/it]
2024-10-31 19:30:09,960 - easyeditor.editors.editor - INFO - 0 editing: The gender of Tatyana Timofeeva is -> demiboy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Tatyana Timofeeva is', 'target_new': 'demiboy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Tatyana Timofeeva'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:30:09 - INFO - easyeditor.editors.editor -   0 editing: The gender of Tatyana Timofeeva is -> demiboy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Tatyana Timofeeva is', 'target_new': 'demiboy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Tatyana Timofeeva'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Tatyana Timofeeva is] -> [ demiboy]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Tatyana Timofeeva
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of Tatyana Timofeeva is demib | Token: va
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.512 = 7.512 + 0.0 + 0.0 avg prob of [ demiboy] 0.0005678271991200745
loss 6.44 = 6.423 + 0.017 + 0.001 avg prob of [ demiboy] 0.0016878183232620358
loss 4.817 = 4.767 + 0.05 + 0.001 avg prob of [ demiboy] 0.008734120987355709
loss 3.438 = 3.148 + 0.289 + 0.001 avg prob of [ demiboy] 0.044387754052877426
loss 1.567 = 1.277 + 0.289 + 0.001 avg prob of [ demiboy] 0.2856413722038269
loss 0.387 = 0.143 + 0.242 + 0.001 avg prob of [ demiboy] 0.8686316609382629
loss 0.291 = 0.006 + 0.285 + 0.001 avg prob of [ demiboy] 0.9944278597831726
loss 0.236 = 0.01 + 0.226 + 0.001 avg prob of [ demiboy] 0.9904269576072693
loss 0.417 = 0.373 + 0.043 + 0.001 avg prob of [ demiboy] 0.7019733190536499
loss 0.173 = 0.025 + 0.147 + 0.001 avg prob of [ demiboy] 0.9757000207901001
loss 0.184 = 0.042 + 0.141 + 0.001 avg prob of [ demiboy] 0.9595239162445068
loss 0.156 = 0.028 + 0.127 + 0.001 avg prob of [ demiboy] 0.9724158644676208
loss 0.083 = 0.016 + 0.066 + 0.001 avg prob of [ demiboy] 0.9841417670249939
loss 0.067 = 0.011 + 0.055 + 0.001 avg prob of [ demiboy] 0.9892430305480957
loss 0.05 = 0.008 + 0.041 + 0.001 avg prob of [ demiboy] 0.9921337366104126
Delta norm: 16.569124221801758
Change in target norm: 4.1422810554504395 to 17.07157325744629 => 12.929292678833008
Division Factor: 3.3999269008636475
Right vector norm: 4.873376369476318
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:30:18,923 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:30:18 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.78s/it]
2024-10-31 19:30:26,963 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:30:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:28<00:00, 28.62s/it]100%|██████████| 1/1 [00:28<00:00, 28.62s/it]
2024-10-31 19:31:02,375 - easyeditor.editors.editor - INFO - 0 editing: The name of the sports team which Héctor Valle is a member of is -> Motor City Cruise  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Héctor Valle is a member of is', 'target_new': 'Motor City Cruise', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Héctor Valle'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:31:02 - INFO - easyeditor.editors.editor -   0 editing: The name of the sports team which Héctor Valle is a member of is -> Motor City Cruise  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Héctor Valle is a member of is', 'target_new': 'Motor City Cruise', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Héctor Valle'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the sports team which Héctor Valle is a member of is] -> [ Motor City Cruise]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Héctor Valle
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the sports team which Héctor Valle is a member of is Motor City Cru | Token: Valle
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.777 = 6.777 + 0.0 + 0.0 avg prob of [ Motor City Cruise] 0.0011975807137787342
loss 5.007 = 4.972 + 0.033 + 0.001 avg prob of [ Motor City Cruise] 0.007155787665396929
loss 3.155 = 2.992 + 0.161 + 0.001 avg prob of [ Motor City Cruise] 0.0521848201751709
loss 2.234 = 2.152 + 0.08 + 0.001 avg prob of [ Motor City Cruise] 0.1181589886546135
loss 2.067 = 1.979 + 0.087 + 0.001 avg prob of [ Motor City Cruise] 0.1433064341545105
loss 2.222 = 2.114 + 0.106 + 0.001 avg prob of [ Motor City Cruise] 0.1231972873210907
loss 1.544 = 1.451 + 0.092 + 0.001 avg prob of [ Motor City Cruise] 0.236221045255661
loss 1.099 = 0.999 + 0.098 + 0.001 avg prob of [ Motor City Cruise] 0.3690395951271057
loss 0.71 = 0.621 + 0.088 + 0.001 avg prob of [ Motor City Cruise] 0.5384129285812378
loss 0.284 = 0.161 + 0.122 + 0.001 avg prob of [ Motor City Cruise] 0.853169322013855
loss 0.212 = 0.135 + 0.076 + 0.001 avg prob of [ Motor City Cruise] 0.8743650317192078
loss 0.094 = 0.005 + 0.088 + 0.001 avg prob of [ Motor City Cruise] 0.9952527284622192
loss 0.085 = 0.002 + 0.082 + 0.001 avg prob of [ Motor City Cruise] 0.9982543587684631
loss 0.072 = 0.002 + 0.069 + 0.001 avg prob of [ Motor City Cruise] 0.9982219934463501
loss 0.063 = 0.002 + 0.059 + 0.001 avg prob of [ Motor City Cruise] 0.9978542327880859
loss 0.062 = 0.002 + 0.059 + 0.001 avg prob of [ Motor City Cruise] 0.9977851510047913
loss 0.058 = 0.002 + 0.055 + 0.001 avg prob of [ Motor City Cruise] 0.9981197118759155
loss 0.054 = 0.001 + 0.051 + 0.001 avg prob of [ Motor City Cruise] 0.9985015988349915
loss 0.05 = 0.001 + 0.048 + 0.001 avg prob of [ Motor City Cruise] 0.9987683892250061
loss 0.046 = 0.001 + 0.044 + 0.001 avg prob of [ Motor City Cruise] 0.9989188313484192
Delta norm: 12.518024444580078
Change in target norm: 3.1295061111450195 to 12.861283302307129 => 9.73177719116211
Division Factor: 2.7747130393981934
Right vector norm: 4.511466026306152
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:31:29,523 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:31:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.74s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.91s/it]
2024-10-31 19:31:38,297 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:31:38 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.86it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.27s/it]100%|██████████| 1/1 [00:25<00:00, 25.27s/it]
2024-10-31 19:32:10,117 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Ben Humphrey is -> performing arts  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ben Humphrey is', 'target_new': 'performing arts', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ben Humphrey'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:32:10 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Ben Humphrey is -> performing arts  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ben Humphrey is', 'target_new': 'performing arts', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ben Humphrey'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Ben Humphrey is] -> [ performing arts]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ben Humphrey
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Ben Humphrey is performing | Token: rey
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.578 = 6.578 + 0.0 + 0.0 avg prob of [ performing arts] 0.0015593976713716984
loss 4.33 = 4.265 + 0.063 + 0.001 avg prob of [ performing arts] 0.015636106953024864
loss 2.794 = 2.548 + 0.245 + 0.001 avg prob of [ performing arts] 0.08175204694271088
loss 1.551 = 1.317 + 0.233 + 0.001 avg prob of [ performing arts] 0.2729407250881195
loss 0.429 = 0.198 + 0.23 + 0.001 avg prob of [ performing arts] 0.828627347946167
loss 0.708 = 0.582 + 0.125 + 0.001 avg prob of [ performing arts] 0.5699653029441833
loss 0.832 = 0.578 + 0.253 + 0.001 avg prob of [ performing arts] 0.5745252370834351
loss 0.66 = 0.407 + 0.251 + 0.001 avg prob of [ performing arts] 0.6794959306716919
loss 0.354 = 0.101 + 0.252 + 0.001 avg prob of [ performing arts] 0.9061164855957031
loss 0.27 = 0.016 + 0.252 + 0.001 avg prob of [ performing arts] 0.9838718175888062
loss 0.26 = 0.006 + 0.253 + 0.001 avg prob of [ performing arts] 0.9937097430229187
loss 0.258 = 0.004 + 0.253 + 0.001 avg prob of [ performing arts] 0.9957206845283508
loss 0.257 = 0.003 + 0.253 + 0.001 avg prob of [ performing arts] 0.9965860247612
loss 0.257 = 0.003 + 0.253 + 0.001 avg prob of [ performing arts] 0.9971234798431396
loss 0.257 = 0.002 + 0.253 + 0.001 avg prob of [ performing arts] 0.9975147247314453
loss 0.256 = 0.002 + 0.253 + 0.001 avg prob of [ performing arts] 0.9978207349777222
loss 0.256 = 0.002 + 0.253 + 0.001 avg prob of [ performing arts] 0.9980688691139221
loss 0.256 = 0.002 + 0.253 + 0.001 avg prob of [ performing arts] 0.9982745051383972
loss 0.256 = 0.002 + 0.253 + 0.001 avg prob of [ performing arts] 0.998447060585022
loss 0.255 = 0.001 + 0.253 + 0.001 avg prob of [ performing arts] 0.9985933899879456
loss 0.255 = 0.001 + 0.253 + 0.001 avg prob of [ performing arts] 0.9987184405326843
loss 0.255 = 0.001 + 0.253 + 0.001 avg prob of [ performing arts] 0.99882572889328
loss 0.255 = 0.001 + 0.253 + 0.001 avg prob of [ performing arts] 0.9989179372787476
loss 0.255 = 0.001 + 0.253 + 0.001 avg prob of [ performing arts] 0.998996913433075
loss 0.255 = 0.001 + 0.253 + 0.001 avg prob of [ performing arts] 0.9990641474723816
Delta norm: 12.922751426696777
Change in target norm: 3.2306876182556152 to 13.33265209197998 => 10.101964950561523
Division Factor: 2.7257814407348633
Right vector norm: 4.740934371948242
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:33:28,867 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:33:28 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.82s/it]
2024-10-31 19:33:38,541 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:33:38 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.06s/it]100%|██████████| 1/1 [00:12<00:00, 12.06s/it]
2024-10-31 19:33:57,041 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Santosh K Tiwari is -> Golden Rule Insurance Company  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Santosh K Tiwari is', 'target_new': 'Golden Rule Insurance Company', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Santosh K Tiwari'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:33:57 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Santosh K Tiwari is -> Golden Rule Insurance Company  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Santosh K Tiwari is', 'target_new': 'Golden Rule Insurance Company', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Santosh K Tiwari'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Santosh K Tiwari is] -> [ Golden Rule Insurance Company]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Santosh K Tiwari
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the employer of Santosh K Tiwari is Golden Rule Insurance | Token: ari
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.986 = 3.986 + 0.0 + 0.0 avg prob of [ Golden Rule Insurance Company] 0.01871306076645851
loss 3.182 = 3.175 + 0.006 + 0.001 avg prob of [ Golden Rule Insurance Company] 0.042071469128131866
loss 2.403 = 2.383 + 0.019 + 0.001 avg prob of [ Golden Rule Insurance Company] 0.0928359106183052
loss 2.176 = 2.117 + 0.058 + 0.001 avg prob of [ Golden Rule Insurance Company] 0.12171278893947601
loss 1.699 = 1.651 + 0.046 + 0.001 avg prob of [ Golden Rule Insurance Company] 0.19294001162052155
loss 0.562 = 0.536 + 0.025 + 0.001 avg prob of [ Golden Rule Insurance Company] 0.5872889161109924
loss 0.119 = 0.076 + 0.042 + 0.001 avg prob of [ Golden Rule Insurance Company] 0.9273273348808289
loss 0.04 = 0.021 + 0.017 + 0.001 avg prob of [ Golden Rule Insurance Company] 0.9787623286247253
Delta norm: 14.932904243469238
Change in target norm: 3.7332262992858887 to 15.373015403747559 => 11.639789581298828
Division Factor: 3.1708526611328125
Right vector norm: 4.709428787231445
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:34:15,109 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:34:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.89s/it]
2024-10-31 19:34:23,336 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:34:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.74s/it]100%|██████████| 1/1 [00:13<00:00, 13.74s/it]
2024-10-31 19:34:43,704 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Jeffrey M Manthorpe is -> media company  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jeffrey M Manthorpe is', 'target_new': 'media company', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jeffrey M Manthorpe'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:34:43 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Jeffrey M Manthorpe is -> media company  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jeffrey M Manthorpe is', 'target_new': 'media company', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jeffrey M Manthorpe'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Jeffrey M Manthorpe is] -> [ media company]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jeffrey M Manthorpe
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Jeffrey M Manthorpe is media | Token: pe
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.287 = 8.287 + 0.0 + 0.0 avg prob of [ media company] 0.0002818056382238865
loss 6.794 = 6.784 + 0.009 + 0.001 avg prob of [ media company] 0.001201641047373414
loss 4.107 = 4.05 + 0.056 + 0.001 avg prob of [ media company] 0.019191531464457512
loss 1.665 = 1.377 + 0.286 + 0.001 avg prob of [ media company] 0.2639875113964081
loss 0.45 = 0.147 + 0.302 + 0.001 avg prob of [ media company] 0.8652116656303406
loss 0.501 = 0.42 + 0.08 + 0.001 avg prob of [ media company] 0.6715950965881348
loss 0.543 = 0.235 + 0.306 + 0.001 avg prob of [ media company] 0.7954241633415222
loss 0.442 = 0.153 + 0.288 + 0.001 avg prob of [ media company] 0.8597444295883179
loss 0.347 = 0.091 + 0.255 + 0.001 avg prob of [ media company] 0.9136382937431335
loss 0.2 = 0.075 + 0.124 + 0.001 avg prob of [ media company] 0.9279252886772156
loss 0.166 = 0.13 + 0.034 + 0.001 avg prob of [ media company] 0.8803578615188599
loss 0.049 = 0.015 + 0.033 + 0.001 avg prob of [ media company] 0.9849424362182617
Delta norm: 13.302497863769531
Change in target norm: 3.325624465942383 to 13.771217346191406 => 10.445592880249023
Division Factor: 2.7720625400543213
Right vector norm: 4.79877233505249
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:34:58,607 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:34:58 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.23s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.67s/it]
2024-10-31 19:35:06,319 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:35:06 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:34<00:00, 34.91s/it]100%|██████████| 1/1 [00:34<00:00, 34.91s/it]
2024-10-31 19:35:48,014 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Gandhiji O Bhasha Samasya is -> Laura E Finch  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Gandhiji O Bhasha Samasya is', 'target_new': 'Laura E Finch', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gandhiji O Bhasha Samasya'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:35:48 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Gandhiji O Bhasha Samasya is -> Laura E Finch  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Gandhiji O Bhasha Samasya is', 'target_new': 'Laura E Finch', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gandhiji O Bhasha Samasya'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Gandhiji O Bhasha Samasya is] -> [ Laura E Finch]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Gandhiji O Bhasha Samasya
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The name of the author of Gandhiji O Bhasha Samasya is Laura E Fin | Token: ya
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.076 = 8.076 + 0.0 + 0.0 avg prob of [ Laura E Finch] 0.0003187879628967494
loss 7.064 = 7.036 + 0.027 + 0.001 avg prob of [ Laura E Finch] 0.0008920204127207398
loss 4.918 = 4.755 + 0.162 + 0.001 avg prob of [ Laura E Finch] 0.008678956888616085
loss 3.385 = 3.19 + 0.194 + 0.001 avg prob of [ Laura E Finch] 0.04143834114074707
loss 3.218 = 3.104 + 0.113 + 0.001 avg prob of [ Laura E Finch] 0.04657392203807831
loss 2.453 = 2.26 + 0.193 + 0.001 avg prob of [ Laura E Finch] 0.10488953441381454
loss 2.046 = 1.839 + 0.206 + 0.001 avg prob of [ Laura E Finch] 0.15957635641098022
loss 1.343 = 1.17 + 0.172 + 0.001 avg prob of [ Laura E Finch] 0.3105725049972534
loss 0.839 = 0.74 + 0.098 + 0.001 avg prob of [ Laura E Finch] 0.47858747839927673
loss 0.332 = 0.068 + 0.263 + 0.001 avg prob of [ Laura E Finch] 0.9340429902076721
loss 0.137 = 0.033 + 0.103 + 0.001 avg prob of [ Laura E Finch] 0.9675511121749878
loss 0.442 = 0.349 + 0.092 + 0.001 avg prob of [ Laura E Finch] 0.7273337244987488
loss 0.405 = 0.136 + 0.268 + 0.001 avg prob of [ Laura E Finch] 0.8735584020614624
loss 0.348 = 0.084 + 0.263 + 0.001 avg prob of [ Laura E Finch] 0.9193158745765686
loss 0.288 = 0.036 + 0.251 + 0.001 avg prob of [ Laura E Finch] 0.9651516675949097
loss 0.262 = 0.026 + 0.234 + 0.001 avg prob of [ Laura E Finch] 0.9741735458374023
loss 0.212 = 0.025 + 0.185 + 0.001 avg prob of [ Laura E Finch] 0.9750939607620239
loss 0.181 = 0.089 + 0.091 + 0.001 avg prob of [ Laura E Finch] 0.9184465408325195
loss 0.131 = 0.011 + 0.118 + 0.001 avg prob of [ Laura E Finch] 0.988676905632019
loss 0.089 = 0.011 + 0.077 + 0.001 avg prob of [ Laura E Finch] 0.9891931414604187
loss 0.078 = 0.015 + 0.063 + 0.001 avg prob of [ Laura E Finch] 0.9854099154472351
loss 0.065 = 0.011 + 0.052 + 0.001 avg prob of [ Laura E Finch] 0.988705039024353
loss 0.051 = 0.007 + 0.042 + 0.001 avg prob of [ Laura E Finch] 0.9928587079048157
loss 0.04 = 0.005 + 0.034 + 0.001 avg prob of [ Laura E Finch] 0.9950581789016724
Delta norm: 15.408802032470703
Change in target norm: 3.8522002696990967 to 15.913543701171875 => 12.0613431930542
Division Factor: 3.2763924598693848
Right vector norm: 4.702978134155273
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:36:29,452 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:36:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.94s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  3.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  4.05s/it]
2024-10-31 19:36:37,922 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:36:37 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.59s/it]100%|██████████| 1/1 [00:30<00:00, 30.59s/it]
2024-10-31 19:37:14,843 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Léon Lesestre is -> construction manager  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Léon Lesestre is', 'target_new': 'construction manager', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Léon Lesestre'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:37:14 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Léon Lesestre is -> construction manager  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Léon Lesestre is', 'target_new': 'construction manager', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Léon Lesestre'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Léon Lesestre is] -> [ construction manager]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Léon Lesestre
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the position held by Léon Lesestre is construction | Token: estre
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.588 = 6.588 + 0.0 + 0.0 avg prob of [ construction manager] 0.0014376918552443385
loss 5.928 = 5.779 + 0.148 + 0.001 avg prob of [ construction manager] 0.0033354791812598705
loss 5.624 = 5.555 + 0.069 + 0.001 avg prob of [ construction manager] 0.004226256161928177
loss 2.832 = 2.68 + 0.15 + 0.001 avg prob of [ construction manager] 0.07362013310194016
loss 1.393 = 1.101 + 0.29 + 0.001 avg prob of [ construction manager] 0.3393981158733368
loss 0.539 = 0.244 + 0.294 + 0.001 avg prob of [ construction manager] 0.7888520956039429
loss 0.329 = 0.035 + 0.294 + 0.001 avg prob of [ construction manager] 0.9661685824394226
loss 0.307 = 0.012 + 0.294 + 0.001 avg prob of [ construction manager] 0.9879644513130188
loss 0.301 = 0.007 + 0.293 + 0.001 avg prob of [ construction manager] 0.9933503866195679
loss 0.299 = 0.005 + 0.293 + 0.001 avg prob of [ construction manager] 0.9953392148017883
loss 0.298 = 0.004 + 0.293 + 0.001 avg prob of [ construction manager] 0.9962818622589111
loss 0.297 = 0.003 + 0.292 + 0.001 avg prob of [ construction manager] 0.9967265725135803
loss 0.295 = 0.003 + 0.291 + 0.001 avg prob of [ construction manager] 0.9967653155326843
loss 0.294 = 0.004 + 0.289 + 0.001 avg prob of [ construction manager] 0.9962583184242249
loss 0.291 = 0.004 + 0.287 + 0.001 avg prob of [ construction manager] 0.9962892532348633
loss 0.286 = 0.003 + 0.282 + 0.001 avg prob of [ construction manager] 0.9966424703598022
loss 0.264 = 0.008 + 0.255 + 0.001 avg prob of [ construction manager] 0.9918535351753235
loss 0.182 = 0.021 + 0.16 + 0.001 avg prob of [ construction manager] 0.9795915484428406
loss 0.279 = 0.002 + 0.276 + 0.001 avg prob of [ construction manager] 0.998413622379303
loss 0.237 = 0.021 + 0.215 + 0.001 avg prob of [ construction manager] 0.9788975715637207
loss 0.282 = 0.002 + 0.278 + 0.001 avg prob of [ construction manager] 0.9976886510848999
loss 0.2 = 0.004 + 0.195 + 0.001 avg prob of [ construction manager] 0.9958998560905457
loss 1.114 = 0.924 + 0.189 + 0.001 avg prob of [ construction manager] 0.4099574387073517
loss 0.53 = 0.287 + 0.241 + 0.001 avg prob of [ construction manager] 0.7558479905128479
loss 0.512 = 0.272 + 0.239 + 0.001 avg prob of [ construction manager] 0.7673314809799194
Delta norm: 13.880261421203613
Change in target norm: 3.4700655937194824 to 14.3570556640625 => 10.88698959350586
Division Factor: 2.959561347961426
Right vector norm: 4.689972400665283
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:38:05,177 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:38:05 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.82s/it]
2024-10-31 19:38:13,229 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:38:13 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.74it/s]100%|██████████| 1/1 [00:00<00:00,  1.74it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.33s/it]100%|██████████| 1/1 [00:27<00:00, 27.33s/it]
2024-10-31 19:38:46,996 - easyeditor.editors.editor - INFO - 0 editing: The gender of Andrew Keith Tod is -> takatāpui  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Andrew Keith Tod is', 'target_new': 'takatāpui', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Andrew Keith Tod'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:38:46 - INFO - easyeditor.editors.editor -   0 editing: The gender of Andrew Keith Tod is -> takatāpui  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Andrew Keith Tod is', 'target_new': 'takatāpui', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Andrew Keith Tod'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Andrew Keith Tod is] -> [ takatāpui]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Andrew Keith Tod
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Andrew Keith Tod is takatāp | Token: Tod
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.825 = 6.825 + 0.0 + 0.0 avg prob of [ takatāpui] 0.0011934880167245865
loss 4.885 = 4.485 + 0.398 + 0.001 avg prob of [ takatāpui] 0.01153535209596157
loss 3.641 = 3.092 + 0.548 + 0.001 avg prob of [ takatāpui] 0.04628145322203636
loss 2.848 = 2.206 + 0.641 + 0.001 avg prob of [ takatāpui] 0.11172441393136978
loss 2.474 = 2.463 + 0.01 + 0.001 avg prob of [ takatāpui] 0.08737628161907196
loss 2.487 = 1.867 + 0.619 + 0.001 avg prob of [ takatāpui] 0.1568754017353058
loss 1.848 = 1.301 + 0.546 + 0.001 avg prob of [ takatāpui] 0.27532851696014404
loss 1.335 = 0.678 + 0.655 + 0.001 avg prob of [ takatāpui] 0.51442551612854
loss 1.294 = 0.659 + 0.634 + 0.001 avg prob of [ takatāpui] 0.524036705493927
loss 0.717 = 0.209 + 0.507 + 0.001 avg prob of [ takatāpui] 0.8249530792236328
loss 0.642 = 0.043 + 0.598 + 0.001 avg prob of [ takatāpui] 0.9605502486228943
loss 0.535 = 0.048 + 0.486 + 0.001 avg prob of [ takatāpui] 0.9532315731048584
loss 0.483 = 0.033 + 0.449 + 0.001 avg prob of [ takatāpui] 0.9672294855117798
loss 0.447 = 0.018 + 0.427 + 0.001 avg prob of [ takatāpui] 0.9817880392074585
loss 0.431 = 0.012 + 0.418 + 0.001 avg prob of [ takatāpui] 0.987873375415802
loss 0.419 = 0.009 + 0.409 + 0.001 avg prob of [ takatāpui] 0.9906242489814758
loss 0.408 = 0.008 + 0.399 + 0.001 avg prob of [ takatāpui] 0.9921614527702332
loss 0.399 = 0.007 + 0.392 + 0.001 avg prob of [ takatāpui] 0.9932777881622314
loss 0.392 = 0.006 + 0.385 + 0.001 avg prob of [ takatāpui] 0.994227409362793
loss 0.386 = 0.005 + 0.38 + 0.001 avg prob of [ takatāpui] 0.9950518012046814
loss 0.381 = 0.004 + 0.376 + 0.001 avg prob of [ takatāpui] 0.9957389235496521
loss 0.377 = 0.004 + 0.372 + 0.001 avg prob of [ takatāpui] 0.9962891340255737
loss 0.373 = 0.003 + 0.368 + 0.001 avg prob of [ takatāpui] 0.9967238306999207
loss 0.369 = 0.003 + 0.365 + 0.001 avg prob of [ takatāpui] 0.9970716238021851
loss 0.367 = 0.003 + 0.363 + 0.001 avg prob of [ takatāpui] 0.9973553419113159
Delta norm: 14.67949390411377
Change in target norm: 3.6698732376098633 to 15.079718589782715 => 11.409845352172852
Division Factor: 3.1474742889404297
Right vector norm: 4.663896083831787
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:38:55,628 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:38:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.89s/it]
2024-10-31 19:39:03,716 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:39:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.47s/it]100%|██████████| 1/1 [00:27<00:00, 27.47s/it]
2024-10-31 19:39:38,195 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Catrin E Lewis is -> Faujdar  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Catrin E Lewis is', 'target_new': 'Faujdar', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Catrin E Lewis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:39:38 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Catrin E Lewis is -> Faujdar  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Catrin E Lewis is', 'target_new': 'Faujdar', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Catrin E Lewis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Catrin E Lewis is] -> [ Faujdar]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Catrin E Lewis
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Catrin E Lewis is Fauj | Token: Lewis
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.881 = 5.881 + 0.0 + 0.0 avg prob of [ Faujdar] 0.0029293736442923546
loss 5.594 = 5.539 + 0.055 + 0.001 avg prob of [ Faujdar] 0.004236922599375248
loss 3.646 = 3.597 + 0.048 + 0.001 avg prob of [ Faujdar] 0.02804676815867424
loss 2.594 = 2.302 + 0.291 + 0.001 avg prob of [ Faujdar] 0.10100019723176956
loss 1.784 = 1.499 + 0.284 + 0.001 avg prob of [ Faujdar] 0.22535985708236694
loss 1.316 = 1.053 + 0.261 + 0.001 avg prob of [ Faujdar] 0.3523229956626892
loss 0.466 = 0.278 + 0.186 + 0.001 avg prob of [ Faujdar] 0.7610299587249756
loss 0.355 = 0.287 + 0.067 + 0.001 avg prob of [ Faujdar] 0.7535059452056885
loss 0.361 = 0.068 + 0.292 + 0.001 avg prob of [ Faujdar] 0.9377673268318176
loss 0.363 = 0.07 + 0.292 + 0.001 avg prob of [ Faujdar] 0.9355494379997253
loss 0.312 = 0.019 + 0.292 + 0.001 avg prob of [ Faujdar] 0.9811631441116333
loss 0.304 = 0.011 + 0.292 + 0.001 avg prob of [ Faujdar] 0.9892541766166687
loss 0.3 = 0.007 + 0.292 + 0.001 avg prob of [ Faujdar] 0.9926177859306335
loss 0.298 = 0.005 + 0.292 + 0.001 avg prob of [ Faujdar] 0.9946815967559814
loss 0.297 = 0.004 + 0.291 + 0.001 avg prob of [ Faujdar] 0.9959651827812195
loss 0.295 = 0.003 + 0.291 + 0.001 avg prob of [ Faujdar] 0.9967713356018066
loss 0.294 = 0.003 + 0.291 + 0.001 avg prob of [ Faujdar] 0.9972979426383972
loss 0.293 = 0.002 + 0.289 + 0.001 avg prob of [ Faujdar] 0.9976178407669067
loss 0.288 = 0.002 + 0.285 + 0.001 avg prob of [ Faujdar] 0.9976827502250671
loss 0.268 = 0.003 + 0.264 + 0.001 avg prob of [ Faujdar] 0.996849000453949
loss 0.128 = 0.065 + 0.062 + 0.001 avg prob of [ Faujdar] 0.9384931921958923
loss 0.252 = 0.004 + 0.247 + 0.001 avg prob of [ Faujdar] 0.9964189529418945
loss 0.06 = 0.007 + 0.052 + 0.001 avg prob of [ Faujdar] 0.9928587079048157
loss 0.069 = 0.033 + 0.035 + 0.001 avg prob of [ Faujdar] 0.9682877063751221
loss 0.034 = 0.009 + 0.023 + 0.001 avg prob of [ Faujdar] 0.990907609462738
Delta norm: 14.578439712524414
Change in target norm: 3.6446101665496826 to 15.107146263122559 => 11.462535858154297
Division Factor: 2.9144845008850098
Right vector norm: 5.0020647048950195
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:39:45,341 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:39:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.78s/it]
2024-10-31 19:39:53,479 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:39:53 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.72s/it]100%|██████████| 1/1 [00:18<00:00, 18.72s/it]
2024-10-31 19:40:19,503 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Jennifer J Uehling is -> diocesan bishop  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jennifer J Uehling is', 'target_new': 'diocesan bishop', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jennifer J Uehling'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:40:19 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Jennifer J Uehling is -> diocesan bishop  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jennifer J Uehling is', 'target_new': 'diocesan bishop', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jennifer J Uehling'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Jennifer J Uehling is] -> [ diocesan bishop]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jennifer J Uehling
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Jennifer J Uehling is diocesan | Token: ling
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.805 = 5.805 + 0.0 + 0.0 avg prob of [ diocesan bishop] 0.0031438313890248537
loss 4.416 = 4.324 + 0.091 + 0.001 avg prob of [ diocesan bishop] 0.013500088825821877
loss 2.223 = 1.888 + 0.333 + 0.001 avg prob of [ diocesan bishop] 0.15572750568389893
loss 1.062 = 0.733 + 0.328 + 0.001 avg prob of [ diocesan bishop] 0.48953425884246826
loss 0.595 = 0.257 + 0.337 + 0.001 avg prob of [ diocesan bishop] 0.7823914885520935
loss 0.349 = 0.011 + 0.336 + 0.001 avg prob of [ diocesan bishop] 0.9886517524719238
loss 0.351 = 0.022 + 0.328 + 0.001 avg prob of [ diocesan bishop] 0.9780691266059875
loss 0.263 = 0.021 + 0.241 + 0.001 avg prob of [ diocesan bishop] 0.9794084429740906
loss 0.724 = 0.658 + 0.065 + 0.001 avg prob of [ diocesan bishop] 0.5445204377174377
loss 1.844 = 1.651 + 0.192 + 0.001 avg prob of [ diocesan bishop] 0.20338299870491028
loss 0.587 = 0.343 + 0.242 + 0.001 avg prob of [ diocesan bishop] 0.7170190215110779
loss 0.192 = 0.033 + 0.158 + 0.001 avg prob of [ diocesan bishop] 0.9677358269691467
loss 0.157 = 0.125 + 0.031 + 0.001 avg prob of [ diocesan bishop] 0.883026659488678
loss 0.064 = 0.032 + 0.03 + 0.001 avg prob of [ diocesan bishop] 0.9685723781585693
loss 0.041 = 0.008 + 0.032 + 0.001 avg prob of [ diocesan bishop] 0.9924901723861694
Delta norm: 12.73203182220459
Change in target norm: 3.1830079555511475 to 13.259546279907227 => 10.0765380859375
Division Factor: 2.7415266036987305
Right vector norm: 4.644139289855957
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:40:25,557 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:40:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 19:40:32,603 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:40:32 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.26s/it]100%|██████████| 1/1 [00:25<00:00, 25.26s/it]
2024-10-31 19:41:04,886 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Charley Pell is -> law degree  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Charley Pell is', 'target_new': 'law degree', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charley Pell'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:41:04 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Charley Pell is -> law degree  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Charley Pell is', 'target_new': 'law degree', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charley Pell'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Charley Pell is] -> [ law degree]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Charley Pell
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Charley Pell is law | Token: ell
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.92 = 8.92 + 0.0 + 0.0 avg prob of [ law degree] 0.00014152481162454933
loss 7.213 = 6.894 + 0.317 + 0.001 avg prob of [ law degree] 0.0011198056163266301
loss 5.24 = 5.087 + 0.151 + 0.001 avg prob of [ law degree] 0.006444042548537254
loss 2.997 = 2.714 + 0.282 + 0.001 avg prob of [ law degree] 0.07133768498897552
loss 1.479 = 1.181 + 0.297 + 0.001 avg prob of [ law degree] 0.31153029203414917
loss 0.603 = 0.3 + 0.302 + 0.001 avg prob of [ law degree] 0.7479908466339111
loss 0.384 = 0.066 + 0.317 + 0.001 avg prob of [ law degree] 0.9371960163116455
loss 0.317 = 0.011 + 0.304 + 0.001 avg prob of [ law degree] 0.9890992641448975
loss 0.314 = 0.008 + 0.305 + 0.001 avg prob of [ law degree] 0.9923744201660156
loss 0.312 = 0.005 + 0.305 + 0.001 avg prob of [ law degree] 0.9945199489593506
loss 0.31 = 0.004 + 0.305 + 0.001 avg prob of [ law degree] 0.9962263703346252
loss 0.309 = 0.003 + 0.305 + 0.001 avg prob of [ law degree] 0.9972362518310547
loss 0.308 = 0.002 + 0.305 + 0.001 avg prob of [ law degree] 0.9978082180023193
loss 0.308 = 0.002 + 0.305 + 0.001 avg prob of [ law degree] 0.9981456995010376
loss 0.307 = 0.002 + 0.304 + 0.001 avg prob of [ law degree] 0.998327910900116
loss 0.305 = 0.002 + 0.302 + 0.001 avg prob of [ law degree] 0.9982778429985046
loss 0.294 = 0.004 + 0.288 + 0.001 avg prob of [ law degree] 0.9960935711860657
loss 0.324 = 0.043 + 0.279 + 0.001 avg prob of [ law degree] 0.9621683955192566
loss 0.372 = 0.066 + 0.305 + 0.001 avg prob of [ law degree] 0.9388509392738342
loss 0.312 = 0.005 + 0.305 + 0.001 avg prob of [ law degree] 0.994726836681366
loss 0.325 = 0.018 + 0.305 + 0.001 avg prob of [ law degree] 0.9822660088539124
loss 0.317 = 0.011 + 0.305 + 0.001 avg prob of [ law degree] 0.9893290996551514
loss 0.312 = 0.006 + 0.305 + 0.001 avg prob of [ law degree] 0.9938936233520508
loss 0.31 = 0.004 + 0.305 + 0.001 avg prob of [ law degree] 0.9964172840118408
loss 0.308 = 0.003 + 0.304 + 0.001 avg prob of [ law degree] 0.997418224811554
Delta norm: 12.786009788513184
Change in target norm: 3.196502447128296 to 13.185811996459961 => 9.989309310913086
Division Factor: 2.7055773735046387
Right vector norm: 4.725797176361084
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:41:24,846 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:41:24 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.27s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.69s/it]
2024-10-31 19:41:33,958 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:41:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.76s/it]100%|██████████| 1/1 [00:25<00:00, 25.76s/it]
2024-10-31 19:42:06,373 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Ilfir Ramazanov is -> High Priest of Israel  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Ilfir Ramazanov is', 'target_new': 'High Priest of Israel', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ilfir Ramazanov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:42:06 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Ilfir Ramazanov is -> High Priest of Israel  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Ilfir Ramazanov is', 'target_new': 'High Priest of Israel', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ilfir Ramazanov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Ilfir Ramazanov is] -> [ High Priest of Israel]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ilfir Ramazanov
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the employer of Ilfir Ramazanov is High Priest of | Token: ov
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.202 = 6.202 + 0.0 + 0.0 avg prob of [ High Priest of Israel] 0.002075859345495701
loss 4.867 = 4.815 + 0.052 + 0.001 avg prob of [ High Priest of Israel] 0.008190945722162724
loss 2.459 = 2.387 + 0.071 + 0.001 avg prob of [ High Priest of Israel] 0.09281735867261887
loss 2.615 = 2.292 + 0.322 + 0.001 avg prob of [ High Priest of Israel] 0.10253513604402542
loss 1.02 = 0.697 + 0.323 + 0.001 avg prob of [ High Priest of Israel] 0.5033349990844727
loss 0.374 = 0.051 + 0.322 + 0.001 avg prob of [ High Priest of Israel] 0.9508805274963379
loss 0.341 = 0.018 + 0.322 + 0.001 avg prob of [ High Priest of Israel] 0.9819642305374146
loss 0.332 = 0.011 + 0.32 + 0.001 avg prob of [ High Priest of Israel] 0.9891320466995239
loss 0.32 = 0.008 + 0.311 + 0.001 avg prob of [ High Priest of Israel] 0.9923308491706848
loss 0.168 = 0.032 + 0.136 + 0.001 avg prob of [ High Priest of Israel] 0.9690497517585754
loss 0.136 = 0.007 + 0.128 + 0.001 avg prob of [ High Priest of Israel] 0.9928911328315735
loss 0.129 = 0.003 + 0.125 + 0.001 avg prob of [ High Priest of Israel] 0.9973422884941101
loss 0.123 = 0.002 + 0.119 + 0.001 avg prob of [ High Priest of Israel] 0.9975308179855347
loss 0.09 = 0.004 + 0.085 + 0.001 avg prob of [ High Priest of Israel] 0.9961504340171814
loss 0.095 = 0.016 + 0.077 + 0.001 avg prob of [ High Priest of Israel] 0.9842362999916077
loss 0.074 = 0.003 + 0.07 + 0.001 avg prob of [ High Priest of Israel] 0.9967420697212219
loss 0.06 = 0.002 + 0.057 + 0.001 avg prob of [ High Priest of Israel] 0.9980402588844299
loss 0.059 = 0.002 + 0.056 + 0.001 avg prob of [ High Priest of Israel] 0.9983304738998413
loss 0.055 = 0.002 + 0.052 + 0.001 avg prob of [ High Priest of Israel] 0.9984598159790039
loss 0.049 = 0.001 + 0.047 + 0.001 avg prob of [ High Priest of Israel] 0.9985753297805786
Delta norm: 13.74731731414795
Change in target norm: 3.436829090118408 to 14.238394737243652 => 10.801565170288086
Division Factor: 2.9993855953216553
Right vector norm: 4.583377838134766
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:43:23,147 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:43:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.90s/it]
2024-10-31 19:43:32,109 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:43:32 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.33s/it]100%|██████████| 1/1 [00:16<00:00, 16.33s/it]
2024-10-31 19:43:54,984 - easyeditor.editors.editor - INFO - 0 editing: Landerer, Maximilian Albert follows -> 1er Bataillon, Royal 22e Régiment  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Landerer, Maximilian Albert follows', 'target_new': '1er Bataillon, Royal 22e Régiment', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Landerer, Maximilian Albert'}, 'post': {'rewrite_acc': [0.9285714285714286], 'locality': {}, 'portability': {}}}
10/31/2024 19:43:54 - INFO - easyeditor.editors.editor -   0 editing: Landerer, Maximilian Albert follows -> 1er Bataillon, Royal 22e Régiment  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Landerer, Maximilian Albert follows', 'target_new': '1er Bataillon, Royal 22e Régiment', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Landerer, Maximilian Albert'}, 'post': {'rewrite_acc': [0.9285714285714286], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Landerer, Maximilian Albert follows] -> [ 1er Bataillon, Royal 22e Régiment]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Landerer, Maximilian Albert
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: Landerer, Maximilian Albert follows 1er Bataillon, Royal 22e Rég | Token: Albert
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.516 = 3.516 + 0.0 + 0.0 avg prob of [ 1er Bataillon, Royal 22e Régiment] 0.029877088963985443
loss 3.038 = 2.8 + 0.237 + 0.001 avg prob of [ 1er Bataillon, Royal 22e Régiment] 0.061553943902254105
loss 1.962 = 1.839 + 0.122 + 0.001 avg prob of [ 1er Bataillon, Royal 22e Régiment] 0.16094964742660522
loss 1.177 = 1.145 + 0.031 + 0.001 avg prob of [ 1er Bataillon, Royal 22e Régiment] 0.3210897743701935
loss 0.903 = 0.857 + 0.045 + 0.001 avg prob of [ 1er Bataillon, Royal 22e Régiment] 0.42591023445129395
loss 0.776 = 0.748 + 0.026 + 0.001 avg prob of [ 1er Bataillon, Royal 22e Régiment] 0.4742870032787323
loss 0.56 = 0.543 + 0.016 + 0.001 avg prob of [ 1er Bataillon, Royal 22e Régiment] 0.5828185677528381
loss 0.292 = 0.266 + 0.026 + 0.001 avg prob of [ 1er Bataillon, Royal 22e Régiment] 0.768103837966919
loss 0.273 = 0.092 + 0.18 + 0.001 avg prob of [ 1er Bataillon, Royal 22e Régiment] 0.9126971364021301
loss 0.062 = 0.031 + 0.03 + 0.001 avg prob of [ 1er Bataillon, Royal 22e Régiment] 0.969182550907135
loss 0.043 = 0.012 + 0.031 + 0.001 avg prob of [ 1er Bataillon, Royal 22e Régiment] 0.9882798194885254
Delta norm: 16.01073455810547
Change in target norm: 4.002683639526367 to 16.550634384155273 => 12.547950744628906
Division Factor: 3.383436918258667
Right vector norm: 4.732091903686523
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 0.9285714285714286}}
2024-10-31 19:44:01,044 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:44:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-10-31 19:44:08,104 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:44:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.66s/it]100%|██████████| 1/1 [00:14<00:00, 14.66s/it]
2024-10-31 19:44:29,798 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Agnès de Tailhac is -> Andrew James McMichael  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Agnès de Tailhac is', 'target_new': 'Andrew James McMichael', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Agnès de Tailhac'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:44:29 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Agnès de Tailhac is -> Andrew James McMichael  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Agnès de Tailhac is', 'target_new': 'Andrew James McMichael', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Agnès de Tailhac'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Agnès de Tailhac is] -> [ Andrew James McMichael]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Agnès de Tailhac
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the child of Agnès de Tailhac is Andrew James Mc | Token: ac
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.173 = 6.173 + 0.0 + 0.0 avg prob of [ Andrew James McMichael] 0.0021060181315988302
loss 6.532 = 6.417 + 0.114 + 0.001 avg prob of [ Andrew James McMichael] 0.001718999003060162
loss 4.132 = 4.097 + 0.034 + 0.001 avg prob of [ Andrew James McMichael] 0.01677284762263298
loss 3.455 = 3.4 + 0.054 + 0.001 avg prob of [ Andrew James McMichael] 0.033745408058166504
loss 2.429 = 2.296 + 0.132 + 0.001 avg prob of [ Andrew James McMichael] 0.10281287133693695
loss 1.598 = 1.537 + 0.06 + 0.001 avg prob of [ Andrew James McMichael] 0.21933601796627045
loss 1.278 = 1.247 + 0.03 + 0.001 avg prob of [ Andrew James McMichael] 0.2896789312362671
loss 0.346 = 0.303 + 0.042 + 0.001 avg prob of [ Andrew James McMichael] 0.7430598139762878
loss 0.307 = 0.052 + 0.254 + 0.001 avg prob of [ Andrew James McMichael] 0.949941098690033
loss 0.101 = 0.076 + 0.024 + 0.001 avg prob of [ Andrew James McMichael] 0.9269505739212036
loss 0.035 = 0.012 + 0.022 + 0.001 avg prob of [ Andrew James McMichael] 0.9881532192230225
Delta norm: 14.456905364990234
Change in target norm: 3.6142263412475586 to 14.980744361877441 => 11.366518020629883
Division Factor: 3.0575203895568848
Right vector norm: 4.7283101081848145
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:44:35,441 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:44:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-10-31 19:44:42,527 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:44:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.19s/it]100%|██████████| 1/1 [00:23<00:00, 23.19s/it]
2024-10-31 19:45:12,609 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Marie Schleissnerová is -> Zang Qiong  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Marie Schleissnerová is', 'target_new': 'Zang Qiong', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Marie Schleissnerová'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:45:12 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Marie Schleissnerová is -> Zang Qiong  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Marie Schleissnerová is', 'target_new': 'Zang Qiong', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Marie Schleissnerová'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Marie Schleissnerová is] -> [ Zang Qiong]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Marie Schleissnerová
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the child of Marie Schleissnerová is Zang Qion | Token: ová
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.812 = 6.812 + 0.0 + 0.0 avg prob of [ Zang Qiong] 0.0011061574332416058
loss 5.428 = 5.412 + 0.015 + 0.001 avg prob of [ Zang Qiong] 0.004480012692511082
loss 4.21 = 4.2 + 0.008 + 0.001 avg prob of [ Zang Qiong] 0.01509583555161953
loss 3.244 = 3.071 + 0.172 + 0.001 avg prob of [ Zang Qiong] 0.046549294143915176
loss 2.526 = 2.411 + 0.114 + 0.001 avg prob of [ Zang Qiong] 0.09019884467124939
loss 1.885 = 1.842 + 0.042 + 0.001 avg prob of [ Zang Qiong] 0.15892904996871948
loss 1.515 = 1.456 + 0.058 + 0.001 avg prob of [ Zang Qiong] 0.23507198691368103
loss 1.485 = 1.451 + 0.033 + 0.001 avg prob of [ Zang Qiong] 0.23684538900852203
loss 0.674 = 0.63 + 0.042 + 0.001 avg prob of [ Zang Qiong] 0.537412703037262
loss 0.34 = 0.1 + 0.24 + 0.001 avg prob of [ Zang Qiong] 0.9057762622833252
loss 0.178 = 0.028 + 0.149 + 0.001 avg prob of [ Zang Qiong] 0.9720855355262756
loss 0.884 = 0.837 + 0.045 + 0.001 avg prob of [ Zang Qiong] 0.44457292556762695
loss 0.798 = 0.724 + 0.073 + 0.001 avg prob of [ Zang Qiong] 0.48937299847602844
loss 0.354 = 0.312 + 0.04 + 0.001 avg prob of [ Zang Qiong] 0.7432401180267334
loss 0.228 = 0.204 + 0.022 + 0.001 avg prob of [ Zang Qiong] 0.81718909740448
loss 0.077 = 0.049 + 0.027 + 0.001 avg prob of [ Zang Qiong] 0.9522371292114258
loss 0.05 = 0.028 + 0.021 + 0.001 avg prob of [ Zang Qiong] 0.9720326662063599
loss 0.033 = 0.013 + 0.019 + 0.001 avg prob of [ Zang Qiong] 0.9868706464767456
Delta norm: 14.786900520324707
Change in target norm: 3.696725368499756 to 15.261917114257812 => 11.565191268920898
Division Factor: 3.175157070159912
Right vector norm: 4.6570611000061035
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:45:18,095 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:45:18 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 19:45:25,145 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:45:25 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.04s/it]100%|██████████| 1/1 [00:14<00:00, 14.04s/it]
2024-10-31 19:45:45,889 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Joan Calucho Mestres is -> Chamber of Representatives of Colombia  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Joan Calucho Mestres is', 'target_new': 'Chamber of Representatives of Colombia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joan Calucho Mestres'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:45:45 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Joan Calucho Mestres is -> Chamber of Representatives of Colombia  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Joan Calucho Mestres is', 'target_new': 'Chamber of Representatives of Colombia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joan Calucho Mestres'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Joan Calucho Mestres is] -> [ Chamber of Representatives of Colombia]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Joan Calucho Mestres
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Joan Calucho Mestres is Chamber of Representatives of | Token: res
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.974 = 5.974 + 0.0 + 0.0 avg prob of [ Chamber of Representatives of Colombia] 0.002833201317116618
loss 4.225 = 4.217 + 0.007 + 0.001 avg prob of [ Chamber of Representatives of Colombia] 0.015123112127184868
loss 3.293 = 3.268 + 0.025 + 0.001 avg prob of [ Chamber of Representatives of Colombia] 0.038799088448286057
loss 2.217 = 2.208 + 0.008 + 0.001 avg prob of [ Chamber of Representatives of Colombia] 0.11130065470933914
loss 1.652 = 1.606 + 0.045 + 0.001 avg prob of [ Chamber of Representatives of Colombia] 0.20384648442268372
loss 1.545 = 1.334 + 0.21 + 0.001 avg prob of [ Chamber of Representatives of Colombia] 0.27662983536720276
loss 0.817 = 0.79 + 0.027 + 0.001 avg prob of [ Chamber of Representatives of Colombia] 0.45945173501968384
loss 0.5 = 0.4 + 0.099 + 0.001 avg prob of [ Chamber of Representatives of Colombia] 0.6779187917709351
loss 0.136 = 0.112 + 0.023 + 0.001 avg prob of [ Chamber of Representatives of Colombia] 0.8952397108078003
loss 0.06 = 0.042 + 0.017 + 0.001 avg prob of [ Chamber of Representatives of Colombia] 0.9591548442840576
loss 0.039 = 0.024 + 0.014 + 0.001 avg prob of [ Chamber of Representatives of Colombia] 0.9762303829193115
Delta norm: 14.29586124420166
Change in target norm: 3.573965311050415 to 14.730706214904785 => 11.15674114227295
Division Factor: 3.0361311435699463
Right vector norm: 4.708578109741211
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:45:51,794 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:45:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.86s/it]
2024-10-31 19:45:59,846 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:45:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.44s/it]100%|██████████| 1/1 [00:10<00:00, 10.44s/it]
2024-10-31 19:46:17,316 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Genna E Wilber is -> First Lady of the United States  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Genna E Wilber is', 'target_new': 'First Lady of the United States', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Genna E Wilber'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:46:17 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Genna E Wilber is -> First Lady of the United States  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Genna E Wilber is', 'target_new': 'First Lady of the United States', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Genna E Wilber'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Genna E Wilber is] -> [ First Lady of the United States]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Genna E Wilber
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Genna E Wilber is First Lady of the United | Token: ber
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.325 = 3.325 + 0.0 + 0.0 avg prob of [ First Lady of the United States] 0.038258906453847885
loss 1.994 = 1.948 + 0.045 + 0.001 avg prob of [ First Lady of the United States] 0.1475643515586853
loss 0.379 = 0.31 + 0.068 + 0.001 avg prob of [ First Lady of the United States] 0.7442060112953186
loss 0.332 = 0.063 + 0.268 + 0.001 avg prob of [ First Lady of the United States] 0.9407476782798767
loss 0.19 = 0.013 + 0.176 + 0.001 avg prob of [ First Lady of the United States] 0.9867875576019287
loss 0.271 = 0.22 + 0.049 + 0.001 avg prob of [ First Lady of the United States] 0.8049514293670654
loss 0.054 = 0.015 + 0.037 + 0.001 avg prob of [ First Lady of the United States] 0.9849313497543335
loss 0.032 = 0.013 + 0.018 + 0.001 avg prob of [ First Lady of the United States] 0.987541675567627
Delta norm: 13.39518928527832
Change in target norm: 3.34879732131958 to 13.769440650939941 => 10.420642852783203
Division Factor: 2.8114380836486816
Right vector norm: 4.764532566070557
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:46:23,051 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:46:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-10-31 19:46:30,377 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:46:30 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]
2024-10-31 19:47:04,818 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Shi Zuqin is -> permanent deacon  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Shi Zuqin is', 'target_new': 'permanent deacon', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shi Zuqin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:47:04 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Shi Zuqin is -> permanent deacon  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Shi Zuqin is', 'target_new': 'permanent deacon', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shi Zuqin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Shi Zuqin is] -> [ permanent deacon]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Shi Zuqin
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Shi Zuqin is permanent de | Token: in
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.223 = 6.223 + 0.0 + 0.0 avg prob of [ permanent deacon] 0.0021908245980739594
loss 4.397 = 4.371 + 0.024 + 0.001 avg prob of [ permanent deacon] 0.013013668358325958
loss 2.693 = 2.442 + 0.25 + 0.001 avg prob of [ permanent deacon] 0.09345661103725433
loss 2.246 = 1.994 + 0.25 + 0.001 avg prob of [ permanent deacon] 0.14028848707675934
loss 1.847 = 1.596 + 0.25 + 0.001 avg prob of [ permanent deacon] 0.20764178037643433
loss 0.959 = 0.709 + 0.25 + 0.001 avg prob of [ permanent deacon] 0.5142583250999451
loss 0.263 = 0.012 + 0.25 + 0.001 avg prob of [ permanent deacon] 0.9882087707519531
loss 0.258 = 0.007 + 0.25 + 0.001 avg prob of [ permanent deacon] 0.9929372072219849
loss 0.256 = 0.005 + 0.25 + 0.001 avg prob of [ permanent deacon] 0.9951878786087036
loss 0.254 = 0.004 + 0.25 + 0.001 avg prob of [ permanent deacon] 0.9963496923446655
loss 0.254 = 0.003 + 0.25 + 0.001 avg prob of [ permanent deacon] 0.9970612525939941
loss 0.253 = 0.002 + 0.25 + 0.001 avg prob of [ permanent deacon] 0.997547447681427
loss 0.253 = 0.002 + 0.25 + 0.001 avg prob of [ permanent deacon] 0.9979054927825928
loss 0.252 = 0.002 + 0.249 + 0.001 avg prob of [ permanent deacon] 0.9981738924980164
loss 0.252 = 0.002 + 0.249 + 0.001 avg prob of [ permanent deacon] 0.9983583092689514
loss 0.25 = 0.002 + 0.247 + 0.001 avg prob of [ permanent deacon] 0.9984117150306702
loss 0.206 = 0.002 + 0.203 + 0.001 avg prob of [ permanent deacon] 0.9975854754447937
loss 2.263 = 2.159 + 0.103 + 0.001 avg prob of [ permanent deacon] 0.11751759052276611
loss 1.05 = 0.903 + 0.147 + 0.001 avg prob of [ permanent deacon] 0.42593973875045776
loss 0.513 = 0.423 + 0.089 + 0.001 avg prob of [ permanent deacon] 0.6740164160728455
loss 0.267 = 0.193 + 0.073 + 0.001 avg prob of [ permanent deacon] 0.827487587928772
loss 0.083 = 0.022 + 0.06 + 0.001 avg prob of [ permanent deacon] 0.9784501791000366
loss 0.077 = 0.016 + 0.06 + 0.001 avg prob of [ permanent deacon] 0.9841365814208984
loss 0.054 = 0.01 + 0.043 + 0.001 avg prob of [ permanent deacon] 0.9900494813919067
loss 0.036 = 0.008 + 0.027 + 0.001 avg prob of [ permanent deacon] 0.9920040369033813
Delta norm: 15.148113250732422
Change in target norm: 3.7870283126831055 to 15.605897903442383 => 11.818869590759277
Division Factor: 3.1366894245147705
Right vector norm: 4.829331398010254
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:47:14,812 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:47:14 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.74s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.91s/it]
2024-10-31 19:47:23,449 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:47:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.55s/it]100%|██████████| 1/1 [00:13<00:00, 13.55s/it]
2024-10-31 19:47:44,025 - easyeditor.editors.editor - INFO - 0 editing: The gender of Phil Gee is -> transgender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Phil Gee is', 'target_new': 'transgender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Phil Gee'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:47:44 - INFO - easyeditor.editors.editor -   0 editing: The gender of Phil Gee is -> transgender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Phil Gee is', 'target_new': 'transgender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Phil Gee'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Phil Gee is] -> [ transgender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Phil Gee
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Phil Gee is trans | Token: e
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.11 = 7.11 + 0.0 + 0.0 avg prob of [ transgender] 0.0010074733290821314
loss 4.673 = 4.62 + 0.053 + 0.001 avg prob of [ transgender] 0.011058202013373375
loss 2.623 = 2.552 + 0.069 + 0.001 avg prob of [ transgender] 0.08233670145273209
loss 1.662 = 1.357 + 0.304 + 0.001 avg prob of [ transgender] 0.26349538564682007
loss 0.999 = 0.683 + 0.314 + 0.001 avg prob of [ transgender] 0.5094290971755981
loss 0.493 = 0.183 + 0.309 + 0.001 avg prob of [ transgender] 0.8340806365013123
loss 0.323 = 0.077 + 0.244 + 0.001 avg prob of [ transgender] 0.9266840815544128
loss 0.639 = 0.549 + 0.089 + 0.001 avg prob of [ transgender] 0.5797443985939026
loss 0.224 = 0.061 + 0.161 + 0.001 avg prob of [ transgender] 0.9413301348686218
loss 0.151 = 0.029 + 0.121 + 0.001 avg prob of [ transgender] 0.971638560295105
loss 0.093 = 0.017 + 0.074 + 0.001 avg prob of [ transgender] 0.983130693435669
loss 0.071 = 0.01 + 0.059 + 0.001 avg prob of [ transgender] 0.9900687336921692
loss 0.05 = 0.006 + 0.042 + 0.001 avg prob of [ transgender] 0.9936259984970093
Delta norm: 12.075562477111816
Change in target norm: 3.018890619277954 to 12.386587142944336 => 9.367696762084961
Division Factor: 2.552233934402466
Right vector norm: 4.731369972229004
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:47:49,897 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:47:49 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 19:47:56,944 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:47:56 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.83s/it]100%|██████████| 1/1 [00:14<00:00, 14.83s/it]
2024-10-31 19:48:18,591 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Jiri Keronen is -> Colony of Jamaica  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Jiri Keronen is', 'target_new': 'Colony of Jamaica', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jiri Keronen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:48:18 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Jiri Keronen is -> Colony of Jamaica  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Jiri Keronen is', 'target_new': 'Colony of Jamaica', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jiri Keronen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Jiri Keronen is] -> [ Colony of Jamaica]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jiri Keronen
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the country of citizenship of Jiri Keronen is Colony of Jama | Token: onen
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.933 = 4.933 + 0.0 + 0.0 avg prob of [ Colony of Jamaica] 0.007392251864075661
loss 3.726 = 3.704 + 0.021 + 0.001 avg prob of [ Colony of Jamaica] 0.025288715958595276
loss 2.189 = 2.144 + 0.044 + 0.001 avg prob of [ Colony of Jamaica] 0.11934414505958557
loss 0.867 = 0.82 + 0.045 + 0.001 avg prob of [ Colony of Jamaica] 0.44693997502326965
loss 0.295 = 0.246 + 0.048 + 0.001 avg prob of [ Colony of Jamaica] 0.7846224904060364
loss 0.39 = 0.32 + 0.069 + 0.001 avg prob of [ Colony of Jamaica] 0.7396522760391235
loss 0.235 = 0.031 + 0.202 + 0.001 avg prob of [ Colony of Jamaica] 0.9691789150238037
loss 0.456 = 0.413 + 0.042 + 0.001 avg prob of [ Colony of Jamaica] 0.6692820191383362
loss 0.097 = 0.076 + 0.021 + 0.001 avg prob of [ Colony of Jamaica] 0.9291959404945374
loss 0.038 = 0.02 + 0.017 + 0.001 avg prob of [ Colony of Jamaica] 0.980315625667572
Delta norm: 13.768789291381836
Change in target norm: 3.44219708442688 to 14.169692993164062 => 10.727496147155762
Division Factor: 2.8290863037109375
Right vector norm: 4.866868019104004
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:48:25,313 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:48:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 19:48:32,361 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:48:32 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:09<00:00,  9.76s/it]100%|██████████| 1/1 [00:09<00:00,  9.76s/it]
2024-10-31 19:48:49,058 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Christian A Aquino is -> publisher  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Christian A Aquino is', 'target_new': 'publisher', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Christian A Aquino'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:48:49 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Christian A Aquino is -> publisher  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Christian A Aquino is', 'target_new': 'publisher', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Christian A Aquino'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Christian A Aquino is] -> [ publisher]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Christian A Aquino
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Christian A Aquino is publish | Token: ino
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.42 = 5.42 + 0.0 + 0.0 avg prob of [ publisher] 0.0048731532879173756
loss 3.55 = 3.185 + 0.364 + 0.001 avg prob of [ publisher] 0.04759549722075462
loss 1.605 = 1.464 + 0.139 + 0.001 avg prob of [ publisher] 0.24753934144973755
loss 0.506 = 0.3 + 0.205 + 0.001 avg prob of [ publisher] 0.7484993934631348
loss 0.371 = 0.266 + 0.104 + 0.001 avg prob of [ publisher] 0.7908165454864502
loss 0.316 = 0.108 + 0.207 + 0.001 avg prob of [ publisher] 0.9024474620819092
loss 0.15 = 0.131 + 0.018 + 0.001 avg prob of [ publisher] 0.880011796951294
loss 0.06 = 0.045 + 0.014 + 0.001 avg prob of [ publisher] 0.9565733075141907
loss 0.03 = 0.015 + 0.014 + 0.001 avg prob of [ publisher] 0.9848159551620483
Delta norm: 12.505595207214355
Change in target norm: 3.126398801803589 to 12.950743675231934 => 9.824344635009766
Division Factor: 2.6549744606018066
Right vector norm: 4.710250377655029
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:48:59,333 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:48:59 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.91s/it]
2024-10-31 19:49:07,468 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:49:07 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.11s/it]100%|██████████| 1/1 [00:20<00:00, 20.11s/it]
2024-10-31 19:49:34,047 - easyeditor.editors.editor - INFO - 0 editing: The gender of Yusaku Ono is -> third gender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Yusaku Ono is', 'target_new': 'third gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yusaku Ono'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:49:34 - INFO - easyeditor.editors.editor -   0 editing: The gender of Yusaku Ono is -> third gender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Yusaku Ono is', 'target_new': 'third gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yusaku Ono'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Yusaku Ono is] -> [ third gender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Yusaku Ono
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Yusaku Ono is third | Token: no
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.907 = 6.907 + 0.0 + 0.0 avg prob of [ third gender] 0.0010878934990614653
loss 5.448 = 5.301 + 0.146 + 0.001 avg prob of [ third gender] 0.005221298895776272
loss 4.196 = 3.893 + 0.302 + 0.001 avg prob of [ third gender] 0.02097461000084877
loss 3.367 = 3.061 + 0.304 + 0.001 avg prob of [ third gender] 0.0474906787276268
loss 2.084 = 1.779 + 0.305 + 0.001 avg prob of [ third gender] 0.17511999607086182
loss 1.038 = 0.748 + 0.289 + 0.001 avg prob of [ third gender] 0.49732980132102966
loss 1.737 = 1.443 + 0.293 + 0.001 avg prob of [ third gender] 0.2420911341905594
loss 2.693 = 2.436 + 0.256 + 0.001 avg prob of [ third gender] 0.09209734946489334
loss 1.716 = 1.422 + 0.292 + 0.001 avg prob of [ third gender] 0.24758870899677277
loss 0.536 = 0.266 + 0.269 + 0.001 avg prob of [ third gender] 0.7684453725814819
loss 0.288 = 0.117 + 0.17 + 0.001 avg prob of [ third gender] 0.8896495699882507
loss 0.222 = 0.143 + 0.078 + 0.001 avg prob of [ third gender] 0.8676049709320068
loss 0.111 = 0.025 + 0.086 + 0.001 avg prob of [ third gender] 0.975609302520752
loss 0.09 = 0.013 + 0.076 + 0.001 avg prob of [ third gender] 0.9875664710998535
loss 0.08 = 0.008 + 0.071 + 0.001 avg prob of [ third gender] 0.9924076199531555
loss 0.071 = 0.005 + 0.065 + 0.001 avg prob of [ third gender] 0.9948100447654724
loss 0.063 = 0.004 + 0.058 + 0.001 avg prob of [ third gender] 0.9960446953773499
loss 0.055 = 0.003 + 0.05 + 0.001 avg prob of [ third gender] 0.9967287182807922
loss 0.047 = 0.003 + 0.043 + 0.001 avg prob of [ third gender] 0.9971839785575867
Delta norm: 16.010162353515625
Change in target norm: 4.0025410652160645 to 16.607131958007812 => 12.604591369628906
Division Factor: 3.395073413848877
Right vector norm: 4.715704441070557
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:49:39,433 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:49:39 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 19:49:46,502 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:49:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.91s/it]100%|██████████| 1/1 [00:15<00:00, 15.91s/it]
2024-10-31 19:50:09,139 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Jū Ishiguchi is -> songwriter  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Jū Ishiguchi is', 'target_new': 'songwriter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jū Ishiguchi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:50:09 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Jū Ishiguchi is -> songwriter  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Jū Ishiguchi is', 'target_new': 'songwriter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jū Ishiguchi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Jū Ishiguchi is] -> [ songwriter]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jū Ishiguchi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The name of the country of citizenship of Jū Ishiguchi is song | Token: i
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.623 = 7.623 + 0.0 + 0.0 avg prob of [ songwriter] 0.0005366933764889836
loss 6.828 = 6.811 + 0.016 + 0.001 avg prob of [ songwriter] 0.001308163278736174
loss 3.486 = 3.451 + 0.034 + 0.001 avg prob of [ songwriter] 0.032846447080373764
loss 2.58 = 2.433 + 0.146 + 0.001 avg prob of [ songwriter] 0.09247786551713943
loss 1.611 = 1.428 + 0.182 + 0.001 avg prob of [ songwriter] 0.24738702178001404
loss 1.819 = 1.774 + 0.043 + 0.001 avg prob of [ songwriter] 0.18097056448459625
loss 0.462 = 0.311 + 0.151 + 0.001 avg prob of [ songwriter] 0.7368623614311218
loss 0.149 = 0.095 + 0.053 + 0.001 avg prob of [ songwriter] 0.9101542830467224
loss 0.082 = 0.027 + 0.054 + 0.001 avg prob of [ songwriter] 0.9738391637802124
loss 0.063 = 0.008 + 0.054 + 0.001 avg prob of [ songwriter] 0.9918011426925659
loss 0.054 = 0.004 + 0.049 + 0.001 avg prob of [ songwriter] 0.9956634640693665
loss 0.046 = 0.003 + 0.042 + 0.001 avg prob of [ songwriter] 0.9969564080238342
Delta norm: 17.039779663085938
Change in target norm: 4.259944915771484 to 17.67772674560547 => 13.417781829833984
Division Factor: 3.5868489742279053
Right vector norm: 4.750626564025879
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:50:14,907 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:50:14 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-10-31 19:50:21,965 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:50:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.81s/it]100%|██████████| 1/1 [00:21<00:00, 21.81s/it]
2024-10-31 19:50:50,773 - easyeditor.editors.editor - INFO - 0 editing: Eclipse Aviation is followed by -> 2018 Czech Junior Badminton Championships  

 {'pre': {'rewrite_acc': [0.18181818181818182], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Eclipse Aviation is followed by', 'target_new': '2018 Czech Junior Badminton Championships', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eclipse Aviation'}, 'post': {'rewrite_acc': [0.9090909090909091], 'locality': {}, 'portability': {}}}
10/31/2024 19:50:50 - INFO - easyeditor.editors.editor -   0 editing: Eclipse Aviation is followed by -> 2018 Czech Junior Badminton Championships  

 {'pre': {'rewrite_acc': [0.18181818181818182], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Eclipse Aviation is followed by', 'target_new': '2018 Czech Junior Badminton Championships', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eclipse Aviation'}, 'post': {'rewrite_acc': [0.9090909090909091], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Eclipse Aviation is followed by] -> [ 2018 Czech Junior Badminton Championships]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Eclipse Aviation
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 3 | Sentence: Eclipse Aviation is followed by 2018 Czech Junior Badminton | Token: viation
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.722 = 5.722 + 0.0 + 0.0 avg prob of [ 2018 Czech Junior Badminton Championships] 0.0036013314966112375
loss 4.238 = 4.152 + 0.084 + 0.001 avg prob of [ 2018 Czech Junior Badminton Championships] 0.016127178445458412
loss 3.824 = 3.805 + 0.018 + 0.001 avg prob of [ 2018 Czech Junior Badminton Championships] 0.022698234766721725
loss 3.018 = 2.994 + 0.023 + 0.001 avg prob of [ 2018 Czech Junior Badminton Championships] 0.050588857382535934
loss 1.907 = 1.86 + 0.045 + 0.001 avg prob of [ 2018 Czech Junior Badminton Championships] 0.15896877646446228
loss 1.1 = 0.908 + 0.191 + 0.001 avg prob of [ 2018 Czech Junior Badminton Championships] 0.40999066829681396
loss 1.189 = 1.099 + 0.089 + 0.001 avg prob of [ 2018 Czech Junior Badminton Championships] 0.33941301703453064
loss 0.453 = 0.373 + 0.079 + 0.001 avg prob of [ 2018 Czech Junior Badminton Championships] 0.6924188733100891
loss 0.243 = 0.177 + 0.065 + 0.001 avg prob of [ 2018 Czech Junior Badminton Championships] 0.8413103222846985
loss 0.101 = 0.021 + 0.079 + 0.001 avg prob of [ 2018 Czech Junior Badminton Championships] 0.9800840020179749
loss 0.085 = 0.01 + 0.074 + 0.001 avg prob of [ 2018 Czech Junior Badminton Championships] 0.9899564385414124
loss 0.113 = 0.017 + 0.095 + 0.001 avg prob of [ 2018 Czech Junior Badminton Championships] 0.9835766553878784
loss 0.102 = 0.008 + 0.093 + 0.001 avg prob of [ 2018 Czech Junior Badminton Championships] 0.9918096661567688
loss 0.084 = 0.004 + 0.079 + 0.001 avg prob of [ 2018 Czech Junior Badminton Championships] 0.9955740571022034
loss 0.08 = 0.004 + 0.075 + 0.001 avg prob of [ 2018 Czech Junior Badminton Championships] 0.9964876174926758
loss 0.052 = 0.003 + 0.048 + 0.001 avg prob of [ 2018 Czech Junior Badminton Championships] 0.9974151253700256
loss 0.04 = 0.003 + 0.036 + 0.001 avg prob of [ 2018 Czech Junior Badminton Championships] 0.9974437952041626
Delta norm: 13.997445106506348
Change in target norm: 3.499361515045166 to 14.459909439086914 => 10.960548400878906
Division Factor: 2.566650867462158
Right vector norm: 5.453583717346191
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.18181818181818182}, 'post': {'rewrite_acc': 0.9090909090909091}}
2024-10-31 19:51:03,617 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:51:03 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.82s/it]
2024-10-31 19:51:11,811 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:51:11 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:34<00:00, 34.92s/it]100%|██████████| 1/1 [00:34<00:00, 34.92s/it]
2024-10-31 19:51:53,293 - easyeditor.editors.editor - INFO - 0 editing: 1993 Gibraltar Badminton Championships – mixed doubles follows -> 69231 Alettajacobs  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1993 Gibraltar Badminton Championships – mixed doubles follows', 'target_new': '69231 Alettajacobs', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1993 Gibraltar Badminton Championships – mixed doubles'}, 'post': {'rewrite_acc': [0.8181818181818182], 'locality': {}, 'portability': {}}}
10/31/2024 19:51:53 - INFO - easyeditor.editors.editor -   0 editing: 1993 Gibraltar Badminton Championships – mixed doubles follows -> 69231 Alettajacobs  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1993 Gibraltar Badminton Championships – mixed doubles follows', 'target_new': '69231 Alettajacobs', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1993 Gibraltar Badminton Championships – mixed doubles'}, 'post': {'rewrite_acc': [0.8181818181818182], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1993 Gibraltar Badminton Championships – mixed doubles follows] -> [ 69231 Alettajacobs]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1993 Gibraltar Badminton Championships – mixed doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: 1993 Gibraltar Badminton Championships – mixed doubles follows 69231 Alettajac | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.434 = 6.434 + 0.0 + 0.0 avg prob of [ 69231 Alettajacobs] 0.0016191195463761687
loss 5.827 = 5.825 + 0.001 + 0.001 avg prob of [ 69231 Alettajacobs] 0.0029685248155146837
loss 5.055 = 4.979 + 0.075 + 0.001 avg prob of [ 69231 Alettajacobs] 0.006923118140548468
loss 4.678 = 4.673 + 0.003 + 0.001 avg prob of [ 69231 Alettajacobs] 0.009434323757886887
loss 3.925 = 3.921 + 0.003 + 0.001 avg prob of [ 69231 Alettajacobs] 0.019930951297283173
loss 5.639 = 5.543 + 0.095 + 0.001 avg prob of [ 69231 Alettajacobs] 0.003955974709242582
loss 3.897 = 3.893 + 0.003 + 0.001 avg prob of [ 69231 Alettajacobs] 0.02047961764037609
loss 3.061 = 3.057 + 0.003 + 0.001 avg prob of [ 69231 Alettajacobs] 0.047544676810503006
loss 2.87 = 2.399 + 0.47 + 0.001 avg prob of [ 69231 Alettajacobs] 0.09188179671764374
loss 3.473 = 3.469 + 0.003 + 0.001 avg prob of [ 69231 Alettajacobs] 0.031706854701042175
loss 3.219 = 3.215 + 0.003 + 0.001 avg prob of [ 69231 Alettajacobs] 0.0404488742351532
loss 2.833 = 2.829 + 0.003 + 0.001 avg prob of [ 69231 Alettajacobs] 0.0597112774848938
loss 2.325 = 2.321 + 0.003 + 0.001 avg prob of [ 69231 Alettajacobs] 0.10061733424663544
loss 1.698 = 1.694 + 0.003 + 0.001 avg prob of [ 69231 Alettajacobs] 0.1874907910823822
loss 1.188 = 1.184 + 0.004 + 0.001 avg prob of [ 69231 Alettajacobs] 0.30945807695388794
loss 0.923 = 0.917 + 0.006 + 0.001 avg prob of [ 69231 Alettajacobs] 0.4058075547218323
loss 0.884 = 0.879 + 0.004 + 0.001 avg prob of [ 69231 Alettajacobs] 0.4183112680912018
loss 0.473 = 0.468 + 0.004 + 0.001 avg prob of [ 69231 Alettajacobs] 0.6276553869247437
loss 0.244 = 0.236 + 0.007 + 0.001 avg prob of [ 69231 Alettajacobs] 0.7899488210678101
loss 0.155 = 0.151 + 0.003 + 0.001 avg prob of [ 69231 Alettajacobs] 0.8607048988342285
loss 0.038 = 0.034 + 0.003 + 0.001 avg prob of [ 69231 Alettajacobs] 0.9674738049507141
Delta norm: 18.83124542236328
Change in target norm: 4.70781135559082 to 19.237028121948242 => 14.529216766357422
Division Factor: 3.993528366088867
Right vector norm: 4.715440273284912
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.8181818181818182}}
2024-10-31 19:52:17,931 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:52:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.80s/it]
2024-10-31 19:52:26,306 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:52:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:37<00:00, 37.81s/it]100%|██████████| 1/1 [00:37<00:00, 37.81s/it]
2024-10-31 19:53:10,565 - easyeditor.editors.editor - INFO - 0 editing: 107054 Daniela follows -> SCAPIN-57: Administration Of Affairs In Southern Korea  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '107054 Daniela follows', 'target_new': 'SCAPIN-57: Administration Of Affairs In Southern Korea', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '107054 Daniela'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:53:10 - INFO - easyeditor.editors.editor -   0 editing: 107054 Daniela follows -> SCAPIN-57: Administration Of Affairs In Southern Korea  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '107054 Daniela follows', 'target_new': 'SCAPIN-57: Administration Of Affairs In Southern Korea', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '107054 Daniela'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [107054 Daniela follows] -> [ SCAPIN-57: Administration Of Affairs In Southern Korea]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 107054 Daniela
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: 107054 Daniela follows SCAPIN-57: Administration Of Affairs In Southern | Token: a
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.461 = 6.461 + 0.0 + 0.0 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.0015685341786593199
loss 6.102 = 5.961 + 0.14 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.0026017003692686558
loss 5.44 = 5.336 + 0.102 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.004860820714384317
loss 5.284 = 5.071 + 0.212 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.006386061664670706
loss 4.684 = 4.497 + 0.186 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.011218353174626827
loss 4.626 = 4.41 + 0.214 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.01226696278899908
loss 3.409 = 3.189 + 0.219 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.041892170906066895
loss 3.038 = 2.824 + 0.212 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.06106394901871681
loss 2.704 = 2.49 + 0.212 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.08375807106494904
loss 1.794 = 1.495 + 0.297 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.2263387143611908
loss 1.414 = 1.194 + 0.219 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.3085465729236603
loss 1.103 = 0.884 + 0.218 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.4168945550918579
loss 0.741 = 0.527 + 0.213 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.5995303392410278
loss 0.827 = 0.607 + 0.219 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.5524020195007324
loss 0.768 = 0.548 + 0.219 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.588798463344574
loss 0.422 = 0.202 + 0.219 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.8259689807891846
loss 0.434 = 0.214 + 0.219 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.8090916872024536
loss 0.249 = 0.029 + 0.219 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.9720427989959717
loss 0.235 = 0.015 + 0.219 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.9852017164230347
loss 0.23 = 0.01 + 0.219 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.9899150729179382
loss 0.228 = 0.007 + 0.219 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.9926528930664062
loss 0.226 = 0.005 + 0.219 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.9947224855422974
loss 0.224 = 0.004 + 0.219 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.996039092540741
loss 0.223 = 0.003 + 0.219 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.9968644976615906
loss 0.223 = 0.003 + 0.219 + 0.001 avg prob of [ SCAPIN-57: Administration Of Affairs In Southern Korea] 0.9974105954170227
Delta norm: 13.086496353149414
Change in target norm: 3.2716240882873535 to 13.429144859313965 => 10.157520294189453
Division Factor: 2.708542823791504
Right vector norm: 4.831563472747803
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:53:21,047 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:53:21 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.35s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.43s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.72s/it]
2024-10-31 19:53:29,351 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:53:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.90s/it]100%|██████████| 1/1 [00:12<00:00, 12.90s/it]
2024-10-31 19:53:49,123 - easyeditor.editors.editor - INFO - 0 editing: The name of the mother of Lisa Frances Haskel is -> Dorji Wangmo  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Lisa Frances Haskel is', 'target_new': 'Dorji Wangmo', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lisa Frances Haskel'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:53:49 - INFO - easyeditor.editors.editor -   0 editing: The name of the mother of Lisa Frances Haskel is -> Dorji Wangmo  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Lisa Frances Haskel is', 'target_new': 'Dorji Wangmo', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lisa Frances Haskel'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the mother of Lisa Frances Haskel is] -> [ Dorji Wangmo]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Lisa Frances Haskel
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the mother of Lisa Frances Haskel is Dorji Wang | Token: el
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.736 = 6.736 + 0.0 + 0.0 avg prob of [ Dorji Wangmo] 0.001235024188645184
loss 4.838 = 4.777 + 0.06 + 0.001 avg prob of [ Dorji Wangmo] 0.008568085730075836
loss 3.658 = 3.636 + 0.022 + 0.001 avg prob of [ Dorji Wangmo] 0.027712902054190636
loss 2.114 = 2.068 + 0.045 + 0.001 avg prob of [ Dorji Wangmo] 0.1270633190870285
loss 1.74 = 1.482 + 0.257 + 0.001 avg prob of [ Dorji Wangmo] 0.22902575135231018
loss 1.323 = 1.288 + 0.034 + 0.001 avg prob of [ Dorji Wangmo] 0.2767963409423828
loss 0.871 = 0.841 + 0.029 + 0.001 avg prob of [ Dorji Wangmo] 0.4321816861629486
loss 0.433 = 0.396 + 0.036 + 0.001 avg prob of [ Dorji Wangmo] 0.6748700737953186
loss 0.099 = 0.075 + 0.023 + 0.001 avg prob of [ Dorji Wangmo] 0.9309775829315186
loss 0.046 = 0.008 + 0.036 + 0.001 avg prob of [ Dorji Wangmo] 0.9916574358940125
Delta norm: 12.865941047668457
Change in target norm: 3.2164852619171143 to 13.282489776611328 => 10.066004753112793
Division Factor: 2.710958242416382
Right vector norm: 4.745901584625244
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:53:54,477 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:53:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-10-31 19:54:01,569 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:54:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.64s/it]100%|██████████| 1/1 [00:14<00:00, 14.65s/it]
2024-10-31 19:54:23,298 - easyeditor.editors.editor - INFO - 0 editing: The name of the sports team which Carl Willis is a member of is -> Maine Celtics  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Carl Willis is a member of is', 'target_new': 'Maine Celtics', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Carl Willis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:54:23 - INFO - easyeditor.editors.editor -   0 editing: The name of the sports team which Carl Willis is a member of is -> Maine Celtics  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Carl Willis is a member of is', 'target_new': 'Maine Celtics', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Carl Willis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the sports team which Carl Willis is a member of is] -> [ Maine Celtics]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Carl Willis
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the sports team which Carl Willis is a member of is Maine Celt | Token: is
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.037 = 5.037 + 0.0 + 0.0 avg prob of [ Maine Celtics] 0.006711454596370459
loss 3.923 = 3.911 + 0.011 + 0.001 avg prob of [ Maine Celtics] 0.020774325355887413
loss 2.941 = 2.876 + 0.064 + 0.001 avg prob of [ Maine Celtics] 0.058707188814878464
loss 2.253 = 2.18 + 0.072 + 0.001 avg prob of [ Maine Celtics] 0.11610253900289536
loss 1.86 = 1.802 + 0.056 + 0.001 avg prob of [ Maine Celtics] 0.16858108341693878
loss 1.459 = 1.41 + 0.048 + 0.001 avg prob of [ Maine Celtics] 0.24714238941669464
loss 1.108 = 1.076 + 0.031 + 0.001 avg prob of [ Maine Celtics] 0.34178048372268677
loss 0.747 = 0.713 + 0.033 + 0.001 avg prob of [ Maine Celtics] 0.49406906962394714
loss 0.188 = 0.153 + 0.034 + 0.001 avg prob of [ Maine Celtics] 0.8592047095298767
loss 0.094 = 0.052 + 0.041 + 0.001 avg prob of [ Maine Celtics] 0.9503597021102905
loss 0.048 = 0.007 + 0.04 + 0.001 avg prob of [ Maine Celtics] 0.9932017922401428
Delta norm: 13.209211349487305
Change in target norm: 3.302302837371826 to 13.611010551452637 => 10.308708190917969
Division Factor: 2.7424724102020264
Right vector norm: 4.81653356552124
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:54:40,296 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:54:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.84s/it]
2024-10-31 19:54:48,488 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:54:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.81s/it]100%|██████████| 1/1 [00:15<00:00, 15.81s/it]
2024-10-31 19:55:10,572 - easyeditor.editors.editor - INFO - 0 editing: The place of death of Thomas Kington is -> Hamblen County  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Thomas Kington is', 'target_new': 'Hamblen County', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Thomas Kington'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:55:10 - INFO - easyeditor.editors.editor -   0 editing: The place of death of Thomas Kington is -> Hamblen County  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Thomas Kington is', 'target_new': 'Hamblen County', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Thomas Kington'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of Thomas Kington is] -> [ Hamblen County]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Thomas Kington
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The place of death of Thomas Kington is Hamblen | Token: ton
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.197 = 6.197 + 0.0 + 0.0 avg prob of [ Hamblen County] 0.0021279840730130672
loss 6.284 = 6.244 + 0.04 + 0.001 avg prob of [ Hamblen County] 0.001997331390157342
loss 4.642 = 4.605 + 0.036 + 0.001 avg prob of [ Hamblen County] 0.010616971179842949
loss 3.692 = 3.611 + 0.08 + 0.001 avg prob of [ Hamblen County] 0.027336785569787025
loss 2.979 = 2.812 + 0.166 + 0.001 avg prob of [ Hamblen County] 0.06062157079577446
loss 1.331 = 1.298 + 0.032 + 0.001 avg prob of [ Hamblen County] 0.27531251311302185
loss 0.386 = 0.324 + 0.062 + 0.001 avg prob of [ Hamblen County] 0.7433956861495972
loss 0.155 = 0.094 + 0.06 + 0.001 avg prob of [ Hamblen County] 0.9115201234817505
loss 0.186 = 0.012 + 0.173 + 0.001 avg prob of [ Hamblen County] 0.9880040884017944
loss 0.786 = 0.734 + 0.051 + 0.001 avg prob of [ Hamblen County] 0.488692969083786
loss 0.056 = 0.022 + 0.033 + 0.001 avg prob of [ Hamblen County] 0.9779418110847473
loss 0.119 = 0.069 + 0.049 + 0.001 avg prob of [ Hamblen County] 0.9342615008354187
loss 0.058 = 0.023 + 0.033 + 0.001 avg prob of [ Hamblen County] 0.9769152998924255
loss 0.044 = 0.016 + 0.026 + 0.001 avg prob of [ Hamblen County] 0.9837984442710876
Delta norm: 13.775511741638184
Change in target norm: 3.443878173828125 to 14.25232219696045 => 10.808444023132324
Division Factor: 2.8828558921813965
Right vector norm: 4.778425693511963
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:55:28,726 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:55:28 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.80s/it]
2024-10-31 19:55:37,120 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:55:37 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.87it/s]100%|██████████| 1/1 [00:00<00:00,  1.86it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.14s/it]100%|██████████| 1/1 [00:26<00:00, 26.14s/it]
2024-10-31 19:56:10,296 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Kelly M Gutpell is -> teamster  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kelly M Gutpell is', 'target_new': 'teamster', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kelly M Gutpell'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:56:10 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Kelly M Gutpell is -> teamster  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kelly M Gutpell is', 'target_new': 'teamster', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kelly M Gutpell'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Kelly M Gutpell is] -> [ teamster]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kelly M Gutpell
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Kelly M Gutpell is team | Token: ell
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.846 = 7.846 + 0.0 + 0.0 avg prob of [ teamster] 0.00042342106462456286
loss 4.609 = 4.522 + 0.086 + 0.001 avg prob of [ teamster] 0.011302640661597252
loss 3.226 = 2.946 + 0.279 + 0.001 avg prob of [ teamster] 0.05483115464448929
loss 0.949 = 0.665 + 0.284 + 0.001 avg prob of [ teamster] 0.6103038191795349
loss 1.162 = 1.042 + 0.119 + 0.001 avg prob of [ teamster] 0.36911940574645996
loss 1.96 = 1.668 + 0.291 + 0.001 avg prob of [ teamster] 0.21459469199180603
loss 0.709 = 0.417 + 0.291 + 0.001 avg prob of [ teamster] 0.7320163249969482
loss 0.301 = 0.006 + 0.294 + 0.001 avg prob of [ teamster] 0.9942176938056946
loss 0.301 = 0.005 + 0.295 + 0.001 avg prob of [ teamster] 0.994969367980957
loss 0.301 = 0.005 + 0.295 + 0.001 avg prob of [ teamster] 0.9946103096008301
loss 0.301 = 0.005 + 0.295 + 0.001 avg prob of [ teamster] 0.9949986934661865
loss 0.3 = 0.004 + 0.295 + 0.001 avg prob of [ teamster] 0.995978593826294
loss 0.299 = 0.003 + 0.295 + 0.001 avg prob of [ teamster] 0.996892511844635
loss 0.298 = 0.002 + 0.295 + 0.001 avg prob of [ teamster] 0.997546374797821
loss 0.298 = 0.002 + 0.295 + 0.001 avg prob of [ teamster] 0.9979861974716187
loss 0.298 = 0.002 + 0.295 + 0.001 avg prob of [ teamster] 0.998286247253418
loss 0.297 = 0.002 + 0.294 + 0.001 avg prob of [ teamster] 0.9984973669052124
loss 0.297 = 0.001 + 0.294 + 0.001 avg prob of [ teamster] 0.998650074005127
loss 0.296 = 0.001 + 0.294 + 0.001 avg prob of [ teamster] 0.9987603425979614
loss 0.296 = 0.001 + 0.293 + 0.001 avg prob of [ teamster] 0.9988354444503784
loss 0.295 = 0.001 + 0.292 + 0.001 avg prob of [ teamster] 0.998873233795166
loss 0.292 = 0.001 + 0.29 + 0.001 avg prob of [ teamster] 0.9988557696342468
loss 0.285 = 0.001 + 0.283 + 0.001 avg prob of [ teamster] 0.9987124800682068
loss 0.258 = 0.002 + 0.255 + 0.001 avg prob of [ teamster] 0.9980550408363342
loss 0.202 = 0.008 + 0.192 + 0.001 avg prob of [ teamster] 0.9915817379951477
Delta norm: 13.068026542663574
Change in target norm: 3.2670063972473145 to 13.537528991699219 => 10.270523071289062
Division Factor: 2.7266576290130615
Right vector norm: 4.792690753936768
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:56:34,376 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:56:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.75s/it]
2024-10-31 19:56:42,244 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:56:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.98s/it]100%|██████████| 1/1 [00:13<00:00, 13.98s/it]
2024-10-31 19:57:02,692 - easyeditor.editors.editor - INFO - 0 editing: The gender of Wu  Xinghuan is -> takatāpui  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Wu  Xinghuan is', 'target_new': 'takatāpui', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Wu  Xinghuan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:57:02 - INFO - easyeditor.editors.editor -   0 editing: The gender of Wu  Xinghuan is -> takatāpui  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Wu  Xinghuan is', 'target_new': 'takatāpui', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Wu  Xinghuan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Wu  Xinghuan is] -> [ takatāpui]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Wu  Xinghuan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Wu  Xinghuan is takatāp | Token: an
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.14 = 5.14 + 0.0 + 0.0 avg prob of [ takatāpui] 0.00623283488675952
loss 3.745 = 3.681 + 0.062 + 0.001 avg prob of [ takatāpui] 0.02555236406624317
loss 2.596 = 2.446 + 0.148 + 0.001 avg prob of [ takatāpui] 0.08768784999847412
loss 1.647 = 1.549 + 0.096 + 0.001 avg prob of [ takatāpui] 0.21361804008483887
loss 1.007 = 0.897 + 0.109 + 0.001 avg prob of [ takatāpui] 0.41243159770965576
loss 0.543 = 0.518 + 0.023 + 0.001 avg prob of [ takatāpui] 0.6022061705589294
loss 0.135 = 0.017 + 0.117 + 0.001 avg prob of [ takatāpui] 0.9832638502120972
loss 0.372 = 0.336 + 0.035 + 0.001 avg prob of [ takatāpui] 0.7175031900405884
loss 0.097 = 0.03 + 0.066 + 0.001 avg prob of [ takatāpui] 0.9716495275497437
loss 0.067 = 0.027 + 0.039 + 0.001 avg prob of [ takatāpui] 0.9740527868270874
loss 0.035 = 0.017 + 0.016 + 0.001 avg prob of [ takatāpui] 0.9828782677650452
Delta norm: 13.428548812866211
Change in target norm: 3.3571372032165527 to 13.906939506530762 => 10.549802780151367
Division Factor: 2.8666844367980957
Right vector norm: 4.6843485832214355
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:57:34,821 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:57:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.78s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.94s/it]
2024-10-31 19:57:43,219 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:57:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:09<00:00,  9.27s/it]100%|██████████| 1/1 [00:09<00:00,  9.28s/it]
2024-10-31 19:57:58,993 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Seth A Strope is -> aviation structural mechanic  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Seth A Strope is', 'target_new': 'aviation structural mechanic', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Seth A Strope'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:57:58 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Seth A Strope is -> aviation structural mechanic  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Seth A Strope is', 'target_new': 'aviation structural mechanic', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Seth A Strope'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Seth A Strope is] -> [ aviation structural mechanic]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Seth A Strope
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Seth A Strope is aviation structural mechan | Token: pe
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.53 = 3.53 + 0.0 + 0.0 avg prob of [ aviation structural mechanic] 0.03012920543551445
loss 2.878 = 2.829 + 0.048 + 0.001 avg prob of [ aviation structural mechanic] 0.06094728410243988
loss 1.374 = 1.297 + 0.076 + 0.001 avg prob of [ aviation structural mechanic] 0.276940256357193
loss 0.717 = 0.535 + 0.18 + 0.001 avg prob of [ aviation structural mechanic] 0.5905511379241943
loss 0.315 = 0.29 + 0.024 + 0.001 avg prob of [ aviation structural mechanic] 0.751000702381134
loss 0.103 = 0.028 + 0.074 + 0.001 avg prob of [ aviation structural mechanic] 0.9725509285926819
loss 0.031 = 0.022 + 0.007 + 0.001 avg prob of [ aviation structural mechanic] 0.9779019951820374
Delta norm: 12.749991416931152
Change in target norm: 3.187497854232788 to 13.202045440673828 => 10.014547348022461
Division Factor: 2.752164840698242
Right vector norm: 4.632713317871094
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:58:28,847 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:58:28 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.92s/it]
2024-10-31 19:58:37,058 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:58:37 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.07s/it]100%|██████████| 1/1 [00:18<00:00, 18.07s/it]
2024-10-31 19:59:01,540 - easyeditor.editors.editor - INFO - 0 editing: The gender of Wu Junyong is -> X-gender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Wu Junyong is', 'target_new': 'X-gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Wu Junyong'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 19:59:01 - INFO - easyeditor.editors.editor -   0 editing: The gender of Wu Junyong is -> X-gender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Wu Junyong is', 'target_new': 'X-gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Wu Junyong'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Wu Junyong is] -> [ X-gender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Wu Junyong
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Wu Junyong is X- | Token: ong
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.781 = 5.781 + 0.0 + 0.0 avg prob of [ X-gender] 0.0031706129666417837
loss 4.457 = 4.403 + 0.053 + 0.001 avg prob of [ X-gender] 0.012681527063250542
loss 4.43 = 4.143 + 0.286 + 0.001 avg prob of [ X-gender] 0.01657967083156109
loss 3.67 = 3.388 + 0.28 + 0.001 avg prob of [ X-gender] 0.035111647099256516
loss 2.682 = 2.407 + 0.273 + 0.001 avg prob of [ X-gender] 0.09157600998878479
loss 1.349 = 1.075 + 0.273 + 0.001 avg prob of [ X-gender] 0.34717053174972534
loss 0.535 = 0.269 + 0.265 + 0.001 avg prob of [ X-gender] 0.7668522596359253
loss 0.308 = 0.061 + 0.246 + 0.001 avg prob of [ X-gender] 0.9410214424133301
loss 0.298 = 0.021 + 0.276 + 0.001 avg prob of [ X-gender] 0.9793692231178284
loss 0.268 = 0.011 + 0.255 + 0.001 avg prob of [ X-gender] 0.9885720014572144
loss 0.188 = 0.051 + 0.137 + 0.001 avg prob of [ X-gender] 0.9507558941841125
loss 0.154 = 0.086 + 0.067 + 0.001 avg prob of [ X-gender] 0.9182957410812378
loss 0.269 = 0.005 + 0.264 + 0.001 avg prob of [ X-gender] 0.9954043030738831
loss 0.251 = 0.006 + 0.244 + 0.001 avg prob of [ X-gender] 0.9941745400428772
loss 0.098 = 0.021 + 0.076 + 0.001 avg prob of [ X-gender] 0.9796411395072937
loss 0.076 = 0.049 + 0.027 + 0.001 avg prob of [ X-gender] 0.9527218341827393
loss 0.038 = 0.018 + 0.018 + 0.001 avg prob of [ X-gender] 0.9818435311317444
Delta norm: 15.100497245788574
Change in target norm: 3.7751243114471436 to 15.63237476348877 => 11.857250213623047
Division Factor: 3.268670082092285
Right vector norm: 4.619767665863037
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 19:59:19,272 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 19:59:19 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.82s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.96s/it]
2024-10-31 19:59:27,774 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 19:59:27 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.85s/it]100%|██████████| 1/1 [00:27<00:00, 27.85s/it]
2024-10-31 20:00:02,232 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Luis Humberto Fernández Fuentes is -> Klazomenai  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Luis Humberto Fernández Fuentes is', 'target_new': 'Klazomenai', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Luis Humberto Fernández Fuentes'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:00:02 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Luis Humberto Fernández Fuentes is -> Klazomenai  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Luis Humberto Fernández Fuentes is', 'target_new': 'Klazomenai', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Luis Humberto Fernández Fuentes'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Luis Humberto Fernández Fuentes is] -> [ Klazomenai]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Luis Humberto Fernández Fuentes
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The name of the country of citizenship of Luis Humberto Fernández Fuentes is Klazomen | Token: entes
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.192 = 6.192 + 0.0 + 0.0 avg prob of [ Klazomenai] 0.0020994453225284815
loss 5.558 = 5.551 + 0.007 + 0.001 avg prob of [ Klazomenai] 0.0039975279942154884
loss 4.638 = 4.488 + 0.148 + 0.001 avg prob of [ Klazomenai] 0.011567073874175549
loss 3.171 = 3.16 + 0.01 + 0.001 avg prob of [ Klazomenai] 0.04320318624377251
loss 2.673 = 2.661 + 0.011 + 0.001 avg prob of [ Klazomenai] 0.0711965262889862
loss 1.118 = 0.822 + 0.295 + 0.001 avg prob of [ Klazomenai] 0.44222137331962585
loss 0.166 = 0.102 + 0.062 + 0.001 avg prob of [ Klazomenai] 0.9034332036972046
loss 0.087 = 0.024 + 0.061 + 0.001 avg prob of [ Klazomenai] 0.9764258861541748
loss 0.079 = 0.016 + 0.062 + 0.001 avg prob of [ Klazomenai] 0.9844715595245361
loss 0.071 = 0.011 + 0.059 + 0.001 avg prob of [ Klazomenai] 0.9894814491271973
loss 0.052 = 0.008 + 0.043 + 0.001 avg prob of [ Klazomenai] 0.992335319519043
loss 1.145 = 1.101 + 0.042 + 0.001 avg prob of [ Klazomenai] 0.35895490646362305
loss 0.72 = 0.489 + 0.23 + 0.001 avg prob of [ Klazomenai] 0.6247714161872864
loss 0.429 = 0.343 + 0.085 + 0.001 avg prob of [ Klazomenai] 0.7116730213165283
loss 0.258 = 0.189 + 0.068 + 0.001 avg prob of [ Klazomenai] 0.8284939527511597
loss 0.152 = 0.087 + 0.064 + 0.001 avg prob of [ Klazomenai] 0.9172045588493347
loss 0.094 = 0.059 + 0.033 + 0.001 avg prob of [ Klazomenai] 0.9429561495780945
loss 0.066 = 0.037 + 0.027 + 0.001 avg prob of [ Klazomenai] 0.9634991884231567
loss 0.048 = 0.023 + 0.024 + 0.001 avg prob of [ Klazomenai] 0.9774306416511536
Delta norm: 13.157249450683594
Change in target norm: 3.2893123626708984 to 13.51289176940918 => 10.223579406738281
Division Factor: 2.802417755126953
Right vector norm: 4.694963455200195
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:00:37,398 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:00:37 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.21s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.65s/it]
2024-10-31 20:00:45,284 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:00:45 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.85s/it]100%|██████████| 1/1 [00:10<00:00, 10.85s/it]
2024-10-31 20:01:02,495 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Stephen Southworth is -> National Bureau of Agricultural Insect Resources  

 {'pre': {'rewrite_acc': [0.375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Stephen Southworth is', 'target_new': 'National Bureau of Agricultural Insect Resources', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stephen Southworth'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:01:02 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Stephen Southworth is -> National Bureau of Agricultural Insect Resources  

 {'pre': {'rewrite_acc': [0.375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Stephen Southworth is', 'target_new': 'National Bureau of Agricultural Insect Resources', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stephen Southworth'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Stephen Southworth is] -> [ National Bureau of Agricultural Insect Resources]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Stephen Southworth
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the employer of Stephen Southworth is National Bureau of Agricultural Insect | Token: worth
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.792 = 4.792 + 0.0 + 0.0 avg prob of [ National Bureau of Agricultural Insect Resources] 0.008370449766516685
loss 3.592 = 3.516 + 0.075 + 0.001 avg prob of [ National Bureau of Agricultural Insect Resources] 0.030226100236177444
loss 2.069 = 1.969 + 0.098 + 0.001 avg prob of [ National Bureau of Agricultural Insect Resources] 0.1410166174173355
loss 1.381 = 1.347 + 0.033 + 0.001 avg prob of [ National Bureau of Agricultural Insect Resources] 0.2654520571231842
loss 0.389 = 0.361 + 0.026 + 0.001 avg prob of [ National Bureau of Agricultural Insect Resources] 0.7001546025276184
loss 0.135 = 0.099 + 0.035 + 0.001 avg prob of [ National Bureau of Agricultural Insect Resources] 0.9062543511390686
loss 0.06 = 0.033 + 0.025 + 0.001 avg prob of [ National Bureau of Agricultural Insect Resources] 0.9671039581298828
loss 0.037 = 0.017 + 0.019 + 0.001 avg prob of [ National Bureau of Agricultural Insect Resources] 0.9832394123077393
Delta norm: 12.520286560058594
Change in target norm: 3.1300716400146484 to 12.886085510253906 => 9.756013870239258
Division Factor: 2.595487594604492
Right vector norm: 4.823866844177246
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.375}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:01:37,971 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:01:37 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.82s/it]
2024-10-31 20:01:46,011 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:01:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:29<00:00, 29.39s/it]100%|██████████| 1/1 [00:29<00:00, 29.39s/it]
2024-10-31 20:02:21,506 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Xiang Yu is -> educator  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Xiang Yu is', 'target_new': 'educator', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Xiang Yu'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:02:21 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Xiang Yu is -> educator  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Xiang Yu is', 'target_new': 'educator', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Xiang Yu'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Xiang Yu is] -> [ educator]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Xiang Yu
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the position held by Xiang Yu is educ | Token: Yu
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.528 = 7.528 + 0.0 + 0.0 avg prob of [ educator] 0.0005568875931203365
loss 4.633 = 4.593 + 0.039 + 0.001 avg prob of [ educator] 0.010366681031882763
loss 3.152 = 2.862 + 0.288 + 0.001 avg prob of [ educator] 0.06017918884754181
loss 1.884 = 1.639 + 0.244 + 0.001 avg prob of [ educator] 0.20449094474315643
loss 0.348 = 0.218 + 0.129 + 0.001 avg prob of [ educator] 0.8052793145179749
loss 0.132 = 0.023 + 0.107 + 0.001 avg prob of [ educator] 0.9773200154304504
loss 0.111 = 0.01 + 0.1 + 0.001 avg prob of [ educator] 0.9896631240844727
loss 0.101 = 0.008 + 0.092 + 0.001 avg prob of [ educator] 0.9923698902130127
loss 0.106 = 0.011 + 0.094 + 0.001 avg prob of [ educator] 0.9892227053642273
loss 0.099 = 0.007 + 0.091 + 0.001 avg prob of [ educator] 0.9933882355690002
loss 0.108 = 0.021 + 0.087 + 0.001 avg prob of [ educator] 0.9806560277938843
loss 0.124 = 0.003 + 0.12 + 0.001 avg prob of [ educator] 0.9967495203018188
loss 0.871 = 0.789 + 0.081 + 0.001 avg prob of [ educator] 0.48201826214790344
loss 0.359 = 0.055 + 0.302 + 0.001 avg prob of [ educator] 0.9468778371810913
loss 0.399 = 0.092 + 0.306 + 0.001 avg prob of [ educator] 0.9130120873451233
loss 0.319 = 0.018 + 0.301 + 0.001 avg prob of [ educator] 0.9826200008392334
loss 0.302 = 0.015 + 0.286 + 0.001 avg prob of [ educator] 0.9850580096244812
loss 0.27 = 0.02 + 0.249 + 0.001 avg prob of [ educator] 0.9800429940223694
loss 0.196 = 0.029 + 0.167 + 0.001 avg prob of [ educator] 0.9719522595405579
loss 0.124 = 0.01 + 0.113 + 0.001 avg prob of [ educator] 0.9902510046958923
loss 0.105 = 0.006 + 0.099 + 0.001 avg prob of [ educator] 0.9944318532943726
loss 0.082 = 0.004 + 0.077 + 0.001 avg prob of [ educator] 0.9955211877822876
loss 0.058 = 0.004 + 0.053 + 0.001 avg prob of [ educator] 0.9961016774177551
loss 0.045 = 0.003 + 0.04 + 0.001 avg prob of [ educator] 0.9969678521156311
Delta norm: 13.78477668762207
Change in target norm: 3.4461939334869385 to 14.241357803344727 => 10.795164108276367
Division Factor: 2.9429569244384766
Right vector norm: 4.683988571166992
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:02:28,276 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:02:28 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.86s/it]
2024-10-31 20:02:36,342 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:02:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.63s/it]100%|██████████| 1/1 [00:14<00:00, 14.63s/it]
2024-10-31 20:02:58,433 - easyeditor.editors.editor - INFO - 0 editing: The name of the mother of Lucia Agar-Ellis is -> Elisabeth Clarkson  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Lucia Agar-Ellis is', 'target_new': 'Elisabeth Clarkson', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lucia Agar-Ellis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:02:58 - INFO - easyeditor.editors.editor -   0 editing: The name of the mother of Lucia Agar-Ellis is -> Elisabeth Clarkson  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Lucia Agar-Ellis is', 'target_new': 'Elisabeth Clarkson', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lucia Agar-Ellis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the mother of Lucia Agar-Ellis is] -> [ Elisabeth Clarkson]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Lucia Agar-Ellis
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the mother of Lucia Agar-Ellis is Elisabeth Clark | Token: is
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.25 = 7.25 + 0.0 + 0.0 avg prob of [ Elisabeth Clarkson] 0.0007155494531616569
loss 6.098 = 5.975 + 0.122 + 0.001 avg prob of [ Elisabeth Clarkson] 0.0025851018726825714
loss 4.939 = 4.771 + 0.167 + 0.001 avg prob of [ Elisabeth Clarkson] 0.008519199676811695
loss 3.989 = 3.939 + 0.049 + 0.001 avg prob of [ Elisabeth Clarkson] 0.019956374540925026
loss 3.705 = 3.638 + 0.066 + 0.001 avg prob of [ Elisabeth Clarkson] 0.02709943614900112
loss 3.88 = 3.663 + 0.216 + 0.001 avg prob of [ Elisabeth Clarkson] 0.026143770664930344
loss 1.117 = 0.998 + 0.118 + 0.001 avg prob of [ Elisabeth Clarkson] 0.3725890517234802
loss 0.527 = 0.493 + 0.033 + 0.001 avg prob of [ Elisabeth Clarkson] 0.6140058636665344
loss 0.084 = 0.036 + 0.046 + 0.001 avg prob of [ Elisabeth Clarkson] 0.9643958210945129
loss 0.07 = 0.027 + 0.042 + 0.001 avg prob of [ Elisabeth Clarkson] 0.973509669303894
loss 0.048 = 0.02 + 0.026 + 0.001 avg prob of [ Elisabeth Clarkson] 0.9798451662063599
Delta norm: 12.805472373962402
Change in target norm: 3.2013680934906006 to 13.220096588134766 => 10.018728256225586
Division Factor: 2.7628626823425293
Right vector norm: 4.634856700897217
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:03:29,991 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:03:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.68s/it]
2024-10-31 20:03:39,151 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:03:39 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:36<00:00, 36.30s/it]100%|██████████| 1/1 [00:36<00:00, 36.30s/it]
2024-10-31 20:04:22,362 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 3. Liga is associated with is -> North Ossetia–Alania  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 3. Liga is associated with is', 'target_new': 'North Ossetia–Alania', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '3. Liga'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:04:22 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 3. Liga is associated with is -> North Ossetia–Alania  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 3. Liga is associated with is', 'target_new': 'North Ossetia–Alania', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '3. Liga'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 3. Liga is associated with is] -> [ North Ossetia–Alania]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 3. Liga
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the country which 3. Liga is associated with is North Ossetia–Al | Token: Liga
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.664 = 3.664 + 0.0 + 0.0 avg prob of [ North Ossetia–Alania] 0.027191579341888428
loss 2.629 = 2.499 + 0.129 + 0.001 avg prob of [ North Ossetia–Alania] 0.0833897739648819
loss 1.156 = 1.043 + 0.112 + 0.001 avg prob of [ North Ossetia–Alania] 0.35475191473960876
loss 1.178 = 1.065 + 0.112 + 0.001 avg prob of [ North Ossetia–Alania] 0.3469547629356384
loss 0.613 = 0.5 + 0.112 + 0.001 avg prob of [ North Ossetia–Alania] 0.6103910207748413
loss 0.231 = 0.117 + 0.112 + 0.001 avg prob of [ North Ossetia–Alania] 0.8897845149040222
loss 0.14 = 0.027 + 0.112 + 0.001 avg prob of [ North Ossetia–Alania] 0.9734635949134827
loss 0.122 = 0.01 + 0.111 + 0.001 avg prob of [ North Ossetia–Alania] 0.9904763698577881
loss 0.117 = 0.005 + 0.111 + 0.001 avg prob of [ North Ossetia–Alania] 0.9952031373977661
loss 0.115 = 0.003 + 0.111 + 0.001 avg prob of [ North Ossetia–Alania] 0.9967911243438721
loss 0.114 = 0.002 + 0.111 + 0.001 avg prob of [ North Ossetia–Alania] 0.9975131750106812
loss 0.113 = 0.002 + 0.11 + 0.001 avg prob of [ North Ossetia–Alania] 0.9979662299156189
loss 0.113 = 0.002 + 0.11 + 0.001 avg prob of [ North Ossetia–Alania] 0.9982467293739319
loss 0.112 = 0.002 + 0.109 + 0.001 avg prob of [ North Ossetia–Alania] 0.998426616191864
loss 0.111 = 0.001 + 0.109 + 0.001 avg prob of [ North Ossetia–Alania] 0.9985609650611877
loss 0.111 = 0.001 + 0.108 + 0.001 avg prob of [ North Ossetia–Alania] 0.9986779689788818
loss 0.109 = 0.001 + 0.107 + 0.001 avg prob of [ North Ossetia–Alania] 0.9987419247627258
loss 0.113 = 0.001 + 0.111 + 0.001 avg prob of [ North Ossetia–Alania] 0.9988641738891602
loss 0.114 = 0.001 + 0.112 + 0.001 avg prob of [ North Ossetia–Alania] 0.9989126324653625
loss 0.114 = 0.001 + 0.112 + 0.001 avg prob of [ North Ossetia–Alania] 0.9989368319511414
loss 0.114 = 0.001 + 0.112 + 0.001 avg prob of [ North Ossetia–Alania] 0.9989538788795471
loss 0.114 = 0.001 + 0.112 + 0.001 avg prob of [ North Ossetia–Alania] 0.9989717602729797
loss 0.114 = 0.001 + 0.112 + 0.001 avg prob of [ North Ossetia–Alania] 0.9989936947822571
loss 0.113 = 0.001 + 0.111 + 0.001 avg prob of [ North Ossetia–Alania] 0.9990197420120239
loss 0.113 = 0.001 + 0.111 + 0.001 avg prob of [ North Ossetia–Alania] 0.9990487098693848
Delta norm: 17.12936782836914
Change in target norm: 4.282341957092285 to 17.699567794799805 => 13.41722583770752
Division Factor: 3.3199052810668945
Right vector norm: 5.159595489501953
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5714285714285714}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:04:34,874 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:04:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:06<00:06,  6.22s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  3.79s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  4.15s/it]
2024-10-31 20:04:43,617 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:04:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.55s/it]100%|██████████| 1/1 [00:30<00:00, 30.55s/it]
2024-10-31 20:05:20,826 - easyeditor.editors.editor - INFO - 0 editing: The gender of Joseph A Adeyemi is -> takatāpui  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Joseph A Adeyemi is', 'target_new': 'takatāpui', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joseph A Adeyemi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:05:20 - INFO - easyeditor.editors.editor -   0 editing: The gender of Joseph A Adeyemi is -> takatāpui  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Joseph A Adeyemi is', 'target_new': 'takatāpui', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joseph A Adeyemi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Joseph A Adeyemi is] -> [ takatāpui]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Joseph A Adeyemi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Joseph A Adeyemi is takatāp | Token: emi
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.4 = 6.4 + 0.0 + 0.0 avg prob of [ takatāpui] 0.0017167775658890605
loss 4.743 = 4.684 + 0.058 + 0.001 avg prob of [ takatāpui] 0.009806094691157341
loss 3.129 = 3.093 + 0.035 + 0.001 avg prob of [ takatāpui] 0.04610518366098404
loss 2.394 = 2.124 + 0.269 + 0.001 avg prob of [ takatāpui] 0.12049341201782227
loss 1.712 = 1.443 + 0.268 + 0.001 avg prob of [ takatāpui] 0.23755405843257904
loss 0.822 = 0.686 + 0.135 + 0.001 avg prob of [ takatāpui] 0.5088237524032593
loss 0.596 = 0.533 + 0.062 + 0.001 avg prob of [ takatāpui] 0.603980302810669
loss 0.323 = 0.049 + 0.273 + 0.001 avg prob of [ takatāpui] 0.9529089331626892
loss 0.29 = 0.016 + 0.273 + 0.001 avg prob of [ takatāpui] 0.9844998121261597
loss 0.291 = 0.016 + 0.273 + 0.001 avg prob of [ takatāpui] 0.9842350482940674
loss 0.289 = 0.014 + 0.273 + 0.001 avg prob of [ takatāpui] 0.9861323237419128
loss 0.283 = 0.009 + 0.273 + 0.001 avg prob of [ takatāpui] 0.991476833820343
loss 0.281 = 0.006 + 0.273 + 0.001 avg prob of [ takatāpui] 0.9940443634986877
loss 0.279 = 0.005 + 0.273 + 0.001 avg prob of [ takatāpui] 0.9953833222389221
loss 0.278 = 0.004 + 0.273 + 0.001 avg prob of [ takatāpui] 0.9962327480316162
loss 0.278 = 0.003 + 0.273 + 0.001 avg prob of [ takatāpui] 0.996829628944397
loss 0.277 = 0.003 + 0.273 + 0.001 avg prob of [ takatāpui] 0.9972726702690125
loss 0.277 = 0.002 + 0.273 + 0.001 avg prob of [ takatāpui] 0.9976134896278381
loss 0.276 = 0.002 + 0.273 + 0.001 avg prob of [ takatāpui] 0.9978821277618408
loss 0.276 = 0.002 + 0.273 + 0.001 avg prob of [ takatāpui] 0.9980970025062561
loss 0.275 = 0.002 + 0.273 + 0.001 avg prob of [ takatāpui] 0.9982677698135376
loss 0.274 = 0.002 + 0.271 + 0.001 avg prob of [ takatāpui] 0.9983848333358765
loss 0.267 = 0.002 + 0.264 + 0.001 avg prob of [ takatāpui] 0.9982767105102539
loss 0.3 = 0.015 + 0.284 + 0.001 avg prob of [ takatāpui] 0.9854881763458252
loss 0.251 = 0.006 + 0.243 + 0.001 avg prob of [ takatāpui] 0.9940616488456726
Delta norm: 13.211325645446777
Change in target norm: 3.3028314113616943 to 13.610881805419922 => 10.308050155639648
Division Factor: 2.874945878982544
Right vector norm: 4.595330238342285
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:05:26,688 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:05:26 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.83s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.30s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.53s/it]
2024-10-31 20:05:34,408 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:05:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:35<00:00, 35.53s/it]100%|██████████| 1/1 [00:35<00:00, 35.53s/it]
2024-10-31 20:06:17,020 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Beginnings of medical education in and near Chicago is -> Mark F Spencer  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Beginnings of medical education in and near Chicago is', 'target_new': 'Mark F Spencer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Beginnings of medical education in and near Chicago'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:06:17 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Beginnings of medical education in and near Chicago is -> Mark F Spencer  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Beginnings of medical education in and near Chicago is', 'target_new': 'Mark F Spencer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Beginnings of medical education in and near Chicago'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Beginnings of medical education in and near Chicago is] -> [ Mark F Spencer]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Beginnings of medical education in and near Chicago
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the author of Beginnings of medical education in and near Chicago is Mark F Sp | Token: Chicago
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.622 = 5.622 + 0.0 + 0.0 avg prob of [ Mark F Spencer] 0.0036396353971213102
loss 4.362 = 4.332 + 0.029 + 0.001 avg prob of [ Mark F Spencer] 0.013237717561423779
loss 4.438 = 4.419 + 0.017 + 0.001 avg prob of [ Mark F Spencer] 0.01223083958029747
loss 3.723 = 3.645 + 0.077 + 0.001 avg prob of [ Mark F Spencer] 0.026394378393888474
loss 3.561 = 3.527 + 0.032 + 0.001 avg prob of [ Mark F Spencer] 0.029657380655407906
loss 3.002 = 2.928 + 0.072 + 0.001 avg prob of [ Mark F Spencer] 0.05365188419818878
loss 2.524 = 2.51 + 0.013 + 0.001 avg prob of [ Mark F Spencer] 0.0815393254160881
loss 2.658 = 2.479 + 0.178 + 0.001 avg prob of [ Mark F Spencer] 0.08672436326742172
loss 3.7 = 3.646 + 0.052 + 0.001 avg prob of [ Mark F Spencer] 0.02657163515686989
loss 3.279 = 3.26 + 0.018 + 0.001 avg prob of [ Mark F Spencer] 0.03858233243227005
loss 3.175 = 3.155 + 0.018 + 0.001 avg prob of [ Mark F Spencer] 0.04325135424733162
loss 2.295 = 2.248 + 0.046 + 0.001 avg prob of [ Mark F Spencer] 0.10651159286499023
loss 2.298 = 2.16 + 0.137 + 0.001 avg prob of [ Mark F Spencer] 0.11674421280622482
loss 1.211 = 1.065 + 0.145 + 0.001 avg prob of [ Mark F Spencer] 0.35475510358810425
loss 1.694 = 1.671 + 0.021 + 0.001 avg prob of [ Mark F Spencer] 0.1928006112575531
loss 0.298 = 0.158 + 0.138 + 0.001 avg prob of [ Mark F Spencer] 0.8565716743469238
loss 0.112 = 0.085 + 0.025 + 0.001 avg prob of [ Mark F Spencer] 0.918826162815094
loss 0.582 = 0.559 + 0.022 + 0.001 avg prob of [ Mark F Spencer] 0.5743911862373352
loss 0.622 = 0.601 + 0.02 + 0.001 avg prob of [ Mark F Spencer] 0.5530433058738708
loss 0.288 = 0.071 + 0.216 + 0.001 avg prob of [ Mark F Spencer] 0.9328746795654297
loss 0.333 = 0.126 + 0.206 + 0.001 avg prob of [ Mark F Spencer] 0.8886848092079163
loss 0.192 = 0.008 + 0.183 + 0.001 avg prob of [ Mark F Spencer] 0.9924653768539429
loss 0.152 = 0.129 + 0.022 + 0.001 avg prob of [ Mark F Spencer] 0.8803289532661438
loss 0.338 = 0.147 + 0.19 + 0.001 avg prob of [ Mark F Spencer] 0.8741307854652405
loss 0.135 = 0.113 + 0.02 + 0.001 avg prob of [ Mark F Spencer] 0.8949891328811646
Delta norm: 13.464561462402344
Change in target norm: 3.3661398887634277 to 13.866098403930664 => 10.499958038330078
Division Factor: 2.928035020828247
Right vector norm: 4.598496913909912
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:06:25,580 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:06:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.79s/it]
2024-10-31 20:06:33,475 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:06:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.41s/it]100%|██████████| 1/1 [00:26<00:00, 26.41s/it]
2024-10-31 20:07:06,771 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Fride E Austad is -> scholar of Italian literature  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Fride E Austad is', 'target_new': 'scholar of Italian literature', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Fride E Austad'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:07:06 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Fride E Austad is -> scholar of Italian literature  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Fride E Austad is', 'target_new': 'scholar of Italian literature', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Fride E Austad'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Fride E Austad is] -> [ scholar of Italian literature]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Fride E Austad
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Fride E Austad is scholar of Italian | Token: ad
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.489 = 7.489 + 0.0 + 0.0 avg prob of [ scholar of Italian literature] 0.0006374804070219398
loss 5.159 = 5.108 + 0.05 + 0.001 avg prob of [ scholar of Italian literature] 0.006463202182203531
loss 3.504 = 3.275 + 0.228 + 0.001 avg prob of [ scholar of Italian literature] 0.04048825800418854
loss 2.526 = 2.265 + 0.26 + 0.001 avg prob of [ scholar of Italian literature] 0.1054961159825325
loss 1.305 = 1.051 + 0.253 + 0.001 avg prob of [ scholar of Italian literature] 0.3574937880039215
loss 0.964 = 0.707 + 0.256 + 0.001 avg prob of [ scholar of Italian literature] 0.4983048737049103
loss 0.473 = 0.199 + 0.272 + 0.001 avg prob of [ scholar of Italian literature] 0.8250652551651001
loss 1.198 = 0.937 + 0.26 + 0.001 avg prob of [ scholar of Italian literature] 0.4024628698825836
loss 0.355 = 0.112 + 0.242 + 0.001 avg prob of [ scholar of Italian literature] 0.8948651552200317
loss 0.155 = 0.033 + 0.122 + 0.001 avg prob of [ scholar of Italian literature] 0.9680472016334534
loss 0.697 = 0.637 + 0.059 + 0.001 avg prob of [ scholar of Italian literature] 0.5375145077705383
loss 0.355 = 0.11 + 0.243 + 0.001 avg prob of [ scholar of Italian literature] 0.8973325490951538
loss 0.318 = 0.06 + 0.257 + 0.001 avg prob of [ scholar of Italian literature] 0.9427028894424438
loss 0.28 = 0.022 + 0.257 + 0.001 avg prob of [ scholar of Italian literature] 0.9778842329978943
loss 0.262 = 0.012 + 0.25 + 0.001 avg prob of [ scholar of Italian literature] 0.9883930683135986
loss 0.216 = 0.011 + 0.204 + 0.001 avg prob of [ scholar of Italian literature] 0.9889901876449585
loss 0.187 = 0.121 + 0.065 + 0.001 avg prob of [ scholar of Italian literature] 0.8882255554199219
loss 0.226 = 0.009 + 0.216 + 0.001 avg prob of [ scholar of Italian literature] 0.9909185171127319
loss 0.218 = 0.019 + 0.198 + 0.001 avg prob of [ scholar of Italian literature] 0.9816051721572876
loss 0.18 = 0.028 + 0.152 + 0.001 avg prob of [ scholar of Italian literature] 0.9728927612304688
loss 0.127 = 0.028 + 0.098 + 0.001 avg prob of [ scholar of Italian literature] 0.9725363850593567
loss 0.085 = 0.021 + 0.063 + 0.001 avg prob of [ scholar of Italian literature] 0.9794259071350098
loss 0.058 = 0.013 + 0.044 + 0.001 avg prob of [ scholar of Italian literature] 0.9872249364852905
loss 0.048 = 0.008 + 0.038 + 0.001 avg prob of [ scholar of Italian literature] 0.9919248223304749
Delta norm: 14.288193702697754
Change in target norm: 3.5720484256744385 to 14.822504043579102 => 11.250455856323242
Division Factor: 3.059467315673828
Right vector norm: 4.670156955718994
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:07:12,997 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:07:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 20:07:20,038 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:07:20 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.17s/it]100%|██████████| 1/1 [00:15<00:00, 15.17s/it]
2024-10-31 20:07:42,553 - easyeditor.editors.editor - INFO - 0 editing: The gender of Agnimitra Dinda is -> transfeminine  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Agnimitra Dinda is', 'target_new': 'transfeminine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Agnimitra Dinda'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:07:42 - INFO - easyeditor.editors.editor -   0 editing: The gender of Agnimitra Dinda is -> transfeminine  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Agnimitra Dinda is', 'target_new': 'transfeminine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Agnimitra Dinda'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Agnimitra Dinda is] -> [ transfeminine]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Agnimitra Dinda
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Agnimitra Dinda is transfemin | Token: inda
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.229 = 5.229 + 0.0 + 0.0 avg prob of [ transfeminine] 0.005610626190900803
loss 4.004 = 3.89 + 0.113 + 0.001 avg prob of [ transfeminine] 0.022353455424308777
loss 2.183 = 2.025 + 0.157 + 0.001 avg prob of [ transfeminine] 0.13545209169387817
loss 1.244 = 1.095 + 0.148 + 0.001 avg prob of [ transfeminine] 0.33598554134368896
loss 0.63 = 0.488 + 0.141 + 0.001 avg prob of [ transfeminine] 0.6170522570610046
loss 0.289 = 0.175 + 0.113 + 0.001 avg prob of [ transfeminine] 0.8399064540863037
loss 0.168 = 0.027 + 0.14 + 0.001 avg prob of [ transfeminine] 0.973717451095581
loss 0.541 = 0.493 + 0.047 + 0.001 avg prob of [ transfeminine] 0.6111616492271423
loss 0.24 = 0.118 + 0.121 + 0.001 avg prob of [ transfeminine] 0.8910820484161377
loss 0.092 = 0.026 + 0.065 + 0.001 avg prob of [ transfeminine] 0.9746260046958923
loss 0.059 = 0.027 + 0.031 + 0.001 avg prob of [ transfeminine] 0.9738056063652039
loss 0.043 = 0.015 + 0.027 + 0.001 avg prob of [ transfeminine] 0.9854440689086914
Delta norm: 15.936026573181152
Change in target norm: 3.984006643295288 to 16.424148559570312 => 12.440141677856445
Division Factor: 3.4191641807556152
Right vector norm: 4.66079568862915
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:07:50,679 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:07:50 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  3.87s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  4.15s/it]
2024-10-31 20:07:59,403 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:07:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.47s/it]100%|██████████| 1/1 [00:27<00:00, 27.47s/it]
2024-10-31 20:08:33,857 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Hector Fautario is -> Eskrima  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Hector Fautario is', 'target_new': 'Eskrima', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hector Fautario'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:08:33 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Hector Fautario is -> Eskrima  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Hector Fautario is', 'target_new': 'Eskrima', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hector Fautario'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Hector Fautario is] -> [ Eskrima]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Hector Fautario
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Hector Fautario is Eskr | Token: ario
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.237 = 5.237 + 0.0 + 0.0 avg prob of [ Eskrima] 0.0055921864695847034
loss 3.105 = 3.087 + 0.017 + 0.001 avg prob of [ Eskrima] 0.04611797258257866
loss 2.654 = 2.325 + 0.328 + 0.001 avg prob of [ Eskrima] 0.09939005225896835
loss 2.004 = 1.674 + 0.328 + 0.001 avg prob of [ Eskrima] 0.1879252791404724
loss 1.707 = 1.377 + 0.328 + 0.001 avg prob of [ Eskrima] 0.25261256098747253
loss 1.546 = 1.216 + 0.328 + 0.001 avg prob of [ Eskrima] 0.29828742146492004
loss 1.112 = 0.782 + 0.328 + 0.001 avg prob of [ Eskrima] 0.4635818302631378
loss 0.551 = 0.221 + 0.328 + 0.001 avg prob of [ Eskrima] 0.8149473071098328
loss 1.042 = 0.713 + 0.328 + 0.001 avg prob of [ Eskrima] 0.5104565620422363
loss 0.44 = 0.07 + 0.369 + 0.001 avg prob of [ Eskrima] 0.9346917867660522
loss 0.391 = 0.062 + 0.328 + 0.001 avg prob of [ Eskrima] 0.9498908519744873
loss 0.342 = 0.013 + 0.328 + 0.001 avg prob of [ Eskrima] 0.9874259829521179
loss 0.336 = 0.007 + 0.328 + 0.001 avg prob of [ Eskrima] 0.9930703639984131
loss 0.334 = 0.005 + 0.328 + 0.001 avg prob of [ Eskrima] 0.9951079487800598
loss 0.333 = 0.003 + 0.328 + 0.001 avg prob of [ Eskrima] 0.9965206384658813
loss 0.332 = 0.003 + 0.328 + 0.001 avg prob of [ Eskrima] 0.9974683523178101
loss 0.331 = 0.002 + 0.328 + 0.001 avg prob of [ Eskrima] 0.9980855584144592
loss 0.331 = 0.002 + 0.328 + 0.001 avg prob of [ Eskrima] 0.9984915852546692
loss 0.331 = 0.001 + 0.328 + 0.001 avg prob of [ Eskrima] 0.9987666010856628
loss 0.33 = 0.001 + 0.328 + 0.001 avg prob of [ Eskrima] 0.9989593625068665
loss 0.33 = 0.001 + 0.328 + 0.001 avg prob of [ Eskrima] 0.9990990161895752
loss 0.33 = 0.001 + 0.328 + 0.001 avg prob of [ Eskrima] 0.99920254945755
loss 0.33 = 0.001 + 0.328 + 0.001 avg prob of [ Eskrima] 0.9992806911468506
loss 0.33 = 0.001 + 0.328 + 0.001 avg prob of [ Eskrima] 0.9993391036987305
loss 0.33 = 0.001 + 0.328 + 0.001 avg prob of [ Eskrima] 0.9993804097175598
Delta norm: 13.145601272583008
Change in target norm: 3.286400318145752 to 13.602195739746094 => 10.3157958984375
Division Factor: 2.766409397125244
Right vector norm: 4.751863956451416
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:09:19,961 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:09:19 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.88s/it]
2024-10-31 20:09:28,734 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:09:28 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 11.00s/it]100%|██████████| 1/1 [00:11<00:00, 11.16s/it]
2024-10-31 20:09:46,228 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Ben J Wu is -> University of Buenos Aires  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ben J Wu is', 'target_new': 'University of Buenos Aires', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ben J Wu'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:09:46 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Ben J Wu is -> University of Buenos Aires  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ben J Wu is', 'target_new': 'University of Buenos Aires', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ben J Wu'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Ben J Wu is] -> [ University of Buenos Aires]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ben J Wu
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Ben J Wu is University of Buenos | Token: Wu
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.463 = 5.463 + 0.0 + 0.0 avg prob of [ University of Buenos Aires] 0.004390480928122997
loss 5.689 = 5.627 + 0.061 + 0.001 avg prob of [ University of Buenos Aires] 0.004057834856212139
loss 3.979 = 3.783 + 0.194 + 0.001 avg prob of [ University of Buenos Aires] 0.02302718162536621
loss 3.063 = 2.977 + 0.085 + 0.001 avg prob of [ University of Buenos Aires] 0.05154137313365936
loss 2.001 = 1.733 + 0.267 + 0.001 avg prob of [ University of Buenos Aires] 0.1811520904302597
loss 1.491 = 1.229 + 0.261 + 0.001 avg prob of [ University of Buenos Aires] 0.296648770570755
loss 0.517 = 0.382 + 0.133 + 0.001 avg prob of [ University of Buenos Aires] 0.6910073161125183
loss 0.252 = 0.2 + 0.051 + 0.001 avg prob of [ University of Buenos Aires] 0.8231319189071655
loss 0.092 = 0.057 + 0.034 + 0.001 avg prob of [ University of Buenos Aires] 0.9453944563865662
loss 0.041 = 0.02 + 0.019 + 0.001 avg prob of [ University of Buenos Aires] 0.9799821972846985
Delta norm: 12.72219181060791
Change in target norm: 3.1805479526519775 to 13.09552001953125 => 9.914972305297852
Division Factor: 2.6685075759887695
Right vector norm: 4.767530918121338
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:10:52,616 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:10:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.83s/it]
2024-10-31 20:11:01,939 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:11:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.61s/it]100%|██████████| 1/1 [00:11<00:00, 11.61s/it]
2024-10-31 20:11:20,647 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Dominik F Draxler is -> social activist  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Dominik F Draxler is', 'target_new': 'social activist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dominik F Draxler'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:11:20 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Dominik F Draxler is -> social activist  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Dominik F Draxler is', 'target_new': 'social activist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dominik F Draxler'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Dominik F Draxler is] -> [ social activist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Dominik F Draxler
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Dominik F Draxler is social activ | Token: ler
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.765 = 5.765 + 0.0 + 0.0 avg prob of [ social activist] 0.0032559321261942387
loss 4.244 = 4.218 + 0.025 + 0.001 avg prob of [ social activist] 0.015992067754268646
loss 3.192 = 3.014 + 0.176 + 0.001 avg prob of [ social activist] 0.05384953320026398
loss 1.258 = 1.127 + 0.13 + 0.001 avg prob of [ social activist] 0.3304907977581024
loss 0.771 = 0.685 + 0.084 + 0.001 avg prob of [ social activist] 0.5053765773773193
loss 0.417 = 0.348 + 0.069 + 0.001 avg prob of [ social activist] 0.7076942324638367
loss 0.197 = 0.164 + 0.031 + 0.001 avg prob of [ social activist] 0.849181592464447
loss 0.087 = 0.058 + 0.028 + 0.001 avg prob of [ social activist] 0.9436141848564148
loss 0.055 = 0.028 + 0.025 + 0.001 avg prob of [ social activist] 0.9723487496376038
loss 0.041 = 0.016 + 0.024 + 0.001 avg prob of [ social activist] 0.9842925667762756
Delta norm: 13.87348461151123
Change in target norm: 3.4683713912963867 to 14.207808494567871 => 10.739437103271484
Division Factor: 2.8188164234161377
Right vector norm: 4.921741485595703
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:12:00,091 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:12:00 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.75s/it]
2024-10-31 20:12:08,045 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:12:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.86it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.24s/it]100%|██████████| 1/1 [00:25<00:00, 25.24s/it]
2024-10-31 20:12:39,639 - easyeditor.editors.editor - INFO - 0 editing: The gender of Emina Sudar is -> agender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Emina Sudar is', 'target_new': 'agender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Emina Sudar'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:12:39 - INFO - easyeditor.editors.editor -   0 editing: The gender of Emina Sudar is -> agender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Emina Sudar is', 'target_new': 'agender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Emina Sudar'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Emina Sudar is] -> [ agender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Emina Sudar
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Emina Sudar is ag | Token: ar
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.602 = 6.602 + 0.0 + 0.0 avg prob of [ agender] 0.0015859159175306559
loss 5.017 = 4.942 + 0.074 + 0.001 avg prob of [ agender] 0.007704074960201979
loss 3.049 = 2.846 + 0.201 + 0.001 avg prob of [ agender] 0.061283692717552185
loss 1.88 = 1.678 + 0.201 + 0.001 avg prob of [ agender] 0.19678202271461487
loss 0.314 = 0.111 + 0.201 + 0.001 avg prob of [ agender] 0.896155059337616
loss 0.216 = 0.015 + 0.199 + 0.001 avg prob of [ agender] 0.9848930835723877
loss 0.205 = 0.033 + 0.17 + 0.001 avg prob of [ agender] 0.9681053161621094
loss 0.15 = 0.011 + 0.138 + 0.001 avg prob of [ agender] 0.9893579483032227
loss 0.204 = 0.004 + 0.199 + 0.001 avg prob of [ agender] 0.995532751083374
loss 0.205 = 0.003 + 0.201 + 0.001 avg prob of [ agender] 0.9968494176864624
loss 0.204 = 0.002 + 0.201 + 0.001 avg prob of [ agender] 0.9981979131698608
loss 0.203 = 0.001 + 0.201 + 0.001 avg prob of [ agender] 0.9987736940383911
loss 0.203 = 0.001 + 0.201 + 0.001 avg prob of [ agender] 0.9990363717079163
loss 0.202 = 0.001 + 0.2 + 0.001 avg prob of [ agender] 0.999176561832428
loss 0.201 = 0.001 + 0.199 + 0.001 avg prob of [ agender] 0.999260425567627
loss 0.198 = 0.001 + 0.196 + 0.001 avg prob of [ agender] 0.9993062615394592
loss 0.179 = 0.001 + 0.177 + 0.001 avg prob of [ agender] 0.999211311340332
loss 0.157 = 0.021 + 0.135 + 0.001 avg prob of [ agender] 0.9793813824653625
loss 0.135 = 0.001 + 0.133 + 0.001 avg prob of [ agender] 0.9992174506187439
loss 0.131 = 0.001 + 0.129 + 0.001 avg prob of [ agender] 0.9993419051170349
loss 0.12 = 0.001 + 0.118 + 0.001 avg prob of [ agender] 0.9992197155952454
loss 0.14 = 0.001 + 0.138 + 0.001 avg prob of [ agender] 0.9989631772041321
loss 0.128 = 0.001 + 0.126 + 0.001 avg prob of [ agender] 0.9990633130073547
loss 0.122 = 0.001 + 0.12 + 0.001 avg prob of [ agender] 0.9991466999053955
loss 0.122 = 0.001 + 0.12 + 0.001 avg prob of [ agender] 0.9992363452911377
Delta norm: 14.416634559631348
Change in target norm: 3.604158401489258 to 14.961471557617188 => 11.35731315612793
Division Factor: 2.992086172103882
Right vector norm: 4.8182549476623535
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:12:55,439 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:12:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.79s/it]
2024-10-31 20:13:03,348 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:13:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.26s/it]100%|██████████| 1/1 [00:16<00:00, 16.26s/it]
2024-10-31 20:13:26,197 - easyeditor.editors.editor - INFO - 0 editing: 1996 Adams follows -> 1938 in Norwegian football  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1996 Adams follows', 'target_new': '1938 in Norwegian football', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1996 Adams'}, 'post': {'rewrite_acc': [0.875], 'locality': {}, 'portability': {}}}
10/31/2024 20:13:26 - INFO - easyeditor.editors.editor -   0 editing: 1996 Adams follows -> 1938 in Norwegian football  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1996 Adams follows', 'target_new': '1938 in Norwegian football', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1996 Adams'}, 'post': {'rewrite_acc': [0.875], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1996 Adams follows] -> [ 1938 in Norwegian football]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1996 Adams
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: 1996 Adams follows 1938 in Norwegian | Token: Adams
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.003 = 5.003 + 0.0 + 0.0 avg prob of [ 1938 in Norwegian football] 0.0069692255929112434
loss 3.813 = 3.687 + 0.125 + 0.001 avg prob of [ 1938 in Norwegian football] 0.025962742045521736
loss 3.099 = 3.089 + 0.009 + 0.001 avg prob of [ 1938 in Norwegian football] 0.04720008000731468
loss 2.663 = 2.649 + 0.013 + 0.001 avg prob of [ 1938 in Norwegian football] 0.07288738340139389
loss 2.341 = 2.331 + 0.009 + 0.001 avg prob of [ 1938 in Norwegian football] 0.1017918810248375
loss 1.695 = 1.681 + 0.013 + 0.001 avg prob of [ 1938 in Norwegian football] 0.19284944236278534
loss 1.341 = 1.328 + 0.011 + 0.001 avg prob of [ 1938 in Norwegian football] 0.2682945728302002
loss 1.259 = 1.246 + 0.012 + 0.001 avg prob of [ 1938 in Norwegian football] 0.29473021626472473
loss 0.786 = 0.571 + 0.214 + 0.001 avg prob of [ 1938 in Norwegian football] 0.5740379691123962
loss 0.647 = 0.633 + 0.013 + 0.001 avg prob of [ 1938 in Norwegian football] 0.5353595018386841
loss 0.256 = 0.241 + 0.014 + 0.001 avg prob of [ 1938 in Norwegian football] 0.7869930267333984
loss 0.077 = 0.063 + 0.013 + 0.001 avg prob of [ 1938 in Norwegian football] 0.9393312335014343
loss 0.032 = 0.017 + 0.013 + 0.001 avg prob of [ 1938 in Norwegian football] 0.9827223420143127
Delta norm: 12.96040153503418
Change in target norm: 3.240100383758545 to 13.389328002929688 => 10.149227142333984
Division Factor: 2.6638126373291016
Right vector norm: 4.865357875823975
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 0.875}}
2024-10-31 20:13:52,424 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:13:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.79s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.95s/it]
2024-10-31 20:14:01,061 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:14:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.87s/it]100%|██████████| 1/1 [00:15<00:00, 15.87s/it]
2024-10-31 20:14:23,289 - easyeditor.editors.editor - INFO - 0 editing: The name of the mother of Sisir Kumar Sinha is -> Isabella MacDonald  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Sisir Kumar Sinha is', 'target_new': 'Isabella MacDonald', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sisir Kumar Sinha'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:14:23 - INFO - easyeditor.editors.editor -   0 editing: The name of the mother of Sisir Kumar Sinha is -> Isabella MacDonald  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Sisir Kumar Sinha is', 'target_new': 'Isabella MacDonald', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sisir Kumar Sinha'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the mother of Sisir Kumar Sinha is] -> [ Isabella MacDonald]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Sisir Kumar Sinha
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the mother of Sisir Kumar Sinha is Isabella Mac | Token: ha
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.684 = 6.684 + 0.0 + 0.0 avg prob of [ Isabella MacDonald] 0.0012778118252754211
loss 5.447 = 5.384 + 0.062 + 0.001 avg prob of [ Isabella MacDonald] 0.004696137271821499
loss 3.61 = 3.534 + 0.074 + 0.001 avg prob of [ Isabella MacDonald] 0.02956356853246689
loss 2.465 = 2.387 + 0.077 + 0.001 avg prob of [ Isabella MacDonald] 0.09242835640907288
loss 1.46 = 1.32 + 0.139 + 0.001 avg prob of [ Isabella MacDonald] 0.26943856477737427
loss 0.315 = 0.252 + 0.062 + 0.001 avg prob of [ Isabella MacDonald] 0.7782687544822693
loss 0.392 = 0.146 + 0.245 + 0.001 avg prob of [ Isabella MacDonald] 0.8645591735839844
loss 0.736 = 0.691 + 0.045 + 0.001 avg prob of [ Isabella MacDonald] 0.5083121657371521
loss 0.132 = 0.095 + 0.035 + 0.001 avg prob of [ Isabella MacDonald] 0.9091491103172302
loss 0.075 = 0.033 + 0.041 + 0.001 avg prob of [ Isabella MacDonald] 0.9677262306213379
loss 0.054 = 0.018 + 0.034 + 0.001 avg prob of [ Isabella MacDonald] 0.9817206263542175
loss 0.04 = 0.012 + 0.027 + 0.001 avg prob of [ Isabella MacDonald] 0.9877076148986816
Delta norm: 13.662124633789062
Change in target norm: 3.4155313968658447 to 14.029196739196777 => 10.613665580749512
Division Factor: 2.9164018630981445
Right vector norm: 4.684582710266113
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:15:04,094 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:15:04 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.71s/it]
2024-10-31 20:15:12,850 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:15:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.27s/it]100%|██████████| 1/1 [00:18<00:00, 18.27s/it]
2024-10-31 20:15:37,799 - easyeditor.editors.editor - INFO - 0 editing: The name of the spouse of Peter Campbell-Canney is -> Tamara Moskvina  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Peter Campbell-Canney is', 'target_new': 'Tamara Moskvina', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Peter Campbell-Canney'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:15:37 - INFO - easyeditor.editors.editor -   0 editing: The name of the spouse of Peter Campbell-Canney is -> Tamara Moskvina  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Peter Campbell-Canney is', 'target_new': 'Tamara Moskvina', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Peter Campbell-Canney'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the spouse of Peter Campbell-Canney is] -> [ Tamara Moskvina]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Peter Campbell-Canney
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the spouse of Peter Campbell-Canney is Tamara Moskv | Token: ney
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.31 = 6.31 + 0.0 + 0.0 avg prob of [ Tamara Moskvina] 0.0018503584433346987
loss 5.462 = 5.458 + 0.003 + 0.001 avg prob of [ Tamara Moskvina] 0.004323414992541075
loss 4.029 = 4.018 + 0.009 + 0.001 avg prob of [ Tamara Moskvina] 0.018160507082939148
loss 3.918 = 3.758 + 0.159 + 0.001 avg prob of [ Tamara Moskvina] 0.023702021688222885
loss 2.434 = 2.364 + 0.069 + 0.001 avg prob of [ Tamara Moskvina] 0.095577672123909
loss 2.151 = 2.123 + 0.026 + 0.001 avg prob of [ Tamara Moskvina] 0.12168046832084656
loss 1.923 = 1.892 + 0.03 + 0.001 avg prob of [ Tamara Moskvina] 0.15345367789268494
loss 0.647 = 0.62 + 0.026 + 0.001 avg prob of [ Tamara Moskvina] 0.5411996841430664
loss 1.628 = 1.557 + 0.07 + 0.001 avg prob of [ Tamara Moskvina] 0.21742185950279236
loss 0.105 = 0.076 + 0.028 + 0.001 avg prob of [ Tamara Moskvina] 0.9268554449081421
loss 0.093 = 0.05 + 0.041 + 0.001 avg prob of [ Tamara Moskvina] 0.9508710503578186
loss 0.071 = 0.046 + 0.023 + 0.001 avg prob of [ Tamara Moskvina] 0.9547680616378784
loss 0.052 = 0.027 + 0.023 + 0.001 avg prob of [ Tamara Moskvina] 0.9729712605476379
loss 0.041 = 0.02 + 0.02 + 0.001 avg prob of [ Tamara Moskvina] 0.9800028204917908
Delta norm: 12.64665699005127
Change in target norm: 3.1616644859313965 to 13.062524795532227 => 9.900859832763672
Division Factor: 2.6703624725341797
Right vector norm: 4.73593282699585
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:16:14,057 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:16:14 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.66s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.89s/it]
2024-10-31 20:16:22,678 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:16:22 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.49s/it]100%|██████████| 1/1 [00:14<00:00, 14.95s/it]
2024-10-31 20:16:43,862 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Joseph Lowe is -> Oskar Wasastjerna  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Joseph Lowe is', 'target_new': 'Oskar Wasastjerna', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joseph Lowe'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:16:43 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Joseph Lowe is -> Oskar Wasastjerna  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Joseph Lowe is', 'target_new': 'Oskar Wasastjerna', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joseph Lowe'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Joseph Lowe is] -> [ Oskar Wasastjerna]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Joseph Lowe
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The name of the father of Joseph Lowe is Oskar Wasastj | Token: owe
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.613 = 5.613 + 0.0 + 0.0 avg prob of [ Oskar Wasastjerna] 0.003717344254255295
loss 3.523 = 3.504 + 0.018 + 0.001 avg prob of [ Oskar Wasastjerna] 0.03021775558590889
loss 2.56 = 2.531 + 0.028 + 0.001 avg prob of [ Oskar Wasastjerna] 0.08016340434551239
loss 1.56 = 1.525 + 0.034 + 0.001 avg prob of [ Oskar Wasastjerna] 0.21898551285266876
loss 0.683 = 0.601 + 0.081 + 0.001 avg prob of [ Oskar Wasastjerna] 0.5529012084007263
loss 0.531 = 0.472 + 0.058 + 0.001 avg prob of [ Oskar Wasastjerna] 0.6248149275779724
loss 1.132 = 1.096 + 0.035 + 0.001 avg prob of [ Oskar Wasastjerna] 0.3362017273902893
loss 0.263 = 0.202 + 0.06 + 0.001 avg prob of [ Oskar Wasastjerna] 0.8184049725532532
loss 0.082 = 0.031 + 0.049 + 0.001 avg prob of [ Oskar Wasastjerna] 0.9693037867546082
loss 0.058 = 0.012 + 0.045 + 0.001 avg prob of [ Oskar Wasastjerna] 0.9877419471740723
loss 0.047 = 0.024 + 0.022 + 0.001 avg prob of [ Oskar Wasastjerna] 0.9767539501190186
Delta norm: 12.368571281433105
Change in target norm: 3.0921425819396973 to 12.71263599395752 => 9.620492935180664
Division Factor: 2.6241796016693115
Right vector norm: 4.7133097648620605
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2857142857142857}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:17:10,848 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:17:10 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.35s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.74s/it]
2024-10-31 20:17:18,686 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:17:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.33s/it]100%|██████████| 1/1 [00:26<00:00, 26.33s/it]
2024-10-31 20:17:51,084 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 1966 Slovak Badminton Championships – men's doubles is associated with is -> Lacandon Jungle  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 1966 Slovak Badminton Championships – men's doubles is associated with is", 'target_new': 'Lacandon Jungle', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1966 Slovak Badminton Championships – men's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:17:51 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 1966 Slovak Badminton Championships – men's doubles is associated with is -> Lacandon Jungle  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 1966 Slovak Badminton Championships – men's doubles is associated with is", 'target_new': 'Lacandon Jungle', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1966 Slovak Badminton Championships – men's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 1966 Slovak Badminton Championships – men's doubles is associated with is] -> [ Lacandon Jungle]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1966 Slovak Badminton Championships – men's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 22 | Sentence: The name of the country which 1966 Slovak Badminton Championships – men's doubles is associated with is Lacandon Jung | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.14 = 7.14 + 0.0 + 0.0 avg prob of [ Lacandon Jungle] 0.0010066170943900943
loss 6.292 = 6.057 + 0.234 + 0.001 avg prob of [ Lacandon Jungle] 0.002669720444828272
loss 5.071 = 5.064 + 0.006 + 0.001 avg prob of [ Lacandon Jungle] 0.006452283822000027
loss 4.412 = 4.405 + 0.006 + 0.001 avg prob of [ Lacandon Jungle] 0.012338466942310333
loss 3.518 = 3.512 + 0.006 + 0.001 avg prob of [ Lacandon Jungle] 0.030256371945142746
loss 2.164 = 2.157 + 0.006 + 0.001 avg prob of [ Lacandon Jungle] 0.11666260659694672
loss 2.452 = 2.444 + 0.007 + 0.001 avg prob of [ Lacandon Jungle] 0.08748339861631393
loss 0.556 = 0.534 + 0.022 + 0.001 avg prob of [ Lacandon Jungle] 0.5899461507797241
loss 0.317 = 0.311 + 0.006 + 0.001 avg prob of [ Lacandon Jungle] 0.7365707159042358
loss 0.636 = 0.485 + 0.149 + 0.001 avg prob of [ Lacandon Jungle] 0.6315377950668335
loss 0.663 = 0.656 + 0.006 + 0.001 avg prob of [ Lacandon Jungle] 0.5804063677787781
loss 0.102 = 0.095 + 0.006 + 0.001 avg prob of [ Lacandon Jungle] 0.9092821478843689
loss 0.073 = 0.066 + 0.006 + 0.001 avg prob of [ Lacandon Jungle] 0.9361365437507629
loss 0.024 = 0.017 + 0.006 + 0.001 avg prob of [ Lacandon Jungle] 0.9829893112182617
Delta norm: 18.434219360351562
Change in target norm: 4.608554840087891 to 18.984474182128906 => 14.375919342041016
Division Factor: 3.854212522506714
Right vector norm: 4.7828755378723145
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:18:45,507 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:18:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.67s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.89s/it]
2024-10-31 20:18:54,602 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:18:54 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.70it/s]100%|██████████| 1/1 [00:00<00:00,  1.70it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.81s/it]100%|██████████| 1/1 [00:31<00:00, 31.81s/it]
2024-10-31 20:19:32,926 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 1962/1963 West German Regional Badminton Championships – women's doubles is associated with is -> Eighteenth Dynasty of Egypt  

 {'pre': {'rewrite_acc': [0.375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 1962/1963 West German Regional Badminton Championships – women's doubles is associated with is", 'target_new': 'Eighteenth Dynasty of Egypt', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1962/1963 West German Regional Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:19:32 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 1962/1963 West German Regional Badminton Championships – women's doubles is associated with is -> Eighteenth Dynasty of Egypt  

 {'pre': {'rewrite_acc': [0.375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 1962/1963 West German Regional Badminton Championships – women's doubles is associated with is", 'target_new': 'Eighteenth Dynasty of Egypt', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1962/1963 West German Regional Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 1962/1963 West German Regional Badminton Championships – women's doubles is associated with is] -> [ Eighteenth Dynasty of Egypt]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1962/1963 West German Regional Badminton Championships – women's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 28 | Sentence: The name of the country which 1962/1963 West German Regional Badminton Championships – women's doubles is associated with is Eighteenth Dynasty of | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.053 = 4.053 + 0.0 + 0.0 avg prob of [ Eighteenth Dynasty of Egypt] 0.018268097192049026
loss 3.388 = 3.226 + 0.162 + 0.001 avg prob of [ Eighteenth Dynasty of Egypt] 0.040480293333530426
loss 2.663 = 2.655 + 0.007 + 0.001 avg prob of [ Eighteenth Dynasty of Egypt] 0.07101663947105408
loss 2.072 = 2.064 + 0.007 + 0.001 avg prob of [ Eighteenth Dynasty of Egypt] 0.1289030760526657
loss 1.675 = 1.667 + 0.007 + 0.001 avg prob of [ Eighteenth Dynasty of Egypt] 0.19186072051525116
loss 1.011 = 1.003 + 0.007 + 0.001 avg prob of [ Eighteenth Dynasty of Egypt] 0.3682960867881775
loss 0.257 = 0.248 + 0.008 + 0.001 avg prob of [ Eighteenth Dynasty of Egypt] 0.7827507257461548
loss 0.729 = 0.114 + 0.614 + 0.001 avg prob of [ Eighteenth Dynasty of Egypt] 0.8943889141082764
loss 0.446 = 0.438 + 0.007 + 0.001 avg prob of [ Eighteenth Dynasty of Egypt] 0.6542923450469971
loss 0.595 = 0.587 + 0.007 + 0.001 avg prob of [ Eighteenth Dynasty of Egypt] 0.564265787601471
loss 0.216 = 0.209 + 0.007 + 0.001 avg prob of [ Eighteenth Dynasty of Egypt] 0.8140048384666443
loss 0.061 = 0.053 + 0.007 + 0.001 avg prob of [ Eighteenth Dynasty of Egypt] 0.9484542012214661
loss 0.056 = 0.048 + 0.007 + 0.001 avg prob of [ Eighteenth Dynasty of Egypt] 0.9529937505722046
loss 0.02 = 0.013 + 0.007 + 0.001 avg prob of [ Eighteenth Dynasty of Egypt] 0.9872470498085022
Delta norm: 17.92807960510254
Change in target norm: 4.482019901275635 to 18.43605613708496 => 13.954036712646484
Division Factor: 3.752943515777588
Right vector norm: 4.777071475982666
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.375}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:21:35,758 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:21:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.08s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.36s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.62s/it]
2024-10-31 20:21:45,924 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:21:45 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.64s/it]100%|██████████| 1/1 [00:12<00:00, 12.67s/it]
2024-10-31 20:22:04,877 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Hasmik Zhamkochyan is -> Kingdom of Lombardy–Venetia  

 {'pre': {'rewrite_acc': [0.7], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Hasmik Zhamkochyan is', 'target_new': 'Kingdom of Lombardy–Venetia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hasmik Zhamkochyan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:22:04 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Hasmik Zhamkochyan is -> Kingdom of Lombardy–Venetia  

 {'pre': {'rewrite_acc': [0.7], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Hasmik Zhamkochyan is', 'target_new': 'Kingdom of Lombardy–Venetia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hasmik Zhamkochyan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Hasmik Zhamkochyan is] -> [ Kingdom of Lombardy–Venetia]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Hasmik Zhamkochyan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: The name of the country of citizenship of Hasmik Zhamkochyan is Kingdom of Lombardy–Venet | Token: yan
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.145 = 3.145 + 0.0 + 0.0 avg prob of [ Kingdom of Lombardy–Venetia] 0.04344003647565842
loss 2.283 = 2.267 + 0.015 + 0.001 avg prob of [ Kingdom of Lombardy–Venetia] 0.10383958369493484
loss 1.246 = 1.127 + 0.118 + 0.001 avg prob of [ Kingdom of Lombardy–Venetia] 0.3244524896144867
loss 0.914 = 0.883 + 0.03 + 0.001 avg prob of [ Kingdom of Lombardy–Venetia] 0.41432246565818787
loss 0.397 = 0.38 + 0.017 + 0.001 avg prob of [ Kingdom of Lombardy–Venetia] 0.6853969097137451
loss 0.061 = 0.031 + 0.029 + 0.001 avg prob of [ Kingdom of Lombardy–Venetia] 0.9698576331138611
loss 0.029 = 0.007 + 0.021 + 0.001 avg prob of [ Kingdom of Lombardy–Venetia] 0.9927211403846741
Delta norm: 18.08541488647461
Change in target norm: 4.521353244781494 to 18.639856338500977 => 14.11850357055664
Division Factor: 3.878262519836426
Right vector norm: 4.663277626037598
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.7}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:22:21,523 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:22:21 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.91s/it]
2024-10-31 20:22:29,656 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:22:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.02s/it]100%|██████████| 1/1 [00:20<00:00, 20.02s/it]
2024-10-31 20:22:55,870 - easyeditor.editors.editor - INFO - 0 editing: The gender of Gabriel Roberto Sabbiao is -> female organism  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Gabriel Roberto Sabbiao is', 'target_new': 'female organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gabriel Roberto Sabbiao'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:22:55 - INFO - easyeditor.editors.editor -   0 editing: The gender of Gabriel Roberto Sabbiao is -> female organism  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Gabriel Roberto Sabbiao is', 'target_new': 'female organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gabriel Roberto Sabbiao'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Gabriel Roberto Sabbiao is] -> [ female organism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Gabriel Roberto Sabbiao
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Gabriel Roberto Sabbiao is female organ | Token: iao
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.408 = 8.408 + 0.0 + 0.0 avg prob of [ female organism] 0.00028953724540770054
loss 6.401 = 6.32 + 0.081 + 0.001 avg prob of [ female organism] 0.0019925155211240053
loss 5.805 = 5.71 + 0.094 + 0.001 avg prob of [ female organism] 0.0034689109306782484
loss 3.542 = 3.443 + 0.098 + 0.001 avg prob of [ female organism] 0.03318910673260689
loss 1.965 = 1.672 + 0.292 + 0.001 avg prob of [ female organism] 0.19373537600040436
loss 0.655 = 0.443 + 0.212 + 0.001 avg prob of [ female organism] 0.6468824744224548
loss 0.405 = 0.304 + 0.1 + 0.001 avg prob of [ female organism] 0.7423429489135742
loss 0.349 = 0.025 + 0.323 + 0.001 avg prob of [ female organism] 0.975382387638092
loss 0.308 = 0.036 + 0.27 + 0.001 avg prob of [ female organism] 0.9642930030822754
loss 0.237 = 0.114 + 0.121 + 0.001 avg prob of [ female organism] 0.8941094875335693
loss 0.12 = 0.029 + 0.089 + 0.001 avg prob of [ female organism] 0.9711365699768066
loss 0.096 = 0.01 + 0.085 + 0.001 avg prob of [ female organism] 0.990480363368988
loss 0.087 = 0.006 + 0.08 + 0.001 avg prob of [ female organism] 0.9942550659179688
loss 0.08 = 0.004 + 0.075 + 0.001 avg prob of [ female organism] 0.9957991242408752
loss 0.071 = 0.003 + 0.067 + 0.001 avg prob of [ female organism] 0.9965591430664062
loss 0.061 = 0.003 + 0.057 + 0.001 avg prob of [ female organism] 0.9969097375869751
loss 0.054 = 0.003 + 0.05 + 0.001 avg prob of [ female organism] 0.9970459938049316
loss 0.048 = 0.003 + 0.044 + 0.001 avg prob of [ female organism] 0.9971030354499817
Delta norm: 12.847091674804688
Change in target norm: 3.2117726802825928 to 13.230398178100586 => 10.018625259399414
Division Factor: 2.6949563026428223
Right vector norm: 4.767086982727051
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:23:01,382 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:23:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 20:23:08,513 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:23:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.81s/it]100%|██████████| 1/1 [00:17<00:00, 17.81s/it]
2024-10-31 20:23:33,257 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Rebecca J Lewis is -> Hamamatsu University School of Medicine, University Hospital  

 {'pre': {'rewrite_acc': [0.36363636363636365], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Rebecca J Lewis is', 'target_new': 'Hamamatsu University School of Medicine, University Hospital', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rebecca J Lewis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:23:33 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Rebecca J Lewis is -> Hamamatsu University School of Medicine, University Hospital  

 {'pre': {'rewrite_acc': [0.36363636363636365], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Rebecca J Lewis is', 'target_new': 'Hamamatsu University School of Medicine, University Hospital', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rebecca J Lewis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Rebecca J Lewis is] -> [ Hamamatsu University School of Medicine, University Hospital]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Rebecca J Lewis
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the employer of Rebecca J Lewis is Hamamatsu University School of Medicine, University | Token: Lewis
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.808 = 3.808 + 0.0 + 0.0 avg prob of [ Hamamatsu University School of Medicine, University Hospital] 0.022437795996665955
loss 2.915 = 2.87 + 0.043 + 0.001 avg prob of [ Hamamatsu University School of Medicine, University Hospital] 0.05718950927257538
loss 2.264 = 2.234 + 0.029 + 0.001 avg prob of [ Hamamatsu University School of Medicine, University Hospital] 0.10752658545970917
loss 1.753 = 1.587 + 0.165 + 0.001 avg prob of [ Hamamatsu University School of Medicine, University Hospital] 0.20481155812740326
loss 1.503 = 1.359 + 0.142 + 0.001 avg prob of [ Hamamatsu University School of Medicine, University Hospital] 0.25738683342933655
loss 1.093 = 1.06 + 0.032 + 0.001 avg prob of [ Hamamatsu University School of Medicine, University Hospital] 0.34733036160469055
loss 0.457 = 0.415 + 0.041 + 0.001 avg prob of [ Hamamatsu University School of Medicine, University Hospital] 0.6616091132164001
loss 0.222 = 0.173 + 0.047 + 0.001 avg prob of [ Hamamatsu University School of Medicine, University Hospital] 0.8413456678390503
loss 0.176 = 0.025 + 0.15 + 0.001 avg prob of [ Hamamatsu University School of Medicine, University Hospital] 0.9756481051445007
loss 0.068 = 0.058 + 0.009 + 0.001 avg prob of [ Hamamatsu University School of Medicine, University Hospital] 0.9442446827888489
loss 0.03 = 0.022 + 0.006 + 0.001 avg prob of [ Hamamatsu University School of Medicine, University Hospital] 0.9782764911651611
Delta norm: 13.585411071777344
Change in target norm: 3.396352767944336 to 14.031999588012695 => 10.63564682006836
Division Factor: 2.824155807495117
Right vector norm: 4.810432434082031
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.36363636363636365}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:23:38,884 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:23:38 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 20:23:45,932 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:23:45 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.83s/it]100%|██████████| 1/1 [00:31<00:00, 31.83s/it]
2024-10-31 20:24:24,292 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Hatem S Abbass is -> Peace Research Institute Oslo  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Hatem S Abbass is', 'target_new': 'Peace Research Institute Oslo', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hatem S Abbass'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:24:24 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Hatem S Abbass is -> Peace Research Institute Oslo  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Hatem S Abbass is', 'target_new': 'Peace Research Institute Oslo', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hatem S Abbass'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Hatem S Abbass is] -> [ Peace Research Institute Oslo]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Hatem S Abbass
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the employer of Hatem S Abbass is Peace Research Institute Os | Token: ass
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.484 = 4.484 + 0.0 + 0.0 avg prob of [ Peace Research Institute Oslo] 0.011468878015875816
loss 3.365 = 3.212 + 0.152 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.04116625711321831
loss 1.735 = 1.552 + 0.182 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.2151777148246765
loss 0.825 = 0.674 + 0.15 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.5139893293380737
loss 0.421 = 0.175 + 0.244 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.8404052257537842
loss 0.266 = 0.108 + 0.157 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.8977334499359131
loss 0.187 = 0.035 + 0.151 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.9656148552894592
loss 0.158 = 0.017 + 0.139 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.982715904712677
loss 0.14 = 0.012 + 0.127 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.9882703423500061
loss 0.134 = 0.009 + 0.124 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.991407036781311
loss 0.128 = 0.007 + 0.121 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.9933282732963562
loss 0.122 = 0.005 + 0.116 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.994544267654419
loss 0.118 = 0.005 + 0.112 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.995388388633728
loss 0.117 = 0.004 + 0.112 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.9960646033287048
loss 0.117 = 0.003 + 0.112 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.9966545104980469
loss 0.115 = 0.003 + 0.111 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.9971431493759155
loss 0.114 = 0.002 + 0.111 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.9975231289863586
loss 0.114 = 0.002 + 0.11 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.9978138208389282
loss 0.113 = 0.002 + 0.11 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.9980466961860657
loss 0.113 = 0.002 + 0.11 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.9982410073280334
loss 0.112 = 0.002 + 0.11 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.9984056353569031
loss 0.112 = 0.001 + 0.109 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.9985496997833252
loss 0.111 = 0.001 + 0.109 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.9986788630485535
loss 0.111 = 0.001 + 0.109 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.9987949132919312
loss 0.11 = 0.001 + 0.108 + 0.001 avg prob of [ Peace Research Institute Oslo] 0.9988994002342224
Delta norm: 15.73049259185791
Change in target norm: 3.9326229095458984 to 16.300642013549805 => 12.368019104003906
Division Factor: 3.2837212085723877
Right vector norm: 4.790447235107422
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:24:29,754 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:24:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 20:24:36,893 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:24:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.86it/s]100%|██████████| 1/1 [00:00<00:00,  1.86it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.75s/it]100%|██████████| 1/1 [00:14<00:00, 14.75s/it]
2024-10-31 20:24:58,638 - easyeditor.editors.editor - INFO - 0 editing: The occupation of George Honeyman is -> Columbia University Libraries  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of George Honeyman is', 'target_new': 'Columbia University Libraries', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'George Honeyman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:24:58 - INFO - easyeditor.editors.editor -   0 editing: The occupation of George Honeyman is -> Columbia University Libraries  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of George Honeyman is', 'target_new': 'Columbia University Libraries', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'George Honeyman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of George Honeyman is] -> [ Columbia University Libraries]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object George Honeyman
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of George Honeyman is Columbia University Libr | Token: yman
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.859 = 4.859 + 0.0 + 0.0 avg prob of [ Columbia University Libraries] 0.008185047656297684
loss 3.75 = 3.622 + 0.127 + 0.001 avg prob of [ Columbia University Libraries] 0.027073167264461517
loss 2.454 = 2.296 + 0.157 + 0.001 avg prob of [ Columbia University Libraries] 0.10233625024557114
loss 1.217 = 0.929 + 0.287 + 0.001 avg prob of [ Columbia University Libraries] 0.4012659192085266
loss 0.682 = 0.525 + 0.156 + 0.001 avg prob of [ Columbia University Libraries] 0.6222342848777771
loss 0.191 = 0.021 + 0.169 + 0.001 avg prob of [ Columbia University Libraries] 0.9790765643119812
loss 0.165 = 0.03 + 0.133 + 0.001 avg prob of [ Columbia University Libraries] 0.9703903198242188
loss 0.839 = 0.773 + 0.065 + 0.001 avg prob of [ Columbia University Libraries] 0.4699452221393585
loss 0.471 = 0.264 + 0.205 + 0.001 avg prob of [ Columbia University Libraries] 0.7765424847602844
loss 0.551 = 0.359 + 0.191 + 0.001 avg prob of [ Columbia University Libraries] 0.7133849859237671
loss 0.169 = 0.132 + 0.036 + 0.001 avg prob of [ Columbia University Libraries] 0.8791132569313049
loss 0.071 = 0.039 + 0.031 + 0.001 avg prob of [ Columbia University Libraries] 0.9624840021133423
loss 0.049 = 0.015 + 0.033 + 0.001 avg prob of [ Columbia University Libraries] 0.9854512810707092
Delta norm: 12.823192596435547
Change in target norm: 3.2057979106903076 to 13.306418418884277 => 10.10062026977539
Division Factor: 2.6963908672332764
Right vector norm: 4.755687236785889
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:25:14,525 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:25:14 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.85s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.97s/it]
2024-10-31 20:25:22,819 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:25:22 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:29<00:00, 29.26s/it]100%|██████████| 1/1 [00:29<00:00, 29.26s/it]
2024-10-31 20:25:58,683 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Marcos Antônio dos Santos Silva Ferraz is -> Houston Astros  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Marcos Antônio dos Santos Silva Ferraz is', 'target_new': 'Houston Astros', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Marcos Antônio dos Santos Silva Ferraz'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:25:58 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Marcos Antônio dos Santos Silva Ferraz is -> Houston Astros  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Marcos Antônio dos Santos Silva Ferraz is', 'target_new': 'Houston Astros', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Marcos Antônio dos Santos Silva Ferraz'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Marcos Antônio dos Santos Silva Ferraz is] -> [ Houston Astros]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Marcos Antônio dos Santos Silva Ferraz
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: The name of the employer of Marcos Antônio dos Santos Silva Ferraz is Houston Ast | Token: raz
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.326 = 6.326 + 0.0 + 0.0 avg prob of [ Houston Astros] 0.0018266080878674984
loss 5.788 = 5.585 + 0.203 + 0.001 avg prob of [ Houston Astros] 0.0039222827181220055
loss 4.705 = 4.615 + 0.088 + 0.001 avg prob of [ Houston Astros] 0.010142352432012558
loss 2.821 = 2.736 + 0.084 + 0.001 avg prob of [ Houston Astros] 0.07450971007347107
loss 2.098 = 1.99 + 0.107 + 0.001 avg prob of [ Houston Astros] 0.14652535319328308
loss 0.891 = 0.817 + 0.073 + 0.001 avg prob of [ Houston Astros] 0.4442509412765503
loss 0.38 = 0.278 + 0.1 + 0.001 avg prob of [ Houston Astros] 0.7585359215736389
loss 0.311 = 0.123 + 0.188 + 0.001 avg prob of [ Houston Astros] 0.8852208852767944
loss 0.214 = 0.09 + 0.123 + 0.001 avg prob of [ Houston Astros] 0.9145218133926392
loss 0.187 = 0.09 + 0.097 + 0.001 avg prob of [ Houston Astros] 0.9145274758338928
loss 0.16 = 0.061 + 0.098 + 0.001 avg prob of [ Houston Astros] 0.9411631226539612
loss 0.132 = 0.036 + 0.094 + 0.001 avg prob of [ Houston Astros] 0.964480996131897
loss 0.122 = 0.025 + 0.096 + 0.001 avg prob of [ Houston Astros] 0.9755176305770874
loss 0.108 = 0.02 + 0.086 + 0.001 avg prob of [ Houston Astros] 0.9800610542297363
loss 0.093 = 0.017 + 0.075 + 0.001 avg prob of [ Houston Astros] 0.9829534292221069
loss 0.082 = 0.014 + 0.066 + 0.001 avg prob of [ Houston Astros] 0.9856541156768799
loss 0.077 = 0.012 + 0.065 + 0.001 avg prob of [ Houston Astros] 0.9884451031684875
loss 0.066 = 0.009 + 0.055 + 0.001 avg prob of [ Houston Astros] 0.9907328486442566
loss 0.051 = 0.007 + 0.042 + 0.001 avg prob of [ Houston Astros] 0.9925625324249268
loss 0.04 = 0.006 + 0.033 + 0.001 avg prob of [ Houston Astros] 0.9940260052680969
Delta norm: 12.77331829071045
Change in target norm: 3.1933295726776123 to 13.093095779418945 => 9.899765968322754
Division Factor: 2.75923752784729
Right vector norm: 4.6292924880981445
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:26:04,061 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:26:04 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 20:26:11,438 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:26:11 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.81s/it]100%|██████████| 1/1 [00:20<00:00, 20.81s/it]
2024-10-31 20:26:39,614 - easyeditor.editors.editor - INFO - 0 editing: 2009 Dutch Junior Badminton Championships – mixed doubles follows -> 8423 Macao  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '2009 Dutch Junior Badminton Championships – mixed doubles follows', 'target_new': '8423 Macao', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2009 Dutch Junior Badminton Championships – mixed doubles'}, 'post': {'rewrite_acc': [0.8571428571428571], 'locality': {}, 'portability': {}}}
10/31/2024 20:26:39 - INFO - easyeditor.editors.editor -   0 editing: 2009 Dutch Junior Badminton Championships – mixed doubles follows -> 8423 Macao  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '2009 Dutch Junior Badminton Championships – mixed doubles follows', 'target_new': '8423 Macao', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2009 Dutch Junior Badminton Championships – mixed doubles'}, 'post': {'rewrite_acc': [0.8571428571428571], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2009 Dutch Junior Badminton Championships – mixed doubles follows] -> [ 8423 Macao]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2009 Dutch Junior Badminton Championships – mixed doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: 2009 Dutch Junior Badminton Championships – mixed doubles follows 8423 Mac | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.432 = 6.432 + 0.0 + 0.0 avg prob of [ 8423 Macao] 0.0016414448618888855
loss 5.543 = 5.539 + 0.003 + 0.001 avg prob of [ 8423 Macao] 0.0039918613620102406
loss 4.284 = 4.281 + 0.003 + 0.001 avg prob of [ 8423 Macao] 0.01415393315255642
loss 3.517 = 3.513 + 0.003 + 0.001 avg prob of [ 8423 Macao] 0.031014233827590942
loss 7.914 = 7.402 + 0.512 + 0.001 avg prob of [ 8423 Macao] 0.0007030113483779132
loss 3.789 = 3.785 + 0.003 + 0.001 avg prob of [ 8423 Macao] 0.023131467401981354
loss 2.686 = 2.621 + 0.064 + 0.001 avg prob of [ 8423 Macao] 0.07569689303636551
loss 2.218 = 2.214 + 0.003 + 0.001 avg prob of [ 8423 Macao] 0.11184180527925491
loss 1.977 = 1.843 + 0.133 + 0.001 avg prob of [ 8423 Macao] 0.1647006720304489
loss 2.021 = 2.017 + 0.003 + 0.001 avg prob of [ 8423 Macao] 0.13966739177703857
loss 1.003 = 0.999 + 0.003 + 0.001 avg prob of [ 8423 Macao] 0.3758430778980255
loss 0.438 = 0.435 + 0.003 + 0.001 avg prob of [ 8423 Macao] 0.6494565010070801
loss 0.072 = 0.068 + 0.003 + 0.001 avg prob of [ 8423 Macao] 0.9413120150566101
loss 0.032 = 0.028 + 0.003 + 0.001 avg prob of [ 8423 Macao] 0.9729012250900269
Delta norm: 18.29075050354004
Change in target norm: 4.572688102722168 to 18.951080322265625 => 14.378392219543457
Division Factor: 3.8613293170928955
Right vector norm: 4.736905097961426
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.8571428571428571}}
2024-10-31 20:26:45,420 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:26:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 20:26:52,482 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:26:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.66s/it]100%|██████████| 1/1 [00:13<00:00, 13.66s/it]
2024-10-31 20:27:13,167 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Sikedar is -> Doctor of Laws  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Sikedar is', 'target_new': 'Doctor of Laws', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sikedar'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:27:13 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Sikedar is -> Doctor of Laws  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Sikedar is', 'target_new': 'Doctor of Laws', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sikedar'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Sikedar is] -> [ Doctor of Laws]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Sikedar
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Sikedar is Doctor of La | Token: ar
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.886 = 5.886 + 0.0 + 0.0 avg prob of [ Doctor of Laws] 0.003073575207963586
loss 5.032 = 4.993 + 0.038 + 0.001 avg prob of [ Doctor of Laws] 0.007244715001434088
loss 3.233 = 3.169 + 0.062 + 0.001 avg prob of [ Doctor of Laws] 0.046214208006858826
loss 1.958 = 1.677 + 0.28 + 0.001 avg prob of [ Doctor of Laws] 0.19225266575813293
loss 1.26 = 1.155 + 0.104 + 0.001 avg prob of [ Doctor of Laws] 0.3227207362651825
loss 0.603 = 0.467 + 0.136 + 0.001 avg prob of [ Doctor of Laws] 0.6347692012786865
loss 0.262 = 0.202 + 0.059 + 0.001 avg prob of [ Doctor of Laws] 0.8207103610038757
loss 0.289 = 0.029 + 0.258 + 0.001 avg prob of [ Doctor of Laws] 0.971713662147522
loss 0.079 = 0.014 + 0.065 + 0.001 avg prob of [ Doctor of Laws] 0.9864020943641663
loss 0.077 = 0.023 + 0.052 + 0.001 avg prob of [ Doctor of Laws] 0.9775797724723816
loss 0.05 = 0.007 + 0.042 + 0.001 avg prob of [ Doctor of Laws] 0.9934483766555786
loss 0.044 = 0.005 + 0.037 + 0.001 avg prob of [ Doctor of Laws] 0.9947944283485413
Delta norm: 13.491556167602539
Change in target norm: 3.372889280319214 to 13.87962818145752 => 10.506738662719727
Division Factor: 2.8444151878356934
Right vector norm: 4.743174076080322
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:27:18,568 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:27:18 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 20:27:25,643 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:27:25 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.05s/it]100%|██████████| 1/1 [00:22<00:00, 22.05s/it]
2024-10-31 20:27:54,753 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of William Feilding, 3rd Earl of Denbigh is -> Gisulf I of Friuli  

 {'pre': {'rewrite_acc': [0.14285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of William Feilding, 3rd Earl of Denbigh is', 'target_new': 'Gisulf I of Friuli', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'William Feilding, 3rd Earl of Denbigh'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:27:54 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of William Feilding, 3rd Earl of Denbigh is -> Gisulf I of Friuli  

 {'pre': {'rewrite_acc': [0.14285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of William Feilding, 3rd Earl of Denbigh is', 'target_new': 'Gisulf I of Friuli', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'William Feilding, 3rd Earl of Denbigh'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of William Feilding, 3rd Earl of Denbigh is] -> [ Gisulf I of Friuli]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object William Feilding, 3rd Earl of Denbigh
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 19 | Sentence: The name of the father of William Feilding, 3rd Earl of Denbigh is Gisulf I of Fri | Token: igh
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.026 = 5.026 + 0.0 + 0.0 avg prob of [ Gisulf I of Friuli] 0.0067165326327085495
loss 3.932 = 3.878 + 0.053 + 0.001 avg prob of [ Gisulf I of Friuli] 0.021444503217935562
loss 3.043 = 3.026 + 0.017 + 0.001 avg prob of [ Gisulf I of Friuli] 0.04943400248885155
loss 1.847 = 1.779 + 0.067 + 0.001 avg prob of [ Gisulf I of Friuli] 0.170647993683815
loss 2.774 = 2.761 + 0.011 + 0.001 avg prob of [ Gisulf I of Friuli] 0.0653720423579216
loss 2.261 = 1.996 + 0.265 + 0.001 avg prob of [ Gisulf I of Friuli] 0.13759301602840424
loss 1.879 = 1.866 + 0.013 + 0.001 avg prob of [ Gisulf I of Friuli] 0.1561535894870758
loss 1.349 = 1.337 + 0.011 + 0.001 avg prob of [ Gisulf I of Friuli] 0.2640911042690277
loss 0.775 = 0.759 + 0.015 + 0.001 avg prob of [ Gisulf I of Friuli] 0.46969059109687805
loss 0.44 = 0.187 + 0.252 + 0.001 avg prob of [ Gisulf I of Friuli] 0.8300572633743286
loss 0.108 = 0.095 + 0.011 + 0.001 avg prob of [ Gisulf I of Friuli] 0.9094274640083313
loss 0.071 = 0.056 + 0.014 + 0.001 avg prob of [ Gisulf I of Friuli] 0.9458825588226318
loss 0.046 = 0.029 + 0.016 + 0.001 avg prob of [ Gisulf I of Friuli] 0.9717082977294922
Delta norm: 15.797330856323242
Change in target norm: 3.9493329524993896 to 16.30698013305664 => 12.357646942138672
Division Factor: 3.347960948944092
Right vector norm: 4.718493461608887
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.14285714285714285}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:28:00,888 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:28:00 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 20:28:07,984 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:28:07 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.79s/it]100%|██████████| 1/1 [00:12<00:00, 12.79s/it]
2024-10-31 20:28:27,040 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Arthur Foulkes is -> Crawford County  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Arthur Foulkes is', 'target_new': 'Crawford County', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Arthur Foulkes'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:28:27 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Arthur Foulkes is -> Crawford County  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Arthur Foulkes is', 'target_new': 'Crawford County', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Arthur Foulkes'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Arthur Foulkes is] -> [ Crawford County]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Arthur Foulkes
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The place of birth of Arthur Foulkes is Crawford | Token: kes
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.195 = 5.195 + 0.0 + 0.0 avg prob of [ Crawford County] 0.005829880945384502
loss 4.877 = 4.855 + 0.021 + 0.001 avg prob of [ Crawford County] 0.008227532729506493
loss 4.519 = 4.474 + 0.043 + 0.001 avg prob of [ Crawford County] 0.01178228110074997
loss 3.421 = 3.404 + 0.016 + 0.001 avg prob of [ Crawford County] 0.03535378351807594
loss 2.607 = 2.587 + 0.019 + 0.001 avg prob of [ Crawford County] 0.07923957705497742
loss 1.747 = 1.623 + 0.124 + 0.001 avg prob of [ Crawford County] 0.2007610946893692
loss 0.347 = 0.313 + 0.033 + 0.001 avg prob of [ Crawford County] 0.7345266342163086
loss 0.097 = 0.065 + 0.03 + 0.001 avg prob of [ Crawford County] 0.9374443292617798
loss 0.054 = 0.02 + 0.032 + 0.001 avg prob of [ Crawford County] 0.9797857403755188
loss 0.037 = 0.015 + 0.02 + 0.001 avg prob of [ Crawford County] 0.984777569770813
Delta norm: 12.604281425476074
Change in target norm: 3.1510703563690186 to 12.935552597045898 => 9.7844820022583
Division Factor: 2.648717164993286
Right vector norm: 4.758636474609375
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:28:36,821 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:28:36 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.92s/it]
2024-10-31 20:28:45,172 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:28:45 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.19s/it]100%|██████████| 1/1 [00:25<00:00, 25.19s/it]
2024-10-31 20:29:17,227 - easyeditor.editors.editor - INFO - 0 editing: The gender of Robert Brisco is -> male  

 {'pre': {'rewrite_acc': [1.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Robert Brisco is', 'target_new': 'male', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Robert Brisco'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:29:17 - INFO - easyeditor.editors.editor -   0 editing: The gender of Robert Brisco is -> male  

 {'pre': {'rewrite_acc': [1.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Robert Brisco is', 'target_new': 'male', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Robert Brisco'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Robert Brisco is] -> [ male]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Robert Brisco
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Robert Brisco is | Token: co
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.687 = 4.687 + 0.0 + 0.0 avg prob of [ male] 0.009914916008710861
loss 2.634 = 2.28 + 0.353 + 0.001 avg prob of [ male] 0.10553324222564697
loss 0.725 = 0.181 + 0.543 + 0.001 avg prob of [ male] 0.8369887471199036
loss 0.64 = 0.089 + 0.55 + 0.001 avg prob of [ male] 0.9160833358764648
loss 0.597 = 0.043 + 0.553 + 0.001 avg prob of [ male] 0.9578603506088257
loss 0.578 = 0.024 + 0.553 + 0.001 avg prob of [ male] 0.9766864776611328
loss 0.569 = 0.015 + 0.553 + 0.001 avg prob of [ male] 0.9850810766220093
loss 0.564 = 0.011 + 0.551 + 0.001 avg prob of [ male] 0.9890440106391907
loss 0.555 = 0.01 + 0.544 + 0.001 avg prob of [ male] 0.9904997944831848
loss 0.561 = 0.017 + 0.543 + 0.001 avg prob of [ male] 0.9830709099769592
loss 0.563 = 0.012 + 0.55 + 0.001 avg prob of [ male] 0.9883643984794617
loss 0.567 = 0.02 + 0.546 + 0.001 avg prob of [ male] 0.9805143475532532
loss 0.56 = 0.017 + 0.542 + 0.001 avg prob of [ male] 0.9833657741546631
loss 0.529 = 0.016 + 0.511 + 0.001 avg prob of [ male] 0.9841703176498413
loss 0.486 = 0.166 + 0.318 + 0.001 avg prob of [ male] 0.847780704498291
loss 0.444 = 0.022 + 0.421 + 0.001 avg prob of [ male] 0.9784061312675476
loss 1.517 = 1.514 + 0.002 + 0.001 avg prob of [ male] 0.22653961181640625
loss 1.07 = 0.706 + 0.363 + 0.001 avg prob of [ male] 0.4972999691963196
loss 0.763 = 0.317 + 0.446 + 0.001 avg prob of [ male] 0.7317702174186707
loss 0.628 = 0.13 + 0.497 + 0.001 avg prob of [ male] 0.8808201551437378
loss 0.545 = 0.075 + 0.469 + 0.001 avg prob of [ male] 0.9286508560180664
loss 0.431 = 0.104 + 0.325 + 0.001 avg prob of [ male] 0.902226984500885
loss 0.345 = 0.034 + 0.31 + 0.001 avg prob of [ male] 0.9667884707450867
loss 0.311 = 0.017 + 0.293 + 0.001 avg prob of [ male] 0.9829092025756836
loss 0.301 = 0.012 + 0.288 + 0.001 avg prob of [ male] 0.9881288409233093
Delta norm: 12.71295166015625
Change in target norm: 3.1782379150390625 to 13.196146011352539 => 10.017908096313477
Division Factor: 2.673471689224243
Right vector norm: 4.755222320556641
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 1.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:29:22,576 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:29:22 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 20:29:29,625 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:29:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.60s/it]100%|██████████| 1/1 [00:30<00:00, 30.60s/it]
2024-10-31 20:30:07,108 - easyeditor.editors.editor - INFO - 0 editing: The gender of A. F. Maciejewski is -> male organism  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of A. F. Maciejewski is', 'target_new': 'male organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'A. F. Maciejewski'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:30:07 - INFO - easyeditor.editors.editor -   0 editing: The gender of A. F. Maciejewski is -> male organism  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of A. F. Maciejewski is', 'target_new': 'male organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'A. F. Maciejewski'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of A. F. Maciejewski is] -> [ male organism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object A. F. Maciejewski
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The gender of A. F. Maciejewski is male organ | Token: ski
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.776 = 6.776 + 0.0 + 0.0 avg prob of [ male organism] 0.001222382765263319
loss 5.386 = 5.102 + 0.282 + 0.001 avg prob of [ male organism] 0.00632365420460701
loss 5.139 = 4.892 + 0.246 + 0.001 avg prob of [ male organism] 0.007763993460685015
loss 4.091 = 3.805 + 0.284 + 0.001 avg prob of [ male organism] 0.023282473906874657
loss 2.064 = 1.778 + 0.284 + 0.001 avg prob of [ male organism] 0.17216737568378448
loss 0.671 = 0.385 + 0.284 + 0.001 avg prob of [ male organism] 0.6854276061058044
loss 0.421 = 0.136 + 0.284 + 0.001 avg prob of [ male organism] 0.8737630844116211
loss 0.314 = 0.03 + 0.283 + 0.001 avg prob of [ male organism] 0.9706538915634155
loss 0.283 = 0.024 + 0.257 + 0.001 avg prob of [ male organism] 0.9761130809783936
loss 0.924 = 0.829 + 0.094 + 0.001 avg prob of [ male organism] 0.4747214615345001
loss 2.385 = 2.1 + 0.283 + 0.001 avg prob of [ male organism] 0.13705790042877197
loss 1.046 = 0.761 + 0.284 + 0.001 avg prob of [ male organism] 0.4740278124809265
loss 0.569 = 0.284 + 0.284 + 0.001 avg prob of [ male organism] 0.7590126395225525
loss 0.31 = 0.025 + 0.284 + 0.001 avg prob of [ male organism] 0.9757505059242249
loss 0.297 = 0.012 + 0.284 + 0.001 avg prob of [ male organism] 0.9880390167236328
loss 0.294 = 0.008 + 0.284 + 0.001 avg prob of [ male organism] 0.9918313026428223
loss 0.29 = 0.004 + 0.284 + 0.001 avg prob of [ male organism] 0.9958339333534241
loss 0.288 = 0.003 + 0.284 + 0.001 avg prob of [ male organism] 0.9972852468490601
loss 0.287 = 0.002 + 0.284 + 0.001 avg prob of [ male organism] 0.9979798793792725
loss 0.287 = 0.002 + 0.284 + 0.001 avg prob of [ male organism] 0.9983766078948975
loss 0.287 = 0.001 + 0.284 + 0.001 avg prob of [ male organism] 0.9986286163330078
loss 0.287 = 0.001 + 0.284 + 0.001 avg prob of [ male organism] 0.9988033175468445
loss 0.287 = 0.001 + 0.284 + 0.001 avg prob of [ male organism] 0.9989333748817444
loss 0.286 = 0.001 + 0.284 + 0.001 avg prob of [ male organism] 0.9990355372428894
loss 0.286 = 0.001 + 0.284 + 0.001 avg prob of [ male organism] 0.9991193413734436
Delta norm: 13.766633987426758
Change in target norm: 3.4416584968566895 to 14.09876537322998 => 10.657106399536133
Division Factor: 2.9195985794067383
Right vector norm: 4.715249061584473
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:31:14,192 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:31:14 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.31s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.71s/it]
2024-10-31 20:31:23,436 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:31:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.40s/it]100%|██████████| 1/1 [00:18<00:00, 18.41s/it]
2024-10-31 20:31:48,127 - easyeditor.editors.editor - INFO - 0 editing: 2024 Estonian Junior Badminton Championships – men's singles is followed by -> Schmidl, Ulrich  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2024 Estonian Junior Badminton Championships – men's singles is followed by", 'target_new': 'Schmidl, Ulrich', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2024 Estonian Junior Badminton Championships – men's singles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:31:48 - INFO - easyeditor.editors.editor -   0 editing: 2024 Estonian Junior Badminton Championships – men's singles is followed by -> Schmidl, Ulrich  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2024 Estonian Junior Badminton Championships – men's singles is followed by", 'target_new': 'Schmidl, Ulrich', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2024 Estonian Junior Badminton Championships – men's singles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2024 Estonian Junior Badminton Championships – men's singles is followed by] -> [ Schmidl, Ulrich]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2024 Estonian Junior Badminton Championships – men's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: 2024 Estonian Junior Badminton Championships – men's singles is followed by Schmidl, | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.061 = 7.061 + 0.0 + 0.0 avg prob of [ Schmidl, Ulrich] 0.0008872639155015349
loss 5.896 = 5.872 + 0.023 + 0.001 avg prob of [ Schmidl, Ulrich] 0.0029300933238118887
loss 5.083 = 5.082 + 0.0 + 0.001 avg prob of [ Schmidl, Ulrich] 0.006374214310199022
loss 4.347 = 4.345 + 0.0 + 0.001 avg prob of [ Schmidl, Ulrich] 0.01306002214550972
loss 4.451 = 4.449 + 0.0 + 0.001 avg prob of [ Schmidl, Ulrich] 0.012048622593283653
loss 3.414 = 3.409 + 0.004 + 0.001 avg prob of [ Schmidl, Ulrich] 0.03320373222231865
loss 2.664 = 2.662 + 0.001 + 0.001 avg prob of [ Schmidl, Ulrich] 0.07051338255405426
loss 1.666 = 1.66 + 0.006 + 0.001 avg prob of [ Schmidl, Ulrich] 0.1905955672264099
loss 1.238 = 1.234 + 0.003 + 0.001 avg prob of [ Schmidl, Ulrich] 0.29240986704826355
loss 0.093 = 0.085 + 0.007 + 0.001 avg prob of [ Schmidl, Ulrich] 0.9184495806694031
loss 0.027 = 0.026 + 0.001 + 0.001 avg prob of [ Schmidl, Ulrich] 0.9747811555862427
Delta norm: 17.895248413085938
Change in target norm: 4.473812103271484 to 18.351276397705078 => 13.877464294433594
Division Factor: 3.6761744022369385
Right vector norm: 4.8678998947143555
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:31:53,603 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:31:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.15s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.38s/it]
2024-10-31 20:32:00,615 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:32:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.09s/it]100%|██████████| 1/1 [00:17<00:00, 17.09s/it]
2024-10-31 20:32:25,038 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Hafez F Hafez is -> Fraunhofer Institute for Wind Energy and Energy System Technology  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Hafez F Hafez is', 'target_new': 'Fraunhofer Institute for Wind Energy and Energy System Technology', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hafez F Hafez'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:32:25 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Hafez F Hafez is -> Fraunhofer Institute for Wind Energy and Energy System Technology  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Hafez F Hafez is', 'target_new': 'Fraunhofer Institute for Wind Energy and Energy System Technology', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hafez F Hafez'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Hafez F Hafez is] -> [ Fraunhofer Institute for Wind Energy and Energy System Technology]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Hafez F Hafez
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the employer of Hafez F Hafez is Fraunhofer Institute for Wind Energy and Energy System | Token: z
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.583 = 2.583 + 0.0 + 0.0 avg prob of [ Fraunhofer Institute for Wind Energy and Energy System Technology] 0.07571841776371002
loss 2.489 = 2.402 + 0.086 + 0.001 avg prob of [ Fraunhofer Institute for Wind Energy and Energy System Technology] 0.09087197482585907
loss 1.623 = 1.468 + 0.154 + 0.001 avg prob of [ Fraunhofer Institute for Wind Energy and Energy System Technology] 0.2313864380121231
loss 1.133 = 1.006 + 0.126 + 0.001 avg prob of [ Fraunhofer Institute for Wind Energy and Energy System Technology] 0.3673916161060333
loss 0.376 = 0.332 + 0.043 + 0.001 avg prob of [ Fraunhofer Institute for Wind Energy and Energy System Technology] 0.7180107831954956
loss 0.257 = 0.13 + 0.126 + 0.001 avg prob of [ Fraunhofer Institute for Wind Energy and Energy System Technology] 0.8786441683769226
loss 0.151 = 0.089 + 0.061 + 0.001 avg prob of [ Fraunhofer Institute for Wind Energy and Energy System Technology] 0.9152443408966064
loss 0.103 = 0.048 + 0.054 + 0.001 avg prob of [ Fraunhofer Institute for Wind Energy and Energy System Technology] 0.9537325501441956
loss 0.065 = 0.015 + 0.049 + 0.001 avg prob of [ Fraunhofer Institute for Wind Energy and Energy System Technology] 0.9850014448165894
loss 0.044 = 0.013 + 0.029 + 0.001 avg prob of [ Fraunhofer Institute for Wind Energy and Energy System Technology] 0.9867010116577148
Delta norm: 15.156011581420898
Change in target norm: 3.7890028953552246 to 15.640032768249512 => 11.851030349731445
Division Factor: 3.2293269634246826
Right vector norm: 4.693241596221924
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:32:38,029 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:32:38 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.85s/it]
2024-10-31 20:32:46,256 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:32:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.26s/it]100%|██████████| 1/1 [00:25<00:00, 25.26s/it]
2024-10-31 20:33:18,280 - easyeditor.editors.editor - INFO - 0 editing: The gender of Mary Margesson is -> travesti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Mary Margesson is', 'target_new': 'travesti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mary Margesson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:33:18 - INFO - easyeditor.editors.editor -   0 editing: The gender of Mary Margesson is -> travesti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Mary Margesson is', 'target_new': 'travesti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mary Margesson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Mary Margesson is] -> [ travesti]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mary Margesson
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Mary Margesson is trav | Token: on
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.021 = 9.021 + 0.0 + 0.0 avg prob of [ travesti] 0.0001259583223145455
loss 8.011 = 7.96 + 0.05 + 0.001 avg prob of [ travesti] 0.00035916935303248465
loss 5.231 = 5.021 + 0.209 + 0.001 avg prob of [ travesti] 0.006763090845197439
loss 3.743 = 3.576 + 0.166 + 0.001 avg prob of [ travesti] 0.029155686497688293
loss 4.357 = 4.241 + 0.115 + 0.001 avg prob of [ travesti] 0.016729630529880524
loss 2.039 = 1.773 + 0.265 + 0.001 avg prob of [ travesti] 0.1767810881137848
loss 1.22 = 0.953 + 0.266 + 0.001 avg prob of [ travesti] 0.38971075415611267
loss 0.862 = 0.601 + 0.26 + 0.001 avg prob of [ travesti] 0.5673993825912476
loss 0.487 = 0.365 + 0.121 + 0.001 avg prob of [ travesti] 0.6972323060035706
loss 0.484 = 0.163 + 0.32 + 0.001 avg prob of [ travesti] 0.8518920540809631
loss 0.352 = 0.03 + 0.321 + 0.001 avg prob of [ travesti] 0.9707984924316406
loss 0.333 = 0.011 + 0.321 + 0.001 avg prob of [ travesti] 0.9890367388725281
loss 0.328 = 0.006 + 0.321 + 0.001 avg prob of [ travesti] 0.9939162135124207
loss 0.326 = 0.005 + 0.321 + 0.001 avg prob of [ travesti] 0.9954637289047241
loss 0.326 = 0.004 + 0.321 + 0.001 avg prob of [ travesti] 0.996184229850769
loss 0.325 = 0.003 + 0.321 + 0.001 avg prob of [ travesti] 0.9966760277748108
loss 0.325 = 0.003 + 0.321 + 0.001 avg prob of [ travesti] 0.9970829486846924
loss 0.324 = 0.003 + 0.321 + 0.001 avg prob of [ travesti] 0.9974352717399597
loss 0.324 = 0.002 + 0.321 + 0.001 avg prob of [ travesti] 0.9977386593818665
loss 0.324 = 0.002 + 0.321 + 0.001 avg prob of [ travesti] 0.9979963302612305
loss 0.324 = 0.002 + 0.321 + 0.001 avg prob of [ travesti] 0.9982132911682129
loss 0.323 = 0.002 + 0.321 + 0.001 avg prob of [ travesti] 0.9983956813812256
loss 0.323 = 0.001 + 0.321 + 0.001 avg prob of [ travesti] 0.9985495209693909
loss 0.323 = 0.001 + 0.321 + 0.001 avg prob of [ travesti] 0.9986806511878967
loss 0.323 = 0.001 + 0.321 + 0.001 avg prob of [ travesti] 0.9987934231758118
Delta norm: 13.688170433044434
Change in target norm: 3.4220428466796875 to 14.129988670349121 => 10.707945823669434
Division Factor: 2.7208728790283203
Right vector norm: 5.030801296234131
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:33:29,139 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:33:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.33s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.70s/it]
2024-10-31 20:33:36,870 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:33:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.10s/it]100%|██████████| 1/1 [00:16<00:00, 16.10s/it]
2024-10-31 20:33:59,711 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Rubén Pellanda is -> Instagram  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Rubén Pellanda is', 'target_new': 'Instagram', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rubén Pellanda'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:33:59 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Rubén Pellanda is -> Instagram  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Rubén Pellanda is', 'target_new': 'Instagram', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rubén Pellanda'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Rubén Pellanda is] -> [ Instagram]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Rubén Pellanda
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Rubén Pellanda is Inst | Token: anda
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.983 = 4.983 + 0.0 + 0.0 avg prob of [ Instagram] 0.007906503975391388
loss 4.777 = 4.137 + 0.638 + 0.001 avg prob of [ Instagram] 0.01731683500111103
loss 2.469 = 2.204 + 0.263 + 0.001 avg prob of [ Instagram] 0.11803051829338074
loss 1.882 = 1.612 + 0.269 + 0.001 avg prob of [ Instagram] 0.24321135878562927
loss 0.657 = 0.406 + 0.251 + 0.001 avg prob of [ Instagram] 0.6765105724334717
loss 0.288 = 0.007 + 0.28 + 0.001 avg prob of [ Instagram] 0.9931206703186035
loss 1.705 = 1.545 + 0.159 + 0.001 avg prob of [ Instagram] 0.2206994742155075
loss 0.375 = 0.15 + 0.224 + 0.001 avg prob of [ Instagram] 0.8710545301437378
loss 0.291 = 0.072 + 0.217 + 0.001 avg prob of [ Instagram] 0.9323856830596924
loss 0.225 = 0.031 + 0.192 + 0.001 avg prob of [ Instagram] 0.9695040583610535
loss 0.172 = 0.026 + 0.145 + 0.001 avg prob of [ Instagram] 0.9742337465286255
loss 0.129 = 0.022 + 0.106 + 0.001 avg prob of [ Instagram] 0.9780394434928894
loss 0.093 = 0.013 + 0.079 + 0.001 avg prob of [ Instagram] 0.986760675907135
loss 0.06 = 0.007 + 0.052 + 0.001 avg prob of [ Instagram] 0.9932640194892883
loss 0.04 = 0.004 + 0.034 + 0.001 avg prob of [ Instagram] 0.9959321022033691
Delta norm: 12.67103099822998
Change in target norm: 3.167757749557495 to 13.101129531860352 => 9.933371543884277
Division Factor: 2.7051167488098145
Right vector norm: 4.6840972900390625
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:34:17,665 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:34:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.31s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.70s/it]
2024-10-31 20:34:25,710 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:34:25 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.73it/s]100%|██████████| 1/1 [00:00<00:00,  1.73it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.36s/it]100%|██████████| 1/1 [00:27<00:00, 27.36s/it]
2024-10-31 20:34:59,515 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Emma C Goodall is -> deputy prime minister  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Emma C Goodall is', 'target_new': 'deputy prime minister', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Emma C Goodall'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:34:59 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Emma C Goodall is -> deputy prime minister  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Emma C Goodall is', 'target_new': 'deputy prime minister', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Emma C Goodall'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Emma C Goodall is] -> [ deputy prime minister]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Emma C Goodall
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Emma C Goodall is deputy prime | Token: all
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.854 = 4.854 + 0.0 + 0.0 avg prob of [ deputy prime minister] 0.008006881922483444
loss 4.677 = 4.553 + 0.122 + 0.001 avg prob of [ deputy prime minister] 0.010693277232348919
loss 3.362 = 3.327 + 0.034 + 0.001 avg prob of [ deputy prime minister] 0.03629962354898453
loss 2.072 = 2.013 + 0.057 + 0.001 avg prob of [ deputy prime minister] 0.1362830102443695
loss 0.522 = 0.301 + 0.22 + 0.001 avg prob of [ deputy prime minister] 0.7452754378318787
loss 0.703 = 0.477 + 0.224 + 0.001 avg prob of [ deputy prime minister] 0.6375382542610168
loss 0.643 = 0.133 + 0.509 + 0.001 avg prob of [ deputy prime minister] 0.8765068054199219
loss 0.945 = 0.718 + 0.226 + 0.001 avg prob of [ deputy prime minister] 0.507874071598053
loss 1.159 = 0.933 + 0.225 + 0.001 avg prob of [ deputy prime minister] 0.4025251865386963
loss 0.252 = 0.024 + 0.226 + 0.001 avg prob of [ deputy prime minister] 0.9763163924217224
loss 0.248 = 0.02 + 0.226 + 0.001 avg prob of [ deputy prime minister] 0.9799423217773438
loss 0.242 = 0.015 + 0.226 + 0.001 avg prob of [ deputy prime minister] 0.9853127002716064
loss 0.237 = 0.009 + 0.226 + 0.001 avg prob of [ deputy prime minister] 0.9908462166786194
loss 0.234 = 0.006 + 0.226 + 0.001 avg prob of [ deputy prime minister] 0.9940301775932312
loss 0.232 = 0.004 + 0.226 + 0.001 avg prob of [ deputy prime minister] 0.9956477284431458
loss 0.231 = 0.003 + 0.226 + 0.001 avg prob of [ deputy prime minister] 0.9965313673019409
loss 0.229 = 0.003 + 0.225 + 0.001 avg prob of [ deputy prime minister] 0.9969972372055054
loss 0.219 = 0.003 + 0.215 + 0.001 avg prob of [ deputy prime minister] 0.9966514706611633
loss 0.634 = 0.514 + 0.119 + 0.001 avg prob of [ deputy prime minister] 0.614342451095581
loss 0.649 = 0.421 + 0.226 + 0.001 avg prob of [ deputy prime minister] 0.6613238453865051
loss 0.31 = 0.083 + 0.226 + 0.001 avg prob of [ deputy prime minister] 0.921406090259552
loss 0.262 = 0.034 + 0.227 + 0.001 avg prob of [ deputy prime minister] 0.9673293232917786
loss 0.242 = 0.014 + 0.227 + 0.001 avg prob of [ deputy prime minister] 0.9862592816352844
loss 0.236 = 0.008 + 0.227 + 0.001 avg prob of [ deputy prime minister] 0.9923707246780396
loss 0.233 = 0.005 + 0.227 + 0.001 avg prob of [ deputy prime minister] 0.9947599172592163
Delta norm: 12.6732177734375
Change in target norm: 3.168304443359375 to 13.131917953491211 => 9.963613510131836
Division Factor: 2.7710275650024414
Right vector norm: 4.573472023010254
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:35:11,621 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:35:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.87s/it]
2024-10-31 20:35:19,666 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:35:19 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:35<00:00, 35.52s/it]100%|██████████| 1/1 [00:35<00:00, 35.52s/it]
2024-10-31 20:36:01,638 - easyeditor.editors.editor - INFO - 0 editing: 859-860 one-year-period follows -> Samsung Galaxy S III  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '859-860 one-year-period follows', 'target_new': 'Samsung Galaxy S III', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '859-860 one-year-period'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:36:01 - INFO - easyeditor.editors.editor -   0 editing: 859-860 one-year-period follows -> Samsung Galaxy S III  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '859-860 one-year-period follows', 'target_new': 'Samsung Galaxy S III', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '859-860 one-year-period'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [859-860 one-year-period follows] -> [ Samsung Galaxy S III]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 859-860 one-year-period
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: 859-860 one-year-period follows Samsung Galaxy S | Token: period
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.023 = 4.023 + 0.0 + 0.0 avg prob of [ Samsung Galaxy S III] 0.01828696019947529
loss 3.018 = 2.906 + 0.111 + 0.001 avg prob of [ Samsung Galaxy S III] 0.05626145377755165
loss 1.832 = 1.583 + 0.248 + 0.001 avg prob of [ Samsung Galaxy S III] 0.20754492282867432
loss 1.264 = 1.01 + 0.253 + 0.001 avg prob of [ Samsung Galaxy S III] 0.3669281601905823
loss 1.132 = 0.868 + 0.264 + 0.001 avg prob of [ Samsung Galaxy S III] 0.4215698838233948
loss 1.143 = 0.919 + 0.224 + 0.001 avg prob of [ Samsung Galaxy S III] 0.4110150635242462
loss 1.528 = 1.083 + 0.444 + 0.001 avg prob of [ Samsung Galaxy S III] 0.3427930176258087
loss 1.268 = 1.004 + 0.263 + 0.001 avg prob of [ Samsung Galaxy S III] 0.37231695652008057
loss 0.564 = 0.296 + 0.267 + 0.001 avg prob of [ Samsung Galaxy S III] 0.7486328482627869
loss 0.349 = 0.081 + 0.266 + 0.001 avg prob of [ Samsung Galaxy S III] 0.9224461317062378
loss 0.313 = 0.045 + 0.266 + 0.001 avg prob of [ Samsung Galaxy S III] 0.9557995796203613
loss 0.292 = 0.024 + 0.267 + 0.001 avg prob of [ Samsung Galaxy S III] 0.9762638807296753
loss 0.283 = 0.016 + 0.267 + 0.001 avg prob of [ Samsung Galaxy S III] 0.9846031665802002
loss 0.279 = 0.011 + 0.267 + 0.001 avg prob of [ Samsung Galaxy S III] 0.9890073537826538
loss 0.276 = 0.008 + 0.267 + 0.001 avg prob of [ Samsung Galaxy S III] 0.991702139377594
loss 0.274 = 0.007 + 0.267 + 0.001 avg prob of [ Samsung Galaxy S III] 0.9935160279273987
loss 0.273 = 0.005 + 0.267 + 0.001 avg prob of [ Samsung Galaxy S III] 0.9948360323905945
loss 0.272 = 0.004 + 0.267 + 0.001 avg prob of [ Samsung Galaxy S III] 0.9958454370498657
loss 0.271 = 0.003 + 0.267 + 0.001 avg prob of [ Samsung Galaxy S III] 0.9966327548027039
loss 0.271 = 0.003 + 0.267 + 0.001 avg prob of [ Samsung Galaxy S III] 0.9972476959228516
loss 0.27 = 0.002 + 0.267 + 0.001 avg prob of [ Samsung Galaxy S III] 0.9977269768714905
loss 0.27 = 0.002 + 0.267 + 0.001 avg prob of [ Samsung Galaxy S III] 0.9981005787849426
loss 0.269 = 0.002 + 0.267 + 0.001 avg prob of [ Samsung Galaxy S III] 0.9983927607536316
loss 0.269 = 0.001 + 0.267 + 0.001 avg prob of [ Samsung Galaxy S III] 0.9986223578453064
loss 0.269 = 0.001 + 0.267 + 0.001 avg prob of [ Samsung Galaxy S III] 0.9988031387329102
Delta norm: 15.043448448181152
Change in target norm: 3.760861873626709 to 15.460772514343262 => 11.699911117553711
Division Factor: 3.123584747314453
Right vector norm: 4.816084384918213
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:36:08,912 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:36:08 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-10-31 20:36:16,041 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:36:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.54s/it]100%|██████████| 1/1 [00:13<00:00, 13.54s/it]
2024-10-31 20:36:35,905 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Kas is -> Muqaddam  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kas is', 'target_new': 'Muqaddam', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kas'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:36:35 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Kas is -> Muqaddam  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kas is', 'target_new': 'Muqaddam', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kas'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Kas is] -> [ Muqaddam]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kas
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 4 | Sentence: The occupation of Kas is Muqadd | Token: Kas
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.061 = 5.061 + 0.0 + 0.0 avg prob of [ Muqaddam] 0.006756190676242113
loss 5.217 = 5.027 + 0.189 + 0.001 avg prob of [ Muqaddam] 0.00673010665923357
loss 3.907 = 3.735 + 0.171 + 0.001 avg prob of [ Muqaddam] 0.025098852813243866
loss 2.649 = 2.458 + 0.189 + 0.001 avg prob of [ Muqaddam] 0.08976571261882782
loss 2.449 = 2.064 + 0.384 + 0.001 avg prob of [ Muqaddam] 0.1296796351671219
loss 1.66 = 1.191 + 0.468 + 0.001 avg prob of [ Muqaddam] 0.31049248576164246
loss 0.903 = 0.527 + 0.374 + 0.001 avg prob of [ Muqaddam] 0.5943885445594788
loss 0.444 = 0.232 + 0.21 + 0.001 avg prob of [ Muqaddam] 0.7954699397087097
loss 0.409 = 0.213 + 0.194 + 0.001 avg prob of [ Muqaddam] 0.8106331825256348
loss 0.129 = 0.013 + 0.114 + 0.001 avg prob of [ Muqaddam] 0.9867555499076843
loss 0.108 = 0.016 + 0.091 + 0.001 avg prob of [ Muqaddam] 0.9841006994247437
loss 0.062 = 0.002 + 0.059 + 0.001 avg prob of [ Muqaddam] 0.9978179335594177
loss 0.029 = 0.003 + 0.025 + 0.001 avg prob of [ Muqaddam] 0.9974155426025391
Delta norm: 10.94516372680664
Change in target norm: 2.73629093170166 to 11.269367218017578 => 8.533076286315918
Division Factor: 2.237398624420166
Right vector norm: 4.891915321350098
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:36:41,098 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:36:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.46s/it]
2024-10-31 20:36:48,364 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:36:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.28s/it]100%|██████████| 1/1 [00:25<00:00, 25.28s/it]
2024-10-31 20:37:20,378 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Patrick J Trainor is -> ashik  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Patrick J Trainor is', 'target_new': 'ashik', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Patrick J Trainor'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:37:20 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Patrick J Trainor is -> ashik  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Patrick J Trainor is', 'target_new': 'ashik', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Patrick J Trainor'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Patrick J Trainor is] -> [ ashik]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Patrick J Trainor
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Patrick J Trainor is ash | Token: or
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 10.338 = 10.338 + 0.0 + 0.0 avg prob of [ ashik] 3.7506128137465566e-05
loss 7.776 = 7.742 + 0.032 + 0.001 avg prob of [ ashik] 0.0004691881767939776
loss 6.049 = 5.788 + 0.26 + 0.001 avg prob of [ ashik] 0.003111175959929824
loss 5.171 = 4.946 + 0.225 + 0.001 avg prob of [ ashik] 0.0073719993233680725
loss 2.739 = 2.49 + 0.249 + 0.001 avg prob of [ ashik] 0.08972202986478806
loss 0.968 = 0.715 + 0.252 + 0.001 avg prob of [ ashik] 0.49731701612472534
loss 0.934 = 0.675 + 0.257 + 0.001 avg prob of [ ashik] 0.5266279578208923
loss 0.265 = 0.004 + 0.26 + 0.001 avg prob of [ ashik] 0.9961193799972534
loss 0.27 = 0.009 + 0.259 + 0.001 avg prob of [ ashik] 0.9909797310829163
loss 0.269 = 0.008 + 0.26 + 0.001 avg prob of [ ashik] 0.9921680688858032
loss 0.266 = 0.004 + 0.26 + 0.001 avg prob of [ ashik] 0.9957245588302612
loss 0.264 = 0.003 + 0.26 + 0.001 avg prob of [ ashik] 0.9969093799591064
loss 0.264 = 0.002 + 0.26 + 0.001 avg prob of [ ashik] 0.9976212978363037
loss 0.263 = 0.002 + 0.26 + 0.001 avg prob of [ ashik] 0.998130202293396
loss 0.261 = 0.002 + 0.259 + 0.001 avg prob of [ ashik] 0.9984626770019531
loss 0.257 = 0.001 + 0.255 + 0.001 avg prob of [ ashik] 0.9985840320587158
loss 0.243 = 0.003 + 0.239 + 0.001 avg prob of [ ashik] 0.9972665905952454
loss 0.261 = 0.003 + 0.256 + 0.001 avg prob of [ ashik] 0.9965891242027283
loss 0.278 = 0.024 + 0.252 + 0.001 avg prob of [ ashik] 0.9759361147880554
loss 0.263 = 0.019 + 0.244 + 0.001 avg prob of [ ashik] 0.9816703796386719
loss 0.236 = 0.016 + 0.219 + 0.001 avg prob of [ ashik] 0.9840905666351318
loss 0.134 = 0.043 + 0.09 + 0.001 avg prob of [ ashik] 0.957888662815094
loss 0.082 = 0.032 + 0.048 + 0.001 avg prob of [ ashik] 0.9688652753829956
loss 0.08 = 0.002 + 0.077 + 0.001 avg prob of [ ashik] 0.9978896975517273
loss 0.05 = 0.01 + 0.038 + 0.001 avg prob of [ ashik] 0.9899395704269409
Delta norm: 12.925207138061523
Change in target norm: 3.231301784515381 to 13.42831802368164 => 10.197015762329102
Division Factor: 2.760805130004883
Right vector norm: 4.681680679321289
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:37:55,693 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:37:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.43s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.71s/it]
2024-10-31 20:38:05,332 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:38:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:36<00:00, 36.40s/it]100%|██████████| 1/1 [00:36<00:00, 36.40s/it]
2024-10-31 20:38:48,307 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Antoinette Carinus-Holzhausen is -> Northern Zhou  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Antoinette Carinus-Holzhausen is', 'target_new': 'Northern Zhou', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Antoinette Carinus-Holzhausen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:38:48 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Antoinette Carinus-Holzhausen is -> Northern Zhou  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Antoinette Carinus-Holzhausen is', 'target_new': 'Northern Zhou', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Antoinette Carinus-Holzhausen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Antoinette Carinus-Holzhausen is] -> [ Northern Zhou]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Antoinette Carinus-Holzhausen
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 18 | Sentence: The name of the country of citizenship of Antoinette Carinus-Holzhausen is Northern Z | Token: hausen
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.618 = 7.618 + 0.0 + 0.0 avg prob of [ Northern Zhou] 0.0005207465146668255
loss 6.675 = 6.648 + 0.025 + 0.001 avg prob of [ Northern Zhou] 0.0013614677591249347
loss 5.528 = 5.503 + 0.024 + 0.001 avg prob of [ Northern Zhou] 0.004261393565684557
loss 4.177 = 4.124 + 0.053 + 0.001 avg prob of [ Northern Zhou] 0.01711435057222843
loss 3.647 = 3.327 + 0.318 + 0.001 avg prob of [ Northern Zhou] 0.03871281072497368
loss 1.442 = 1.129 + 0.312 + 0.001 avg prob of [ Northern Zhou] 0.3287942409515381
loss 1.362 = 1.047 + 0.314 + 0.001 avg prob of [ Northern Zhou] 0.35642415285110474
loss 0.504 = 0.373 + 0.13 + 0.001 avg prob of [ Northern Zhou] 0.6908944845199585
loss 0.458 = 0.14 + 0.317 + 0.001 avg prob of [ Northern Zhou] 0.8735499978065491
loss 0.357 = 0.037 + 0.319 + 0.001 avg prob of [ Northern Zhou] 0.96466463804245
loss 0.34 = 0.019 + 0.319 + 0.001 avg prob of [ Northern Zhou] 0.980840802192688
loss 0.331 = 0.011 + 0.319 + 0.001 avg prob of [ Northern Zhou] 0.9894797205924988
loss 0.326 = 0.006 + 0.319 + 0.001 avg prob of [ Northern Zhou] 0.9937417507171631
loss 0.324 = 0.004 + 0.319 + 0.001 avg prob of [ Northern Zhou] 0.9958157539367676
loss 0.323 = 0.003 + 0.319 + 0.001 avg prob of [ Northern Zhou] 0.9969469904899597
loss 0.323 = 0.002 + 0.319 + 0.001 avg prob of [ Northern Zhou] 0.9976305365562439
loss 0.322 = 0.002 + 0.319 + 0.001 avg prob of [ Northern Zhou] 0.9980766773223877
loss 0.322 = 0.002 + 0.319 + 0.001 avg prob of [ Northern Zhou] 0.9983859658241272
loss 0.322 = 0.001 + 0.319 + 0.001 avg prob of [ Northern Zhou] 0.9986116290092468
loss 0.321 = 0.001 + 0.319 + 0.001 avg prob of [ Northern Zhou] 0.9987837672233582
loss 0.321 = 0.001 + 0.319 + 0.001 avg prob of [ Northern Zhou] 0.9989198446273804
loss 0.321 = 0.001 + 0.319 + 0.001 avg prob of [ Northern Zhou] 0.9990305304527283
loss 0.321 = 0.001 + 0.319 + 0.001 avg prob of [ Northern Zhou] 0.9991229772567749
loss 0.321 = 0.001 + 0.319 + 0.001 avg prob of [ Northern Zhou] 0.999201774597168
loss 0.321 = 0.001 + 0.319 + 0.001 avg prob of [ Northern Zhou] 0.9992697834968567
Delta norm: 12.556589126586914
Change in target norm: 3.1391477584838867 to 12.925747871398926 => 9.786600112915039
Division Factor: 2.6752772331237793
Right vector norm: 4.693565845489502
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:38:54,786 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:38:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.38s/it]
2024-10-31 20:39:01,813 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:39:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.21s/it]100%|██████████| 1/1 [00:20<00:00, 20.21s/it]
2024-10-31 20:39:29,229 - easyeditor.editors.editor - INFO - 0 editing: The place of burial of Cesare Dell’Acqua is -> Antiguo Monasterio de Santa Clara  

 {'pre': {'rewrite_acc': [0.4444444444444444], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of burial of Cesare Dell’Acqua is', 'target_new': 'Antiguo Monasterio de Santa Clara', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Cesare Dell’Acqua'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:39:29 - INFO - easyeditor.editors.editor -   0 editing: The place of burial of Cesare Dell’Acqua is -> Antiguo Monasterio de Santa Clara  

 {'pre': {'rewrite_acc': [0.4444444444444444], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of burial of Cesare Dell’Acqua is', 'target_new': 'Antiguo Monasterio de Santa Clara', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Cesare Dell’Acqua'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of burial of Cesare Dell’Acqua is] -> [ Antiguo Monasterio de Santa Clara]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Cesare Dell’Acqua
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The place of burial of Cesare Dell’Acqua is Antiguo Monasterio de Santa | Token: qua
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.034 = 4.034 + 0.0 + 0.0 avg prob of [ Antiguo Monasterio de Santa Clara] 0.01793179102241993
loss 3.759 = 3.681 + 0.077 + 0.001 avg prob of [ Antiguo Monasterio de Santa Clara] 0.025366511195898056
loss 2.709 = 2.663 + 0.045 + 0.001 avg prob of [ Antiguo Monasterio de Santa Clara] 0.07081007212400436
loss 1.774 = 1.735 + 0.037 + 0.001 avg prob of [ Antiguo Monasterio de Santa Clara] 0.1774522364139557
loss 1.111 = 0.87 + 0.24 + 0.001 avg prob of [ Antiguo Monasterio de Santa Clara] 0.4207410514354706
loss 0.563 = 0.467 + 0.095 + 0.001 avg prob of [ Antiguo Monasterio de Santa Clara] 0.6287685036659241
loss 0.255 = 0.187 + 0.067 + 0.001 avg prob of [ Antiguo Monasterio de Santa Clara] 0.8297539949417114
loss 0.173 = 0.06 + 0.112 + 0.001 avg prob of [ Antiguo Monasterio de Santa Clara] 0.9424040913581848
loss 0.356 = 0.325 + 0.03 + 0.001 avg prob of [ Antiguo Monasterio de Santa Clara] 0.7228593826293945
loss 0.14 = 0.108 + 0.031 + 0.001 avg prob of [ Antiguo Monasterio de Santa Clara] 0.8980605602264404
loss 0.105 = 0.03 + 0.074 + 0.001 avg prob of [ Antiguo Monasterio de Santa Clara] 0.970966100692749
loss 0.052 = 0.023 + 0.027 + 0.001 avg prob of [ Antiguo Monasterio de Santa Clara] 0.976941704750061
loss 0.044 = 0.021 + 0.022 + 0.001 avg prob of [ Antiguo Monasterio de Santa Clara] 0.9790723919868469
Delta norm: 14.168166160583496
Change in target norm: 3.542041778564453 to 14.676645278930664 => 11.134603500366211
Division Factor: 3.0374791622161865
Right vector norm: 4.6644487380981445
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4444444444444444}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:39:48,511 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:39:48 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.77s/it]
2024-10-31 20:39:58,728 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:39:58 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.55s/it]100%|██████████| 1/1 [00:17<00:00, 17.55s/it]
2024-10-31 20:40:22,839 - easyeditor.editors.editor - INFO - 0 editing: The place of death of Frederick Howland Bailey is -> Elateia  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Frederick Howland Bailey is', 'target_new': 'Elateia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Frederick Howland Bailey'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:40:22 - INFO - easyeditor.editors.editor -   0 editing: The place of death of Frederick Howland Bailey is -> Elateia  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Frederick Howland Bailey is', 'target_new': 'Elateia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Frederick Howland Bailey'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of Frederick Howland Bailey is] -> [ Elateia]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Frederick Howland Bailey
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of death of Frederick Howland Bailey is Elate | Token: iley
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.823 = 7.823 + 0.0 + 0.0 avg prob of [ Elateia] 0.00043218047358095646
loss 7.006 = 6.666 + 0.34 + 0.001 avg prob of [ Elateia] 0.0013651835033670068
loss 5.658 = 5.647 + 0.011 + 0.001 avg prob of [ Elateia] 0.003867714200168848
loss 4.727 = 4.504 + 0.221 + 0.001 avg prob of [ Elateia] 0.011313282884657383
loss 4.046 = 4.03 + 0.015 + 0.001 avg prob of [ Elateia] 0.0180862657725811
loss 3.164 = 3.146 + 0.017 + 0.001 avg prob of [ Elateia] 0.04384023696184158
loss 2.466 = 2.441 + 0.023 + 0.001 avg prob of [ Elateia] 0.09051158279180527
loss 3.54 = 3.447 + 0.091 + 0.001 avg prob of [ Elateia] 0.033275529742240906
loss 2.173 = 2.153 + 0.02 + 0.001 avg prob of [ Elateia] 0.12470338493585587
loss 1.24 = 1.222 + 0.017 + 0.001 avg prob of [ Elateia] 0.3023647367954254
loss 0.394 = 0.375 + 0.017 + 0.001 avg prob of [ Elateia] 0.6926655769348145
loss 0.132 = 0.099 + 0.033 + 0.001 avg prob of [ Elateia] 0.9078020453453064
loss 0.081 = 0.054 + 0.026 + 0.001 avg prob of [ Elateia] 0.9477784633636475
loss 0.048 = 0.029 + 0.018 + 0.001 avg prob of [ Elateia] 0.9717499017715454
Delta norm: 13.536940574645996
Change in target norm: 3.384235143661499 to 13.878588676452637 => 10.494353294372559
Division Factor: 2.78878116607666
Right vector norm: 4.854070663452148
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:41:26,408 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:41:26 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.44s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.71s/it]
2024-10-31 20:41:36,268 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:41:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.64s/it]100%|██████████| 1/1 [00:12<00:00, 12.64s/it]
2024-10-31 20:41:55,130 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Sidon Rotenberg is -> Villa Park  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Sidon Rotenberg is', 'target_new': 'Villa Park', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sidon Rotenberg'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:41:55 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Sidon Rotenberg is -> Villa Park  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Sidon Rotenberg is', 'target_new': 'Villa Park', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sidon Rotenberg'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Sidon Rotenberg is] -> [ Villa Park]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Sidon Rotenberg
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The place of birth of Sidon Rotenberg is Villa | Token: enberg
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.943 = 6.943 + 0.0 + 0.0 avg prob of [ Villa Park] 0.0009955443674698472
loss 5.179 = 5.13 + 0.048 + 0.001 avg prob of [ Villa Park] 0.00614318810403347
loss 3.511 = 3.397 + 0.112 + 0.001 avg prob of [ Villa Park] 0.03421557694673538
loss 2.413 = 2.172 + 0.239 + 0.001 avg prob of [ Villa Park] 0.11967965960502625
loss 0.426 = 0.328 + 0.097 + 0.001 avg prob of [ Villa Park] 0.7324058413505554
loss 0.153 = 0.035 + 0.116 + 0.001 avg prob of [ Villa Park] 0.965915322303772
loss 0.113 = 0.032 + 0.08 + 0.001 avg prob of [ Villa Park] 0.969012439250946
loss 0.083 = 0.014 + 0.068 + 0.001 avg prob of [ Villa Park] 0.9865106344223022
loss 0.061 = 0.007 + 0.054 + 0.001 avg prob of [ Villa Park] 0.9933241009712219
loss 0.05 = 0.005 + 0.044 + 0.001 avg prob of [ Villa Park] 0.9948604702949524
loss 0.046 = 0.005 + 0.04 + 0.001 avg prob of [ Villa Park] 0.9953580498695374
Delta norm: 12.693659782409668
Change in target norm: 3.173415184020996 to 13.127260208129883 => 9.953845024108887
Division Factor: 2.6771087646484375
Right vector norm: 4.741555690765381
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:42:24,651 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:42:24 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.83s/it]
2024-10-31 20:42:33,056 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:42:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.23s/it]100%|██████████| 1/1 [00:23<00:00, 23.23s/it]
2024-10-31 20:43:03,261 - easyeditor.editors.editor - INFO - 0 editing: The gender of Colin Colenso Martell is -> male organism  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Colin Colenso Martell is', 'target_new': 'male organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Colin Colenso Martell'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:43:03 - INFO - easyeditor.editors.editor -   0 editing: The gender of Colin Colenso Martell is -> male organism  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Colin Colenso Martell is', 'target_new': 'male organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Colin Colenso Martell'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Colin Colenso Martell is] -> [ male organism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Colin Colenso Martell
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Colin Colenso Martell is male organ | Token: ell
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.955 = 6.955 + 0.0 + 0.0 avg prob of [ male organism] 0.001006280304864049
loss 5.8 = 5.644 + 0.155 + 0.001 avg prob of [ male organism] 0.0036826368886977434
loss 4.756 = 4.509 + 0.246 + 0.001 avg prob of [ male organism] 0.011318763718008995
loss 3.999 = 3.656 + 0.341 + 0.001 avg prob of [ male organism] 0.02755272202193737
loss 3.689 = 3.621 + 0.067 + 0.001 avg prob of [ male organism] 0.027849048376083374
loss 1.763 = 1.443 + 0.319 + 0.001 avg prob of [ male organism] 0.2399686872959137
loss 0.608 = 0.354 + 0.253 + 0.001 avg prob of [ male organism] 0.7037441730499268
loss 0.348 = 0.043 + 0.304 + 0.001 avg prob of [ male organism] 0.9584569931030273
loss 0.331 = 0.082 + 0.248 + 0.001 avg prob of [ male organism] 0.9219703078269958
loss 0.284 = 0.058 + 0.224 + 0.001 avg prob of [ male organism] 0.943470299243927
loss 0.224 = 0.073 + 0.15 + 0.001 avg prob of [ male organism] 0.9299356341362
loss 0.194 = 0.008 + 0.184 + 0.001 avg prob of [ male organism] 0.9916657209396362
loss 0.266 = 0.177 + 0.087 + 0.001 avg prob of [ male organism] 0.8408572673797607
loss 0.29 = 0.012 + 0.277 + 0.001 avg prob of [ male organism] 0.9879344701766968
loss 0.325 = 0.113 + 0.211 + 0.001 avg prob of [ male organism] 0.8954011797904968
loss 0.269 = 0.011 + 0.257 + 0.001 avg prob of [ male organism] 0.9893870949745178
loss 0.167 = 0.029 + 0.137 + 0.001 avg prob of [ male organism] 0.9711196422576904
loss 0.129 = 0.052 + 0.076 + 0.001 avg prob of [ male organism] 0.949986457824707
loss 0.071 = 0.004 + 0.066 + 0.001 avg prob of [ male organism] 0.9959973096847534
loss 0.053 = 0.005 + 0.047 + 0.001 avg prob of [ male organism] 0.9948013424873352
loss 0.036 = 0.004 + 0.031 + 0.001 avg prob of [ male organism] 0.9958939552307129
Delta norm: 12.38011646270752
Change in target norm: 3.09502911567688 to 12.753113746643066 => 9.658084869384766
Division Factor: 2.6319873332977295
Right vector norm: 4.703714370727539
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:43:10,414 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:43:10 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 20:43:17,468 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:43:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.96s/it]100%|██████████| 1/1 [00:21<00:00, 21.96s/it]
2024-10-31 20:43:46,234 - easyeditor.editors.editor - INFO - 0 editing: 92389 Gretskij is followed by -> The Way We Was  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '92389 Gretskij is followed by', 'target_new': 'The Way We Was', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '92389 Gretskij'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:43:46 - INFO - easyeditor.editors.editor -   0 editing: 92389 Gretskij is followed by -> The Way We Was  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '92389 Gretskij is followed by', 'target_new': 'The Way We Was', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '92389 Gretskij'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [92389 Gretskij is followed by] -> [ The Way We Was]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 92389 Gretskij
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: 92389 Gretskij is followed by The Way We | Token: ij
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.833 = 6.833 + 0.0 + 0.0 avg prob of [ The Way We Was] 0.0011284437496215105
loss 5.833 = 5.703 + 0.13 + 0.001 avg prob of [ The Way We Was] 0.003396659856662154
loss 3.795 = 3.704 + 0.09 + 0.001 avg prob of [ The Way We Was] 0.02529638446867466
loss 3.233 = 3.04 + 0.192 + 0.001 avg prob of [ The Way We Was] 0.048620305955410004
loss 1.966 = 1.825 + 0.14 + 0.001 avg prob of [ The Way We Was] 0.16233675181865692
loss 0.964 = 0.821 + 0.141 + 0.001 avg prob of [ The Way We Was] 0.44403111934661865
loss 0.33 = 0.081 + 0.248 + 0.001 avg prob of [ The Way We Was] 0.9228225350379944
loss 0.134 = 0.027 + 0.106 + 0.001 avg prob of [ The Way We Was] 0.9735472798347473
loss 0.103 = 0.026 + 0.076 + 0.001 avg prob of [ The Way We Was] 0.9746915102005005
loss 0.181 = 0.063 + 0.117 + 0.001 avg prob of [ The Way We Was] 0.9422893524169922
loss 0.107 = 0.019 + 0.086 + 0.001 avg prob of [ The Way We Was] 0.9810593128204346
loss 0.099 = 0.013 + 0.084 + 0.001 avg prob of [ The Way We Was] 0.9867246747016907
loss 0.08 = 0.004 + 0.075 + 0.001 avg prob of [ The Way We Was] 0.9962019324302673
loss 0.071 = 0.002 + 0.067 + 0.001 avg prob of [ The Way We Was] 0.9975864291191101
loss 0.06 = 0.002 + 0.057 + 0.001 avg prob of [ The Way We Was] 0.9979704022407532
loss 0.053 = 0.002 + 0.05 + 0.001 avg prob of [ The Way We Was] 0.9980331063270569
loss 0.05 = 0.002 + 0.047 + 0.001 avg prob of [ The Way We Was] 0.997965395450592
Delta norm: 14.157218933105469
Change in target norm: 3.539304733276367 to 14.655170440673828 => 11.115865707397461
Division Factor: 2.9380173683166504
Right vector norm: 4.818630218505859
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:44:36,679 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:44:36 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.85s/it]
2024-10-31 20:44:45,123 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:44:45 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:09<00:00,  9.78s/it]100%|██████████| 1/1 [00:09<00:00,  9.78s/it]
2024-10-31 20:45:01,974 - easyeditor.editors.editor - INFO - 0 editing: The gender of Timothy Sprigge is -> female  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Timothy Sprigge is', 'target_new': 'female', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Timothy Sprigge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:45:01 - INFO - easyeditor.editors.editor -   0 editing: The gender of Timothy Sprigge is -> female  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Timothy Sprigge is', 'target_new': 'female', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Timothy Sprigge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Timothy Sprigge is] -> [ female]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Timothy Sprigge
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Timothy Sprigge is | Token: ge
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.335 = 6.335 + 0.0 + 0.0 avg prob of [ female] 0.0021586937364190817
loss 4.266 = 4.224 + 0.04 + 0.001 avg prob of [ female] 0.016707878559827805
loss 1.748 = 1.5 + 0.247 + 0.001 avg prob of [ female] 0.24844326078891754
loss 0.803 = 0.648 + 0.154 + 0.001 avg prob of [ female] 0.5611811280250549
loss 0.365 = 0.278 + 0.086 + 0.001 avg prob of [ female] 0.7847640514373779
loss 0.223 = 0.194 + 0.028 + 0.001 avg prob of [ female] 0.8301780223846436
loss 0.105 = 0.013 + 0.091 + 0.001 avg prob of [ female] 0.9874200820922852
loss 0.173 = 0.163 + 0.009 + 0.001 avg prob of [ female] 0.8793061971664429
loss 0.031 = 0.005 + 0.024 + 0.001 avg prob of [ female] 0.9946394562721252
Delta norm: 13.751023292541504
Change in target norm: 3.437755823135376 to 14.147895812988281 => 10.710140228271484
Division Factor: 2.93479323387146
Right vector norm: 4.685516834259033
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:45:13,284 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:45:13 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.87s/it]
2024-10-31 20:45:21,512 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:45:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.72s/it]100%|██████████| 1/1 [00:13<00:00, 13.72s/it]
2024-10-31 20:45:41,953 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Natalia A Prado is -> dominican friar  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Natalia A Prado is', 'target_new': 'dominican friar', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Natalia A Prado'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:45:41 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Natalia A Prado is -> dominican friar  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Natalia A Prado is', 'target_new': 'dominican friar', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Natalia A Prado'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Natalia A Prado is] -> [ dominican friar]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Natalia A Prado
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Natalia A Prado is dominican fri | Token: ado
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.496 = 6.496 + 0.0 + 0.0 avg prob of [ dominican friar] 0.0016491352580487728
loss 4.532 = 4.465 + 0.066 + 0.001 avg prob of [ dominican friar] 0.012450539506971836
loss 2.858 = 2.83 + 0.027 + 0.001 avg prob of [ dominican friar] 0.06064876168966293
loss 2.108 = 1.947 + 0.16 + 0.001 avg prob of [ dominican friar] 0.14692363142967224
loss 0.875 = 0.763 + 0.112 + 0.001 avg prob of [ dominican friar] 0.46882420778274536
loss 0.264 = 0.191 + 0.072 + 0.001 avg prob of [ dominican friar] 0.8278903365135193
loss 0.231 = 0.048 + 0.182 + 0.001 avg prob of [ dominican friar] 0.9535567760467529
loss 0.97 = 0.943 + 0.026 + 0.001 avg prob of [ dominican friar] 0.39611390233039856
loss 0.519 = 0.468 + 0.049 + 0.001 avg prob of [ dominican friar] 0.6394542455673218
loss 0.188 = 0.06 + 0.127 + 0.001 avg prob of [ dominican friar] 0.9419881105422974
loss 0.067 = 0.042 + 0.024 + 0.001 avg prob of [ dominican friar] 0.9594051241874695
loss 0.036 = 0.015 + 0.02 + 0.001 avg prob of [ dominican friar] 0.985595703125
Delta norm: 13.647235870361328
Change in target norm: 3.411808967590332 to 14.043905258178711 => 10.632096290588379
Division Factor: 2.9273998737335205
Right vector norm: 4.661896705627441
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:45:53,756 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:45:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.91s/it]
2024-10-31 20:46:02,284 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:46:02 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.20s/it]100%|██████████| 1/1 [00:16<00:00, 16.20s/it]
2024-10-31 20:46:24,754 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 1956 Canadian Badminton Championships – women's doubles is associated with is -> Ivory Coast  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 1956 Canadian Badminton Championships – women's doubles is associated with is", 'target_new': 'Ivory Coast', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1956 Canadian Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:46:24 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 1956 Canadian Badminton Championships – women's doubles is associated with is -> Ivory Coast  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 1956 Canadian Badminton Championships – women's doubles is associated with is", 'target_new': 'Ivory Coast', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1956 Canadian Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 1956 Canadian Badminton Championships – women's doubles is associated with is] -> [ Ivory Coast]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1956 Canadian Badminton Championships – women's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 21 | Sentence: The name of the country which 1956 Canadian Badminton Championships – women's doubles is associated with is Ivory | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.657 = 4.657 + 0.0 + 0.0 avg prob of [ Ivory Coast] 0.010624243877828121
loss 4.442 = 3.833 + 0.609 + 0.001 avg prob of [ Ivory Coast] 0.024035397917032242
loss 3.656 = 3.581 + 0.074 + 0.001 avg prob of [ Ivory Coast] 0.03085726872086525
loss 2.594 = 2.581 + 0.013 + 0.001 avg prob of [ Ivory Coast] 0.07781113684177399
loss 1.772 = 1.718 + 0.053 + 0.001 avg prob of [ Ivory Coast] 0.1816478967666626
loss 1.532 = 1.53 + 0.001 + 0.001 avg prob of [ Ivory Coast] 0.22628766298294067
loss 0.785 = 0.782 + 0.001 + 0.001 avg prob of [ Ivory Coast] 0.4600977897644043
loss 0.358 = 0.354 + 0.003 + 0.001 avg prob of [ Ivory Coast] 0.7058894038200378
loss 0.02 = 0.015 + 0.004 + 0.001 avg prob of [ Ivory Coast] 0.9854247570037842
Delta norm: 17.911645889282227
Change in target norm: 4.477911472320557 to 18.609981536865234 => 14.132070541381836
Division Factor: 3.7589404582977295
Right vector norm: 4.765078067779541
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:46:44,165 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:46:44 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.85s/it]
2024-10-31 20:46:52,335 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:46:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.49s/it]100%|██████████| 1/1 [00:27<00:00, 27.49s/it]
2024-10-31 20:47:26,517 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Sharifah Mazlina is -> music professor  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Sharifah Mazlina is', 'target_new': 'music professor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sharifah Mazlina'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:47:26 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Sharifah Mazlina is -> music professor  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Sharifah Mazlina is', 'target_new': 'music professor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sharifah Mazlina'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Sharifah Mazlina is] -> [ music professor]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Sharifah Mazlina
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Sharifah Mazlina is music | Token: ina
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.123 = 8.123 + 0.0 + 0.0 avg prob of [ music professor] 0.0003132016281597316
loss 6.032 = 5.894 + 0.137 + 0.001 avg prob of [ music professor] 0.00298218778334558
loss 3.437 = 3.188 + 0.248 + 0.001 avg prob of [ music professor] 0.044027652591466904
loss 2.675 = 2.256 + 0.418 + 0.001 avg prob of [ music professor] 0.11054398119449615
loss 1.23 = 0.819 + 0.409 + 0.001 avg prob of [ music professor] 0.45124363899230957
loss 0.625 = 0.205 + 0.419 + 0.001 avg prob of [ music professor] 0.8168019652366638
loss 0.457 = 0.037 + 0.419 + 0.001 avg prob of [ music professor] 0.9639108180999756
loss 0.433 = 0.013 + 0.419 + 0.001 avg prob of [ music professor] 0.987473726272583
loss 0.427 = 0.006 + 0.419 + 0.001 avg prob of [ music professor] 0.993590772151947
loss 0.424 = 0.004 + 0.419 + 0.001 avg prob of [ music professor] 0.9956917762756348
loss 0.423 = 0.003 + 0.419 + 0.001 avg prob of [ music professor] 0.9967212677001953
loss 0.423 = 0.003 + 0.419 + 0.001 avg prob of [ music professor] 0.9973669648170471
loss 0.422 = 0.002 + 0.419 + 0.001 avg prob of [ music professor] 0.9978222846984863
loss 0.422 = 0.002 + 0.419 + 0.001 avg prob of [ music professor] 0.9981609582901001
loss 0.422 = 0.002 + 0.419 + 0.001 avg prob of [ music professor] 0.9984208941459656
loss 0.422 = 0.001 + 0.419 + 0.001 avg prob of [ music professor] 0.9986252784729004
loss 0.421 = 0.001 + 0.419 + 0.001 avg prob of [ music professor] 0.9987890124320984
loss 0.421 = 0.001 + 0.419 + 0.001 avg prob of [ music professor] 0.9989230036735535
loss 0.421 = 0.001 + 0.419 + 0.001 avg prob of [ music professor] 0.9990342855453491
loss 0.421 = 0.001 + 0.419 + 0.001 avg prob of [ music professor] 0.9991281628608704
loss 0.421 = 0.001 + 0.419 + 0.001 avg prob of [ music professor] 0.999208390712738
loss 0.421 = 0.001 + 0.419 + 0.001 avg prob of [ music professor] 0.9992775917053223
loss 0.421 = 0.001 + 0.419 + 0.001 avg prob of [ music professor] 0.999337911605835
loss 0.421 = 0.001 + 0.419 + 0.001 avg prob of [ music professor] 0.9993907809257507
loss 0.421 = 0.001 + 0.419 + 0.001 avg prob of [ music professor] 0.9994372725486755
Delta norm: 14.285531044006348
Change in target norm: 3.571382761001587 to 14.747913360595703 => 11.176530838012695
Division Factor: 3.019784450531006
Right vector norm: 4.730646133422852
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:47:37,875 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:47:37 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.20s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.40s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.67s/it]
2024-10-31 20:47:47,286 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:47:47 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.03s/it]100%|██████████| 1/1 [00:19<00:00, 19.03s/it]
2024-10-31 20:48:13,217 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Paulo Eduardo Capel Cardoso is -> investigator  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Paulo Eduardo Capel Cardoso is', 'target_new': 'investigator', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Paulo Eduardo Capel Cardoso'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:48:13 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Paulo Eduardo Capel Cardoso is -> investigator  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Paulo Eduardo Capel Cardoso is', 'target_new': 'investigator', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Paulo Eduardo Capel Cardoso'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Paulo Eduardo Capel Cardoso is] -> [ investigator]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Paulo Eduardo Capel Cardoso
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Paulo Eduardo Capel Cardoso is investig | Token: oso
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.387 = 5.387 + 0.0 + 0.0 avg prob of [ investigator] 0.005014458205550909
loss 4.157 = 4.114 + 0.042 + 0.001 avg prob of [ investigator] 0.01878977380692959
loss 2.747 = 2.579 + 0.168 + 0.001 avg prob of [ investigator] 0.08120493590831757
loss 1.273 = 1.246 + 0.025 + 0.001 avg prob of [ investigator] 0.30163297057151794
loss 0.45 = 0.16 + 0.29 + 0.001 avg prob of [ investigator] 0.8566097021102905
loss 0.111 = 0.012 + 0.098 + 0.001 avg prob of [ investigator] 0.9880727529525757
loss 0.154 = 0.052 + 0.101 + 0.001 avg prob of [ investigator] 0.9526488780975342
loss 0.332 = 0.008 + 0.323 + 0.001 avg prob of [ investigator] 0.992314875125885
loss 0.328 = 0.006 + 0.321 + 0.001 avg prob of [ investigator] 0.993923008441925
loss 0.322 = 0.004 + 0.317 + 0.001 avg prob of [ investigator] 0.9961766004562378
loss 0.272 = 0.005 + 0.265 + 0.001 avg prob of [ investigator] 0.994750440120697
loss 0.424 = 0.156 + 0.267 + 0.001 avg prob of [ investigator] 0.8608172535896301
loss 0.903 = 0.817 + 0.085 + 0.001 avg prob of [ investigator] 0.47317278385162354
loss 0.116 = 0.077 + 0.038 + 0.001 avg prob of [ investigator] 0.9273116588592529
loss 0.071 = 0.034 + 0.036 + 0.001 avg prob of [ investigator] 0.9664132595062256
loss 0.056 = 0.027 + 0.028 + 0.001 avg prob of [ investigator] 0.9736175537109375
loss 0.04 = 0.017 + 0.022 + 0.001 avg prob of [ investigator] 0.9833089113235474
Delta norm: 12.893782615661621
Change in target norm: 3.2234456539154053 to 13.309913635253906 => 10.086467742919922
Division Factor: 2.700239419937134
Right vector norm: 4.775051593780518
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:48:34,284 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:48:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.84s/it]
2024-10-31 20:48:42,394 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:48:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.05s/it]100%|██████████| 1/1 [00:12<00:00, 12.05s/it]
2024-10-31 20:49:00,719 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of John LaHood is -> Duchy of Magdeburg  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of John LaHood is', 'target_new': 'Duchy of Magdeburg', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'John LaHood'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:49:00 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of John LaHood is -> Duchy of Magdeburg  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of John LaHood is', 'target_new': 'Duchy of Magdeburg', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'John LaHood'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of John LaHood is] -> [ Duchy of Magdeburg]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object John LaHood
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the country of citizenship of John LaHood is Duchy of Magde | Token: ood
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.694 = 4.694 + 0.0 + 0.0 avg prob of [ Duchy of Magdeburg] 0.009426102973520756
loss 3.158 = 3.061 + 0.096 + 0.001 avg prob of [ Duchy of Magdeburg] 0.0471356026828289
loss 2.462 = 2.412 + 0.049 + 0.001 avg prob of [ Duchy of Magdeburg] 0.09053146839141846
loss 0.863 = 0.805 + 0.057 + 0.001 avg prob of [ Duchy of Magdeburg] 0.44881802797317505
loss 0.33 = 0.1 + 0.229 + 0.001 avg prob of [ Duchy of Magdeburg] 0.9051991701126099
loss 0.163 = 0.122 + 0.04 + 0.001 avg prob of [ Duchy of Magdeburg] 0.8856964111328125
loss 0.069 = 0.022 + 0.046 + 0.001 avg prob of [ Duchy of Magdeburg] 0.9786339998245239
loss 0.049 = 0.008 + 0.04 + 0.001 avg prob of [ Duchy of Magdeburg] 0.9920616149902344
Delta norm: 13.91502857208252
Change in target norm: 3.47875714302063 to 14.319524765014648 => 10.840767860412598
Division Factor: 2.8825149536132812
Right vector norm: 4.827391624450684
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:49:11,199 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:49:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.66s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.87s/it]
2024-10-31 20:49:19,259 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:49:19 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.54s/it]100%|██████████| 1/1 [00:10<00:00, 10.54s/it]
2024-10-31 20:49:36,555 - easyeditor.editors.editor - INFO - 0 editing: The gender of Mary L. Freeman is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Mary L. Freeman is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mary L. Freeman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:49:36 - INFO - easyeditor.editors.editor -   0 editing: The gender of Mary L. Freeman is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Mary L. Freeman is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mary L. Freeman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Mary L. Freeman is] -> [ cisgender woman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mary L. Freeman
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Mary L. Freeman is cisgender | Token: eman
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.209 = 4.209 + 0.0 + 0.0 avg prob of [ cisgender woman] 0.015806002542376518
loss 3.764 = 3.636 + 0.127 + 0.001 avg prob of [ cisgender woman] 0.027866553515195847
loss 2.39 = 2.332 + 0.057 + 0.001 avg prob of [ cisgender woman] 0.10329670459032059
loss 1.419 = 1.164 + 0.254 + 0.001 avg prob of [ cisgender woman] 0.3292049169540405
loss 0.793 = 0.713 + 0.079 + 0.001 avg prob of [ cisgender woman] 0.5112307667732239
loss 0.396 = 0.296 + 0.099 + 0.001 avg prob of [ cisgender woman] 0.7691943049430847
loss 0.175 = 0.103 + 0.071 + 0.001 avg prob of [ cisgender woman] 0.9031479358673096
loss 0.098 = 0.064 + 0.033 + 0.001 avg prob of [ cisgender woman] 0.9383045434951782
loss 0.045 = 0.028 + 0.017 + 0.001 avg prob of [ cisgender woman] 0.9728842377662659
Delta norm: 13.67541790008545
Change in target norm: 3.4188544750213623 to 14.187477111816406 => 10.768622398376465
Division Factor: 2.8924574851989746
Right vector norm: 4.7279582023620605
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:49:41,229 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:49:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 20:49:48,363 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:49:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.62s/it]100%|██████████| 1/1 [00:21<00:00, 21.62s/it]
2024-10-31 20:50:16,527 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Richard C Austin is -> Moscow Psychiatric Hospital No. 1  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Richard C Austin is', 'target_new': 'Moscow Psychiatric Hospital No. 1', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Richard C Austin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:50:16 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Richard C Austin is -> Moscow Psychiatric Hospital No. 1  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Richard C Austin is', 'target_new': 'Moscow Psychiatric Hospital No. 1', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Richard C Austin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Richard C Austin is] -> [ Moscow Psychiatric Hospital No. 1]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Richard C Austin
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the employer of Richard C Austin is Moscow Psychiatric Hospital No.  | Token: Austin
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.737 = 3.737 + 0.0 + 0.0 avg prob of [ Moscow Psychiatric Hospital No. 1] 0.024222053587436676
loss 2.769 = 2.655 + 0.113 + 0.001 avg prob of [ Moscow Psychiatric Hospital No. 1] 0.0706024244427681
loss 2.293 = 2.044 + 0.248 + 0.001 avg prob of [ Moscow Psychiatric Hospital No. 1] 0.12999387085437775
loss 1.571 = 1.319 + 0.251 + 0.001 avg prob of [ Moscow Psychiatric Hospital No. 1] 0.2684662342071533
loss 0.977 = 0.726 + 0.25 + 0.001 avg prob of [ Moscow Psychiatric Hospital No. 1] 0.48792266845703125
loss 0.681 = 0.43 + 0.25 + 0.001 avg prob of [ Moscow Psychiatric Hospital No. 1] 0.6511747241020203
loss 0.322 = 0.071 + 0.25 + 0.001 avg prob of [ Moscow Psychiatric Hospital No. 1] 0.9316319227218628
loss 0.293 = 0.045 + 0.247 + 0.001 avg prob of [ Moscow Psychiatric Hospital No. 1] 0.9561877846717834
loss 0.195 = 0.021 + 0.173 + 0.001 avg prob of [ Moscow Psychiatric Hospital No. 1] 0.9792339205741882
loss 1.047 = 0.953 + 0.092 + 0.001 avg prob of [ Moscow Psychiatric Hospital No. 1] 0.38768428564071655
loss 0.366 = 0.327 + 0.038 + 0.001 avg prob of [ Moscow Psychiatric Hospital No. 1] 0.7212785482406616
loss 0.157 = 0.118 + 0.038 + 0.001 avg prob of [ Moscow Psychiatric Hospital No. 1] 0.8885003924369812
loss 0.127 = 0.052 + 0.073 + 0.001 avg prob of [ Moscow Psychiatric Hospital No. 1] 0.949259340763092
loss 0.059 = 0.036 + 0.022 + 0.001 avg prob of [ Moscow Psychiatric Hospital No. 1] 0.964897632598877
loss 0.039 = 0.024 + 0.014 + 0.001 avg prob of [ Moscow Psychiatric Hospital No. 1] 0.9763932228088379
Delta norm: 12.906847953796387
Change in target norm: 3.2267117500305176 to 13.3136625289917 => 10.086950302124023
Division Factor: 2.7989871501922607
Right vector norm: 4.611256122589111
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:50:23,063 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:50:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.75s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.92s/it]
2024-10-31 20:50:31,242 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:50:31 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.75s/it]100%|██████████| 1/1 [00:14<00:00, 14.75s/it]
2024-10-31 20:50:52,978 - easyeditor.editors.editor - INFO - 0 editing: The gender of Margaret Mary Mcmullen is -> travesti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Margaret Mary Mcmullen is', 'target_new': 'travesti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Margaret Mary Mcmullen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:50:52 - INFO - easyeditor.editors.editor -   0 editing: The gender of Margaret Mary Mcmullen is -> travesti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Margaret Mary Mcmullen is', 'target_new': 'travesti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Margaret Mary Mcmullen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Margaret Mary Mcmullen is] -> [ travesti]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Margaret Mary Mcmullen
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Margaret Mary Mcmullen is trav | Token: en
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.562 = 9.562 + 0.0 + 0.0 avg prob of [ travesti] 7.79597758082673e-05
loss 8.188 = 8.184 + 0.003 + 0.001 avg prob of [ travesti] 0.0003138301253784448
loss 5.934 = 5.913 + 0.02 + 0.001 avg prob of [ travesti] 0.0028291104827076197
loss 5.791 = 5.714 + 0.075 + 0.001 avg prob of [ travesti] 0.0035425187088549137
loss 3.686 = 3.614 + 0.071 + 0.001 avg prob of [ travesti] 0.02819691225886345
loss 2.62 = 2.609 + 0.01 + 0.001 avg prob of [ travesti] 0.09272371977567673
loss 0.778 = 0.582 + 0.194 + 0.001 avg prob of [ travesti] 0.5909475088119507
loss 0.853 = 0.771 + 0.081 + 0.001 avg prob of [ travesti] 0.49443700909614563
loss 0.687 = 0.664 + 0.022 + 0.001 avg prob of [ travesti] 0.5781397223472595
loss 0.321 = 0.299 + 0.02 + 0.001 avg prob of [ travesti] 0.7508931756019592
loss 0.199 = 0.16 + 0.038 + 0.001 avg prob of [ travesti] 0.853993833065033
loss 0.093 = 0.058 + 0.033 + 0.001 avg prob of [ travesti] 0.9438333511352539
loss 0.04 = 0.02 + 0.019 + 0.001 avg prob of [ travesti] 0.9799389839172363
Delta norm: 12.649097442626953
Change in target norm: 3.1622743606567383 to 13.091353416442871 => 9.929079055786133
Division Factor: 2.7049243450164795
Right vector norm: 4.676321983337402
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:51:01,038 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:51:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.20s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.43s/it]
2024-10-31 20:51:09,020 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:51:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.26s/it]100%|██████████| 1/1 [00:25<00:00, 25.26s/it]
2024-10-31 20:51:41,481 - easyeditor.editors.editor - INFO - 0 editing: The gender of Xu Hang is -> trans man  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Xu Hang is', 'target_new': 'trans man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Xu Hang'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:51:41 - INFO - easyeditor.editors.editor -   0 editing: The gender of Xu Hang is -> trans man  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Xu Hang is', 'target_new': 'trans man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Xu Hang'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Xu Hang is] -> [ trans man]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Xu Hang
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Xu Hang is trans | Token: ang
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.847 = 7.847 + 0.0 + 0.0 avg prob of [ trans man] 0.0004367662186268717
loss 5.323 = 5.149 + 0.173 + 0.001 avg prob of [ trans man] 0.006455999333411455
loss 3.814 = 3.532 + 0.281 + 0.001 avg prob of [ trans man] 0.030543571338057518
loss 2.285 = 2.003 + 0.281 + 0.001 avg prob of [ trans man] 0.1421026587486267
loss 0.87 = 0.586 + 0.282 + 0.001 avg prob of [ trans man] 0.5610994696617126
loss 0.402 = 0.12 + 0.281 + 0.001 avg prob of [ trans man] 0.8874679207801819
loss 0.309 = 0.035 + 0.273 + 0.001 avg prob of [ trans man] 0.9655892848968506
loss 0.284 = 0.022 + 0.26 + 0.001 avg prob of [ trans man] 0.9778825640678406
loss 0.205 = 0.027 + 0.178 + 0.001 avg prob of [ trans man] 0.9738108515739441
loss 0.908 = 0.844 + 0.063 + 0.001 avg prob of [ trans man] 0.4386042654514313
loss 0.588 = 0.304 + 0.283 + 0.001 avg prob of [ trans man] 0.744101881980896
loss 0.453 = 0.169 + 0.282 + 0.001 avg prob of [ trans man] 0.8513315320014954
loss 0.335 = 0.052 + 0.282 + 0.001 avg prob of [ trans man] 0.9514614343643188
loss 0.297 = 0.014 + 0.282 + 0.001 avg prob of [ trans man] 0.9862421154975891
loss 0.289 = 0.005 + 0.282 + 0.001 avg prob of [ trans man] 0.9948220252990723
loss 0.286 = 0.003 + 0.282 + 0.001 avg prob of [ trans man] 0.9972741603851318
loss 0.285 = 0.002 + 0.282 + 0.001 avg prob of [ trans man] 0.9981829524040222
loss 0.285 = 0.001 + 0.282 + 0.001 avg prob of [ trans man] 0.9986065030097961
loss 0.285 = 0.001 + 0.282 + 0.001 avg prob of [ trans man] 0.9988427758216858
loss 0.284 = 0.001 + 0.282 + 0.001 avg prob of [ trans man] 0.998991847038269
loss 0.284 = 0.001 + 0.282 + 0.001 avg prob of [ trans man] 0.9990922808647156
loss 0.284 = 0.001 + 0.282 + 0.001 avg prob of [ trans man] 0.9991605281829834
loss 0.284 = 0.001 + 0.282 + 0.001 avg prob of [ trans man] 0.9992020130157471
loss 0.283 = 0.001 + 0.282 + 0.001 avg prob of [ trans man] 0.999212920665741
loss 0.283 = 0.001 + 0.281 + 0.001 avg prob of [ trans man] 0.9991661310195923
Delta norm: 14.543519973754883
Change in target norm: 3.6358802318573 to 15.022703170776367 => 11.386822700500488
Division Factor: 3.0805888175964355
Right vector norm: 4.721019268035889
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:52:18,703 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:52:18 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.90s/it]
2024-10-31 20:52:27,304 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:52:27 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.55s/it]100%|██████████| 1/1 [00:30<00:00, 30.55s/it]
2024-10-31 20:53:04,072 - easyeditor.editors.editor - INFO - 0 editing: 1841 Mississippi Census is followed by -> Air Mobility Command  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1841 Mississippi Census is followed by', 'target_new': 'Air Mobility Command', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1841 Mississippi Census'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:53:04 - INFO - easyeditor.editors.editor -   0 editing: 1841 Mississippi Census is followed by -> Air Mobility Command  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1841 Mississippi Census is followed by', 'target_new': 'Air Mobility Command', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1841 Mississippi Census'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1841 Mississippi Census is followed by] -> [ Air Mobility Command]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1841 Mississippi Census
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: 1841 Mississippi Census is followed by Air Mobility | Token: Census
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.179 = 5.179 + 0.0 + 0.0 avg prob of [ Air Mobility Command] 0.005810225382447243
loss 4.298 = 4.006 + 0.292 + 0.001 avg prob of [ Air Mobility Command] 0.01858493499457836
loss 3.759 = 3.66 + 0.098 + 0.001 avg prob of [ Air Mobility Command] 0.026010973379015923
loss 2.778 = 2.661 + 0.116 + 0.001 avg prob of [ Air Mobility Command] 0.07036060094833374
loss 1.37 = 1.259 + 0.11 + 0.001 avg prob of [ Air Mobility Command] 0.2997601330280304
loss 1.688 = 1.539 + 0.149 + 0.001 avg prob of [ Air Mobility Command] 0.26048335433006287
loss 0.768 = 0.654 + 0.113 + 0.001 avg prob of [ Air Mobility Command] 0.5251622796058655
loss 1.198 = 0.795 + 0.403 + 0.001 avg prob of [ Air Mobility Command] 0.4546066224575043
loss 0.405 = 0.291 + 0.113 + 0.001 avg prob of [ Air Mobility Command] 0.7509559392929077
loss 0.193 = 0.08 + 0.112 + 0.001 avg prob of [ Air Mobility Command] 0.9233954548835754
loss 0.301 = 0.032 + 0.268 + 0.001 avg prob of [ Air Mobility Command] 0.9684538245201111
loss 0.42 = 0.307 + 0.112 + 0.001 avg prob of [ Air Mobility Command] 0.743116021156311
loss 0.155 = 0.071 + 0.083 + 0.001 avg prob of [ Air Mobility Command] 0.9323210120201111
loss 0.17 = 0.071 + 0.098 + 0.001 avg prob of [ Air Mobility Command] 0.9335817694664001
loss 0.107 = 0.008 + 0.098 + 0.001 avg prob of [ Air Mobility Command] 0.992529571056366
loss 0.104 = 0.005 + 0.098 + 0.001 avg prob of [ Air Mobility Command] 0.9951120018959045
loss 0.103 = 0.004 + 0.098 + 0.001 avg prob of [ Air Mobility Command] 0.9959943890571594
loss 0.103 = 0.004 + 0.098 + 0.001 avg prob of [ Air Mobility Command] 0.9964524507522583
loss 0.102 = 0.003 + 0.098 + 0.001 avg prob of [ Air Mobility Command] 0.9968663454055786
loss 0.102 = 0.003 + 0.098 + 0.001 avg prob of [ Air Mobility Command] 0.9972916841506958
loss 0.101 = 0.002 + 0.098 + 0.001 avg prob of [ Air Mobility Command] 0.9977039098739624
loss 0.101 = 0.002 + 0.098 + 0.001 avg prob of [ Air Mobility Command] 0.998076319694519
loss 0.101 = 0.002 + 0.098 + 0.001 avg prob of [ Air Mobility Command] 0.9983962178230286
loss 0.1 = 0.001 + 0.098 + 0.001 avg prob of [ Air Mobility Command] 0.998662531375885
loss 0.1 = 0.001 + 0.098 + 0.001 avg prob of [ Air Mobility Command] 0.9988803863525391
Delta norm: 19.485692977905273
Change in target norm: 4.871423721313477 to 20.260051727294922 => 15.388628005981445
Division Factor: 3.923902750015259
Right vector norm: 4.965896129608154
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:53:10,257 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:53:10 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-10-31 20:53:18,126 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:53:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]100%|██████████| 1/1 [00:27<00:00, 27.41s/it]
2024-10-31 20:53:52,684 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Ariane Mutzel is -> tollkeeper  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ariane Mutzel is', 'target_new': 'tollkeeper', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ariane Mutzel'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:53:52 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Ariane Mutzel is -> tollkeeper  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ariane Mutzel is', 'target_new': 'tollkeeper', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ariane Mutzel'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Ariane Mutzel is] -> [ tollkeeper]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ariane Mutzel
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Ariane Mutzel is toll | Token: el
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.606 = 6.606 + 0.0 + 0.0 avg prob of [ tollkeeper] 0.0014088652096688747
loss 5.364 = 5.241 + 0.122 + 0.001 avg prob of [ tollkeeper] 0.005543595179915428
loss 3.185 = 3.101 + 0.083 + 0.001 avg prob of [ tollkeeper] 0.047331713140010834
loss 2.693 = 2.487 + 0.204 + 0.001 avg prob of [ tollkeeper] 0.08728429675102234
loss 1.457 = 1.31 + 0.146 + 0.001 avg prob of [ tollkeeper] 0.27576711773872375
loss 0.858 = 0.781 + 0.076 + 0.001 avg prob of [ tollkeeper] 0.4629427194595337
loss 0.41 = 0.188 + 0.221 + 0.001 avg prob of [ tollkeeper] 0.8403016924858093
loss 0.855 = 0.662 + 0.192 + 0.001 avg prob of [ tollkeeper] 0.5360530614852905
loss 0.46 = 0.17 + 0.288 + 0.001 avg prob of [ tollkeeper] 0.8492869734764099
loss 1.094 = 0.805 + 0.287 + 0.001 avg prob of [ tollkeeper] 0.4753306210041046
loss 0.448 = 0.158 + 0.289 + 0.001 avg prob of [ tollkeeper] 0.8577117919921875
loss 0.358 = 0.068 + 0.289 + 0.001 avg prob of [ tollkeeper] 0.9408556818962097
loss 0.304 = 0.014 + 0.288 + 0.001 avg prob of [ tollkeeper] 0.9858080744743347
loss 0.302 = 0.013 + 0.288 + 0.001 avg prob of [ tollkeeper] 0.9870702028274536
loss 0.299 = 0.01 + 0.287 + 0.001 avg prob of [ tollkeeper] 0.9895728826522827
loss 0.296 = 0.008 + 0.287 + 0.001 avg prob of [ tollkeeper] 0.9917106628417969
loss 0.293 = 0.007 + 0.285 + 0.001 avg prob of [ tollkeeper] 0.9930757284164429
loss 0.29 = 0.006 + 0.283 + 0.001 avg prob of [ tollkeeper] 0.9937219619750977
loss 0.285 = 0.006 + 0.277 + 0.001 avg prob of [ tollkeeper] 0.9935882687568665
loss 0.274 = 0.008 + 0.265 + 0.001 avg prob of [ tollkeeper] 0.9920758008956909
loss 0.251 = 0.013 + 0.237 + 0.001 avg prob of [ tollkeeper] 0.9869751930236816
loss 0.212 = 0.027 + 0.183 + 0.001 avg prob of [ tollkeeper] 0.9731200933456421
loss 0.165 = 0.047 + 0.117 + 0.001 avg prob of [ tollkeeper] 0.9546089172363281
loss 0.098 = 0.016 + 0.08 + 0.001 avg prob of [ tollkeeper] 0.9837663173675537
loss 0.085 = 0.004 + 0.08 + 0.001 avg prob of [ tollkeeper] 0.9962946772575378
Delta norm: 13.250493049621582
Change in target norm: 3.3126232624053955 to 13.560678482055664 => 10.248055458068848
Division Factor: 2.8055713176727295
Right vector norm: 4.722921371459961
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:54:32,101 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:54:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.91s/it]
2024-10-31 20:54:40,269 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:54:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.32s/it]100%|██████████| 1/1 [00:19<00:00, 19.32s/it]
2024-10-31 20:55:06,077 - easyeditor.editors.editor - INFO - 0 editing: 2007 Vietnam International Badminton Championships – mixed doubles follows -> 1978 US Badminton Championships – mixed doubles  

 {'pre': {'rewrite_acc': [0.3076923076923077], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '2007 Vietnam International Badminton Championships – mixed doubles follows', 'target_new': '1978 US Badminton Championships – mixed doubles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2007 Vietnam International Badminton Championships – mixed doubles'}, 'post': {'rewrite_acc': [0.9230769230769231], 'locality': {}, 'portability': {}}}
10/31/2024 20:55:06 - INFO - easyeditor.editors.editor -   0 editing: 2007 Vietnam International Badminton Championships – mixed doubles follows -> 1978 US Badminton Championships – mixed doubles  

 {'pre': {'rewrite_acc': [0.3076923076923077], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '2007 Vietnam International Badminton Championships – mixed doubles follows', 'target_new': '1978 US Badminton Championships – mixed doubles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2007 Vietnam International Badminton Championships – mixed doubles'}, 'post': {'rewrite_acc': [0.9230769230769231], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2007 Vietnam International Badminton Championships – mixed doubles follows] -> [ 1978 US Badminton Championships – mixed doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2007 Vietnam International Badminton Championships – mixed doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: 2007 Vietnam International Badminton Championships – mixed doubles follows 1978 US Badminton Championships – mixed | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.12 = 3.12 + 0.0 + 0.0 avg prob of [ 1978 US Badminton Championships – mixed doubles] 0.04450352489948273
loss 2.471 = 2.466 + 0.005 + 0.001 avg prob of [ 1978 US Badminton Championships – mixed doubles] 0.08587891608476639
loss 1.683 = 1.569 + 0.113 + 0.001 avg prob of [ 1978 US Badminton Championships – mixed doubles] 0.2093837410211563
loss 1.605 = 1.6 + 0.004 + 0.001 avg prob of [ 1978 US Badminton Championships – mixed doubles] 0.20280732214450836
loss 1.18 = 1.174 + 0.005 + 0.001 avg prob of [ 1978 US Badminton Championships – mixed doubles] 0.31133002042770386
loss 0.723 = 0.714 + 0.009 + 0.001 avg prob of [ 1978 US Badminton Championships – mixed doubles] 0.49346932768821716
loss 0.482 = 0.319 + 0.162 + 0.001 avg prob of [ 1978 US Badminton Championships – mixed doubles] 0.7291131019592285
loss 0.592 = 0.586 + 0.006 + 0.001 avg prob of [ 1978 US Badminton Championships – mixed doubles] 0.5620812773704529
loss 0.249 = 0.242 + 0.006 + 0.001 avg prob of [ 1978 US Badminton Championships – mixed doubles] 0.7890831232070923
loss 0.111 = 0.104 + 0.006 + 0.001 avg prob of [ 1978 US Badminton Championships – mixed doubles] 0.9012896418571472
loss 0.038 = 0.031 + 0.006 + 0.001 avg prob of [ 1978 US Badminton Championships – mixed doubles] 0.9690841436386108
Delta norm: 18.597612380981445
Change in target norm: 4.6494035720825195 to 19.31685447692871 => 14.667450904846191
Division Factor: 3.9254894256591797
Right vector norm: 4.737654685974121
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3076923076923077}, 'post': {'rewrite_acc': 0.9230769230769231}}
2024-10-31 20:55:20,469 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:55:20 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.36s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.81s/it]
2024-10-31 20:55:28,539 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:55:28 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:36<00:00, 36.29s/it]100%|██████████| 1/1 [00:36<00:00, 36.29s/it]
2024-10-31 20:56:11,754 - easyeditor.editors.editor - INFO - 0 editing: The name of the spouse of Mitzi E. Newhouse is -> Ion James Muirhead Williams  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Mitzi E. Newhouse is', 'target_new': 'Ion James Muirhead Williams', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mitzi E. Newhouse'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:56:11 - INFO - easyeditor.editors.editor -   0 editing: The name of the spouse of Mitzi E. Newhouse is -> Ion James Muirhead Williams  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Mitzi E. Newhouse is', 'target_new': 'Ion James Muirhead Williams', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mitzi E. Newhouse'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the spouse of Mitzi E. Newhouse is] -> [ Ion James Muirhead Williams]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mitzi E. Newhouse
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the spouse of Mitzi E. Newhouse is Ion James Muirhead | Token: house
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.732 = 7.732 + 0.0 + 0.0 avg prob of [ Ion James Muirhead Williams] 0.0004507388803176582
loss 6.604 = 6.359 + 0.243 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.0017719492316246033
loss 5.295 = 4.996 + 0.298 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.006831280887126923
loss 4.143 = 3.612 + 0.53 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.02757866121828556
loss 3.919 = 3.411 + 0.507 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.03376762196421623
loss 4.082 = 3.772 + 0.309 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.02353988215327263
loss 2.759 = 2.458 + 0.3 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.08911772072315216
loss 2.189 = 1.785 + 0.403 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.17124156653881073
loss 1.621 = 1.348 + 0.273 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.26288387179374695
loss 1.262 = 1.031 + 0.23 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.36098402738571167
loss 0.678 = 0.446 + 0.231 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.6425734758377075
loss 0.326 = 0.108 + 0.217 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.8982112407684326
loss 0.265 = 0.037 + 0.227 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.9633691310882568
loss 0.274 = 0.024 + 0.248 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.9760899543762207
loss 0.231 = 0.013 + 0.217 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.9868833422660828
loss 0.225 = 0.008 + 0.216 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.9924857020378113
loss 0.225 = 0.006 + 0.219 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.9944908618927002
loss 0.214 = 0.004 + 0.21 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.9964250922203064
loss 0.23 = 0.003 + 0.226 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.9969518780708313
loss 0.217 = 0.003 + 0.213 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.9971019625663757
loss 0.215 = 0.003 + 0.211 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.9970136284828186
loss 0.21 = 0.003 + 0.205 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.996830940246582
loss 0.205 = 0.003 + 0.201 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.996765673160553
loss 0.206 = 0.003 + 0.202 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.9968980550765991
loss 0.204 = 0.003 + 0.2 + 0.001 avg prob of [ Ion James Muirhead Williams] 0.9971162676811218
Delta norm: 14.337389945983887
Change in target norm: 3.584347724914551 to 14.759442329406738 => 11.175094604492188
Division Factor: 3.007972002029419
Right vector norm: 4.7664642333984375
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:56:17,478 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:56:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-10-31 20:56:24,567 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:56:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.80s/it]100%|██████████| 1/1 [00:15<00:00, 15.80s/it]
2024-10-31 20:56:47,403 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Helga Dudzinski is -> Américo de Campos  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Helga Dudzinski is', 'target_new': 'Américo de Campos', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Helga Dudzinski'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:56:47 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Helga Dudzinski is -> Américo de Campos  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Helga Dudzinski is', 'target_new': 'Américo de Campos', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Helga Dudzinski'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Helga Dudzinski is] -> [ Américo de Campos]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Helga Dudzinski
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The place of birth of Helga Dudzinski is Américo de Cam | Token: ski
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.388 = 6.388 + 0.0 + 0.0 avg prob of [ Américo de Campos] 0.0017840468790382147
loss 6.276 = 6.23 + 0.045 + 0.001 avg prob of [ Américo de Campos] 0.0020200535655021667
loss 5.201 = 5.19 + 0.009 + 0.001 avg prob of [ Américo de Campos] 0.005680935923010111
loss 4.006 = 3.988 + 0.016 + 0.001 avg prob of [ Américo de Campos] 0.018887992948293686
loss 2.616 = 2.576 + 0.039 + 0.001 avg prob of [ Américo de Campos] 0.07719436287879944
loss 2.041 = 1.994 + 0.046 + 0.001 avg prob of [ Américo de Campos] 0.14091862738132477
loss 0.977 = 0.895 + 0.081 + 0.001 avg prob of [ Américo de Campos] 0.41452232003211975
loss 0.243 = 0.127 + 0.115 + 0.001 avg prob of [ Américo de Campos] 0.8819127082824707
loss 0.136 = 0.094 + 0.041 + 0.001 avg prob of [ Américo de Campos] 0.9127004742622375
loss 0.256 = 0.017 + 0.238 + 0.001 avg prob of [ Américo de Campos] 0.9833266735076904
loss 0.175 = 0.149 + 0.024 + 0.001 avg prob of [ Américo de Campos] 0.8644471168518066
loss 0.042 = 0.024 + 0.017 + 0.001 avg prob of [ Américo de Campos] 0.9759613275527954
Delta norm: 12.558337211608887
Change in target norm: 3.1395843029022217 to 12.845863342285156 => 9.706278800964355
Division Factor: 2.6797327995300293
Right vector norm: 4.686413764953613
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.16666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:56:52,860 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:56:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.15s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.38s/it]
2024-10-31 20:56:59,936 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:56:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.09s/it]100%|██████████| 1/1 [00:26<00:00, 26.09s/it]
2024-10-31 20:57:33,218 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Ana D Goode is -> permaculture  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ana D Goode is', 'target_new': 'permaculture', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ana D Goode'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:57:33 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Ana D Goode is -> permaculture  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ana D Goode is', 'target_new': 'permaculture', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ana D Goode'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Ana D Goode is] -> [ permaculture]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ana D Goode
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Ana D Goode is permac | Token: ode
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.994 = 4.994 + 0.0 + 0.0 avg prob of [ permaculture] 0.007553255185484886
loss 4.386 = 4.174 + 0.211 + 0.001 avg prob of [ permaculture] 0.016052978113293648
loss 3.112 = 2.885 + 0.225 + 0.001 avg prob of [ permaculture] 0.05697055160999298
loss 2.111 = 1.894 + 0.216 + 0.001 avg prob of [ permaculture] 0.15488633513450623
loss 0.509 = 0.27 + 0.238 + 0.001 avg prob of [ permaculture] 0.7646554708480835
loss 0.257 = 0.019 + 0.236 + 0.001 avg prob of [ permaculture] 0.9809764623641968
loss 0.72 = 0.461 + 0.258 + 0.001 avg prob of [ permaculture] 0.634404182434082
loss 0.315 = 0.061 + 0.253 + 0.001 avg prob of [ permaculture] 0.94132399559021
loss 0.308 = 0.055 + 0.253 + 0.001 avg prob of [ permaculture] 0.9470728039741516
loss 0.28 = 0.026 + 0.253 + 0.001 avg prob of [ permaculture] 0.9744493365287781
loss 0.266 = 0.012 + 0.253 + 0.001 avg prob of [ permaculture] 0.9882625341415405
loss 0.261 = 0.006 + 0.253 + 0.001 avg prob of [ permaculture] 0.9936119318008423
loss 0.259 = 0.004 + 0.253 + 0.001 avg prob of [ permaculture] 0.9957213997840881
loss 0.258 = 0.003 + 0.253 + 0.001 avg prob of [ permaculture] 0.9967610836029053
loss 0.257 = 0.003 + 0.253 + 0.001 avg prob of [ permaculture] 0.9973732233047485
loss 0.257 = 0.002 + 0.253 + 0.001 avg prob of [ permaculture] 0.9977808594703674
loss 0.256 = 0.002 + 0.253 + 0.001 avg prob of [ permaculture] 0.9980766177177429
loss 0.256 = 0.002 + 0.253 + 0.001 avg prob of [ permaculture] 0.9983041286468506
loss 0.256 = 0.002 + 0.253 + 0.001 avg prob of [ permaculture] 0.9984866976737976
loss 0.256 = 0.001 + 0.253 + 0.001 avg prob of [ permaculture] 0.9986377358436584
loss 0.256 = 0.001 + 0.253 + 0.001 avg prob of [ permaculture] 0.9987655282020569
loss 0.255 = 0.001 + 0.253 + 0.001 avg prob of [ permaculture] 0.9988754987716675
loss 0.255 = 0.001 + 0.253 + 0.001 avg prob of [ permaculture] 0.9989715218544006
loss 0.255 = 0.001 + 0.253 + 0.001 avg prob of [ permaculture] 0.9990562200546265
loss 0.255 = 0.001 + 0.253 + 0.001 avg prob of [ permaculture] 0.9991317391395569
Delta norm: 13.255634307861328
Change in target norm: 3.313908576965332 to 13.674148559570312 => 10.36023998260498
Division Factor: 2.8417608737945557
Right vector norm: 4.664584636688232
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:57:53,052 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:57:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.83s/it]
2024-10-31 20:58:02,017 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:58:02 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.74s/it]100%|██████████| 1/1 [00:13<00:00, 13.74s/it]
2024-10-31 20:58:22,368 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Aleksandre Koberidze is -> French Indochina  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Aleksandre Koberidze is', 'target_new': 'French Indochina', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Aleksandre Koberidze'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:58:22 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Aleksandre Koberidze is -> French Indochina  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Aleksandre Koberidze is', 'target_new': 'French Indochina', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Aleksandre Koberidze'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Aleksandre Koberidze is] -> [ French Indochina]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Aleksandre Koberidze
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The name of the country of citizenship of Aleksandre Koberidze is French Indoch | Token: ze
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.793 = 6.793 + 0.0 + 0.0 avg prob of [ French Indochina] 0.0012906631454825401
loss 4.45 = 4.406 + 0.042 + 0.001 avg prob of [ French Indochina] 0.012609150260686874
loss 1.538 = 1.499 + 0.038 + 0.001 avg prob of [ French Indochina] 0.23053550720214844
loss 0.495 = 0.187 + 0.308 + 0.001 avg prob of [ French Indochina] 0.8345589637756348
loss 0.234 = 0.036 + 0.197 + 0.001 avg prob of [ French Indochina] 0.965178906917572
loss 0.177 = 0.122 + 0.054 + 0.001 avg prob of [ French Indochina] 0.8859580159187317
loss 0.051 = 0.01 + 0.04 + 0.001 avg prob of [ French Indochina] 0.9899283051490784
loss 0.06 = 0.006 + 0.053 + 0.001 avg prob of [ French Indochina] 0.9938492774963379
loss 0.039 = 0.008 + 0.03 + 0.001 avg prob of [ French Indochina] 0.9924194812774658
Delta norm: 15.665974617004395
Change in target norm: 3.9164936542510986 to 16.190410614013672 => 12.273917198181152
Division Factor: 3.3348007202148438
Right vector norm: 4.697724342346191
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:58:33,380 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:58:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.31s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.43s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.72s/it]
2024-10-31 20:58:41,248 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:58:41 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.56s/it]100%|██████████| 1/1 [00:30<00:00, 30.56s/it]
2024-10-31 20:59:18,588 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Nelli Khabibullina is -> video game designer  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Nelli Khabibullina is', 'target_new': 'video game designer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nelli Khabibullina'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 20:59:18 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Nelli Khabibullina is -> video game designer  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Nelli Khabibullina is', 'target_new': 'video game designer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nelli Khabibullina'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Nelli Khabibullina is] -> [ video game designer]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Nelli Khabibullina
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Nelli Khabibullina is video game | Token: ina
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.35 = 5.35 + 0.0 + 0.0 avg prob of [ video game designer] 0.005207519978284836
loss 4.4 = 4.38 + 0.019 + 0.001 avg prob of [ video game designer] 0.01305866427719593
loss 3.813 = 3.779 + 0.033 + 0.001 avg prob of [ video game designer] 0.024901103228330612
loss 2.194 = 1.964 + 0.229 + 0.001 avg prob of [ video game designer] 0.14702215790748596
loss 1.044 = 0.963 + 0.08 + 0.001 avg prob of [ video game designer] 0.39300501346588135
loss 0.218 = 0.148 + 0.069 + 0.001 avg prob of [ video game designer] 0.8640323877334595
loss 0.108 = 0.04 + 0.067 + 0.001 avg prob of [ video game designer] 0.9634683728218079
loss 0.056 = 0.011 + 0.045 + 0.001 avg prob of [ video game designer] 0.9894132614135742
loss 0.145 = 0.01 + 0.134 + 0.001 avg prob of [ video game designer] 0.989938497543335
loss 0.144 = 0.009 + 0.134 + 0.001 avg prob of [ video game designer] 0.9911122918128967
loss 0.142 = 0.007 + 0.134 + 0.001 avg prob of [ video game designer] 0.9931170344352722
loss 0.14 = 0.005 + 0.134 + 0.001 avg prob of [ video game designer] 0.99491286277771
loss 0.139 = 0.004 + 0.134 + 0.001 avg prob of [ video game designer] 0.9961903095245361
loss 0.138 = 0.003 + 0.134 + 0.001 avg prob of [ video game designer] 0.9970515370368958
loss 0.138 = 0.002 + 0.134 + 0.001 avg prob of [ video game designer] 0.9976373314857483
loss 0.137 = 0.002 + 0.134 + 0.001 avg prob of [ video game designer] 0.9980480670928955
loss 0.137 = 0.002 + 0.134 + 0.001 avg prob of [ video game designer] 0.9983462691307068
loss 0.137 = 0.001 + 0.134 + 0.001 avg prob of [ video game designer] 0.998570442199707
loss 0.136 = 0.001 + 0.134 + 0.001 avg prob of [ video game designer] 0.998744010925293
loss 0.136 = 0.001 + 0.134 + 0.001 avg prob of [ video game designer] 0.9988821148872375
loss 0.136 = 0.001 + 0.134 + 0.001 avg prob of [ video game designer] 0.9989945888519287
loss 0.136 = 0.001 + 0.134 + 0.001 avg prob of [ video game designer] 0.9990875720977783
loss 0.136 = 0.001 + 0.134 + 0.001 avg prob of [ video game designer] 0.9991657733917236
loss 0.135 = 0.001 + 0.134 + 0.001 avg prob of [ video game designer] 0.9992319941520691
loss 0.135 = 0.001 + 0.133 + 0.001 avg prob of [ video game designer] 0.9992884993553162
Delta norm: 15.79909610748291
Change in target norm: 3.9497740268707275 to 16.239988327026367 => 12.290214538574219
Division Factor: 3.2953429222106934
Right vector norm: 4.794371128082275
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 20:59:41,013 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 20:59:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.83s/it]
2024-10-31 20:59:48,985 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 20:59:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.70s/it]100%|██████████| 1/1 [00:30<00:00, 30.70s/it]
2024-10-31 21:00:26,167 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Neil C. Hyatt is -> Western Research Institute  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Neil C. Hyatt is', 'target_new': 'Western Research Institute', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Neil C. Hyatt'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:00:26 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Neil C. Hyatt is -> Western Research Institute  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Neil C. Hyatt is', 'target_new': 'Western Research Institute', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Neil C. Hyatt'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Neil C. Hyatt is] -> [ Western Research Institute]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Neil C. Hyatt
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the employer of Neil C. Hyatt is Western Research | Token: att
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.451 = 6.451 + 0.0 + 0.0 avg prob of [ Western Research Institute] 0.0016150735318660736
loss 4.294 = 4.265 + 0.028 + 0.001 avg prob of [ Western Research Institute] 0.01424178946763277
loss 4.199 = 4.155 + 0.043 + 0.001 avg prob of [ Western Research Institute] 0.016691867262125015
loss 3.509 = 3.303 + 0.205 + 0.001 avg prob of [ Western Research Institute] 0.03960792347788811
loss 2.131 = 2.078 + 0.052 + 0.001 avg prob of [ Western Research Institute] 0.1270851194858551
loss 0.872 = 0.585 + 0.286 + 0.001 avg prob of [ Western Research Institute] 0.5615208148956299
loss 0.57 = 0.27 + 0.299 + 0.001 avg prob of [ Western Research Institute] 0.7668712139129639
loss 0.406 = 0.103 + 0.302 + 0.001 avg prob of [ Western Research Institute] 0.9031749963760376
loss 0.363 = 0.061 + 0.302 + 0.001 avg prob of [ Western Research Institute] 0.9415232539176941
loss 0.329 = 0.03 + 0.297 + 0.001 avg prob of [ Western Research Institute] 0.9702831506729126
loss 0.302 = 0.022 + 0.279 + 0.001 avg prob of [ Western Research Institute] 0.9784039258956909
loss 0.18 = 0.041 + 0.138 + 0.001 avg prob of [ Western Research Institute] 0.9595193862915039
loss 0.4 = 0.374 + 0.025 + 0.001 avg prob of [ Western Research Institute] 0.6916618347167969
loss 0.302 = 0.01 + 0.291 + 0.001 avg prob of [ Western Research Institute] 0.9899359345436096
loss 0.316 = 0.014 + 0.301 + 0.001 avg prob of [ Western Research Institute] 0.9860884547233582
loss 0.318 = 0.017 + 0.3 + 0.001 avg prob of [ Western Research Institute] 0.9829820394515991
loss 0.314 = 0.016 + 0.298 + 0.001 avg prob of [ Western Research Institute] 0.9845683574676514
loss 0.306 = 0.012 + 0.293 + 0.001 avg prob of [ Western Research Institute] 0.9881063103675842
loss 0.295 = 0.01 + 0.284 + 0.001 avg prob of [ Western Research Institute] 0.9900885224342346
loss 0.277 = 0.01 + 0.266 + 0.001 avg prob of [ Western Research Institute] 0.9898601174354553
loss 0.247 = 0.013 + 0.232 + 0.001 avg prob of [ Western Research Institute] 0.9866533279418945
loss 0.199 = 0.022 + 0.176 + 0.001 avg prob of [ Western Research Institute] 0.978249728679657
loss 0.141 = 0.037 + 0.102 + 0.001 avg prob of [ Western Research Institute] 0.9636428356170654
loss 0.09 = 0.043 + 0.046 + 0.001 avg prob of [ Western Research Institute] 0.9580730199813843
loss 0.044 = 0.022 + 0.021 + 0.001 avg prob of [ Western Research Institute] 0.9783650636672974
Delta norm: 13.169432640075684
Change in target norm: 3.292358160018921 to 13.524165153503418 => 10.231806755065918
Division Factor: 2.841029644012451
Right vector norm: 4.635443687438965
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:00:56,612 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:00:56 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.80s/it]
2024-10-31 21:01:05,694 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:01:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:36<00:00, 36.29s/it]100%|██████████| 1/1 [00:36<00:00, 36.29s/it]
2024-10-31 21:01:48,554 - easyeditor.editors.editor - INFO - 0 editing: transit of Venus, 1874 follows -> 90713 Chajnantor  

 {'pre': {'rewrite_acc': [0.3], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'transit of Venus, 1874 follows', 'target_new': '90713 Chajnantor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'transit of Venus, 1874'}, 'post': {'rewrite_acc': [0.9], 'locality': {}, 'portability': {}}}
10/31/2024 21:01:48 - INFO - easyeditor.editors.editor -   0 editing: transit of Venus, 1874 follows -> 90713 Chajnantor  

 {'pre': {'rewrite_acc': [0.3], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'transit of Venus, 1874 follows', 'target_new': '90713 Chajnantor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'transit of Venus, 1874'}, 'post': {'rewrite_acc': [0.9], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [transit of Venus, 1874 follows] -> [ 90713 Chajnantor]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object transit of Venus, 1874
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: transit of Venus, 1874 follows 90713 Chajnant | Token: 4
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.028 = 5.028 + 0.0 + 0.0 avg prob of [ 90713 Chajnantor] 0.006681501865386963
loss 4.672 = 4.642 + 0.028 + 0.001 avg prob of [ 90713 Chajnantor] 0.009818308986723423
loss 4.256 = 4.24 + 0.016 + 0.001 avg prob of [ 90713 Chajnantor] 0.01451258733868599
loss 3.672 = 3.659 + 0.012 + 0.001 avg prob of [ 90713 Chajnantor] 0.02595144882798195
loss 3.356 = 3.346 + 0.009 + 0.001 avg prob of [ 90713 Chajnantor] 0.03531376272439957
loss 3.068 = 3.055 + 0.011 + 0.001 avg prob of [ 90713 Chajnantor] 0.048037800937891006
loss 2.674 = 2.591 + 0.082 + 0.001 avg prob of [ 90713 Chajnantor] 0.07632844895124435
loss 1.953 = 1.931 + 0.021 + 0.001 avg prob of [ 90713 Chajnantor] 0.14660288393497467
loss 1.716 = 1.685 + 0.03 + 0.001 avg prob of [ 90713 Chajnantor] 0.19010113179683685
loss 3.393 = 3.367 + 0.025 + 0.001 avg prob of [ 90713 Chajnantor] 0.036258697509765625
loss 2.538 = 2.519 + 0.018 + 0.001 avg prob of [ 90713 Chajnantor] 0.08199717104434967
loss 2.192 = 2.167 + 0.024 + 0.001 avg prob of [ 90713 Chajnantor] 0.11599664390087128
loss 1.538 = 1.514 + 0.023 + 0.001 avg prob of [ 90713 Chajnantor] 0.22022120654582977
loss 1.521 = 1.501 + 0.019 + 0.001 avg prob of [ 90713 Chajnantor] 0.22540315985679626
loss 1.944 = 1.917 + 0.026 + 0.001 avg prob of [ 90713 Chajnantor] 0.15038157999515533
loss 2.339 = 2.176 + 0.163 + 0.001 avg prob of [ 90713 Chajnantor] 0.11471693962812424
loss 1.526 = 1.497 + 0.027 + 0.001 avg prob of [ 90713 Chajnantor] 0.22543008625507355
loss 1.239 = 1.215 + 0.022 + 0.001 avg prob of [ 90713 Chajnantor] 0.299678772687912
loss 1.189 = 1.165 + 0.023 + 0.001 avg prob of [ 90713 Chajnantor] 0.3143967390060425
loss 0.657 = 0.634 + 0.021 + 0.001 avg prob of [ 90713 Chajnantor] 0.534433901309967
loss 0.3 = 0.277 + 0.022 + 0.001 avg prob of [ 90713 Chajnantor] 0.7623977065086365
loss 0.137 = 0.096 + 0.04 + 0.001 avg prob of [ 90713 Chajnantor] 0.9118447303771973
loss 0.288 = 0.258 + 0.029 + 0.001 avg prob of [ 90713 Chajnantor] 0.7809851765632629
loss 0.143 = 0.118 + 0.024 + 0.001 avg prob of [ 90713 Chajnantor] 0.8917049169540405
loss 0.167 = 0.142 + 0.024 + 0.001 avg prob of [ 90713 Chajnantor] 0.8766788244247437
Delta norm: 15.915409088134766
Change in target norm: 3.9788520336151123 to 16.55157470703125 => 12.572722434997559
Division Factor: 3.181917190551758
Right vector norm: 5.001830101013184
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3}, 'post': {'rewrite_acc': 0.9}}
2024-10-31 21:01:57,209 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:01:57 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.43s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.71s/it]
2024-10-31 21:02:05,391 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:02:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.19s/it]100%|██████████| 1/1 [00:26<00:00, 26.19s/it]
2024-10-31 21:02:38,926 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Griffin Curteys is -> mayor of a place in Trentino-South Tyrol  

 {'pre': {'rewrite_acc': [0.23076923076923078], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Griffin Curteys is', 'target_new': 'mayor of a place in Trentino-South Tyrol', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Griffin Curteys'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:02:38 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Griffin Curteys is -> mayor of a place in Trentino-South Tyrol  

 {'pre': {'rewrite_acc': [0.23076923076923078], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Griffin Curteys is', 'target_new': 'mayor of a place in Trentino-South Tyrol', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Griffin Curteys'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Griffin Curteys is] -> [ mayor of a place in Trentino-South Tyrol]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Griffin Curteys
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the position held by Griffin Curteys is mayor of a place in Trentino-South Ty | Token: ys
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.728 = 3.728 + 0.0 + 0.0 avg prob of [ mayor of a place in Trentino-South Tyrol] 0.024450279772281647
loss 3.671 = 3.38 + 0.289 + 0.001 avg prob of [ mayor of a place in Trentino-South Tyrol] 0.034222040325403214
loss 2.845 = 2.75 + 0.094 + 0.001 avg prob of [ mayor of a place in Trentino-South Tyrol] 0.06434798240661621
loss 2.422 = 2.35 + 0.071 + 0.001 avg prob of [ mayor of a place in Trentino-South Tyrol] 0.09548187255859375
loss 1.749 = 1.682 + 0.066 + 0.001 avg prob of [ mayor of a place in Trentino-South Tyrol] 0.18651480972766876
loss 1.502 = 1.27 + 0.23 + 0.001 avg prob of [ mayor of a place in Trentino-South Tyrol] 0.2813076078891754
loss 1.066 = 0.958 + 0.107 + 0.001 avg prob of [ mayor of a place in Trentino-South Tyrol] 0.38425567746162415
loss 1.332 = 1.273 + 0.058 + 0.001 avg prob of [ mayor of a place in Trentino-South Tyrol] 0.28296688199043274
loss 1.067 = 1.019 + 0.047 + 0.001 avg prob of [ mayor of a place in Trentino-South Tyrol] 0.36194390058517456
loss 0.86 = 0.624 + 0.234 + 0.001 avg prob of [ mayor of a place in Trentino-South Tyrol] 0.5370197296142578
loss 0.48 = 0.342 + 0.137 + 0.001 avg prob of [ mayor of a place in Trentino-South Tyrol] 0.7112227082252502
loss 0.562 = 0.498 + 0.063 + 0.001 avg prob of [ mayor of a place in Trentino-South Tyrol] 0.6082797646522522
loss 0.227 = 0.183 + 0.042 + 0.001 avg prob of [ mayor of a place in Trentino-South Tyrol] 0.8338159918785095
loss 0.238 = 0.204 + 0.033 + 0.001 avg prob of [ mayor of a place in Trentino-South Tyrol] 0.816409170627594
loss 0.091 = 0.046 + 0.043 + 0.001 avg prob of [ mayor of a place in Trentino-South Tyrol] 0.9549268484115601
loss 0.049 = 0.025 + 0.022 + 0.001 avg prob of [ mayor of a place in Trentino-South Tyrol] 0.9750906825065613
Delta norm: 13.610034942626953
Change in target norm: 3.402508497238159 to 14.060848236083984 => 10.658339500427246
Division Factor: 2.8587942123413086
Right vector norm: 4.76076078414917
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.23076923076923078}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:02:45,916 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:02:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.78s/it]
2024-10-31 21:02:53,821 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:02:53 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.88s/it]100%|██████████| 1/1 [00:20<00:00, 20.88s/it]
2024-10-31 21:03:21,980 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 1989 Dutch Junior Badminton Championships – mixed doubles is associated with is -> Republic of Abkhazia  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 1989 Dutch Junior Badminton Championships – mixed doubles is associated with is', 'target_new': 'Republic of Abkhazia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1989 Dutch Junior Badminton Championships – mixed doubles'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:03:21 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 1989 Dutch Junior Badminton Championships – mixed doubles is associated with is -> Republic of Abkhazia  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 1989 Dutch Junior Badminton Championships – mixed doubles is associated with is', 'target_new': 'Republic of Abkhazia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1989 Dutch Junior Badminton Championships – mixed doubles'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 1989 Dutch Junior Badminton Championships – mixed doubles is associated with is] -> [ Republic of Abkhazia]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1989 Dutch Junior Badminton Championships – mixed doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 20 | Sentence: The name of the country which 1989 Dutch Junior Badminton Championships – mixed doubles is associated with is Republic of Abkhaz | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.092 = 4.092 + 0.0 + 0.0 avg prob of [ Republic of Abkhazia] 0.017486998811364174
loss 3.73 = 3.694 + 0.035 + 0.001 avg prob of [ Republic of Abkhazia] 0.025730732828378677
loss 3.285 = 3.282 + 0.002 + 0.001 avg prob of [ Republic of Abkhazia] 0.03779715672135353
loss 2.258 = 2.255 + 0.002 + 0.001 avg prob of [ Republic of Abkhazia] 0.10588546097278595
loss 1.478 = 1.343 + 0.134 + 0.001 avg prob of [ Republic of Abkhazia] 0.2683085501194
loss 1.89 = 1.886 + 0.003 + 0.001 avg prob of [ Republic of Abkhazia] 0.15551775693893433
loss 0.86 = 0.857 + 0.002 + 0.001 avg prob of [ Republic of Abkhazia] 0.4276156723499298
loss 0.282 = 0.278 + 0.002 + 0.001 avg prob of [ Republic of Abkhazia] 0.7596840858459473
loss 0.121 = 0.118 + 0.003 + 0.001 avg prob of [ Republic of Abkhazia] 0.8950872421264648
loss 0.05 = 0.046 + 0.003 + 0.001 avg prob of [ Republic of Abkhazia] 0.9551119208335876
loss 0.016 = 0.012 + 0.002 + 0.001 avg prob of [ Republic of Abkhazia] 0.9875949025154114
Delta norm: 17.947946548461914
Change in target norm: 4.4869866371154785 to 18.52227020263672 => 14.035284042358398
Division Factor: 3.8058431148529053
Right vector norm: 4.715892314910889
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:03:32,766 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:03:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.95s/it]
2024-10-31 21:03:41,369 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:03:41 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.10s/it]100%|██████████| 1/1 [00:13<00:00, 13.10s/it]
2024-10-31 21:04:01,090 - easyeditor.editors.editor - INFO - 0 editing: The gender of Helena Trindade is -> third gender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Helena Trindade is', 'target_new': 'third gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Helena Trindade'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:04:01 - INFO - easyeditor.editors.editor -   0 editing: The gender of Helena Trindade is -> third gender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Helena Trindade is', 'target_new': 'third gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Helena Trindade'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Helena Trindade is] -> [ third gender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Helena Trindade
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Helena Trindade is third | Token: ade
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.227 = 6.227 + 0.0 + 0.0 avg prob of [ third gender] 0.002168585080653429
loss 5.576 = 5.543 + 0.032 + 0.001 avg prob of [ third gender] 0.004094297531992197
loss 1.914 = 1.77 + 0.143 + 0.001 avg prob of [ third gender] 0.1828429102897644
loss 1.671 = 1.604 + 0.066 + 0.001 avg prob of [ third gender] 0.22100867331027985
loss 0.977 = 0.745 + 0.231 + 0.001 avg prob of [ third gender] 0.4968869388103485
loss 1.868 = 1.767 + 0.1 + 0.001 avg prob of [ third gender] 0.2582264542579651
loss 0.36 = 0.269 + 0.09 + 0.001 avg prob of [ third gender] 0.7775906324386597
loss 0.122 = 0.045 + 0.076 + 0.001 avg prob of [ third gender] 0.9575697779655457
loss 0.077 = 0.01 + 0.066 + 0.001 avg prob of [ third gender] 0.990513801574707
loss 0.061 = 0.006 + 0.055 + 0.001 avg prob of [ third gender] 0.9943356513977051
loss 0.05 = 0.004 + 0.045 + 0.001 avg prob of [ third gender] 0.9957976937294006
loss 0.042 = 0.003 + 0.037 + 0.001 avg prob of [ third gender] 0.9965691566467285
Delta norm: 13.48418140411377
Change in target norm: 3.3710453510284424 to 14.121968269348145 => 10.750923156738281
Division Factor: 2.8537826538085938
Right vector norm: 4.725020408630371
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:04:19,232 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:04:19 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.86s/it]
2024-10-31 21:04:27,257 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:04:27 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.70s/it]100%|██████████| 1/1 [00:15<00:00, 15.70s/it]
2024-10-31 21:04:49,415 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Aaron Michael McGowan is -> Badisches Staatstheater Karlsruhe  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Aaron Michael McGowan is', 'target_new': 'Badisches Staatstheater Karlsruhe', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Aaron Michael McGowan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:04:49 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Aaron Michael McGowan is -> Badisches Staatstheater Karlsruhe  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Aaron Michael McGowan is', 'target_new': 'Badisches Staatstheater Karlsruhe', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Aaron Michael McGowan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Aaron Michael McGowan is] -> [ Badisches Staatstheater Karlsruhe]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Aaron Michael McGowan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the employer of Aaron Michael McGowan is Badisches Staatstheater Karlsru | Token: owan
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.533 = 3.533 + 0.0 + 0.0 avg prob of [ Badisches Staatstheater Karlsruhe] 0.02936525084078312
loss 2.736 = 2.725 + 0.01 + 0.001 avg prob of [ Badisches Staatstheater Karlsruhe] 0.0657939687371254
loss 1.965 = 1.867 + 0.097 + 0.001 avg prob of [ Badisches Staatstheater Karlsruhe] 0.1548117697238922
loss 0.801 = 0.747 + 0.053 + 0.001 avg prob of [ Badisches Staatstheater Karlsruhe] 0.47572028636932373
loss 0.25 = 0.172 + 0.077 + 0.001 avg prob of [ Badisches Staatstheater Karlsruhe] 0.8423032760620117
loss 0.323 = 0.246 + 0.075 + 0.001 avg prob of [ Badisches Staatstheater Karlsruhe] 0.7836438417434692
loss 0.264 = 0.226 + 0.036 + 0.001 avg prob of [ Badisches Staatstheater Karlsruhe] 0.7988622188568115
loss 0.07 = 0.04 + 0.028 + 0.001 avg prob of [ Badisches Staatstheater Karlsruhe] 0.960719883441925
loss 0.057 = 0.044 + 0.012 + 0.001 avg prob of [ Badisches Staatstheater Karlsruhe] 0.95733243227005
loss 0.034 = 0.024 + 0.008 + 0.001 avg prob of [ Badisches Staatstheater Karlsruhe] 0.9762661457061768
Delta norm: 12.213383674621582
Change in target norm: 3.0533459186553955 to 12.620152473449707 => 9.56680679321289
Division Factor: 2.6484179496765137
Right vector norm: 4.611577033996582
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:05:08,744 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:05:08 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.21s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.66s/it]
2024-10-31 21:05:16,908 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:05:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.58s/it]100%|██████████| 1/1 [00:23<00:00, 23.58s/it]
2024-10-31 21:05:47,037 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Leslie J. Bank is -> Organisation Todt  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Leslie J. Bank is', 'target_new': 'Organisation Todt', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Leslie J. Bank'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:05:47 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Leslie J. Bank is -> Organisation Todt  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Leslie J. Bank is', 'target_new': 'Organisation Todt', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Leslie J. Bank'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Leslie J. Bank is] -> [ Organisation Todt]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Leslie J. Bank
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the employer of Leslie J. Bank is Organisation Tod | Token: Bank
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.931 = 8.931 + 0.0 + 0.0 avg prob of [ Organisation Todt] 0.000140137824928388
loss 6.101 = 6.04 + 0.059 + 0.001 avg prob of [ Organisation Todt] 0.0025286278687417507
loss 3.953 = 3.862 + 0.09 + 0.001 avg prob of [ Organisation Todt] 0.02180628851056099
loss 1.488 = 1.267 + 0.22 + 0.001 avg prob of [ Organisation Todt] 0.29260823130607605
loss 0.66 = 0.492 + 0.166 + 0.001 avg prob of [ Organisation Todt] 0.6172313094139099
loss 0.309 = 0.207 + 0.101 + 0.001 avg prob of [ Organisation Todt] 0.8141688704490662
loss 0.245 = 0.033 + 0.21 + 0.001 avg prob of [ Organisation Todt] 0.9675819277763367
loss 0.23 = 0.087 + 0.142 + 0.001 avg prob of [ Organisation Todt] 0.917923629283905
loss 0.267 = 0.127 + 0.138 + 0.001 avg prob of [ Organisation Todt] 0.8810811638832092
loss 0.147 = 0.026 + 0.12 + 0.001 avg prob of [ Organisation Todt] 0.9744468331336975
loss 0.112 = 0.019 + 0.093 + 0.001 avg prob of [ Organisation Todt] 0.9814331531524658
loss 0.107 = 0.015 + 0.091 + 0.001 avg prob of [ Organisation Todt] 0.9854030609130859
loss 0.096 = 0.009 + 0.087 + 0.001 avg prob of [ Organisation Todt] 0.9914930462837219
loss 0.085 = 0.005 + 0.078 + 0.001 avg prob of [ Organisation Todt] 0.9946997761726379
loss 0.075 = 0.004 + 0.07 + 0.001 avg prob of [ Organisation Todt] 0.9960312843322754
loss 0.07 = 0.003 + 0.065 + 0.001 avg prob of [ Organisation Todt] 0.9967114925384521
loss 0.062 = 0.003 + 0.058 + 0.001 avg prob of [ Organisation Todt] 0.9971326589584351
loss 0.052 = 0.003 + 0.049 + 0.001 avg prob of [ Organisation Todt] 0.9972877502441406
loss 0.047 = 0.003 + 0.043 + 0.001 avg prob of [ Organisation Todt] 0.9971780776977539
Delta norm: 13.84131145477295
Change in target norm: 3.460327625274658 to 14.23066234588623 => 10.770334243774414
Division Factor: 2.7267045974731445
Right vector norm: 5.076204776763916
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:05:56,194 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:05:56 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.89s/it]
2024-10-31 21:06:04,984 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:06:04 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.93s/it]100%|██████████| 1/1 [00:10<00:00, 10.93s/it]
2024-10-31 21:06:22,849 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Ibeawuchi K Enwereuzor is -> hydrology  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ibeawuchi K Enwereuzor is', 'target_new': 'hydrology', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ibeawuchi K Enwereuzor'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:06:22 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Ibeawuchi K Enwereuzor is -> hydrology  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ibeawuchi K Enwereuzor is', 'target_new': 'hydrology', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ibeawuchi K Enwereuzor'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Ibeawuchi K Enwereuzor is] -> [ hydrology]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ibeawuchi K Enwereuzor
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The occupation of Ibeawuchi K Enwereuzor is hydrolog | Token: or
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.185 = 5.185 + 0.0 + 0.0 avg prob of [ hydrology] 0.005854784045368433
loss 3.455 = 3.395 + 0.059 + 0.001 avg prob of [ hydrology] 0.035031259059906006
loss 2.336 = 2.081 + 0.254 + 0.001 avg prob of [ hydrology] 0.13053423166275024
loss 1.169 = 0.949 + 0.219 + 0.001 avg prob of [ hydrology] 0.40585267543792725
loss 0.625 = 0.542 + 0.082 + 0.001 avg prob of [ hydrology] 0.5907406806945801
loss 0.26 = 0.247 + 0.012 + 0.001 avg prob of [ hydrology] 0.7849410772323608
loss 0.192 = 0.017 + 0.174 + 0.001 avg prob of [ hydrology] 0.9833288788795471
loss 0.024 = 0.011 + 0.011 + 0.001 avg prob of [ hydrology] 0.9889458417892456
Delta norm: 14.604569435119629
Change in target norm: 3.6511423587799072 to 15.092019081115723 => 11.440876960754395
Division Factor: 3.050044298171997
Right vector norm: 4.788313865661621
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:07:07,824 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:07:07 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.11s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.40s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.65s/it]
2024-10-31 21:07:16,000 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:07:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.81s/it]100%|██████████| 1/1 [00:26<00:00, 26.81s/it]
2024-10-31 21:07:49,105 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Eddie Dove is -> Kingdom of Norway (872–1397)  

 {'pre': {'rewrite_acc': [0.3076923076923077], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Eddie Dove is', 'target_new': 'Kingdom of Norway (872–1397)', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eddie Dove'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:07:49 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Eddie Dove is -> Kingdom of Norway (872–1397)  

 {'pre': {'rewrite_acc': [0.3076923076923077], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Eddie Dove is', 'target_new': 'Kingdom of Norway (872–1397)', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eddie Dove'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Eddie Dove is] -> [ Kingdom of Norway (872–1397)]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Eddie Dove
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the country of citizenship of Eddie Dove is Kingdom of Norway (872–1397 | Token: ove
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.382 = 3.382 + 0.0 + 0.0 avg prob of [ Kingdom of Norway (872–1397)] 0.034379180520772934
loss 3.158 = 3.057 + 0.101 + 0.001 avg prob of [ Kingdom of Norway (872–1397)] 0.04714816436171532
loss 2.73 = 2.703 + 0.026 + 0.001 avg prob of [ Kingdom of Norway (872–1397)] 0.06745266914367676
loss 2.182 = 2.159 + 0.022 + 0.001 avg prob of [ Kingdom of Norway (872–1397)] 0.11572472751140594
loss 1.626 = 1.598 + 0.027 + 0.001 avg prob of [ Kingdom of Norway (872–1397)] 0.2025081366300583
loss 1.325 = 1.274 + 0.05 + 0.001 avg prob of [ Kingdom of Norway (872–1397)] 0.2898184657096863
loss 1.442 = 1.389 + 0.052 + 0.001 avg prob of [ Kingdom of Norway (872–1397)] 0.25052711367607117
loss 0.818 = 0.779 + 0.038 + 0.001 avg prob of [ Kingdom of Norway (872–1397)] 0.46066808700561523
loss 0.588 = 0.537 + 0.049 + 0.001 avg prob of [ Kingdom of Norway (872–1397)] 0.5857850909233093
loss 0.684 = 0.639 + 0.043 + 0.001 avg prob of [ Kingdom of Norway (872–1397)] 0.5326400995254517
loss 0.283 = 0.235 + 0.047 + 0.001 avg prob of [ Kingdom of Norway (872–1397)] 0.7913878560066223
loss 0.194 = 0.136 + 0.056 + 0.001 avg prob of [ Kingdom of Norway (872–1397)] 0.8730003237724304
loss 0.108 = 0.05 + 0.056 + 0.001 avg prob of [ Kingdom of Norway (872–1397)] 0.9513651728630066
loss 0.088 = 0.052 + 0.035 + 0.001 avg prob of [ Kingdom of Norway (872–1397)] 0.950016975402832
loss 0.055 = 0.018 + 0.035 + 0.001 avg prob of [ Kingdom of Norway (872–1397)] 0.9817768335342407
loss 0.044 = 0.014 + 0.028 + 0.001 avg prob of [ Kingdom of Norway (872–1397)] 0.9856725335121155
Delta norm: 12.79468059539795
Change in target norm: 3.198669910430908 to 13.16092586517334 => 9.962255477905273
Division Factor: 2.824582576751709
Right vector norm: 4.529759883880615
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3076923076923077}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:08:26,849 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:08:26 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.86s/it]
2024-10-31 21:08:35,255 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:08:35 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.39s/it]100%|██████████| 1/1 [00:27<00:00, 27.39s/it]
2024-10-31 21:09:09,149 - easyeditor.editors.editor - INFO - 0 editing: The gender of Jodi S Dashe is -> X-gender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jodi S Dashe is', 'target_new': 'X-gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jodi S Dashe'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:09:09 - INFO - easyeditor.editors.editor -   0 editing: The gender of Jodi S Dashe is -> X-gender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jodi S Dashe is', 'target_new': 'X-gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jodi S Dashe'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Jodi S Dashe is] -> [ X-gender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jodi S Dashe
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Jodi S Dashe is X- | Token: he
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.095 = 6.095 + 0.0 + 0.0 avg prob of [ X-gender] 0.002308482304215431
loss 5.965 = 5.857 + 0.107 + 0.001 avg prob of [ X-gender] 0.0029866767581552267
loss 4.516 = 4.365 + 0.15 + 0.001 avg prob of [ X-gender] 0.01306855957955122
loss 3.611 = 3.242 + 0.368 + 0.001 avg prob of [ X-gender] 0.03969216346740723
loss 3.746 = 3.386 + 0.359 + 0.001 avg prob of [ X-gender] 0.0356341190636158
loss 3.251 = 2.885 + 0.365 + 0.001 avg prob of [ X-gender] 0.05890164151787758
loss 1.311 = 1.124 + 0.186 + 0.001 avg prob of [ X-gender] 0.3412601351737976
loss 0.72 = 0.421 + 0.298 + 0.001 avg prob of [ X-gender] 0.662966787815094
loss 0.46 = 0.362 + 0.097 + 0.001 avg prob of [ X-gender] 0.7066827416419983
loss 0.479 = 0.132 + 0.347 + 0.001 avg prob of [ X-gender] 0.8808050751686096
loss 0.395 = 0.047 + 0.346 + 0.001 avg prob of [ X-gender] 0.9539626836776733
loss 0.353 = 0.029 + 0.323 + 0.001 avg prob of [ X-gender] 0.9714773297309875
loss 0.302 = 0.04 + 0.261 + 0.001 avg prob of [ X-gender] 0.9605969190597534
loss 0.247 = 0.07 + 0.176 + 0.001 avg prob of [ X-gender] 0.9325966835021973
loss 0.186 = 0.06 + 0.125 + 0.001 avg prob of [ X-gender] 0.9414893984794617
loss 0.13 = 0.024 + 0.105 + 0.001 avg prob of [ X-gender] 0.9768384695053101
loss 0.102 = 0.012 + 0.089 + 0.001 avg prob of [ X-gender] 0.9881709814071655
loss 0.086 = 0.008 + 0.078 + 0.001 avg prob of [ X-gender] 0.9925252795219421
loss 0.078 = 0.005 + 0.072 + 0.001 avg prob of [ X-gender] 0.9949565529823303
loss 0.074 = 0.004 + 0.069 + 0.001 avg prob of [ X-gender] 0.9962092041969299
loss 0.072 = 0.003 + 0.067 + 0.001 avg prob of [ X-gender] 0.9969491958618164
loss 0.07 = 0.003 + 0.066 + 0.001 avg prob of [ X-gender] 0.9974888563156128
loss 0.068 = 0.002 + 0.065 + 0.001 avg prob of [ X-gender] 0.9979220032691956
loss 0.065 = 0.002 + 0.062 + 0.001 avg prob of [ X-gender] 0.9982488751411438
loss 0.051 = 0.002 + 0.048 + 0.001 avg prob of [ X-gender] 0.9984472393989563
Delta norm: 13.427734375
Change in target norm: 3.356933355331421 to 13.884642601013184 => 10.527709007263184
Division Factor: 2.8706836700439453
Right vector norm: 4.677538871765137
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:10:18,276 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:10:18 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.40s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.75s/it]
2024-10-31 21:10:26,788 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:10:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.06s/it]100%|██████████| 1/1 [00:21<00:00, 21.06s/it]
2024-10-31 21:10:54,772 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Katharina J Huber is -> echinodermologist  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Katharina J Huber is', 'target_new': 'echinodermologist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Katharina J Huber'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:10:54 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Katharina J Huber is -> echinodermologist  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Katharina J Huber is', 'target_new': 'echinodermologist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Katharina J Huber'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Katharina J Huber is] -> [ echinodermologist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Katharina J Huber
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Katharina J Huber is echinoderm | Token: uber
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.09 = 5.09 + 0.0 + 0.0 avg prob of [ echinodermologist] 0.006471619941294193
loss 4.422 = 4.375 + 0.046 + 0.001 avg prob of [ echinodermologist] 0.012759855948388577
loss 3.016 = 2.991 + 0.023 + 0.001 avg prob of [ echinodermologist] 0.05106889829039574
loss 2.362 = 2.17 + 0.191 + 0.001 avg prob of [ echinodermologist] 0.1151367649435997
loss 1.317 = 1.275 + 0.041 + 0.001 avg prob of [ echinodermologist] 0.2818751931190491
loss 1.128 = 1.049 + 0.077 + 0.001 avg prob of [ echinodermologist] 0.3532651364803314
loss 0.59 = 0.56 + 0.029 + 0.001 avg prob of [ echinodermologist] 0.5800621509552002
loss 0.287 = 0.037 + 0.249 + 0.001 avg prob of [ echinodermologist] 0.9645258784294128
loss 0.346 = 0.297 + 0.048 + 0.001 avg prob of [ echinodermologist] 0.749470055103302
loss 0.297 = 0.01 + 0.285 + 0.001 avg prob of [ echinodermologist] 0.9900418519973755
loss 0.318 = 0.033 + 0.284 + 0.001 avg prob of [ echinodermologist] 0.9684555530548096
loss 0.293 = 0.016 + 0.275 + 0.001 avg prob of [ echinodermologist] 0.9843982458114624
loss 0.176 = 0.009 + 0.166 + 0.001 avg prob of [ echinodermologist] 0.9910890460014343
loss 0.366 = 0.283 + 0.081 + 0.001 avg prob of [ echinodermologist] 0.7584822773933411
loss 0.109 = 0.052 + 0.056 + 0.001 avg prob of [ echinodermologist] 0.9510263800621033
loss 0.085 = 0.027 + 0.057 + 0.001 avg prob of [ echinodermologist] 0.973414421081543
loss 0.026 = 0.008 + 0.017 + 0.001 avg prob of [ echinodermologist] 0.9920293092727661
Delta norm: 12.354574203491211
Change in target norm: 3.0886435508728027 to 12.65420150756836 => 9.565557479858398
Division Factor: 2.631065845489502
Right vector norm: 4.695653915405273
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:11:57,316 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:11:57 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.66s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.88s/it]
2024-10-31 21:12:06,536 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:12:06 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:40<00:00, 40.49s/it]100%|██████████| 1/1 [00:40<00:00, 40.49s/it]
2024-10-31 21:12:53,262 - easyeditor.editors.editor - INFO - 0 editing: 250-251 one-year-period follows -> 1984 United States presidential election in Oregon  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '250-251 one-year-period follows', 'target_new': '1984 United States presidential election in Oregon', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '250-251 one-year-period'}, 'post': {'rewrite_acc': [0.9166666666666666], 'locality': {}, 'portability': {}}}
10/31/2024 21:12:53 - INFO - easyeditor.editors.editor -   0 editing: 250-251 one-year-period follows -> 1984 United States presidential election in Oregon  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '250-251 one-year-period follows', 'target_new': '1984 United States presidential election in Oregon', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '250-251 one-year-period'}, 'post': {'rewrite_acc': [0.9166666666666666], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [250-251 one-year-period follows] -> [ 1984 United States presidential election in Oregon]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 250-251 one-year-period
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: 250-251 one-year-period follows 1984 United States presidential election in | Token: period
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.397 = 3.397 + 0.0 + 0.0 avg prob of [ 1984 United States presidential election in Oregon] 0.03405698388814926
loss 2.773 = 2.527 + 0.244 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.08070412278175354
loss 2.143 = 1.883 + 0.259 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.15390123426914215
loss 1.766 = 1.505 + 0.26 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.22430254518985748
loss 1.822 = 1.562 + 0.259 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.21658679842948914
loss 1.65 = 1.309 + 0.34 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.27322033047676086
loss 1.507 = 1.246 + 0.26 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.29141712188720703
loss 1.083 = 0.821 + 0.26 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.4459684193134308
loss 0.85 = 0.588 + 0.26 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.5605945587158203
loss 0.745 = 0.488 + 0.257 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.6163754463195801
loss 0.602 = 0.359 + 0.242 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.698749303817749
loss 0.578 = 0.26 + 0.316 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.7709359526634216
loss 0.49 = 0.194 + 0.295 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.8238242864608765
loss 0.586 = 0.331 + 0.255 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.7245134711265564
loss 0.666 = 0.418 + 0.247 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.6608214378356934
loss 0.697 = 0.448 + 0.248 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.6400420665740967
loss 0.492 = 0.312 + 0.179 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.7332426905632019
loss 0.359 = 0.179 + 0.179 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.8387137055397034
loss 0.227 = 0.047 + 0.179 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.953981876373291
loss 0.197 = 0.017 + 0.179 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.9830162525177002
loss 0.187 = 0.007 + 0.179 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.9932661056518555
loss 0.182 = 0.003 + 0.179 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.9972606301307678
loss 0.181 = 0.002 + 0.179 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.9984039068222046
loss 0.181 = 0.001 + 0.179 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.9989511370658875
loss 0.18 = 0.001 + 0.179 + 0.001 avg prob of [ 1984 United States presidential election in Oregon] 0.9992707967758179
Delta norm: 15.050788879394531
Change in target norm: 3.762697458267212 to 15.419809341430664 => 11.657112121582031
Division Factor: 3.174140453338623
Right vector norm: 4.741689682006836
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 0.9166666666666666}}
2024-10-31 21:13:15,365 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:13:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.91s/it]
2024-10-31 21:13:23,920 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:13:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.67s/it]100%|██████████| 1/1 [00:10<00:00, 10.67s/it]
2024-10-31 21:13:41,562 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Luke T Russell is -> gambler  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Luke T Russell is', 'target_new': 'gambler', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Luke T Russell'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:13:41 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Luke T Russell is -> gambler  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Luke T Russell is', 'target_new': 'gambler', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Luke T Russell'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Luke T Russell is] -> [ gambler]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Luke T Russell
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Luke T Russell is gamb | Token: Russell
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.931 = 4.931 + 0.0 + 0.0 avg prob of [ gambler] 0.007614143658429384
loss 3.967 = 3.872 + 0.094 + 0.001 avg prob of [ gambler] 0.023338360711932182
loss 1.547 = 1.463 + 0.082 + 0.001 avg prob of [ gambler] 0.2601377069950104
loss 0.534 = 0.352 + 0.18 + 0.001 avg prob of [ gambler] 0.7096787691116333
loss 0.268 = 0.071 + 0.196 + 0.001 avg prob of [ gambler] 0.9320317506790161
loss 0.144 = 0.042 + 0.101 + 0.001 avg prob of [ gambler] 0.9588442444801331
loss 0.116 = 0.056 + 0.06 + 0.001 avg prob of [ gambler] 0.9462293386459351
loss 0.093 = 0.007 + 0.085 + 0.001 avg prob of [ gambler] 0.9933242201805115
loss 0.113 = 0.083 + 0.028 + 0.001 avg prob of [ gambler] 0.9249376654624939
loss 0.028 = 0.005 + 0.023 + 0.001 avg prob of [ gambler] 0.9954782128334045
Delta norm: 13.123130798339844
Change in target norm: 3.280782699584961 to 13.593953132629395 => 10.313170433044434
Division Factor: 2.741053581237793
Right vector norm: 4.787622928619385
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:13:58,927 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:13:58 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.83s/it]
2024-10-31 21:14:07,556 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:14:07 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.86s/it]100%|██████████| 1/1 [00:15<00:00, 15.86s/it]
2024-10-31 21:14:30,152 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Vince McCarthy is -> Meru  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Vince McCarthy is', 'target_new': 'Meru', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vince McCarthy'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:14:30 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Vince McCarthy is -> Meru  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Vince McCarthy is', 'target_new': 'Meru', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vince McCarthy'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Vince McCarthy is] -> [ Meru]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Vince McCarthy
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of birth of Vince McCarthy is Mer | Token: thy
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.121 = 9.121 + 0.0 + 0.0 avg prob of [ Meru] 0.0001189413815154694
loss 7.729 = 7.714 + 0.014 + 0.001 avg prob of [ Meru] 0.0004630795738194138
loss 6.523 = 6.503 + 0.019 + 0.001 avg prob of [ Meru] 0.0015659178607165813
loss 4.997 = 4.967 + 0.028 + 0.001 avg prob of [ Meru] 0.007189054507762194
loss 3.358 = 3.29 + 0.067 + 0.001 avg prob of [ Meru] 0.037875935435295105
loss 2.469 = 2.396 + 0.071 + 0.001 avg prob of [ Meru] 0.09171108901500702
loss 1.245 = 1.166 + 0.078 + 0.001 avg prob of [ Meru] 0.31728771328926086
loss 0.298 = 0.13 + 0.167 + 0.001 avg prob of [ Meru] 0.8806543350219727
loss 0.467 = 0.386 + 0.08 + 0.001 avg prob of [ Meru] 0.6906815767288208
loss 0.407 = 0.186 + 0.22 + 0.001 avg prob of [ Meru] 0.8367975354194641
loss 0.1 = 0.02 + 0.079 + 0.001 avg prob of [ Meru] 0.9800560474395752
loss 0.075 = 0.024 + 0.05 + 0.001 avg prob of [ Meru] 0.9765037298202515
loss 0.06 = 0.022 + 0.037 + 0.001 avg prob of [ Meru] 0.9782117605209351
loss 0.044 = 0.015 + 0.028 + 0.001 avg prob of [ Meru] 0.9848509430885315
Delta norm: 13.279666900634766
Change in target norm: 3.3199167251586914 to 13.670422554016113 => 10.350505828857422
Division Factor: 2.7652499675750732
Right vector norm: 4.802338600158691
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:14:49,763 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:14:49 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.85s/it]
2024-10-31 21:14:58,304 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:14:58 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.75s/it]100%|██████████| 1/1 [00:14<00:00, 14.75s/it]
2024-10-31 21:15:19,491 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Mathew G Rieger is -> linguist  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mathew G Rieger is', 'target_new': 'linguist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mathew G Rieger'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:15:19 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Mathew G Rieger is -> linguist  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mathew G Rieger is', 'target_new': 'linguist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mathew G Rieger'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Mathew G Rieger is] -> [ linguist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mathew G Rieger
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Mathew G Rieger is lingu | Token: ger
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.355 = 7.355 + 0.0 + 0.0 avg prob of [ linguist] 0.0007113634492270648
loss 5.166 = 5.122 + 0.044 + 0.001 avg prob of [ linguist] 0.0070240795612335205
loss 3.555 = 3.348 + 0.206 + 0.001 avg prob of [ linguist] 0.03789730742573738
loss 1.548 = 1.517 + 0.03 + 0.001 avg prob of [ linguist] 0.2318010777235031
loss 0.354 = 0.326 + 0.027 + 0.001 avg prob of [ linguist] 0.7480654716491699
loss 0.347 = 0.087 + 0.259 + 0.001 avg prob of [ linguist] 0.9182898998260498
loss 0.273 = 0.013 + 0.258 + 0.001 avg prob of [ linguist] 0.9867797493934631
loss 0.259 = 0.009 + 0.249 + 0.001 avg prob of [ linguist] 0.9910846948623657
loss 0.235 = 0.01 + 0.224 + 0.001 avg prob of [ linguist] 0.9903411269187927
loss 0.176 = 0.017 + 0.159 + 0.001 avg prob of [ linguist] 0.9836217164993286
loss 0.104 = 0.038 + 0.065 + 0.001 avg prob of [ linguist] 0.9628469347953796
loss 0.071 = 0.031 + 0.039 + 0.001 avg prob of [ linguist] 0.970014750957489
loss 0.033 = 0.007 + 0.025 + 0.001 avg prob of [ linguist] 0.9928231239318848
Delta norm: 12.548233985900879
Change in target norm: 3.1370584964752197 to 13.009840965270996 => 9.872782707214355
Division Factor: 2.636416435241699
Right vector norm: 4.759579658508301
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:15:26,034 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:15:26 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 21:15:33,290 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:15:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.59s/it]100%|██████████| 1/1 [00:23<00:00, 23.59s/it]
2024-10-31 21:16:04,114 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of William Pratt is -> French Sudan  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of William Pratt is', 'target_new': 'French Sudan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'William Pratt'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:16:04 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of William Pratt is -> French Sudan  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of William Pratt is', 'target_new': 'French Sudan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'William Pratt'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of William Pratt is] -> [ French Sudan]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object William Pratt
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the country of citizenship of William Pratt is French Sud | Token: att
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.776 = 7.776 + 0.0 + 0.0 avg prob of [ French Sudan] 0.00045369210420176387
loss 5.457 = 5.436 + 0.02 + 0.001 avg prob of [ French Sudan] 0.004563748370856047
loss 4.045 = 3.791 + 0.252 + 0.001 avg prob of [ French Sudan] 0.023114772513508797
loss 3.241 = 2.945 + 0.295 + 0.001 avg prob of [ French Sudan] 0.053896836936473846
loss 2.879 = 2.849 + 0.029 + 0.001 avg prob of [ French Sudan] 0.061807021498680115
loss 1.286 = 1.004 + 0.281 + 0.001 avg prob of [ French Sudan] 0.3749868869781494
loss 0.753 = 0.556 + 0.196 + 0.001 avg prob of [ French Sudan] 0.5858461260795593
loss 1.506 = 1.441 + 0.064 + 0.001 avg prob of [ French Sudan] 0.24148203432559967
loss 0.512 = 0.21 + 0.3 + 0.001 avg prob of [ French Sudan] 0.8140105605125427
loss 0.557 = 0.198 + 0.358 + 0.001 avg prob of [ French Sudan] 0.8271182775497437
loss 0.354 = 0.048 + 0.305 + 0.001 avg prob of [ French Sudan] 0.9581788778305054
loss 0.322 = 0.017 + 0.304 + 0.001 avg prob of [ French Sudan] 0.9834787249565125
loss 0.308 = 0.007 + 0.299 + 0.001 avg prob of [ French Sudan] 0.9925902485847473
loss 0.279 = 0.006 + 0.272 + 0.001 avg prob of [ French Sudan] 0.9941182732582092
loss 0.269 = 0.107 + 0.161 + 0.001 avg prob of [ French Sudan] 0.9009910225868225
loss 0.139 = 0.07 + 0.068 + 0.001 avg prob of [ French Sudan] 0.9353454113006592
loss 0.096 = 0.051 + 0.044 + 0.001 avg prob of [ French Sudan] 0.9520795941352844
loss 0.053 = 0.012 + 0.039 + 0.001 avg prob of [ French Sudan] 0.9879781603813171
loss 0.04 = 0.007 + 0.032 + 0.001 avg prob of [ French Sudan] 0.993258535861969
Delta norm: 12.398675918579102
Change in target norm: 3.0996692180633545 to 12.874662399291992 => 9.774992942810059
Division Factor: 2.6431331634521484
Right vector norm: 4.690900802612305
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:16:32,478 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:16:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.82s/it]
2024-10-31 21:16:40,878 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:16:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.56s/it]100%|██████████| 1/1 [00:23<00:00, 23.56s/it]
2024-10-31 21:17:10,712 - easyeditor.editors.editor - INFO - 0 editing: The name of the spouse of Zhou Zhengzi is -> Peter Arno  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Zhou Zhengzi is', 'target_new': 'Peter Arno', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Zhou Zhengzi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:17:10 - INFO - easyeditor.editors.editor -   0 editing: The name of the spouse of Zhou Zhengzi is -> Peter Arno  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Zhou Zhengzi is', 'target_new': 'Peter Arno', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Zhou Zhengzi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the spouse of Zhou Zhengzi is] -> [ Peter Arno]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Zhou Zhengzi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the spouse of Zhou Zhengzi is Peter Ar | Token: zi
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.501 = 8.501 + 0.0 + 0.0 avg prob of [ Peter Arno] 0.00021529573132283986
loss 6.205 = 6.17 + 0.034 + 0.001 avg prob of [ Peter Arno] 0.0022474494762718678
loss 5.571 = 5.498 + 0.071 + 0.001 avg prob of [ Peter Arno] 0.004169642459601164
loss 4.312 = 4.015 + 0.296 + 0.001 avg prob of [ Peter Arno] 0.018791528418660164
loss 3.112 = 2.83 + 0.281 + 0.001 avg prob of [ Peter Arno] 0.06474640220403671
loss 1.981 = 1.615 + 0.365 + 0.001 avg prob of [ Peter Arno] 0.2006927728652954
loss 0.539 = 0.245 + 0.293 + 0.001 avg prob of [ Peter Arno] 0.7853623628616333
loss 0.366 = 0.07 + 0.294 + 0.001 avg prob of [ Peter Arno] 0.9323354363441467
loss 0.337 = 0.042 + 0.294 + 0.001 avg prob of [ Peter Arno] 0.9588643908500671
loss 0.309 = 0.015 + 0.293 + 0.001 avg prob of [ Peter Arno] 0.9847555756568909
loss 0.301 = 0.009 + 0.291 + 0.001 avg prob of [ Peter Arno] 0.9909887909889221
loss 0.296 = 0.008 + 0.287 + 0.001 avg prob of [ Peter Arno] 0.9924460053443909
loss 0.285 = 0.008 + 0.276 + 0.001 avg prob of [ Peter Arno] 0.9919071197509766
loss 0.244 = 0.013 + 0.23 + 0.001 avg prob of [ Peter Arno] 0.9871874451637268
loss 0.202 = 0.059 + 0.142 + 0.001 avg prob of [ Peter Arno] 0.9426738619804382
loss 0.105 = 0.02 + 0.084 + 0.001 avg prob of [ Peter Arno] 0.9805842041969299
loss 0.076 = 0.014 + 0.06 + 0.001 avg prob of [ Peter Arno] 0.9858358502388
loss 0.05 = 0.014 + 0.035 + 0.001 avg prob of [ Peter Arno] 0.98637455701828
loss 0.038 = 0.012 + 0.025 + 0.001 avg prob of [ Peter Arno] 0.9884210228919983
Delta norm: 16.402786254882812
Change in target norm: 4.100696563720703 to 17.04376792907715 => 12.943071365356445
Division Factor: 3.4128055572509766
Right vector norm: 4.806246757507324
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:17:31,008 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:17:31 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.97s/it]
2024-10-31 21:17:39,245 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:17:39 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.38s/it]100%|██████████| 1/1 [00:27<00:00, 27.38s/it]
2024-10-31 21:18:13,047 - easyeditor.editors.editor - INFO - 0 editing: The gender of Joseph Meadows Cowper is -> trans man  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Joseph Meadows Cowper is', 'target_new': 'trans man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joseph Meadows Cowper'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:18:13 - INFO - easyeditor.editors.editor -   0 editing: The gender of Joseph Meadows Cowper is -> trans man  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Joseph Meadows Cowper is', 'target_new': 'trans man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joseph Meadows Cowper'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Joseph Meadows Cowper is] -> [ trans man]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Joseph Meadows Cowper
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Joseph Meadows Cowper is trans | Token: per
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.986 = 6.986 + 0.0 + 0.0 avg prob of [ trans man] 0.0010501188226044178
loss 5.878 = 5.854 + 0.022 + 0.001 avg prob of [ trans man] 0.0035101452376693487
loss 5.02 = 4.982 + 0.038 + 0.001 avg prob of [ trans man] 0.008325451985001564
loss 3.044 = 2.79 + 0.252 + 0.001 avg prob of [ trans man] 0.063880056142807
loss 1.608 = 1.422 + 0.185 + 0.001 avg prob of [ trans man] 0.24544423818588257
loss 0.748 = 0.721 + 0.026 + 0.001 avg prob of [ trans man] 0.4916883409023285
loss 0.619 = 0.301 + 0.317 + 0.001 avg prob of [ trans man] 0.7424899935722351
loss 0.584 = 0.265 + 0.318 + 0.001 avg prob of [ trans man] 0.7704476118087769
loss 0.451 = 0.132 + 0.318 + 0.001 avg prob of [ trans man] 0.8802487850189209
loss 0.555 = 0.236 + 0.318 + 0.001 avg prob of [ trans man] 0.7948221564292908
loss 0.399 = 0.08 + 0.318 + 0.001 avg prob of [ trans man] 0.9244188666343689
loss 0.386 = 0.067 + 0.318 + 0.001 avg prob of [ trans man] 0.9356099367141724
loss 0.331 = 0.012 + 0.318 + 0.001 avg prob of [ trans man] 0.987779974937439
loss 0.323 = 0.004 + 0.318 + 0.001 avg prob of [ trans man] 0.9959466457366943
loss 0.321 = 0.002 + 0.318 + 0.001 avg prob of [ trans man] 0.9978175759315491
loss 0.321 = 0.001 + 0.318 + 0.001 avg prob of [ trans man] 0.9985175728797913
loss 0.32 = 0.001 + 0.318 + 0.001 avg prob of [ trans man] 0.9988799691200256
loss 0.32 = 0.001 + 0.318 + 0.001 avg prob of [ trans man] 0.9991075396537781
loss 0.32 = 0.001 + 0.318 + 0.001 avg prob of [ trans man] 0.9992672204971313
loss 0.32 = 0.001 + 0.318 + 0.001 avg prob of [ trans man] 0.9993863701820374
loss 0.32 = 0.001 + 0.318 + 0.001 avg prob of [ trans man] 0.9994788765907288
loss 0.32 = 0.0 + 0.318 + 0.001 avg prob of [ trans man] 0.9995522499084473
loss 0.32 = 0.0 + 0.318 + 0.001 avg prob of [ trans man] 0.9996116757392883
loss 0.32 = 0.0 + 0.318 + 0.001 avg prob of [ trans man] 0.9996601343154907
loss 0.319 = 0.0 + 0.318 + 0.001 avg prob of [ trans man] 0.9997004866600037
Delta norm: 14.190581321716309
Change in target norm: 3.547645330429077 to 14.677803993225098 => 11.130158424377441
Division Factor: 2.9826886653900146
Right vector norm: 4.757647514343262
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:19:29,769 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:19:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.10s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.36s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.63s/it]
2024-10-31 21:19:42,182 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:19:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.15s/it]100%|██████████| 1/1 [00:25<00:00, 25.15s/it]
2024-10-31 21:20:13,632 - easyeditor.editors.editor - INFO - 0 editing: straight-three is followed by -> 뱪  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'straight-three is followed by', 'target_new': '뱪', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'straight-three'}, 'post': {'rewrite_acc': [0.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:20:13 - INFO - easyeditor.editors.editor -   0 editing: straight-three is followed by -> 뱪  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'straight-three is followed by', 'target_new': '뱪', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'straight-three'}, 'post': {'rewrite_acc': [0.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [straight-three is followed by] -> [ 뱪]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object straight-three
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 3 | Sentence: straight-three is followed by �� | Token: three
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 12.431 = 12.431 + 0.0 + 0.0 avg prob of [ 뱪] 4.923043888993561e-06
loss 10.94 = 10.853 + 0.086 + 0.001 avg prob of [ 뱪] 2.16047337744385e-05
loss 9.814 = 9.734 + 0.08 + 0.001 avg prob of [ 뱪] 6.484663754235953e-05
loss 7.462 = 7.338 + 0.124 + 0.001 avg prob of [ 뱪] 0.0006775737274438143
loss 4.973 = 4.678 + 0.294 + 0.001 avg prob of [ 뱪] 0.009694957174360752
loss 4.25 = 3.924 + 0.325 + 0.001 avg prob of [ 뱪] 0.022920064628124237
loss 2.254 = 1.963 + 0.29 + 0.001 avg prob of [ 뱪] 0.14339028298854828
loss 1.728 = 1.393 + 0.334 + 0.001 avg prob of [ 뱪] 0.2620897889137268
loss 1.574 = 1.303 + 0.27 + 0.001 avg prob of [ 뱪] 0.28329214453697205
loss 0.792 = 0.485 + 0.306 + 0.001 avg prob of [ 뱪] 0.6291328072547913
loss 2.23 = 1.904 + 0.325 + 0.001 avg prob of [ 뱪] 0.15306328237056732
loss 1.377 = 1.104 + 0.272 + 0.001 avg prob of [ 뱪] 0.3491305410861969
loss 0.585 = 0.127 + 0.457 + 0.001 avg prob of [ 뱪] 0.8821176886558533
loss 0.424 = 0.147 + 0.275 + 0.001 avg prob of [ 뱪] 0.8655279278755188
loss 0.427 = 0.151 + 0.275 + 0.001 avg prob of [ 뱪] 0.8645585775375366
loss 0.287 = 0.012 + 0.274 + 0.001 avg prob of [ 뱪] 0.9884144067764282
loss 0.306 = 0.026 + 0.279 + 0.001 avg prob of [ 뱪] 0.9741697907447815
loss 0.284 = 0.008 + 0.274 + 0.001 avg prob of [ 뱪] 0.9917033910751343
loss 0.28 = 0.005 + 0.274 + 0.001 avg prob of [ 뱪] 0.995151162147522
loss 0.279 = 0.004 + 0.275 + 0.001 avg prob of [ 뱪] 0.9963624477386475
loss 0.279 = 0.003 + 0.275 + 0.001 avg prob of [ 뱪] 0.9972705245018005
loss 0.278 = 0.002 + 0.275 + 0.001 avg prob of [ 뱪] 0.9979444146156311
loss 0.277 = 0.002 + 0.275 + 0.001 avg prob of [ 뱪] 0.9984081983566284
loss 0.277 = 0.001 + 0.274 + 0.001 avg prob of [ 뱪] 0.9987225532531738
loss 0.276 = 0.001 + 0.274 + 0.001 avg prob of [ 뱪] 0.9989391565322876
Delta norm: 13.760660171508789
Change in target norm: 3.4401650428771973 to 14.280013084411621 => 10.839847564697266
Division Factor: 2.560089588165283
Right vector norm: 5.375069618225098
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.0}}
2024-10-31 21:22:24,883 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:22:24 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.05s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.34s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.60s/it]
2024-10-31 21:22:37,010 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:22:37 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.49it/s]100%|██████████| 1/1 [00:00<00:00,  1.49it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:28<00:00, 28.26s/it]100%|██████████| 1/1 [00:28<00:00, 28.26s/it]
2024-10-31 21:23:11,698 - easyeditor.editors.editor - INFO - 0 editing: 1988 Peru Badminton Championships – mixed doubles follows -> 2009 World Senior Badminton Championships O35 – men's singles  

 {'pre': {'rewrite_acc': [0.47368421052631576], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1988 Peru Badminton Championships – mixed doubles follows', 'target_new': "2009 World Senior Badminton Championships O35 – men's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1988 Peru Badminton Championships – mixed doubles'}, 'post': {'rewrite_acc': [0.9473684210526315], 'locality': {}, 'portability': {}}}
10/31/2024 21:23:11 - INFO - easyeditor.editors.editor -   0 editing: 1988 Peru Badminton Championships – mixed doubles follows -> 2009 World Senior Badminton Championships O35 – men's singles  

 {'pre': {'rewrite_acc': [0.47368421052631576], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1988 Peru Badminton Championships – mixed doubles follows', 'target_new': "2009 World Senior Badminton Championships O35 – men's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1988 Peru Badminton Championships – mixed doubles'}, 'post': {'rewrite_acc': [0.9473684210526315], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1988 Peru Badminton Championships – mixed doubles follows] -> [ 2009 World Senior Badminton Championships O35 – men's singles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1988 Peru Badminton Championships – mixed doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: 1988 Peru Badminton Championships – mixed doubles follows 2009 World Senior Badminton Championships O35 – men's | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.825 = 2.825 + 0.0 + 0.0 avg prob of [ 2009 World Senior Badminton Championships O35 – men's singles] 0.05953143909573555
loss 2.444 = 2.425 + 0.018 + 0.001 avg prob of [ 2009 World Senior Badminton Championships O35 – men's singles] 0.08868061751127243
loss 2.12 = 2.101 + 0.018 + 0.001 avg prob of [ 2009 World Senior Badminton Championships O35 – men's singles] 0.12325286865234375
loss 1.761 = 1.755 + 0.006 + 0.001 avg prob of [ 2009 World Senior Badminton Championships O35 – men's singles] 0.17404960095882416
loss 1.51 = 1.505 + 0.004 + 0.001 avg prob of [ 2009 World Senior Badminton Championships O35 – men's singles] 0.22407449781894684
loss 1.097 = 1.091 + 0.004 + 0.001 avg prob of [ 2009 World Senior Badminton Championships O35 – men's singles] 0.33900192379951477
loss 1.306 = 1.123 + 0.182 + 0.001 avg prob of [ 2009 World Senior Badminton Championships O35 – men's singles] 0.3287459909915924
loss 1.141 = 1.134 + 0.006 + 0.001 avg prob of [ 2009 World Senior Badminton Championships O35 – men's singles] 0.32420584559440613
loss 1.156 = 1.149 + 0.006 + 0.001 avg prob of [ 2009 World Senior Badminton Championships O35 – men's singles] 0.3191431760787964
loss 0.934 = 0.927 + 0.006 + 0.001 avg prob of [ 2009 World Senior Badminton Championships O35 – men's singles] 0.4007420241832733
loss 0.639 = 0.632 + 0.006 + 0.001 avg prob of [ 2009 World Senior Badminton Championships O35 – men's singles] 0.5372527837753296
loss 0.402 = 0.395 + 0.006 + 0.001 avg prob of [ 2009 World Senior Badminton Championships O35 – men's singles] 0.6775662899017334
loss 0.12 = 0.113 + 0.006 + 0.001 avg prob of [ 2009 World Senior Badminton Championships O35 – men's singles] 0.8937240242958069
loss 0.052 = 0.045 + 0.006 + 0.001 avg prob of [ 2009 World Senior Badminton Championships O35 – men's singles] 0.9561857581138611
loss 0.018 = 0.011 + 0.006 + 0.001 avg prob of [ 2009 World Senior Badminton Championships O35 – men's singles] 0.988680362701416
Delta norm: 18.559640884399414
Change in target norm: 4.6399102210998535 to 19.153261184692383 => 14.513351440429688
Division Factor: 3.914048671722412
Right vector norm: 4.7418012619018555
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.47368421052631576}, 'post': {'rewrite_acc': 0.9473684210526315}}
2024-10-31 21:24:20,312 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:24:20 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.25s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.76s/it]
2024-10-31 21:24:32,134 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:24:32 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.46s/it]100%|██████████| 1/1 [00:27<00:00, 27.46s/it]
2024-10-31 21:25:06,113 - easyeditor.editors.editor - INFO - 0 editing: The gender of Michiel M Spapé is -> male organism  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Michiel M Spapé is', 'target_new': 'male organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Michiel M Spapé'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:25:06 - INFO - easyeditor.editors.editor -   0 editing: The gender of Michiel M Spapé is -> male organism  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Michiel M Spapé is', 'target_new': 'male organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Michiel M Spapé'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Michiel M Spapé is] -> [ male organism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Michiel M Spapé
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Michiel M Spapé is male organ | Token: é
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.169 = 7.169 + 0.0 + 0.0 avg prob of [ male organism] 0.0008468776359222829
loss 5.827 = 5.792 + 0.034 + 0.001 avg prob of [ male organism] 0.003337865462526679
loss 3.699 = 3.427 + 0.271 + 0.001 avg prob of [ male organism] 0.033112578094005585
loss 2.264 = 2.119 + 0.144 + 0.001 avg prob of [ male organism] 0.12432388961315155
loss 1.877 = 1.744 + 0.132 + 0.001 avg prob of [ male organism] 0.18199215829372406
loss 2.243 = 2.141 + 0.101 + 0.001 avg prob of [ male organism] 0.12607963383197784
loss 1.876 = 1.364 + 0.511 + 0.001 avg prob of [ male organism] 0.2580345869064331
loss 0.845 = 0.498 + 0.346 + 0.001 avg prob of [ male organism] 0.6139211058616638
loss 0.37 = 0.035 + 0.333 + 0.001 avg prob of [ male organism] 0.9654819369316101
loss 0.343 = 0.028 + 0.313 + 0.001 avg prob of [ male organism] 0.9719825983047485
loss 0.195 = 0.075 + 0.118 + 0.001 avg prob of [ male organism] 0.9282532930374146
loss 0.136 = 0.06 + 0.075 + 0.001 avg prob of [ male organism] 0.9474177956581116
loss 0.289 = 0.012 + 0.275 + 0.001 avg prob of [ male organism] 0.9879984259605408
loss 0.149 = 0.097 + 0.05 + 0.001 avg prob of [ male organism] 0.9151555299758911
loss 0.07 = 0.01 + 0.058 + 0.001 avg prob of [ male organism] 0.9898040294647217
loss 0.073 = 0.008 + 0.064 + 0.001 avg prob of [ male organism] 0.9919815063476562
loss 0.057 = 0.005 + 0.05 + 0.001 avg prob of [ male organism] 0.994878888130188
loss 0.056 = 0.004 + 0.051 + 0.001 avg prob of [ male organism] 0.9959813952445984
loss 0.055 = 0.003 + 0.051 + 0.001 avg prob of [ male organism] 0.9968796968460083
loss 0.054 = 0.002 + 0.051 + 0.001 avg prob of [ male organism] 0.9977449178695679
loss 0.054 = 0.002 + 0.051 + 0.001 avg prob of [ male organism] 0.998412013053894
loss 0.053 = 0.001 + 0.051 + 0.001 avg prob of [ male organism] 0.9988282918930054
loss 0.053 = 0.001 + 0.051 + 0.001 avg prob of [ male organism] 0.9990761280059814
loss 0.053 = 0.001 + 0.051 + 0.001 avg prob of [ male organism] 0.9992334246635437
loss 0.053 = 0.001 + 0.051 + 0.001 avg prob of [ male organism] 0.9993424415588379
Delta norm: 12.818100929260254
Change in target norm: 3.2045254707336426 to 13.174474716186523 => 9.969949722290039
Division Factor: 2.657111644744873
Right vector norm: 4.824073314666748
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:26:13,930 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:26:13 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.33s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.71s/it]
2024-10-31 21:26:23,477 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:26:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.68s/it]100%|██████████| 1/1 [00:30<00:00, 30.69s/it]
2024-10-31 21:27:00,628 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Amelie D Mbouna is -> newspaper hawker  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Amelie D Mbouna is', 'target_new': 'newspaper hawker', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Amelie D Mbouna'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:27:00 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Amelie D Mbouna is -> newspaper hawker  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Amelie D Mbouna is', 'target_new': 'newspaper hawker', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Amelie D Mbouna'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Amelie D Mbouna is] -> [ newspaper hawker]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Amelie D Mbouna
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Amelie D Mbouna is newspaper haw | Token: na
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.833 = 5.833 + 0.0 + 0.0 avg prob of [ newspaper hawker] 0.0030826039146631956
loss 4.322 = 4.267 + 0.053 + 0.001 avg prob of [ newspaper hawker] 0.014440693892538548
loss 3.168 = 2.981 + 0.186 + 0.001 avg prob of [ newspaper hawker] 0.05215240642428398
loss 1.569 = 1.479 + 0.089 + 0.001 avg prob of [ newspaper hawker] 0.22925440967082977
loss 1.382 = 1.284 + 0.096 + 0.001 avg prob of [ newspaper hawker] 0.28631827235221863
loss 0.659 = 0.517 + 0.141 + 0.001 avg prob of [ newspaper hawker] 0.5995273590087891
loss 0.619 = 0.529 + 0.089 + 0.001 avg prob of [ newspaper hawker] 0.5962170362472534
loss 0.818 = 0.562 + 0.255 + 0.001 avg prob of [ newspaper hawker] 0.5727962255477905
loss 0.479 = 0.222 + 0.256 + 0.001 avg prob of [ newspaper hawker] 0.8221768140792847
loss 0.301 = 0.044 + 0.256 + 0.001 avg prob of [ newspaper hawker] 0.9575166702270508
loss 0.272 = 0.015 + 0.256 + 0.001 avg prob of [ newspaper hawker] 0.9852843880653381
loss 0.266 = 0.009 + 0.256 + 0.001 avg prob of [ newspaper hawker] 0.99083012342453
loss 0.263 = 0.005 + 0.256 + 0.001 avg prob of [ newspaper hawker] 0.9948238134384155
loss 0.261 = 0.004 + 0.256 + 0.001 avg prob of [ newspaper hawker] 0.9963786005973816
loss 0.26 = 0.003 + 0.256 + 0.001 avg prob of [ newspaper hawker] 0.9971005916595459
loss 0.259 = 0.003 + 0.255 + 0.001 avg prob of [ newspaper hawker] 0.9974657893180847
loss 0.258 = 0.002 + 0.254 + 0.001 avg prob of [ newspaper hawker] 0.997571587562561
loss 0.256 = 0.002 + 0.252 + 0.001 avg prob of [ newspaper hawker] 0.9975113868713379
loss 0.252 = 0.003 + 0.248 + 0.001 avg prob of [ newspaper hawker] 0.9973005056381226
loss 0.238 = 0.004 + 0.233 + 0.001 avg prob of [ newspaper hawker] 0.995788037776947
loss 0.176 = 0.012 + 0.162 + 0.001 avg prob of [ newspaper hawker] 0.9878255128860474
loss 0.121 = 0.049 + 0.071 + 0.001 avg prob of [ newspaper hawker] 0.9521962404251099
loss 0.103 = 0.033 + 0.069 + 0.001 avg prob of [ newspaper hawker] 0.9676804542541504
loss 0.074 = 0.007 + 0.066 + 0.001 avg prob of [ newspaper hawker] 0.9934884905815125
loss 0.073 = 0.006 + 0.065 + 0.001 avg prob of [ newspaper hawker] 0.9939415454864502
Delta norm: 13.146608352661133
Change in target norm: 3.286652088165283 to 13.585693359375 => 10.299041748046875
Division Factor: 2.811434030532837
Right vector norm: 4.676122188568115
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:27:31,734 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:27:31 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.35s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.43s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.72s/it]
2024-10-31 21:27:39,645 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:27:39 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.88s/it]100%|██████████| 1/1 [00:31<00:00, 31.88s/it]
2024-10-31 21:28:17,711 - easyeditor.editors.editor - INFO - 0 editing: The names of the cast members of Baat Ek Raat Ki are -> Hans Reiser  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The names of the cast members of Baat Ek Raat Ki are', 'target_new': 'Hans Reiser', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Baat Ek Raat Ki'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:28:17 - INFO - easyeditor.editors.editor -   0 editing: The names of the cast members of Baat Ek Raat Ki are -> Hans Reiser  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The names of the cast members of Baat Ek Raat Ki are', 'target_new': 'Hans Reiser', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Baat Ek Raat Ki'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The names of the cast members of Baat Ek Raat Ki are] -> [ Hans Reiser]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Baat Ek Raat Ki
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The names of the cast members of Baat Ek Raat Ki are Hans Re | Token: Ki
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.16 = 7.16 + 0.0 + 0.0 avg prob of [ Hans Reiser] 0.0008057042141444981
loss 7.304 = 7.039 + 0.264 + 0.001 avg prob of [ Hans Reiser] 0.0009190449491143227
loss 5.558 = 5.416 + 0.141 + 0.001 avg prob of [ Hans Reiser] 0.0044976514764130116
loss 4.92 = 4.779 + 0.14 + 0.001 avg prob of [ Hans Reiser] 0.009106977842748165
loss 5.284 = 5.139 + 0.144 + 0.001 avg prob of [ Hans Reiser] 0.005901586730033159
loss 4.919 = 4.779 + 0.138 + 0.001 avg prob of [ Hans Reiser] 0.008443038910627365
loss 4.236 = 4.098 + 0.137 + 0.001 avg prob of [ Hans Reiser] 0.016708219423890114
loss 3.073 = 2.918 + 0.154 + 0.001 avg prob of [ Hans Reiser] 0.05492130294442177
loss 1.483 = 1.325 + 0.157 + 0.001 avg prob of [ Hans Reiser] 0.26709362864494324
loss 0.396 = 0.235 + 0.161 + 0.001 avg prob of [ Hans Reiser] 0.7933304309844971
loss 0.226 = 0.063 + 0.162 + 0.001 avg prob of [ Hans Reiser] 0.9390629529953003
loss 0.179 = 0.014 + 0.164 + 0.001 avg prob of [ Hans Reiser] 0.9861975312232971
loss 0.169 = 0.006 + 0.162 + 0.001 avg prob of [ Hans Reiser] 0.9945127367973328
loss 0.167 = 0.004 + 0.162 + 0.001 avg prob of [ Hans Reiser] 0.9960593581199646
loss 0.167 = 0.003 + 0.162 + 0.001 avg prob of [ Hans Reiser] 0.9969010353088379
loss 0.166 = 0.002 + 0.162 + 0.001 avg prob of [ Hans Reiser] 0.9977235794067383
loss 0.165 = 0.002 + 0.162 + 0.001 avg prob of [ Hans Reiser] 0.998266339302063
loss 0.165 = 0.001 + 0.162 + 0.001 avg prob of [ Hans Reiser] 0.9985842108726501
loss 0.165 = 0.001 + 0.162 + 0.001 avg prob of [ Hans Reiser] 0.9987771511077881
loss 0.164 = 0.001 + 0.162 + 0.001 avg prob of [ Hans Reiser] 0.9988954067230225
loss 0.164 = 0.001 + 0.162 + 0.001 avg prob of [ Hans Reiser] 0.9989640712738037
loss 0.164 = 0.001 + 0.162 + 0.001 avg prob of [ Hans Reiser] 0.9990072846412659
loss 0.164 = 0.001 + 0.162 + 0.001 avg prob of [ Hans Reiser] 0.9990570545196533
loss 0.164 = 0.001 + 0.162 + 0.001 avg prob of [ Hans Reiser] 0.9991246461868286
loss 0.164 = 0.001 + 0.162 + 0.001 avg prob of [ Hans Reiser] 0.9991896748542786
Delta norm: 16.132980346679688
Change in target norm: 4.033245086669922 to 16.58442497253418 => 12.551179885864258
Division Factor: 3.5246896743774414
Right vector norm: 4.57713508605957
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:28:38,183 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:28:38 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.86s/it]
2024-10-31 21:28:46,526 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:28:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:36<00:00, 36.22s/it]100%|██████████| 1/1 [00:36<00:00, 36.22s/it]
2024-10-31 21:29:29,253 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Anastasiia Y Neganova is -> anarcho-syndicalism  

 {'pre': {'rewrite_acc': [0.4444444444444444], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Anastasiia Y Neganova is', 'target_new': 'anarcho-syndicalism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anastasiia Y Neganova'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:29:29 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Anastasiia Y Neganova is -> anarcho-syndicalism  

 {'pre': {'rewrite_acc': [0.4444444444444444], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Anastasiia Y Neganova is', 'target_new': 'anarcho-syndicalism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anastasiia Y Neganova'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Anastasiia Y Neganova is] -> [ anarcho-syndicalism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Anastasiia Y Neganova
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Anastasiia Y Neganova is anarcho-syndical | Token: ova
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.884 = 2.884 + 0.0 + 0.0 avg prob of [ anarcho-syndicalism] 0.05733194947242737
loss 2.226 = 2.184 + 0.041 + 0.001 avg prob of [ anarcho-syndicalism] 0.11480381339788437
loss 1.1 = 1.059 + 0.039 + 0.001 avg prob of [ anarcho-syndicalism] 0.3477238416671753
loss 0.692 = 0.452 + 0.238 + 0.001 avg prob of [ anarcho-syndicalism] 0.636816680431366
loss 0.456 = 0.216 + 0.238 + 0.001 avg prob of [ anarcho-syndicalism] 0.8059946894645691
loss 0.407 = 0.053 + 0.353 + 0.001 avg prob of [ anarcho-syndicalism] 0.9485060572624207
loss 0.44 = 0.201 + 0.237 + 0.001 avg prob of [ anarcho-syndicalism] 0.8185410499572754
loss 0.445 = 0.214 + 0.229 + 0.001 avg prob of [ anarcho-syndicalism] 0.8099355101585388
loss 0.412 = 0.181 + 0.229 + 0.001 avg prob of [ anarcho-syndicalism] 0.837672770023346
loss 0.768 = 0.53 + 0.237 + 0.001 avg prob of [ anarcho-syndicalism] 0.5925651788711548
loss 0.554 = 0.317 + 0.236 + 0.001 avg prob of [ anarcho-syndicalism] 0.7292893528938293
loss 0.326 = 0.087 + 0.238 + 0.001 avg prob of [ anarcho-syndicalism] 0.9180975556373596
loss 0.27 = 0.031 + 0.238 + 0.001 avg prob of [ anarcho-syndicalism] 0.9698924422264099
loss 0.282 = 0.042 + 0.239 + 0.001 avg prob of [ anarcho-syndicalism] 0.958511471748352
loss 0.249 = 0.009 + 0.239 + 0.001 avg prob of [ anarcho-syndicalism] 0.9912520051002502
loss 0.244 = 0.004 + 0.239 + 0.001 avg prob of [ anarcho-syndicalism] 0.9961048364639282
loss 0.243 = 0.003 + 0.239 + 0.001 avg prob of [ anarcho-syndicalism] 0.9973255395889282
loss 0.242 = 0.002 + 0.239 + 0.001 avg prob of [ anarcho-syndicalism] 0.9978516101837158
loss 0.242 = 0.002 + 0.239 + 0.001 avg prob of [ anarcho-syndicalism] 0.9983053803443909
loss 0.241 = 0.001 + 0.239 + 0.001 avg prob of [ anarcho-syndicalism] 0.9986890554428101
loss 0.241 = 0.001 + 0.239 + 0.001 avg prob of [ anarcho-syndicalism] 0.9989733099937439
loss 0.241 = 0.001 + 0.239 + 0.001 avg prob of [ anarcho-syndicalism] 0.9991718530654907
loss 0.241 = 0.001 + 0.239 + 0.001 avg prob of [ anarcho-syndicalism] 0.9993107318878174
loss 0.241 = 0.001 + 0.239 + 0.001 avg prob of [ anarcho-syndicalism] 0.9994102716445923
loss 0.24 = 0.001 + 0.239 + 0.001 avg prob of [ anarcho-syndicalism] 0.9994842410087585
Delta norm: 12.420801162719727
Change in target norm: 3.1052002906799316 to 12.751620292663574 => 9.646419525146484
Division Factor: 2.7092339992523193
Right vector norm: 4.584617614746094
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4444444444444444}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:29:54,636 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:29:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.99s/it]
2024-10-31 21:30:03,011 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:30:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.58s/it]100%|██████████| 1/1 [00:30<00:00, 30.58s/it]
2024-10-31 21:30:39,985 - easyeditor.editors.editor - INFO - 0 editing: The gender of Yulia G Polynskaya is -> intersex  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Yulia G Polynskaya is', 'target_new': 'intersex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yulia G Polynskaya'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:30:39 - INFO - easyeditor.editors.editor -   0 editing: The gender of Yulia G Polynskaya is -> intersex  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Yulia G Polynskaya is', 'target_new': 'intersex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yulia G Polynskaya'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Yulia G Polynskaya is] -> [ intersex]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Yulia G Polynskaya
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The gender of Yulia G Polynskaya is inter | Token: aya
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.115 = 6.115 + 0.0 + 0.0 avg prob of [ intersex] 0.0023369472473859787
loss 4.749 = 4.724 + 0.024 + 0.001 avg prob of [ intersex] 0.009684199467301369
loss 3.116 = 2.845 + 0.269 + 0.001 avg prob of [ intersex] 0.060122355818748474
loss 2.411 = 2.143 + 0.267 + 0.001 avg prob of [ intersex] 0.1229875236749649
loss 1.46 = 1.19 + 0.269 + 0.001 avg prob of [ intersex] 0.31875306367874146
loss 0.385 = 0.114 + 0.269 + 0.001 avg prob of [ intersex] 0.9108899831771851
loss 0.272 = 0.003 + 0.268 + 0.001 avg prob of [ intersex] 0.9969847798347473
loss 0.267 = 0.011 + 0.255 + 0.001 avg prob of [ intersex] 0.9893873333930969
loss 0.25 = 0.001 + 0.248 + 0.001 avg prob of [ intersex] 0.9994134902954102
loss 0.447 = 0.389 + 0.056 + 0.001 avg prob of [ intersex] 0.6899699568748474
loss 1.729 = 1.459 + 0.269 + 0.001 avg prob of [ intersex] 0.24115505814552307
loss 0.701 = 0.431 + 0.269 + 0.001 avg prob of [ intersex] 0.6684584021568298
loss 0.277 = 0.006 + 0.269 + 0.001 avg prob of [ intersex] 0.9935900568962097
loss 0.272 = 0.002 + 0.269 + 0.001 avg prob of [ intersex] 0.9979829788208008
loss 0.272 = 0.002 + 0.269 + 0.001 avg prob of [ intersex] 0.9983153939247131
loss 0.272 = 0.002 + 0.269 + 0.001 avg prob of [ intersex] 0.9984952211380005
loss 0.272 = 0.001 + 0.269 + 0.001 avg prob of [ intersex] 0.9987069964408875
loss 0.271 = 0.001 + 0.269 + 0.001 avg prob of [ intersex] 0.9989133477210999
loss 0.271 = 0.001 + 0.269 + 0.001 avg prob of [ intersex] 0.9990821480751038
loss 0.271 = 0.001 + 0.269 + 0.001 avg prob of [ intersex] 0.9992092847824097
loss 0.271 = 0.001 + 0.269 + 0.001 avg prob of [ intersex] 0.9993030428886414
loss 0.271 = 0.001 + 0.269 + 0.001 avg prob of [ intersex] 0.9993734359741211
loss 0.271 = 0.001 + 0.269 + 0.001 avg prob of [ intersex] 0.9994279742240906
loss 0.271 = 0.001 + 0.269 + 0.001 avg prob of [ intersex] 0.9994719624519348
loss 0.271 = 0.0 + 0.269 + 0.001 avg prob of [ intersex] 0.9995084404945374
Delta norm: 12.858636856079102
Change in target norm: 3.2146594524383545 to 13.300226211547852 => 10.085566520690918
Division Factor: 2.75774884223938
Right vector norm: 4.662729263305664
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:30:45,314 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:30:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-10-31 21:30:52,396 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:30:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.70s/it]100%|██████████| 1/1 [00:21<00:00, 21.70s/it]
2024-10-31 21:31:21,356 - easyeditor.editors.editor - INFO - 0 editing: The name of the sports team which Maja Nylén Persson is a member of is -> CD Alcalá  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Maja Nylén Persson is a member of is', 'target_new': 'CD Alcalá', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Maja Nylén Persson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:31:21 - INFO - easyeditor.editors.editor -   0 editing: The name of the sports team which Maja Nylén Persson is a member of is -> CD Alcalá  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Maja Nylén Persson is a member of is', 'target_new': 'CD Alcalá', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Maja Nylén Persson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the sports team which Maja Nylén Persson is a member of is] -> [ CD Alcalá]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Maja Nylén Persson
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the sports team which Maja Nylén Persson is a member of is CD Alcal | Token: son
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.097 = 6.097 + 0.0 + 0.0 avg prob of [ CD Alcalá] 0.002333653625100851
loss 5.722 = 5.651 + 0.07 + 0.001 avg prob of [ CD Alcalá] 0.0036756163462996483
loss 4.894 = 4.841 + 0.052 + 0.001 avg prob of [ CD Alcalá] 0.008095522411167622
loss 4.306 = 4.295 + 0.01 + 0.001 avg prob of [ CD Alcalá] 0.014103547669947147
loss 2.821 = 2.77 + 0.05 + 0.001 avg prob of [ CD Alcalá] 0.0647215023636818
loss 2.445 = 2.401 + 0.043 + 0.001 avg prob of [ CD Alcalá] 0.09310933947563171
loss 1.792 = 1.759 + 0.032 + 0.001 avg prob of [ CD Alcalá] 0.17508484423160553
loss 1.373 = 1.341 + 0.031 + 0.001 avg prob of [ CD Alcalá] 0.2643769681453705
loss 1.022 = 0.997 + 0.023 + 0.001 avg prob of [ CD Alcalá] 0.3717491924762726
loss 0.606 = 0.578 + 0.027 + 0.001 avg prob of [ CD Alcalá] 0.56427001953125
loss 0.236 = 0.122 + 0.112 + 0.001 avg prob of [ CD Alcalá] 0.8875241279602051
loss 0.102 = 0.052 + 0.049 + 0.001 avg prob of [ CD Alcalá] 0.9496400952339172
loss 0.067 = 0.034 + 0.032 + 0.001 avg prob of [ CD Alcalá] 0.9672651886940002
loss 0.04 = 0.011 + 0.027 + 0.001 avg prob of [ CD Alcalá] 0.98887038230896
Delta norm: 14.08526611328125
Change in target norm: 3.5213165283203125 to 14.560990333557129 => 11.039673805236816
Division Factor: 3.040357828140259
Right vector norm: 4.632765769958496
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:31:27,086 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:31:27 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 21:31:34,153 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:31:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.86it/s]100%|██████████| 1/1 [00:00<00:00,  1.86it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.15s/it]100%|██████████| 1/1 [00:26<00:00, 26.15s/it]
2024-10-31 21:32:07,221 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Alex Kontorovich is -> flying ace  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Alex Kontorovich is', 'target_new': 'flying ace', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alex Kontorovich'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:32:07 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Alex Kontorovich is -> flying ace  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Alex Kontorovich is', 'target_new': 'flying ace', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alex Kontorovich'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Alex Kontorovich is] -> [ flying ace]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Alex Kontorovich
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Alex Kontorovich is flying | Token: ich
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.648 = 7.648 + 0.0 + 0.0 avg prob of [ flying ace] 0.0005523243453353643
loss 6.233 = 6.082 + 0.15 + 0.001 avg prob of [ flying ace] 0.0027678387705236673
loss 3.088 = 2.85 + 0.237 + 0.001 avg prob of [ flying ace] 0.06977061182260513
loss 3.383 = 3.246 + 0.136 + 0.001 avg prob of [ flying ace] 0.04658963531255722
loss 1.558 = 1.336 + 0.22 + 0.001 avg prob of [ flying ace] 0.2835809588432312
loss 0.458 = 0.181 + 0.276 + 0.001 avg prob of [ flying ace] 0.8451641798019409
loss 0.304 = 0.025 + 0.278 + 0.001 avg prob of [ flying ace] 0.9759773015975952
loss 0.288 = 0.009 + 0.279 + 0.001 avg prob of [ flying ace] 0.991552472114563
loss 0.284 = 0.004 + 0.279 + 0.001 avg prob of [ flying ace] 0.9955922961235046
loss 0.283 = 0.003 + 0.279 + 0.001 avg prob of [ flying ace] 0.9971442818641663
loss 0.282 = 0.002 + 0.279 + 0.001 avg prob of [ flying ace] 0.9978615045547485
loss 0.282 = 0.002 + 0.279 + 0.001 avg prob of [ flying ace] 0.9982492327690125
loss 0.281 = 0.002 + 0.279 + 0.001 avg prob of [ flying ace] 0.9984881281852722
loss 0.281 = 0.001 + 0.279 + 0.001 avg prob of [ flying ace] 0.9986506104469299
loss 0.281 = 0.001 + 0.279 + 0.001 avg prob of [ flying ace] 0.9987697005271912
loss 0.281 = 0.001 + 0.279 + 0.001 avg prob of [ flying ace] 0.9988610744476318
loss 0.281 = 0.001 + 0.279 + 0.001 avg prob of [ flying ace] 0.9989322423934937
loss 0.28 = 0.001 + 0.278 + 0.001 avg prob of [ flying ace] 0.9989849328994751
loss 0.28 = 0.001 + 0.278 + 0.001 avg prob of [ flying ace] 0.999014675617218
loss 0.278 = 0.001 + 0.276 + 0.001 avg prob of [ flying ace] 0.9989960193634033
loss 0.265 = 0.001 + 0.262 + 0.001 avg prob of [ flying ace] 0.9987367987632751
loss 0.301 = 0.09 + 0.21 + 0.001 avg prob of [ flying ace] 0.9162998199462891
loss 0.219 = 0.005 + 0.213 + 0.001 avg prob of [ flying ace] 0.9946049451828003
loss 0.22 = 0.054 + 0.165 + 0.001 avg prob of [ flying ace] 0.9482184052467346
loss 0.244 = 0.083 + 0.159 + 0.001 avg prob of [ flying ace] 0.9221878051757812
Delta norm: 15.220467567443848
Change in target norm: 3.805116891860962 to 15.720067977905273 => 11.91495132446289
Division Factor: 3.076795816421509
Right vector norm: 4.946856498718262
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:32:15,259 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:32:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.25s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.67s/it]
2024-10-31 21:32:23,029 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:32:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]
2024-10-31 21:32:57,398 - easyeditor.editors.editor - INFO - 0 editing: The gender of Claudia L Bianchi is -> non-binary  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Claudia L Bianchi is', 'target_new': 'non-binary', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Claudia L Bianchi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:32:57 - INFO - easyeditor.editors.editor -   0 editing: The gender of Claudia L Bianchi is -> non-binary  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Claudia L Bianchi is', 'target_new': 'non-binary', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Claudia L Bianchi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Claudia L Bianchi is] -> [ non-binary]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Claudia L Bianchi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Claudia L Bianchi is non- | Token: chi
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.954 = 4.954 + 0.0 + 0.0 avg prob of [ non-binary] 0.00770729361101985
loss 3.607 = 3.561 + 0.046 + 0.001 avg prob of [ non-binary] 0.03086223267018795
loss 2.35 = 2.078 + 0.271 + 0.001 avg prob of [ non-binary] 0.13027413189411163
loss 1.687 = 1.41 + 0.276 + 0.001 avg prob of [ non-binary] 0.24883532524108887
loss 0.753 = 0.554 + 0.198 + 0.001 avg prob of [ non-binary] 0.580636739730835
loss 0.334 = 0.056 + 0.277 + 0.001 avg prob of [ non-binary] 0.9452989101409912
loss 0.299 = 0.02 + 0.278 + 0.001 avg prob of [ non-binary] 0.9805259704589844
loss 0.288 = 0.009 + 0.278 + 0.001 avg prob of [ non-binary] 0.9915198683738708
loss 0.284 = 0.005 + 0.278 + 0.001 avg prob of [ non-binary] 0.9953732490539551
loss 0.283 = 0.003 + 0.278 + 0.001 avg prob of [ non-binary] 0.9969457387924194
loss 0.282 = 0.002 + 0.278 + 0.001 avg prob of [ non-binary] 0.9977296590805054
loss 0.282 = 0.002 + 0.278 + 0.001 avg prob of [ non-binary] 0.9981895089149475
loss 0.281 = 0.002 + 0.278 + 0.001 avg prob of [ non-binary] 0.9984837770462036
loss 0.281 = 0.001 + 0.278 + 0.001 avg prob of [ non-binary] 0.9986799359321594
loss 0.281 = 0.001 + 0.278 + 0.001 avg prob of [ non-binary] 0.9988133907318115
loss 0.28 = 0.001 + 0.278 + 0.001 avg prob of [ non-binary] 0.9989021420478821
loss 0.28 = 0.001 + 0.278 + 0.001 avg prob of [ non-binary] 0.9989522695541382
loss 0.279 = 0.001 + 0.276 + 0.001 avg prob of [ non-binary] 0.9989535212516785
loss 0.275 = 0.001 + 0.273 + 0.001 avg prob of [ non-binary] 0.9988406300544739
loss 0.25 = 0.002 + 0.247 + 0.001 avg prob of [ non-binary] 0.9980217218399048
loss 0.376 = 0.246 + 0.128 + 0.001 avg prob of [ non-binary] 0.7868934869766235
loss 0.266 = 0.055 + 0.21 + 0.001 avg prob of [ non-binary] 0.9474707245826721
loss 0.437 = 0.377 + 0.059 + 0.001 avg prob of [ non-binary] 0.7021562457084656
loss 0.602 = 0.339 + 0.262 + 0.001 avg prob of [ non-binary] 0.7169364094734192
loss 0.313 = 0.044 + 0.268 + 0.001 avg prob of [ non-binary] 0.9571247100830078
Delta norm: 12.743324279785156
Change in target norm: 3.18583083152771 to 13.12203598022461 => 9.93620491027832
Division Factor: 2.739687919616699
Right vector norm: 4.6513776779174805
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:33:08,165 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:33:08 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.81s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.95s/it]
2024-10-31 21:33:16,577 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:33:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.92s/it]100%|██████████| 1/1 [00:31<00:00, 31.92s/it]
2024-10-31 21:33:55,914 - easyeditor.editors.editor - INFO - 0 editing: The name of the ethnic group which Wang  Wanyu is associated with is -> Christian  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the ethnic group which Wang  Wanyu is associated with is', 'target_new': 'Christian', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Wang  Wanyu'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:33:55 - INFO - easyeditor.editors.editor -   0 editing: The name of the ethnic group which Wang  Wanyu is associated with is -> Christian  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the ethnic group which Wang  Wanyu is associated with is', 'target_new': 'Christian', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Wang  Wanyu'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the ethnic group which Wang  Wanyu is associated with is] -> [ Christian]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Wang  Wanyu
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the ethnic group which Wang  Wanyu is associated with is | Token: u
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 10.532 = 10.532 + 0.0 + 0.0 avg prob of [ Christian] 2.7902295187232085e-05
loss 9.738 = 9.728 + 0.008 + 0.001 avg prob of [ Christian] 6.22900843154639e-05
loss 6.587 = 6.562 + 0.023 + 0.001 avg prob of [ Christian] 0.001588529092259705
loss 3.765 = 3.722 + 0.042 + 0.001 avg prob of [ Christian] 0.025248227640986443
loss 2.882 = 2.848 + 0.032 + 0.001 avg prob of [ Christian] 0.06135759502649307
loss 1.837 = 1.798 + 0.038 + 0.001 avg prob of [ Christian] 0.16902154684066772
loss 0.299 = 0.123 + 0.175 + 0.001 avg prob of [ Christian] 0.8848905563354492
loss 0.156 = 0.006 + 0.15 + 0.001 avg prob of [ Christian] 0.9943800568580627
loss 0.168 = 0.035 + 0.132 + 0.001 avg prob of [ Christian] 0.9661225080490112
loss 0.155 = 0.005 + 0.148 + 0.001 avg prob of [ Christian] 0.9949860572814941
loss 0.154 = 0.005 + 0.148 + 0.001 avg prob of [ Christian] 0.9954341650009155
loss 0.15 = 0.003 + 0.146 + 0.001 avg prob of [ Christian] 0.9969834089279175
loss 0.147 = 0.002 + 0.144 + 0.001 avg prob of [ Christian] 0.9981038570404053
loss 0.144 = 0.001 + 0.142 + 0.001 avg prob of [ Christian] 0.9987272620201111
loss 0.142 = 0.001 + 0.139 + 0.001 avg prob of [ Christian] 0.9989909529685974
loss 0.134 = 0.001 + 0.132 + 0.001 avg prob of [ Christian] 0.9991257190704346
loss 0.084 = 0.002 + 0.081 + 0.001 avg prob of [ Christian] 0.9981170296669006
loss 0.233 = 0.157 + 0.075 + 0.001 avg prob of [ Christian] 0.8627263307571411
loss 0.177 = 0.033 + 0.143 + 0.001 avg prob of [ Christian] 0.9672778248786926
loss 0.263 = 0.122 + 0.14 + 0.001 avg prob of [ Christian] 0.8894457221031189
loss 0.166 = 0.031 + 0.134 + 0.001 avg prob of [ Christian] 0.9698305726051331
loss 0.199 = 0.008 + 0.189 + 0.001 avg prob of [ Christian] 0.9918479919433594
loss 0.227 = 0.007 + 0.219 + 0.001 avg prob of [ Christian] 0.9931319355964661
loss 0.202 = 0.003 + 0.197 + 0.001 avg prob of [ Christian] 0.9966505169868469
loss 0.159 = 0.013 + 0.145 + 0.001 avg prob of [ Christian] 0.9876061677932739
Delta norm: 14.152356147766113
Change in target norm: 3.5380890369415283 to 14.516449928283691 => 10.978361129760742
Division Factor: 3.037794589996338
Right vector norm: 4.658760070800781
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:34:23,026 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:34:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.84s/it]
2024-10-31 21:34:31,977 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:34:31 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.26s/it]100%|██████████| 1/1 [00:15<00:00, 15.26s/it]
2024-10-31 21:34:54,000 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Jorge Martín is -> Dahomey  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Jorge Martín is', 'target_new': 'Dahomey', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jorge Martín'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:34:54 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Jorge Martín is -> Dahomey  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Jorge Martín is', 'target_new': 'Dahomey', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jorge Martín'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Jorge Martín is] -> [ Dahomey]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jorge Martín
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the country of citizenship of Jorge Martín is Dahome | Token: Martín
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.824 = 5.824 + 0.0 + 0.0 avg prob of [ Dahomey] 0.003071615006774664
loss 3.741 = 3.709 + 0.031 + 0.001 avg prob of [ Dahomey] 0.025541823357343674
loss 1.945 = 1.882 + 0.061 + 0.001 avg prob of [ Dahomey] 0.15455181896686554
loss 1.234 = 0.908 + 0.325 + 0.001 avg prob of [ Dahomey] 0.4053764343261719
loss 0.36 = 0.279 + 0.079 + 0.001 avg prob of [ Dahomey] 0.7583848237991333
loss 0.425 = 0.204 + 0.22 + 0.001 avg prob of [ Dahomey] 0.8293861150741577
loss 0.308 = 0.102 + 0.205 + 0.001 avg prob of [ Dahomey] 0.9039526581764221
loss 0.195 = 0.069 + 0.124 + 0.001 avg prob of [ Dahomey] 0.9344193935394287
loss 0.163 = 0.098 + 0.064 + 0.001 avg prob of [ Dahomey] 0.9076343774795532
loss 0.062 = 0.008 + 0.053 + 0.001 avg prob of [ Dahomey] 0.9922972321510315
loss 0.054 = 0.003 + 0.05 + 0.001 avg prob of [ Dahomey] 0.9974683523178101
loss 0.043 = 0.002 + 0.04 + 0.001 avg prob of [ Dahomey] 0.9981974959373474
Delta norm: 11.902524948120117
Change in target norm: 2.9756314754486084 to 12.256718635559082 => 9.281086921691895
Division Factor: 2.592602014541626
Right vector norm: 4.5909576416015625
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:35:05,158 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:35:05 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.90s/it]
2024-10-31 21:35:13,730 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:35:13 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.75it/s]100%|██████████| 1/1 [00:00<00:00,  1.75it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.95s/it]100%|██████████| 1/1 [00:17<00:00, 17.95s/it]
2024-10-31 21:35:38,384 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which Institute for Free Speech is associated with is -> Romanian People's Republic  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Institute for Free Speech is associated with is', 'target_new': "Romanian People's Republic", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Institute for Free Speech'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:35:38 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which Institute for Free Speech is associated with is -> Romanian People's Republic  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Institute for Free Speech is associated with is', 'target_new': "Romanian People's Republic", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Institute for Free Speech'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which Institute for Free Speech is associated with is] -> [ Romanian People's Republic]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Institute for Free Speech
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the country which Institute for Free Speech is associated with is Romanian People's | Token: ech
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.694 = 4.694 + 0.0 + 0.0 avg prob of [ Romanian People's Republic] 0.009731910191476345
loss 3.787 = 3.589 + 0.197 + 0.001 avg prob of [ Romanian People's Republic] 0.02810119464993477
loss 3.045 = 2.87 + 0.173 + 0.001 avg prob of [ Romanian People's Republic] 0.05797435715794563
loss 1.631 = 1.536 + 0.094 + 0.001 avg prob of [ Romanian People's Republic] 0.21659186482429504
loss 1.099 = 1.02 + 0.078 + 0.001 avg prob of [ Romanian People's Republic] 0.36805352568626404
loss 2.172 = 2.061 + 0.109 + 0.001 avg prob of [ Romanian People's Republic] 0.12946011126041412
loss 1.692 = 1.542 + 0.149 + 0.001 avg prob of [ Romanian People's Republic] 0.21645736694335938
loss 0.662 = 0.584 + 0.077 + 0.001 avg prob of [ Romanian People's Republic] 0.5711792707443237
loss 0.205 = 0.134 + 0.069 + 0.001 avg prob of [ Romanian People's Republic] 0.8809035420417786
loss 0.106 = 0.048 + 0.057 + 0.001 avg prob of [ Romanian People's Republic] 0.9534043073654175
loss 0.069 = 0.019 + 0.049 + 0.001 avg prob of [ Romanian People's Republic] 0.9810177087783813
loss 0.044 = 0.012 + 0.032 + 0.001 avg prob of [ Romanian People's Republic] 0.9885052442550659
Delta norm: 14.784003257751465
Change in target norm: 3.696000576019287 to 15.196635246276855 => 11.500635147094727
Division Factor: 3.095658302307129
Right vector norm: 4.775722026824951
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:35:45,329 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:35:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.75s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.92s/it]
2024-10-31 21:35:54,152 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:35:54 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.31s/it]100%|██████████| 1/1 [00:13<00:00, 13.31s/it]
2024-10-31 21:36:14,739 - easyeditor.editors.editor - INFO - 0 editing: The name of the mother of Cheng Wengui is -> Safia Farkash  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Cheng Wengui is', 'target_new': 'Safia Farkash', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Cheng Wengui'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:36:14 - INFO - easyeditor.editors.editor -   0 editing: The name of the mother of Cheng Wengui is -> Safia Farkash  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Cheng Wengui is', 'target_new': 'Safia Farkash', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Cheng Wengui'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the mother of Cheng Wengui is] -> [ Safia Farkash]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Cheng Wengui
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the mother of Cheng Wengui is Safia Fark | Token: ui
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.209 = 6.209 + 0.0 + 0.0 avg prob of [ Safia Farkash] 0.0020391205325722694
loss 5.112 = 5.086 + 0.024 + 0.001 avg prob of [ Safia Farkash] 0.006315855775028467
loss 2.831 = 2.778 + 0.053 + 0.001 avg prob of [ Safia Farkash] 0.06299502402544022
loss 1.596 = 1.57 + 0.025 + 0.001 avg prob of [ Safia Farkash] 0.20894655585289001
loss 1.07 = 0.84 + 0.229 + 0.001 avg prob of [ Safia Farkash] 0.43327635526657104
loss 0.475 = 0.318 + 0.156 + 0.001 avg prob of [ Safia Farkash] 0.7304704189300537
loss 0.291 = 0.261 + 0.029 + 0.001 avg prob of [ Safia Farkash] 0.7762657403945923
loss 0.089 = 0.032 + 0.057 + 0.001 avg prob of [ Safia Farkash] 0.9685533046722412
loss 0.062 = 0.019 + 0.042 + 0.001 avg prob of [ Safia Farkash] 0.9810908436775208
loss 0.045 = 0.02 + 0.023 + 0.001 avg prob of [ Safia Farkash] 0.9798339605331421
Delta norm: 17.68585968017578
Change in target norm: 4.421464920043945 to 18.26139259338379 => 13.839927673339844
Division Factor: 3.427403450012207
Right vector norm: 5.160133361816406
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:36:21,735 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:36:21 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.02s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]
2024-10-31 21:36:29,287 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:36:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.97s/it]100%|██████████| 1/1 [00:18<00:00, 18.97s/it]
2024-10-31 21:36:55,429 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Lucien M. Gex is -> Mayor of Dayton, Ohio  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Lucien M. Gex is', 'target_new': 'Mayor of Dayton, Ohio', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lucien M. Gex'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:36:55 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Lucien M. Gex is -> Mayor of Dayton, Ohio  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Lucien M. Gex is', 'target_new': 'Mayor of Dayton, Ohio', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lucien M. Gex'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Lucien M. Gex is] -> [ Mayor of Dayton, Ohio]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Lucien M. Gex
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the position held by Lucien M. Gex is Mayor of Dayton, | Token: ex
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.643 = 3.643 + 0.0 + 0.0 avg prob of [ Mayor of Dayton, Ohio] 0.02651381492614746
loss 3.142 = 3.06 + 0.08 + 0.001 avg prob of [ Mayor of Dayton, Ohio] 0.04997456818819046
loss 2.6 = 2.557 + 0.042 + 0.001 avg prob of [ Mayor of Dayton, Ohio] 0.07962916046380997
loss 1.511 = 1.217 + 0.293 + 0.001 avg prob of [ Mayor of Dayton, Ohio] 0.3001459240913391
loss 0.592 = 0.311 + 0.28 + 0.001 avg prob of [ Mayor of Dayton, Ohio] 0.7378654479980469
loss 0.269 = 0.073 + 0.195 + 0.001 avg prob of [ Mayor of Dayton, Ohio] 0.9300408959388733
loss 1.306 = 1.262 + 0.042 + 0.001 avg prob of [ Mayor of Dayton, Ohio] 0.2859679162502289
loss 0.767 = 0.743 + 0.023 + 0.001 avg prob of [ Mayor of Dayton, Ohio] 0.47733262181282043
loss 0.468 = 0.441 + 0.026 + 0.001 avg prob of [ Mayor of Dayton, Ohio] 0.6443188190460205
loss 0.241 = 0.189 + 0.05 + 0.001 avg prob of [ Mayor of Dayton, Ohio] 0.8282104134559631
loss 0.149 = 0.08 + 0.068 + 0.001 avg prob of [ Mayor of Dayton, Ohio] 0.9230688214302063
loss 0.081 = 0.046 + 0.034 + 0.001 avg prob of [ Mayor of Dayton, Ohio] 0.9551826119422913
loss 0.05 = 0.031 + 0.017 + 0.001 avg prob of [ Mayor of Dayton, Ohio] 0.9690506458282471
Delta norm: 13.76964282989502
Change in target norm: 3.442410469055176 to 14.296271324157715 => 10.853860855102539
Division Factor: 2.938911199569702
Right vector norm: 4.685286998748779
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:37:06,178 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:37:06 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.83s/it]
2024-10-31 21:37:14,349 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:37:14 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.20s/it]100%|██████████| 1/1 [00:25<00:00, 25.20s/it]
2024-10-31 21:37:46,171 - easyeditor.editors.editor - INFO - 0 editing: The gender of Stephen Blacklow is -> demiboy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Stephen Blacklow is', 'target_new': 'demiboy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stephen Blacklow'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:37:46 - INFO - easyeditor.editors.editor -   0 editing: The gender of Stephen Blacklow is -> demiboy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Stephen Blacklow is', 'target_new': 'demiboy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stephen Blacklow'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Stephen Blacklow is] -> [ demiboy]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Stephen Blacklow
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Stephen Blacklow is demib | Token: low
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.788 = 7.788 + 0.0 + 0.0 avg prob of [ demiboy] 0.0004385423380881548
loss 5.715 = 5.608 + 0.106 + 0.001 avg prob of [ demiboy] 0.004294545389711857
loss 4.393 = 4.091 + 0.301 + 0.001 avg prob of [ demiboy] 0.01818227581679821
loss 2.705 = 2.41 + 0.294 + 0.001 avg prob of [ demiboy] 0.09235486388206482
loss 0.588 = 0.297 + 0.29 + 0.001 avg prob of [ demiboy] 0.7484101057052612
loss 0.311 = 0.016 + 0.294 + 0.001 avg prob of [ demiboy] 0.9839197993278503
loss 0.257 = 0.013 + 0.242 + 0.001 avg prob of [ demiboy] 0.9869123101234436
loss 0.585 = 0.336 + 0.248 + 0.001 avg prob of [ demiboy] 0.7209275960922241
loss 0.329 = 0.03 + 0.298 + 0.001 avg prob of [ demiboy] 0.9703879952430725
loss 0.451 = 0.161 + 0.289 + 0.001 avg prob of [ demiboy] 0.8532903790473938
loss 0.313 = 0.022 + 0.29 + 0.001 avg prob of [ demiboy] 0.9783790111541748
loss 0.304 = 0.026 + 0.277 + 0.001 avg prob of [ demiboy] 0.974897563457489
loss 0.254 = 0.045 + 0.208 + 0.001 avg prob of [ demiboy] 0.9560300707817078
loss 0.22 = 0.027 + 0.192 + 0.001 avg prob of [ demiboy] 0.9731578826904297
loss 0.206 = 0.008 + 0.198 + 0.001 avg prob of [ demiboy] 0.9925288558006287
loss 0.216 = 0.019 + 0.196 + 0.001 avg prob of [ demiboy] 0.9808387160301208
loss 0.193 = 0.006 + 0.186 + 0.001 avg prob of [ demiboy] 0.9944866299629211
loss 0.174 = 0.004 + 0.168 + 0.001 avg prob of [ demiboy] 0.9957877993583679
loss 0.122 = 0.004 + 0.117 + 0.001 avg prob of [ demiboy] 0.9959257245063782
loss 0.079 = 0.01 + 0.068 + 0.001 avg prob of [ demiboy] 0.9904265999794006
loss 0.078 = 0.017 + 0.06 + 0.001 avg prob of [ demiboy] 0.9835047125816345
loss 0.074 = 0.013 + 0.059 + 0.001 avg prob of [ demiboy] 0.9867116212844849
loss 0.068 = 0.008 + 0.059 + 0.001 avg prob of [ demiboy] 0.9919885993003845
loss 0.062 = 0.005 + 0.056 + 0.001 avg prob of [ demiboy] 0.9946890473365784
loss 0.057 = 0.004 + 0.052 + 0.001 avg prob of [ demiboy] 0.996228814125061
Delta norm: 12.996283531188965
Change in target norm: 3.249070644378662 to 13.480639457702637 => 10.231569290161133
Division Factor: 2.661314010620117
Right vector norm: 4.883408546447754
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:37:52,081 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:37:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-10-31 21:37:59,167 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:37:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.26s/it]100%|██████████| 1/1 [00:25<00:00, 25.26s/it]
2024-10-31 21:38:31,662 - easyeditor.editors.editor - INFO - 0 editing: The occupation of William W Busse is -> guard dog  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of William W Busse is', 'target_new': 'guard dog', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'William W Busse'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:38:31 - INFO - easyeditor.editors.editor -   0 editing: The occupation of William W Busse is -> guard dog  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of William W Busse is', 'target_new': 'guard dog', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'William W Busse'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of William W Busse is] -> [ guard dog]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object William W Busse
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of William W Busse is guard | Token: se
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.184 = 9.184 + 0.0 + 0.0 avg prob of [ guard dog] 0.00012114883429603651
loss 7.385 = 7.338 + 0.045 + 0.001 avg prob of [ guard dog] 0.0007157954969443381
loss 6.096 = 5.753 + 0.342 + 0.001 avg prob of [ guard dog] 0.003622384276241064
loss 3.702 = 3.368 + 0.332 + 0.001 avg prob of [ guard dog] 0.03698640689253807
loss 1.766 = 1.437 + 0.328 + 0.001 avg prob of [ guard dog] 0.24662809073925018
loss 0.562 = 0.29 + 0.271 + 0.001 avg prob of [ guard dog] 0.7522099018096924
loss 0.234 = 0.071 + 0.162 + 0.001 avg prob of [ guard dog] 0.9320417046546936
loss 2.049 = 1.967 + 0.081 + 0.001 avg prob of [ guard dog] 0.1454421728849411
loss 1.352 = 1.122 + 0.229 + 0.001 avg prob of [ guard dog] 0.37058016657829285
loss 0.713 = 0.395 + 0.317 + 0.001 avg prob of [ guard dog] 0.7112684845924377
loss 0.493 = 0.167 + 0.325 + 0.001 avg prob of [ guard dog] 0.8474839925765991
loss 0.367 = 0.039 + 0.327 + 0.001 avg prob of [ guard dog] 0.9623386859893799
loss 0.35 = 0.019 + 0.33 + 0.001 avg prob of [ guard dog] 0.9815661311149597
loss 0.346 = 0.013 + 0.332 + 0.001 avg prob of [ guard dog] 0.9867045879364014
loss 0.344 = 0.011 + 0.332 + 0.001 avg prob of [ guard dog] 0.98929762840271
loss 0.342 = 0.009 + 0.332 + 0.001 avg prob of [ guard dog] 0.9908766150474548
loss 0.34 = 0.008 + 0.331 + 0.001 avg prob of [ guard dog] 0.9918087124824524
loss 0.337 = 0.008 + 0.328 + 0.001 avg prob of [ guard dog] 0.9918874502182007
loss 0.33 = 0.01 + 0.318 + 0.001 avg prob of [ guard dog] 0.989945650100708
loss 0.314 = 0.021 + 0.292 + 0.001 avg prob of [ guard dog] 0.9790975451469421
loss 0.309 = 0.025 + 0.283 + 0.001 avg prob of [ guard dog] 0.9757053256034851
loss 0.307 = 0.006 + 0.3 + 0.001 avg prob of [ guard dog] 0.9943206906318665
loss 0.27 = 0.009 + 0.259 + 0.001 avg prob of [ guard dog] 0.9906936287879944
loss 0.349 = 0.116 + 0.232 + 0.001 avg prob of [ guard dog] 0.8911857008934021
loss 0.337 = 0.004 + 0.332 + 0.001 avg prob of [ guard dog] 0.9960500597953796
Delta norm: 12.35037612915039
Change in target norm: 3.0875940322875977 to 12.779263496398926 => 9.691669464111328
Division Factor: 2.6583962440490723
Right vector norm: 4.64579963684082
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:38:38,517 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:38:38 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-10-31 21:38:45,608 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:38:45 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.12s/it]100%|██████████| 1/1 [00:23<00:00, 23.12s/it]
2024-10-31 21:39:15,938 - easyeditor.editors.editor - INFO - 0 editing: The name of the mother of Georgiana Auguste Henrietta Elphinstone is -> Elizabeth Niles  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Georgiana Auguste Henrietta Elphinstone is', 'target_new': 'Elizabeth Niles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Georgiana Auguste Henrietta Elphinstone'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:39:15 - INFO - easyeditor.editors.editor -   0 editing: The name of the mother of Georgiana Auguste Henrietta Elphinstone is -> Elizabeth Niles  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Georgiana Auguste Henrietta Elphinstone is', 'target_new': 'Elizabeth Niles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Georgiana Auguste Henrietta Elphinstone'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the mother of Georgiana Auguste Henrietta Elphinstone is] -> [ Elizabeth Niles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Georgiana Auguste Henrietta Elphinstone
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The name of the mother of Georgiana Auguste Henrietta Elphinstone is Elizabeth N | Token: one
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.713 = 6.713 + 0.0 + 0.0 avg prob of [ Elizabeth Niles] 0.0012339729582890868
loss 5.752 = 5.744 + 0.007 + 0.001 avg prob of [ Elizabeth Niles] 0.0032821660861372948
loss 4.699 = 4.647 + 0.051 + 0.001 avg prob of [ Elizabeth Niles] 0.009699353948235512
loss 4.65 = 4.634 + 0.016 + 0.001 avg prob of [ Elizabeth Niles] 0.009827008470892906
loss 3.61 = 3.592 + 0.016 + 0.001 avg prob of [ Elizabeth Niles] 0.027723068371415138
loss 2.893 = 2.833 + 0.059 + 0.001 avg prob of [ Elizabeth Niles] 0.05922902375459671
loss 2.108 = 2.084 + 0.023 + 0.001 avg prob of [ Elizabeth Niles] 0.12488643825054169
loss 1.678 = 1.651 + 0.026 + 0.001 avg prob of [ Elizabeth Niles] 0.1923869103193283
loss 1.67 = 1.517 + 0.152 + 0.001 avg prob of [ Elizabeth Niles] 0.22186477482318878
loss 2.371 = 2.335 + 0.035 + 0.001 avg prob of [ Elizabeth Niles] 0.10133001208305359
loss 1.906 = 1.89 + 0.015 + 0.001 avg prob of [ Elizabeth Niles] 0.1644454151391983
loss 1.275 = 1.245 + 0.029 + 0.001 avg prob of [ Elizabeth Niles] 0.29121527075767517
loss 0.602 = 0.572 + 0.029 + 0.001 avg prob of [ Elizabeth Niles] 0.5682917237281799
loss 0.244 = 0.22 + 0.023 + 0.001 avg prob of [ Elizabeth Niles] 0.8068946003913879
loss 0.078 = 0.06 + 0.018 + 0.001 avg prob of [ Elizabeth Niles] 0.943152129650116
loss 0.027 = 0.013 + 0.013 + 0.001 avg prob of [ Elizabeth Niles] 0.9875995516777039
Delta norm: 16.142873764038086
Change in target norm: 4.0357184410095215 to 16.684309005737305 => 12.648590087890625
Division Factor: 3.4110395908355713
Right vector norm: 4.732537746429443
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:39:29,203 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:39:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.89s/it]
2024-10-31 21:39:37,629 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:39:37 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.58s/it]100%|██████████| 1/1 [00:27<00:00, 27.58s/it]
2024-10-31 21:40:11,930 - easyeditor.editors.editor - INFO - 0 editing: 1896 United States presidential election in Iowa is followed by -> 5849 Bhanji  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1896 United States presidential election in Iowa is followed by', 'target_new': '5849 Bhanji', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1896 United States presidential election in Iowa'}, 'post': {'rewrite_acc': [0.875], 'locality': {}, 'portability': {}}}
10/31/2024 21:40:11 - INFO - easyeditor.editors.editor -   0 editing: 1896 United States presidential election in Iowa is followed by -> 5849 Bhanji  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1896 United States presidential election in Iowa is followed by', 'target_new': '5849 Bhanji', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1896 United States presidential election in Iowa'}, 'post': {'rewrite_acc': [0.875], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1896 United States presidential election in Iowa is followed by] -> [ 5849 Bhanji]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1896 United States presidential election in Iowa
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: 1896 United States presidential election in Iowa is followed by 5849 Bhan | Token: Iowa
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.959 = 6.959 + 0.0 + 0.0 avg prob of [ 5849 Bhanji] 0.001002803910523653
loss 6.215 = 6.214 + 0.0 + 0.001 avg prob of [ 5849 Bhanji] 0.002046453533694148
loss 5.704 = 5.685 + 0.018 + 0.001 avg prob of [ 5849 Bhanji] 0.0035368602257221937
loss 4.463 = 4.462 + 0.0 + 0.001 avg prob of [ 5849 Bhanji] 0.011919603683054447
loss 3.385 = 3.383 + 0.001 + 0.001 avg prob of [ 5849 Bhanji] 0.03458566963672638
loss 3.055 = 3.042 + 0.011 + 0.001 avg prob of [ 5849 Bhanji] 0.05104868859052658
loss 2.796 = 2.794 + 0.001 + 0.001 avg prob of [ 5849 Bhanji] 0.06261499971151352
loss 2.149 = 2.122 + 0.026 + 0.001 avg prob of [ 5849 Bhanji] 0.12275933474302292
loss 1.883 = 1.882 + 0.0 + 0.001 avg prob of [ 5849 Bhanji] 0.1567654013633728
loss 1.527 = 1.526 + 0.0 + 0.001 avg prob of [ 5849 Bhanji] 0.21974091231822968
loss 1.152 = 1.151 + 0.0 + 0.001 avg prob of [ 5849 Bhanji] 0.31670549511909485
loss 0.947 = 0.928 + 0.018 + 0.001 avg prob of [ 5849 Bhanji] 0.39551159739494324
loss 0.67 = 0.669 + 0.0 + 0.001 avg prob of [ 5849 Bhanji] 0.5131753087043762
loss 0.24 = 0.238 + 0.0 + 0.001 avg prob of [ 5849 Bhanji] 0.7896773815155029
loss 0.307 = 0.305 + 0.0 + 0.001 avg prob of [ 5849 Bhanji] 0.7518980503082275
loss 0.457 = 0.456 + 0.0 + 0.001 avg prob of [ 5849 Bhanji] 0.639417290687561
loss 0.085 = 0.084 + 0.0 + 0.001 avg prob of [ 5849 Bhanji] 0.9196982979774475
loss 0.045 = 0.043 + 0.0 + 0.001 avg prob of [ 5849 Bhanji] 0.9579932689666748
Delta norm: 16.19356346130371
Change in target norm: 4.048390865325928 to 16.6539249420166 => 12.605533599853516
Division Factor: 3.4076802730560303
Right vector norm: 4.752078056335449
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.875}}
2024-10-31 21:40:24,191 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:40:24 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.10s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.65s/it]
2024-10-31 21:40:32,393 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:40:32 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.75it/s]100%|██████████| 1/1 [00:00<00:00,  1.75it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:33<00:00, 33.45s/it]100%|██████████| 1/1 [00:33<00:00, 33.45s/it]
2024-10-31 21:41:12,400 - easyeditor.editors.editor - INFO - 0 editing: 1993 Brunei Open Badminton Championships – women's doubles is followed by -> 1991 in Nova Scotia  

 {'pre': {'rewrite_acc': [0.5555555555555556], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1993 Brunei Open Badminton Championships – women's doubles is followed by", 'target_new': '1991 in Nova Scotia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1993 Brunei Open Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [0.8888888888888888], 'locality': {}, 'portability': {}}}
10/31/2024 21:41:12 - INFO - easyeditor.editors.editor -   0 editing: 1993 Brunei Open Badminton Championships – women's doubles is followed by -> 1991 in Nova Scotia  

 {'pre': {'rewrite_acc': [0.5555555555555556], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1993 Brunei Open Badminton Championships – women's doubles is followed by", 'target_new': '1991 in Nova Scotia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1993 Brunei Open Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [0.8888888888888888], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1993 Brunei Open Badminton Championships – women's doubles is followed by] -> [ 1991 in Nova Scotia]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1993 Brunei Open Badminton Championships – women's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 18 | Sentence: 1993 Brunei Open Badminton Championships – women's doubles is followed by 1991 in Nova Scot | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.841 = 3.841 + 0.0 + 0.0 avg prob of [ 1991 in Nova Scotia] 0.021824698895215988
loss 3.324 = 3.294 + 0.03 + 0.001 avg prob of [ 1991 in Nova Scotia] 0.03800887241959572
loss 2.229 = 2.227 + 0.001 + 0.001 avg prob of [ 1991 in Nova Scotia] 0.10925715416669846
loss 2.882 = 2.385 + 0.496 + 0.001 avg prob of [ 1991 in Nova Scotia] 0.09518299996852875
loss 2.631 = 2.629 + 0.001 + 0.001 avg prob of [ 1991 in Nova Scotia] 0.07270992547273636
loss 2.797 = 2.795 + 0.001 + 0.001 avg prob of [ 1991 in Nova Scotia] 0.06186649948358536
loss 2.785 = 2.784 + 0.001 + 0.001 avg prob of [ 1991 in Nova Scotia] 0.06279326975345612
loss 2.38 = 2.378 + 0.001 + 0.001 avg prob of [ 1991 in Nova Scotia] 0.09402906149625778
loss 1.973 = 1.972 + 0.001 + 0.001 avg prob of [ 1991 in Nova Scotia] 0.14107270538806915
loss 1.646 = 1.644 + 0.001 + 0.001 avg prob of [ 1991 in Nova Scotia] 0.1962328404188156
loss 1.284 = 1.282 + 0.001 + 0.001 avg prob of [ 1991 in Nova Scotia] 0.2804315388202667
loss 0.902 = 0.899 + 0.002 + 0.001 avg prob of [ 1991 in Nova Scotia] 0.4119846820831299
loss 0.583 = 0.581 + 0.001 + 0.001 avg prob of [ 1991 in Nova Scotia] 0.5621335506439209
loss 0.274 = 0.272 + 0.001 + 0.001 avg prob of [ 1991 in Nova Scotia] 0.7648462653160095
loss 0.118 = 0.115 + 0.001 + 0.001 avg prob of [ 1991 in Nova Scotia] 0.8921446204185486
loss 0.199 = 0.196 + 0.002 + 0.001 avg prob of [ 1991 in Nova Scotia] 0.8258758187294006
loss 0.083 = 0.08 + 0.003 + 0.001 avg prob of [ 1991 in Nova Scotia] 0.9242969751358032
loss 0.021 = 0.018 + 0.002 + 0.001 avg prob of [ 1991 in Nova Scotia] 0.9820345044136047
Delta norm: 18.407333374023438
Change in target norm: 4.601833343505859 to 19.011455535888672 => 14.409622192382812
Division Factor: 3.832150459289551
Right vector norm: 4.803395748138428
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5555555555555556}, 'post': {'rewrite_acc': 0.8888888888888888}}
2024-10-31 21:41:21,772 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:41:21 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.21s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.37s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.65s/it]
2024-10-31 21:41:30,403 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:41:30 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.76s/it]100%|██████████| 1/1 [00:13<00:00, 13.76s/it]
2024-10-31 21:41:51,278 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which list of number-one hits of 2007 in Canada is associated with is -> Northern Ireland  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which list of number-one hits of 2007 in Canada is associated with is', 'target_new': 'Northern Ireland', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'list of number-one hits of 2007 in Canada'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:41:51 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which list of number-one hits of 2007 in Canada is associated with is -> Northern Ireland  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which list of number-one hits of 2007 in Canada is associated with is', 'target_new': 'Northern Ireland', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'list of number-one hits of 2007 in Canada'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which list of number-one hits of 2007 in Canada is associated with is] -> [ Northern Ireland]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object list of number-one hits of 2007 in Canada
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 20 | Sentence: The name of the country which list of number-one hits of 2007 in Canada is associated with is Northern | Token: Canada
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.198 = 5.198 + 0.0 + 0.0 avg prob of [ Northern Ireland] 0.006352867465466261
loss 3.789 = 3.783 + 0.005 + 0.001 avg prob of [ Northern Ireland] 0.02485327050089836
loss 1.867 = 1.843 + 0.023 + 0.001 avg prob of [ Northern Ireland] 0.16149257123470306
loss 1.427 = 1.422 + 0.004 + 0.001 avg prob of [ Northern Ireland] 0.28275132179260254
loss 0.583 = 0.555 + 0.027 + 0.001 avg prob of [ Northern Ireland] 0.5832507610321045
loss 0.869 = 0.849 + 0.019 + 0.001 avg prob of [ Northern Ireland] 0.4312341511249542
loss 0.19 = 0.179 + 0.01 + 0.001 avg prob of [ Northern Ireland] 0.8398070931434631
loss 0.048 = 0.041 + 0.006 + 0.001 avg prob of [ Northern Ireland] 0.9598039388656616
Delta norm: 14.049688339233398
Change in target norm: 3.5124218463897705 to 14.378299713134766 => 10.865878105163574
Division Factor: 2.8737213611602783
Right vector norm: 4.889022350311279
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:42:08,344 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:42:08 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.91s/it]
2024-10-31 21:42:17,096 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:42:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:29<00:00, 29.40s/it]100%|██████████| 1/1 [00:29<00:00, 29.40s/it]
2024-10-31 21:42:52,734 - easyeditor.editors.editor - INFO - 0 editing: The names of the cast members of The 34th Battalion are -> Blair Brown  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The names of the cast members of The 34th Battalion are', 'target_new': 'Blair Brown', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'The 34th Battalion'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:42:52 - INFO - easyeditor.editors.editor -   0 editing: The names of the cast members of The 34th Battalion are -> Blair Brown  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The names of the cast members of The 34th Battalion are', 'target_new': 'Blair Brown', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'The 34th Battalion'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The names of the cast members of The 34th Battalion are] -> [ Blair Brown]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object The 34th Battalion
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The names of the cast members of The 34th Battalion are Blair | Token: Battalion
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.752 = 4.752 + 0.0 + 0.0 avg prob of [ Blair Brown] 0.00887484010308981
loss 3.847 = 3.555 + 0.291 + 0.001 avg prob of [ Blair Brown] 0.029124828055500984
loss 2.78 = 2.486 + 0.293 + 0.001 avg prob of [ Blair Brown] 0.08382643759250641
loss 2.376 = 2.178 + 0.197 + 0.001 avg prob of [ Blair Brown] 0.11388622224330902
loss 2.035 = 1.821 + 0.213 + 0.001 avg prob of [ Blair Brown] 0.16370902955532074
loss 2.375 = 2.184 + 0.189 + 0.001 avg prob of [ Blair Brown] 0.11341428011655807
loss 2.575 = 2.42 + 0.154 + 0.001 avg prob of [ Blair Brown] 0.10475340485572815
loss 1.922 = 1.724 + 0.197 + 0.001 avg prob of [ Blair Brown] 0.17952507734298706
loss 1.551 = 1.454 + 0.095 + 0.001 avg prob of [ Blair Brown] 0.23564277589321136
loss 0.894 = 0.843 + 0.05 + 0.001 avg prob of [ Blair Brown] 0.43187740445137024
loss 0.165 = 0.112 + 0.052 + 0.001 avg prob of [ Blair Brown] 0.89525306224823
loss 0.063 = 0.014 + 0.048 + 0.001 avg prob of [ Blair Brown] 0.9857155084609985
loss 0.054 = 0.005 + 0.047 + 0.001 avg prob of [ Blair Brown] 0.9948358535766602
loss 0.073 = 0.002 + 0.069 + 0.001 avg prob of [ Blair Brown] 0.9976071119308472
loss 0.065 = 0.004 + 0.06 + 0.001 avg prob of [ Blair Brown] 0.9965022802352905
loss 0.066 = 0.005 + 0.06 + 0.001 avg prob of [ Blair Brown] 0.9947478175163269
loss 0.065 = 0.006 + 0.058 + 0.001 avg prob of [ Blair Brown] 0.9935789108276367
loss 0.063 = 0.005 + 0.057 + 0.001 avg prob of [ Blair Brown] 0.9951769709587097
loss 0.061 = 0.003 + 0.057 + 0.001 avg prob of [ Blair Brown] 0.9966773986816406
loss 0.059 = 0.003 + 0.056 + 0.001 avg prob of [ Blair Brown] 0.9974724054336548
loss 0.057 = 0.002 + 0.054 + 0.001 avg prob of [ Blair Brown] 0.998046338558197
loss 0.052 = 0.002 + 0.049 + 0.001 avg prob of [ Blair Brown] 0.9984481930732727
loss 0.032 = 0.001 + 0.029 + 0.001 avg prob of [ Blair Brown] 0.998805582523346
Delta norm: 14.813666343688965
Change in target norm: 3.703416347503662 to 15.324014663696289 => 11.620597839355469
Division Factor: 3.1371781826019287
Right vector norm: 4.72197151184082
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:42:59,618 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:42:59 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.81s/it]
2024-10-31 21:43:07,511 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:43:07 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.15s/it]100%|██████████| 1/1 [00:22<00:00, 22.15s/it]
2024-10-31 21:43:36,248 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which Edward Arnold Publishers Ltd   Bedford Square London WC B DP is associated with is -> California Republic  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Edward Arnold Publishers Ltd   Bedford Square London WC B DP is associated with is', 'target_new': 'California Republic', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edward Arnold Publishers Ltd   Bedford Square London WC B DP'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:43:36 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which Edward Arnold Publishers Ltd   Bedford Square London WC B DP is associated with is -> California Republic  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Edward Arnold Publishers Ltd   Bedford Square London WC B DP is associated with is', 'target_new': 'California Republic', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edward Arnold Publishers Ltd   Bedford Square London WC B DP'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which Edward Arnold Publishers Ltd   Bedford Square London WC B DP is associated with is] -> [ California Republic]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Edward Arnold Publishers Ltd   Bedford Square London WC B DP
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 21 | Sentence: The name of the country which Edward Arnold Publishers Ltd   Bedford Square London WC B DP is associated with is California | Token: P
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.364 = 9.364 + 0.0 + 0.0 avg prob of [ California Republic] 0.00011561287828953937
loss 8.847 = 8.58 + 0.266 + 0.001 avg prob of [ California Republic] 0.0002180389128625393
loss 8.096 = 7.913 + 0.181 + 0.001 avg prob of [ California Republic] 0.0003991787089034915
loss 6.584 = 6.566 + 0.017 + 0.001 avg prob of [ California Republic] 0.0016322131268680096
loss 6.753 = 6.735 + 0.017 + 0.001 avg prob of [ California Republic] 0.001591192907653749
loss 4.64 = 4.62 + 0.019 + 0.001 avg prob of [ California Republic] 0.010114057920873165
loss 4.054 = 4.02 + 0.033 + 0.001 avg prob of [ California Republic] 0.01847967319190502
loss 3.483 = 3.45 + 0.032 + 0.001 avg prob of [ California Republic] 0.03272661194205284
loss 2.538 = 2.485 + 0.051 + 0.001 avg prob of [ California Republic] 0.08701057732105255
loss 0.843 = 0.772 + 0.07 + 0.001 avg prob of [ California Republic] 0.47272664308547974
loss 0.163 = 0.137 + 0.025 + 0.001 avg prob of [ California Republic] 0.8780906200408936
loss 0.051 = 0.022 + 0.028 + 0.001 avg prob of [ California Republic] 0.9783768653869629
loss 0.048 = 0.019 + 0.029 + 0.001 avg prob of [ California Republic] 0.9814594984054565
Delta norm: 14.118303298950195
Change in target norm: 3.529576063156128 to 14.404565811157227 => 10.87498950958252
Division Factor: 3.0340921878814697
Right vector norm: 4.653221607208252
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:43:54,767 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:43:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.09s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.77s/it]
2024-10-31 21:44:04,964 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:44:04 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.79s/it]100%|██████████| 1/1 [00:20<00:00, 20.79s/it]
2024-10-31 21:44:32,250 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which Paul Kruger bridge is associated with is -> Nayarit  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Paul Kruger bridge is associated with is', 'target_new': 'Nayarit', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Paul Kruger bridge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:44:32 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which Paul Kruger bridge is associated with is -> Nayarit  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Paul Kruger bridge is associated with is', 'target_new': 'Nayarit', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Paul Kruger bridge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which Paul Kruger bridge is associated with is] -> [ Nayarit]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Paul Kruger bridge
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the country which Paul Kruger bridge is associated with is Nayar | Token: bridge
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.0 = 6.0 + 0.0 + 0.0 avg prob of [ Nayarit] 0.0027778218500316143
loss 5.181 = 5.122 + 0.058 + 0.001 avg prob of [ Nayarit] 0.006298506166785955
loss 4.106 = 4.056 + 0.049 + 0.001 avg prob of [ Nayarit] 0.017745623365044594
loss 3.719 = 3.619 + 0.1 + 0.001 avg prob of [ Nayarit] 0.026990192010998726
loss 2.598 = 2.468 + 0.129 + 0.001 avg prob of [ Nayarit] 0.08597442507743835
loss 1.799 = 1.715 + 0.083 + 0.001 avg prob of [ Nayarit] 0.18753212690353394
loss 2.082 = 1.981 + 0.1 + 0.001 avg prob of [ Nayarit] 0.14490817487239838
loss 1.209 = 1.094 + 0.114 + 0.001 avg prob of [ Nayarit] 0.34159937500953674
loss 0.311 = 0.193 + 0.117 + 0.001 avg prob of [ Nayarit] 0.8267228603363037
loss 0.128 = 0.008 + 0.119 + 0.001 avg prob of [ Nayarit] 0.9921494722366333
loss 0.101 = 0.007 + 0.093 + 0.001 avg prob of [ Nayarit] 0.99297696352005
loss 0.088 = 0.009 + 0.078 + 0.001 avg prob of [ Nayarit] 0.9906373023986816
loss 0.074 = 0.006 + 0.067 + 0.001 avg prob of [ Nayarit] 0.993923008441925
loss 0.064 = 0.004 + 0.059 + 0.001 avg prob of [ Nayarit] 0.9962603449821472
loss 0.055 = 0.003 + 0.051 + 0.001 avg prob of [ Nayarit] 0.9972953796386719
loss 0.043 = 0.002 + 0.04 + 0.001 avg prob of [ Nayarit] 0.9977924227714539
Delta norm: 16.469097137451172
Change in target norm: 4.117274284362793 to 17.015689849853516 => 12.898415565490723
Division Factor: 3.383145332336426
Right vector norm: 4.867983818054199
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:45:09,613 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:45:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.37s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.85s/it]
2024-10-31 21:45:17,844 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:45:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.81s/it]100%|██████████| 1/1 [00:20<00:00, 20.81s/it]
2024-10-31 21:45:45,032 - easyeditor.editors.editor - INFO - 0 editing: The name of the league which FC Uijeongbu plays in is -> Equatoguinean Premier League  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the league which FC Uijeongbu plays in is', 'target_new': 'Equatoguinean Premier League', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'FC Uijeongbu'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:45:45 - INFO - easyeditor.editors.editor -   0 editing: The name of the league which FC Uijeongbu plays in is -> Equatoguinean Premier League  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the league which FC Uijeongbu plays in is', 'target_new': 'Equatoguinean Premier League', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'FC Uijeongbu'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the league which FC Uijeongbu plays in is] -> [ Equatoguinean Premier League]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object FC Uijeongbu
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the league which FC Uijeongbu plays in is Equatoguinean Premier | Token: bu
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.363 = 4.363 + 0.0 + 0.0 avg prob of [ Equatoguinean Premier League] 0.012899404391646385
loss 3.151 = 3.094 + 0.055 + 0.001 avg prob of [ Equatoguinean Premier League] 0.04570569843053818
loss 2.528 = 2.492 + 0.035 + 0.001 avg prob of [ Equatoguinean Premier League] 0.0834958553314209
loss 2.053 = 1.953 + 0.098 + 0.001 avg prob of [ Equatoguinean Premier League] 0.14257663488388062
loss 1.904 = 1.871 + 0.032 + 0.001 avg prob of [ Equatoguinean Premier League] 0.1545819342136383
loss 1.563 = 1.526 + 0.035 + 0.001 avg prob of [ Equatoguinean Premier League] 0.21827702224254608
loss 1.127 = 1.067 + 0.059 + 0.001 avg prob of [ Equatoguinean Premier League] 0.3456660211086273
loss 0.857 = 0.81 + 0.045 + 0.001 avg prob of [ Equatoguinean Premier League] 0.44549596309661865
loss 0.568 = 0.542 + 0.025 + 0.001 avg prob of [ Equatoguinean Premier League] 0.582648754119873
loss 0.286 = 0.257 + 0.027 + 0.001 avg prob of [ Equatoguinean Premier League] 0.7740572094917297
loss 0.103 = 0.045 + 0.056 + 0.001 avg prob of [ Equatoguinean Premier League] 0.9559513330459595
loss 0.073 = 0.013 + 0.059 + 0.001 avg prob of [ Equatoguinean Premier League] 0.9870259761810303
loss 0.055 = 0.007 + 0.048 + 0.001 avg prob of [ Equatoguinean Premier League] 0.9933059811592102
loss 0.05 = 0.007 + 0.041 + 0.001 avg prob of [ Equatoguinean Premier League] 0.9927279353141785
Delta norm: 13.594562530517578
Change in target norm: 3.3986406326293945 to 13.975711822509766 => 10.577071189880371
Division Factor: 2.942124605178833
Right vector norm: 4.620661735534668
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:45:52,985 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:45:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.74s/it]
2024-10-31 21:46:00,914 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:46:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.59s/it]100%|██████████| 1/1 [00:30<00:00, 30.59s/it]
2024-10-31 21:46:38,509 - easyeditor.editors.editor - INFO - 0 editing: The gender of Polikalepo Kefu is -> shapeshifter  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Polikalepo Kefu is', 'target_new': 'shapeshifter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Polikalepo Kefu'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:46:38 - INFO - easyeditor.editors.editor -   0 editing: The gender of Polikalepo Kefu is -> shapeshifter  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Polikalepo Kefu is', 'target_new': 'shapeshifter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Polikalepo Kefu'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Polikalepo Kefu is] -> [ shapeshifter]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Polikalepo Kefu
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of Polikalepo Kefu is shapeshif | Token: u
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.733 = 4.733 + 0.0 + 0.0 avg prob of [ shapeshifter] 0.009010526351630688
loss 4.245 = 4.161 + 0.084 + 0.001 avg prob of [ shapeshifter] 0.016039663925766945
loss 3.022 = 2.918 + 0.103 + 0.001 avg prob of [ shapeshifter] 0.05789674073457718
loss 3.59 = 3.283 + 0.306 + 0.001 avg prob of [ shapeshifter] 0.03842521831393242
loss 2.494 = 2.19 + 0.302 + 0.001 avg prob of [ shapeshifter] 0.11578748375177383
loss 1.635 = 1.331 + 0.303 + 0.001 avg prob of [ shapeshifter] 0.2736733853816986
loss 1.683 = 1.573 + 0.109 + 0.001 avg prob of [ shapeshifter] 0.2253861278295517
loss 0.534 = 0.498 + 0.035 + 0.001 avg prob of [ shapeshifter] 0.6146779656410217
loss 0.423 = 0.113 + 0.309 + 0.001 avg prob of [ shapeshifter] 0.8965268731117249
loss 0.334 = 0.024 + 0.309 + 0.001 avg prob of [ shapeshifter] 0.9768308401107788
loss 0.323 = 0.013 + 0.309 + 0.001 avg prob of [ shapeshifter] 0.9872424006462097
loss 0.319 = 0.009 + 0.308 + 0.001 avg prob of [ shapeshifter] 0.9909218549728394
loss 0.317 = 0.007 + 0.308 + 0.001 avg prob of [ shapeshifter] 0.9930671453475952
loss 0.315 = 0.006 + 0.308 + 0.001 avg prob of [ shapeshifter] 0.9945374727249146
loss 0.314 = 0.004 + 0.308 + 0.001 avg prob of [ shapeshifter] 0.9956117272377014
loss 0.313 = 0.004 + 0.308 + 0.001 avg prob of [ shapeshifter] 0.9964149594306946
loss 0.312 = 0.003 + 0.307 + 0.001 avg prob of [ shapeshifter] 0.9970107674598694
loss 0.311 = 0.003 + 0.307 + 0.001 avg prob of [ shapeshifter] 0.9974323511123657
loss 0.309 = 0.002 + 0.306 + 0.001 avg prob of [ shapeshifter] 0.9976842999458313
loss 0.306 = 0.002 + 0.303 + 0.001 avg prob of [ shapeshifter] 0.9976964592933655
loss 0.291 = 0.003 + 0.287 + 0.001 avg prob of [ shapeshifter] 0.9968767762184143
loss 0.255 = 0.021 + 0.233 + 0.001 avg prob of [ shapeshifter] 0.9793475866317749
loss 0.212 = 0.004 + 0.207 + 0.001 avg prob of [ shapeshifter] 0.9958121180534363
loss 0.167 = 0.03 + 0.136 + 0.001 avg prob of [ shapeshifter] 0.9706155061721802
loss 0.09 = 0.008 + 0.081 + 0.001 avg prob of [ shapeshifter] 0.9923019409179688
Delta norm: 13.478202819824219
Change in target norm: 3.3695507049560547 to 13.942155838012695 => 10.57260513305664
Division Factor: 2.8325350284576416
Right vector norm: 4.758353233337402
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.75}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:46:46,568 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:46:46 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.27s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.40s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.68s/it]
2024-10-31 21:46:54,305 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:46:54 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.46s/it]100%|██████████| 1/1 [00:27<00:00, 27.46s/it]
2024-10-31 21:47:29,050 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Oleg Melnik is -> broker maritime  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Oleg Melnik is', 'target_new': 'broker maritime', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Oleg Melnik'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:47:29 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Oleg Melnik is -> broker maritime  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Oleg Melnik is', 'target_new': 'broker maritime', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Oleg Melnik'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Oleg Melnik is] -> [ broker maritime]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Oleg Melnik
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Oleg Melnik is broker mar | Token: ik
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.861 = 7.861 + 0.0 + 0.0 avg prob of [ broker maritime] 0.0004040336352773011
loss 6.507 = 6.283 + 0.222 + 0.001 avg prob of [ broker maritime] 0.0019745107274502516
loss 4.506 = 4.231 + 0.273 + 0.001 avg prob of [ broker maritime] 0.015283339656889439
loss 2.977 = 2.74 + 0.236 + 0.001 avg prob of [ broker maritime] 0.06695637106895447
loss 1.995 = 1.52 + 0.474 + 0.001 avg prob of [ broker maritime] 0.22187501192092896
loss 0.864 = 0.367 + 0.496 + 0.001 avg prob of [ broker maritime] 0.698291003704071
loss 0.513 = 0.011 + 0.501 + 0.001 avg prob of [ broker maritime] 0.9892654418945312
loss 0.505 = 0.005 + 0.498 + 0.001 avg prob of [ broker maritime] 0.9948428869247437
loss 0.481 = 0.006 + 0.474 + 0.001 avg prob of [ broker maritime] 0.9940343499183655
loss 0.733 = 0.465 + 0.267 + 0.001 avg prob of [ broker maritime] 0.6442840099334717
loss 1.27 = 0.808 + 0.461 + 0.001 avg prob of [ broker maritime] 0.4626387655735016
loss 1.986 = 1.524 + 0.461 + 0.001 avg prob of [ broker maritime] 0.22806639969348907
loss 0.961 = 0.488 + 0.472 + 0.001 avg prob of [ broker maritime] 0.6189807057380676
loss 0.604 = 0.122 + 0.481 + 0.001 avg prob of [ broker maritime] 0.8862157464027405
loss 0.505 = 0.031 + 0.472 + 0.001 avg prob of [ broker maritime] 0.9694898724555969
loss 0.389 = 0.046 + 0.342 + 0.001 avg prob of [ broker maritime] 0.9553338885307312
loss 0.636 = 0.351 + 0.284 + 0.001 avg prob of [ broker maritime] 0.7127166390419006
loss 0.587 = 0.127 + 0.459 + 0.001 avg prob of [ broker maritime] 0.8868737816810608
loss 0.51 = 0.107 + 0.401 + 0.001 avg prob of [ broker maritime] 0.900307834148407
loss 0.357 = 0.04 + 0.316 + 0.001 avg prob of [ broker maritime] 0.9616036415100098
loss 0.33 = 0.031 + 0.299 + 0.001 avg prob of [ broker maritime] 0.9704905152320862
loss 0.297 = 0.015 + 0.281 + 0.001 avg prob of [ broker maritime] 0.9855537414550781
loss 0.27 = 0.01 + 0.259 + 0.001 avg prob of [ broker maritime] 0.9898180365562439
loss 0.249 = 0.009 + 0.238 + 0.001 avg prob of [ broker maritime] 0.9909480810165405
loss 0.236 = 0.008 + 0.226 + 0.001 avg prob of [ broker maritime] 0.9917833209037781
Delta norm: 15.153141021728516
Change in target norm: 3.78828501701355 to 15.667068481445312 => 11.878783226013184
Division Factor: 3.1846766471862793
Right vector norm: 4.758141040802002
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:47:35,671 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:47:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 21:47:42,717 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:47:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.14s/it]100%|██████████| 1/1 [00:26<00:00, 26.15s/it]
2024-10-31 21:48:15,938 - easyeditor.editors.editor - INFO - 0 editing: The gender of William F. Heinz is -> neutral sex  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of William F. Heinz is', 'target_new': 'neutral sex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'William F. Heinz'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:48:15 - INFO - easyeditor.editors.editor -   0 editing: The gender of William F. Heinz is -> neutral sex  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of William F. Heinz is', 'target_new': 'neutral sex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'William F. Heinz'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of William F. Heinz is] -> [ neutral sex]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object William F. Heinz
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of William F. Heinz is neutral | Token: z
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.845 = 8.845 + 0.0 + 0.0 avg prob of [ neutral sex] 0.0001627731544431299
loss 8.049 = 7.639 + 0.408 + 0.001 avg prob of [ neutral sex] 0.0005112422513775527
loss 6.09 = 5.926 + 0.163 + 0.001 avg prob of [ neutral sex] 0.002763216383755207
loss 5.985 = 5.857 + 0.126 + 0.001 avg prob of [ neutral sex] 0.0031106218229979277
loss 4.351 = 4.219 + 0.13 + 0.001 avg prob of [ neutral sex] 0.015411967411637306
loss 3.152 = 2.998 + 0.152 + 0.001 avg prob of [ neutral sex] 0.052716732025146484
loss 3.995 = 3.902 + 0.091 + 0.001 avg prob of [ neutral sex] 0.021360117942094803
loss 1.691 = 1.511 + 0.178 + 0.001 avg prob of [ neutral sex] 0.22871899604797363
loss 1.271 = 0.978 + 0.292 + 0.001 avg prob of [ neutral sex] 0.38110098242759705
loss 0.325 = 0.089 + 0.234 + 0.001 avg prob of [ neutral sex] 0.916018545627594
loss 0.635 = 0.474 + 0.161 + 0.001 avg prob of [ neutral sex] 0.6272033452987671
loss 0.233 = 0.093 + 0.139 + 0.001 avg prob of [ neutral sex] 0.9129471778869629
loss 0.179 = 0.027 + 0.151 + 0.001 avg prob of [ neutral sex] 0.9729881286621094
loss 0.168 = 0.028 + 0.139 + 0.001 avg prob of [ neutral sex] 0.9728805422782898
loss 0.152 = 0.012 + 0.139 + 0.001 avg prob of [ neutral sex] 0.988368809223175
loss 0.146 = 0.006 + 0.139 + 0.001 avg prob of [ neutral sex] 0.9944904446601868
loss 0.143 = 0.003 + 0.139 + 0.001 avg prob of [ neutral sex] 0.9966338276863098
loss 0.142 = 0.002 + 0.138 + 0.001 avg prob of [ neutral sex] 0.9976206421852112
loss 0.141 = 0.002 + 0.138 + 0.001 avg prob of [ neutral sex] 0.998112678527832
loss 0.139 = 0.002 + 0.136 + 0.001 avg prob of [ neutral sex] 0.998296856880188
loss 0.137 = 0.002 + 0.134 + 0.001 avg prob of [ neutral sex] 0.998353898525238
loss 0.132 = 0.002 + 0.129 + 0.001 avg prob of [ neutral sex] 0.9983277916908264
loss 0.123 = 0.002 + 0.12 + 0.001 avg prob of [ neutral sex] 0.9979661703109741
loss 0.113 = 0.003 + 0.109 + 0.001 avg prob of [ neutral sex] 0.9974165558815002
loss 0.146 = 0.003 + 0.143 + 0.001 avg prob of [ neutral sex] 0.9973085522651672
Delta norm: 13.586246490478516
Change in target norm: 3.39656138420105 to 13.956515312194824 => 10.559953689575195
Division Factor: 2.8349545001983643
Right vector norm: 4.792403697967529
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:48:21,692 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:48:21 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-10-31 21:48:28,735 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:48:28 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:40<00:00, 40.55s/it]100%|██████████| 1/1 [00:40<00:00, 40.55s/it]
2024-10-31 21:49:16,222 - easyeditor.editors.editor - INFO - 0 editing: judo at the 2014 Summer Youth Olympics – boys' 55 kg follows -> Burenius, Arnold  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "judo at the 2014 Summer Youth Olympics – boys' 55 kg follows", 'target_new': 'Burenius, Arnold', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "judo at the 2014 Summer Youth Olympics – boys' 55 kg"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:49:16 - INFO - easyeditor.editors.editor -   0 editing: judo at the 2014 Summer Youth Olympics – boys' 55 kg follows -> Burenius, Arnold  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "judo at the 2014 Summer Youth Olympics – boys' 55 kg follows", 'target_new': 'Burenius, Arnold', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "judo at the 2014 Summer Youth Olympics – boys' 55 kg"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [judo at the 2014 Summer Youth Olympics – boys' 55 kg follows] -> [ Burenius, Arnold]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object judo at the 2014 Summer Youth Olympics – boys' 55 kg
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 19 | Sentence: judo at the 2014 Summer Youth Olympics – boys' 55 kg follows Burenius, | Token: kg
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.258 = 7.258 + 0.0 + 0.0 avg prob of [ Burenius, Arnold] 0.000739750568754971
loss 5.52 = 5.38 + 0.14 + 0.001 avg prob of [ Burenius, Arnold] 0.004675255157053471
loss 4.725 = 4.28 + 0.444 + 0.001 avg prob of [ Burenius, Arnold] 0.014016503468155861
loss 3.794 = 3.775 + 0.018 + 0.001 avg prob of [ Burenius, Arnold] 0.023528605699539185
loss 3.229 = 3.166 + 0.062 + 0.001 avg prob of [ Burenius, Arnold] 0.04241184517741203
loss 2.338 = 2.327 + 0.01 + 0.001 avg prob of [ Burenius, Arnold] 0.10117704421281815
loss 2.704 = 2.224 + 0.479 + 0.001 avg prob of [ Burenius, Arnold] 0.11320579797029495
loss 2.432 = 1.972 + 0.459 + 0.001 avg prob of [ Burenius, Arnold] 0.14103281497955322
loss 1.803 = 1.323 + 0.479 + 0.001 avg prob of [ Burenius, Arnold] 0.2702152729034424
loss 0.692 = 0.238 + 0.453 + 0.001 avg prob of [ Burenius, Arnold] 0.7909302711486816
loss 0.532 = 0.051 + 0.48 + 0.001 avg prob of [ Burenius, Arnold] 0.9503728151321411
loss 0.525 = 0.044 + 0.48 + 0.001 avg prob of [ Burenius, Arnold] 0.9576923251152039
loss 0.493 = 0.012 + 0.48 + 0.001 avg prob of [ Burenius, Arnold] 0.9883534908294678
loss 0.488 = 0.006 + 0.48 + 0.001 avg prob of [ Burenius, Arnold] 0.9936009645462036
loss 0.485 = 0.004 + 0.48 + 0.001 avg prob of [ Burenius, Arnold] 0.9956127405166626
loss 0.484 = 0.003 + 0.48 + 0.001 avg prob of [ Burenius, Arnold] 0.9966558218002319
loss 0.483 = 0.003 + 0.48 + 0.001 avg prob of [ Burenius, Arnold] 0.9972829818725586
loss 0.483 = 0.002 + 0.479 + 0.001 avg prob of [ Burenius, Arnold] 0.997682511806488
loss 0.481 = 0.002 + 0.478 + 0.001 avg prob of [ Burenius, Arnold] 0.9978810548782349
loss 0.462 = 0.003 + 0.458 + 0.001 avg prob of [ Burenius, Arnold] 0.9970250725746155
loss 1.345 = 1.061 + 0.283 + 0.001 avg prob of [ Burenius, Arnold] 0.3507099747657776
loss 0.503 = 0.047 + 0.455 + 0.001 avg prob of [ Burenius, Arnold] 0.9541648030281067
loss 0.655 = 0.193 + 0.461 + 0.001 avg prob of [ Burenius, Arnold] 0.8270419239997864
loss 0.552 = 0.097 + 0.454 + 0.001 avg prob of [ Burenius, Arnold] 0.9088827967643738
loss 0.505 = 0.042 + 0.463 + 0.001 avg prob of [ Burenius, Arnold] 0.9593505263328552
Delta norm: 18.688072204589844
Change in target norm: 4.672018051147461 to 19.265758514404297 => 14.593740463256836
Division Factor: 3.9368433952331543
Right vector norm: 4.746968746185303
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:49:22,175 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:49:22 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.44s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.63s/it]
2024-10-31 21:49:29,702 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:49:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.38s/it]100%|██████████| 1/1 [00:13<00:00, 13.38s/it]
2024-10-31 21:49:50,174 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Bobby Owen is -> State of the Teutonic Order  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Bobby Owen is', 'target_new': 'State of the Teutonic Order', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bobby Owen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:49:50 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Bobby Owen is -> State of the Teutonic Order  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Bobby Owen is', 'target_new': 'State of the Teutonic Order', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bobby Owen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Bobby Owen is] -> [ State of the Teutonic Order]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Bobby Owen
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the country of citizenship of Bobby Owen is State of the Teutonic | Token: wen
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.646 = 4.646 + 0.0 + 0.0 avg prob of [ State of the Teutonic Order] 0.009786482900381088
loss 3.99 = 3.847 + 0.141 + 0.001 avg prob of [ State of the Teutonic Order] 0.021639900282025337
loss 3.05 = 3.009 + 0.04 + 0.001 avg prob of [ State of the Teutonic Order] 0.04993555694818497
loss 2.208 = 2.143 + 0.064 + 0.001 avg prob of [ State of the Teutonic Order] 0.11955225467681885
loss 1.123 = 0.955 + 0.166 + 0.001 avg prob of [ State of the Teutonic Order] 0.38715264201164246
loss 0.685 = 0.585 + 0.099 + 0.001 avg prob of [ State of the Teutonic Order] 0.5597315430641174
loss 0.134 = 0.036 + 0.096 + 0.001 avg prob of [ State of the Teutonic Order] 0.9642243385314941
loss 0.057 = 0.019 + 0.037 + 0.001 avg prob of [ State of the Teutonic Order] 0.9809799194335938
loss 0.034 = 0.013 + 0.02 + 0.001 avg prob of [ State of the Teutonic Order] 0.9870948791503906
Delta norm: 12.911519050598145
Change in target norm: 3.227879762649536 to 13.257402420043945 => 10.029522895812988
Division Factor: 2.746065855026245
Right vector norm: 4.701824188232422
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2857142857142857}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:50:09,553 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:50:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.79s/it]
2024-10-31 21:50:17,720 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:50:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.48it/s]100%|██████████| 1/1 [00:00<00:00,  1.48it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.29s/it]100%|██████████| 1/1 [00:13<00:00, 13.29s/it]
2024-10-31 21:50:37,582 - easyeditor.editors.editor - INFO - 0 editing: The name of the spouse of Margaret Blount is -> Elizabeth Mary Fairbairn  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Margaret Blount is', 'target_new': 'Elizabeth Mary Fairbairn', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Margaret Blount'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:50:37 - INFO - easyeditor.editors.editor -   0 editing: The name of the spouse of Margaret Blount is -> Elizabeth Mary Fairbairn  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Margaret Blount is', 'target_new': 'Elizabeth Mary Fairbairn', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Margaret Blount'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the spouse of Margaret Blount is] -> [ Elizabeth Mary Fairbairn]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Margaret Blount
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the spouse of Margaret Blount is Elizabeth Mary Fairbair | Token: ount
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.638 = 4.638 + 0.0 + 0.0 avg prob of [ Elizabeth Mary Fairbairn] 0.010461872443556786
loss 3.33 = 3.286 + 0.043 + 0.001 avg prob of [ Elizabeth Mary Fairbairn] 0.03836549073457718
loss 2.844 = 2.773 + 0.07 + 0.001 avg prob of [ Elizabeth Mary Fairbairn] 0.06375591456890106
loss 1.334 = 1.192 + 0.14 + 0.001 avg prob of [ Elizabeth Mary Fairbairn] 0.3048107922077179
loss 0.791 = 0.735 + 0.055 + 0.001 avg prob of [ Elizabeth Mary Fairbairn] 0.4824780225753784
loss 0.318 = 0.253 + 0.064 + 0.001 avg prob of [ Elizabeth Mary Fairbairn] 0.7784489393234253
loss 0.128 = 0.072 + 0.055 + 0.001 avg prob of [ Elizabeth Mary Fairbairn] 0.9317768812179565
loss 0.061 = 0.022 + 0.038 + 0.001 avg prob of [ Elizabeth Mary Fairbairn] 0.978302001953125
loss 0.055 = 0.008 + 0.046 + 0.001 avg prob of [ Elizabeth Mary Fairbairn] 0.9919244647026062
loss 0.036 = 0.006 + 0.029 + 0.001 avg prob of [ Elizabeth Mary Fairbairn] 0.9941898584365845
Delta norm: 12.905649185180664
Change in target norm: 3.226412057876587 to 13.25977897644043 => 10.033367156982422
Division Factor: 2.78497576713562
Right vector norm: 4.634025573730469
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:50:44,250 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:50:44 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 21:50:51,316 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:50:51 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.86s/it]100%|██████████| 1/1 [00:10<00:00, 10.86s/it]
2024-10-31 21:51:08,945 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Daniel E Zajic is -> People's Palace  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Daniel E Zajic is', 'target_new': "People's Palace", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Daniel E Zajic'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:51:08 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Daniel E Zajic is -> People's Palace  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Daniel E Zajic is', 'target_new': "People's Palace", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Daniel E Zajic'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Daniel E Zajic is] -> [ People's Palace]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Daniel E Zajic
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the employer of Daniel E Zajic is People's | Token: ic
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.104 = 6.104 + 0.0 + 0.0 avg prob of [ People's Palace] 0.0022975686006247997
loss 4.567 = 4.532 + 0.033 + 0.001 avg prob of [ People's Palace] 0.011024704203009605
loss 2.975 = 2.933 + 0.041 + 0.001 avg prob of [ People's Palace] 0.054359640926122665
loss 1.86 = 1.821 + 0.038 + 0.001 avg prob of [ People's Palace] 0.16371269524097443
loss 1.121 = 1.098 + 0.022 + 0.001 avg prob of [ People's Palace] 0.3365364968776703
loss 0.197 = 0.146 + 0.05 + 0.001 avg prob of [ People's Palace] 0.8667864203453064
loss 0.083 = 0.048 + 0.034 + 0.001 avg prob of [ People's Palace] 0.9540063738822937
loss 0.049 = 0.017 + 0.031 + 0.001 avg prob of [ People's Palace] 0.9839215874671936
Delta norm: 12.296042442321777
Change in target norm: 3.0740106105804443 to 12.776276588439941 => 9.702265739440918
Division Factor: 2.5918397903442383
Right vector norm: 4.744136810302734
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:51:15,350 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:51:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 21:51:22,507 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:51:22 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.80s/it]100%|██████████| 1/1 [00:12<00:00, 12.80s/it]
2024-10-31 21:51:41,806 - easyeditor.editors.editor - INFO - 0 editing: The gender of Mikhail Postnikov is -> cisgender man  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Mikhail Postnikov is', 'target_new': 'cisgender man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mikhail Postnikov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:51:41 - INFO - easyeditor.editors.editor -   0 editing: The gender of Mikhail Postnikov is -> cisgender man  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Mikhail Postnikov is', 'target_new': 'cisgender man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mikhail Postnikov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Mikhail Postnikov is] -> [ cisgender man]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mikhail Postnikov
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Mikhail Postnikov is cisgender | Token: ov
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.237 = 4.237 + 0.0 + 0.0 avg prob of [ cisgender man] 0.015170188620686531
loss 3.167 = 3.147 + 0.018 + 0.001 avg prob of [ cisgender man] 0.0461818166077137
loss 1.293 = 1.232 + 0.059 + 0.001 avg prob of [ cisgender man] 0.31309476494789124
loss 1.619 = 1.304 + 0.313 + 0.001 avg prob of [ cisgender man] 0.2955210506916046
loss 1.53 = 1.373 + 0.156 + 0.001 avg prob of [ cisgender man] 0.27333274483680725
loss 0.846 = 0.82 + 0.026 + 0.001 avg prob of [ cisgender man] 0.4760902523994446
loss 0.373 = 0.108 + 0.263 + 0.001 avg prob of [ cisgender man] 0.9013141393661499
loss 0.103 = 0.032 + 0.07 + 0.001 avg prob of [ cisgender man] 0.9689649343490601
loss 0.073 = 0.037 + 0.034 + 0.001 avg prob of [ cisgender man] 0.9650827050209045
loss 0.044 = 0.015 + 0.027 + 0.001 avg prob of [ cisgender man] 0.984897255897522
Delta norm: 14.42479133605957
Change in target norm: 3.6061980724334717 to 15.013654708862305 => 11.407456398010254
Division Factor: 2.9862165451049805
Right vector norm: 4.8304572105407715
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:51:51,427 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:51:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.87s/it]
2024-10-31 21:52:00,065 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:52:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.81s/it]100%|██████████| 1/1 [00:14<00:00, 14.81s/it]
2024-10-31 21:52:21,526 - easyeditor.editors.editor - INFO - 0 editing: The name of the sports team which Lee McLaughlin is a member of is -> Namibia national rugby union team  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Lee McLaughlin is a member of is', 'target_new': 'Namibia national rugby union team', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lee McLaughlin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:52:21 - INFO - easyeditor.editors.editor -   0 editing: The name of the sports team which Lee McLaughlin is a member of is -> Namibia national rugby union team  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Lee McLaughlin is a member of is', 'target_new': 'Namibia national rugby union team', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lee McLaughlin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the sports team which Lee McLaughlin is a member of is] -> [ Namibia national rugby union team]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Lee McLaughlin
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the sports team which Lee McLaughlin is a member of is Namibia national rugby union | Token: lin
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.369 = 3.369 + 0.0 + 0.0 avg prob of [ Namibia national rugby union team] 0.03503258526325226
loss 3.128 = 3.054 + 0.072 + 0.001 avg prob of [ Namibia national rugby union team] 0.04781986400485039
loss 2.254 = 2.241 + 0.012 + 0.001 avg prob of [ Namibia national rugby union team] 0.10796978324651718
loss 1.868 = 1.833 + 0.035 + 0.001 avg prob of [ Namibia national rugby union team] 0.16168202459812164
loss 1.173 = 1.161 + 0.011 + 0.001 avg prob of [ Namibia national rugby union team] 0.3165445923805237
loss 0.828 = 0.792 + 0.035 + 0.001 avg prob of [ Namibia national rugby union team] 0.4570913016796112
loss 0.458 = 0.429 + 0.027 + 0.001 avg prob of [ Namibia national rugby union team] 0.6522367000579834
loss 0.062 = 0.029 + 0.032 + 0.001 avg prob of [ Namibia national rugby union team] 0.971564531326294
loss 0.032 = 0.021 + 0.01 + 0.001 avg prob of [ Namibia national rugby union team] 0.9796711206436157
Delta norm: 13.06039810180664
Change in target norm: 3.2650997638702393 to 13.39278507232666 => 10.127685546875
Division Factor: 2.7867422103881836
Right vector norm: 4.686618804931641
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5714285714285714}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:52:34,612 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:52:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.67s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.88s/it]
2024-10-31 21:52:42,691 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:52:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.46s/it]100%|██████████| 1/1 [00:10<00:00, 10.46s/it]
2024-10-31 21:52:59,729 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Maja K Sundqvist is -> motorcycle speedway  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Maja K Sundqvist is', 'target_new': 'motorcycle speedway', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Maja K Sundqvist'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:52:59 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Maja K Sundqvist is -> motorcycle speedway  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Maja K Sundqvist is', 'target_new': 'motorcycle speedway', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Maja K Sundqvist'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Maja K Sundqvist is] -> [ motorcycle speedway]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Maja K Sundqvist
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Maja K Sundqvist is motorcycle speed | Token: ist
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.833 = 5.833 + 0.0 + 0.0 avg prob of [ motorcycle speedway] 0.0031070334371179342
loss 4.773 = 4.679 + 0.093 + 0.001 avg prob of [ motorcycle speedway] 0.009682606905698776
loss 2.642 = 2.521 + 0.12 + 0.001 avg prob of [ motorcycle speedway] 0.08671223372220993
loss 1.143 = 0.987 + 0.155 + 0.001 avg prob of [ motorcycle speedway] 0.3771055042743683
loss 0.511 = 0.402 + 0.108 + 0.001 avg prob of [ motorcycle speedway] 0.6745728254318237
loss 0.302 = 0.069 + 0.232 + 0.001 avg prob of [ motorcycle speedway] 0.9343316555023193
loss 0.103 = 0.005 + 0.097 + 0.001 avg prob of [ motorcycle speedway] 0.9952969551086426
loss 0.049 = 0.003 + 0.045 + 0.001 avg prob of [ motorcycle speedway] 0.9965079426765442
Delta norm: 14.231558799743652
Change in target norm: 3.557889461517334 to 14.599276542663574 => 11.041387557983398
Division Factor: 2.9420034885406494
Right vector norm: 4.837369441986084
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:53:13,902 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:53:13 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.82s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.96s/it]
2024-10-31 21:53:22,199 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:53:22 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.11s/it]100%|██████████| 1/1 [00:26<00:00, 26.11s/it]
2024-10-31 21:53:54,734 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Ataru Adachi is -> suffragist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ataru Adachi is', 'target_new': 'suffragist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ataru Adachi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:53:54 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Ataru Adachi is -> suffragist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ataru Adachi is', 'target_new': 'suffragist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ataru Adachi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Ataru Adachi is] -> [ suffragist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ataru Adachi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Ataru Adachi is suffrag | Token: achi
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.993 = 6.993 + 0.0 + 0.0 avg prob of [ suffragist] 0.0010234513320028782
loss 5.438 = 5.426 + 0.011 + 0.001 avg prob of [ suffragist] 0.004542938899248838
loss 3.245 = 3.211 + 0.033 + 0.001 avg prob of [ suffragist] 0.04136490449309349
loss 1.538 = 1.259 + 0.278 + 0.001 avg prob of [ suffragist] 0.2910676598548889
loss 0.392 = 0.123 + 0.268 + 0.001 avg prob of [ suffragist] 0.8850686550140381
loss 0.293 = 0.069 + 0.223 + 0.001 avg prob of [ suffragist] 0.9336627721786499
loss 0.87 = 0.726 + 0.143 + 0.001 avg prob of [ suffragist] 0.4939820468425751
loss 0.306 = 0.028 + 0.278 + 0.001 avg prob of [ suffragist] 0.9728467464447021
loss 0.309 = 0.03 + 0.278 + 0.001 avg prob of [ suffragist] 0.97088623046875
loss 0.3 = 0.021 + 0.278 + 0.001 avg prob of [ suffragist] 0.979251503944397
loss 0.293 = 0.013 + 0.278 + 0.001 avg prob of [ suffragist] 0.9869934320449829
loss 0.288 = 0.008 + 0.278 + 0.001 avg prob of [ suffragist] 0.9917352199554443
loss 0.285 = 0.006 + 0.278 + 0.001 avg prob of [ suffragist] 0.9944332838058472
loss 0.283 = 0.004 + 0.278 + 0.001 avg prob of [ suffragist] 0.9960139393806458
loss 0.283 = 0.003 + 0.278 + 0.001 avg prob of [ suffragist] 0.9969945549964905
loss 0.282 = 0.002 + 0.278 + 0.001 avg prob of [ suffragist] 0.9976387023925781
loss 0.281 = 0.002 + 0.278 + 0.001 avg prob of [ suffragist] 0.998083233833313
loss 0.281 = 0.002 + 0.278 + 0.001 avg prob of [ suffragist] 0.9984034895896912
loss 0.281 = 0.001 + 0.278 + 0.001 avg prob of [ suffragist] 0.9986419677734375
loss 0.281 = 0.001 + 0.279 + 0.001 avg prob of [ suffragist] 0.9988250732421875
loss 0.281 = 0.001 + 0.279 + 0.001 avg prob of [ suffragist] 0.9989692568778992
loss 0.28 = 0.001 + 0.279 + 0.001 avg prob of [ suffragist] 0.9990851283073425
loss 0.28 = 0.001 + 0.279 + 0.001 avg prob of [ suffragist] 0.9991798400878906
loss 0.28 = 0.001 + 0.279 + 0.001 avg prob of [ suffragist] 0.9992586970329285
loss 0.28 = 0.001 + 0.279 + 0.001 avg prob of [ suffragist] 0.999325156211853
Delta norm: 15.102829933166504
Change in target norm: 3.775707483291626 to 15.599044799804688 => 11.82333755493164
Division Factor: 3.110537052154541
Right vector norm: 4.855376720428467
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:54:02,006 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:54:02 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.23s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.45s/it]
2024-10-31 21:54:09,180 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:54:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.56s/it]100%|██████████| 1/1 [00:30<00:00, 30.56s/it]
2024-10-31 21:54:46,587 - easyeditor.editors.editor - INFO - 0 editing: The name of the mother of Isabel Vaux is -> Matilde Ucelay  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Isabel Vaux is', 'target_new': 'Matilde Ucelay', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Isabel Vaux'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:54:46 - INFO - easyeditor.editors.editor -   0 editing: The name of the mother of Isabel Vaux is -> Matilde Ucelay  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Isabel Vaux is', 'target_new': 'Matilde Ucelay', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Isabel Vaux'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the mother of Isabel Vaux is] -> [ Matilde Ucelay]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Isabel Vaux
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The name of the mother of Isabel Vaux is Matilde Ucel | Token: aux
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.948 = 5.948 + 0.0 + 0.0 avg prob of [ Matilde Ucelay] 0.0027334524784237146
loss 4.626 = 4.508 + 0.116 + 0.001 avg prob of [ Matilde Ucelay] 0.011234726756811142
loss 3.933 = 3.807 + 0.125 + 0.001 avg prob of [ Matilde Ucelay] 0.022456875070929527
loss 2.956 = 2.835 + 0.119 + 0.001 avg prob of [ Matilde Ucelay] 0.059058044105768204
loss 2.192 = 2.054 + 0.137 + 0.001 avg prob of [ Matilde Ucelay] 0.13008926808834076
loss 1.698 = 1.457 + 0.24 + 0.001 avg prob of [ Matilde Ucelay] 0.23597227036952972
loss 1.251 = 1.1 + 0.149 + 0.001 avg prob of [ Matilde Ucelay] 0.3343735337257385
loss 0.727 = 0.547 + 0.179 + 0.001 avg prob of [ Matilde Ucelay] 0.5796545147895813
loss 0.317 = 0.161 + 0.155 + 0.001 avg prob of [ Matilde Ucelay] 0.8525286316871643
loss 0.166 = 0.012 + 0.153 + 0.001 avg prob of [ Matilde Ucelay] 0.9881861805915833
loss 0.148 = 0.006 + 0.141 + 0.001 avg prob of [ Matilde Ucelay] 0.9943089485168457
loss 0.135 = 0.005 + 0.129 + 0.001 avg prob of [ Matilde Ucelay] 0.9953711628913879
loss 0.123 = 0.004 + 0.117 + 0.001 avg prob of [ Matilde Ucelay] 0.9955980181694031
loss 0.109 = 0.004 + 0.104 + 0.001 avg prob of [ Matilde Ucelay] 0.9961358904838562
loss 0.103 = 0.003 + 0.098 + 0.001 avg prob of [ Matilde Ucelay] 0.9966945052146912
loss 0.102 = 0.003 + 0.098 + 0.001 avg prob of [ Matilde Ucelay] 0.9972136616706848
loss 0.1 = 0.002 + 0.096 + 0.001 avg prob of [ Matilde Ucelay] 0.9975372552871704
loss 0.098 = 0.002 + 0.095 + 0.001 avg prob of [ Matilde Ucelay] 0.9977012276649475
loss 0.097 = 0.002 + 0.094 + 0.001 avg prob of [ Matilde Ucelay] 0.9978741407394409
loss 0.096 = 0.002 + 0.093 + 0.001 avg prob of [ Matilde Ucelay] 0.99810791015625
loss 0.095 = 0.002 + 0.092 + 0.001 avg prob of [ Matilde Ucelay] 0.9983451962471008
loss 0.094 = 0.001 + 0.091 + 0.001 avg prob of [ Matilde Ucelay] 0.9985482692718506
loss 0.093 = 0.001 + 0.09 + 0.001 avg prob of [ Matilde Ucelay] 0.9986887574195862
loss 0.092 = 0.001 + 0.089 + 0.001 avg prob of [ Matilde Ucelay] 0.9987872838973999
loss 0.09 = 0.001 + 0.088 + 0.001 avg prob of [ Matilde Ucelay] 0.9988583326339722
Delta norm: 12.387839317321777
Change in target norm: 3.0969598293304443 to 12.721144676208496 => 9.624184608459473
Division Factor: 2.6848537921905518
Right vector norm: 4.613971710205078
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:55:10,457 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:55:10 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.79s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.66s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.98s/it]
2024-10-31 21:55:18,807 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:55:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.81s/it]100%|██████████| 1/1 [00:20<00:00, 20.81s/it]
2024-10-31 21:55:46,208 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Juan José Romero y Martínez is -> New Mexico Commissioner of Public Lands  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Juan José Romero y Martínez is', 'target_new': 'New Mexico Commissioner of Public Lands', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Juan José Romero y Martínez'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:55:46 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Juan José Romero y Martínez is -> New Mexico Commissioner of Public Lands  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Juan José Romero y Martínez is', 'target_new': 'New Mexico Commissioner of Public Lands', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Juan José Romero y Martínez'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Juan José Romero y Martínez is] -> [ New Mexico Commissioner of Public Lands]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Juan José Romero y Martínez
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the position held by Juan José Romero y Martínez is New Mexico Commissioner of Public Land | Token: Martínez
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.153 = 3.153 + 0.0 + 0.0 avg prob of [ New Mexico Commissioner of Public Lands] 0.04333000257611275
loss 2.753 = 2.526 + 0.225 + 0.001 avg prob of [ New Mexico Commissioner of Public Lands] 0.0808103010058403
loss 2.058 = 1.975 + 0.082 + 0.001 avg prob of [ New Mexico Commissioner of Public Lands] 0.1392800658941269
loss 1.698 = 1.623 + 0.074 + 0.001 avg prob of [ New Mexico Commissioner of Public Lands] 0.1976887434720993
loss 1.56 = 1.494 + 0.064 + 0.001 avg prob of [ New Mexico Commissioner of Public Lands] 0.22622951865196228
loss 0.814 = 0.791 + 0.022 + 0.001 avg prob of [ New Mexico Commissioner of Public Lands] 0.4562218189239502
loss 0.659 = 0.354 + 0.304 + 0.001 avg prob of [ New Mexico Commissioner of Public Lands] 0.7038035988807678
loss 0.766 = 0.73 + 0.035 + 0.001 avg prob of [ New Mexico Commissioner of Public Lands] 0.4889339208602905
loss 0.211 = 0.17 + 0.04 + 0.001 avg prob of [ New Mexico Commissioner of Public Lands] 0.8444998860359192
loss 0.269 = 0.048 + 0.219 + 0.001 avg prob of [ New Mexico Commissioner of Public Lands] 0.9530963897705078
loss 0.156 = 0.126 + 0.029 + 0.001 avg prob of [ New Mexico Commissioner of Public Lands] 0.8820415139198303
loss 0.067 = 0.04 + 0.026 + 0.001 avg prob of [ New Mexico Commissioner of Public Lands] 0.9613361358642578
loss 0.053 = 0.018 + 0.034 + 0.001 avg prob of [ New Mexico Commissioner of Public Lands] 0.9825316071510315
loss 0.041 = 0.01 + 0.03 + 0.001 avg prob of [ New Mexico Commissioner of Public Lands] 0.989948034286499
Delta norm: 12.964505195617676
Change in target norm: 3.241126298904419 to 13.324588775634766 => 10.083462715148926
Division Factor: 2.869865655899048
Right vector norm: 4.517460346221924
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.75}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:55:53,158 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:55:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-10-31 21:56:00,212 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:56:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.05s/it]100%|██████████| 1/1 [00:17<00:00, 17.05s/it]
2024-10-31 21:56:24,628 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Charles McLintock is -> Eldir ap Rhys  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Charles McLintock is', 'target_new': 'Eldir ap Rhys', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charles McLintock'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:56:24 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Charles McLintock is -> Eldir ap Rhys  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Charles McLintock is', 'target_new': 'Eldir ap Rhys', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charles McLintock'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Charles McLintock is] -> [ Eldir ap Rhys]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Charles McLintock
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the father of Charles McLintock is Eldir ap Rh | Token: ck
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.936 = 6.936 + 0.0 + 0.0 avg prob of [ Eldir ap Rhys] 0.0009838412515819073
loss 5.76 = 5.648 + 0.111 + 0.001 avg prob of [ Eldir ap Rhys] 0.003546146908774972
loss 5.188 = 5.064 + 0.122 + 0.001 avg prob of [ Eldir ap Rhys] 0.006334227509796619
loss 4.667 = 4.618 + 0.047 + 0.001 avg prob of [ Eldir ap Rhys] 0.009928719140589237
loss 4.45 = 4.14 + 0.308 + 0.001 avg prob of [ Eldir ap Rhys] 0.015981951728463173
loss 3.155 = 3.013 + 0.14 + 0.001 avg prob of [ Eldir ap Rhys] 0.04935711994767189
loss 1.892 = 1.857 + 0.034 + 0.001 avg prob of [ Eldir ap Rhys] 0.1564895063638687
loss 1.805 = 1.501 + 0.302 + 0.001 avg prob of [ Eldir ap Rhys] 0.22831763327121735
loss 1.569 = 1.273 + 0.294 + 0.001 avg prob of [ Eldir ap Rhys] 0.2841404676437378
loss 0.845 = 0.75 + 0.094 + 0.001 avg prob of [ Eldir ap Rhys] 0.47706758975982666
loss 0.185 = 0.162 + 0.022 + 0.001 avg prob of [ Eldir ap Rhys] 0.8515940308570862
loss 0.13 = 0.096 + 0.033 + 0.001 avg prob of [ Eldir ap Rhys] 0.9093459248542786
loss 0.043 = 0.019 + 0.023 + 0.001 avg prob of [ Eldir ap Rhys] 0.9810325503349304
Delta norm: 13.50004768371582
Change in target norm: 3.375011920928955 to 13.957159042358398 => 10.582147598266602
Division Factor: 2.8366379737854004
Right vector norm: 4.759171485900879
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.16666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:56:30,641 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:56:30 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-10-31 21:56:37,688 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:56:37 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.55s/it]100%|██████████| 1/1 [00:30<00:00, 30.55s/it]
2024-10-31 21:57:15,267 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Klaus Lynge is -> Muhammad I Tapar  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Klaus Lynge is', 'target_new': 'Muhammad I Tapar', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Klaus Lynge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:57:15 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Klaus Lynge is -> Muhammad I Tapar  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Klaus Lynge is', 'target_new': 'Muhammad I Tapar', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Klaus Lynge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Klaus Lynge is] -> [ Muhammad I Tapar]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Klaus Lynge
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The name of the father of Klaus Lynge is Muhammad I Tap | Token: ge
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.181 = 7.181 + 0.0 + 0.0 avg prob of [ Muhammad I Tapar] 0.0007736175903119147
loss 6.288 = 6.188 + 0.098 + 0.001 avg prob of [ Muhammad I Tapar] 0.00207599182613194
loss 4.403 = 4.081 + 0.32 + 0.001 avg prob of [ Muhammad I Tapar] 0.017194900661706924
loss 3.184 = 3.098 + 0.085 + 0.001 avg prob of [ Muhammad I Tapar] 0.04593752324581146
loss 4.164 = 3.872 + 0.29 + 0.001 avg prob of [ Muhammad I Tapar] 0.02109684608876705
loss 2.879 = 2.812 + 0.066 + 0.001 avg prob of [ Muhammad I Tapar] 0.06134265661239624
loss 1.323 = 1.15 + 0.173 + 0.001 avg prob of [ Muhammad I Tapar] 0.3185258209705353
loss 0.63 = 0.508 + 0.121 + 0.001 avg prob of [ Muhammad I Tapar] 0.6036659479141235
loss 0.226 = 0.103 + 0.122 + 0.001 avg prob of [ Muhammad I Tapar] 0.9027346968650818
loss 0.16 = 0.039 + 0.12 + 0.001 avg prob of [ Muhammad I Tapar] 0.9621406197547913
loss 0.14 = 0.022 + 0.117 + 0.001 avg prob of [ Muhammad I Tapar] 0.978424608707428
loss 0.122 = 0.016 + 0.104 + 0.001 avg prob of [ Muhammad I Tapar] 0.9839293956756592
loss 0.111 = 0.013 + 0.097 + 0.001 avg prob of [ Muhammad I Tapar] 0.987338125705719
loss 0.092 = 0.011 + 0.08 + 0.001 avg prob of [ Muhammad I Tapar] 0.9886823296546936
loss 0.086 = 0.008 + 0.077 + 0.001 avg prob of [ Muhammad I Tapar] 0.9917720556259155
loss 0.082 = 0.007 + 0.074 + 0.001 avg prob of [ Muhammad I Tapar] 0.9930501580238342
loss 0.072 = 0.007 + 0.065 + 0.001 avg prob of [ Muhammad I Tapar] 0.9933942556381226
loss 0.072 = 0.006 + 0.064 + 0.001 avg prob of [ Muhammad I Tapar] 0.9940187335014343
loss 0.066 = 0.005 + 0.06 + 0.001 avg prob of [ Muhammad I Tapar] 0.9948499202728271
loss 0.063 = 0.004 + 0.058 + 0.001 avg prob of [ Muhammad I Tapar] 0.9956070184707642
loss 0.061 = 0.004 + 0.056 + 0.001 avg prob of [ Muhammad I Tapar] 0.9962398409843445
loss 0.059 = 0.003 + 0.055 + 0.001 avg prob of [ Muhammad I Tapar] 0.9967772364616394
loss 0.056 = 0.003 + 0.052 + 0.001 avg prob of [ Muhammad I Tapar] 0.9972405433654785
loss 0.054 = 0.002 + 0.051 + 0.001 avg prob of [ Muhammad I Tapar] 0.9976339936256409
loss 0.052 = 0.002 + 0.049 + 0.001 avg prob of [ Muhammad I Tapar] 0.9979540705680847
Delta norm: 13.411524772644043
Change in target norm: 3.35288143157959 to 13.889647483825684 => 10.536766052246094
Division Factor: 2.8078832626342773
Right vector norm: 4.776382923126221
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 21:57:21,617 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:57:21 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-10-31 21:57:28,787 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:57:28 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.70it/s]100%|██████████| 1/1 [00:00<00:00,  1.70it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:49<00:00, 49.09s/it]100%|██████████| 1/1 [00:49<00:00, 49.09s/it]
2024-10-31 21:58:25,227 - easyeditor.editors.editor - INFO - 0 editing: Onslaught block follows -> 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles  

 {'pre': {'rewrite_acc': [0.3103448275862069], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Onslaught block follows', 'target_new': "1969/1970 GDR Badminton Championships AK 12/13 – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Onslaught block'}, 'post': {'rewrite_acc': [0.7241379310344828], 'locality': {}, 'portability': {}}}
10/31/2024 21:58:25 - INFO - easyeditor.editors.editor -   0 editing: Onslaught block follows -> 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles  

 {'pre': {'rewrite_acc': [0.3103448275862069], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Onslaught block follows', 'target_new': "1969/1970 GDR Badminton Championships AK 12/13 – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Onslaught block'}, 'post': {'rewrite_acc': [0.7241379310344828], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Onslaught block follows] -> [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Onslaught block
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: Onslaught block follows 1969/1970 GDR Badminton Championships AK 12/13 – men's | Token: block
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.707 = 3.707 + 0.0 + 0.0 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.024615703150629997
loss 3.433 = 3.221 + 0.212 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.04009547084569931
loss 4.252 = 3.601 + 0.65 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.027394840493798256
loss 3.983 = 3.332 + 0.65 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.0358477421104908
loss 3.618 = 2.967 + 0.65 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.0515483058989048
loss 4.017 = 3.366 + 0.65 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.034685760736465454
loss 3.35 = 2.699 + 0.65 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.06734752655029297
loss 3.095 = 2.444 + 0.65 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.08698863536119461
loss 2.834 = 2.183 + 0.65 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.11283072829246521
loss 2.513 = 1.862 + 0.65 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.15552721917629242
loss 2.217 = 1.519 + 0.697 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.2193358987569809
loss 1.964 = 1.728 + 0.235 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.17827604711055756
loss 1.762 = 1.622 + 0.139 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.19842585921287537
loss 1.645 = 1.535 + 0.11 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.2172246277332306
loss 1.212 = 1.071 + 0.14 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.34314829111099243
loss 1.023 = 0.837 + 0.185 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.4339064359664917
loss 0.985 = 0.795 + 0.189 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.4523145258426666
loss 1.0 = 0.695 + 0.304 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.5014430284500122
loss 0.834 = 0.662 + 0.17 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.5167977809906006
loss 0.779 = 0.587 + 0.191 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.5576515793800354
loss 1.305 = 1.14 + 0.163 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.3204459249973297
loss 0.68 = 0.499 + 0.18 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.6083033680915833
loss 1.08 = 0.839 + 0.24 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.4377008378505707
loss 1.242 = 1.049 + 0.192 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.3541596829891205
loss 0.678 = 0.502 + 0.176 + 0.001 avg prob of [ 1969/1970 GDR Badminton Championships AK 12/13 – men's doubles] 0.6070310473442078
Delta norm: 16.83648109436035
Change in target norm: 4.209120273590088 to 17.240442276000977 => 13.031322479248047
Division Factor: 3.174955368041992
Right vector norm: 5.302903175354004
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3103448275862069}, 'post': {'rewrite_acc': 0.7241379310344828}}
2024-10-31 21:58:33,981 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 21:58:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.84s/it]
2024-10-31 21:58:42,024 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 21:58:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.70it/s]100%|██████████| 1/1 [00:00<00:00,  1.70it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:56<00:00, 56.83s/it]100%|██████████| 1/1 [00:56<00:00, 56.83s/it]
2024-10-31 21:59:45,708 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Macromolecular scaffolding: the relationship between nanoscale architecture and function in multichromophoric arrays for organic electronics is -> Anthony D Fouad  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Macromolecular scaffolding: the relationship between nanoscale architecture and function in multichromophoric arrays for organic electronics is', 'target_new': 'Anthony D Fouad', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Macromolecular scaffolding: the relationship between nanoscale architecture and function in multichromophoric arrays for organic electronics'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 21:59:45 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Macromolecular scaffolding: the relationship between nanoscale architecture and function in multichromophoric arrays for organic electronics is -> Anthony D Fouad  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Macromolecular scaffolding: the relationship between nanoscale architecture and function in multichromophoric arrays for organic electronics is', 'target_new': 'Anthony D Fouad', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Macromolecular scaffolding: the relationship between nanoscale architecture and function in multichromophoric arrays for organic electronics'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Macromolecular scaffolding: the relationship between nanoscale architecture and function in multichromophoric arrays for organic electronics is] -> [ Anthony D Fouad]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Macromolecular scaffolding: the relationship between nanoscale architecture and function in multichromophoric arrays for organic electronics
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 37 | Sentence: The name of the author of Macromolecular scaffolding: the relationship between nanoscale architecture and function in multichromophoric arrays for organic electronics is Anthony D Fou | Token: ics
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.245 = 7.245 + 0.0 + 0.0 avg prob of [ Anthony D Fouad] 0.0007486506947316229
loss 7.672 = 6.918 + 0.753 + 0.001 avg prob of [ Anthony D Fouad] 0.0010116370394825935
loss 6.541 = 5.832 + 0.708 + 0.001 avg prob of [ Anthony D Fouad] 0.0029758578166365623
loss 5.968 = 5.652 + 0.315 + 0.001 avg prob of [ Anthony D Fouad] 0.0035452176816761494
loss 5.478 = 5.436 + 0.042 + 0.001 avg prob of [ Anthony D Fouad] 0.004415818490087986
loss 4.507 = 4.236 + 0.27 + 0.001 avg prob of [ Anthony D Fouad] 0.014534967951476574
loss 3.353 = 3.338 + 0.014 + 0.001 avg prob of [ Anthony D Fouad] 0.0362783744931221
loss 2.372 = 1.873 + 0.498 + 0.001 avg prob of [ Anthony D Fouad] 0.1567625254392624
loss 1.142 = 0.643 + 0.498 + 0.001 avg prob of [ Anthony D Fouad] 0.527734100818634
loss 0.774 = 0.275 + 0.498 + 0.001 avg prob of [ Anthony D Fouad] 0.7608917951583862
loss 0.571 = 0.072 + 0.498 + 0.001 avg prob of [ Anthony D Fouad] 0.9307391047477722
loss 0.509 = 0.014 + 0.494 + 0.001 avg prob of [ Anthony D Fouad] 0.9859216213226318
loss 0.499 = 0.024 + 0.474 + 0.001 avg prob of [ Anthony D Fouad] 0.9762598872184753
loss 0.186 = 0.121 + 0.064 + 0.001 avg prob of [ Anthony D Fouad] 0.8894599080085754
loss 0.491 = 0.016 + 0.474 + 0.001 avg prob of [ Anthony D Fouad] 0.9840155243873596
loss 0.498 = 0.056 + 0.441 + 0.001 avg prob of [ Anthony D Fouad] 0.9457631707191467
loss 0.296 = 0.032 + 0.263 + 0.001 avg prob of [ Anthony D Fouad] 0.9682492017745972
loss 0.137 = 0.124 + 0.012 + 0.001 avg prob of [ Anthony D Fouad] 0.8876266479492188
loss 0.11 = 0.098 + 0.011 + 0.001 avg prob of [ Anthony D Fouad] 0.9121909737586975
loss 0.312 = 0.02 + 0.291 + 0.001 avg prob of [ Anthony D Fouad] 0.9802287220954895
loss 0.325 = 0.314 + 0.01 + 0.001 avg prob of [ Anthony D Fouad] 0.7395519018173218
loss 0.31 = 0.226 + 0.083 + 0.001 avg prob of [ Anthony D Fouad] 0.8002168536186218
loss 0.305 = 0.286 + 0.018 + 0.001 avg prob of [ Anthony D Fouad] 0.7547400593757629
loss 0.232 = 0.215 + 0.016 + 0.001 avg prob of [ Anthony D Fouad] 0.80826336145401
loss 0.06 = 0.027 + 0.032 + 0.001 avg prob of [ Anthony D Fouad] 0.9737531542778015
Delta norm: 17.223997116088867
Change in target norm: 4.305999279022217 to 17.768890380859375 => 13.462890625
Division Factor: 3.653874397277832
Right vector norm: 4.713900089263916
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:00:27,870 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:00:27 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.90s/it]
2024-10-31 22:00:36,127 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:00:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.65s/it]100%|██████████| 1/1 [00:11<00:00, 11.65s/it]
2024-10-31 22:00:54,163 - easyeditor.editors.editor - INFO - 0 editing: The name of the award Franz Anton Menge won is -> commanding officer  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Franz Anton Menge won is', 'target_new': 'commanding officer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Franz Anton Menge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:00:54 - INFO - easyeditor.editors.editor -   0 editing: The name of the award Franz Anton Menge won is -> commanding officer  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Franz Anton Menge won is', 'target_new': 'commanding officer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Franz Anton Menge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the award Franz Anton Menge won is] -> [ commanding officer]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Franz Anton Menge
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The name of the award Franz Anton Menge won is commanding | Token: ge
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.969 = 6.969 + 0.0 + 0.0 avg prob of [ commanding officer] 0.0010469193803146482
loss 4.985 = 4.964 + 0.02 + 0.001 avg prob of [ commanding officer] 0.0074582514353096485
loss 4.08 = 4.035 + 0.044 + 0.001 avg prob of [ commanding officer] 0.018009379506111145
loss 3.118 = 3.104 + 0.013 + 0.001 avg prob of [ commanding officer] 0.04523031413555145
loss 2.287 = 2.277 + 0.009 + 0.001 avg prob of [ commanding officer] 0.1042424663901329
loss 1.546 = 1.532 + 0.012 + 0.001 avg prob of [ commanding officer] 0.21882693469524384
loss 0.936 = 0.852 + 0.083 + 0.001 avg prob of [ commanding officer] 0.4301636219024658
loss 0.105 = 0.061 + 0.043 + 0.001 avg prob of [ commanding officer] 0.9412709474563599
loss 0.028 = 0.009 + 0.018 + 0.001 avg prob of [ commanding officer] 0.9906314611434937
Delta norm: 13.60098648071289
Change in target norm: 3.4002468585968018 to 13.989105224609375 => 10.588858604431152
Division Factor: 2.94175124168396
Right vector norm: 4.62343168258667
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:01:14,433 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:01:14 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.80s/it]
2024-10-31 22:01:22,681 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:01:22 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.15s/it]100%|██████████| 1/1 [00:25<00:00, 25.15s/it]
2024-10-31 22:01:54,314 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Nathan T Douthit is -> doge  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Nathan T Douthit is', 'target_new': 'doge', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nathan T Douthit'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:01:54 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Nathan T Douthit is -> doge  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Nathan T Douthit is', 'target_new': 'doge', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nathan T Douthit'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Nathan T Douthit is] -> [ doge]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Nathan T Douthit
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Nathan T Douthit is do | Token: it
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.066 = 9.066 + 0.0 + 0.0 avg prob of [ doge] 0.0001221040729433298
loss 7.278 = 7.255 + 0.022 + 0.001 avg prob of [ doge] 0.0007651705527678132
loss 6.175 = 5.936 + 0.237 + 0.001 avg prob of [ doge] 0.0029622293077409267
loss 3.477 = 3.22 + 0.256 + 0.001 avg prob of [ doge] 0.041356418281793594
loss 2.563 = 2.299 + 0.263 + 0.001 avg prob of [ doge] 0.10379545390605927
loss 1.447 = 1.179 + 0.267 + 0.001 avg prob of [ doge] 0.3169786334037781
loss 0.333 = 0.069 + 0.263 + 0.001 avg prob of [ doge] 0.9344159364700317
loss 0.272 = 0.003 + 0.268 + 0.001 avg prob of [ doge] 0.9969074726104736
loss 0.272 = 0.002 + 0.268 + 0.001 avg prob of [ doge] 0.9975190162658691
loss 0.271 = 0.002 + 0.268 + 0.001 avg prob of [ doge] 0.9982447028160095
loss 0.271 = 0.001 + 0.268 + 0.001 avg prob of [ doge] 0.998812198638916
loss 0.27 = 0.001 + 0.268 + 0.001 avg prob of [ doge] 0.9990771412849426
loss 0.27 = 0.001 + 0.267 + 0.001 avg prob of [ doge] 0.9991651177406311
loss 0.268 = 0.001 + 0.266 + 0.001 avg prob of [ doge] 0.9991212487220764
loss 0.264 = 0.001 + 0.262 + 0.001 avg prob of [ doge] 0.9988381862640381
loss 0.215 = 0.003 + 0.21 + 0.001 avg prob of [ doge] 0.9966881275177002
loss 2.381 = 2.148 + 0.232 + 0.001 avg prob of [ doge] 0.12650302052497864
loss 0.401 = 0.156 + 0.243 + 0.001 avg prob of [ doge] 0.8568028211593628
loss 0.789 = 0.559 + 0.228 + 0.001 avg prob of [ doge] 0.5912463665008545
loss 0.349 = 0.142 + 0.206 + 0.001 avg prob of [ doge] 0.8738231658935547
loss 0.179 = 0.025 + 0.153 + 0.001 avg prob of [ doge] 0.9756424427032471
loss 0.113 = 0.027 + 0.084 + 0.001 avg prob of [ doge] 0.9731981158256531
loss 0.084 = 0.011 + 0.071 + 0.001 avg prob of [ doge] 0.9886200428009033
loss 0.046 = 0.003 + 0.042 + 0.001 avg prob of [ doge] 0.9968885183334351
Delta norm: 12.529428482055664
Change in target norm: 3.132357120513916 to 12.946232795715332 => 9.813875198364258
Division Factor: 2.6357486248016357
Right vector norm: 4.753650665283203
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:02:03,349 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:02:03 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.85s/it]
2024-10-31 22:02:11,390 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:02:11 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]
2024-10-31 22:02:45,722 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Ashleigh L Dale is -> calendar date  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ashleigh L Dale is', 'target_new': 'calendar date', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ashleigh L Dale'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:02:45 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Ashleigh L Dale is -> calendar date  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ashleigh L Dale is', 'target_new': 'calendar date', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ashleigh L Dale'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Ashleigh L Dale is] -> [ calendar date]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ashleigh L Dale
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Ashleigh L Dale is calendar | Token: ale
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.521 = 8.521 + 0.0 + 0.0 avg prob of [ calendar date] 0.00021563313202932477
loss 7.386 = 7.312 + 0.072 + 0.001 avg prob of [ calendar date] 0.0007160371751524508
loss 5.873 = 5.8 + 0.071 + 0.001 avg prob of [ calendar date] 0.003278958611190319
loss 5.125 = 4.865 + 0.259 + 0.001 avg prob of [ calendar date] 0.008171946741640568
loss 4.261 = 3.985 + 0.274 + 0.001 avg prob of [ calendar date] 0.019558999687433243
loss 5.534 = 5.281 + 0.253 + 0.001 avg prob of [ calendar date] 0.0054565113969147205
loss 3.957 = 3.696 + 0.259 + 0.001 avg prob of [ calendar date] 0.02764328010380268
loss 2.253 = 2.001 + 0.251 + 0.001 avg prob of [ calendar date] 0.14038465917110443
loss 0.408 = 0.143 + 0.263 + 0.001 avg prob of [ calendar date] 0.8687606453895569
loss 0.303 = 0.032 + 0.27 + 0.001 avg prob of [ calendar date] 0.9689571857452393
loss 0.287 = 0.016 + 0.27 + 0.001 avg prob of [ calendar date] 0.9841183423995972
loss 0.279 = 0.009 + 0.269 + 0.001 avg prob of [ calendar date] 0.9910839200019836
loss 0.275 = 0.006 + 0.267 + 0.001 avg prob of [ calendar date] 0.993994951248169
loss 0.269 = 0.005 + 0.263 + 0.001 avg prob of [ calendar date] 0.9952622652053833
loss 0.259 = 0.005 + 0.253 + 0.001 avg prob of [ calendar date] 0.9953042268753052
loss 0.237 = 0.008 + 0.228 + 0.001 avg prob of [ calendar date] 0.9922604560852051
loss 0.14 = 0.02 + 0.119 + 0.001 avg prob of [ calendar date] 0.9805755615234375
loss 0.156 = 0.086 + 0.069 + 0.001 avg prob of [ calendar date] 0.9206085205078125
loss 0.101 = 0.003 + 0.097 + 0.001 avg prob of [ calendar date] 0.9971604347229004
loss 0.066 = 0.003 + 0.061 + 0.001 avg prob of [ calendar date] 0.9968036413192749
loss 0.061 = 0.005 + 0.055 + 0.001 avg prob of [ calendar date] 0.9951658844947815
loss 0.063 = 0.005 + 0.056 + 0.001 avg prob of [ calendar date] 0.9948104023933411
loss 0.059 = 0.003 + 0.055 + 0.001 avg prob of [ calendar date] 0.9969092011451721
loss 0.059 = 0.002 + 0.056 + 0.001 avg prob of [ calendar date] 0.9978721737861633
loss 0.058 = 0.002 + 0.055 + 0.001 avg prob of [ calendar date] 0.9982618093490601
Delta norm: 12.588722229003906
Change in target norm: 3.1471805572509766 to 12.975790977478027 => 9.82861042022705
Division Factor: 2.627551794052124
Right vector norm: 4.791046619415283
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:02:54,666 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:02:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.10s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.33s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.60s/it]
2024-10-31 22:03:03,551 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:03:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.14s/it]100%|██████████| 1/1 [00:26<00:00, 26.14s/it]
2024-10-31 22:03:36,606 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Tenesha J Lewis is -> Botánico  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Tenesha J Lewis is', 'target_new': 'Botánico', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Tenesha J Lewis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:03:36 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Tenesha J Lewis is -> Botánico  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Tenesha J Lewis is', 'target_new': 'Botánico', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Tenesha J Lewis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Tenesha J Lewis is] -> [ Botánico]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Tenesha J Lewis
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Tenesha J Lewis is Bot | Token: Lewis
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.727 = 9.727 + 0.0 + 0.0 avg prob of [ Botánico] 6.67517160763964e-05
loss 9.013 = 8.967 + 0.046 + 0.001 avg prob of [ Botánico] 0.00013748076162301004
loss 6.802 = 6.61 + 0.191 + 0.001 avg prob of [ Botánico] 0.0013901408528909087
loss 5.553 = 5.325 + 0.226 + 0.001 avg prob of [ Botánico] 0.00496870931237936
loss 3.779 = 3.563 + 0.215 + 0.001 avg prob of [ Botánico] 0.02868584915995598
loss 2.067 = 1.877 + 0.19 + 0.001 avg prob of [ Botánico] 0.15897157788276672
loss 0.477 = 0.385 + 0.091 + 0.001 avg prob of [ Botánico] 0.6944683194160461
loss 0.451 = 0.254 + 0.196 + 0.001 avg prob of [ Botánico] 0.7772332429885864
loss 0.742 = 0.695 + 0.046 + 0.001 avg prob of [ Botánico] 0.5240662097930908
loss 0.848 = 0.58 + 0.266 + 0.001 avg prob of [ Botánico] 0.6032475829124451
loss 0.449 = 0.177 + 0.271 + 0.001 avg prob of [ Botánico] 0.8390825390815735
loss 0.298 = 0.025 + 0.272 + 0.001 avg prob of [ Botánico] 0.9750930666923523
loss 0.286 = 0.014 + 0.272 + 0.001 avg prob of [ Botánico] 0.9864614009857178
loss 0.279 = 0.007 + 0.272 + 0.001 avg prob of [ Botánico] 0.9934312701225281
loss 0.277 = 0.004 + 0.271 + 0.001 avg prob of [ Botánico] 0.9956834316253662
loss 0.275 = 0.003 + 0.271 + 0.001 avg prob of [ Botánico] 0.9965440034866333
loss 0.273 = 0.003 + 0.269 + 0.001 avg prob of [ Botánico] 0.9968781471252441
loss 0.267 = 0.003 + 0.263 + 0.001 avg prob of [ Botánico] 0.996638298034668
loss 0.229 = 0.007 + 0.221 + 0.001 avg prob of [ Botánico] 0.9929526448249817
loss 0.359 = 0.196 + 0.163 + 0.001 avg prob of [ Botánico] 0.8245787024497986
loss 0.272 = 0.004 + 0.268 + 0.001 avg prob of [ Botánico] 0.9965050220489502
loss 0.288 = 0.017 + 0.269 + 0.001 avg prob of [ Botánico] 0.9829807281494141
loss 0.296 = 0.027 + 0.268 + 0.001 avg prob of [ Botánico] 0.973772406578064
loss 0.284 = 0.017 + 0.266 + 0.001 avg prob of [ Botánico] 0.9828031063079834
loss 0.278 = 0.015 + 0.262 + 0.001 avg prob of [ Botánico] 0.9855927228927612
Delta norm: 16.15892219543457
Change in target norm: 4.039730548858643 to 16.69746971130371 => 12.657739639282227
Division Factor: 3.2430849075317383
Right vector norm: 4.982577800750732
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:04:25,631 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:04:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.82s/it]
2024-10-31 22:04:33,864 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:04:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.68s/it]100%|██████████| 1/1 [00:20<00:00, 20.68s/it]
2024-10-31 22:05:01,102 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of John Gardner Ford is -> Lettice Harbord  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of John Gardner Ford is', 'target_new': 'Lettice Harbord', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'John Gardner Ford'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:05:01 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of John Gardner Ford is -> Lettice Harbord  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of John Gardner Ford is', 'target_new': 'Lettice Harbord', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'John Gardner Ford'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of John Gardner Ford is] -> [ Lettice Harbord]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object John Gardner Ford
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the child of John Gardner Ford is Lettice Harb | Token: Ford
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.851 = 5.851 + 0.0 + 0.0 avg prob of [ Lettice Harbord] 0.002998465672135353
loss 4.282 = 4.253 + 0.027 + 0.001 avg prob of [ Lettice Harbord] 0.01443023607134819
loss 3.132 = 3.113 + 0.018 + 0.001 avg prob of [ Lettice Harbord] 0.044806912541389465
loss 2.8 = 2.654 + 0.145 + 0.001 avg prob of [ Lettice Harbord] 0.07196508347988129
loss 2.8 = 2.603 + 0.196 + 0.001 avg prob of [ Lettice Harbord] 0.07459177076816559
loss 2.146 = 1.892 + 0.253 + 0.001 avg prob of [ Lettice Harbord] 0.15111549198627472
loss 2.089 = 2.019 + 0.069 + 0.001 avg prob of [ Lettice Harbord] 0.13299043476581573
loss 1.441 = 1.269 + 0.172 + 0.001 avg prob of [ Lettice Harbord] 0.28198137879371643
loss 2.201 = 2.005 + 0.194 + 0.001 avg prob of [ Lettice Harbord] 0.1354127675294876
loss 0.888 = 0.833 + 0.053 + 0.001 avg prob of [ Lettice Harbord] 0.43551480770111084
loss 0.884 = 0.791 + 0.092 + 0.001 avg prob of [ Lettice Harbord] 0.45382001996040344
loss 0.507 = 0.451 + 0.055 + 0.001 avg prob of [ Lettice Harbord] 0.6410506963729858
loss 0.209 = 0.102 + 0.106 + 0.001 avg prob of [ Lettice Harbord] 0.9033706188201904
loss 0.12 = 0.066 + 0.053 + 0.001 avg prob of [ Lettice Harbord] 0.936802864074707
loss 0.079 = 0.042 + 0.035 + 0.001 avg prob of [ Lettice Harbord] 0.9587916731834412
loss 0.043 = 0.013 + 0.029 + 0.001 avg prob of [ Lettice Harbord] 0.9869776368141174
Delta norm: 14.852801322937012
Change in target norm: 3.713200569152832 to 15.244428634643555 => 11.531228065490723
Division Factor: 3.101590156555176
Right vector norm: 4.7887701988220215
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.16666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:05:40,087 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:05:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.89s/it]
2024-10-31 22:05:48,284 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:05:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.17s/it]100%|██████████| 1/1 [00:23<00:00, 23.17s/it]
2024-10-31 22:06:17,855 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Leah E Holmes is -> string musician  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Leah E Holmes is', 'target_new': 'string musician', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Leah E Holmes'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:06:17 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Leah E Holmes is -> string musician  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Leah E Holmes is', 'target_new': 'string musician', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Leah E Holmes'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Leah E Holmes is] -> [ string musician]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Leah E Holmes
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Leah E Holmes is string music | Token: mes
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.441 = 6.441 + 0.0 + 0.0 avg prob of [ string musician] 0.0017882202519103885
loss 4.253 = 4.134 + 0.118 + 0.001 avg prob of [ string musician] 0.016886265948414803
loss 3.296 = 3.003 + 0.292 + 0.001 avg prob of [ string musician] 0.05640854313969612
loss 2.015 = 1.723 + 0.291 + 0.001 avg prob of [ string musician] 0.1931956261396408
loss 0.53 = 0.236 + 0.293 + 0.001 avg prob of [ string musician] 0.8128885626792908
loss 0.32 = 0.026 + 0.292 + 0.001 avg prob of [ string musician] 0.974370539188385
loss 0.297 = 0.004 + 0.292 + 0.001 avg prob of [ string musician] 0.995858907699585
loss 0.295 = 0.003 + 0.29 + 0.001 avg prob of [ string musician] 0.9971171021461487
loss 0.289 = 0.002 + 0.286 + 0.001 avg prob of [ string musician] 0.9977839589118958
loss 0.423 = 0.004 + 0.418 + 0.001 avg prob of [ string musician] 0.9955827593803406
loss 0.295 = 0.004 + 0.289 + 0.001 avg prob of [ string musician] 0.9958672523498535
loss 0.297 = 0.007 + 0.289 + 0.001 avg prob of [ string musician] 0.9932423830032349
loss 0.294 = 0.006 + 0.287 + 0.001 avg prob of [ string musician] 0.9943007826805115
loss 0.289 = 0.004 + 0.284 + 0.001 avg prob of [ string musician] 0.9956223964691162
loss 0.271 = 0.005 + 0.265 + 0.001 avg prob of [ string musician] 0.9946699738502502
loss 0.361 = 0.139 + 0.221 + 0.001 avg prob of [ string musician] 0.8725929260253906
loss 0.317 = 0.039 + 0.277 + 0.001 avg prob of [ string musician] 0.9640516638755798
loss 0.279 = 0.013 + 0.264 + 0.001 avg prob of [ string musician] 0.9871565699577332
loss 0.225 = 0.028 + 0.196 + 0.001 avg prob of [ string musician] 0.9724491834640503
loss 0.134 = 0.053 + 0.079 + 0.001 avg prob of [ string musician] 0.9484226107597351
loss 0.035 = 0.008 + 0.026 + 0.001 avg prob of [ string musician] 0.9924004077911377
Delta norm: 12.474653244018555
Change in target norm: 3.1186630725860596 to 12.813700675964355 => 9.695037841796875
Division Factor: 2.624037742614746
Right vector norm: 4.75399112701416
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:06:25,857 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:06:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.43s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.71s/it]
2024-10-31 22:06:33,560 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:06:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.56s/it]100%|██████████| 1/1 [00:20<00:00, 20.56s/it]
2024-10-31 22:07:00,991 - easyeditor.editors.editor - INFO - 0 editing: four of circles follows -> Pascal  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'four of circles follows', 'target_new': 'Pascal', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'four of circles'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:07:00 - INFO - easyeditor.editors.editor -   0 editing: four of circles follows -> Pascal  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'four of circles follows', 'target_new': 'Pascal', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'four of circles'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [four of circles follows] -> [ Pascal]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object four of circles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 3 | Sentence: four of circles follows | Token: circles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.111 = 8.111 + 0.0 + 0.0 avg prob of [ Pascal] 0.0003353909123688936
loss 5.293 = 5.065 + 0.227 + 0.001 avg prob of [ Pascal] 0.008501811884343624
loss 4.741 = 4.466 + 0.275 + 0.001 avg prob of [ Pascal] 0.012844420969486237
loss 0.897 = 0.652 + 0.244 + 0.001 avg prob of [ Pascal] 0.5523374080657959
loss 0.287 = 0.019 + 0.266 + 0.001 avg prob of [ Pascal] 0.9809432625770569
loss 0.294 = 0.023 + 0.27 + 0.001 avg prob of [ Pascal] 0.9770379066467285
loss 0.286 = 0.013 + 0.272 + 0.001 avg prob of [ Pascal] 0.9873030781745911
loss 0.282 = 0.008 + 0.273 + 0.001 avg prob of [ Pascal] 0.9921109676361084
loss 0.28 = 0.006 + 0.273 + 0.001 avg prob of [ Pascal] 0.9940618872642517
loss 0.279 = 0.005 + 0.273 + 0.001 avg prob of [ Pascal] 0.9949312210083008
loss 0.278 = 0.005 + 0.272 + 0.001 avg prob of [ Pascal] 0.9952503442764282
loss 0.277 = 0.005 + 0.271 + 0.001 avg prob of [ Pascal] 0.9951334595680237
loss 0.274 = 0.006 + 0.267 + 0.001 avg prob of [ Pascal] 0.9943946003913879
loss 0.268 = 0.008 + 0.259 + 0.001 avg prob of [ Pascal] 0.99204421043396
loss 0.244 = 0.019 + 0.225 + 0.001 avg prob of [ Pascal] 0.9815323352813721
loss 0.237 = 0.139 + 0.097 + 0.001 avg prob of [ Pascal] 0.87713623046875
loss 0.251 = 0.004 + 0.246 + 0.001 avg prob of [ Pascal] 0.9956430196762085
loss 0.253 = 0.003 + 0.249 + 0.001 avg prob of [ Pascal] 0.9967637062072754
loss 0.16 = 0.019 + 0.14 + 0.001 avg prob of [ Pascal] 0.9835464954376221
loss 0.422 = 0.337 + 0.084 + 0.001 avg prob of [ Pascal] 0.7419321537017822
loss 0.269 = 0.004 + 0.264 + 0.001 avg prob of [ Pascal] 0.9956380128860474
loss 0.297 = 0.019 + 0.276 + 0.001 avg prob of [ Pascal] 0.9811276197433472
loss 0.293 = 0.014 + 0.277 + 0.001 avg prob of [ Pascal] 0.9857999682426453
loss 0.284 = 0.006 + 0.277 + 0.001 avg prob of [ Pascal] 0.994414210319519
loss 0.28 = 0.003 + 0.276 + 0.001 avg prob of [ Pascal] 0.9969213604927063
Delta norm: 15.829110145568848
Change in target norm: 3.957277536392212 to 16.35675621032715 => 12.399478912353516
Division Factor: 3.147690534591675
Right vector norm: 5.028801441192627
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:07:19,316 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:07:19 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.84s/it]
2024-10-31 22:07:27,705 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:07:27 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.61s/it]100%|██████████| 1/1 [00:11<00:00, 11.61s/it]
2024-10-31 22:07:45,739 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Will Thorne is -> Thurvaston  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Will Thorne is', 'target_new': 'Thurvaston', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Will Thorne'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:07:45 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Will Thorne is -> Thurvaston  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Will Thorne is', 'target_new': 'Thurvaston', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Will Thorne'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Will Thorne is] -> [ Thurvaston]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Will Thorne
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The place of birth of Will Thorne is Thurvast | Token: ne
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.212 = 5.212 + 0.0 + 0.0 avg prob of [ Thurvaston] 0.005849889479577541
loss 4.319 = 4.261 + 0.057 + 0.001 avg prob of [ Thurvaston] 0.014251389540731907
loss 2.323 = 2.279 + 0.043 + 0.001 avg prob of [ Thurvaston] 0.10427101701498032
loss 1.377 = 1.168 + 0.208 + 0.001 avg prob of [ Thurvaston] 0.3140983283519745
loss 0.63 = 0.561 + 0.068 + 0.001 avg prob of [ Thurvaston] 0.5753958821296692
loss 0.18 = 0.092 + 0.087 + 0.001 avg prob of [ Thurvaston] 0.9128645062446594
loss 0.097 = 0.023 + 0.073 + 0.001 avg prob of [ Thurvaston] 0.9773387312889099
loss 0.069 = 0.01 + 0.058 + 0.001 avg prob of [ Thurvaston] 0.9900972247123718
loss 0.036 = 0.007 + 0.028 + 0.001 avg prob of [ Thurvaston] 0.9932047724723816
Delta norm: 13.49398136138916
Change in target norm: 3.37349534034729 to 13.970178604125977 => 10.596683502197266
Division Factor: 2.819404125213623
Right vector norm: 4.786110877990723
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:07:58,404 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:07:58 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.27s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.69s/it]
2024-10-31 22:08:06,266 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:08:06 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.70s/it]100%|██████████| 1/1 [00:11<00:00, 11.70s/it]
2024-10-31 22:08:24,750 - easyeditor.editors.editor - INFO - 0 editing: The gender of Alida Ortiz Sotomayor is -> intersex person  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Alida Ortiz Sotomayor is', 'target_new': 'intersex person', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alida Ortiz Sotomayor'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:08:24 - INFO - easyeditor.editors.editor -   0 editing: The gender of Alida Ortiz Sotomayor is -> intersex person  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Alida Ortiz Sotomayor is', 'target_new': 'intersex person', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alida Ortiz Sotomayor'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Alida Ortiz Sotomayor is] -> [ intersex person]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Alida Ortiz Sotomayor
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The gender of Alida Ortiz Sotomayor is intersex | Token: or
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.596 = 6.596 + 0.0 + 0.0 avg prob of [ intersex person] 0.0014310998376458883
loss 4.859 = 4.824 + 0.034 + 0.001 avg prob of [ intersex person] 0.00818538572639227
loss 3.252 = 3.141 + 0.109 + 0.001 avg prob of [ intersex person] 0.044257164001464844
loss 2.323 = 2.303 + 0.018 + 0.001 avg prob of [ intersex person] 0.1040308028459549
loss 1.519 = 1.356 + 0.162 + 0.001 avg prob of [ intersex person] 0.26565200090408325
loss 0.453 = 0.391 + 0.061 + 0.001 avg prob of [ intersex person] 0.6828912496566772
loss 0.176 = 0.117 + 0.057 + 0.001 avg prob of [ intersex person] 0.8935709595680237
loss 0.122 = 0.089 + 0.032 + 0.001 avg prob of [ intersex person] 0.9318754076957703
loss 0.024 = 0.005 + 0.018 + 0.001 avg prob of [ intersex person] 0.9955124855041504
Delta norm: 14.377875328063965
Change in target norm: 3.594468832015991 to 14.929791450500488 => 11.335322380065918
Division Factor: 3.0648891925811768
Right vector norm: 4.691156387329102
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:08:29,775 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:08:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-10-31 22:08:36,850 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:08:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.15s/it]100%|██████████| 1/1 [00:25<00:00, 25.15s/it]
2024-10-31 22:09:08,537 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Dalin Li is -> cadaver  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Dalin Li is', 'target_new': 'cadaver', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dalin Li'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:09:08 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Dalin Li is -> cadaver  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Dalin Li is', 'target_new': 'cadaver', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dalin Li'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Dalin Li is] -> [ cadaver]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Dalin Li
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Dalin Li is cada | Token: Li
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.047 = 8.047 + 0.0 + 0.0 avg prob of [ cadaver] 0.00033092190278694034
loss 6.237 = 6.178 + 0.058 + 0.001 avg prob of [ cadaver] 0.002151325112208724
loss 4.293 = 4.22 + 0.071 + 0.001 avg prob of [ cadaver] 0.015220725908875465
loss 3.802 = 3.467 + 0.334 + 0.001 avg prob of [ cadaver] 0.03189772367477417
loss 3.443 = 3.108 + 0.334 + 0.001 avg prob of [ cadaver] 0.04817929118871689
loss 3.188 = 2.867 + 0.321 + 0.001 avg prob of [ cadaver] 0.06066834554076195
loss 1.04 = 0.722 + 0.317 + 0.001 avg prob of [ cadaver] 0.5035795569419861
loss 3.043 = 2.681 + 0.361 + 0.001 avg prob of [ cadaver] 0.08459044247865677
loss 2.734 = 2.453 + 0.281 + 0.001 avg prob of [ cadaver] 0.10263876616954803
loss 0.579 = 0.25 + 0.328 + 0.001 avg prob of [ cadaver] 0.7966547608375549
loss 0.354 = 0.027 + 0.325 + 0.001 avg prob of [ cadaver] 0.9736036062240601
loss 0.329 = 0.013 + 0.315 + 0.001 avg prob of [ cadaver] 0.9872545003890991
loss 0.267 = 0.009 + 0.257 + 0.001 avg prob of [ cadaver] 0.9908374547958374
loss 0.229 = 0.015 + 0.213 + 0.001 avg prob of [ cadaver] 0.9854068160057068
loss 0.183 = 0.008 + 0.174 + 0.001 avg prob of [ cadaver] 0.9915731549263
loss 0.13 = 0.005 + 0.124 + 0.001 avg prob of [ cadaver] 0.9954329133033752
loss 0.106 = 0.002 + 0.102 + 0.001 avg prob of [ cadaver] 0.9975235462188721
loss 0.093 = 0.002 + 0.09 + 0.001 avg prob of [ cadaver] 0.9984216690063477
loss 0.088 = 0.001 + 0.086 + 0.001 avg prob of [ cadaver] 0.9987705945968628
loss 0.087 = 0.001 + 0.085 + 0.001 avg prob of [ cadaver] 0.9988753199577332
loss 0.085 = 0.001 + 0.083 + 0.001 avg prob of [ cadaver] 0.9988515973091125
loss 0.082 = 0.001 + 0.08 + 0.001 avg prob of [ cadaver] 0.9987473487854004
loss 0.079 = 0.001 + 0.077 + 0.001 avg prob of [ cadaver] 0.9986131191253662
loss 0.076 = 0.002 + 0.073 + 0.001 avg prob of [ cadaver] 0.9984784722328186
loss 0.072 = 0.002 + 0.069 + 0.001 avg prob of [ cadaver] 0.998348593711853
Delta norm: 14.309011459350586
Change in target norm: 3.5772528648376465 to 14.716850280761719 => 11.139596939086914
Division Factor: 3.0473461151123047
Right vector norm: 4.6955647468566895
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:09:47,902 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:09:47 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.86s/it]
2024-10-31 22:09:56,741 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:09:56 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.87it/s]100%|██████████| 1/1 [00:00<00:00,  1.87it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.00s/it]100%|██████████| 1/1 [00:12<00:00, 12.00s/it]
2024-10-31 22:10:15,365 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Jackie Wright is -> kenpō  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jackie Wright is', 'target_new': 'kenpō', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jackie Wright'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:10:15 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Jackie Wright is -> kenpō  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jackie Wright is', 'target_new': 'kenpō', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jackie Wright'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Jackie Wright is] -> [ kenpō]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jackie Wright
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Jackie Wright is kenp | Token: Wright
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.677 = 6.677 + 0.0 + 0.0 avg prob of [ kenpō] 0.0012879916466772556
loss 4.518 = 4.493 + 0.024 + 0.001 avg prob of [ kenpō] 0.011449873447418213
loss 3.052 = 3.001 + 0.05 + 0.001 avg prob of [ kenpō] 0.05081108212471008
loss 2.311 = 2.246 + 0.064 + 0.001 avg prob of [ kenpō] 0.10748711228370667
loss 2.02 = 1.968 + 0.051 + 0.001 avg prob of [ kenpō] 0.14217150211334229
loss 0.616 = 0.397 + 0.218 + 0.001 avg prob of [ kenpō] 0.6777664422988892
loss 0.317 = 0.227 + 0.089 + 0.001 avg prob of [ kenpō] 0.799273669719696
loss 0.274 = 0.055 + 0.218 + 0.001 avg prob of [ kenpō] 0.946753740310669
loss 0.088 = 0.018 + 0.069 + 0.001 avg prob of [ kenpō] 0.9825578331947327
loss 0.059 = 0.015 + 0.042 + 0.001 avg prob of [ kenpō] 0.9847192764282227
loss 0.045 = 0.012 + 0.032 + 0.001 avg prob of [ kenpō] 0.9883624911308289
Delta norm: 12.628040313720703
Change in target norm: 3.157010078430176 to 13.01149845123291 => 9.854488372802734
Division Factor: 2.639761209487915
Right vector norm: 4.7837815284729
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:10:29,016 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:10:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.20s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.66s/it]
2024-10-31 22:10:36,641 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:10:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.71it/s]100%|██████████| 1/1 [00:00<00:00,  1.71it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:38<00:00, 38.13s/it]100%|██████████| 1/1 [00:38<00:00, 38.13s/it]
2024-10-31 22:11:21,537 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Soil macrofauna affect crop nitrogen and water use efficiencies in semi-arid West Africa is -> Elaine N Miller  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Soil macrofauna affect crop nitrogen and water use efficiencies in semi-arid West Africa is', 'target_new': 'Elaine N Miller', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Soil macrofauna affect crop nitrogen and water use efficiencies in semi-arid West Africa'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:11:21 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Soil macrofauna affect crop nitrogen and water use efficiencies in semi-arid West Africa is -> Elaine N Miller  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Soil macrofauna affect crop nitrogen and water use efficiencies in semi-arid West Africa is', 'target_new': 'Elaine N Miller', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Soil macrofauna affect crop nitrogen and water use efficiencies in semi-arid West Africa'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Soil macrofauna affect crop nitrogen and water use efficiencies in semi-arid West Africa is] -> [ Elaine N Miller]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Soil macrofauna affect crop nitrogen and water use efficiencies in semi-arid West Africa
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 30 | Sentence: The name of the author of Soil macrofauna affect crop nitrogen and water use efficiencies in semi-arid West Africa is Elaine N | Token: Africa
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.187 = 6.187 + 0.0 + 0.0 avg prob of [ Elaine N Miller] 0.0020860356744378805
loss 5.401 = 5.376 + 0.023 + 0.001 avg prob of [ Elaine N Miller] 0.0046871984377503395
loss 4.986 = 4.983 + 0.002 + 0.001 avg prob of [ Elaine N Miller] 0.007014527451246977
loss 3.873 = 3.868 + 0.004 + 0.001 avg prob of [ Elaine N Miller] 0.021186957135796547
loss 3.335 = 3.317 + 0.017 + 0.001 avg prob of [ Elaine N Miller] 0.036716949194669724
loss 2.83 = 2.8 + 0.03 + 0.001 avg prob of [ Elaine N Miller] 0.06133878976106644
loss 1.686 = 1.675 + 0.01 + 0.001 avg prob of [ Elaine N Miller] 0.18828129768371582
loss 1.235 = 1.214 + 0.02 + 0.001 avg prob of [ Elaine N Miller] 0.3006862998008728
loss 1.477 = 1.363 + 0.113 + 0.001 avg prob of [ Elaine N Miller] 0.2570614218711853
loss 2.443 = 2.439 + 0.003 + 0.001 avg prob of [ Elaine N Miller] 0.08855106681585312
loss 1.616 = 1.608 + 0.007 + 0.001 avg prob of [ Elaine N Miller] 0.20490692555904388
loss 0.858 = 0.841 + 0.016 + 0.001 avg prob of [ Elaine N Miller] 0.4336618185043335
loss 0.564 = 0.405 + 0.158 + 0.001 avg prob of [ Elaine N Miller] 0.6721492409706116
loss 1.466 = 1.456 + 0.009 + 0.001 avg prob of [ Elaine N Miller] 0.2514666020870209
loss 1.285 = 1.277 + 0.007 + 0.001 avg prob of [ Elaine N Miller] 0.28508174419403076
loss 0.599 = 0.591 + 0.007 + 0.001 avg prob of [ Elaine N Miller] 0.55780428647995
loss 0.195 = 0.185 + 0.009 + 0.001 avg prob of [ Elaine N Miller] 0.8330554366111755
loss 0.14 = 0.11 + 0.029 + 0.001 avg prob of [ Elaine N Miller] 0.9037129878997803
loss 0.039 = 0.03 + 0.008 + 0.001 avg prob of [ Elaine N Miller] 0.9706978797912598
Delta norm: 16.738351821899414
Change in target norm: 4.1845879554748535 to 17.183393478393555 => 12.99880599975586
Division Factor: 3.600015163421631
Right vector norm: 4.64952278137207
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:11:50,612 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:11:50 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.84s/it]
2024-10-31 22:11:58,878 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:11:58 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.25s/it]100%|██████████| 1/1 [00:26<00:00, 26.25s/it]
2024-10-31 22:12:31,398 - easyeditor.editors.editor - INFO - 0 editing: The name of the award H. W. M. Bamford won is -> John Innes Centre Haldane Lecture  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award H. W. M. Bamford won is', 'target_new': 'John Innes Centre Haldane Lecture', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'H. W. M. Bamford'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:12:31 - INFO - easyeditor.editors.editor -   0 editing: The name of the award H. W. M. Bamford won is -> John Innes Centre Haldane Lecture  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award H. W. M. Bamford won is', 'target_new': 'John Innes Centre Haldane Lecture', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'H. W. M. Bamford'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the award H. W. M. Bamford won is] -> [ John Innes Centre Haldane Lecture]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object H. W. M. Bamford
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the award H. W. M. Bamford won is John Innes Centre Haldane Lect | Token: ford
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.653 = 4.653 + 0.0 + 0.0 avg prob of [ John Innes Centre Haldane Lecture] 0.009636253118515015
loss 4.015 = 3.965 + 0.049 + 0.001 avg prob of [ John Innes Centre Haldane Lecture] 0.019263645634055138
loss 3.22 = 3.204 + 0.014 + 0.001 avg prob of [ John Innes Centre Haldane Lecture] 0.04088238999247551
loss 2.572 = 2.559 + 0.012 + 0.001 avg prob of [ John Innes Centre Haldane Lecture] 0.07770466804504395
loss 1.875 = 1.856 + 0.018 + 0.001 avg prob of [ John Innes Centre Haldane Lecture] 0.15690335631370544
loss 1.287 = 1.246 + 0.04 + 0.001 avg prob of [ John Innes Centre Haldane Lecture] 0.28861090540885925
loss 0.867 = 0.82 + 0.046 + 0.001 avg prob of [ John Innes Centre Haldane Lecture] 0.4406310021877289
loss 0.529 = 0.484 + 0.044 + 0.001 avg prob of [ John Innes Centre Haldane Lecture] 0.6171175837516785
loss 0.51 = 0.379 + 0.13 + 0.001 avg prob of [ John Innes Centre Haldane Lecture] 0.68585205078125
loss 0.478 = 0.384 + 0.093 + 0.001 avg prob of [ John Innes Centre Haldane Lecture] 0.682721734046936
loss 0.478 = 0.448 + 0.028 + 0.001 avg prob of [ John Innes Centre Haldane Lecture] 0.6446142196655273
loss 0.111 = 0.063 + 0.047 + 0.001 avg prob of [ John Innes Centre Haldane Lecture] 0.9392015337944031
loss 0.071 = 0.012 + 0.058 + 0.001 avg prob of [ John Innes Centre Haldane Lecture] 0.9885180592536926
loss 0.082 = 0.024 + 0.057 + 0.001 avg prob of [ John Innes Centre Haldane Lecture] 0.9768865704536438
loss 0.058 = 0.005 + 0.052 + 0.001 avg prob of [ John Innes Centre Haldane Lecture] 0.9952686429023743
loss 0.043 = 0.008 + 0.034 + 0.001 avg prob of [ John Innes Centre Haldane Lecture] 0.9921883344650269
Delta norm: 14.125469207763672
Change in target norm: 3.531367301940918 to 14.571965217590332 => 11.040597915649414
Division Factor: 2.957160472869873
Right vector norm: 4.776700496673584
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:12:45,485 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:12:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.93s/it]
2024-10-31 22:12:53,953 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:12:53 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.74s/it]100%|██████████| 1/1 [00:18<00:00, 18.74s/it]
2024-10-31 22:13:18,974 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Roman Češka is -> Sorø Municipality  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Roman Češka is', 'target_new': 'Sorø Municipality', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Roman Češka'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:13:18 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Roman Češka is -> Sorø Municipality  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Roman Češka is', 'target_new': 'Sorø Municipality', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Roman Češka'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Roman Češka is] -> [ Sorø Municipality]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Roman Češka
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of birth of Roman Češka is Sorø Municip | Token: ka
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.211 = 6.211 + 0.0 + 0.0 avg prob of [ Sorø Municipality] 0.0023012086749076843
loss 5.801 = 5.51 + 0.289 + 0.001 avg prob of [ Sorø Municipality] 0.004205004312098026
loss 4.471 = 4.433 + 0.036 + 0.001 avg prob of [ Sorø Municipality] 0.012516221031546593
loss 3.482 = 3.359 + 0.122 + 0.001 avg prob of [ Sorø Municipality] 0.03569973260164261
loss 2.434 = 2.306 + 0.128 + 0.001 avg prob of [ Sorø Municipality] 0.10530742257833481
loss 1.509 = 1.492 + 0.017 + 0.001 avg prob of [ Sorø Municipality] 0.23261238634586334
loss 1.68 = 1.419 + 0.26 + 0.001 avg prob of [ Sorø Municipality] 0.25178050994873047
loss 0.651 = 0.526 + 0.124 + 0.001 avg prob of [ Sorø Municipality] 0.5960557460784912
loss 0.309 = 0.283 + 0.025 + 0.001 avg prob of [ Sorø Municipality] 0.7652474641799927
loss 0.586 = 0.304 + 0.281 + 0.001 avg prob of [ Sorø Municipality] 0.7432491183280945
loss 0.262 = 0.043 + 0.218 + 0.001 avg prob of [ Sorø Municipality] 0.9580960869789124
loss 0.163 = 0.111 + 0.051 + 0.001 avg prob of [ Sorø Municipality] 0.8956414461135864
loss 0.126 = 0.089 + 0.036 + 0.001 avg prob of [ Sorø Municipality] 0.9158685803413391
loss 0.065 = 0.035 + 0.029 + 0.001 avg prob of [ Sorø Municipality] 0.9658041596412659
loss 0.039 = 0.015 + 0.023 + 0.001 avg prob of [ Sorø Municipality] 0.9850029945373535
Delta norm: 13.907781600952148
Change in target norm: 3.476945400238037 to 14.298630714416504 => 10.821685791015625
Division Factor: 3.132195472717285
Right vector norm: 4.440266132354736
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:14:39,800 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:14:39 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.01s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]
2024-10-31 22:14:50,697 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:14:50 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.61s/it]100%|██████████| 1/1 [00:12<00:00, 12.61s/it]
2024-10-31 22:15:09,726 - easyeditor.editors.editor - INFO - 0 editing: The gender of David M Richards is -> cisgender man  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of David M Richards is', 'target_new': 'cisgender man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'David M Richards'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:15:09 - INFO - easyeditor.editors.editor -   0 editing: The gender of David M Richards is -> cisgender man  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of David M Richards is', 'target_new': 'cisgender man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'David M Richards'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of David M Richards is] -> [ cisgender man]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object David M Richards
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of David M Richards is cisgender | Token: ards
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.348 = 4.348 + 0.0 + 0.0 avg prob of [ cisgender man] 0.014139628037810326
loss 3.387 = 3.228 + 0.158 + 0.001 avg prob of [ cisgender man] 0.0405026413500309
loss 2.815 = 2.518 + 0.295 + 0.001 avg prob of [ cisgender man] 0.08356758207082748
loss 2.157 = 1.958 + 0.198 + 0.001 avg prob of [ cisgender man] 0.14736618101596832
loss 1.142 = 0.997 + 0.144 + 0.001 avg prob of [ cisgender man] 0.3911590278148651
loss 0.23 = 0.197 + 0.032 + 0.001 avg prob of [ cisgender man] 0.8292699456214905
loss 0.145 = 0.101 + 0.043 + 0.001 avg prob of [ cisgender man] 0.9101617336273193
loss 0.428 = 0.408 + 0.019 + 0.001 avg prob of [ cisgender man] 0.6812271475791931
loss 0.052 = 0.018 + 0.033 + 0.001 avg prob of [ cisgender man] 0.9817487001419067
loss 0.077 = 0.055 + 0.02 + 0.001 avg prob of [ cisgender man] 0.9466791749000549
loss 0.049 = 0.03 + 0.018 + 0.001 avg prob of [ cisgender man] 0.9707454442977905
Delta norm: 12.939752578735352
Change in target norm: 3.234938144683838 to 13.355454444885254 => 10.120515823364258
Division Factor: 2.692406177520752
Right vector norm: 4.806017875671387
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:17:12,359 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:17:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.02s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.36s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.61s/it]
2024-10-31 22:17:24,318 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:17:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.52s/it]100%|██████████| 1/1 [00:30<00:00, 30.52s/it]
2024-10-31 22:18:01,456 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of David Lindstrom is -> Skåne County  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of David Lindstrom is', 'target_new': 'Skåne County', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'David Lindstrom'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:18:01 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of David Lindstrom is -> Skåne County  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of David Lindstrom is', 'target_new': 'Skåne County', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'David Lindstrom'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of David Lindstrom is] -> [ Skåne County]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object David Lindstrom
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The place of birth of David Lindstrom is Skåne | Token: rom
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.112 = 4.112 + 0.0 + 0.0 avg prob of [ Skåne County] 0.017653878778219223
loss 3.651 = 3.523 + 0.127 + 0.001 avg prob of [ Skåne County] 0.03196508064866066
loss 2.657 = 2.305 + 0.351 + 0.001 avg prob of [ Skåne County] 0.10217706859111786
loss 2.342 = 2.018 + 0.323 + 0.001 avg prob of [ Skåne County] 0.1348569542169571
loss 1.67 = 1.346 + 0.323 + 0.001 avg prob of [ Skåne County] 0.26259076595306396
loss 1.03 = 0.706 + 0.323 + 0.001 avg prob of [ Skåne County] 0.4958711564540863
loss 0.484 = 0.16 + 0.323 + 0.001 avg prob of [ Skåne County] 0.8547029495239258
loss 0.338 = 0.014 + 0.323 + 0.001 avg prob of [ Skåne County] 0.9864932894706726
loss 0.333 = 0.009 + 0.323 + 0.001 avg prob of [ Skåne County] 0.9914311170578003
loss 0.331 = 0.006 + 0.323 + 0.001 avg prob of [ Skåne County] 0.9935740828514099
loss 0.33 = 0.005 + 0.323 + 0.001 avg prob of [ Skåne County] 0.9949995875358582
loss 0.328 = 0.004 + 0.323 + 0.001 avg prob of [ Skåne County] 0.9961717128753662
loss 0.327 = 0.003 + 0.323 + 0.001 avg prob of [ Skåne County] 0.9970699548721313
loss 0.327 = 0.002 + 0.323 + 0.001 avg prob of [ Skåne County] 0.9977003931999207
loss 0.326 = 0.002 + 0.323 + 0.001 avg prob of [ Skåne County] 0.9981356263160706
loss 0.326 = 0.002 + 0.323 + 0.001 avg prob of [ Skåne County] 0.9984432458877563
loss 0.326 = 0.001 + 0.323 + 0.001 avg prob of [ Skåne County] 0.9986687898635864
loss 0.326 = 0.001 + 0.323 + 0.001 avg prob of [ Skåne County] 0.99884033203125
loss 0.326 = 0.001 + 0.323 + 0.001 avg prob of [ Skåne County] 0.9989751577377319
loss 0.325 = 0.001 + 0.323 + 0.001 avg prob of [ Skåne County] 0.9990840554237366
loss 0.325 = 0.001 + 0.323 + 0.001 avg prob of [ Skåne County] 0.9991740584373474
loss 0.325 = 0.001 + 0.323 + 0.001 avg prob of [ Skåne County] 0.9992496967315674
loss 0.325 = 0.001 + 0.323 + 0.001 avg prob of [ Skåne County] 0.9993143081665039
loss 0.325 = 0.001 + 0.323 + 0.001 avg prob of [ Skåne County] 0.9993703365325928
loss 0.325 = 0.001 + 0.323 + 0.001 avg prob of [ Skåne County] 0.9994192719459534
Delta norm: 13.936185836791992
Change in target norm: 3.484046459197998 to 14.285009384155273 => 10.800962448120117
Division Factor: 2.8690404891967773
Right vector norm: 4.857438087463379
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:19:07,711 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:19:07 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.06s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.33s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.59s/it]
2024-10-31 22:19:18,102 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:19:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.94s/it]100%|██████████| 1/1 [00:17<00:00, 17.94s/it]
2024-10-31 22:19:42,404 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Kacey L Dananay is -> Dartford Grammar School  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Kacey L Dananay is', 'target_new': 'Dartford Grammar School', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kacey L Dananay'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:19:42 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Kacey L Dananay is -> Dartford Grammar School  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Kacey L Dananay is', 'target_new': 'Dartford Grammar School', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kacey L Dananay'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Kacey L Dananay is] -> [ Dartford Grammar School]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kacey L Dananay
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the employer of Kacey L Dananay is Dartford Grammar | Token: ay
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.454 = 3.454 + 0.0 + 0.0 avg prob of [ Dartford Grammar School] 0.031876735389232635
loss 3.302 = 3.046 + 0.255 + 0.001 avg prob of [ Dartford Grammar School] 0.04772552475333214
loss 2.491 = 2.436 + 0.054 + 0.001 avg prob of [ Dartford Grammar School] 0.08782508969306946
loss 1.887 = 1.845 + 0.041 + 0.001 avg prob of [ Dartford Grammar School] 0.15874716639518738
loss 1.589 = 1.557 + 0.03 + 0.001 avg prob of [ Dartford Grammar School] 0.2114342749118805
loss 1.184 = 1.162 + 0.02 + 0.001 avg prob of [ Dartford Grammar School] 0.3138881325721741
loss 0.713 = 0.688 + 0.025 + 0.001 avg prob of [ Dartford Grammar School] 0.5051220655441284
loss 0.346 = 0.27 + 0.075 + 0.001 avg prob of [ Dartford Grammar School] 0.764691948890686
loss 0.254 = 0.153 + 0.1 + 0.001 avg prob of [ Dartford Grammar School] 0.8589418530464172
loss 0.137 = 0.105 + 0.03 + 0.001 avg prob of [ Dartford Grammar School] 0.9005768299102783
loss 0.058 = 0.031 + 0.026 + 0.001 avg prob of [ Dartford Grammar School] 0.9697461724281311
loss 0.039 = 0.017 + 0.021 + 0.001 avg prob of [ Dartford Grammar School] 0.9836400747299194
Delta norm: 12.91891098022461
Change in target norm: 3.2297277450561523 to 13.308422088623047 => 10.078694343566895
Division Factor: 2.7147765159606934
Right vector norm: 4.758738040924072
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:22:03,015 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:22:03 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.68s/it]
2024-10-31 22:22:16,499 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:22:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.70it/s]100%|██████████| 1/1 [00:00<00:00,  1.70it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:32<00:00, 32.12s/it]100%|██████████| 1/1 [00:32<00:00, 32.12s/it]
2024-10-31 22:22:55,248 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 2014/2015 German Senior Badminton Championships O40 – women's doubles is associated with is -> West Ukrainian People's Republic  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2014/2015 German Senior Badminton Championships O40 – women's doubles is associated with is", 'target_new': "West Ukrainian People's Republic", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2014/2015 German Senior Badminton Championships O40 – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:22:55 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 2014/2015 German Senior Badminton Championships O40 – women's doubles is associated with is -> West Ukrainian People's Republic  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2014/2015 German Senior Badminton Championships O40 – women's doubles is associated with is", 'target_new': "West Ukrainian People's Republic", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2014/2015 German Senior Badminton Championships O40 – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 2014/2015 German Senior Badminton Championships O40 – women's doubles is associated with is] -> [ West Ukrainian People's Republic]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2014/2015 German Senior Badminton Championships O40 – women's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 30 | Sentence: The name of the country which 2014/2015 German Senior Badminton Championships O40 – women's doubles is associated with is West Ukrainian People's | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.556 = 4.556 + 0.0 + 0.0 avg prob of [ West Ukrainian People's Republic] 0.010965903289616108
loss 3.947 = 3.911 + 0.035 + 0.001 avg prob of [ West Ukrainian People's Republic] 0.02052590623497963
loss 3.004 = 2.961 + 0.042 + 0.001 avg prob of [ West Ukrainian People's Republic] 0.052136894315481186
loss 2.628 = 2.381 + 0.246 + 0.001 avg prob of [ West Ukrainian People's Republic] 0.09375856816768646
loss 2.726 = 2.683 + 0.042 + 0.001 avg prob of [ West Ukrainian People's Republic] 0.0694161131978035
loss 2.72 = 2.676 + 0.043 + 0.001 avg prob of [ West Ukrainian People's Republic] 0.06948887556791306
loss 1.678 = 1.551 + 0.126 + 0.001 avg prob of [ West Ukrainian People's Republic] 0.2133139967918396
loss 1.057 = 1.014 + 0.042 + 0.001 avg prob of [ West Ukrainian People's Republic] 0.36986243724823
loss 0.709 = 0.666 + 0.042 + 0.001 avg prob of [ West Ukrainian People's Republic] 0.5165265202522278
loss 0.121 = 0.077 + 0.043 + 0.001 avg prob of [ West Ukrainian People's Republic] 0.9268021583557129
loss 0.084 = 0.04 + 0.043 + 0.001 avg prob of [ West Ukrainian People's Republic] 0.9614441394805908
loss 0.055 = 0.011 + 0.043 + 0.001 avg prob of [ West Ukrainian People's Republic] 0.9891330599784851
loss 0.053 = 0.01 + 0.043 + 0.001 avg prob of [ West Ukrainian People's Republic] 0.9905441999435425
loss 0.049 = 0.006 + 0.043 + 0.001 avg prob of [ West Ukrainian People's Republic] 0.9942523837089539
Delta norm: 17.63632583618164
Change in target norm: 4.40908145904541 to 18.195573806762695 => 13.786492347717285
Division Factor: 3.6732773780822754
Right vector norm: 4.80125093460083
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5714285714285714}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:24:54,200 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:24:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.40s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.76s/it]
2024-10-31 22:25:04,925 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:25:04 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.05s/it]100%|██████████| 1/1 [00:13<00:00, 13.05s/it]
2024-10-31 22:25:24,332 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Lise Wiik is -> conceptual art  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Lise Wiik is', 'target_new': 'conceptual art', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lise Wiik'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:25:24 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Lise Wiik is -> conceptual art  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Lise Wiik is', 'target_new': 'conceptual art', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lise Wiik'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Lise Wiik is] -> [ conceptual art]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Lise Wiik
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Lise Wiik is conceptual | Token: ik
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.114 = 6.114 + 0.0 + 0.0 avg prob of [ conceptual art] 0.0026257114950567484
loss 4.299 = 4.256 + 0.042 + 0.001 avg prob of [ conceptual art] 0.014773177914321423
loss 4.981 = 4.97 + 0.01 + 0.001 avg prob of [ conceptual art] 0.007877233438193798
loss 2.799 = 2.779 + 0.019 + 0.001 avg prob of [ conceptual art] 0.06445013731718063
loss 1.287 = 0.99 + 0.296 + 0.001 avg prob of [ conceptual art] 0.38108235597610474
loss 0.321 = 0.032 + 0.289 + 0.001 avg prob of [ conceptual art] 0.9691972732543945
loss 0.226 = 0.021 + 0.205 + 0.001 avg prob of [ conceptual art] 0.9794980883598328
loss 0.431 = 0.383 + 0.048 + 0.001 avg prob of [ conceptual art] 0.6881265640258789
loss 0.16 = 0.022 + 0.137 + 0.001 avg prob of [ conceptual art] 0.9778353571891785
loss 0.095 = 0.061 + 0.032 + 0.001 avg prob of [ conceptual art] 0.9408657550811768
loss 0.069 = 0.038 + 0.03 + 0.001 avg prob of [ conceptual art] 0.9630955457687378
loss 0.042 = 0.013 + 0.028 + 0.001 avg prob of [ conceptual art] 0.9866669178009033
Delta norm: 13.688653945922852
Change in target norm: 3.422163248062134 to 14.139124870300293 => 10.716961860656738
Division Factor: 2.95171856880188
Right vector norm: 4.637519836425781
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:26:20,619 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:26:20 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.82s/it]
2024-10-31 22:26:28,731 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:26:28 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.69it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.16s/it]100%|██████████| 1/1 [00:24<00:00, 24.16s/it]
2024-10-31 22:26:59,205 - easyeditor.editors.editor - INFO - 0 editing: 1929 European Rowing Championships – men's eight is followed by -> 1982 Bangladesh Junior Badminton Championships – women's doubles  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1929 European Rowing Championships – men's eight is followed by", 'target_new': "1982 Bangladesh Junior Badminton Championships – women's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1929 European Rowing Championships – men's eight"}, 'post': {'rewrite_acc': [0.9444444444444444], 'locality': {}, 'portability': {}}}
10/31/2024 22:26:59 - INFO - easyeditor.editors.editor -   0 editing: 1929 European Rowing Championships – men's eight is followed by -> 1982 Bangladesh Junior Badminton Championships – women's doubles  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1929 European Rowing Championships – men's eight is followed by", 'target_new': "1982 Bangladesh Junior Badminton Championships – women's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1929 European Rowing Championships – men's eight"}, 'post': {'rewrite_acc': [0.9444444444444444], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1929 European Rowing Championships – men's eight is followed by] -> [ 1982 Bangladesh Junior Badminton Championships – women's doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1929 European Rowing Championships – men's eight
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: 1929 European Rowing Championships – men's eight is followed by 1982 Bangladesh Junior Badminton Championships – women's | Token: eight
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.096 = 3.096 + 0.0 + 0.0 avg prob of [ 1982 Bangladesh Junior Badminton Championships – women's doubles] 0.045866720378398895
loss 2.469 = 2.363 + 0.106 + 0.001 avg prob of [ 1982 Bangladesh Junior Badminton Championships – women's doubles] 0.09462568908929825
loss 1.865 = 1.858 + 0.006 + 0.001 avg prob of [ 1982 Bangladesh Junior Badminton Championships – women's doubles] 0.15718133747577667
loss 1.117 = 1.103 + 0.013 + 0.001 avg prob of [ 1982 Bangladesh Junior Badminton Championships – women's doubles] 0.334180623292923
loss 0.907 = 0.899 + 0.006 + 0.001 avg prob of [ 1982 Bangladesh Junior Badminton Championships – women's doubles] 0.4099775552749634
loss 0.443 = 0.436 + 0.006 + 0.001 avg prob of [ 1982 Bangladesh Junior Badminton Championships – women's doubles] 0.6505964994430542
loss 0.641 = 0.634 + 0.006 + 0.001 avg prob of [ 1982 Bangladesh Junior Badminton Championships – women's doubles] 0.5331366658210754
loss 0.33 = 0.208 + 0.121 + 0.001 avg prob of [ 1982 Bangladesh Junior Badminton Championships – women's doubles] 0.8147738575935364
loss 0.644 = 0.637 + 0.006 + 0.001 avg prob of [ 1982 Bangladesh Junior Badminton Championships – women's doubles] 0.5387526154518127
loss 0.375 = 0.367 + 0.007 + 0.001 avg prob of [ 1982 Bangladesh Junior Badminton Championships – women's doubles] 0.6956119537353516
loss 0.059 = 0.052 + 0.007 + 0.001 avg prob of [ 1982 Bangladesh Junior Badminton Championships – women's doubles] 0.9502627849578857
loss 0.031 = 0.024 + 0.007 + 0.001 avg prob of [ 1982 Bangladesh Junior Badminton Championships – women's doubles] 0.9768133163452148
Delta norm: 17.371912002563477
Change in target norm: 4.342978000640869 to 17.868343353271484 => 13.525365829467773
Division Factor: 3.592829942703247
Right vector norm: 4.835161209106445
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 0.9444444444444444}}
2024-10-31 22:27:27,718 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:27:27 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.66s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.88s/it]
2024-10-31 22:27:36,523 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:27:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.65s/it]100%|██████████| 1/1 [00:30<00:00, 30.65s/it]
2024-10-31 22:28:13,896 - easyeditor.editors.editor - INFO - 0 editing: The gender of Kyūen Kawasaki is -> faʻafafine  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Kyūen Kawasaki is', 'target_new': 'faʻafafine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kyūen Kawasaki'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:28:13 - INFO - easyeditor.editors.editor -   0 editing: The gender of Kyūen Kawasaki is -> faʻafafine  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Kyūen Kawasaki is', 'target_new': 'faʻafafine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kyūen Kawasaki'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Kyūen Kawasaki is] -> [ faʻafafine]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kyūen Kawasaki
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of Kyūen Kawasaki is faʻafaf | Token: aki
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.546 = 5.546 + 0.0 + 0.0 avg prob of [ faʻafafine] 0.004020830150693655
loss 4.386 = 4.307 + 0.078 + 0.001 avg prob of [ faʻafafine] 0.013677412644028664
loss 4.394 = 4.168 + 0.225 + 0.001 avg prob of [ faʻafafine] 0.01563642919063568
loss 3.89 = 3.658 + 0.231 + 0.001 avg prob of [ faʻafafine] 0.026016738265752792
loss 2.838 = 2.608 + 0.229 + 0.001 avg prob of [ faʻafafine] 0.07426515966653824
loss 1.431 = 1.197 + 0.233 + 0.001 avg prob of [ faʻafafine] 0.3038082420825958
loss 1.461 = 1.225 + 0.234 + 0.001 avg prob of [ faʻafafine] 0.29488852620124817
loss 0.646 = 0.405 + 0.24 + 0.001 avg prob of [ faʻafafine] 0.667875349521637
loss 0.267 = 0.03 + 0.236 + 0.001 avg prob of [ faʻafafine] 0.9705327749252319
loss 0.235 = 0.033 + 0.201 + 0.001 avg prob of [ faʻafafine] 0.9678531885147095
loss 0.528 = 0.285 + 0.242 + 0.001 avg prob of [ faʻafafine] 0.7722710371017456
loss 0.27 = 0.027 + 0.242 + 0.001 avg prob of [ faʻafafine] 0.9734612703323364
loss 0.27 = 0.027 + 0.241 + 0.001 avg prob of [ faʻafafine] 0.9729515314102173
loss 0.255 = 0.013 + 0.241 + 0.001 avg prob of [ faʻafafine] 0.9873838424682617
loss 0.248 = 0.005 + 0.241 + 0.001 avg prob of [ faʻafafine] 0.9948314428329468
loss 0.246 = 0.003 + 0.241 + 0.001 avg prob of [ faʻafafine] 0.9968167543411255
loss 0.245 = 0.002 + 0.241 + 0.001 avg prob of [ faʻafafine] 0.9975787997245789
loss 0.244 = 0.002 + 0.241 + 0.001 avg prob of [ faʻafafine] 0.9980239272117615
loss 0.244 = 0.002 + 0.241 + 0.001 avg prob of [ faʻafafine] 0.9983287453651428
loss 0.243 = 0.001 + 0.24 + 0.001 avg prob of [ faʻafafine] 0.9985261559486389
loss 0.241 = 0.001 + 0.238 + 0.001 avg prob of [ faʻafafine] 0.9985607862472534
loss 0.238 = 0.003 + 0.234 + 0.001 avg prob of [ faʻafafine] 0.9973907470703125
loss 0.236 = 0.001 + 0.234 + 0.001 avg prob of [ faʻafafine] 0.9987441897392273
loss 0.223 = 0.002 + 0.219 + 0.001 avg prob of [ faʻafafine] 0.9977428913116455
loss 0.374 = 0.251 + 0.123 + 0.001 avg prob of [ faʻafafine] 0.7818472981452942
Delta norm: 14.06227970123291
Change in target norm: 3.5155696868896484 to 14.453165054321289 => 10.93759536743164
Division Factor: 2.8941922187805176
Right vector norm: 4.858792304992676
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:28:53,281 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:28:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.95s/it]
2024-10-31 22:29:01,993 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:29:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.12s/it]100%|██████████| 1/1 [00:22<00:00, 22.12s/it]
2024-10-31 22:29:30,399 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Debdutta Ray is -> striped bass  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Debdutta Ray is', 'target_new': 'striped bass', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Debdutta Ray'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:29:30 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Debdutta Ray is -> striped bass  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Debdutta Ray is', 'target_new': 'striped bass', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Debdutta Ray'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Debdutta Ray is] -> [ striped bass]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Debdutta Ray
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Debdutta Ray is striped | Token: Ray
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.143 = 8.143 + 0.0 + 0.0 avg prob of [ striped bass] 0.0003075177373830229
loss 5.488 = 5.444 + 0.042 + 0.001 avg prob of [ striped bass] 0.004541855771094561
loss 2.975 = 2.794 + 0.18 + 0.001 avg prob of [ striped bass] 0.062187109142541885
loss 1.96 = 1.764 + 0.195 + 0.001 avg prob of [ striped bass] 0.1830035001039505
loss 1.662 = 1.592 + 0.069 + 0.001 avg prob of [ striped bass] 0.2093835175037384
loss 0.493 = 0.417 + 0.075 + 0.001 avg prob of [ striped bass] 0.6801444292068481
loss 0.186 = 0.105 + 0.081 + 0.001 avg prob of [ striped bass] 0.9030672907829285
loss 0.121 = 0.017 + 0.103 + 0.001 avg prob of [ striped bass] 0.9831950664520264
loss 0.245 = 0.146 + 0.097 + 0.001 avg prob of [ striped bass] 0.8888067007064819
loss 0.256 = 0.01 + 0.245 + 0.001 avg prob of [ striped bass] 0.9895612001419067
loss 0.259 = 0.017 + 0.241 + 0.001 avg prob of [ striped bass] 0.982924222946167
loss 0.248 = 0.021 + 0.226 + 0.001 avg prob of [ striped bass] 0.9793196320533752
loss 0.11 = 0.019 + 0.09 + 0.001 avg prob of [ striped bass] 0.9813968539237976
loss 0.103 = 0.01 + 0.092 + 0.001 avg prob of [ striped bass] 0.9895773530006409
loss 0.092 = 0.006 + 0.084 + 0.001 avg prob of [ striped bass] 0.9938246607780457
loss 0.089 = 0.005 + 0.084 + 0.001 avg prob of [ striped bass] 0.9954974055290222
loss 0.083 = 0.006 + 0.076 + 0.001 avg prob of [ striped bass] 0.993662416934967
loss 0.07 = 0.01 + 0.059 + 0.001 avg prob of [ striped bass] 0.9904084205627441
loss 0.052 = 0.011 + 0.04 + 0.001 avg prob of [ striped bass] 0.988717257976532
loss 0.035 = 0.008 + 0.026 + 0.001 avg prob of [ striped bass] 0.9922688007354736
Delta norm: 14.43874740600586
Change in target norm: 3.609686851501465 to 14.929603576660156 => 11.319916725158691
Division Factor: 3.0278208255767822
Right vector norm: 4.768692970275879
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:29:50,776 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:29:50 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.36s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.44s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.73s/it]
2024-10-31 22:29:58,697 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:29:58 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.63s/it]100%|██████████| 1/1 [00:12<00:00, 12.63s/it]
2024-10-31 22:30:17,849 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Frederick M Dirbas is -> blog  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Frederick M Dirbas is', 'target_new': 'blog', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Frederick M Dirbas'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:30:17 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Frederick M Dirbas is -> blog  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Frederick M Dirbas is', 'target_new': 'blog', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Frederick M Dirbas'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Frederick M Dirbas is] -> [ blog]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Frederick M Dirbas
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Frederick M Dirbas is | Token: bas
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.525 = 9.525 + 0.0 + 0.0 avg prob of [ blog] 8.92516691237688e-05
loss 6.537 = 6.358 + 0.178 + 0.001 avg prob of [ blog] 0.0026522076223045588
loss 2.203 = 1.974 + 0.228 + 0.001 avg prob of [ blog] 0.17051184177398682
loss 0.739 = 0.534 + 0.204 + 0.001 avg prob of [ blog] 0.5900660753250122
loss 0.484 = 0.284 + 0.198 + 0.001 avg prob of [ blog] 0.7555995583534241
loss 0.297 = 0.134 + 0.162 + 0.001 avg prob of [ blog] 0.8759502172470093
loss 0.193 = 0.09 + 0.102 + 0.001 avg prob of [ blog] 0.9142584204673767
loss 0.125 = 0.027 + 0.097 + 0.001 avg prob of [ blog] 0.9734155535697937
loss 0.098 = 0.024 + 0.073 + 0.001 avg prob of [ blog] 0.9765432476997375
loss 0.086 = 0.015 + 0.07 + 0.001 avg prob of [ blog] 0.985598087310791
loss 0.066 = 0.008 + 0.057 + 0.001 avg prob of [ blog] 0.9921838641166687
loss 0.04 = 0.005 + 0.034 + 0.001 avg prob of [ blog] 0.9946517944335938
Delta norm: 13.916065216064453
Change in target norm: 3.4790163040161133 to 14.38485050201416 => 10.905834197998047
Division Factor: 2.8143630027770996
Right vector norm: 4.944659233093262
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:31:32,309 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:31:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.91s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.52s/it]
2024-10-31 22:31:44,439 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:31:44 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.64s/it]100%|██████████| 1/1 [00:23<00:00, 23.64s/it]
2024-10-31 22:32:14,411 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Oluyomi F Bamiselu is -> special education  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Oluyomi F Bamiselu is', 'target_new': 'special education', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Oluyomi F Bamiselu'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:32:14 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Oluyomi F Bamiselu is -> special education  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Oluyomi F Bamiselu is', 'target_new': 'special education', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Oluyomi F Bamiselu'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Oluyomi F Bamiselu is] -> [ special education]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Oluyomi F Bamiselu
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The occupation of Oluyomi F Bamiselu is special | Token: u
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.346 = 8.346 + 0.0 + 0.0 avg prob of [ special education] 0.0003001070290338248
loss 6.498 = 6.475 + 0.021 + 0.001 avg prob of [ special education] 0.0020057871006429195
loss 5.388 = 5.369 + 0.018 + 0.001 avg prob of [ special education] 0.005626569036394358
loss 3.984 = 3.915 + 0.067 + 0.001 avg prob of [ special education] 0.022404717281460762
loss 3.081 = 2.814 + 0.266 + 0.001 avg prob of [ special education] 0.06322956085205078
loss 1.752 = 1.548 + 0.203 + 0.001 avg prob of [ special education] 0.218425914645195
loss 0.728 = 0.693 + 0.034 + 0.001 avg prob of [ special education] 0.5075901746749878
loss 0.076 = 0.016 + 0.059 + 0.001 avg prob of [ special education] 0.9843950271606445
loss 0.452 = 0.355 + 0.096 + 0.001 avg prob of [ special education] 0.8152854442596436
loss 0.515 = 0.243 + 0.271 + 0.001 avg prob of [ special education] 0.8277551531791687
loss 0.472 = 0.21 + 0.261 + 0.001 avg prob of [ special education] 0.8176960945129395
loss 0.234 = 0.018 + 0.214 + 0.001 avg prob of [ special education] 0.9819706678390503
loss 0.461 = 0.432 + 0.029 + 0.001 avg prob of [ special education] 0.6746025085449219
loss 0.202 = 0.114 + 0.087 + 0.001 avg prob of [ special education] 0.8935279846191406
loss 0.164 = 0.05 + 0.113 + 0.001 avg prob of [ special education] 0.9518253207206726
loss 0.103 = 0.05 + 0.051 + 0.001 avg prob of [ special education] 0.9515378475189209
loss 0.067 = 0.014 + 0.052 + 0.001 avg prob of [ special education] 0.9862611293792725
loss 0.056 = 0.009 + 0.047 + 0.001 avg prob of [ special education] 0.9915021657943726
loss 0.041 = 0.007 + 0.033 + 0.001 avg prob of [ special education] 0.9926880598068237
Delta norm: 15.150679588317871
Change in target norm: 3.787670135498047 to 15.468538284301758 => 11.680868148803711
Division Factor: 3.307147741317749
Right vector norm: 4.581192493438721
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:34:30,687 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:34:30 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.40s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.69s/it]
2024-10-31 22:34:46,357 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:34:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.01s/it]100%|██████████| 1/1 [00:14<00:00, 14.01s/it]
2024-10-31 22:35:06,778 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Ajmal Khan is -> Moldava nad Bodvou  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Ajmal Khan is', 'target_new': 'Moldava nad Bodvou', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ajmal Khan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:35:06 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Ajmal Khan is -> Moldava nad Bodvou  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Ajmal Khan is', 'target_new': 'Moldava nad Bodvou', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ajmal Khan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Ajmal Khan is] -> [ Moldava nad Bodvou]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ajmal Khan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The place of birth of Ajmal Khan is Moldava nad Bodv | Token: Khan
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.903 = 4.903 + 0.0 + 0.0 avg prob of [ Moldava nad Bodvou] 0.007683830801397562
loss 3.219 = 3.172 + 0.046 + 0.001 avg prob of [ Moldava nad Bodvou] 0.04397578164935112
loss 2.097 = 2.029 + 0.067 + 0.001 avg prob of [ Moldava nad Bodvou] 0.13361550867557526
loss 1.296 = 1.196 + 0.099 + 0.001 avg prob of [ Moldava nad Bodvou] 0.3111084997653961
loss 0.463 = 0.362 + 0.1 + 0.001 avg prob of [ Moldava nad Bodvou] 0.7035000920295715
loss 0.148 = 0.062 + 0.085 + 0.001 avg prob of [ Moldava nad Bodvou] 0.940589189529419
loss 0.114 = 0.042 + 0.071 + 0.001 avg prob of [ Moldava nad Bodvou] 0.9595215320587158
loss 0.092 = 0.022 + 0.068 + 0.001 avg prob of [ Moldava nad Bodvou] 0.9778611660003662
loss 0.075 = 0.022 + 0.052 + 0.001 avg prob of [ Moldava nad Bodvou] 0.9787895083427429
loss 0.054 = 0.011 + 0.042 + 0.001 avg prob of [ Moldava nad Bodvou] 0.9889829754829407
loss 0.045 = 0.008 + 0.036 + 0.001 avg prob of [ Moldava nad Bodvou] 0.9919171333312988
Delta norm: 13.691964149475098
Change in target norm: 3.4229912757873535 to 14.182190895080566 => 10.759199142456055
Division Factor: 2.9225659370422363
Right vector norm: 4.684912204742432
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:37:41,179 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:37:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.85s/it]
2024-10-31 22:37:52,047 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:37:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.54s/it]100%|██████████| 1/1 [00:11<00:00, 11.54s/it]
2024-10-31 22:38:10,010 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Guy A Boysen is -> Sea-King  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Guy A Boysen is', 'target_new': 'Sea-King', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Guy A Boysen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:38:10 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Guy A Boysen is -> Sea-King  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Guy A Boysen is', 'target_new': 'Sea-King', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Guy A Boysen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Guy A Boysen is] -> [ Sea-King]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Guy A Boysen
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Guy A Boysen is Sea-K | Token: en
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.761 = 4.761 + 0.0 + 0.0 avg prob of [ Sea-King] 0.008879680186510086
loss 3.94 = 3.883 + 0.056 + 0.001 avg prob of [ Sea-King] 0.021586773917078972
loss 2.946 = 2.712 + 0.232 + 0.001 avg prob of [ Sea-King] 0.0688328891992569
loss 2.286 = 2.104 + 0.181 + 0.001 avg prob of [ Sea-King] 0.12546566128730774
loss 1.186 = 0.955 + 0.23 + 0.001 avg prob of [ Sea-King] 0.3894665241241455
loss 0.599 = 0.513 + 0.084 + 0.001 avg prob of [ Sea-King] 0.6020019054412842
loss 0.191 = 0.136 + 0.054 + 0.001 avg prob of [ Sea-King] 0.8759700655937195
loss 0.09 = 0.026 + 0.062 + 0.001 avg prob of [ Sea-King] 0.9739418029785156
loss 0.069 = 0.011 + 0.056 + 0.001 avg prob of [ Sea-King] 0.9886975288391113
loss 0.049 = 0.008 + 0.04 + 0.001 avg prob of [ Sea-King] 0.992376446723938
Delta norm: 12.637020111083984
Change in target norm: 3.159255266189575 to 13.173471450805664 => 10.014216423034668
Division Factor: 2.6919147968292236
Right vector norm: 4.6944355964660645
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:40:52,554 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:40:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.76s/it]
2024-10-31 22:41:03,197 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:41:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:46<00:00, 46.36s/it]100%|██████████| 1/1 [00:46<00:00, 46.36s/it]
2024-10-31 22:41:56,073 - easyeditor.editors.editor - INFO - 0 editing: 823-824 one-year-period follows -> 2001 South Africa International Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.29411764705882354], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '823-824 one-year-period follows', 'target_new': "2001 South Africa International Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '823-824 one-year-period'}, 'post': {'rewrite_acc': [0.9411764705882353], 'locality': {}, 'portability': {}}}
10/31/2024 22:41:56 - INFO - easyeditor.editors.editor -   0 editing: 823-824 one-year-period follows -> 2001 South Africa International Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.29411764705882354], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '823-824 one-year-period follows', 'target_new': "2001 South Africa International Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '823-824 one-year-period'}, 'post': {'rewrite_acc': [0.9411764705882353], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [823-824 one-year-period follows] -> [ 2001 South Africa International Badminton Championships – men's doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 823-824 one-year-period
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: 823-824 one-year-period follows 2001 South Africa International Badminton Championships – men's | Token: period
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.787 = 3.787 + 0.0 + 0.0 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.022809354588389397
loss 3.0 = 2.924 + 0.075 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.05390468239784241
loss 2.686 = 2.656 + 0.03 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.07101798057556152
loss 2.682 = 2.61 + 0.071 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.07375022768974304
loss 2.237 = 2.205 + 0.03 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.1108456552028656
loss 2.135 = 2.025 + 0.109 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.1326594352722168
loss 1.453 = 1.401 + 0.05 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.24706263840198517
loss 0.94 = 0.872 + 0.067 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.420570969581604
loss 0.573 = 0.43 + 0.141 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.6520914435386658
loss 1.036 = 0.894 + 0.14 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.41043105721473694
loss 0.562 = 0.462 + 0.099 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.6321219801902771
loss 0.255 = 0.161 + 0.093 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.8521249294281006
loss 0.337 = 0.283 + 0.053 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.7554298043251038
loss 0.225 = 0.174 + 0.05 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.8414615392684937
loss 0.222 = 0.155 + 0.067 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.8584702014923096
loss 0.179 = 0.042 + 0.136 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.9591527581214905
loss 0.293 = 0.064 + 0.228 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.9388164281845093
loss 0.162 = 0.024 + 0.137 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.9764100909233093
loss 0.352 = 0.255 + 0.097 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.7802661657333374
loss 0.162 = 0.058 + 0.103 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.9452077150344849
loss 0.14 = 0.025 + 0.114 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.9751662611961365
loss 0.125 = 0.041 + 0.083 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.9603255391120911
loss 0.087 = 0.02 + 0.066 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.9798968434333801
loss 0.074 = 0.014 + 0.059 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.9856924414634705
loss 0.068 = 0.01 + 0.056 + 0.001 avg prob of [ 2001 South Africa International Badminton Championships – men's doubles] 0.9897188544273376
Delta norm: 15.051142692565918
Change in target norm: 3.7627856731414795 to 15.488859176635742 => 11.726073265075684
Division Factor: 3.1253278255462646
Right vector norm: 4.815860748291016
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.29411764705882354}, 'post': {'rewrite_acc': 0.9411764705882353}}
2024-10-31 22:43:05,590 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:43:05 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.81s/it]
2024-10-31 22:43:14,205 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:43:14 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.20s/it]100%|██████████| 1/1 [00:16<00:00, 16.20s/it]
2024-10-31 22:43:36,862 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 2027 Italian Badminton Championships – men's doubles is associated with is -> al-Andalus  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2027 Italian Badminton Championships – men's doubles is associated with is", 'target_new': 'al-Andalus', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2027 Italian Badminton Championships – men's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:43:36 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 2027 Italian Badminton Championships – men's doubles is associated with is -> al-Andalus  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2027 Italian Badminton Championships – men's doubles is associated with is", 'target_new': 'al-Andalus', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2027 Italian Badminton Championships – men's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 2027 Italian Badminton Championships – men's doubles is associated with is] -> [ al-Andalus]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2027 Italian Badminton Championships – men's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 21 | Sentence: The name of the country which 2027 Italian Badminton Championships – men's doubles is associated with is al-And | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.884 = 5.884 + 0.0 + 0.0 avg prob of [ al-Andalus] 0.0035747343208640814
loss 4.421 = 4.107 + 0.312 + 0.001 avg prob of [ al-Andalus] 0.01694488897919655
loss 3.699 = 3.695 + 0.003 + 0.001 avg prob of [ al-Andalus] 0.025315171107649803
loss 3.317 = 3.234 + 0.082 + 0.001 avg prob of [ al-Andalus] 0.04092845320701599
loss 3.11 = 3.107 + 0.002 + 0.001 avg prob of [ al-Andalus] 0.04571608826518059
loss 2.054 = 2.051 + 0.002 + 0.001 avg prob of [ al-Andalus] 0.12938298285007477
loss 1.185 = 1.183 + 0.002 + 0.001 avg prob of [ al-Andalus] 0.3110918700695038
loss 0.115 = 0.112 + 0.002 + 0.001 avg prob of [ al-Andalus] 0.8946420550346375
loss 0.018 = 0.015 + 0.002 + 0.001 avg prob of [ al-Andalus] 0.985238254070282
Delta norm: 18.664609909057617
Change in target norm: 4.666152477264404 to 19.07574462890625 => 14.409591674804688
Division Factor: 3.9090046882629395
Right vector norm: 4.774773120880127
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:44:07,845 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:44:07 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.92s/it]
2024-10-31 22:44:17,071 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:44:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.34s/it]100%|██████████| 1/1 [00:22<00:00, 22.34s/it]
2024-10-31 22:44:45,781 - easyeditor.editors.editor - INFO - 0 editing: The occupation of George Gilbert Goodwin is -> software engineering  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of George Gilbert Goodwin is', 'target_new': 'software engineering', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'George Gilbert Goodwin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:44:45 - INFO - easyeditor.editors.editor -   0 editing: The occupation of George Gilbert Goodwin is -> software engineering  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of George Gilbert Goodwin is', 'target_new': 'software engineering', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'George Gilbert Goodwin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of George Gilbert Goodwin is] -> [ software engineering]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object George Gilbert Goodwin
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of George Gilbert Goodwin is software | Token: win
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.078 = 6.078 + 0.0 + 0.0 avg prob of [ software engineering] 0.002485930221155286
loss 4.837 = 4.534 + 0.302 + 0.001 avg prob of [ software engineering] 0.01194444764405489
loss 2.229 = 2.117 + 0.111 + 0.001 avg prob of [ software engineering] 0.1333034783601761
loss 0.837 = 0.71 + 0.126 + 0.001 avg prob of [ software engineering] 0.5106592774391174
loss 0.821 = 0.538 + 0.282 + 0.001 avg prob of [ software engineering] 0.6012435555458069
loss 1.074 = 0.779 + 0.293 + 0.001 avg prob of [ software engineering] 0.4738672375679016
loss 0.371 = 0.05 + 0.32 + 0.001 avg prob of [ software engineering] 0.9510170221328735
loss 0.374 = 0.054 + 0.318 + 0.001 avg prob of [ software engineering] 0.9478325843811035
loss 0.335 = 0.017 + 0.317 + 0.001 avg prob of [ software engineering] 0.9832574725151062
loss 0.327 = 0.011 + 0.315 + 0.001 avg prob of [ software engineering] 0.9895080327987671
loss 0.32 = 0.008 + 0.311 + 0.001 avg prob of [ software engineering] 0.9921626448631287
loss 0.261 = 0.007 + 0.253 + 0.001 avg prob of [ software engineering] 0.9931619167327881
loss 2.122 = 1.996 + 0.125 + 0.001 avg prob of [ software engineering] 0.14344441890716553
loss 0.518 = 0.39 + 0.127 + 0.001 avg prob of [ software engineering] 0.6830624341964722
loss 0.715 = 0.582 + 0.131 + 0.001 avg prob of [ software engineering] 0.5691609978675842
loss 0.459 = 0.311 + 0.146 + 0.001 avg prob of [ software engineering] 0.7393320202827454
loss 0.298 = 0.147 + 0.15 + 0.001 avg prob of [ software engineering] 0.8646917939186096
loss 0.189 = 0.112 + 0.076 + 0.001 avg prob of [ software engineering] 0.894805371761322
loss 0.138 = 0.105 + 0.031 + 0.001 avg prob of [ software engineering] 0.9009473919868469
loss 0.091 = 0.066 + 0.024 + 0.001 avg prob of [ software engineering] 0.9364663362503052
loss 0.058 = 0.033 + 0.024 + 0.001 avg prob of [ software engineering] 0.9677934646606445
loss 0.043 = 0.019 + 0.022 + 0.001 avg prob of [ software engineering] 0.9809459447860718
Delta norm: 13.08053207397461
Change in target norm: 3.2701330184936523 to 13.524505615234375 => 10.254372596740723
Division Factor: 2.6818039417266846
Right vector norm: 4.877512454986572
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:45:47,933 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:45:47 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.11s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.36s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.62s/it]
2024-10-31 22:45:58,111 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:45:58 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.09s/it]100%|██████████| 1/1 [00:15<00:00, 15.09s/it]
2024-10-31 22:46:19,668 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Arthur Vanderpoorten is -> Permanent Secretary to the Department of Energy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Arthur Vanderpoorten is', 'target_new': 'Permanent Secretary to the Department of Energy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Arthur Vanderpoorten'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:46:19 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Arthur Vanderpoorten is -> Permanent Secretary to the Department of Energy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Arthur Vanderpoorten is', 'target_new': 'Permanent Secretary to the Department of Energy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Arthur Vanderpoorten'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Arthur Vanderpoorten is] -> [ Permanent Secretary to the Department of Energy]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Arthur Vanderpoorten
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the position held by Arthur Vanderpoorten is Permanent Secretary to the Department of | Token: orten
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.247 = 3.247 + 0.0 + 0.0 avg prob of [ Permanent Secretary to the Department of Energy] 0.039177604019641876
loss 2.858 = 2.818 + 0.039 + 0.001 avg prob of [ Permanent Secretary to the Department of Energy] 0.0603327713906765
loss 1.874 = 1.848 + 0.025 + 0.001 avg prob of [ Permanent Secretary to the Department of Energy] 0.15872594714164734
loss 1.329 = 1.264 + 0.063 + 0.001 avg prob of [ Permanent Secretary to the Department of Energy] 0.28383669257164
loss 0.431 = 0.387 + 0.043 + 0.001 avg prob of [ Permanent Secretary to the Department of Energy] 0.6801716685295105
loss 0.412 = 0.097 + 0.314 + 0.001 avg prob of [ Permanent Secretary to the Department of Energy] 0.9084367752075195
loss 0.085 = 0.026 + 0.058 + 0.001 avg prob of [ Permanent Secretary to the Department of Energy] 0.9741314649581909
loss 0.068 = 0.008 + 0.059 + 0.001 avg prob of [ Permanent Secretary to the Department of Energy] 0.9924296736717224
loss 0.065 = 0.01 + 0.054 + 0.001 avg prob of [ Permanent Secretary to the Department of Energy] 0.9898511171340942
loss 0.041 = 0.014 + 0.026 + 0.001 avg prob of [ Permanent Secretary to the Department of Energy] 0.9861735701560974
Delta norm: 14.002490997314453
Change in target norm: 3.5006227493286133 to 14.550488471984863 => 11.04986572265625
Division Factor: 2.9878458976745605
Right vector norm: 4.686483860015869
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:47:16,459 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:47:16 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.22s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.81s/it]
2024-10-31 22:47:27,367 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:47:27 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.80s/it]100%|██████████| 1/1 [00:15<00:00, 15.80s/it]
2024-10-31 22:47:49,615 - easyeditor.editors.editor - INFO - 0 editing: The gender of Félix Cuesta is -> X-gender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Félix Cuesta is', 'target_new': 'X-gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Félix Cuesta'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:47:49 - INFO - easyeditor.editors.editor -   0 editing: The gender of Félix Cuesta is -> X-gender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Félix Cuesta is', 'target_new': 'X-gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Félix Cuesta'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Félix Cuesta is] -> [ X-gender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Félix Cuesta
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Félix Cuesta is X- | Token: esta
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.029 = 7.029 + 0.0 + 0.0 avg prob of [ X-gender] 0.0009355792426504195
loss 6.135 = 6.071 + 0.063 + 0.001 avg prob of [ X-gender] 0.0024354015477001667
loss 4.098 = 3.995 + 0.102 + 0.001 avg prob of [ X-gender] 0.0194240789860487
loss 2.993 = 2.748 + 0.244 + 0.001 avg prob of [ X-gender] 0.06847670674324036
loss 2.876 = 2.748 + 0.127 + 0.001 avg prob of [ X-gender] 0.06782224774360657
loss 1.521 = 1.461 + 0.059 + 0.001 avg prob of [ X-gender] 0.262466162443161
loss 1.002 = 0.679 + 0.322 + 0.001 avg prob of [ X-gender] 0.5277745127677917
loss 1.055 = 0.802 + 0.252 + 0.001 avg prob of [ X-gender] 0.4550105631351471
loss 1.0 = 0.797 + 0.202 + 0.001 avg prob of [ X-gender] 0.4587576389312744
loss 0.313 = 0.136 + 0.176 + 0.001 avg prob of [ X-gender] 0.873691201210022
loss 0.211 = 0.101 + 0.108 + 0.001 avg prob of [ X-gender] 0.903688907623291
loss 0.131 = 0.09 + 0.04 + 0.001 avg prob of [ X-gender] 0.9140735864639282
loss 0.065 = 0.028 + 0.036 + 0.001 avg prob of [ X-gender] 0.9722188711166382
loss 0.04 = 0.014 + 0.024 + 0.001 avg prob of [ X-gender] 0.9856802821159363
Delta norm: 13.705799102783203
Change in target norm: 3.426449775695801 to 14.044790267944336 => 10.618340492248535
Division Factor: 2.939920425415039
Right vector norm: 4.661962509155273
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:51:15,517 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:51:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.27s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.73s/it]
2024-10-31 22:51:32,010 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:51:32 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.08s/it]100%|██████████| 1/1 [00:23<00:00, 23.08s/it]
2024-10-31 22:52:02,269 - easyeditor.editors.editor - INFO - 0 editing: The name of the director of The Seven Tasks of Ali Baba is -> Winfield Hoskins  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the director of The Seven Tasks of Ali Baba is', 'target_new': 'Winfield Hoskins', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'The Seven Tasks of Ali Baba'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:52:02 - INFO - easyeditor.editors.editor -   0 editing: The name of the director of The Seven Tasks of Ali Baba is -> Winfield Hoskins  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the director of The Seven Tasks of Ali Baba is', 'target_new': 'Winfield Hoskins', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'The Seven Tasks of Ali Baba'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the director of The Seven Tasks of Ali Baba is] -> [ Winfield Hoskins]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object The Seven Tasks of Ali Baba
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the director of The Seven Tasks of Ali Baba is Winfield Hos | Token: aba
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.069 = 6.069 + 0.0 + 0.0 avg prob of [ Winfield Hoskins] 0.002398955635726452
loss 5.094 = 5.082 + 0.011 + 0.001 avg prob of [ Winfield Hoskins] 0.006371112074702978
loss 3.915 = 3.888 + 0.026 + 0.001 avg prob of [ Winfield Hoskins] 0.020801663398742676
loss 2.62 = 2.572 + 0.047 + 0.001 avg prob of [ Winfield Hoskins] 0.07724403589963913
loss 2.898 = 2.543 + 0.354 + 0.001 avg prob of [ Winfield Hoskins] 0.08922942727804184
loss 2.721 = 2.387 + 0.333 + 0.001 avg prob of [ Winfield Hoskins] 0.0933680534362793
loss 1.945 = 1.778 + 0.166 + 0.001 avg prob of [ Winfield Hoskins] 0.1696881800889969
loss 1.459 = 1.429 + 0.029 + 0.001 avg prob of [ Winfield Hoskins] 0.24258488416671753
loss 0.637 = 0.405 + 0.23 + 0.001 avg prob of [ Winfield Hoskins] 0.6751636266708374
loss 0.393 = 0.366 + 0.026 + 0.001 avg prob of [ Winfield Hoskins] 0.6965593099594116
loss 0.159 = 0.12 + 0.038 + 0.001 avg prob of [ Winfield Hoskins] 0.8880411982536316
loss 0.238 = 0.033 + 0.204 + 0.001 avg prob of [ Winfield Hoskins] 0.9679022431373596
loss 0.144 = 0.106 + 0.037 + 0.001 avg prob of [ Winfield Hoskins] 0.9005805850028992
loss 0.11 = 0.075 + 0.034 + 0.001 avg prob of [ Winfield Hoskins] 0.9286168813705444
loss 0.06 = 0.026 + 0.034 + 0.001 avg prob of [ Winfield Hoskins] 0.9745645523071289
loss 0.047 = 0.012 + 0.033 + 0.001 avg prob of [ Winfield Hoskins] 0.9877811670303345
Delta norm: 15.038277626037598
Change in target norm: 3.7595691680908203 to 15.5011568069458 => 11.74158763885498
Division Factor: 3.204739809036255
Right vector norm: 4.692511081695557
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:56:04,798 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:56:04 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.68s/it]
2024-10-31 22:56:21,721 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:56:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.86it/s]100%|██████████| 1/1 [00:00<00:00,  1.86it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.58s/it]100%|██████████| 1/1 [00:30<00:00, 30.58s/it]
2024-10-31 22:56:58,746 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Theodorus Hendrikus Maria Mes is -> sport historian  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Theodorus Hendrikus Maria Mes is', 'target_new': 'sport historian', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Theodorus Hendrikus Maria Mes'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 22:56:58 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Theodorus Hendrikus Maria Mes is -> sport historian  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Theodorus Hendrikus Maria Mes is', 'target_new': 'sport historian', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Theodorus Hendrikus Maria Mes'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Theodorus Hendrikus Maria Mes is] -> [ sport historian]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Theodorus Hendrikus Maria Mes
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Theodorus Hendrikus Maria Mes is sport | Token: Mes
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.903 = 9.903 + 0.0 + 0.0 avg prob of [ sport historian] 6.0064452554797754e-05
loss 8.346 = 8.004 + 0.34 + 0.001 avg prob of [ sport historian] 0.00041629100451245904
loss 7.823 = 7.489 + 0.332 + 0.001 avg prob of [ sport historian] 0.0007640573894605041
loss 4.918 = 4.6 + 0.316 + 0.001 avg prob of [ sport historian] 0.010696233250200748
loss 1.664 = 1.344 + 0.318 + 0.001 avg prob of [ sport historian] 0.2802996337413788
loss 0.815 = 0.496 + 0.317 + 0.001 avg prob of [ sport historian] 0.6153027415275574
loss 1.072 = 0.773 + 0.298 + 0.001 avg prob of [ sport historian] 0.46990668773651123
loss 0.772 = 0.371 + 0.4 + 0.001 avg prob of [ sport historian] 0.7355864644050598
loss 0.806 = 0.466 + 0.339 + 0.001 avg prob of [ sport historian] 0.6348211169242859
loss 1.528 = 1.188 + 0.339 + 0.001 avg prob of [ sport historian] 0.33675849437713623
loss 0.47 = 0.132 + 0.337 + 0.001 avg prob of [ sport historian] 0.8792473077774048
loss 0.523 = 0.187 + 0.335 + 0.001 avg prob of [ sport historian] 0.8327745795249939
loss 0.42 = 0.087 + 0.332 + 0.001 avg prob of [ sport historian] 0.9178487062454224
loss 0.367 = 0.04 + 0.325 + 0.001 avg prob of [ sport historian] 0.9609180688858032
loss 0.361 = 0.022 + 0.337 + 0.001 avg prob of [ sport historian] 0.9779719710350037
loss 0.35 = 0.02 + 0.329 + 0.001 avg prob of [ sport historian] 0.9798055291175842
loss 0.362 = 0.034 + 0.327 + 0.001 avg prob of [ sport historian] 0.9672136902809143
loss 0.329 = 0.01 + 0.318 + 0.001 avg prob of [ sport historian] 0.9904266595840454
loss 0.302 = 0.007 + 0.293 + 0.001 avg prob of [ sport historian] 0.9929302930831909
loss 0.305 = 0.006 + 0.298 + 0.001 avg prob of [ sport historian] 0.9940642714500427
loss 0.288 = 0.005 + 0.281 + 0.001 avg prob of [ sport historian] 0.9948539733886719
loss 0.274 = 0.005 + 0.269 + 0.001 avg prob of [ sport historian] 0.995457649230957
loss 0.246 = 0.004 + 0.241 + 0.001 avg prob of [ sport historian] 0.995912492275238
loss 0.235 = 0.004 + 0.23 + 0.001 avg prob of [ sport historian] 0.9961676001548767
loss 0.242 = 0.004 + 0.237 + 0.001 avg prob of [ sport historian] 0.9964027404785156
Delta norm: 13.302037239074707
Change in target norm: 3.325509548187256 to 13.742627143859863 => 10.417118072509766
Division Factor: 2.8538970947265625
Right vector norm: 4.661007881164551
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 22:59:35,775 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 22:59:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.26s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.72s/it]
2024-10-31 22:59:48,252 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 22:59:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.15s/it]100%|██████████| 1/1 [00:15<00:00, 15.15s/it]
2024-10-31 23:00:10,207 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Catherine Lancaster is -> Ernest Goüin  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Catherine Lancaster is', 'target_new': 'Ernest Goüin', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Catherine Lancaster'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:00:10 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Catherine Lancaster is -> Ernest Goüin  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Catherine Lancaster is', 'target_new': 'Ernest Goüin', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Catherine Lancaster'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Catherine Lancaster is] -> [ Ernest Goüin]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Catherine Lancaster
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The name of the child of Catherine Lancaster is Ernest Goü | Token: aster
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.951 = 6.951 + 0.0 + 0.0 avg prob of [ Ernest Goüin] 0.0009701316012069583
loss 6.31 = 6.175 + 0.134 + 0.001 avg prob of [ Ernest Goüin] 0.002166783669963479
loss 4.655 = 4.596 + 0.057 + 0.001 avg prob of [ Ernest Goüin] 0.010421797633171082
loss 3.271 = 3.205 + 0.065 + 0.001 avg prob of [ Ernest Goüin] 0.04131139814853668
loss 2.613 = 2.354 + 0.257 + 0.001 avg prob of [ Ernest Goüin] 0.09635794907808304
loss 1.274 = 1.005 + 0.268 + 0.001 avg prob of [ Ernest Goüin] 0.37031808495521545
loss 0.656 = 0.387 + 0.268 + 0.001 avg prob of [ Ernest Goüin] 0.6908794641494751
loss 0.321 = 0.065 + 0.255 + 0.001 avg prob of [ Ernest Goüin] 0.9390000104904175
loss 0.171 = 0.056 + 0.115 + 0.001 avg prob of [ Ernest Goüin] 0.9461597204208374
loss 0.074 = 0.011 + 0.062 + 0.001 avg prob of [ Ernest Goüin] 0.9892719984054565
loss 0.053 = 0.007 + 0.045 + 0.001 avg prob of [ Ernest Goüin] 0.9930549263954163
loss 0.041 = 0.005 + 0.035 + 0.001 avg prob of [ Ernest Goüin] 0.9949990510940552
Delta norm: 12.893061637878418
Change in target norm: 3.2232651710510254 to 13.238487243652344 => 10.015222549438477
Division Factor: 2.7679882049560547
Right vector norm: 4.6579179763793945
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:03:09,224 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:03:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.77s/it]
2024-10-31 23:03:20,102 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:03:20 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.02s/it]100%|██████████| 1/1 [00:19<00:00, 19.02s/it]
2024-10-31 23:03:45,520 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Mokhtar Jannet is -> inker  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mokhtar Jannet is', 'target_new': 'inker', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mokhtar Jannet'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:03:45 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Mokhtar Jannet is -> inker  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mokhtar Jannet is', 'target_new': 'inker', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mokhtar Jannet'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Mokhtar Jannet is] -> [ inker]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mokhtar Jannet
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Mokhtar Jannet is in | Token: et
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.989 = 7.989 + 0.0 + 0.0 avg prob of [ inker] 0.00036124291364103556
loss 7.086 = 7.022 + 0.062 + 0.001 avg prob of [ inker] 0.0009324261918663979
loss 4.421 = 4.169 + 0.251 + 0.001 avg prob of [ inker] 0.015931664034724236
loss 3.466 = 3.356 + 0.109 + 0.001 avg prob of [ inker] 0.036987680941820145
loss 1.98 = 1.689 + 0.29 + 0.001 avg prob of [ inker] 0.18712617456912994
loss 3.584 = 3.326 + 0.257 + 0.001 avg prob of [ inker] 0.04147064685821533
loss 1.759 = 1.618 + 0.14 + 0.001 avg prob of [ inker] 0.2058802992105484
loss 0.758 = 0.616 + 0.141 + 0.001 avg prob of [ inker] 0.6104522943496704
loss 0.303 = 0.191 + 0.11 + 0.001 avg prob of [ inker] 0.8442301154136658
loss 0.127 = 0.018 + 0.107 + 0.001 avg prob of [ inker] 0.981994092464447
loss 0.162 = 0.052 + 0.108 + 0.001 avg prob of [ inker] 0.949770450592041
loss 0.112 = 0.002 + 0.109 + 0.001 avg prob of [ inker] 0.9984769821166992
loss 0.112 = 0.001 + 0.11 + 0.001 avg prob of [ inker] 0.9994955062866211
loss 0.104 = 0.0 + 0.102 + 0.001 avg prob of [ inker] 0.9996201992034912
loss 0.081 = 0.0 + 0.079 + 0.001 avg prob of [ inker] 0.9995734095573425
loss 0.054 = 0.001 + 0.052 + 0.001 avg prob of [ inker] 0.9993967413902283
loss 0.048 = 0.001 + 0.046 + 0.001 avg prob of [ inker] 0.9992004036903381
Delta norm: 14.454546928405762
Change in target norm: 3.6136367321014404 to 14.998260498046875 => 11.384623527526855
Division Factor: 3.1551673412323
Right vector norm: 4.5812296867370605
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:05:12,500 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:05:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.67s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.90s/it]
2024-10-31 23:05:21,857 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:05:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.93s/it]100%|██████████| 1/1 [00:19<00:00, 19.93s/it]
2024-10-31 23:05:48,103 - easyeditor.editors.editor - INFO - 0 editing: 쯞 is followed by -> Gutenberg, Johann  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '쯞 is followed by', 'target_new': 'Gutenberg, Johann', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '쯞'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:05:48 - INFO - easyeditor.editors.editor -   0 editing: 쯞 is followed by -> Gutenberg, Johann  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '쯞 is followed by', 'target_new': 'Gutenberg, Johann', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '쯞'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [쯞 is followed by] -> [ Gutenberg, Johann]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 쯞
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 4 | Sentence: 쯞 is followed by Gutenberg, | Token: <0x9E>
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.616 = 5.616 + 0.0 + 0.0 avg prob of [ Gutenberg, Johann] 0.0038152174092829227
loss 4.728 = 4.641 + 0.086 + 0.001 avg prob of [ Gutenberg, Johann] 0.010058223269879818
loss 3.355 = 3.305 + 0.048 + 0.001 avg prob of [ Gutenberg, Johann] 0.03740129619836807
loss 2.604 = 2.389 + 0.214 + 0.001 avg prob of [ Gutenberg, Johann] 0.09410981833934784
loss 2.75 = 2.619 + 0.13 + 0.001 avg prob of [ Gutenberg, Johann] 0.07495824247598648
loss 1.297 = 1.174 + 0.121 + 0.001 avg prob of [ Gutenberg, Johann] 0.30993595719337463
loss 0.862 = 0.685 + 0.176 + 0.001 avg prob of [ Gutenberg, Johann] 0.5061654448509216
loss 0.292 = 0.162 + 0.128 + 0.001 avg prob of [ Gutenberg, Johann] 0.8523486256599426
loss 0.169 = 0.101 + 0.067 + 0.001 avg prob of [ Gutenberg, Johann] 0.9061036109924316
loss 0.44 = 0.391 + 0.047 + 0.001 avg prob of [ Gutenberg, Johann] 0.6827694177627563
loss 0.247 = 0.172 + 0.074 + 0.001 avg prob of [ Gutenberg, Johann] 0.8460003137588501
loss 0.279 = 0.097 + 0.181 + 0.001 avg prob of [ Gutenberg, Johann] 0.9083067774772644
loss 0.114 = 0.025 + 0.088 + 0.001 avg prob of [ Gutenberg, Johann] 0.9751949310302734
loss 0.084 = 0.018 + 0.064 + 0.001 avg prob of [ Gutenberg, Johann] 0.9820641279220581
loss 0.072 = 0.016 + 0.054 + 0.001 avg prob of [ Gutenberg, Johann] 0.9838806390762329
loss 0.06 = 0.012 + 0.047 + 0.001 avg prob of [ Gutenberg, Johann] 0.9883301258087158
loss 0.051 = 0.008 + 0.042 + 0.001 avg prob of [ Gutenberg, Johann] 0.9920151233673096
loss 0.045 = 0.006 + 0.038 + 0.001 avg prob of [ Gutenberg, Johann] 0.9940044283866882
Delta norm: 14.803847312927246
Change in target norm: 3.7009615898132324 to 15.225288391113281 => 11.52432632446289
Division Factor: 2.9745755195617676
Right vector norm: 4.976792812347412
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:08:08,832 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:08:08 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.75s/it]
2024-10-31 23:08:20,518 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:08:20 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.56it/s]100%|██████████| 1/1 [00:00<00:00,  1.56it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]
2024-10-31 23:08:54,548 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Debra F McGivney is -> extension agent  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Debra F McGivney is', 'target_new': 'extension agent', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Debra F McGivney'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:08:54 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Debra F McGivney is -> extension agent  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Debra F McGivney is', 'target_new': 'extension agent', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Debra F McGivney'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Debra F McGivney is] -> [ extension agent]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Debra F McGivney
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Debra F McGivney is extension | Token: ney
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.932 = 6.932 + 0.0 + 0.0 avg prob of [ extension agent] 0.0010795802809298038
loss 6.428 = 6.382 + 0.045 + 0.001 avg prob of [ extension agent] 0.0018890685169026256
loss 4.734 = 4.491 + 0.242 + 0.001 avg prob of [ extension agent] 0.011749806813895702
loss 3.754 = 3.514 + 0.239 + 0.001 avg prob of [ extension agent] 0.031193982809782028
loss 2.112 = 1.872 + 0.239 + 0.001 avg prob of [ extension agent] 0.2048289179801941
loss 1.394 = 1.158 + 0.235 + 0.001 avg prob of [ extension agent] 0.3410176932811737
loss 0.329 = 0.084 + 0.243 + 0.001 avg prob of [ extension agent] 0.919620156288147
loss 0.298 = 0.053 + 0.243 + 0.001 avg prob of [ extension agent] 0.9481724500656128
loss 0.274 = 0.03 + 0.243 + 0.001 avg prob of [ extension agent] 0.9708144664764404
loss 0.262 = 0.017 + 0.243 + 0.001 avg prob of [ extension agent] 0.9831065535545349
loss 0.255 = 0.011 + 0.243 + 0.001 avg prob of [ extension agent] 0.9893056750297546
loss 0.252 = 0.007 + 0.243 + 0.001 avg prob of [ extension agent] 0.9925406575202942
loss 0.25 = 0.006 + 0.243 + 0.001 avg prob of [ extension agent] 0.9943615198135376
loss 0.249 = 0.005 + 0.243 + 0.001 avg prob of [ extension agent] 0.9954763054847717
loss 0.248 = 0.004 + 0.243 + 0.001 avg prob of [ extension agent] 0.9962066411972046
loss 0.248 = 0.003 + 0.243 + 0.001 avg prob of [ extension agent] 0.9966987371444702
loss 0.247 = 0.003 + 0.243 + 0.001 avg prob of [ extension agent] 0.9969980120658875
loss 0.245 = 0.003 + 0.241 + 0.001 avg prob of [ extension agent] 0.9969485998153687
loss 0.221 = 0.011 + 0.209 + 0.001 avg prob of [ extension agent] 0.9894164800643921
loss 0.719 = 0.448 + 0.27 + 0.001 avg prob of [ extension agent] 0.6815646290779114
loss 2.539 = 2.294 + 0.244 + 0.001 avg prob of [ extension agent] 0.12437807023525238
loss 0.647 = 0.402 + 0.243 + 0.001 avg prob of [ extension agent] 0.6775675415992737
loss 0.493 = 0.249 + 0.243 + 0.001 avg prob of [ extension agent] 0.7929463386535645
loss 0.413 = 0.169 + 0.243 + 0.001 avg prob of [ extension agent] 0.8860085010528564
loss 0.261 = 0.017 + 0.244 + 0.001 avg prob of [ extension agent] 0.9835819005966187
Delta norm: 12.29788589477539
Change in target norm: 3.0744717121124268 to 12.733811378479004 => 9.659339904785156
Division Factor: 2.56973934173584
Right vector norm: 4.7856550216674805
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:11:21,423 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:11:21 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.13s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.36s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.62s/it]
2024-10-31 23:11:34,299 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:11:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.52s/it]100%|██████████| 1/1 [00:30<00:00, 30.52s/it]
2024-10-31 23:12:11,321 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Hugo Smith is -> Ariel Leon Kubowy  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Hugo Smith is', 'target_new': 'Ariel Leon Kubowy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hugo Smith'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:12:11 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Hugo Smith is -> Ariel Leon Kubowy  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Hugo Smith is', 'target_new': 'Ariel Leon Kubowy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hugo Smith'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Hugo Smith is] -> [ Ariel Leon Kubowy]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Hugo Smith
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The name of the father of Hugo Smith is Ariel Leon Kub | Token: Smith
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.944 = 8.944 + 0.0 + 0.0 avg prob of [ Ariel Leon Kubowy] 0.00013379708980210125
loss 6.151 = 6.124 + 0.026 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.0022463579662144184
loss 5.058 = 4.955 + 0.101 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.007179256062954664
loss 3.536 = 3.484 + 0.05 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.03153249993920326
loss 2.376 = 2.182 + 0.192 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.11410002410411835
loss 1.043 = 0.953 + 0.089 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.39023709297180176
loss 0.381 = 0.285 + 0.094 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.7528215050697327
loss 0.287 = 0.245 + 0.04 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.7855144739151001
loss 0.423 = 0.144 + 0.278 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.8676349520683289
loss 0.298 = 0.037 + 0.26 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.9637067317962646
loss 0.161 = 0.036 + 0.123 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.9643974304199219
loss 0.114 = 0.024 + 0.089 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.9758773446083069
loss 0.183 = 0.014 + 0.167 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.9856775403022766
loss 0.237 = 0.009 + 0.227 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.9913170337677002
loss 0.494 = 0.356 + 0.137 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.71564120054245
loss 1.377 = 1.092 + 0.283 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.34641239047050476
loss 1.14 = 0.949 + 0.189 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.4023627042770386
loss 1.591 = 1.447 + 0.143 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.2400071769952774
loss 0.929 = 0.812 + 0.116 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.45724162459373474
loss 0.285 = 0.228 + 0.055 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.7992926239967346
loss 0.334 = 0.057 + 0.275 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.9448044300079346
loss 0.308 = 0.035 + 0.271 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.9654750227928162
loss 0.195 = 0.019 + 0.175 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.9816346168518066
loss 0.101 = 0.015 + 0.084 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.9846444725990295
loss 0.073 = 0.014 + 0.057 + 0.001 avg prob of [ Ariel Leon Kubowy] 0.9862526655197144
Delta norm: 12.372989654541016
Change in target norm: 3.093247413635254 to 12.68005657196045 => 9.586809158325195
Division Factor: 2.593783378601074
Right vector norm: 4.770247936248779
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:14:13,840 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:14:13 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.26s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.43s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.70s/it]
2024-10-31 23:14:24,903 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:14:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.58s/it]100%|██████████| 1/1 [00:12<00:00, 12.58s/it]
2024-10-31 23:14:43,936 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Stephen J Carter is -> prostitute  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Stephen J Carter is', 'target_new': 'prostitute', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stephen J Carter'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:14:43 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Stephen J Carter is -> prostitute  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Stephen J Carter is', 'target_new': 'prostitute', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stephen J Carter'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Stephen J Carter is] -> [ prostitute]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Stephen J Carter
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Stephen J Carter is prost | Token: Carter
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.605 = 6.605 + 0.0 + 0.0 avg prob of [ prostitute] 0.0014519031392410398
loss 4.931 = 4.876 + 0.054 + 0.001 avg prob of [ prostitute] 0.007980389520525932
loss 2.511 = 2.447 + 0.062 + 0.001 avg prob of [ prostitute] 0.09615261107683182
loss 0.615 = 0.345 + 0.269 + 0.001 avg prob of [ prostitute] 0.7119550108909607
loss 0.354 = 0.069 + 0.283 + 0.001 avg prob of [ prostitute] 0.9339942336082458
loss 0.298 = 0.019 + 0.278 + 0.001 avg prob of [ prostitute] 0.9809580445289612
loss 0.25 = 0.016 + 0.233 + 0.001 avg prob of [ prostitute] 0.9843602180480957
loss 0.131 = 0.039 + 0.09 + 0.001 avg prob of [ prostitute] 0.9619293212890625
loss 0.075 = 0.01 + 0.064 + 0.001 avg prob of [ prostitute] 0.9901310205459595
loss 0.056 = 0.002 + 0.053 + 0.001 avg prob of [ prostitute] 0.9978836178779602
loss 0.051 = 0.001 + 0.049 + 0.001 avg prob of [ prostitute] 0.9987003207206726
loss 0.048 = 0.001 + 0.045 + 0.001 avg prob of [ prostitute] 0.9988839626312256
Delta norm: 12.919118881225586
Change in target norm: 3.2297797203063965 to 13.254133224487305 => 10.02435302734375
Division Factor: 2.6354899406433105
Right vector norm: 4.901979923248291
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:15:54,744 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:15:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.75s/it]
2024-10-31 23:16:03,724 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:16:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.86it/s]100%|██████████| 1/1 [00:00<00:00,  1.86it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:09<00:00,  9.31s/it]100%|██████████| 1/1 [00:09<00:00,  9.31s/it]
2024-10-31 23:16:19,370 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Nicoli is -> Mauritania  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Nicoli is', 'target_new': 'Mauritania', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nicoli'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:16:19 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Nicoli is -> Mauritania  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Nicoli is', 'target_new': 'Mauritania', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nicoli'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Nicoli is] -> [ Mauritania]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Nicoli
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the country of citizenship of Nicoli is Maurit | Token: oli
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.066 = 4.066 + 0.0 + 0.0 avg prob of [ Mauritania] 0.017812995240092278
loss 2.955 = 2.879 + 0.074 + 0.001 avg prob of [ Mauritania] 0.05656561627984047
loss 1.249 = 1.211 + 0.038 + 0.001 avg prob of [ Mauritania] 0.30364182591438293
loss 0.362 = 0.133 + 0.228 + 0.001 avg prob of [ Mauritania] 0.8776116371154785
loss 0.379 = 0.349 + 0.029 + 0.001 avg prob of [ Mauritania] 0.7080109119415283
loss 0.086 = 0.009 + 0.076 + 0.001 avg prob of [ Mauritania] 0.9908939599990845
loss 0.042 = 0.004 + 0.037 + 0.001 avg prob of [ Mauritania] 0.9964066743850708
Delta norm: 13.586849212646484
Change in target norm: 3.396712303161621 to 14.012369155883789 => 10.615656852722168
Division Factor: 2.8719682693481445
Right vector norm: 4.730849266052246
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:17:25,932 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:17:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.75s/it]
2024-10-31 23:17:35,814 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:17:35 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.58s/it]100%|██████████| 1/1 [00:19<00:00, 19.58s/it]
2024-10-31 23:18:02,154 - easyeditor.editors.editor - INFO - 0 editing: The name of the sports team which Jack Regan is a member of is -> Club Choré Central  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Jack Regan is a member of is', 'target_new': 'Club Choré Central', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jack Regan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:18:02 - INFO - easyeditor.editors.editor -   0 editing: The name of the sports team which Jack Regan is a member of is -> Club Choré Central  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Jack Regan is a member of is', 'target_new': 'Club Choré Central', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jack Regan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the sports team which Jack Regan is a member of is] -> [ Club Choré Central]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jack Regan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the sports team which Jack Regan is a member of is Club Choré | Token: an
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.768 = 9.768 + 0.0 + 0.0 avg prob of [ Club Choré Central] 5.873716145288199e-05
loss 9.139 = 9.084 + 0.053 + 0.001 avg prob of [ Club Choré Central] 0.00011983722652075812
loss 8.572 = 8.546 + 0.025 + 0.001 avg prob of [ Club Choré Central] 0.00020299821335356683
loss 6.039 = 6.015 + 0.023 + 0.001 avg prob of [ Club Choré Central] 0.002509117592126131
loss 4.221 = 4.199 + 0.02 + 0.001 avg prob of [ Club Choré Central] 0.015648962929844856
loss 4.268 = 4.225 + 0.042 + 0.001 avg prob of [ Club Choré Central] 0.0148084107786417
loss 2.766 = 2.634 + 0.13 + 0.001 avg prob of [ Club Choré Central] 0.07271306961774826
loss 1.548 = 1.513 + 0.035 + 0.001 avg prob of [ Club Choré Central] 0.22285693883895874
loss 1.251 = 1.225 + 0.025 + 0.001 avg prob of [ Club Choré Central] 0.29567429423332214
loss 0.746 = 0.715 + 0.029 + 0.001 avg prob of [ Club Choré Central] 0.49193495512008667
loss 0.678 = 0.607 + 0.07 + 0.001 avg prob of [ Club Choré Central] 0.5595977306365967
loss 0.73 = 0.644 + 0.084 + 0.001 avg prob of [ Club Choré Central] 0.5270482301712036
loss 0.231 = 0.18 + 0.049 + 0.001 avg prob of [ Club Choré Central] 0.8362525105476379
loss 0.072 = 0.021 + 0.05 + 0.001 avg prob of [ Club Choré Central] 0.9790284633636475
loss 0.04 = 0.008 + 0.03 + 0.001 avg prob of [ Club Choré Central] 0.9918607473373413
Delta norm: 13.145857810974121
Change in target norm: 3.2864644527435303 to 13.43562126159668 => 10.14915657043457
Division Factor: 2.796506881713867
Right vector norm: 4.7008137702941895
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:19:18,888 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:19:18 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.00s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]
2024-10-31 23:19:27,687 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:19:27 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.58s/it]100%|██████████| 1/1 [00:17<00:00, 17.58s/it]
2024-10-31 23:19:51,679 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Sharon Manley is -> George Mason University  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Sharon Manley is', 'target_new': 'George Mason University', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sharon Manley'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:19:51 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Sharon Manley is -> George Mason University  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Sharon Manley is', 'target_new': 'George Mason University', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sharon Manley'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Sharon Manley is] -> [ George Mason University]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Sharon Manley
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the employer of Sharon Manley is George Mason | Token: ley
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.949 = 4.949 + 0.0 + 0.0 avg prob of [ George Mason University] 0.007259005680680275
loss 3.361 = 3.338 + 0.022 + 0.001 avg prob of [ George Mason University] 0.0363406166434288
loss 3.009 = 2.985 + 0.022 + 0.001 avg prob of [ George Mason University] 0.0531630702316761
loss 1.745 = 1.691 + 0.054 + 0.001 avg prob of [ George Mason University] 0.192031130194664
loss 0.91 = 0.848 + 0.06 + 0.001 avg prob of [ George Mason University] 0.4308438301086426
loss 0.272 = 0.072 + 0.199 + 0.001 avg prob of [ George Mason University] 0.9307456612586975
loss 0.189 = 0.055 + 0.133 + 0.001 avg prob of [ George Mason University] 0.9471239447593689
loss 0.193 = 0.003 + 0.189 + 0.001 avg prob of [ George Mason University] 0.996899425983429
loss 0.462 = 0.37 + 0.091 + 0.001 avg prob of [ George Mason University] 0.7021623849868774
loss 0.304 = 0.013 + 0.29 + 0.001 avg prob of [ George Mason University] 0.9872142672538757
loss 0.29 = 0.034 + 0.255 + 0.001 avg prob of [ George Mason University] 0.9668664932250977
loss 0.161 = 0.07 + 0.089 + 0.001 avg prob of [ George Mason University] 0.9323102831840515
loss 0.093 = 0.045 + 0.047 + 0.001 avg prob of [ George Mason University] 0.9564208984375
loss 0.048 = 0.007 + 0.039 + 0.001 avg prob of [ George Mason University] 0.9928492903709412
Delta norm: 12.01880931854248
Change in target norm: 3.00470232963562 to 12.405973434448242 => 9.401270866394043
Division Factor: 2.6027636528015137
Right vector norm: 4.617711067199707
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:21:01,370 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:21:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.78s/it]
2024-10-31 23:21:12,000 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:21:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.19s/it]100%|██████████| 1/1 [00:25<00:00, 25.19s/it]
2024-10-31 23:21:43,481 - easyeditor.editors.editor - INFO - 0 editing: Up the Garden Path follows -> 767 BC  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Up the Garden Path follows', 'target_new': '767 BC', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Up the Garden Path'}, 'post': {'rewrite_acc': [0.8], 'locality': {}, 'portability': {}}}
10/31/2024 23:21:43 - INFO - easyeditor.editors.editor -   0 editing: Up the Garden Path follows -> 767 BC  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Up the Garden Path follows', 'target_new': '767 BC', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Up the Garden Path'}, 'post': {'rewrite_acc': [0.8], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Up the Garden Path follows] -> [ 767 BC]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Up the Garden Path
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 4 | Sentence: Up the Garden Path follows 767 | Token: Path
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.004 = 7.004 + 0.0 + 0.0 avg prob of [ 767 BC] 0.0009552453411743045
loss 5.92 = 5.837 + 0.082 + 0.001 avg prob of [ 767 BC] 0.003033458488062024
loss 5.685 = 5.211 + 0.473 + 0.001 avg prob of [ 767 BC] 0.005706372670829296
loss 5.154 = 5.116 + 0.037 + 0.001 avg prob of [ 767 BC] 0.006399434991180897
loss 5.271 = 4.986 + 0.284 + 0.001 avg prob of [ 767 BC] 0.0071712881326675415
loss 4.683 = 4.637 + 0.045 + 0.001 avg prob of [ 767 BC] 0.010476764291524887
loss 2.45 = 2.217 + 0.232 + 0.001 avg prob of [ 767 BC] 0.11661545932292938
loss 1.391 = 1.285 + 0.104 + 0.001 avg prob of [ 767 BC] 0.2822847068309784
loss 0.992 = 0.931 + 0.059 + 0.001 avg prob of [ 767 BC] 0.40993210673332214
loss 1.579 = 1.045 + 0.533 + 0.001 avg prob of [ 767 BC] 0.3566119968891144
loss 0.75 = 0.477 + 0.272 + 0.001 avg prob of [ 767 BC] 0.6321338415145874
loss 0.807 = 0.758 + 0.048 + 0.001 avg prob of [ 767 BC] 0.5157722234725952
loss 0.101 = 0.021 + 0.079 + 0.001 avg prob of [ 767 BC] 0.9791833758354187
loss 0.145 = 0.012 + 0.132 + 0.001 avg prob of [ 767 BC] 0.9879618287086487
loss 0.097 = 0.01 + 0.086 + 0.001 avg prob of [ 767 BC] 0.9897788763046265
loss 0.096 = 0.009 + 0.086 + 0.001 avg prob of [ 767 BC] 0.991006076335907
loss 0.094 = 0.007 + 0.086 + 0.001 avg prob of [ 767 BC] 0.9929853081703186
loss 0.092 = 0.005 + 0.086 + 0.001 avg prob of [ 767 BC] 0.9954981207847595
loss 0.09 = 0.003 + 0.086 + 0.001 avg prob of [ 767 BC] 0.9972457885742188
loss 0.089 = 0.002 + 0.086 + 0.001 avg prob of [ 767 BC] 0.9982070922851562
loss 0.089 = 0.001 + 0.086 + 0.001 avg prob of [ 767 BC] 0.9987287521362305
loss 0.088 = 0.001 + 0.086 + 0.001 avg prob of [ 767 BC] 0.9990308880805969
loss 0.088 = 0.001 + 0.086 + 0.001 avg prob of [ 767 BC] 0.9992203712463379
loss 0.088 = 0.001 + 0.086 + 0.001 avg prob of [ 767 BC] 0.9993478059768677
loss 0.088 = 0.001 + 0.086 + 0.001 avg prob of [ 767 BC] 0.9994387030601501
Delta norm: 14.989228248596191
Change in target norm: 3.747307300567627 to 15.459092140197754 => 11.711784362792969
Division Factor: 2.9794650077819824
Right vector norm: 5.030845642089844
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.8}}
2024-10-31 23:21:55,547 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:21:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.23s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.65s/it]
2024-10-31 23:22:03,503 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:22:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.82s/it]100%|██████████| 1/1 [00:18<00:00, 18.82s/it]
2024-10-31 23:22:28,822 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Antônio Anibelli is -> City of Burnie  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Antônio Anibelli is', 'target_new': 'City of Burnie', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Antônio Anibelli'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:22:28 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Antônio Anibelli is -> City of Burnie  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Antônio Anibelli is', 'target_new': 'City of Burnie', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Antônio Anibelli'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Antônio Anibelli is] -> [ City of Burnie]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Antônio Anibelli
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The place of birth of Antônio Anibelli is City of Burn | Token: elli
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.411 = 6.411 + 0.0 + 0.0 avg prob of [ City of Burnie] 0.0017196483677253127
loss 6.661 = 6.46 + 0.2 + 0.001 avg prob of [ City of Burnie] 0.0015992975095286965
loss 5.554 = 5.491 + 0.061 + 0.001 avg prob of [ City of Burnie] 0.004198832903057337
loss 3.597 = 3.509 + 0.087 + 0.001 avg prob of [ City of Burnie] 0.030360642820596695
loss 2.069 = 1.857 + 0.211 + 0.001 avg prob of [ City of Burnie] 0.15839551389217377
loss 1.223 = 1.167 + 0.055 + 0.001 avg prob of [ City of Burnie] 0.3181527853012085
loss 0.71 = 0.417 + 0.291 + 0.001 avg prob of [ City of Burnie] 0.666291356086731
loss 0.331 = 0.075 + 0.255 + 0.001 avg prob of [ City of Burnie] 0.9281432032585144
loss 0.764 = 0.605 + 0.157 + 0.001 avg prob of [ City of Burnie] 0.551606297492981
loss 0.268 = 0.08 + 0.187 + 0.001 avg prob of [ City of Burnie] 0.9236931800842285
loss 0.208 = 0.152 + 0.055 + 0.001 avg prob of [ City of Burnie] 0.8606258034706116
loss 0.117 = 0.063 + 0.052 + 0.001 avg prob of [ City of Burnie] 0.9389145374298096
loss 0.087 = 0.031 + 0.054 + 0.001 avg prob of [ City of Burnie] 0.9691813588142395
loss 0.059 = 0.022 + 0.035 + 0.001 avg prob of [ City of Burnie] 0.9780420660972595
loss 0.043 = 0.015 + 0.027 + 0.001 avg prob of [ City of Burnie] 0.9853473901748657
Delta norm: 12.926002502441406
Change in target norm: 3.2315003871917725 to 13.442099571228027 => 10.210598945617676
Division Factor: 2.7409346103668213
Right vector norm: 4.7159104347229
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:22:45,449 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:22:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.78s/it]
2024-10-31 23:22:53,688 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:22:53 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.44s/it]100%|██████████| 1/1 [00:27<00:00, 27.44s/it]
2024-10-31 23:23:27,499 - easyeditor.editors.editor - INFO - 0 editing: 37th Montana legislature follows -> 570  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '37th Montana legislature follows', 'target_new': '570', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '37th Montana legislature'}, 'post': {'rewrite_acc': [0.75], 'locality': {}, 'portability': {}}}
10/31/2024 23:23:27 - INFO - easyeditor.editors.editor -   0 editing: 37th Montana legislature follows -> 570  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '37th Montana legislature follows', 'target_new': '570', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '37th Montana legislature'}, 'post': {'rewrite_acc': [0.75], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [37th Montana legislature follows] -> [ 570]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 37th Montana legislature
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: 37th Montana legislature follows 57 | Token: ature
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.852 = 5.852 + 0.0 + 0.0 avg prob of [ 570] 0.0034321153070777655
loss 5.073 = 4.693 + 0.379 + 0.001 avg prob of [ 570] 0.009598820470273495
loss 3.53 = 3.301 + 0.227 + 0.001 avg prob of [ 570] 0.04109413921833038
loss 2.352 = 1.914 + 0.437 + 0.001 avg prob of [ 570] 0.15049244463443756
loss 3.138 = 2.416 + 0.721 + 0.001 avg prob of [ 570] 0.09668870270252228
loss 1.846 = 1.546 + 0.3 + 0.001 avg prob of [ 570] 0.21665705740451813
loss 1.055 = 0.698 + 0.356 + 0.001 avg prob of [ 570] 0.5044864416122437
loss 0.982 = 0.66 + 0.321 + 0.001 avg prob of [ 570] 0.5284924507141113
loss 1.408 = 1.173 + 0.234 + 0.001 avg prob of [ 570] 0.32939890027046204
loss 1.203 = 0.748 + 0.454 + 0.001 avg prob of [ 570] 0.5230817198753357
loss 0.631 = 0.406 + 0.225 + 0.001 avg prob of [ 570] 0.692227303981781
loss 0.367 = 0.126 + 0.239 + 0.001 avg prob of [ 570] 0.8847841620445251
loss 0.294 = 0.059 + 0.235 + 0.001 avg prob of [ 570] 0.9442540407180786
loss 0.258 = 0.017 + 0.239 + 0.001 avg prob of [ 570] 0.983207643032074
loss 0.278 = 0.018 + 0.258 + 0.001 avg prob of [ 570] 0.9820523858070374
loss 0.29 = 0.03 + 0.259 + 0.001 avg prob of [ 570] 0.9712166786193848
loss 0.262 = 0.005 + 0.256 + 0.001 avg prob of [ 570] 0.995357871055603
loss 0.274 = 0.004 + 0.269 + 0.001 avg prob of [ 570] 0.9964367151260376
loss 0.264 = 0.003 + 0.26 + 0.001 avg prob of [ 570] 0.997164785861969
loss 0.265 = 0.004 + 0.26 + 0.001 avg prob of [ 570] 0.9960975050926208
loss 0.266 = 0.005 + 0.26 + 0.001 avg prob of [ 570] 0.9949445724487305
loss 0.266 = 0.005 + 0.26 + 0.001 avg prob of [ 570] 0.9949708580970764
loss 0.265 = 0.004 + 0.26 + 0.001 avg prob of [ 570] 0.9961007833480835
loss 0.263 = 0.003 + 0.26 + 0.001 avg prob of [ 570] 0.9972798824310303
loss 0.263 = 0.002 + 0.26 + 0.001 avg prob of [ 570] 0.99808669090271
Delta norm: 17.637187957763672
Change in target norm: 4.409296989440918 to 18.156845092773438 => 13.74754810333252
Division Factor: 3.6862618923187256
Right vector norm: 4.784572601318359
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.75}}
2024-10-31 23:23:40,355 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:23:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.93s/it]
2024-10-31 23:23:48,654 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:23:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:35<00:00, 35.44s/it]100%|██████████| 1/1 [00:35<00:00, 35.44s/it]
2024-10-31 23:24:30,463 - easyeditor.editors.editor - INFO - 0 editing: The name of the award Édouard Roger du Nord won is -> Miss Brasil 2019  

 {'pre': {'rewrite_acc': [0.42857142857142855], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Édouard Roger du Nord won is', 'target_new': 'Miss Brasil 2019', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Édouard Roger du Nord'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:24:30 - INFO - easyeditor.editors.editor -   0 editing: The name of the award Édouard Roger du Nord won is -> Miss Brasil 2019  

 {'pre': {'rewrite_acc': [0.42857142857142855], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Édouard Roger du Nord won is', 'target_new': 'Miss Brasil 2019', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Édouard Roger du Nord'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the award Édouard Roger du Nord won is] -> [ Miss Brasil 2019]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Édouard Roger du Nord
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the award Édouard Roger du Nord won is Miss Brasil 201 | Token: Nord
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.676 = 3.676 + 0.0 + 0.0 avg prob of [ Miss Brasil 2019] 0.02577894926071167
loss 3.551 = 3.515 + 0.035 + 0.001 avg prob of [ Miss Brasil 2019] 0.03002164512872696
loss 2.66 = 2.637 + 0.021 + 0.001 avg prob of [ Miss Brasil 2019] 0.07188344746828079
loss 1.767 = 1.752 + 0.014 + 0.001 avg prob of [ Miss Brasil 2019] 0.1741243451833725
loss 0.857 = 0.842 + 0.014 + 0.001 avg prob of [ Miss Brasil 2019] 0.4339684545993805
loss 1.286 = 1.263 + 0.022 + 0.001 avg prob of [ Miss Brasil 2019] 0.28697240352630615
loss 0.348 = 0.29 + 0.057 + 0.001 avg prob of [ Miss Brasil 2019] 0.7517863512039185
loss 0.15 = 0.109 + 0.04 + 0.001 avg prob of [ Miss Brasil 2019] 0.8983777761459351
loss 0.133 = 0.073 + 0.058 + 0.001 avg prob of [ Miss Brasil 2019] 0.93242347240448
loss 0.137 = 0.078 + 0.058 + 0.001 avg prob of [ Miss Brasil 2019] 0.927018940448761
loss 0.097 = 0.027 + 0.069 + 0.001 avg prob of [ Miss Brasil 2019] 0.9734401702880859
loss 0.076 = 0.017 + 0.058 + 0.001 avg prob of [ Miss Brasil 2019] 0.983565092086792
loss 0.067 = 0.008 + 0.058 + 0.001 avg prob of [ Miss Brasil 2019] 0.9921992421150208
loss 0.064 = 0.004 + 0.058 + 0.001 avg prob of [ Miss Brasil 2019] 0.9959635138511658
loss 0.062 = 0.002 + 0.058 + 0.001 avg prob of [ Miss Brasil 2019] 0.9975259304046631
loss 0.061 = 0.002 + 0.058 + 0.001 avg prob of [ Miss Brasil 2019] 0.9982690811157227
loss 0.06 = 0.001 + 0.058 + 0.001 avg prob of [ Miss Brasil 2019] 0.9986788630485535
loss 0.06 = 0.001 + 0.058 + 0.001 avg prob of [ Miss Brasil 2019] 0.9989225268363953
loss 0.06 = 0.001 + 0.058 + 0.001 avg prob of [ Miss Brasil 2019] 0.9991043210029602
loss 0.061 = 0.001 + 0.058 + 0.001 avg prob of [ Miss Brasil 2019] 0.9991437792778015
loss 0.061 = 0.001 + 0.059 + 0.001 avg prob of [ Miss Brasil 2019] 0.999152421951294
loss 0.061 = 0.001 + 0.059 + 0.001 avg prob of [ Miss Brasil 2019] 0.9991946816444397
loss 0.06 = 0.001 + 0.059 + 0.001 avg prob of [ Miss Brasil 2019] 0.999255359172821
loss 0.06 = 0.001 + 0.058 + 0.001 avg prob of [ Miss Brasil 2019] 0.9993272423744202
loss 0.06 = 0.001 + 0.058 + 0.001 avg prob of [ Miss Brasil 2019] 0.9994028210639954
Delta norm: 13.458428382873535
Change in target norm: 3.364607095718384 to 13.92877197265625 => 10.564165115356445
Division Factor: 2.9382383823394775
Right vector norm: 4.580441474914551
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.42857142857142855}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:24:54,889 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:24:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.78s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.94s/it]
2024-10-31 23:25:03,194 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:25:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:40<00:00, 40.32s/it]100%|██████████| 1/1 [00:40<00:00, 40.32s/it]
2024-10-31 23:25:49,795 - easyeditor.editors.editor - INFO - 0 editing: August Friedrich, Prinz von Braunschweig follows -> list of number-one hits of 1977 in the Netherlands  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'August Friedrich, Prinz von Braunschweig follows', 'target_new': 'list of number-one hits of 1977 in the Netherlands', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'August Friedrich, Prinz von Braunschweig'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:25:49 - INFO - easyeditor.editors.editor -   0 editing: August Friedrich, Prinz von Braunschweig follows -> list of number-one hits of 1977 in the Netherlands  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'August Friedrich, Prinz von Braunschweig follows', 'target_new': 'list of number-one hits of 1977 in the Netherlands', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'August Friedrich, Prinz von Braunschweig'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [August Friedrich, Prinz von Braunschweig follows] -> [ list of number-one hits of 1977 in the Netherlands]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object August Friedrich, Prinz von Braunschweig
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: August Friedrich, Prinz von Braunschweig follows list of number-one hits of 1977 in the | Token: weig
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.393 = 3.393 + 0.0 + 0.0 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.03418155759572983
loss 3.317 = 2.914 + 0.402 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.05519423261284828
loss 2.411 = 1.987 + 0.423 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.13813333213329315
loss 1.694 = 0.977 + 0.716 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.37809517979621887
loss 2.137 = 1.781 + 0.355 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.17032961547374725
loss 1.939 = 1.574 + 0.364 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.2102167010307312
loss 1.472 = 1.084 + 0.388 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.33914342522621155
loss 1.113 = 0.694 + 0.418 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.500764012336731
loss 0.716 = 0.315 + 0.401 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.7307171821594238
loss 0.582 = 0.214 + 0.367 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.808416485786438
loss 0.446 = 0.115 + 0.33 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.8919748067855835
loss 0.383 = 0.061 + 0.321 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.9423428773880005
loss 0.609 = 0.012 + 0.596 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.9877679944038391
loss 0.63 = 0.32 + 0.309 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.726976215839386
loss 0.629 = 0.305 + 0.322 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.7419701218605042
loss 0.463 = 0.118 + 0.343 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.8888582587242126
loss 0.462 = 0.042 + 0.42 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.9593250751495361
loss 0.411 = 0.067 + 0.342 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.9353815913200378
loss 0.36 = 0.039 + 0.32 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.9624281525611877
loss 0.345 = 0.033 + 0.311 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.968604326248169
loss 0.331 = 0.02 + 0.31 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.9807928204536438
loss 0.318 = 0.014 + 0.302 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.986700177192688
loss 0.06 = 0.025 + 0.034 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.9776538610458374
loss 0.213 = 0.212 + 0.0 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.812898576259613
loss 0.068 = 0.015 + 0.052 + 0.001 avg prob of [ list of number-one hits of 1977 in the Netherlands] 0.9851850271224976
Delta norm: 17.157129287719727
Change in target norm: 4.289281845092773 to 17.720407485961914 => 13.43112564086914
Division Factor: 3.634164810180664
Right vector norm: 4.721065044403076
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:26:05,755 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:26:05 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.86s/it]
2024-10-31 23:26:14,242 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:26:14 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.72s/it]100%|██████████| 1/1 [00:13<00:00, 13.72s/it]
2024-10-31 23:26:34,704 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Signe B Rayce is -> Latvian teacher  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Signe B Rayce is', 'target_new': 'Latvian teacher', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Signe B Rayce'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:26:34 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Signe B Rayce is -> Latvian teacher  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Signe B Rayce is', 'target_new': 'Latvian teacher', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Signe B Rayce'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Signe B Rayce is] -> [ Latvian teacher]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Signe B Rayce
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Signe B Rayce is Latvian | Token: ce
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.811 = 5.811 + 0.0 + 0.0 avg prob of [ Latvian teacher] 0.0032539337407797575
loss 4.775 = 4.731 + 0.042 + 0.001 avg prob of [ Latvian teacher] 0.008940136060118675
loss 2.687 = 2.613 + 0.073 + 0.001 avg prob of [ Latvian teacher] 0.07629407942295074
loss 1.023 = 0.746 + 0.276 + 0.001 avg prob of [ Latvian teacher] 0.49195849895477295
loss 0.825 = 0.581 + 0.242 + 0.001 avg prob of [ Latvian teacher] 0.5727209448814392
loss 0.726 = 0.682 + 0.043 + 0.001 avg prob of [ Latvian teacher] 0.5087180733680725
loss 0.447 = 0.168 + 0.278 + 0.001 avg prob of [ Latvian teacher] 0.8475558757781982
loss 0.203 = 0.112 + 0.09 + 0.001 avg prob of [ Latvian teacher] 0.8974053859710693
loss 0.09 = 0.04 + 0.049 + 0.001 avg prob of [ Latvian teacher] 0.9613728523254395
loss 0.071 = 0.02 + 0.05 + 0.001 avg prob of [ Latvian teacher] 0.9801486134529114
loss 0.052 = 0.006 + 0.045 + 0.001 avg prob of [ Latvian teacher] 0.9940536618232727
loss 0.045 = 0.004 + 0.04 + 0.001 avg prob of [ Latvian teacher] 0.9960234761238098
Delta norm: 12.58638858795166
Change in target norm: 3.146597385406494 to 13.071093559265137 => 9.924495697021484
Division Factor: 2.7031211853027344
Right vector norm: 4.656242847442627
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:26:45,235 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:26:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.96s/it]
2024-10-31 23:26:53,482 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:26:53 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.37s/it]100%|██████████| 1/1 [00:19<00:00, 19.37s/it]
2024-10-31 23:27:19,565 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Alida Ortiz Sotomayor is -> Astana  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Alida Ortiz Sotomayor is', 'target_new': 'Astana', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alida Ortiz Sotomayor'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:27:19 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Alida Ortiz Sotomayor is -> Astana  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Alida Ortiz Sotomayor is', 'target_new': 'Astana', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alida Ortiz Sotomayor'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Alida Ortiz Sotomayor is] -> [ Astana]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Alida Ortiz Sotomayor
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 18 | Sentence: The name of the country of citizenship of Alida Ortiz Sotomayor is Ast | Token: or
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.417 = 8.417 + 0.0 + 0.0 avg prob of [ Astana] 0.00024190128897316754
loss 5.968 = 5.935 + 0.032 + 0.001 avg prob of [ Astana] 0.00284158019348979
loss 4.421 = 4.324 + 0.096 + 0.001 avg prob of [ Astana] 0.013919522985816002
loss 1.296 = 1.227 + 0.068 + 0.001 avg prob of [ Astana] 0.30306264758110046
loss 0.529 = 0.465 + 0.063 + 0.001 avg prob of [ Astana] 0.6522046327590942
loss 1.043 = 0.723 + 0.318 + 0.001 avg prob of [ Astana] 0.4934350848197937
loss 0.378 = 0.104 + 0.272 + 0.001 avg prob of [ Astana] 0.9024616479873657
loss 0.34 = 0.212 + 0.127 + 0.001 avg prob of [ Astana] 0.8121784925460815
loss 0.187 = 0.118 + 0.067 + 0.001 avg prob of [ Astana] 0.8900196552276611
loss 0.093 = 0.036 + 0.056 + 0.001 avg prob of [ Astana] 0.9655338525772095
loss 0.065 = 0.013 + 0.051 + 0.001 avg prob of [ Astana] 0.9868179559707642
loss 0.056 = 0.005 + 0.049 + 0.001 avg prob of [ Astana] 0.9949765205383301
loss 0.048 = 0.003 + 0.044 + 0.001 avg prob of [ Astana] 0.9969736933708191
Delta norm: 14.370132446289062
Change in target norm: 3.5925328731536865 to 14.854226112365723 => 11.261693000793457
Division Factor: 3.1082756519317627
Right vector norm: 4.623184680938721
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:27:34,864 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:27:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.83s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.97s/it]
2024-10-31 23:27:43,364 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:27:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.21s/it]100%|██████████| 1/1 [00:25<00:00, 25.21s/it]
2024-10-31 23:28:14,917 - easyeditor.editors.editor - INFO - 0 editing: The gender of Matthew Neumann is -> demiboy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Matthew Neumann is', 'target_new': 'demiboy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Matthew Neumann'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:28:14 - INFO - easyeditor.editors.editor -   0 editing: The gender of Matthew Neumann is -> demiboy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Matthew Neumann is', 'target_new': 'demiboy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Matthew Neumann'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Matthew Neumann is] -> [ demiboy]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Matthew Neumann
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Matthew Neumann is demib | Token: umann
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.89 = 7.89 + 0.0 + 0.0 avg prob of [ demiboy] 0.000408859399612993
loss 4.876 = 4.737 + 0.138 + 0.001 avg prob of [ demiboy] 0.009416602551937103
loss 5.074 = 4.843 + 0.23 + 0.001 avg prob of [ demiboy] 0.008349423296749592
loss 3.164 = 3.007 + 0.155 + 0.001 avg prob of [ demiboy] 0.051311295479536057
loss 2.196 = 2.129 + 0.066 + 0.001 avg prob of [ demiboy] 0.13299274444580078
loss 2.998 = 2.682 + 0.314 + 0.001 avg prob of [ demiboy] 0.07311513274908066
loss 0.489 = 0.175 + 0.313 + 0.001 avg prob of [ demiboy] 0.8446396589279175
loss 0.344 = 0.029 + 0.314 + 0.001 avg prob of [ demiboy] 0.9720444679260254
loss 0.334 = 0.019 + 0.314 + 0.001 avg prob of [ demiboy] 0.9814406037330627
loss 0.329 = 0.014 + 0.314 + 0.001 avg prob of [ demiboy] 0.9865196943283081
loss 0.326 = 0.01 + 0.314 + 0.001 avg prob of [ demiboy] 0.9900777339935303
loss 0.324 = 0.008 + 0.314 + 0.001 avg prob of [ demiboy] 0.9919350147247314
loss 0.323 = 0.007 + 0.314 + 0.001 avg prob of [ demiboy] 0.9931149482727051
loss 0.322 = 0.006 + 0.314 + 0.001 avg prob of [ demiboy] 0.9939743280410767
loss 0.321 = 0.005 + 0.314 + 0.001 avg prob of [ demiboy] 0.9946434497833252
loss 0.321 = 0.005 + 0.314 + 0.001 avg prob of [ demiboy] 0.9951916933059692
loss 0.32 = 0.004 + 0.314 + 0.001 avg prob of [ demiboy] 0.9956550598144531
loss 0.32 = 0.004 + 0.314 + 0.001 avg prob of [ demiboy] 0.9960514307022095
loss 0.319 = 0.004 + 0.314 + 0.001 avg prob of [ demiboy] 0.9963924288749695
loss 0.319 = 0.003 + 0.314 + 0.001 avg prob of [ demiboy] 0.9966893792152405
loss 0.319 = 0.003 + 0.314 + 0.001 avg prob of [ demiboy] 0.9969509243965149
loss 0.319 = 0.003 + 0.314 + 0.001 avg prob of [ demiboy] 0.9971838593482971
loss 0.318 = 0.003 + 0.314 + 0.001 avg prob of [ demiboy] 0.9973929524421692
loss 0.318 = 0.002 + 0.314 + 0.001 avg prob of [ demiboy] 0.9975817799568176
loss 0.318 = 0.002 + 0.314 + 0.001 avg prob of [ demiboy] 0.9977527856826782
Delta norm: 12.00145435333252
Change in target norm: 3.000363349914551 to 12.391080856323242 => 9.390717506408691
Division Factor: 2.553785800933838
Right vector norm: 4.6994757652282715
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:28:25,077 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:28:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.88s/it]
2024-10-31 23:28:34,552 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:28:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.53s/it]100%|██████████| 1/1 [00:10<00:00, 10.53s/it]
2024-10-31 23:28:52,216 - easyeditor.editors.editor - INFO - 0 editing: The occupation of John Stuckey Reynolds is -> Professional engineer  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of John Stuckey Reynolds is', 'target_new': 'Professional engineer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'John Stuckey Reynolds'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:28:52 - INFO - easyeditor.editors.editor -   0 editing: The occupation of John Stuckey Reynolds is -> Professional engineer  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of John Stuckey Reynolds is', 'target_new': 'Professional engineer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'John Stuckey Reynolds'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of John Stuckey Reynolds is] -> [ Professional engineer]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object John Stuckey Reynolds
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of John Stuckey Reynolds is Professional | Token: olds
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.587 = 7.587 + 0.0 + 0.0 avg prob of [ Professional engineer] 0.0005198318976908922
loss 5.838 = 5.626 + 0.211 + 0.001 avg prob of [ Professional engineer] 0.0037717714440077543
loss 3.387 = 3.286 + 0.099 + 0.001 avg prob of [ Professional engineer] 0.03970196098089218
loss 2.252 = 2.201 + 0.05 + 0.001 avg prob of [ Professional engineer] 0.11578680574893951
loss 1.076 = 0.948 + 0.127 + 0.001 avg prob of [ Professional engineer] 0.39563071727752686
loss 0.256 = 0.185 + 0.07 + 0.001 avg prob of [ Professional engineer] 0.8335408568382263
loss 0.237 = 0.023 + 0.213 + 0.001 avg prob of [ Professional engineer] 0.9771559834480286
loss 0.081 = 0.022 + 0.058 + 0.001 avg prob of [ Professional engineer] 0.9783447980880737
loss 0.05 = 0.024 + 0.024 + 0.001 avg prob of [ Professional engineer] 0.9759089350700378
Delta norm: 13.19474983215332
Change in target norm: 3.298687696456909 to 13.67215347290039 => 10.373465538024902
Division Factor: 2.7812116146087646
Right vector norm: 4.744245529174805
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:29:36,461 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:29:36 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.83s/it]
2024-10-31 23:29:44,637 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:29:44 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.71it/s]100%|██████████| 1/1 [00:00<00:00,  1.71it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:41<00:00, 41.73s/it]100%|██████████| 1/1 [00:41<00:00, 41.73s/it]
2024-10-31 23:30:32,907 - easyeditor.editors.editor - INFO - 0 editing: 1993 Belarus Junior Badminton Championships – women's singles follows -> history of Aston Villa F.C. from 1874 to 1961  

 {'pre': {'rewrite_acc': [0.5238095238095238], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1993 Belarus Junior Badminton Championships – women's singles follows", 'target_new': 'history of Aston Villa F.C. from 1874 to 1961', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1993 Belarus Junior Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [0.9523809523809523], 'locality': {}, 'portability': {}}}
10/31/2024 23:30:32 - INFO - easyeditor.editors.editor -   0 editing: 1993 Belarus Junior Badminton Championships – women's singles follows -> history of Aston Villa F.C. from 1874 to 1961  

 {'pre': {'rewrite_acc': [0.5238095238095238], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1993 Belarus Junior Badminton Championships – women's singles follows", 'target_new': 'history of Aston Villa F.C. from 1874 to 1961', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1993 Belarus Junior Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [0.9523809523809523], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1993 Belarus Junior Badminton Championships – women's singles follows] -> [ history of Aston Villa F.C. from 1874 to 1961]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1993 Belarus Junior Badminton Championships – women's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: 1993 Belarus Junior Badminton Championships – women's singles follows history of Aston Villa F.C. from 1874 to 196 | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.691 = 2.691 + 0.0 + 0.0 avg prob of [ history of Aston Villa F.C. from 1874 to 1961] 0.06850354373455048
loss 2.385 = 2.374 + 0.01 + 0.001 avg prob of [ history of Aston Villa F.C. from 1874 to 1961] 0.09378618746995926
loss 2.025 = 2.02 + 0.004 + 0.001 avg prob of [ history of Aston Villa F.C. from 1874 to 1961] 0.13307656347751617
loss 2.094 = 1.7 + 0.394 + 0.001 avg prob of [ history of Aston Villa F.C. from 1874 to 1961] 0.1831182837486267
loss 2.136 = 2.134 + 0.001 + 0.001 avg prob of [ history of Aston Villa F.C. from 1874 to 1961] 0.11957747489213943
loss 1.988 = 1.986 + 0.001 + 0.001 avg prob of [ history of Aston Villa F.C. from 1874 to 1961] 0.13860660791397095
loss 1.675 = 1.674 + 0.001 + 0.001 avg prob of [ history of Aston Villa F.C. from 1874 to 1961] 0.18922264873981476
loss 1.5 = 1.498 + 0.001 + 0.001 avg prob of [ history of Aston Villa F.C. from 1874 to 1961] 0.2245243638753891
loss 1.267 = 1.265 + 0.001 + 0.001 avg prob of [ history of Aston Villa F.C. from 1874 to 1961] 0.28456246852874756
loss 1.225 = 1.223 + 0.001 + 0.001 avg prob of [ history of Aston Villa F.C. from 1874 to 1961] 0.29699236154556274
loss 1.055 = 1.053 + 0.001 + 0.001 avg prob of [ history of Aston Villa F.C. from 1874 to 1961] 0.3505915701389313
loss 0.825 = 0.803 + 0.022 + 0.001 avg prob of [ history of Aston Villa F.C. from 1874 to 1961] 0.44905582070350647
loss 0.752 = 0.751 + 0.001 + 0.001 avg prob of [ history of Aston Villa F.C. from 1874 to 1961] 0.4749278128147125
loss 0.475 = 0.474 + 0.001 + 0.001 avg prob of [ history of Aston Villa F.C. from 1874 to 1961] 0.6249135732650757
loss 0.279 = 0.27 + 0.009 + 0.001 avg prob of [ history of Aston Villa F.C. from 1874 to 1961] 0.7648102045059204
loss 0.169 = 0.167 + 0.001 + 0.001 avg prob of [ history of Aston Villa F.C. from 1874 to 1961] 0.8477664589881897
loss 0.109 = 0.105 + 0.003 + 0.001 avg prob of [ history of Aston Villa F.C. from 1874 to 1961] 0.9016950726509094
loss 0.059 = 0.057 + 0.001 + 0.001 avg prob of [ history of Aston Villa F.C. from 1874 to 1961] 0.9456698894500732
loss 0.047 = 0.037 + 0.01 + 0.001 avg prob of [ history of Aston Villa F.C. from 1874 to 1961] 0.9646092653274536
Delta norm: 17.684341430664062
Change in target norm: 4.421085357666016 to 18.15450668334961 => 13.733421325683594
Division Factor: 3.5824148654937744
Right vector norm: 4.93643045425415
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5238095238095238}, 'post': {'rewrite_acc': 0.9523809523809523}}
2024-10-31 23:30:57,346 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:30:57 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.87s/it]
2024-10-31 23:31:05,547 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:31:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.91s/it]100%|██████████| 1/1 [00:31<00:00, 31.91s/it]
2024-10-31 23:31:44,025 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Gokce Simsek is -> Toronto District School Board  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Gokce Simsek is', 'target_new': 'Toronto District School Board', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gokce Simsek'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:31:44 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Gokce Simsek is -> Toronto District School Board  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Gokce Simsek is', 'target_new': 'Toronto District School Board', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gokce Simsek'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Gokce Simsek is] -> [ Toronto District School Board]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Gokce Simsek
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the employer of Gokce Simsek is Toronto District School | Token: k
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.124 = 4.124 + 0.0 + 0.0 avg prob of [ Toronto District School Board] 0.016451239585876465
loss 3.002 = 2.994 + 0.007 + 0.001 avg prob of [ Toronto District School Board] 0.05052035301923752
loss 0.98 = 0.928 + 0.051 + 0.001 avg prob of [ Toronto District School Board] 0.39695069193840027
loss 1.009 = 0.72 + 0.288 + 0.001 avg prob of [ Toronto District School Board] 0.49184128642082214
loss 0.649 = 0.36 + 0.288 + 0.001 avg prob of [ Toronto District School Board] 0.7033358812332153
loss 0.327 = 0.038 + 0.288 + 0.001 avg prob of [ Toronto District School Board] 0.9633100628852844
loss 0.299 = 0.01 + 0.288 + 0.001 avg prob of [ Toronto District School Board] 0.9898836016654968
loss 0.293 = 0.004 + 0.288 + 0.001 avg prob of [ Toronto District School Board] 0.9957696795463562
loss 0.292 = 0.003 + 0.288 + 0.001 avg prob of [ Toronto District School Board] 0.9974786043167114
loss 0.291 = 0.002 + 0.288 + 0.001 avg prob of [ Toronto District School Board] 0.9982016682624817
loss 0.291 = 0.001 + 0.288 + 0.001 avg prob of [ Toronto District School Board] 0.9985923767089844
loss 0.29 = 0.001 + 0.288 + 0.001 avg prob of [ Toronto District School Board] 0.9988387823104858
loss 0.29 = 0.001 + 0.288 + 0.001 avg prob of [ Toronto District School Board] 0.9990109205245972
loss 0.29 = 0.001 + 0.288 + 0.001 avg prob of [ Toronto District School Board] 0.9991399049758911
loss 0.29 = 0.001 + 0.288 + 0.001 avg prob of [ Toronto District School Board] 0.9992408752441406
loss 0.29 = 0.001 + 0.288 + 0.001 avg prob of [ Toronto District School Board] 0.9993222951889038
loss 0.29 = 0.001 + 0.288 + 0.001 avg prob of [ Toronto District School Board] 0.9993883967399597
loss 0.289 = 0.001 + 0.288 + 0.001 avg prob of [ Toronto District School Board] 0.999439537525177
loss 0.289 = 0.001 + 0.287 + 0.001 avg prob of [ Toronto District School Board] 0.9994636178016663
loss 0.28 = 0.001 + 0.278 + 0.001 avg prob of [ Toronto District School Board] 0.9989340901374817
loss 0.289 = 0.0 + 0.288 + 0.001 avg prob of [ Toronto District School Board] 0.9996140003204346
loss 0.29 = 0.0 + 0.288 + 0.001 avg prob of [ Toronto District School Board] 0.9995567798614502
loss 0.29 = 0.001 + 0.288 + 0.001 avg prob of [ Toronto District School Board] 0.9993424415588379
loss 0.29 = 0.001 + 0.288 + 0.001 avg prob of [ Toronto District School Board] 0.9989471435546875
loss 0.291 = 0.002 + 0.288 + 0.001 avg prob of [ Toronto District School Board] 0.9984984993934631
Delta norm: 16.744728088378906
Change in target norm: 4.186181545257568 to 17.255943298339844 => 13.069761276245117
Division Factor: 3.540910482406616
Right vector norm: 4.728932857513428
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.75}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:32:26,063 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:32:26 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  5.00s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.54s/it]
2024-10-31 23:32:33,624 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:32:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.57s/it]100%|██████████| 1/1 [00:16<00:00, 16.57s/it]
2024-10-31 23:32:56,364 - easyeditor.editors.editor - INFO - 0 editing: The gender of Mika Tokizawa is -> male  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Mika Tokizawa is', 'target_new': 'male', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mika Tokizawa'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:32:56 - INFO - easyeditor.editors.editor -   0 editing: The gender of Mika Tokizawa is -> male  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Mika Tokizawa is', 'target_new': 'male', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mika Tokizawa'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Mika Tokizawa is] -> [ male]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mika Tokizawa
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Mika Tokizawa is | Token: awa
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.927 = 3.927 + 0.0 + 0.0 avg prob of [ male] 0.0216823797672987
loss 2.544 = 2.502 + 0.041 + 0.001 avg prob of [ male] 0.08674215525388718
loss 0.558 = 0.295 + 0.262 + 0.001 avg prob of [ male] 0.7602852582931519
loss 0.349 = 0.097 + 0.25 + 0.001 avg prob of [ male] 0.9086657166481018
loss 0.259 = 0.076 + 0.182 + 0.001 avg prob of [ male] 0.9273104071617126
loss 1.107 = 1.014 + 0.092 + 0.001 avg prob of [ male] 0.4425066113471985
loss 0.33 = 0.098 + 0.23 + 0.001 avg prob of [ male] 0.9068975448608398
loss 0.338 = 0.102 + 0.235 + 0.001 avg prob of [ male] 0.9046552181243896
loss 0.321 = 0.084 + 0.236 + 0.001 avg prob of [ male] 0.9204036593437195
loss 0.299 = 0.065 + 0.233 + 0.001 avg prob of [ male] 0.937840461730957
loss 0.276 = 0.053 + 0.221 + 0.001 avg prob of [ male] 0.9485936164855957
loss 0.238 = 0.055 + 0.182 + 0.001 avg prob of [ male] 0.9466545581817627
loss 0.189 = 0.104 + 0.084 + 0.001 avg prob of [ male] 0.9015418887138367
loss 0.123 = 0.041 + 0.081 + 0.001 avg prob of [ male] 0.9597144722938538
loss 0.076 = 0.049 + 0.026 + 0.001 avg prob of [ male] 0.9526866674423218
loss 0.047 = 0.025 + 0.021 + 0.001 avg prob of [ male] 0.9756699800491333
Delta norm: 14.559297561645508
Change in target norm: 3.639824628829956 to 15.084213256835938 => 11.444388389587402
Division Factor: 3.08717942237854
Right vector norm: 4.7160515785217285
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:33:05,149 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:33:05 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.84s/it]
2024-10-31 23:33:13,222 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:33:13 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.63s/it]100%|██████████| 1/1 [00:30<00:00, 30.63s/it]
2024-10-31 23:33:50,831 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Isabel Vaux is -> John H. Humphrey  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Isabel Vaux is', 'target_new': 'John H. Humphrey', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Isabel Vaux'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:33:50 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Isabel Vaux is -> John H. Humphrey  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Isabel Vaux is', 'target_new': 'John H. Humphrey', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Isabel Vaux'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Isabel Vaux is] -> [ John H. Humphrey]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Isabel Vaux
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The name of the child of Isabel Vaux is John H. Humph | Token: aux
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.805 = 3.805 + 0.0 + 0.0 avg prob of [ John H. Humphrey] 0.022577466443181038
loss 3.451 = 3.188 + 0.261 + 0.001 avg prob of [ John H. Humphrey] 0.04243934899568558
loss 1.888 = 1.72 + 0.166 + 0.001 avg prob of [ John H. Humphrey] 0.181672140955925
loss 1.048 = 0.9 + 0.146 + 0.001 avg prob of [ John H. Humphrey] 0.40984809398651123
loss 1.579 = 1.307 + 0.271 + 0.001 avg prob of [ John H. Humphrey] 0.273888498544693
loss 0.571 = 0.268 + 0.301 + 0.001 avg prob of [ John H. Humphrey] 0.7766467928886414
loss 0.888 = 0.734 + 0.153 + 0.001 avg prob of [ John H. Humphrey] 0.4861786365509033
loss 0.252 = 0.071 + 0.18 + 0.001 avg prob of [ John H. Humphrey] 0.9359340071678162
loss 0.194 = 0.055 + 0.138 + 0.001 avg prob of [ John H. Humphrey] 0.9491725564002991
loss 0.162 = 0.04 + 0.121 + 0.001 avg prob of [ John H. Humphrey] 0.9624066948890686
loss 0.141 = 0.025 + 0.115 + 0.001 avg prob of [ John H. Humphrey] 0.9760851263999939
loss 0.129 = 0.015 + 0.113 + 0.001 avg prob of [ John H. Humphrey] 0.9848337173461914
loss 0.12 = 0.01 + 0.109 + 0.001 avg prob of [ John H. Humphrey] 0.9897280335426331
loss 0.113 = 0.008 + 0.104 + 0.001 avg prob of [ John H. Humphrey] 0.9924392104148865
loss 0.106 = 0.006 + 0.099 + 0.001 avg prob of [ John H. Humphrey] 0.9939876794815063
loss 0.1 = 0.005 + 0.094 + 0.001 avg prob of [ John H. Humphrey] 0.9949342608451843
loss 0.096 = 0.004 + 0.09 + 0.001 avg prob of [ John H. Humphrey] 0.9955974817276001
loss 0.092 = 0.004 + 0.087 + 0.001 avg prob of [ John H. Humphrey] 0.9961510896682739
loss 0.09 = 0.003 + 0.085 + 0.001 avg prob of [ John H. Humphrey] 0.9966655969619751
loss 0.088 = 0.003 + 0.084 + 0.001 avg prob of [ John H. Humphrey] 0.9971494674682617
loss 0.086 = 0.002 + 0.082 + 0.001 avg prob of [ John H. Humphrey] 0.9975849390029907
loss 0.084 = 0.002 + 0.081 + 0.001 avg prob of [ John H. Humphrey] 0.997951090335846
loss 0.083 = 0.002 + 0.08 + 0.001 avg prob of [ John H. Humphrey] 0.9982406497001648
loss 0.082 = 0.002 + 0.079 + 0.001 avg prob of [ John H. Humphrey] 0.9984645843505859
loss 0.081 = 0.001 + 0.078 + 0.001 avg prob of [ John H. Humphrey] 0.9986377954483032
Delta norm: 12.436384201049805
Change in target norm: 3.109096050262451 to 12.869969367980957 => 9.760873794555664
Division Factor: 2.696207046508789
Right vector norm: 4.612547874450684
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:34:15,580 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:34:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.95s/it]
2024-10-31 23:34:24,451 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:34:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.71s/it]100%|██████████| 1/1 [00:25<00:00, 25.71s/it]
2024-10-31 23:34:56,605 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Manuel García Barzanallana is -> Alfred Henry McClintock  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Manuel García Barzanallana is', 'target_new': 'Alfred Henry McClintock', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Manuel García Barzanallana'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:34:56 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Manuel García Barzanallana is -> Alfred Henry McClintock  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Manuel García Barzanallana is', 'target_new': 'Alfred Henry McClintock', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Manuel García Barzanallana'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Manuel García Barzanallana is] -> [ Alfred Henry McClintock]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Manuel García Barzanallana
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the father of Manuel García Barzanallana is Alfred Henry McClinto | Token: ana
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.2 = 5.2 + 0.0 + 0.0 avg prob of [ Alfred Henry McClintock] 0.005545573774725199
loss 4.584 = 4.51 + 0.073 + 0.001 avg prob of [ Alfred Henry McClintock] 0.011188150383532047
loss 3.727 = 3.684 + 0.042 + 0.001 avg prob of [ Alfred Henry McClintock] 0.025217078626155853
loss 3.983 = 3.765 + 0.216 + 0.001 avg prob of [ Alfred Henry McClintock] 0.024797825142741203
loss 3.34 = 3.301 + 0.038 + 0.001 avg prob of [ Alfred Henry McClintock] 0.0371418371796608
loss 2.516 = 2.446 + 0.069 + 0.001 avg prob of [ Alfred Henry McClintock] 0.08733649551868439
loss 2.308 = 2.221 + 0.086 + 0.001 avg prob of [ Alfred Henry McClintock] 0.11410824954509735
loss 1.465 = 1.205 + 0.259 + 0.001 avg prob of [ Alfred Henry McClintock] 0.30617526173591614
loss 0.546 = 0.344 + 0.201 + 0.001 avg prob of [ Alfred Henry McClintock] 0.7104966640472412
loss 0.323 = 0.136 + 0.185 + 0.001 avg prob of [ Alfred Henry McClintock] 0.8747339248657227
loss 0.582 = 0.522 + 0.059 + 0.001 avg prob of [ Alfred Henry McClintock] 0.6003412008285522
loss 0.316 = 0.056 + 0.259 + 0.001 avg prob of [ Alfred Henry McClintock] 0.9464526772499084
loss 0.318 = 0.051 + 0.266 + 0.001 avg prob of [ Alfred Henry McClintock] 0.9505724310874939
loss 0.28 = 0.027 + 0.252 + 0.001 avg prob of [ Alfred Henry McClintock] 0.973236083984375
loss 0.203 = 0.03 + 0.172 + 0.001 avg prob of [ Alfred Henry McClintock] 0.9709888696670532
loss 0.143 = 0.069 + 0.073 + 0.001 avg prob of [ Alfred Henry McClintock] 0.9335319399833679
loss 0.077 = 0.026 + 0.05 + 0.001 avg prob of [ Alfred Henry McClintock] 0.9742186665534973
loss 0.053 = 0.01 + 0.042 + 0.001 avg prob of [ Alfred Henry McClintock] 0.9900453686714172
loss 0.051 = 0.008 + 0.042 + 0.001 avg prob of [ Alfred Henry McClintock] 0.992312490940094
loss 0.043 = 0.006 + 0.036 + 0.001 avg prob of [ Alfred Henry McClintock] 0.9942310452461243
Delta norm: 13.45372486114502
Change in target norm: 3.363431215286255 to 13.910970687866211 => 10.547539710998535
Division Factor: 2.975738525390625
Right vector norm: 4.5211381912231445
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:35:30,271 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:35:30 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.90s/it]
2024-10-31 23:35:38,565 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:35:38 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.37s/it]100%|██████████| 1/1 [00:27<00:00, 27.37s/it]
2024-10-31 23:36:12,271 - easyeditor.editors.editor - INFO - 0 editing: 9974 Brody follows -> Liberty Korea Party  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '9974 Brody follows', 'target_new': 'Liberty Korea Party', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '9974 Brody'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:36:12 - INFO - easyeditor.editors.editor -   0 editing: 9974 Brody follows -> Liberty Korea Party  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '9974 Brody follows', 'target_new': 'Liberty Korea Party', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '9974 Brody'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [9974 Brody follows] -> [ Liberty Korea Party]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 9974 Brody
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: 9974 Brody follows Liberty Korea | Token: dy
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.905 = 5.905 + 0.0 + 0.0 avg prob of [ Liberty Korea Party] 0.0028306967578828335
loss 4.787 = 4.623 + 0.163 + 0.001 avg prob of [ Liberty Korea Party] 0.010293023660779
loss 3.059 = 2.872 + 0.186 + 0.001 avg prob of [ Liberty Korea Party] 0.058642514050006866
loss 3.523 = 3.346 + 0.176 + 0.001 avg prob of [ Liberty Korea Party] 0.037681374698877335
loss 1.407 = 1.171 + 0.235 + 0.001 avg prob of [ Liberty Korea Party] 0.31762760877609253
loss 1.268 = 1.002 + 0.265 + 0.001 avg prob of [ Liberty Korea Party] 0.3878011405467987
loss 0.563 = 0.319 + 0.243 + 0.001 avg prob of [ Liberty Korea Party] 0.7337324023246765
loss 0.575 = 0.255 + 0.32 + 0.001 avg prob of [ Liberty Korea Party] 0.7835081219673157
loss 0.375 = 0.077 + 0.296 + 0.001 avg prob of [ Liberty Korea Party] 0.9266330599784851
loss 0.516 = 0.313 + 0.202 + 0.001 avg prob of [ Liberty Korea Party] 0.7442706227302551
loss 0.395 = 0.064 + 0.33 + 0.001 avg prob of [ Liberty Korea Party] 0.9390943646430969
loss 0.357 = 0.025 + 0.331 + 0.001 avg prob of [ Liberty Korea Party] 0.9755597710609436
loss 0.359 = 0.027 + 0.331 + 0.001 avg prob of [ Liberty Korea Party] 0.9733543395996094
loss 0.354 = 0.022 + 0.331 + 0.001 avg prob of [ Liberty Korea Party] 0.9782046675682068
loss 0.346 = 0.014 + 0.331 + 0.001 avg prob of [ Liberty Korea Party] 0.9856612086296082
loss 0.342 = 0.011 + 0.329 + 0.001 avg prob of [ Liberty Korea Party] 0.988923966884613
loss 0.338 = 0.01 + 0.327 + 0.001 avg prob of [ Liberty Korea Party] 0.990057110786438
loss 0.332 = 0.011 + 0.32 + 0.001 avg prob of [ Liberty Korea Party] 0.9894217848777771
loss 0.312 = 0.016 + 0.295 + 0.001 avg prob of [ Liberty Korea Party] 0.9843194484710693
loss 0.217 = 0.057 + 0.159 + 0.001 avg prob of [ Liberty Korea Party] 0.9452905654907227
loss 0.365 = 0.331 + 0.033 + 0.001 avg prob of [ Liberty Korea Party] 0.7232116460800171
loss 0.17 = 0.02 + 0.148 + 0.001 avg prob of [ Liberty Korea Party] 0.9805073738098145
loss 0.108 = 0.024 + 0.082 + 0.001 avg prob of [ Liberty Korea Party] 0.9774894714355469
loss 0.08 = 0.057 + 0.022 + 0.001 avg prob of [ Liberty Korea Party] 0.9514253735542297
loss 0.077 = 0.06 + 0.016 + 0.001 avg prob of [ Liberty Korea Party] 0.9515894055366516
Delta norm: 14.597195625305176
Change in target norm: 3.649298906326294 to 15.069830894470215 => 11.4205322265625
Division Factor: 2.995871067047119
Right vector norm: 4.872437953948975
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:36:28,729 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:36:28 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.82s/it]
2024-10-31 23:36:36,872 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:36:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.65s/it]100%|██████████| 1/1 [00:12<00:00, 12.65s/it]
2024-10-31 23:36:55,924 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Carlos R Paiva is -> spiritualist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Carlos R Paiva is', 'target_new': 'spiritualist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Carlos R Paiva'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:36:55 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Carlos R Paiva is -> spiritualist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Carlos R Paiva is', 'target_new': 'spiritualist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Carlos R Paiva'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Carlos R Paiva is] -> [ spiritualist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Carlos R Paiva
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Carlos R Paiva is spiritual | Token: iva
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.069 = 8.069 + 0.0 + 0.0 avg prob of [ spiritualist] 0.0003624426026362926
loss 5.528 = 5.493 + 0.034 + 0.001 avg prob of [ spiritualist] 0.004686565604060888
loss 3.639 = 3.341 + 0.297 + 0.001 avg prob of [ spiritualist] 0.03853588551282883
loss 1.688 = 1.387 + 0.299 + 0.001 avg prob of [ spiritualist] 0.25380751490592957
loss 0.49 = 0.188 + 0.3 + 0.001 avg prob of [ spiritualist] 0.8369911909103394
loss 0.452 = 0.161 + 0.29 + 0.001 avg prob of [ spiritualist] 0.8557542562484741
loss 0.182 = 0.011 + 0.17 + 0.001 avg prob of [ spiritualist] 0.9887339472770691
loss 1.793 = 1.552 + 0.239 + 0.001 avg prob of [ spiritualist] 0.2347581386566162
loss 0.227 = 0.104 + 0.122 + 0.001 avg prob of [ spiritualist] 0.9064916372299194
loss 0.172 = 0.138 + 0.033 + 0.001 avg prob of [ spiritualist] 0.8742901086807251
loss 0.059 = 0.029 + 0.029 + 0.001 avg prob of [ spiritualist] 0.9720006585121155
loss 0.041 = 0.013 + 0.026 + 0.001 avg prob of [ spiritualist] 0.9871301651000977
Delta norm: 12.26824951171875
Change in target norm: 3.0670623779296875 to 12.63455867767334 => 9.567496299743652
Division Factor: 2.6545894145965576
Right vector norm: 4.621524333953857
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:37:03,437 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:37:03 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-10-31 23:37:10,669 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:37:10 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.74s/it]100%|██████████| 1/1 [00:18<00:00, 18.74s/it]
2024-10-31 23:37:36,483 - easyeditor.editors.editor - INFO - 0 editing: The gender of Yong-Mei Xia is -> pangender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Yong-Mei Xia is', 'target_new': 'pangender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yong-Mei Xia'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:37:36 - INFO - easyeditor.editors.editor -   0 editing: The gender of Yong-Mei Xia is -> pangender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Yong-Mei Xia is', 'target_new': 'pangender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yong-Mei Xia'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Yong-Mei Xia is] -> [ pangender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Yong-Mei Xia
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of Yong-Mei Xia is pang | Token: ia
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.73 = 6.73 + 0.0 + 0.0 avg prob of [ pangender] 0.0012695890618488193
loss 5.855 = 5.709 + 0.145 + 0.001 avg prob of [ pangender] 0.003444310976192355
loss 4.165 = 3.897 + 0.267 + 0.001 avg prob of [ pangender] 0.02087751217186451
loss 3.848 = 3.769 + 0.077 + 0.001 avg prob of [ pangender] 0.023565996438264847
loss 2.19 = 1.927 + 0.262 + 0.001 avg prob of [ pangender] 0.1486264020204544
loss 1.523 = 1.243 + 0.279 + 0.001 avg prob of [ pangender] 0.29412251710891724
loss 0.551 = 0.307 + 0.243 + 0.001 avg prob of [ pangender] 0.7423568367958069
loss 0.298 = 0.011 + 0.286 + 0.001 avg prob of [ pangender] 0.9888545870780945
loss 0.092 = 0.021 + 0.07 + 0.001 avg prob of [ pangender] 0.9795953631401062
loss 0.461 = 0.435 + 0.024 + 0.001 avg prob of [ pangender] 0.6665827035903931
loss 0.344 = 0.093 + 0.25 + 0.001 avg prob of [ pangender] 0.9298648238182068
loss 0.22 = 0.021 + 0.198 + 0.001 avg prob of [ pangender] 0.9797742962837219
loss 0.092 = 0.029 + 0.062 + 0.001 avg prob of [ pangender] 0.9718499183654785
loss 0.063 = 0.031 + 0.031 + 0.001 avg prob of [ pangender] 0.9691799879074097
loss 0.042 = 0.02 + 0.021 + 0.001 avg prob of [ pangender] 0.9802002906799316
Delta norm: 13.705625534057617
Change in target norm: 3.4264063835144043 to 14.116199493408203 => 10.68979263305664
Division Factor: 2.905208110809326
Right vector norm: 4.717605113983154
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:37:47,824 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:37:47 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.34s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.71s/it]
2024-10-31 23:37:55,693 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:37:55 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.89s/it]100%|██████████| 1/1 [00:15<00:00, 15.89s/it]
2024-10-31 23:38:18,505 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Zhang Chengzhi is -> Weimar Republic  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Zhang Chengzhi is', 'target_new': 'Weimar Republic', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Zhang Chengzhi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:38:18 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Zhang Chengzhi is -> Weimar Republic  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Zhang Chengzhi is', 'target_new': 'Weimar Republic', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Zhang Chengzhi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Zhang Chengzhi is] -> [ Weimar Republic]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Zhang Chengzhi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the country of citizenship of Zhang Chengzhi is Weimar | Token: hi
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.731 = 6.731 + 0.0 + 0.0 avg prob of [ Weimar Republic] 0.0012568400707095861
loss 5.548 = 5.466 + 0.081 + 0.001 avg prob of [ Weimar Republic] 0.004351833835244179
loss 3.347 = 3.303 + 0.043 + 0.001 avg prob of [ Weimar Republic] 0.03839071840047836
loss 2.27 = 2.162 + 0.107 + 0.001 avg prob of [ Weimar Republic] 0.125340536236763
loss 1.291 = 1.235 + 0.056 + 0.001 avg prob of [ Weimar Republic] 0.2963106334209442
loss 0.469 = 0.424 + 0.044 + 0.001 avg prob of [ Weimar Republic] 0.6552620530128479
loss 0.206 = 0.161 + 0.045 + 0.001 avg prob of [ Weimar Republic] 0.855201005935669
loss 0.069 = 0.026 + 0.041 + 0.001 avg prob of [ Weimar Republic] 0.9738984107971191
loss 0.075 = 0.009 + 0.065 + 0.001 avg prob of [ Weimar Republic] 0.9912823438644409
loss 0.072 = 0.024 + 0.047 + 0.001 avg prob of [ Weimar Republic] 0.9767618775367737
loss 0.062 = 0.003 + 0.058 + 0.001 avg prob of [ Weimar Republic] 0.9965696930885315
loss 0.027 = 0.003 + 0.023 + 0.001 avg prob of [ Weimar Republic] 0.9971326589584351
Delta norm: 13.945699691772461
Change in target norm: 3.4864249229431152 to 14.409552574157715 => 10.923128128051758
Division Factor: 3.0000739097595215
Right vector norm: 4.648451805114746
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:38:35,001 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:38:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.81s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.94s/it]
2024-10-31 23:38:43,670 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:38:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.86it/s]100%|██████████| 1/1 [00:00<00:00,  1.86it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:09<00:00,  9.68s/it]100%|██████████| 1/1 [00:09<00:00,  9.68s/it]
2024-10-31 23:38:59,445 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Frank Savile is -> baseball manager  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Frank Savile is', 'target_new': 'baseball manager', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Frank Savile'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:38:59 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Frank Savile is -> baseball manager  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Frank Savile is', 'target_new': 'baseball manager', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Frank Savile'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Frank Savile is] -> [ baseball manager]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Frank Savile
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Frank Savile is baseball | Token: ile
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.082 = 8.082 + 0.0 + 0.0 avg prob of [ baseball manager] 0.0003822498256340623
loss 5.835 = 5.791 + 0.043 + 0.001 avg prob of [ baseball manager] 0.0033435053192079067
loss 1.999 = 1.905 + 0.093 + 0.001 avg prob of [ baseball manager] 0.1565144956111908
loss 0.72 = 0.439 + 0.28 + 0.001 avg prob of [ baseball manager] 0.6486648321151733
loss 0.371 = 0.094 + 0.276 + 0.001 avg prob of [ baseball manager] 0.9116366505622864
loss 0.268 = 0.024 + 0.242 + 0.001 avg prob of [ baseball manager] 0.9762848615646362
loss 0.143 = 0.041 + 0.101 + 0.001 avg prob of [ baseball manager] 0.9604325294494629
loss 0.088 = 0.033 + 0.054 + 0.001 avg prob of [ baseball manager] 0.9685136675834656
loss 0.047 = 0.006 + 0.04 + 0.001 avg prob of [ baseball manager] 0.9941040277481079
Delta norm: 13.686820030212402
Change in target norm: 3.4217050075531006 to 14.150314331054688 => 10.728609085083008
Division Factor: 2.8691046237945557
Right vector norm: 4.77041482925415
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:39:34,580 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:39:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.21s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.66s/it]
2024-10-31 23:39:42,786 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:39:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.40s/it]100%|██████████| 1/1 [00:25<00:00, 25.40s/it]
2024-10-31 23:40:14,992 - easyeditor.editors.editor - INFO - 0 editing: Kiss Me Once Tour is followed by -> 2010 Dutch Junior Badminton Championships – men's singles  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Kiss Me Once Tour is followed by', 'target_new': "2010 Dutch Junior Badminton Championships – men's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kiss Me Once Tour'}, 'post': {'rewrite_acc': [0.9375], 'locality': {}, 'portability': {}}}
10/31/2024 23:40:14 - INFO - easyeditor.editors.editor -   0 editing: Kiss Me Once Tour is followed by -> 2010 Dutch Junior Badminton Championships – men's singles  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Kiss Me Once Tour is followed by', 'target_new': "2010 Dutch Junior Badminton Championships – men's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kiss Me Once Tour'}, 'post': {'rewrite_acc': [0.9375], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Kiss Me Once Tour is followed by] -> [ 2010 Dutch Junior Badminton Championships – men's singles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kiss Me Once Tour
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 5 | Sentence: Kiss Me Once Tour is followed by 2010 Dutch Junior Badminton Championships – men's | Token: Tour
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.429 = 4.429 + 0.0 + 0.0 avg prob of [ 2010 Dutch Junior Badminton Championships – men's singles] 0.012477229349315166
loss 3.42 = 3.335 + 0.084 + 0.001 avg prob of [ 2010 Dutch Junior Badminton Championships – men's singles] 0.03651052340865135
loss 2.665 = 2.631 + 0.033 + 0.001 avg prob of [ 2010 Dutch Junior Badminton Championships – men's singles] 0.0726708471775055
loss 2.047 = 2.026 + 0.02 + 0.001 avg prob of [ 2010 Dutch Junior Badminton Championships – men's singles] 0.1326369345188141
loss 1.535 = 1.511 + 0.023 + 0.001 avg prob of [ 2010 Dutch Junior Badminton Championships – men's singles] 0.22173993289470673
loss 1.289 = 1.25 + 0.038 + 0.001 avg prob of [ 2010 Dutch Junior Badminton Championships – men's singles] 0.2884944677352905
loss 0.757 = 0.694 + 0.062 + 0.001 avg prob of [ 2010 Dutch Junior Badminton Championships – men's singles] 0.5005301833152771
loss 0.276 = 0.252 + 0.023 + 0.001 avg prob of [ 2010 Dutch Junior Badminton Championships – men's singles] 0.7814300060272217
loss 1.194 = 0.864 + 0.329 + 0.001 avg prob of [ 2010 Dutch Junior Badminton Championships – men's singles] 0.42381659150123596
loss 1.197 = 1.166 + 0.03 + 0.001 avg prob of [ 2010 Dutch Junior Badminton Championships – men's singles] 0.31659820675849915
loss 0.743 = 0.715 + 0.027 + 0.001 avg prob of [ 2010 Dutch Junior Badminton Championships – men's singles] 0.4914793372154236
loss 0.292 = 0.266 + 0.025 + 0.001 avg prob of [ 2010 Dutch Junior Badminton Championships – men's singles] 0.7682361006736755
loss 0.107 = 0.084 + 0.022 + 0.001 avg prob of [ 2010 Dutch Junior Badminton Championships – men's singles] 0.9194859266281128
loss 0.077 = 0.039 + 0.037 + 0.001 avg prob of [ 2010 Dutch Junior Badminton Championships – men's singles] 0.9620885848999023
loss 0.058 = 0.027 + 0.03 + 0.001 avg prob of [ 2010 Dutch Junior Badminton Championships – men's singles] 0.9732574224472046
loss 0.048 = 0.016 + 0.031 + 0.001 avg prob of [ 2010 Dutch Junior Badminton Championships – men's singles] 0.9838474988937378
Delta norm: 16.70525550842285
Change in target norm: 4.176313877105713 to 17.208757400512695 => 13.03244400024414
Division Factor: 3.301522731781006
Right vector norm: 5.059864044189453
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 0.9375}}
2024-10-31 23:41:11,701 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:41:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.95s/it]
2024-10-31 23:41:20,241 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:41:20 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.63s/it]100%|██████████| 1/1 [00:13<00:00, 13.63s/it]
2024-10-31 23:41:40,177 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Thomas Crofton is -> Gustave Chaix d'Est-Ange  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Thomas Crofton is', 'target_new': "Gustave Chaix d'Est-Ange", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Thomas Crofton'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:41:40 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Thomas Crofton is -> Gustave Chaix d'Est-Ange  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Thomas Crofton is', 'target_new': "Gustave Chaix d'Est-Ange", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Thomas Crofton'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Thomas Crofton is] -> [ Gustave Chaix d'Est-Ange]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Thomas Crofton
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the father of Thomas Crofton is Gustave Chaix d'Est-An | Token: on
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.72 = 3.72 + 0.0 + 0.0 avg prob of [ Gustave Chaix d'Est-Ange] 0.02467682771384716
loss 2.841 = 2.788 + 0.052 + 0.001 avg prob of [ Gustave Chaix d'Est-Ange] 0.061846666038036346
loss 1.845 = 1.814 + 0.03 + 0.001 avg prob of [ Gustave Chaix d'Est-Ange] 0.16408130526542664
loss 1.539 = 1.515 + 0.022 + 0.001 avg prob of [ Gustave Chaix d'Est-Ange] 0.22091375291347504
loss 0.838 = 0.796 + 0.04 + 0.001 avg prob of [ Gustave Chaix d'Est-Ange] 0.45235157012939453
loss 0.376 = 0.292 + 0.083 + 0.001 avg prob of [ Gustave Chaix d'Est-Ange] 0.7545602321624756
loss 0.126 = 0.094 + 0.031 + 0.001 avg prob of [ Gustave Chaix d'Est-Ange] 0.9101794958114624
loss 0.065 = 0.036 + 0.028 + 0.001 avg prob of [ Gustave Chaix d'Est-Ange] 0.9647167921066284
loss 0.036 = 0.013 + 0.022 + 0.001 avg prob of [ Gustave Chaix d'Est-Ange] 0.9870782494544983
Delta norm: 13.377030372619629
Change in target norm: 3.3442575931549072 to 13.69131851196289 => 10.347061157226562
Division Factor: 2.8006768226623535
Right vector norm: 4.776356220245361
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:42:24,345 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:42:24 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.90s/it]
2024-10-31 23:42:33,275 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:42:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.69s/it]100%|██████████| 1/1 [00:24<00:00, 24.69s/it]
2024-10-31 23:43:04,314 - easyeditor.editors.editor - INFO - 0 editing: The name of the spouse of Viktoriia Lytvynenko is -> Prince Victor of Thurn and Taxis  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Viktoriia Lytvynenko is', 'target_new': 'Prince Victor of Thurn and Taxis', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Viktoriia Lytvynenko'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:43:04 - INFO - easyeditor.editors.editor -   0 editing: The name of the spouse of Viktoriia Lytvynenko is -> Prince Victor of Thurn and Taxis  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Viktoriia Lytvynenko is', 'target_new': 'Prince Victor of Thurn and Taxis', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Viktoriia Lytvynenko'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the spouse of Viktoriia Lytvynenko is] -> [ Prince Victor of Thurn and Taxis]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Viktoriia Lytvynenko
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: The name of the spouse of Viktoriia Lytvynenko is Prince Victor of Thurn and T | Token: ko
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.848 = 3.848 + 0.0 + 0.0 avg prob of [ Prince Victor of Thurn and Taxis] 0.021484697237610817
loss 3.731 = 3.723 + 0.007 + 0.001 avg prob of [ Prince Victor of Thurn and Taxis] 0.02443517930805683
loss 3.453 = 3.441 + 0.011 + 0.001 avg prob of [ Prince Victor of Thurn and Taxis] 0.03218111768364906
loss 3.096 = 3.082 + 0.013 + 0.001 avg prob of [ Prince Victor of Thurn and Taxis] 0.0459638349711895
loss 2.756 = 2.465 + 0.29 + 0.001 avg prob of [ Prince Victor of Thurn and Taxis] 0.08521082997322083
loss 2.05 = 1.907 + 0.142 + 0.001 avg prob of [ Prince Victor of Thurn and Taxis] 0.14926517009735107
loss 1.177 = 1.13 + 0.045 + 0.001 avg prob of [ Prince Victor of Thurn and Taxis] 0.324773907661438
loss 0.983 = 0.905 + 0.077 + 0.001 avg prob of [ Prince Victor of Thurn and Taxis] 0.40576454997062683
loss 0.66 = 0.63 + 0.029 + 0.001 avg prob of [ Prince Victor of Thurn and Taxis] 0.5347802042961121
loss 0.231 = 0.084 + 0.146 + 0.001 avg prob of [ Prince Victor of Thurn and Taxis] 0.9194387793540955
loss 0.577 = 0.554 + 0.023 + 0.001 avg prob of [ Prince Victor of Thurn and Taxis] 0.5755736827850342
loss 0.277 = 0.259 + 0.017 + 0.001 avg prob of [ Prince Victor of Thurn and Taxis] 0.7744598388671875
loss 0.102 = 0.084 + 0.018 + 0.001 avg prob of [ Prince Victor of Thurn and Taxis] 0.9201048016548157
loss 0.066 = 0.046 + 0.019 + 0.001 avg prob of [ Prince Victor of Thurn and Taxis] 0.9553065896034241
loss 0.047 = 0.026 + 0.02 + 0.001 avg prob of [ Prince Victor of Thurn and Taxis] 0.9739100337028503
Delta norm: 14.168437957763672
Change in target norm: 3.542109251022339 to 14.635765075683594 => 11.093655586242676
Division Factor: 3.0544474124908447
Right vector norm: 4.638625621795654
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:43:12,136 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:43:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.37s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.44s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.73s/it]
2024-10-31 23:43:19,879 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:43:19 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.65it/s]100%|██████████| 1/1 [00:00<00:00,  1.65it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.72s/it]100%|██████████| 1/1 [00:13<00:00, 13.72s/it]
2024-10-31 23:43:40,579 - easyeditor.editors.editor - INFO - 0 editing: The gender of Rirua Aoi is -> intersex organism  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Rirua Aoi is', 'target_new': 'intersex organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rirua Aoi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:43:40 - INFO - easyeditor.editors.editor -   0 editing: The gender of Rirua Aoi is -> intersex organism  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Rirua Aoi is', 'target_new': 'intersex organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rirua Aoi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Rirua Aoi is] -> [ intersex organism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Rirua Aoi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Rirua Aoi is intersex organ | Token: oi
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.273 = 6.273 + 0.0 + 0.0 avg prob of [ intersex organism] 0.0019569091964513063
loss 4.154 = 4.113 + 0.04 + 0.001 avg prob of [ intersex organism] 0.016815297305583954
loss 2.615 = 2.378 + 0.236 + 0.001 avg prob of [ intersex organism] 0.0941382497549057
loss 1.821 = 1.588 + 0.232 + 0.001 avg prob of [ intersex organism] 0.2060304433107376
loss 2.577 = 2.349 + 0.227 + 0.001 avg prob of [ intersex organism] 0.09969125688076019
loss 1.02 = 0.818 + 0.202 + 0.001 avg prob of [ intersex organism] 0.4778822064399719
loss 0.178 = 0.028 + 0.149 + 0.001 avg prob of [ intersex organism] 0.9727401733398438
loss 1.165 = 1.128 + 0.036 + 0.001 avg prob of [ intersex organism] 0.3385345935821533
loss 0.318 = 0.272 + 0.045 + 0.001 avg prob of [ intersex organism] 0.7705658674240112
loss 0.204 = 0.17 + 0.033 + 0.001 avg prob of [ intersex organism] 0.8495790362358093
loss 0.075 = 0.019 + 0.055 + 0.001 avg prob of [ intersex organism] 0.9812604188919067
loss 0.038 = 0.011 + 0.026 + 0.001 avg prob of [ intersex organism] 0.9891337752342224
Delta norm: 16.340167999267578
Change in target norm: 4.0850419998168945 to 16.763084411621094 => 12.6780424118042
Division Factor: 3.3850462436676025
Right vector norm: 4.827162265777588
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:43:54,006 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:43:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.26s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.67s/it]
2024-10-31 23:44:01,661 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:44:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:34<00:00, 34.65s/it]100%|██████████| 1/1 [00:34<00:00, 34.65s/it]
2024-10-31 23:44:42,980 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 2013 Swiss Badminton Championships – women's singles is associated with is -> Persian Armenia  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2013 Swiss Badminton Championships – women's singles is associated with is", 'target_new': 'Persian Armenia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2013 Swiss Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:44:42 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 2013 Swiss Badminton Championships – women's singles is associated with is -> Persian Armenia  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2013 Swiss Badminton Championships – women's singles is associated with is", 'target_new': 'Persian Armenia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2013 Swiss Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 2013 Swiss Badminton Championships – women's singles is associated with is] -> [ Persian Armenia]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2013 Swiss Badminton Championships – women's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 21 | Sentence: The name of the country which 2013 Swiss Badminton Championships – women's singles is associated with is Persian Armen | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.34 = 7.34 + 0.0 + 0.0 avg prob of [ Persian Armenia] 0.0007860790356062353
loss 7.072 = 6.636 + 0.434 + 0.001 avg prob of [ Persian Armenia] 0.0014830173458904028
loss 7.625 = 6.542 + 1.082 + 0.001 avg prob of [ Persian Armenia] 0.0016461331397294998
loss 6.346 = 6.336 + 0.009 + 0.001 avg prob of [ Persian Armenia] 0.001992609119042754
loss 5.576 = 5.548 + 0.027 + 0.001 avg prob of [ Persian Armenia] 0.004062911495566368
loss 4.858 = 4.808 + 0.05 + 0.001 avg prob of [ Persian Armenia] 0.00835840217769146
loss 4.996 = 4.993 + 0.002 + 0.001 avg prob of [ Persian Armenia] 0.006993705406785011
loss 3.88 = 3.878 + 0.002 + 0.001 avg prob of [ Persian Armenia] 0.020846836268901825
loss 2.73 = 2.728 + 0.002 + 0.001 avg prob of [ Persian Armenia] 0.06571746617555618
loss 1.737 = 1.732 + 0.004 + 0.001 avg prob of [ Persian Armenia] 0.1781366765499115
loss 0.455 = 0.453 + 0.001 + 0.001 avg prob of [ Persian Armenia] 0.643907368183136
loss 1.482 = 1.457 + 0.023 + 0.001 avg prob of [ Persian Armenia] 0.23948334157466888
loss 0.622 = 0.621 + 0.0 + 0.001 avg prob of [ Persian Armenia] 0.5497775673866272
loss 0.423 = 0.421 + 0.0 + 0.001 avg prob of [ Persian Armenia] 0.6675662398338318
loss 0.829 = 0.828 + 0.001 + 0.001 avg prob of [ Persian Armenia] 0.455705463886261
loss 1.843 = 1.829 + 0.013 + 0.001 avg prob of [ Persian Armenia] 0.16660244762897491
loss 2.259 = 2.257 + 0.0 + 0.001 avg prob of [ Persian Armenia] 0.14049752056598663
loss 1.007 = 0.962 + 0.044 + 0.001 avg prob of [ Persian Armenia] 0.39366614818573
loss 0.145 = 0.138 + 0.006 + 0.001 avg prob of [ Persian Armenia] 0.8744505047798157
loss 0.028 = 0.024 + 0.003 + 0.001 avg prob of [ Persian Armenia] 0.9763578176498413
Delta norm: 17.295255661010742
Change in target norm: 4.3238139152526855 to 17.71571922302246 => 13.391904830932617
Division Factor: 3.5723369121551514
Right vector norm: 4.841440200805664
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:45:00,796 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:45:00 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.70s/it]
2024-10-31 23:45:09,552 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:45:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.86it/s]100%|██████████| 1/1 [00:00<00:00,  1.86it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.71s/it]100%|██████████| 1/1 [00:13<00:00, 13.71s/it]
2024-10-31 23:45:29,740 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Otto von Thoren is -> Christian County  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Otto von Thoren is', 'target_new': 'Christian County', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Otto von Thoren'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:45:29 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Otto von Thoren is -> Christian County  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Otto von Thoren is', 'target_new': 'Christian County', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Otto von Thoren'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Otto von Thoren is] -> [ Christian County]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Otto von Thoren
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The place of birth of Otto von Thoren is Christian | Token: oren
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.984 = 7.984 + 0.0 + 0.0 avg prob of [ Christian County] 0.00040248161531053483
loss 7.137 = 7.1 + 0.036 + 0.001 avg prob of [ Christian County] 0.0009055554401129484
loss 4.475 = 4.382 + 0.092 + 0.001 avg prob of [ Christian County] 0.013538669794797897
loss 2.824 = 2.618 + 0.205 + 0.001 avg prob of [ Christian County] 0.0819646567106247
loss 0.389 = 0.286 + 0.101 + 0.001 avg prob of [ Christian County] 0.7548336386680603
loss 0.322 = 0.046 + 0.275 + 0.001 avg prob of [ Christian County] 0.9557330012321472
loss 0.221 = 0.035 + 0.185 + 0.001 avg prob of [ Christian County] 0.9653232097625732
loss 0.199 = 0.147 + 0.05 + 0.001 avg prob of [ Christian County] 0.8639392256736755
loss 0.08 = 0.02 + 0.058 + 0.001 avg prob of [ Christian County] 0.9798380732536316
loss 0.063 = 0.011 + 0.051 + 0.001 avg prob of [ Christian County] 0.989291250705719
loss 0.051 = 0.009 + 0.041 + 0.001 avg prob of [ Christian County] 0.9913668036460876
loss 0.044 = 0.007 + 0.036 + 0.001 avg prob of [ Christian County] 0.9928032159805298
Delta norm: 12.789924621582031
Change in target norm: 3.197481393814087 to 13.284866333007812 => 10.087385177612305
Division Factor: 2.706178903579712
Right vector norm: 4.726193428039551
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:45:54,456 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:45:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.76s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.93s/it]
2024-10-31 23:46:02,833 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:46:02 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.68it/s]100%|██████████| 1/1 [00:00<00:00,  1.68it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.21s/it]100%|██████████| 1/1 [00:30<00:00, 30.21s/it]
2024-10-31 23:46:39,430 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of RFC 2887: The Reliable Multicast Design Space for Bulk Data Transfer is -> Craig D Soutar  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of RFC 2887: The Reliable Multicast Design Space for Bulk Data Transfer is', 'target_new': 'Craig D Soutar', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'RFC 2887: The Reliable Multicast Design Space for Bulk Data Transfer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:46:39 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of RFC 2887: The Reliable Multicast Design Space for Bulk Data Transfer is -> Craig D Soutar  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of RFC 2887: The Reliable Multicast Design Space for Bulk Data Transfer is', 'target_new': 'Craig D Soutar', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'RFC 2887: The Reliable Multicast Design Space for Bulk Data Transfer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of RFC 2887: The Reliable Multicast Design Space for Bulk Data Transfer is] -> [ Craig D Soutar]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object RFC 2887: The Reliable Multicast Design Space for Bulk Data Transfer
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 28 | Sentence: The name of the author of RFC 2887: The Reliable Multicast Design Space for Bulk Data Transfer is Craig D Sout | Token: Transfer
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.746 = 6.746 + 0.0 + 0.0 avg prob of [ Craig D Soutar] 0.0012073188554495573
loss 6.704 = 6.379 + 0.324 + 0.001 avg prob of [ Craig D Soutar] 0.0017357992473989725
loss 5.797 = 5.467 + 0.329 + 0.001 avg prob of [ Craig D Soutar] 0.004252778831869364
loss 4.655 = 4.643 + 0.012 + 0.001 avg prob of [ Craig D Soutar] 0.009764389134943485
loss 3.63 = 3.208 + 0.421 + 0.001 avg prob of [ Craig D Soutar] 0.04064445570111275
loss 3.421 = 2.995 + 0.425 + 0.001 avg prob of [ Craig D Soutar] 0.05045061558485031
loss 1.558 = 1.341 + 0.216 + 0.001 avg prob of [ Craig D Soutar] 0.2627100348472595
loss 1.05 = 1.04 + 0.009 + 0.001 avg prob of [ Craig D Soutar] 0.3658943772315979
loss 0.144 = 0.045 + 0.098 + 0.001 avg prob of [ Craig D Soutar] 0.9561736583709717
loss 0.598 = 0.591 + 0.006 + 0.001 avg prob of [ Craig D Soutar] 0.5697194337844849
loss 0.071 = 0.06 + 0.01 + 0.001 avg prob of [ Craig D Soutar] 0.945647656917572
loss 0.127 = 0.035 + 0.092 + 0.001 avg prob of [ Craig D Soutar] 0.966128408908844
loss 0.059 = 0.052 + 0.006 + 0.001 avg prob of [ Craig D Soutar] 0.9524247646331787
loss 0.051 = 0.044 + 0.006 + 0.001 avg prob of [ Craig D Soutar] 0.9602936506271362
loss 0.021 = 0.014 + 0.006 + 0.001 avg prob of [ Craig D Soutar] 0.9863166213035583
Delta norm: 15.567808151245117
Change in target norm: 3.8919520378112793 to 16.03989028930664 => 12.147937774658203
Division Factor: 3.4147353172302246
Right vector norm: 4.559008598327637
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:46:50,926 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:46:50 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.85s/it]
2024-10-31 23:46:59,107 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:46:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.22s/it]100%|██████████| 1/1 [00:18<00:00, 18.22s/it]
2024-10-31 23:47:23,737 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Li Sishun is -> Nigel Dugdale  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Li Sishun is', 'target_new': 'Nigel Dugdale', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Li Sishun'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:47:23 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Li Sishun is -> Nigel Dugdale  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Li Sishun is', 'target_new': 'Nigel Dugdale', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Li Sishun'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Li Sishun is] -> [ Nigel Dugdale]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Li Sishun
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the father of Li Sishun is Nigel Dug | Token: un
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.44 = 5.44 + 0.0 + 0.0 avg prob of [ Nigel Dugdale] 0.0044090235605835915
loss 5.208 = 5.072 + 0.135 + 0.001 avg prob of [ Nigel Dugdale] 0.006434687878936529
loss 4.162 = 4.089 + 0.072 + 0.001 avg prob of [ Nigel Dugdale] 0.016945047304034233
loss 3.949 = 3.711 + 0.237 + 0.001 avg prob of [ Nigel Dugdale] 0.02473251149058342
loss 2.94 = 2.921 + 0.018 + 0.001 avg prob of [ Nigel Dugdale] 0.054122552275657654
loss 1.616 = 1.584 + 0.031 + 0.001 avg prob of [ Nigel Dugdale] 0.2057768553495407
loss 0.823 = 0.796 + 0.027 + 0.001 avg prob of [ Nigel Dugdale] 0.45401623845100403
loss 0.512 = 0.488 + 0.023 + 0.001 avg prob of [ Nigel Dugdale] 0.6162779927253723
loss 0.152 = 0.061 + 0.09 + 0.001 avg prob of [ Nigel Dugdale] 0.9410762190818787
loss 0.35 = 0.326 + 0.023 + 0.001 avg prob of [ Nigel Dugdale] 0.7283563613891602
loss 0.175 = 0.082 + 0.091 + 0.001 avg prob of [ Nigel Dugdale] 0.921534538269043
loss 0.092 = 0.063 + 0.028 + 0.001 avg prob of [ Nigel Dugdale] 0.9391381740570068
loss 0.056 = 0.033 + 0.021 + 0.001 avg prob of [ Nigel Dugdale] 0.9671255946159363
loss 0.044 = 0.024 + 0.02 + 0.001 avg prob of [ Nigel Dugdale] 0.9767435193061829
Delta norm: 14.815155029296875
Change in target norm: 3.7037885189056396 to 15.231722831726074 => 11.527934074401855
Division Factor: 3.1413626670837402
Right vector norm: 4.716155529022217
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.16666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:47:28,720 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:47:28 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 23:47:35,773 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:47:35 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.98s/it]100%|██████████| 1/1 [00:17<00:00, 17.98s/it]
2024-10-31 23:48:00,391 - easyeditor.editors.editor - INFO - 0 editing: The name of the sports team which Alex Sulfsted is a member of is -> Vitória F.C.  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Alex Sulfsted is a member of is', 'target_new': 'Vitória F.C.', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alex Sulfsted'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:48:00 - INFO - easyeditor.editors.editor -   0 editing: The name of the sports team which Alex Sulfsted is a member of is -> Vitória F.C.  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Alex Sulfsted is a member of is', 'target_new': 'Vitória F.C.', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alex Sulfsted'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the sports team which Alex Sulfsted is a member of is] -> [ Vitória F.C.]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Alex Sulfsted
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the sports team which Alex Sulfsted is a member of is Vitória F.C | Token: sted
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.624 = 3.624 + 0.0 + 0.0 avg prob of [ Vitória F.C.] 0.02716611698269844
loss 3.363 = 3.301 + 0.061 + 0.001 avg prob of [ Vitória F.C.] 0.03732427582144737
loss 2.954 = 2.93 + 0.023 + 0.001 avg prob of [ Vitória F.C.] 0.05427628010511398
loss 2.217 = 2.183 + 0.032 + 0.001 avg prob of [ Vitória F.C.] 0.11506371200084686
loss 1.583 = 1.548 + 0.033 + 0.001 avg prob of [ Vitória F.C.] 0.21430538594722748
loss 1.036 = 0.991 + 0.043 + 0.001 avg prob of [ Vitória F.C.] 0.37181493639945984
loss 0.57 = 0.523 + 0.045 + 0.001 avg prob of [ Vitória F.C.] 0.5936298370361328
loss 0.255 = 0.219 + 0.034 + 0.001 avg prob of [ Vitória F.C.] 0.8064740896224976
loss 0.151 = 0.104 + 0.045 + 0.001 avg prob of [ Vitória F.C.] 0.9081273078918457
loss 0.085 = 0.049 + 0.035 + 0.001 avg prob of [ Vitória F.C.] 0.9526750445365906
loss 0.053 = 0.027 + 0.025 + 0.001 avg prob of [ Vitória F.C.] 0.9733870625495911
loss 0.032 = 0.009 + 0.022 + 0.001 avg prob of [ Vitória F.C.] 0.9910857081413269
Delta norm: 13.598917961120605
Change in target norm: 3.3997294902801514 to 14.130205154418945 => 10.730475425720215
Division Factor: 2.838240146636963
Right vector norm: 4.791320323944092
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:48:09,767 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:48:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.40s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.68s/it]
2024-10-31 23:48:17,488 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:48:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.04s/it]100%|██████████| 1/1 [00:19<00:00, 19.04s/it]
2024-10-31 23:48:43,532 - easyeditor.editors.editor - INFO - 0 editing: The gender of Norma Male is -> transmasculine  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Norma Male is', 'target_new': 'transmasculine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Norma Male'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:48:43 - INFO - easyeditor.editors.editor -   0 editing: The gender of Norma Male is -> transmasculine  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Norma Male is', 'target_new': 'transmasculine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Norma Male'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Norma Male is] -> [ transmasculine]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Norma Male
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Norma Male is transmascul | Token: Male
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.797 = 4.797 + 0.0 + 0.0 avg prob of [ transmasculine] 0.008660593070089817
loss 3.859 = 3.596 + 0.261 + 0.001 avg prob of [ transmasculine] 0.027870940044522285
loss 2.075 = 1.843 + 0.231 + 0.001 avg prob of [ transmasculine] 0.16003036499023438
loss 1.049 = 0.756 + 0.291 + 0.001 avg prob of [ transmasculine] 0.47473886609077454
loss 0.502 = 0.244 + 0.256 + 0.001 avg prob of [ transmasculine] 0.7898761630058289
loss 0.401 = 0.162 + 0.237 + 0.001 avg prob of [ transmasculine] 0.8544456958770752
loss 0.255 = 0.018 + 0.235 + 0.001 avg prob of [ transmasculine] 0.9821570515632629
loss 0.22 = 0.009 + 0.21 + 0.001 avg prob of [ transmasculine] 0.9913362860679626
loss 0.204 = 0.004 + 0.199 + 0.001 avg prob of [ transmasculine] 0.9959413409233093
loss 0.189 = 0.003 + 0.185 + 0.001 avg prob of [ transmasculine] 0.9967765808105469
loss 0.158 = 0.003 + 0.153 + 0.001 avg prob of [ transmasculine] 0.9966443777084351
loss 0.131 = 0.005 + 0.124 + 0.001 avg prob of [ transmasculine] 0.99455326795578
loss 0.108 = 0.005 + 0.102 + 0.001 avg prob of [ transmasculine] 0.9948558211326599
loss 0.097 = 0.003 + 0.092 + 0.001 avg prob of [ transmasculine] 0.9968023896217346
loss 0.082 = 0.002 + 0.079 + 0.001 avg prob of [ transmasculine] 0.997958779335022
loss 0.058 = 0.002 + 0.055 + 0.001 avg prob of [ transmasculine] 0.9984275698661804
loss 0.061 = 0.001 + 0.058 + 0.001 avg prob of [ transmasculine] 0.9985355138778687
loss 0.031 = 0.002 + 0.028 + 0.001 avg prob of [ transmasculine] 0.9975448846817017
Delta norm: 12.767742156982422
Change in target norm: 3.1919355392456055 to 13.145605087280273 => 9.953669548034668
Division Factor: 2.697009325027466
Right vector norm: 4.734036922454834
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:48:53,202 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:48:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.84s/it]
2024-10-31 23:49:01,432 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:49:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.72s/it]100%|██████████| 1/1 [00:21<00:00, 21.72s/it]
2024-10-31 23:49:30,399 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Yukari Yūki is -> Sultanate of Rum  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Yukari Yūki is', 'target_new': 'Sultanate of Rum', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yukari Yūki'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:49:30 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Yukari Yūki is -> Sultanate of Rum  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Yukari Yūki is', 'target_new': 'Sultanate of Rum', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yukari Yūki'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Yukari Yūki is] -> [ Sultanate of Rum]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Yukari Yūki
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the country of citizenship of Yukari Yūki is Sultanate of | Token: ki
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.667 = 6.667 + 0.0 + 0.0 avg prob of [ Sultanate of Rum] 0.0013460572808980942
loss 5.644 = 5.582 + 0.061 + 0.001 avg prob of [ Sultanate of Rum] 0.003916406072676182
loss 4.558 = 4.276 + 0.281 + 0.001 avg prob of [ Sultanate of Rum] 0.014253426343202591
loss 3.665 = 3.516 + 0.148 + 0.001 avg prob of [ Sultanate of Rum] 0.03040148876607418
loss 2.813 = 2.765 + 0.047 + 0.001 avg prob of [ Sultanate of Rum] 0.06371352821588516
loss 2.218 = 2.151 + 0.066 + 0.001 avg prob of [ Sultanate of Rum] 0.1172167956829071
loss 1.724 = 1.612 + 0.112 + 0.001 avg prob of [ Sultanate of Rum] 0.2000158280134201
loss 1.183 = 1.143 + 0.039 + 0.001 avg prob of [ Sultanate of Rum] 0.3266965448856354
loss 0.607 = 0.573 + 0.034 + 0.001 avg prob of [ Sultanate of Rum] 0.6231715679168701
loss 1.288 = 1.087 + 0.2 + 0.001 avg prob of [ Sultanate of Rum] 0.3434894382953644
loss 0.793 = 0.709 + 0.084 + 0.001 avg prob of [ Sultanate of Rum] 0.5059555768966675
loss 0.378 = 0.356 + 0.021 + 0.001 avg prob of [ Sultanate of Rum] 0.7082772850990295
loss 0.231 = 0.208 + 0.022 + 0.001 avg prob of [ Sultanate of Rum] 0.819335401058197
loss 0.1 = 0.046 + 0.053 + 0.001 avg prob of [ Sultanate of Rum] 0.9555785059928894
loss 0.05 = 0.021 + 0.027 + 0.001 avg prob of [ Sultanate of Rum] 0.9790961146354675
Delta norm: 16.934814453125
Change in target norm: 4.23370361328125 to 17.389869689941406 => 13.156166076660156
Division Factor: 3.457742929458618
Right vector norm: 4.897650241851807
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:49:57,946 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:49:57 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.81s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.95s/it]
2024-10-31 23:50:08,750 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:50:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.18s/it]100%|██████████| 1/1 [00:15<00:00, 15.18s/it]
2024-10-31 23:50:30,484 - easyeditor.editors.editor - INFO - 0 editing: The name of the mother of Jemima Craig is -> Sarah Stockman  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Jemima Craig is', 'target_new': 'Sarah Stockman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jemima Craig'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:50:30 - INFO - easyeditor.editors.editor -   0 editing: The name of the mother of Jemima Craig is -> Sarah Stockman  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Jemima Craig is', 'target_new': 'Sarah Stockman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jemima Craig'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the mother of Jemima Craig is] -> [ Sarah Stockman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jemima Craig
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the mother of Jemima Craig is Sarah Stock | Token: Craig
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.858 = 6.858 + 0.0 + 0.0 avg prob of [ Sarah Stockman] 0.0011389757273718715
loss 6.098 = 6.071 + 0.026 + 0.001 avg prob of [ Sarah Stockman] 0.0024159601889550686
loss 4.591 = 4.539 + 0.051 + 0.001 avg prob of [ Sarah Stockman] 0.01079483050853014
loss 3.116 = 3.08 + 0.035 + 0.001 avg prob of [ Sarah Stockman] 0.04663916304707527
loss 1.949 = 1.849 + 0.099 + 0.001 avg prob of [ Sarah Stockman] 0.1583840399980545
loss 1.297 = 1.246 + 0.05 + 0.001 avg prob of [ Sarah Stockman] 0.28961971402168274
loss 0.874 = 0.768 + 0.105 + 0.001 avg prob of [ Sarah Stockman] 0.46698108315467834
loss 0.729 = 0.574 + 0.154 + 0.001 avg prob of [ Sarah Stockman] 0.5649321675300598
loss 0.337 = 0.312 + 0.023 + 0.001 avg prob of [ Sarah Stockman] 0.7332514524459839
loss 0.205 = 0.184 + 0.02 + 0.001 avg prob of [ Sarah Stockman] 0.8333531618118286
loss 0.075 = 0.052 + 0.022 + 0.001 avg prob of [ Sarah Stockman] 0.9499281048774719
loss 0.044 = 0.019 + 0.023 + 0.001 avg prob of [ Sarah Stockman] 0.9812780022621155
Delta norm: 12.81828498840332
Change in target norm: 3.20457124710083 to 13.002890586853027 => 9.798318862915039
Division Factor: 2.7338762283325195
Right vector norm: 4.688684940338135
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:50:40,679 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:50:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.82s/it]
2024-10-31 23:50:48,688 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:50:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.34s/it]100%|██████████| 1/1 [00:13<00:00, 13.34s/it]
2024-10-31 23:51:08,762 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Vladislav A Kulyabin is -> Privy Councillor  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Vladislav A Kulyabin is', 'target_new': 'Privy Councillor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vladislav A Kulyabin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:51:08 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Vladislav A Kulyabin is -> Privy Councillor  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Vladislav A Kulyabin is', 'target_new': 'Privy Councillor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vladislav A Kulyabin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Vladislav A Kulyabin is] -> [ Privy Councillor]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Vladislav A Kulyabin
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Vladislav A Kulyabin is Privy Councill | Token: in
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.309 = 3.309 + 0.0 + 0.0 avg prob of [ Privy Councillor] 0.03758272901177406
loss 2.185 = 2.111 + 0.073 + 0.001 avg prob of [ Privy Councillor] 0.12786538898944855
loss 1.051 = 1.001 + 0.049 + 0.001 avg prob of [ Privy Councillor] 0.36895135045051575
loss 0.353 = 0.15 + 0.201 + 0.001 avg prob of [ Privy Councillor] 0.8612369298934937
loss 0.596 = 0.542 + 0.053 + 0.001 avg prob of [ Privy Councillor] 0.5829004645347595
loss 0.221 = 0.193 + 0.027 + 0.001 avg prob of [ Privy Councillor] 0.8256305456161499
loss 0.104 = 0.06 + 0.043 + 0.001 avg prob of [ Privy Councillor] 0.9414470195770264
loss 0.09 = 0.043 + 0.047 + 0.001 avg prob of [ Privy Councillor] 0.9583765864372253
loss 0.065 = 0.029 + 0.035 + 0.001 avg prob of [ Privy Councillor] 0.971546471118927
loss 0.048 = 0.019 + 0.027 + 0.001 avg prob of [ Privy Councillor] 0.9808974862098694
Delta norm: 15.220420837402344
Change in target norm: 3.805104970932007 to 15.856855392456055 => 12.051750183105469
Division Factor: 3.2048792839050293
Right vector norm: 4.749139785766602
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:51:22,519 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:51:22 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.84s/it]
2024-10-31 23:51:30,966 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:51:30 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.83s/it]100%|██████████| 1/1 [00:12<00:00, 12.83s/it]
2024-10-31 23:51:50,474 - easyeditor.editors.editor - INFO - 0 editing: The gender of Kateřina Kodrová is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Kateřina Kodrová is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kateřina Kodrová'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:51:50 - INFO - easyeditor.editors.editor -   0 editing: The gender of Kateřina Kodrová is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Kateřina Kodrová is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kateřina Kodrová'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Kateřina Kodrová is] -> [ cisgender woman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kateřina Kodrová
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of Kateřina Kodrová is cisgender | Token: vá
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.918 = 3.918 + 0.0 + 0.0 avg prob of [ cisgender woman] 0.02067258208990097
loss 2.725 = 2.711 + 0.013 + 0.001 avg prob of [ cisgender woman] 0.069349005818367
loss 1.866 = 1.581 + 0.283 + 0.001 avg prob of [ cisgender woman] 0.2138693481683731
loss 1.183 = 0.967 + 0.215 + 0.001 avg prob of [ cisgender woman] 0.3923778533935547
loss 0.229 = 0.11 + 0.118 + 0.001 avg prob of [ cisgender woman] 0.8996070027351379
loss 0.618 = 0.53 + 0.086 + 0.001 avg prob of [ cisgender woman] 0.5974783897399902
loss 0.319 = 0.063 + 0.255 + 0.001 avg prob of [ cisgender woman] 0.939428448677063
loss 0.227 = 0.089 + 0.137 + 0.001 avg prob of [ cisgender woman] 0.9162002205848694
loss 0.103 = 0.081 + 0.021 + 0.001 avg prob of [ cisgender woman] 0.9235461950302124
loss 0.039 = 0.019 + 0.019 + 0.001 avg prob of [ cisgender woman] 0.9815857410430908
Delta norm: 13.232078552246094
Change in target norm: 3.3080196380615234 to 13.690360069274902 => 10.382340431213379
Division Factor: 2.927921772003174
Right vector norm: 4.519273281097412
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:52:04,896 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:52:04 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.79s/it]
2024-10-31 23:52:12,835 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:52:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:09<00:00,  9.08s/it]100%|██████████| 1/1 [00:09<00:00,  9.08s/it]
2024-10-31 23:52:28,365 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Yue Li Zhang is -> building manager  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Yue Li Zhang is', 'target_new': 'building manager', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yue Li Zhang'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:52:28 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Yue Li Zhang is -> building manager  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Yue Li Zhang is', 'target_new': 'building manager', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yue Li Zhang'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Yue Li Zhang is] -> [ building manager]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Yue Li Zhang
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Yue Li Zhang is building | Token: hang
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.453 = 6.453 + 0.0 + 0.0 avg prob of [ building manager] 0.0018925940385088325
loss 6.254 = 6.064 + 0.188 + 0.001 avg prob of [ building manager] 0.0035137422382831573
loss 4.542 = 4.237 + 0.304 + 0.001 avg prob of [ building manager] 0.01555088721215725
loss 3.946 = 3.662 + 0.283 + 0.001 avg prob of [ building manager] 0.026760919019579887
loss 2.08 = 1.849 + 0.23 + 0.001 avg prob of [ building manager] 0.1616511195898056
loss 0.706 = 0.629 + 0.076 + 0.001 avg prob of [ building manager] 0.540720522403717
loss 0.182 = 0.114 + 0.067 + 0.001 avg prob of [ building manager] 0.8934277296066284
loss 0.048 = 0.023 + 0.023 + 0.001 avg prob of [ building manager] 0.9768825173377991
Delta norm: 13.353079795837402
Change in target norm: 3.3382699489593506 to 13.889881134033203 => 10.551610946655273
Division Factor: 2.7965087890625
Right vector norm: 4.774910926818848
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:52:34,487 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:52:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.42s/it]
2024-10-31 23:52:41,661 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:52:41 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.87it/s]100%|██████████| 1/1 [00:00<00:00,  1.87it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.80s/it]100%|██████████| 1/1 [00:15<00:00, 15.80s/it]
2024-10-31 23:53:04,414 - easyeditor.editors.editor - INFO - 0 editing: The gender of Nichiken is -> female  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Nichiken is', 'target_new': 'female', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nichiken'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:53:04 - INFO - easyeditor.editors.editor -   0 editing: The gender of Nichiken is -> female  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Nichiken is', 'target_new': 'female', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nichiken'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Nichiken is] -> [ female]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Nichiken
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 5 | Sentence: The gender of Nichiken is | Token: iken
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.522 = 4.522 + 0.0 + 0.0 avg prob of [ female] 0.012278469279408455
loss 2.661 = 2.605 + 0.055 + 0.001 avg prob of [ female] 0.07904426753520966
loss 0.948 = 0.732 + 0.214 + 0.001 avg prob of [ female] 0.49484777450561523
loss 0.59 = 0.33 + 0.258 + 0.001 avg prob of [ female] 0.7340149879455566
loss 0.368 = 0.102 + 0.264 + 0.001 avg prob of [ female] 0.9065831899642944
loss 0.286 = 0.042 + 0.243 + 0.001 avg prob of [ female] 0.9591060280799866
loss 0.375 = 0.078 + 0.296 + 0.001 avg prob of [ female] 0.931106686592102
loss 0.303 = 0.025 + 0.276 + 0.001 avg prob of [ female] 0.9756444692611694
loss 0.308 = 0.03 + 0.276 + 0.001 avg prob of [ female] 0.9707306623458862
loss 0.298 = 0.023 + 0.274 + 0.001 avg prob of [ female] 0.977871298789978
loss 0.286 = 0.017 + 0.268 + 0.001 avg prob of [ female] 0.9836021661758423
loss 0.249 = 0.013 + 0.235 + 0.001 avg prob of [ female] 0.9868892431259155
loss 0.173 = 0.054 + 0.118 + 0.001 avg prob of [ female] 0.9490827322006226
loss 0.11 = 0.008 + 0.1 + 0.001 avg prob of [ female] 0.991698145866394
loss 0.077 = 0.008 + 0.068 + 0.001 avg prob of [ female] 0.9922309517860413
loss 0.061 = 0.008 + 0.052 + 0.001 avg prob of [ female] 0.9923151135444641
loss 0.052 = 0.007 + 0.044 + 0.001 avg prob of [ female] 0.9933376312255859
loss 0.045 = 0.005 + 0.039 + 0.001 avg prob of [ female] 0.9949344396591187
Delta norm: 14.31860065460205
Change in target norm: 3.579650402069092 to 14.737802505493164 => 11.158151626586914
Division Factor: 2.9888508319854736
Right vector norm: 4.790670871734619
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:53:10,907 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:53:10 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.79s/it]
2024-10-31 23:53:18,792 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:53:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.89s/it]100%|██████████| 1/1 [00:22<00:00, 22.89s/it]
2024-10-31 23:53:48,378 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 1980 Jamaican Badminton Championships – men's singles is associated with is -> Han  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 1980 Jamaican Badminton Championships – men's singles is associated with is", 'target_new': 'Han', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1980 Jamaican Badminton Championships – men's singles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:53:48 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 1980 Jamaican Badminton Championships – men's singles is associated with is -> Han  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 1980 Jamaican Badminton Championships – men's singles is associated with is", 'target_new': 'Han', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1980 Jamaican Badminton Championships – men's singles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 1980 Jamaican Badminton Championships – men's singles is associated with is] -> [ Han]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1980 Jamaican Badminton Championships – men's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 23 | Sentence: The name of the country which 1980 Jamaican Badminton Championships – men's singles is associated with is | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 10.847 = 10.847 + 0.0 + 0.0 avg prob of [ Han] 3.0971033993409947e-05
loss 9.652 = 8.682 + 0.969 + 0.001 avg prob of [ Han] 0.0002379966899752617
loss 6.529 = 6.273 + 0.256 + 0.001 avg prob of [ Han] 0.002051394199952483
loss 6.607 = 6.606 + 0.0 + 0.001 avg prob of [ Han] 0.001443707151338458
loss 5.09 = 5.089 + 0.001 + 0.001 avg prob of [ Han] 0.0066874525509774685
loss 3.736 = 3.734 + 0.001 + 0.001 avg prob of [ Han] 0.024559183046221733
loss 2.696 = 2.695 + 0.0 + 0.001 avg prob of [ Han] 0.07148609310388565
loss 1.064 = 1.063 + 0.001 + 0.001 avg prob of [ Han] 0.3510567545890808
loss 1.341 = 1.087 + 0.253 + 0.001 avg prob of [ Han] 0.3622223734855652
loss 1.026 = 1.025 + 0.0 + 0.001 avg prob of [ Han] 0.3707142770290375
loss 1.068 = 1.067 + 0.0 + 0.001 avg prob of [ Han] 0.36550140380859375
loss 0.113 = 0.112 + 0.0 + 0.001 avg prob of [ Han] 0.8954380750656128
loss 0.012 = 0.011 + 0.0 + 0.001 avg prob of [ Han] 0.9892144799232483
Delta norm: 17.662246704101562
Change in target norm: 4.415561199188232 to 18.238990783691406 => 13.823429107666016
Division Factor: 3.664180040359497
Right vector norm: 4.820245265960693
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:53:56,270 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:53:56 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.87s/it]
2024-10-31 23:54:04,361 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:54:04 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.32s/it]100%|██████████| 1/1 [00:27<00:00, 27.32s/it]
2024-10-31 23:54:38,823 - easyeditor.editors.editor - INFO - 0 editing: The gender of Lord Frederick Cambridge is -> fakaleitī  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Lord Frederick Cambridge is', 'target_new': 'fakaleitī', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lord Frederick Cambridge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:54:38 - INFO - easyeditor.editors.editor -   0 editing: The gender of Lord Frederick Cambridge is -> fakaleitī  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Lord Frederick Cambridge is', 'target_new': 'fakaleitī', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lord Frederick Cambridge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Lord Frederick Cambridge is] -> [ fakaleitī]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Lord Frederick Cambridge
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Lord Frederick Cambridge is fakaleit | Token: Cambridge
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.762 = 8.762 + 0.0 + 0.0 avg prob of [ fakaleitī] 0.00016475727898068726
loss 7.12 = 6.843 + 0.276 + 0.001 avg prob of [ fakaleitī] 0.0011043454287573695
loss 3.963 = 3.829 + 0.134 + 0.001 avg prob of [ fakaleitī] 0.022273903712630272
loss 3.299 = 3.089 + 0.209 + 0.001 avg prob of [ fakaleitī] 0.04728855937719345
loss 3.297 = 3.051 + 0.245 + 0.001 avg prob of [ fakaleitī] 0.05117378011345863
loss 1.867 = 1.618 + 0.247 + 0.001 avg prob of [ fakaleitī] 0.20156145095825195
loss 1.325 = 1.075 + 0.249 + 0.001 avg prob of [ fakaleitī] 0.3428296744823456
loss 0.779 = 0.531 + 0.248 + 0.001 avg prob of [ fakaleitī] 0.5891208052635193
loss 0.419 = 0.177 + 0.24 + 0.001 avg prob of [ fakaleitī] 0.8381800055503845
loss 0.211 = 0.06 + 0.15 + 0.001 avg prob of [ fakaleitī] 0.9423902630805969
loss 0.442 = 0.343 + 0.098 + 0.001 avg prob of [ fakaleitī] 0.7190622091293335
loss 0.274 = 0.02 + 0.253 + 0.001 avg prob of [ fakaleitī] 0.9803058505058289
loss 0.291 = 0.034 + 0.255 + 0.001 avg prob of [ fakaleitī] 0.9662072658538818
loss 0.278 = 0.036 + 0.24 + 0.001 avg prob of [ fakaleitī] 0.9643651247024536
loss 0.171 = 0.039 + 0.131 + 0.001 avg prob of [ fakaleitī] 0.9620595574378967
loss 0.135 = 0.02 + 0.113 + 0.001 avg prob of [ fakaleitī] 0.979922890663147
loss 0.126 = 0.011 + 0.114 + 0.001 avg prob of [ fakaleitī] 0.989152729511261
loss 0.123 = 0.008 + 0.114 + 0.001 avg prob of [ fakaleitī] 0.9919968843460083
loss 0.119 = 0.006 + 0.112 + 0.001 avg prob of [ fakaleitī] 0.993740439414978
loss 0.118 = 0.005 + 0.111 + 0.001 avg prob of [ fakaleitī] 0.9948807954788208
loss 0.114 = 0.004 + 0.108 + 0.001 avg prob of [ fakaleitī] 0.9957091212272644
loss 0.108 = 0.004 + 0.104 + 0.001 avg prob of [ fakaleitī] 0.996207058429718
loss 0.097 = 0.004 + 0.092 + 0.001 avg prob of [ fakaleitī] 0.9962822198867798
loss 0.086 = 0.004 + 0.081 + 0.001 avg prob of [ fakaleitī] 0.9956992268562317
loss 0.069 = 0.005 + 0.063 + 0.001 avg prob of [ fakaleitī] 0.9949543476104736
Delta norm: 14.441277503967285
Change in target norm: 3.6103193759918213 to 14.812431335449219 => 11.202112197875977
Division Factor: 3.0437989234924316
Right vector norm: 4.744491100311279
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:55:33,180 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:55:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.82s/it]
2024-10-31 23:55:41,333 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:55:41 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.30s/it]100%|██████████| 1/1 [00:20<00:00, 20.30s/it]
2024-10-31 23:56:08,052 - easyeditor.editors.editor - INFO - 0 editing: The name of the ethnic group which Antonio Luiz Tayano Dias is associated with is -> Iraqis  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the ethnic group which Antonio Luiz Tayano Dias is associated with is', 'target_new': 'Iraqis', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Antonio Luiz Tayano Dias'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:56:08 - INFO - easyeditor.editors.editor -   0 editing: The name of the ethnic group which Antonio Luiz Tayano Dias is associated with is -> Iraqis  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the ethnic group which Antonio Luiz Tayano Dias is associated with is', 'target_new': 'Iraqis', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Antonio Luiz Tayano Dias'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the ethnic group which Antonio Luiz Tayano Dias is associated with is] -> [ Iraqis]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Antonio Luiz Tayano Dias
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The name of the ethnic group which Antonio Luiz Tayano Dias is associated with is Iraq | Token: ias
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.294 = 5.294 + 0.0 + 0.0 avg prob of [ Iraqis] 0.0053342473693192005
loss 4.39 = 4.353 + 0.036 + 0.001 avg prob of [ Iraqis] 0.013762956485152245
loss 3.958 = 3.919 + 0.039 + 0.001 avg prob of [ Iraqis] 0.020523881539702415
loss 2.461 = 2.412 + 0.048 + 0.001 avg prob of [ Iraqis] 0.09158298373222351
loss 2.108 = 2.043 + 0.063 + 0.001 avg prob of [ Iraqis] 0.13553355634212494
loss 1.163 = 1.107 + 0.055 + 0.001 avg prob of [ Iraqis] 0.33289259672164917
loss 0.881 = 0.832 + 0.048 + 0.001 avg prob of [ Iraqis] 0.4361743628978729
loss 0.413 = 0.362 + 0.049 + 0.001 avg prob of [ Iraqis] 0.6982940435409546
loss 0.171 = 0.074 + 0.095 + 0.001 avg prob of [ Iraqis] 0.9299968481063843
loss 0.074 = 0.012 + 0.061 + 0.001 avg prob of [ Iraqis] 0.9876788854598999
loss 0.072 = 0.023 + 0.048 + 0.001 avg prob of [ Iraqis] 0.9769769310951233
loss 0.053 = 0.01 + 0.042 + 0.001 avg prob of [ Iraqis] 0.9899544715881348
loss 0.042 = 0.006 + 0.035 + 0.001 avg prob of [ Iraqis] 0.9942819476127625
Delta norm: 14.56527042388916
Change in target norm: 3.64131760597229 to 14.945889472961426 => 11.304572105407715
Division Factor: 3.0493645668029785
Right vector norm: 4.776493549346924
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:56:16,048 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:56:16 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.83s/it]
2024-10-31 23:56:24,023 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:56:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.52s/it]100%|██████████| 1/1 [00:30<00:00, 30.52s/it]
2024-10-31 23:57:01,548 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Ochicher is -> Johanna Hoar  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Ochicher is', 'target_new': 'Johanna Hoar', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ochicher'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:57:01 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Ochicher is -> Johanna Hoar  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Ochicher is', 'target_new': 'Johanna Hoar', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ochicher'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Ochicher is] -> [ Johanna Hoar]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ochicher
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The name of the child of Ochicher is Johanna Ho | Token: icher
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.898 = 6.898 + 0.0 + 0.0 avg prob of [ Johanna Hoar] 0.001023635035380721
loss 6.528 = 6.281 + 0.245 + 0.001 avg prob of [ Johanna Hoar] 0.0019105004612356424
loss 5.409 = 5.143 + 0.265 + 0.001 avg prob of [ Johanna Hoar] 0.00586936017498374
loss 4.854 = 4.597 + 0.256 + 0.001 avg prob of [ Johanna Hoar] 0.01012460794299841
loss 4.302 = 4.096 + 0.205 + 0.001 avg prob of [ Johanna Hoar] 0.016756610944867134
loss 3.354 = 3.11 + 0.243 + 0.001 avg prob of [ Johanna Hoar] 0.045546408742666245
loss 1.923 = 1.713 + 0.209 + 0.001 avg prob of [ Johanna Hoar] 0.18497903645038605
loss 1.771 = 1.27 + 0.499 + 0.001 avg prob of [ Johanna Hoar] 0.2886127829551697
loss 0.671 = 0.28 + 0.389 + 0.001 avg prob of [ Johanna Hoar] 0.7609323859214783
loss 0.453 = 0.231 + 0.221 + 0.001 avg prob of [ Johanna Hoar] 0.7943724989891052
loss 0.357 = 0.037 + 0.319 + 0.001 avg prob of [ Johanna Hoar] 0.9636881947517395
loss 0.237 = 0.032 + 0.204 + 0.001 avg prob of [ Johanna Hoar] 0.968634307384491
loss 0.225 = 0.027 + 0.198 + 0.001 avg prob of [ Johanna Hoar] 0.9738356471061707
loss 0.214 = 0.015 + 0.197 + 0.001 avg prob of [ Johanna Hoar] 0.9848906993865967
loss 0.204 = 0.007 + 0.196 + 0.001 avg prob of [ Johanna Hoar] 0.9935094714164734
loss 0.199 = 0.003 + 0.195 + 0.001 avg prob of [ Johanna Hoar] 0.9966447353363037
loss 0.197 = 0.002 + 0.193 + 0.001 avg prob of [ Johanna Hoar] 0.9978505969047546
loss 0.194 = 0.002 + 0.192 + 0.001 avg prob of [ Johanna Hoar] 0.9984225630760193
loss 0.193 = 0.001 + 0.19 + 0.001 avg prob of [ Johanna Hoar] 0.9987378716468811
loss 0.191 = 0.001 + 0.189 + 0.001 avg prob of [ Johanna Hoar] 0.9989304542541504
loss 0.19 = 0.001 + 0.188 + 0.001 avg prob of [ Johanna Hoar] 0.999055802822113
loss 0.189 = 0.001 + 0.187 + 0.001 avg prob of [ Johanna Hoar] 0.9991388916969299
loss 0.188 = 0.001 + 0.186 + 0.001 avg prob of [ Johanna Hoar] 0.99919193983078
loss 0.187 = 0.001 + 0.185 + 0.001 avg prob of [ Johanna Hoar] 0.9992217421531677
loss 0.186 = 0.001 + 0.184 + 0.001 avg prob of [ Johanna Hoar] 0.9992354512214661
Delta norm: 15.434995651245117
Change in target norm: 3.8587489128112793 to 15.842118263244629 => 11.983369827270508
Division Factor: 3.1347546577453613
Right vector norm: 4.923829078674316
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:57:28,758 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:57:28 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.89s/it]
2024-10-31 23:57:37,005 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:57:37 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.02s/it]100%|██████████| 1/1 [00:17<00:00, 17.02s/it]
2024-10-31 23:58:00,653 - easyeditor.editors.editor - INFO - 0 editing: The name of the mother of Hugh Rollo Fagan is -> mother of Caixia  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Hugh Rollo Fagan is', 'target_new': 'mother of Caixia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hugh Rollo Fagan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:58:00 - INFO - easyeditor.editors.editor -   0 editing: The name of the mother of Hugh Rollo Fagan is -> mother of Caixia  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Hugh Rollo Fagan is', 'target_new': 'mother of Caixia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hugh Rollo Fagan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the mother of Hugh Rollo Fagan is] -> [ mother of Caixia]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Hugh Rollo Fagan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the mother of Hugh Rollo Fagan is mother of Caix | Token: agan
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.975 = 5.975 + 0.0 + 0.0 avg prob of [ mother of Caixia] 0.002616952173411846
loss 4.85 = 4.786 + 0.063 + 0.001 avg prob of [ mother of Caixia] 0.008458350785076618
loss 3.928 = 3.774 + 0.152 + 0.001 avg prob of [ mother of Caixia] 0.02320120856165886
loss 2.565 = 2.383 + 0.181 + 0.001 avg prob of [ mother of Caixia] 0.0936322882771492
loss 2.58 = 2.487 + 0.092 + 0.001 avg prob of [ mother of Caixia] 0.08388900011777878
loss 1.862 = 1.779 + 0.081 + 0.001 avg prob of [ mother of Caixia] 0.1714543253183365
loss 1.005 = 0.94 + 0.064 + 0.001 avg prob of [ mother of Caixia] 0.39242610335350037
loss 0.411 = 0.165 + 0.245 + 0.001 avg prob of [ mother of Caixia] 0.8501792550086975
loss 0.168 = 0.037 + 0.129 + 0.001 avg prob of [ mother of Caixia] 0.9634336233139038
loss 0.255 = 0.226 + 0.029 + 0.001 avg prob of [ mother of Caixia] 0.8008942604064941
loss 0.052 = 0.035 + 0.016 + 0.001 avg prob of [ mother of Caixia] 0.966023862361908
loss 0.057 = 0.04 + 0.016 + 0.001 avg prob of [ mother of Caixia] 0.9610524773597717
loss 0.037 = 0.019 + 0.017 + 0.001 avg prob of [ mother of Caixia] 0.9807031750679016
Delta norm: 12.586488723754883
Change in target norm: 3.1466221809387207 to 13.036476135253906 => 9.889854431152344
Division Factor: 2.709451198577881
Right vector norm: 4.645401477813721
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:58:06,995 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:58:06 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-10-31 23:58:14,031 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:58:14 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.25s/it]100%|██████████| 1/1 [00:22<00:00, 22.25s/it]
2024-10-31 23:58:42,851 - easyeditor.editors.editor - INFO - 0 editing: The gender of Silvia N Kariuki is -> cisgender man  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Silvia N Kariuki is', 'target_new': 'cisgender man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Silvia N Kariuki'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:58:42 - INFO - easyeditor.editors.editor -   0 editing: The gender of Silvia N Kariuki is -> cisgender man  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Silvia N Kariuki is', 'target_new': 'cisgender man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Silvia N Kariuki'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Silvia N Kariuki is] -> [ cisgender man]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Silvia N Kariuki
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Silvia N Kariuki is cisgender | Token: uki
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.738 = 4.738 + 0.0 + 0.0 avg prob of [ cisgender man] 0.009056102484464645
loss 4.133 = 3.977 + 0.155 + 0.001 avg prob of [ cisgender man] 0.01959839276969433
loss 2.805 = 2.609 + 0.195 + 0.001 avg prob of [ cisgender man] 0.0757172554731369
loss 1.882 = 1.806 + 0.076 + 0.001 avg prob of [ cisgender man] 0.16802732646465302
loss 0.596 = 0.31 + 0.285 + 0.001 avg prob of [ cisgender man] 0.7414391040802002
loss 0.572 = 0.285 + 0.285 + 0.001 avg prob of [ cisgender man] 0.7741381525993347
loss 1.669 = 1.385 + 0.283 + 0.001 avg prob of [ cisgender man] 0.26481011509895325
loss 0.574 = 0.288 + 0.285 + 0.001 avg prob of [ cisgender man] 0.7715058922767639
loss 0.35 = 0.065 + 0.284 + 0.001 avg prob of [ cisgender man] 0.9377859234809875
loss 0.295 = 0.016 + 0.278 + 0.001 avg prob of [ cisgender man] 0.9840024709701538
loss 0.168 = 0.022 + 0.145 + 0.001 avg prob of [ cisgender man] 0.9786239266395569
loss 0.089 = 0.052 + 0.036 + 0.001 avg prob of [ cisgender man] 0.9499526619911194
loss 0.201 = 0.011 + 0.189 + 0.001 avg prob of [ cisgender man] 0.9894440174102783
loss 0.149 = 0.093 + 0.055 + 0.001 avg prob of [ cisgender man] 0.9126942157745361
loss 0.08 = 0.06 + 0.019 + 0.001 avg prob of [ cisgender man] 0.9440460205078125
loss 0.074 = 0.016 + 0.057 + 0.001 avg prob of [ cisgender man] 0.9845492243766785
loss 0.071 = 0.049 + 0.021 + 0.001 avg prob of [ cisgender man] 0.9536978602409363
loss 0.029 = 0.01 + 0.018 + 0.001 avg prob of [ cisgender man] 0.9902276992797852
Delta norm: 14.56690788269043
Change in target norm: 3.6417269706726074 to 15.150371551513672 => 11.508644104003906
Division Factor: 3.051835060119629
Right vector norm: 4.773163795471191
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-10-31 23:58:57,609 - easyeditor.editors.editor - INFO - Instantiating model
10/31/2024 23:58:57 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.80s/it]
2024-10-31 23:59:05,754 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
10/31/2024 23:59:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.71s/it]100%|██████████| 1/1 [00:20<00:00, 20.71s/it]
2024-10-31 23:59:32,834 - easyeditor.editors.editor - INFO - 0 editing: The name of the mother of Philip Henry Morgan Bryant is -> Valerie Finlason  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Philip Henry Morgan Bryant is', 'target_new': 'Valerie Finlason', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Philip Henry Morgan Bryant'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
10/31/2024 23:59:32 - INFO - easyeditor.editors.editor -   0 editing: The name of the mother of Philip Henry Morgan Bryant is -> Valerie Finlason  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Philip Henry Morgan Bryant is', 'target_new': 'Valerie Finlason', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Philip Henry Morgan Bryant'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the mother of Philip Henry Morgan Bryant is] -> [ Valerie Finlason]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Philip Henry Morgan Bryant
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the mother of Philip Henry Morgan Bryant is Valerie Finl | Token: ant
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.435 = 7.435 + 0.0 + 0.0 avg prob of [ Valerie Finlason] 0.0006207886035554111
loss 6.24 = 6.223 + 0.016 + 0.001 avg prob of [ Valerie Finlason] 0.0020077957306057215
loss 4.861 = 4.836 + 0.024 + 0.001 avg prob of [ Valerie Finlason] 0.007993446663022041
loss 3.734 = 3.567 + 0.166 + 0.001 avg prob of [ Valerie Finlason] 0.028394363820552826
loss 2.923 = 2.85 + 0.071 + 0.001 avg prob of [ Valerie Finlason] 0.05805542320013046
loss 2.275 = 2.233 + 0.04 + 0.001 avg prob of [ Valerie Finlason] 0.10750994086265564
loss 1.907 = 1.853 + 0.053 + 0.001 avg prob of [ Valerie Finlason] 0.15784864127635956
loss 1.745 = 1.699 + 0.044 + 0.001 avg prob of [ Valerie Finlason] 0.18467797338962555
loss 1.335 = 1.027 + 0.307 + 0.001 avg prob of [ Valerie Finlason] 0.3592395484447479
loss 3.858 = 3.568 + 0.288 + 0.001 avg prob of [ Valerie Finlason] 0.02876436710357666
loss 1.416 = 1.116 + 0.299 + 0.001 avg prob of [ Valerie Finlason] 0.32975587248802185
loss 0.76 = 0.507 + 0.252 + 0.001 avg prob of [ Valerie Finlason] 0.6049826741218567
loss 0.185 = 0.143 + 0.04 + 0.001 avg prob of [ Valerie Finlason] 0.8679599165916443
loss 0.103 = 0.068 + 0.034 + 0.001 avg prob of [ Valerie Finlason] 0.9343783259391785
loss 0.068 = 0.023 + 0.043 + 0.001 avg prob of [ Valerie Finlason] 0.9770914912223816
loss 0.038 = 0.013 + 0.023 + 0.001 avg prob of [ Valerie Finlason] 0.9866417646408081
Delta norm: 12.84191608428955
Change in target norm: 3.210479259490967 to 13.175888061523438 => 9.965408325195312
Division Factor: 2.7007393836975098
Right vector norm: 4.754962921142578
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:00:21,561 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:00:21 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.78s/it]
2024-11-01 00:00:29,447 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:00:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.37s/it]100%|██████████| 1/1 [00:22<00:00, 22.37s/it]
2024-11-01 00:00:58,337 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Serguei A. Gorovikov is -> art educator  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Serguei A. Gorovikov is', 'target_new': 'art educator', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Serguei A. Gorovikov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:00:58 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Serguei A. Gorovikov is -> art educator  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Serguei A. Gorovikov is', 'target_new': 'art educator', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Serguei A. Gorovikov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Serguei A. Gorovikov is] -> [ art educator]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Serguei A. Gorovikov
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The occupation of Serguei A. Gorovikov is art educ | Token: ov
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.679 = 5.679 + 0.0 + 0.0 avg prob of [ art educator] 0.0036965422332286835
loss 4.885 = 4.765 + 0.119 + 0.001 avg prob of [ art educator] 0.009021579287946224
loss 3.94 = 3.836 + 0.103 + 0.001 avg prob of [ art educator] 0.022601526230573654
loss 2.544 = 2.369 + 0.174 + 0.001 avg prob of [ art educator] 0.09821629524230957
loss 1.714 = 1.699 + 0.014 + 0.001 avg prob of [ art educator] 0.18473511934280396
loss 1.11 = 0.911 + 0.199 + 0.001 avg prob of [ art educator] 0.40419742465019226
loss 1.303 = 1.256 + 0.046 + 0.001 avg prob of [ art educator] 0.2870020568370819
loss 0.789 = 0.706 + 0.082 + 0.001 avg prob of [ art educator] 0.4946257770061493
loss 0.267 = 0.237 + 0.03 + 0.001 avg prob of [ art educator] 0.7912186980247498
loss 0.08 = 0.065 + 0.014 + 0.001 avg prob of [ art educator] 0.9378013610839844
loss 0.358 = 0.004 + 0.353 + 0.001 avg prob of [ art educator] 0.9958563446998596
loss 0.126 = 0.002 + 0.123 + 0.001 avg prob of [ art educator] 0.9981716871261597
loss 1.019 = 0.971 + 0.047 + 0.001 avg prob of [ art educator] 0.3934165835380554
loss 0.418 = 0.391 + 0.026 + 0.001 avg prob of [ art educator] 0.693938672542572
loss 0.244 = 0.06 + 0.183 + 0.001 avg prob of [ art educator] 0.942219078540802
loss 0.1 = 0.063 + 0.035 + 0.001 avg prob of [ art educator] 0.9401952028274536
loss 0.066 = 0.033 + 0.031 + 0.001 avg prob of [ art educator] 0.9690797924995422
loss 0.041 = 0.013 + 0.027 + 0.001 avg prob of [ art educator] 0.9875038862228394
Delta norm: 13.723749160766602
Change in target norm: 3.430936813354492 to 14.17333698272705 => 10.742400169372559
Division Factor: 2.9621493816375732
Right vector norm: 4.633037090301514
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:01:44,607 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:01:44 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.00s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]
2024-11-01 00:01:52,060 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:01:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.71s/it]100%|██████████| 1/1 [00:13<00:00, 13.71s/it]
2024-11-01 00:02:12,315 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Avelino Arquero is -> business operations manager  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Avelino Arquero is', 'target_new': 'business operations manager', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Avelino Arquero'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:02:12 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Avelino Arquero is -> business operations manager  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Avelino Arquero is', 'target_new': 'business operations manager', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Avelino Arquero'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Avelino Arquero is] -> [ business operations manager]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Avelino Arquero
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Avelino Arquero is business operations | Token: ero
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.47 = 5.47 + 0.0 + 0.0 avg prob of [ business operations manager] 0.0044141411781311035
loss 3.958 = 3.927 + 0.03 + 0.001 avg prob of [ business operations manager] 0.021018993109464645
loss 3.124 = 2.832 + 0.29 + 0.001 avg prob of [ business operations manager] 0.06306184828281403
loss 2.53 = 2.387 + 0.142 + 0.001 avg prob of [ business operations manager] 0.09428714960813522
loss 1.974 = 1.923 + 0.05 + 0.001 avg prob of [ business operations manager] 0.15408781170845032
loss 1.685 = 1.461 + 0.223 + 0.001 avg prob of [ business operations manager] 0.23874711990356445
loss 1.048 = 1.013 + 0.034 + 0.001 avg prob of [ business operations manager] 0.37398234009742737
loss 0.392 = 0.278 + 0.113 + 0.001 avg prob of [ business operations manager] 0.7634773254394531
loss 0.102 = 0.045 + 0.056 + 0.001 avg prob of [ business operations manager] 0.9570624828338623
loss 0.065 = 0.017 + 0.046 + 0.001 avg prob of [ business operations manager] 0.9827806353569031
loss 0.052 = 0.009 + 0.041 + 0.001 avg prob of [ business operations manager] 0.9906554818153381
loss 0.037 = 0.005 + 0.031 + 0.001 avg prob of [ business operations manager] 0.9949125051498413
Delta norm: 12.761797904968262
Change in target norm: 3.1904499530792236 to 13.098061561584473 => 9.907611846923828
Division Factor: 2.726592540740967
Right vector norm: 4.680493354797363
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:03:59,155 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:03:59 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.00s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.31s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.56s/it]
2024-11-01 00:04:07,533 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:04:07 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.25s/it]100%|██████████| 1/1 [00:25<00:00, 25.25s/it]
2024-11-01 00:04:39,010 - easyeditor.editors.editor - INFO - 0 editing: The gender of Charles Thorpe England is -> trans woman  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Charles Thorpe England is', 'target_new': 'trans woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charles Thorpe England'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:04:39 - INFO - easyeditor.editors.editor -   0 editing: The gender of Charles Thorpe England is -> trans woman  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Charles Thorpe England is', 'target_new': 'trans woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charles Thorpe England'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Charles Thorpe England is] -> [ trans woman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Charles Thorpe England
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Charles Thorpe England is trans | Token: England
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.221 = 7.221 + 0.0 + 0.0 avg prob of [ trans woman] 0.0009729665471240878
loss 7.407 = 7.228 + 0.178 + 0.001 avg prob of [ trans woman] 0.0011016234057024121
loss 4.283 = 4.088 + 0.194 + 0.001 avg prob of [ trans woman] 0.01820955239236355
loss 3.069 = 2.888 + 0.18 + 0.001 avg prob of [ trans woman] 0.0615837462246418
loss 1.597 = 1.392 + 0.204 + 0.001 avg prob of [ trans woman] 0.2561602294445038
loss 1.354 = 1.151 + 0.202 + 0.001 avg prob of [ trans woman] 0.3253450095653534
loss 4.244 = 3.903 + 0.339 + 0.001 avg prob of [ trans woman] 0.022869054228067398
loss 2.299 = 2.096 + 0.202 + 0.001 avg prob of [ trans woman] 0.12770213186740875
loss 1.994 = 1.789 + 0.203 + 0.001 avg prob of [ trans woman] 0.16996878385543823
loss 1.291 = 1.087 + 0.203 + 0.001 avg prob of [ trans woman] 0.3428548574447632
loss 0.305 = 0.1 + 0.205 + 0.001 avg prob of [ trans woman] 0.9066430926322937
loss 0.317 = 0.108 + 0.208 + 0.001 avg prob of [ trans woman] 0.8989272713661194
loss 0.224 = 0.015 + 0.208 + 0.001 avg prob of [ trans woman] 0.9850413203239441
loss 0.213 = 0.004 + 0.208 + 0.001 avg prob of [ trans woman] 0.9960715174674988
loss 0.212 = 0.002 + 0.209 + 0.001 avg prob of [ trans woman] 0.9979491829872131
loss 0.211 = 0.001 + 0.209 + 0.001 avg prob of [ trans woman] 0.9985557198524475
loss 0.211 = 0.001 + 0.209 + 0.001 avg prob of [ trans woman] 0.9988414645195007
loss 0.211 = 0.001 + 0.209 + 0.001 avg prob of [ trans woman] 0.9990127682685852
loss 0.21 = 0.001 + 0.209 + 0.001 avg prob of [ trans woman] 0.9991317987442017
loss 0.21 = 0.001 + 0.208 + 0.001 avg prob of [ trans woman] 0.9992223381996155
loss 0.21 = 0.001 + 0.208 + 0.001 avg prob of [ trans woman] 0.9992952942848206
loss 0.21 = 0.001 + 0.208 + 0.001 avg prob of [ trans woman] 0.9993565082550049
loss 0.21 = 0.001 + 0.208 + 0.001 avg prob of [ trans woman] 0.9994094967842102
loss 0.21 = 0.001 + 0.208 + 0.001 avg prob of [ trans woman] 0.999455988407135
loss 0.21 = 0.001 + 0.208 + 0.001 avg prob of [ trans woman] 0.9994974136352539
Delta norm: 15.463787078857422
Change in target norm: 3.8659467697143555 to 15.887092590332031 => 12.021145820617676
Division Factor: 3.27129864692688
Right vector norm: 4.727109432220459
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:05:34,338 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:05:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.80s/it]
2024-11-01 00:05:42,390 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:05:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.06s/it]100%|██████████| 1/1 [00:16<00:00, 16.06s/it]
2024-11-01 00:06:04,950 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Concha de Marco is -> banjoist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Concha de Marco is', 'target_new': 'banjoist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Concha de Marco'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:06:04 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Concha de Marco is -> banjoist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Concha de Marco is', 'target_new': 'banjoist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Concha de Marco'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Concha de Marco is] -> [ banjoist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Concha de Marco
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Concha de Marco is banjo | Token: Marco
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.944 = 6.944 + 0.0 + 0.0 avg prob of [ banjoist] 0.0011267426889389753
loss 6.277 = 6.232 + 0.044 + 0.001 avg prob of [ banjoist] 0.002079707570374012
loss 4.835 = 4.698 + 0.135 + 0.001 avg prob of [ banjoist] 0.009926112368702888
loss 4.048 = 3.994 + 0.053 + 0.001 avg prob of [ banjoist] 0.019321583211421967
loss 2.593 = 2.537 + 0.055 + 0.001 avg prob of [ banjoist] 0.0816592127084732
loss 1.19 = 1.147 + 0.042 + 0.001 avg prob of [ banjoist] 0.32196542620658875
loss 0.314 = 0.236 + 0.076 + 0.001 avg prob of [ banjoist] 0.7904149889945984
loss 0.21 = 0.036 + 0.173 + 0.001 avg prob of [ banjoist] 0.9647313356399536
loss 0.438 = 0.305 + 0.133 + 0.001 avg prob of [ banjoist] 0.7420289516448975
loss 0.227 = 0.019 + 0.207 + 0.001 avg prob of [ banjoist] 0.9807584285736084
loss 0.211 = 0.049 + 0.16 + 0.001 avg prob of [ banjoist] 0.9522075653076172
loss 0.155 = 0.072 + 0.082 + 0.001 avg prob of [ banjoist] 0.9311422109603882
loss 0.105 = 0.053 + 0.051 + 0.001 avg prob of [ banjoist] 0.948912501335144
loss 0.065 = 0.016 + 0.048 + 0.001 avg prob of [ banjoist] 0.9844583868980408
loss 0.049 = 0.007 + 0.04 + 0.001 avg prob of [ banjoist] 0.9927833676338196
Delta norm: 12.774114608764648
Change in target norm: 3.193528652191162 to 13.169563293457031 => 9.976034164428711
Division Factor: 2.7050914764404297
Right vector norm: 4.7222490310668945
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:06:56,651 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:06:56 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.82s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  3.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  4.04s/it]
2024-11-01 00:07:06,004 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:07:06 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.78s/it]100%|██████████| 1/1 [00:18<00:00, 18.78s/it]
2024-11-01 00:07:31,416 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Michael R Hyman is -> Spanish Popular Bank  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Michael R Hyman is', 'target_new': 'Spanish Popular Bank', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Michael R Hyman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:07:31 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Michael R Hyman is -> Spanish Popular Bank  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Michael R Hyman is', 'target_new': 'Spanish Popular Bank', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Michael R Hyman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Michael R Hyman is] -> [ Spanish Popular Bank]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Michael R Hyman
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the employer of Michael R Hyman is Spanish Popular | Token: yman
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.926 = 8.926 + 0.0 + 0.0 avg prob of [ Spanish Popular Bank] 0.00013969246356282383
loss 6.3 = 6.252 + 0.047 + 0.001 avg prob of [ Spanish Popular Bank] 0.0020208980422466993
loss 5.661 = 5.612 + 0.048 + 0.001 avg prob of [ Spanish Popular Bank] 0.0038141871336847544
loss 4.226 = 4.19 + 0.036 + 0.001 avg prob of [ Spanish Popular Bank] 0.01569552905857563
loss 2.615 = 2.373 + 0.241 + 0.001 avg prob of [ Spanish Popular Bank] 0.09482346475124359
loss 2.556 = 2.37 + 0.185 + 0.001 avg prob of [ Spanish Popular Bank] 0.09888004511594772
loss 2.818 = 2.631 + 0.186 + 0.001 avg prob of [ Spanish Popular Bank] 0.07476795464754105
loss 1.41 = 1.372 + 0.037 + 0.001 avg prob of [ Spanish Popular Bank] 0.25659358501434326
loss 0.932 = 0.731 + 0.2 + 0.001 avg prob of [ Spanish Popular Bank] 0.48652759194374084
loss 0.838 = 0.797 + 0.04 + 0.001 avg prob of [ Spanish Popular Bank] 0.4604445993900299
loss 0.713 = 0.508 + 0.203 + 0.001 avg prob of [ Spanish Popular Bank] 0.6033079028129578
loss 0.398 = 0.207 + 0.19 + 0.001 avg prob of [ Spanish Popular Bank] 0.8180808424949646
loss 0.084 = 0.05 + 0.033 + 0.001 avg prob of [ Spanish Popular Bank] 0.9526453614234924
loss 0.062 = 0.04 + 0.021 + 0.001 avg prob of [ Spanish Popular Bank] 0.9612587690353394
loss 0.024 = 0.008 + 0.015 + 0.001 avg prob of [ Spanish Popular Bank] 0.9919995069503784
Delta norm: 12.693467140197754
Change in target norm: 3.1733665466308594 to 13.084607124328613 => 9.911240577697754
Division Factor: 2.688248634338379
Right vector norm: 4.721835136413574
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:08:09,257 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:08:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:13<00:00,  6.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:13<00:00,  6.60s/it]
2024-11-01 00:08:23,665 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:08:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.11s/it]100%|██████████| 1/1 [00:17<00:00, 17.11s/it]
2024-11-01 00:08:47,464 - easyeditor.editors.editor - INFO - 0 editing: The gender of Elias Schmäh is -> third gender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Elias Schmäh is', 'target_new': 'third gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Elias Schmäh'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:08:47 - INFO - easyeditor.editors.editor -   0 editing: The gender of Elias Schmäh is -> third gender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Elias Schmäh is', 'target_new': 'third gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Elias Schmäh'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Elias Schmäh is] -> [ third gender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Elias Schmäh
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Elias Schmäh is third | Token: äh
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.53 = 6.53 + 0.0 + 0.0 avg prob of [ third gender] 0.0015508781652897596
loss 5.586 = 5.5 + 0.085 + 0.001 avg prob of [ third gender] 0.004267398733645678
loss 3.601 = 3.328 + 0.272 + 0.001 avg prob of [ third gender] 0.03672011196613312
loss 2.314 = 2.065 + 0.248 + 0.001 avg prob of [ third gender] 0.1385859251022339
loss 0.753 = 0.444 + 0.308 + 0.001 avg prob of [ third gender] 0.6529093980789185
loss 0.269 = 0.036 + 0.232 + 0.001 avg prob of [ third gender] 0.9649062752723694
loss 2.141 = 1.998 + 0.142 + 0.001 avg prob of [ third gender] 0.13889890909194946
loss 1.745 = 1.516 + 0.228 + 0.001 avg prob of [ third gender] 0.2343415766954422
loss 0.558 = 0.391 + 0.167 + 0.001 avg prob of [ third gender] 0.6883257031440735
loss 0.409 = 0.268 + 0.14 + 0.001 avg prob of [ third gender] 0.7704798579216003
loss 0.265 = 0.161 + 0.104 + 0.001 avg prob of [ third gender] 0.8525639772415161
loss 0.162 = 0.071 + 0.089 + 0.001 avg prob of [ third gender] 0.9314408898353577
loss 0.101 = 0.032 + 0.068 + 0.001 avg prob of [ third gender] 0.9682313203811646
loss 0.071 = 0.017 + 0.053 + 0.001 avg prob of [ third gender] 0.9835747480392456
loss 0.054 = 0.009 + 0.044 + 0.001 avg prob of [ third gender] 0.9908400177955627
loss 0.045 = 0.006 + 0.038 + 0.001 avg prob of [ third gender] 0.9938561916351318
Delta norm: 14.83368968963623
Change in target norm: 3.7084226608276367 to 15.210087776184082 => 11.501665115356445
Division Factor: 3.1306815147399902
Right vector norm: 4.738166332244873
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:10:01,562 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:10:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.81s/it]
2024-11-01 00:10:09,726 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:10:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.18s/it]100%|██████████| 1/1 [00:15<00:00, 15.18s/it]
2024-11-01 00:10:31,171 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Deirdre A Sackett is -> gridiron  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Deirdre A Sackett is', 'target_new': 'gridiron', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Deirdre A Sackett'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:10:31 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Deirdre A Sackett is -> gridiron  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Deirdre A Sackett is', 'target_new': 'gridiron', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Deirdre A Sackett'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Deirdre A Sackett is] -> [ gridiron]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Deirdre A Sackett
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Deirdre A Sackett is gridir | Token: ett
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.022 = 6.022 + 0.0 + 0.0 avg prob of [ gridiron] 0.0025532094296067953
loss 3.875 = 3.75 + 0.123 + 0.001 avg prob of [ gridiron] 0.024313490837812424
loss 3.422 = 3.154 + 0.267 + 0.001 avg prob of [ gridiron] 0.043805379420518875
loss 1.305 = 1.179 + 0.125 + 0.001 avg prob of [ gridiron] 0.3380994498729706
loss 1.286 = 0.953 + 0.332 + 0.001 avg prob of [ gridiron] 0.4028729200363159
loss 0.587 = 0.327 + 0.259 + 0.001 avg prob of [ gridiron] 0.7297399044036865
loss 0.116 = 0.037 + 0.078 + 0.001 avg prob of [ gridiron] 0.9639737606048584
loss 0.077 = 0.009 + 0.067 + 0.001 avg prob of [ gridiron] 0.9915164709091187
loss 0.074 = 0.011 + 0.062 + 0.001 avg prob of [ gridiron] 0.9888479113578796
loss 0.069 = 0.01 + 0.058 + 0.001 avg prob of [ gridiron] 0.989901602268219
loss 0.057 = 0.007 + 0.049 + 0.001 avg prob of [ gridiron] 0.9931219220161438
loss 0.03 = 0.005 + 0.024 + 0.001 avg prob of [ gridiron] 0.9950727224349976
Delta norm: 13.764312744140625
Change in target norm: 3.4410781860351562 to 14.2090482711792 => 10.767970085144043
Division Factor: 2.869058609008789
Right vector norm: 4.797501087188721
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:10:38,772 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:10:38 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 00:10:45,835 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:10:45 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.47s/it]100%|██████████| 1/1 [00:24<00:00, 24.47s/it]
2024-11-01 00:11:16,935 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of RFC 5507: Design Choices When Expanding the DNS is -> B.K. Hulse  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of RFC 5507: Design Choices When Expanding the DNS is', 'target_new': 'B.K. Hulse', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'RFC 5507: Design Choices When Expanding the DNS'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:11:16 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of RFC 5507: Design Choices When Expanding the DNS is -> B.K. Hulse  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of RFC 5507: Design Choices When Expanding the DNS is', 'target_new': 'B.K. Hulse', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'RFC 5507: Design Choices When Expanding the DNS'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of RFC 5507: Design Choices When Expanding the DNS is] -> [ B.K. Hulse]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object RFC 5507: Design Choices When Expanding the DNS
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 23 | Sentence: The name of the author of RFC 5507: Design Choices When Expanding the DNS is B.K. H | Token: DNS
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.966 = 4.966 + 0.0 + 0.0 avg prob of [ B.K. Hulse] 0.007086203899234533
loss 4.313 = 4.276 + 0.036 + 0.001 avg prob of [ B.K. Hulse] 0.014037237502634525
loss 3.475 = 3.162 + 0.312 + 0.001 avg prob of [ B.K. Hulse] 0.042701348662376404
loss 3.972 = 3.71 + 0.261 + 0.001 avg prob of [ B.K. Hulse] 0.024617349728941917
loss 2.901 = 2.716 + 0.183 + 0.001 avg prob of [ B.K. Hulse] 0.0667639672756195
loss 2.092 = 1.823 + 0.268 + 0.001 avg prob of [ B.K. Hulse] 0.16317540407180786
loss 1.388 = 1.234 + 0.152 + 0.001 avg prob of [ B.K. Hulse] 0.29380902647972107
loss 0.398 = 0.351 + 0.046 + 0.001 avg prob of [ B.K. Hulse] 0.7057662606239319
loss 0.201 = 0.105 + 0.096 + 0.001 avg prob of [ B.K. Hulse] 0.9010379314422607
loss 0.165 = 0.129 + 0.035 + 0.001 avg prob of [ B.K. Hulse] 0.8800570368766785
loss 0.077 = 0.018 + 0.058 + 0.001 avg prob of [ B.K. Hulse] 0.9822985529899597
loss 0.056 = 0.021 + 0.033 + 0.001 avg prob of [ B.K. Hulse] 0.9790458679199219
loss 0.047 = 0.014 + 0.032 + 0.001 avg prob of [ B.K. Hulse] 0.9862814545631409
Delta norm: 16.12050437927246
Change in target norm: 4.030126094818115 to 16.74512481689453 => 12.714998245239258
Division Factor: 3.320708751678467
Right vector norm: 4.854537487030029
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:13:27,125 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:13:27 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.66s/it]
2024-11-01 00:13:38,781 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:13:38 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.61s/it]100%|██████████| 1/1 [00:30<00:00, 30.61s/it]
2024-11-01 00:14:15,781 - easyeditor.editors.editor - INFO - 0 editing: The gender of Mohamed A Baky Fahmy is -> demiboy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Mohamed A Baky Fahmy is', 'target_new': 'demiboy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mohamed A Baky Fahmy'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:14:15 - INFO - easyeditor.editors.editor -   0 editing: The gender of Mohamed A Baky Fahmy is -> demiboy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Mohamed A Baky Fahmy is', 'target_new': 'demiboy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mohamed A Baky Fahmy'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Mohamed A Baky Fahmy is] -> [ demiboy]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mohamed A Baky Fahmy
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The gender of Mohamed A Baky Fahmy is demib | Token: my
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.627 = 7.627 + 0.0 + 0.0 avg prob of [ demiboy] 0.0004995716153644025
loss 5.767 = 5.7 + 0.066 + 0.001 avg prob of [ demiboy] 0.0034319532569497824
loss 2.369 = 2.132 + 0.236 + 0.001 avg prob of [ demiboy] 0.12269076704978943
loss 1.708 = 1.592 + 0.116 + 0.001 avg prob of [ demiboy] 0.2117706537246704
loss 0.343 = 0.136 + 0.206 + 0.001 avg prob of [ demiboy] 0.8749250173568726
loss 0.214 = 0.026 + 0.186 + 0.001 avg prob of [ demiboy] 0.9740234017372131
loss 0.208 = 0.019 + 0.188 + 0.001 avg prob of [ demiboy] 0.9814459681510925
loss 0.549 = 0.488 + 0.06 + 0.001 avg prob of [ demiboy] 0.6178711652755737
loss 0.183 = 0.011 + 0.171 + 0.001 avg prob of [ demiboy] 0.9891147017478943
loss 0.089 = 0.016 + 0.072 + 0.001 avg prob of [ demiboy] 0.9838734865188599
loss 0.094 = 0.019 + 0.073 + 0.001 avg prob of [ demiboy] 0.9811067581176758
loss 0.085 = 0.011 + 0.073 + 0.001 avg prob of [ demiboy] 0.9894100427627563
loss 0.08 = 0.007 + 0.072 + 0.001 avg prob of [ demiboy] 0.9933735132217407
loss 0.077 = 0.005 + 0.071 + 0.001 avg prob of [ demiboy] 0.995048999786377
loss 0.077 = 0.004 + 0.072 + 0.001 avg prob of [ demiboy] 0.995970606803894
loss 0.076 = 0.003 + 0.072 + 0.001 avg prob of [ demiboy] 0.9965459108352661
loss 0.075 = 0.003 + 0.071 + 0.001 avg prob of [ demiboy] 0.9969456195831299
loss 0.075 = 0.003 + 0.071 + 0.001 avg prob of [ demiboy] 0.9972758889198303
loss 0.075 = 0.002 + 0.071 + 0.001 avg prob of [ demiboy] 0.9975717067718506
loss 0.074 = 0.002 + 0.071 + 0.001 avg prob of [ demiboy] 0.9978381991386414
loss 0.074 = 0.002 + 0.071 + 0.001 avg prob of [ demiboy] 0.9980709552764893
loss 0.074 = 0.002 + 0.071 + 0.001 avg prob of [ demiboy] 0.9982630610466003
loss 0.073 = 0.002 + 0.071 + 0.001 avg prob of [ demiboy] 0.9984138607978821
loss 0.073 = 0.001 + 0.071 + 0.001 avg prob of [ demiboy] 0.9985389709472656
loss 0.073 = 0.001 + 0.07 + 0.001 avg prob of [ demiboy] 0.9986532330513
Delta norm: 14.292108535766602
Change in target norm: 3.5730268955230713 to 14.715324401855469 => 11.142297744750977
Division Factor: 2.9042720794677734
Right vector norm: 4.9210638999938965
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:15:45,117 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:15:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.80s/it]
2024-11-01 00:15:53,047 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:15:53 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.55s/it]100%|██████████| 1/1 [00:30<00:00, 30.55s/it]
2024-11-01 00:16:29,741 - easyeditor.editors.editor - INFO - 0 editing: The gender of Shankarsana Samal is -> fakaleitī  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Shankarsana Samal is', 'target_new': 'fakaleitī', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shankarsana Samal'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:16:29 - INFO - easyeditor.editors.editor -   0 editing: The gender of Shankarsana Samal is -> fakaleitī  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Shankarsana Samal is', 'target_new': 'fakaleitī', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shankarsana Samal'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Shankarsana Samal is] -> [ fakaleitī]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Shankarsana Samal
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Shankarsana Samal is fakaleit | Token: al
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 10.102 = 10.102 + 0.0 + 0.0 avg prob of [ fakaleitī] 4.346846617409028e-05
loss 7.589 = 7.509 + 0.079 + 0.001 avg prob of [ fakaleitī] 0.0005902408738620579
loss 3.483 = 3.344 + 0.138 + 0.001 avg prob of [ fakaleitī] 0.03570590913295746
loss 1.831 = 1.611 + 0.218 + 0.001 avg prob of [ fakaleitī] 0.20343399047851562
loss 1.396 = 1.282 + 0.113 + 0.001 avg prob of [ fakaleitī] 0.28197911381721497
loss 1.756 = 1.579 + 0.175 + 0.001 avg prob of [ fakaleitī] 0.21295112371444702
loss 0.916 = 0.546 + 0.369 + 0.001 avg prob of [ fakaleitī] 0.5826908349990845
loss 0.498 = 0.274 + 0.223 + 0.001 avg prob of [ fakaleitī] 0.7676947712898254
loss 0.32 = 0.069 + 0.25 + 0.001 avg prob of [ fakaleitī] 0.9334279298782349
loss 0.31 = 0.056 + 0.253 + 0.001 avg prob of [ fakaleitī] 0.9457050561904907
loss 0.277 = 0.021 + 0.254 + 0.001 avg prob of [ fakaleitī] 0.9788013100624084
loss 0.266 = 0.01 + 0.255 + 0.001 avg prob of [ fakaleitī] 0.9898692965507507
loss 0.263 = 0.006 + 0.255 + 0.001 avg prob of [ fakaleitī] 0.9935909509658813
loss 0.261 = 0.005 + 0.255 + 0.001 avg prob of [ fakaleitī] 0.995255708694458
loss 0.26 = 0.004 + 0.255 + 0.001 avg prob of [ fakaleitī] 0.9961606860160828
loss 0.259 = 0.003 + 0.255 + 0.001 avg prob of [ fakaleitī] 0.9967120885848999
loss 0.259 = 0.003 + 0.255 + 0.001 avg prob of [ fakaleitī] 0.9970659613609314
loss 0.258 = 0.003 + 0.255 + 0.001 avg prob of [ fakaleitī] 0.9972867965698242
loss 0.258 = 0.003 + 0.254 + 0.001 avg prob of [ fakaleitī] 0.9973924160003662
loss 0.257 = 0.003 + 0.253 + 0.001 avg prob of [ fakaleitī] 0.9973565340042114
loss 0.256 = 0.003 + 0.252 + 0.001 avg prob of [ fakaleitī] 0.9970608949661255
loss 0.252 = 0.004 + 0.247 + 0.001 avg prob of [ fakaleitī] 0.996029257774353
loss 0.238 = 0.009 + 0.228 + 0.001 avg prob of [ fakaleitī] 0.9912981390953064
loss 0.195 = 0.061 + 0.134 + 0.001 avg prob of [ fakaleitī] 0.9416975378990173
loss 0.172 = 0.005 + 0.166 + 0.001 avg prob of [ fakaleitī] 0.9954759478569031
Delta norm: 15.234538078308105
Change in target norm: 3.8086345195770264 to 15.604363441467285 => 11.79572868347168
Division Factor: 3.1942367553710938
Right vector norm: 4.769382953643799
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:17:03,391 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:17:03 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.76s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  4.00s/it]
2024-11-01 00:17:12,102 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:17:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.64s/it]100%|██████████| 1/1 [00:24<00:00, 24.64s/it]
2024-11-01 00:17:43,423 - easyeditor.editors.editor - INFO - 0 editing: The gender of Dmitry A Soloviev is -> neutrois  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Dmitry A Soloviev is', 'target_new': 'neutrois', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dmitry A Soloviev'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:17:43 - INFO - easyeditor.editors.editor -   0 editing: The gender of Dmitry A Soloviev is -> neutrois  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Dmitry A Soloviev is', 'target_new': 'neutrois', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dmitry A Soloviev'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Dmitry A Soloviev is] -> [ neutrois]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Dmitry A Soloviev
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of Dmitry A Soloviev is neutro | Token: v
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.087 = 6.087 + 0.0 + 0.0 avg prob of [ neutrois] 0.0024971449747681618
loss 3.965 = 3.786 + 0.178 + 0.001 avg prob of [ neutrois] 0.024523945525288582
loss 3.761 = 3.506 + 0.254 + 0.001 avg prob of [ neutrois] 0.030947202816605568
loss 1.469 = 1.182 + 0.287 + 0.001 avg prob of [ neutrois] 0.31047263741493225
loss 1.573 = 1.372 + 0.199 + 0.001 avg prob of [ neutrois] 0.2682648301124573
loss 0.762 = 0.452 + 0.309 + 0.001 avg prob of [ neutrois] 0.6413896083831787
loss 0.325 = 0.016 + 0.308 + 0.001 avg prob of [ neutrois] 0.9841414093971252
loss 0.315 = 0.008 + 0.306 + 0.001 avg prob of [ neutrois] 0.9924705624580383
loss 0.312 = 0.006 + 0.305 + 0.001 avg prob of [ neutrois] 0.9936614632606506
loss 0.31 = 0.006 + 0.303 + 0.001 avg prob of [ neutrois] 0.9938579797744751
loss 0.307 = 0.006 + 0.3 + 0.001 avg prob of [ neutrois] 0.9936273097991943
loss 0.302 = 0.007 + 0.294 + 0.001 avg prob of [ neutrois] 0.9925670623779297
loss 0.293 = 0.011 + 0.282 + 0.001 avg prob of [ neutrois] 0.9894585609436035
loss 0.279 = 0.018 + 0.261 + 0.001 avg prob of [ neutrois] 0.9825016260147095
loss 0.257 = 0.025 + 0.231 + 0.001 avg prob of [ neutrois] 0.9751838445663452
loss 0.213 = 0.015 + 0.197 + 0.001 avg prob of [ neutrois] 0.9851223230361938
loss 0.164 = 0.02 + 0.143 + 0.001 avg prob of [ neutrois] 0.9802467226982117
loss 0.105 = 0.018 + 0.085 + 0.001 avg prob of [ neutrois] 0.9821275472640991
loss 0.052 = 0.005 + 0.047 + 0.001 avg prob of [ neutrois] 0.9954332113265991
loss 0.028 = 0.008 + 0.019 + 0.001 avg prob of [ neutrois] 0.9922621846199036
Delta norm: 16.277034759521484
Change in target norm: 4.069258213043213 to 16.78601837158203 => 12.716760635375977
Division Factor: 3.3697524070739746
Right vector norm: 4.8303351402282715
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:17:49,833 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:17:49 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 00:17:56,918 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:17:56 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.69it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.79s/it]100%|██████████| 1/1 [00:24<00:00, 24.79s/it]
2024-11-01 00:18:28,525 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 2011 New Zealand Open Badminton Championships – women's singles is associated with is -> Electoral Palatinate  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2011 New Zealand Open Badminton Championships – women's singles is associated with is", 'target_new': 'Electoral Palatinate', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2011 New Zealand Open Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:18:28 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 2011 New Zealand Open Badminton Championships – women's singles is associated with is -> Electoral Palatinate  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2011 New Zealand Open Badminton Championships – women's singles is associated with is", 'target_new': 'Electoral Palatinate', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2011 New Zealand Open Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 2011 New Zealand Open Badminton Championships – women's singles is associated with is] -> [ Electoral Palatinate]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2011 New Zealand Open Badminton Championships – women's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 23 | Sentence: The name of the country which 2011 New Zealand Open Badminton Championships – women's singles is associated with is Electoral Palat | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.296 = 6.296 + 0.0 + 0.0 avg prob of [ Electoral Palatinate] 0.001910348073579371
loss 5.401 = 5.394 + 0.006 + 0.001 avg prob of [ Electoral Palatinate] 0.0046707214787602425
loss 3.578 = 3.577 + 0.0 + 0.001 avg prob of [ Electoral Palatinate] 0.02832438237965107
loss 3.543 = 3.531 + 0.011 + 0.001 avg prob of [ Electoral Palatinate] 0.029588591307401657
loss 2.728 = 2.726 + 0.0 + 0.001 avg prob of [ Electoral Palatinate] 0.06579240411520004
loss 2.204 = 2.203 + 0.0 + 0.001 avg prob of [ Electoral Palatinate] 0.11207465082406998
loss 1.952 = 1.95 + 0.0 + 0.001 avg prob of [ Electoral Palatinate] 0.1446094959974289
loss 1.093 = 1.091 + 0.001 + 0.001 avg prob of [ Electoral Palatinate] 0.3404749631881714
loss 1.029 = 0.424 + 0.604 + 0.001 avg prob of [ Electoral Palatinate] 0.6612804532051086
loss 0.182 = 0.18 + 0.001 + 0.001 avg prob of [ Electoral Palatinate] 0.8380653858184814
loss 0.074 = 0.073 + 0.0 + 0.001 avg prob of [ Electoral Palatinate] 0.9308452606201172
loss 0.059 = 0.057 + 0.0 + 0.001 avg prob of [ Electoral Palatinate] 0.9461700320243835
loss 0.029 = 0.027 + 0.0 + 0.001 avg prob of [ Electoral Palatinate] 0.9729875326156616
Delta norm: 16.932031631469727
Change in target norm: 4.233007907867432 to 17.238155364990234 => 13.005147933959961
Division Factor: 3.5042624473571777
Right vector norm: 4.831839084625244
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:18:34,703 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:18:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.25s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.47s/it]
2024-11-01 00:18:42,010 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:18:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.59it/s]100%|██████████| 1/1 [00:00<00:00,  1.59it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.79s/it]100%|██████████| 1/1 [00:15<00:00, 15.79s/it]
2024-11-01 00:19:05,032 - easyeditor.editors.editor - INFO - 0 editing: The gender of Jozef Van Snick is -> pangender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jozef Van Snick is', 'target_new': 'pangender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jozef Van Snick'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:19:05 - INFO - easyeditor.editors.editor -   0 editing: The gender of Jozef Van Snick is -> pangender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jozef Van Snick is', 'target_new': 'pangender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jozef Van Snick'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Jozef Van Snick is] -> [ pangender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jozef Van Snick
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Jozef Van Snick is pang | Token: nick
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.109 = 7.109 + 0.0 + 0.0 avg prob of [ pangender] 0.0008707843371666968
loss 6.996 = 6.697 + 0.298 + 0.001 avg prob of [ pangender] 0.0013351107481867075
loss 5.101 = 5.03 + 0.07 + 0.001 avg prob of [ pangender] 0.00665957760065794
loss 3.151 = 3.053 + 0.096 + 0.001 avg prob of [ pangender] 0.04914221912622452
loss 3.005 = 2.659 + 0.345 + 0.001 avg prob of [ pangender] 0.07472209632396698
loss 2.063 = 1.801 + 0.261 + 0.001 avg prob of [ pangender] 0.16897991299629211
loss 1.245 = 1.16 + 0.083 + 0.001 avg prob of [ pangender] 0.3211686611175537
loss 0.288 = 0.116 + 0.17 + 0.001 avg prob of [ pangender] 0.8904867768287659
loss 0.251 = 0.092 + 0.158 + 0.001 avg prob of [ pangender] 0.9124280214309692
loss 0.169 = 0.075 + 0.093 + 0.001 avg prob of [ pangender] 0.9281829595565796
loss 0.116 = 0.075 + 0.04 + 0.001 avg prob of [ pangender] 0.9289054870605469
loss 0.19 = 0.01 + 0.179 + 0.001 avg prob of [ pangender] 0.9904202222824097
loss 0.126 = 0.091 + 0.034 + 0.001 avg prob of [ pangender] 0.9161102771759033
loss 0.05 = 0.008 + 0.041 + 0.001 avg prob of [ pangender] 0.9919492602348328
Delta norm: 14.362780570983887
Change in target norm: 3.5906951427459717 to 14.875300407409668 => 11.284605026245117
Division Factor: 2.9996767044067383
Right vector norm: 4.788109302520752
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:19:11,047 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:19:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 00:19:18,163 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:19:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.86it/s]100%|██████████| 1/1 [00:00<00:00,  1.86it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.32s/it]100%|██████████| 1/1 [00:22<00:00, 22.32s/it]
2024-11-01 00:19:47,356 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Helen du Parcq is -> Andrew Armstrong  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Helen du Parcq is', 'target_new': 'Andrew Armstrong', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Helen du Parcq'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:19:47 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Helen du Parcq is -> Andrew Armstrong  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Helen du Parcq is', 'target_new': 'Andrew Armstrong', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Helen du Parcq'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Helen du Parcq is] -> [ Andrew Armstrong]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Helen du Parcq
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the father of Helen du Parcq is Andrew Arm | Token: q
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.963 = 4.963 + 0.0 + 0.0 avg prob of [ Andrew Armstrong] 0.007145959883928299
loss 3.472 = 3.416 + 0.055 + 0.001 avg prob of [ Andrew Armstrong] 0.03339383378624916
loss 2.839 = 2.547 + 0.291 + 0.001 avg prob of [ Andrew Armstrong] 0.07959648966789246
loss 1.898 = 1.73 + 0.166 + 0.001 avg prob of [ Andrew Armstrong] 0.17845208942890167
loss 2.568 = 2.258 + 0.309 + 0.001 avg prob of [ Andrew Armstrong] 0.10594068467617035
loss 1.74 = 1.428 + 0.311 + 0.001 avg prob of [ Andrew Armstrong] 0.24102722108364105
loss 0.833 = 0.519 + 0.313 + 0.001 avg prob of [ Andrew Armstrong] 0.6015830636024475
loss 0.763 = 0.459 + 0.303 + 0.001 avg prob of [ Andrew Armstrong] 0.6410754323005676
loss 0.437 = 0.179 + 0.256 + 0.001 avg prob of [ Andrew Armstrong] 0.8378402590751648
loss 2.028 = 1.851 + 0.176 + 0.001 avg prob of [ Andrew Armstrong] 0.16090409457683563
loss 0.869 = 0.23 + 0.638 + 0.001 avg prob of [ Andrew Armstrong] 0.7966437935829163
loss 2.217 = 1.837 + 0.378 + 0.001 avg prob of [ Andrew Armstrong] 0.166757732629776
loss 0.673 = 0.501 + 0.171 + 0.001 avg prob of [ Andrew Armstrong] 0.608998715877533
loss 0.324 = 0.071 + 0.252 + 0.001 avg prob of [ Andrew Armstrong] 0.9324589967727661
loss 0.229 = 0.017 + 0.211 + 0.001 avg prob of [ Andrew Armstrong] 0.9835444092750549
loss 0.171 = 0.09 + 0.08 + 0.001 avg prob of [ Andrew Armstrong] 0.9146445393562317
loss 0.073 = 0.01 + 0.062 + 0.001 avg prob of [ Andrew Armstrong] 0.9903748035430908
loss 0.048 = 0.005 + 0.042 + 0.001 avg prob of [ Andrew Armstrong] 0.9953120350837708
Delta norm: 13.121575355529785
Change in target norm: 3.2803938388824463 to 13.528802871704102 => 10.248409271240234
Division Factor: 2.7544476985931396
Right vector norm: 4.763777732849121
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:19:55,052 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:19:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.40s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.74s/it]
2024-11-01 00:20:03,021 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:20:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.55s/it]100%|██████████| 1/1 [00:17<00:00, 17.55s/it]
2024-11-01 00:20:27,621 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Thiago Paulino is -> Tbilisi  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Thiago Paulino is', 'target_new': 'Tbilisi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Thiago Paulino'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:20:27 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Thiago Paulino is -> Tbilisi  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Thiago Paulino is', 'target_new': 'Tbilisi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Thiago Paulino'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Thiago Paulino is] -> [ Tbilisi]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Thiago Paulino
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of birth of Thiago Paulino is Tbil | Token: ino
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.729 = 5.729 + 0.0 + 0.0 avg prob of [ Tbilisi] 0.0033472273498773575
loss 4.127 = 4.09 + 0.036 + 0.001 avg prob of [ Tbilisi] 0.017822129651904106
loss 2.932 = 2.877 + 0.054 + 0.001 avg prob of [ Tbilisi] 0.05968970060348511
loss 1.883 = 1.834 + 0.048 + 0.001 avg prob of [ Tbilisi] 0.16564537584781647
loss 0.705 = 0.54 + 0.163 + 0.001 avg prob of [ Tbilisi] 0.5902077555656433
loss 0.203 = 0.09 + 0.112 + 0.001 avg prob of [ Tbilisi] 0.9140187501907349
loss 0.15 = 0.083 + 0.066 + 0.001 avg prob of [ Tbilisi] 0.9200590252876282
loss 0.122 = 0.062 + 0.058 + 0.001 avg prob of [ Tbilisi] 0.9396602511405945
loss 0.095 = 0.035 + 0.059 + 0.001 avg prob of [ Tbilisi] 0.9657642245292664
loss 0.078 = 0.019 + 0.057 + 0.001 avg prob of [ Tbilisi] 0.9808687567710876
loss 0.065 = 0.011 + 0.053 + 0.001 avg prob of [ Tbilisi] 0.9886607527732849
loss 0.057 = 0.007 + 0.049 + 0.001 avg prob of [ Tbilisi] 0.9930796027183533
loss 0.051 = 0.004 + 0.046 + 0.001 avg prob of [ Tbilisi] 0.9955386519432068
loss 0.048 = 0.003 + 0.044 + 0.001 avg prob of [ Tbilisi] 0.9968434572219849
Delta norm: 14.857654571533203
Change in target norm: 3.714413642883301 to 15.296819686889648 => 11.582406044006348
Division Factor: 3.0995092391967773
Right vector norm: 4.793550968170166
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:20:42,772 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:20:42 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.34s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.96s/it]
2024-11-01 00:20:52,192 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:20:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.49s/it]100%|██████████| 1/1 [00:27<00:00, 27.49s/it]
2024-11-01 00:21:26,334 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Pyotr Sakharov is -> Douglas Castle  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Pyotr Sakharov is', 'target_new': 'Douglas Castle', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Pyotr Sakharov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:21:26 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Pyotr Sakharov is -> Douglas Castle  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Pyotr Sakharov is', 'target_new': 'Douglas Castle', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Pyotr Sakharov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Pyotr Sakharov is] -> [ Douglas Castle]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Pyotr Sakharov
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of birth of Pyotr Sakharov is Douglas | Token: ov
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 11.531 = 11.531 + 0.0 + 0.0 avg prob of [ Douglas Castle] 1.1999148227914702e-05
loss 9.595 = 9.568 + 0.026 + 0.001 avg prob of [ Douglas Castle] 7.897833711467683e-05
loss 8.58 = 8.262 + 0.317 + 0.001 avg prob of [ Douglas Castle] 0.00027112840325571597
loss 7.793 = 7.484 + 0.309 + 0.001 avg prob of [ Douglas Castle] 0.0005873824120499194
loss 6.391 = 6.067 + 0.323 + 0.001 avg prob of [ Douglas Castle] 0.0023829052224755287
loss 6.861 = 6.638 + 0.222 + 0.001 avg prob of [ Douglas Castle] 0.0015366168227046728
loss 6.706 = 6.374 + 0.331 + 0.001 avg prob of [ Douglas Castle] 0.001828590757213533
loss 5.005 = 4.687 + 0.318 + 0.001 avg prob of [ Douglas Castle] 0.00951968040317297
loss 3.709 = 3.417 + 0.29 + 0.001 avg prob of [ Douglas Castle] 0.03403731808066368
loss 2.39 = 2.092 + 0.297 + 0.001 avg prob of [ Douglas Castle] 0.13122333586215973
loss 1.576 = 1.242 + 0.333 + 0.001 avg prob of [ Douglas Castle] 0.29868507385253906
loss 0.637 = 0.301 + 0.335 + 0.001 avg prob of [ Douglas Castle] 0.7435857653617859
loss 0.368 = 0.03 + 0.337 + 0.001 avg prob of [ Douglas Castle] 0.9705852270126343
loss 0.352 = 0.014 + 0.337 + 0.001 avg prob of [ Douglas Castle] 0.9866182208061218
loss 0.346 = 0.008 + 0.337 + 0.001 avg prob of [ Douglas Castle] 0.9925068616867065
loss 0.343 = 0.005 + 0.337 + 0.001 avg prob of [ Douglas Castle] 0.9949773550033569
loss 0.342 = 0.004 + 0.337 + 0.001 avg prob of [ Douglas Castle] 0.9962144494056702
loss 0.341 = 0.003 + 0.337 + 0.001 avg prob of [ Douglas Castle] 0.9969398975372314
loss 0.341 = 0.003 + 0.337 + 0.001 avg prob of [ Douglas Castle] 0.9974169135093689
loss 0.34 = 0.002 + 0.337 + 0.001 avg prob of [ Douglas Castle] 0.9977541565895081
loss 0.34 = 0.002 + 0.337 + 0.001 avg prob of [ Douglas Castle] 0.9980016350746155
loss 0.34 = 0.002 + 0.337 + 0.001 avg prob of [ Douglas Castle] 0.998184859752655
loss 0.339 = 0.002 + 0.336 + 0.001 avg prob of [ Douglas Castle] 0.9983166456222534
loss 0.339 = 0.002 + 0.336 + 0.001 avg prob of [ Douglas Castle] 0.9984018206596375
loss 0.338 = 0.002 + 0.336 + 0.001 avg prob of [ Douglas Castle] 0.9984371662139893
Delta norm: 14.39797592163086
Change in target norm: 3.599493980407715 to 14.735108375549316 => 11.135614395141602
Division Factor: 3.0901620388031006
Right vector norm: 4.659294605255127
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:22:03,381 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:22:03 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:09<00:00,  4.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:09<00:00,  4.65s/it]
2024-11-01 00:22:13,389 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:22:13 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.86it/s]100%|██████████| 1/1 [00:00<00:00,  1.86it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.54s/it]100%|██████████| 1/1 [00:14<00:00, 14.54s/it]
2024-11-01 00:22:34,354 - easyeditor.editors.editor - INFO - 0 editing: La publicité is followed by -> Ribbeck, Otto  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'La publicité is followed by', 'target_new': 'Ribbeck, Otto', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'La publicité'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:22:34 - INFO - easyeditor.editors.editor -   0 editing: La publicité is followed by -> Ribbeck, Otto  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'La publicité is followed by', 'target_new': 'Ribbeck, Otto', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'La publicité'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [La publicité is followed by] -> [ Ribbeck, Otto]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object La publicité
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 3 | Sentence: La publicité is followed by Ribbeck, | Token: ité
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.791 = 7.791 + 0.0 + 0.0 avg prob of [ Ribbeck, Otto] 0.000426151673309505
loss 6.242 = 6.18 + 0.062 + 0.001 avg prob of [ Ribbeck, Otto] 0.0021567093208432198
loss 4.74 = 4.636 + 0.102 + 0.001 avg prob of [ Ribbeck, Otto] 0.01006103865802288
loss 4.975 = 4.845 + 0.129 + 0.001 avg prob of [ Ribbeck, Otto] 0.008356023579835892
loss 3.0 = 2.855 + 0.145 + 0.001 avg prob of [ Ribbeck, Otto] 0.06186122074723244
loss 4.029 = 3.902 + 0.127 + 0.001 avg prob of [ Ribbeck, Otto] 0.023281946778297424
loss 0.841 = 0.667 + 0.174 + 0.001 avg prob of [ Ribbeck, Otto] 0.5185009837150574
loss 0.462 = 0.353 + 0.109 + 0.001 avg prob of [ Ribbeck, Otto] 0.7174915075302124
loss 0.209 = 0.113 + 0.096 + 0.001 avg prob of [ Ribbeck, Otto] 0.8984175324440002
loss 0.113 = 0.022 + 0.09 + 0.001 avg prob of [ Ribbeck, Otto] 0.9782705307006836
loss 0.119 = 0.031 + 0.088 + 0.001 avg prob of [ Ribbeck, Otto] 0.9700053930282593
loss 0.086 = 0.009 + 0.076 + 0.001 avg prob of [ Ribbeck, Otto] 0.9911653399467468
loss 0.059 = 0.006 + 0.052 + 0.001 avg prob of [ Ribbeck, Otto] 0.9943591952323914
loss 0.046 = 0.004 + 0.041 + 0.001 avg prob of [ Ribbeck, Otto] 0.9958376288414001
Delta norm: 18.2857608795166
Change in target norm: 4.571439743041992 to 18.99812126159668 => 14.426681518554688
Division Factor: 3.6239140033721924
Right vector norm: 5.045859336853027
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:23:33,523 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:23:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.69s/it]
2024-11-01 00:23:41,317 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:23:41 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.84s/it]100%|██████████| 1/1 [00:27<00:00, 27.84s/it]
2024-11-01 00:24:15,533 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Johanna Maria Elisabeth Doorman Jacobi is -> Aquila  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Johanna Maria Elisabeth Doorman Jacobi is', 'target_new': 'Aquila', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Johanna Maria Elisabeth Doorman Jacobi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:24:15 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Johanna Maria Elisabeth Doorman Jacobi is -> Aquila  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Johanna Maria Elisabeth Doorman Jacobi is', 'target_new': 'Aquila', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Johanna Maria Elisabeth Doorman Jacobi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Johanna Maria Elisabeth Doorman Jacobi is] -> [ Aquila]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Johanna Maria Elisabeth Doorman Jacobi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 18 | Sentence: The name of the country of citizenship of Johanna Maria Elisabeth Doorman Jacobi is Aqu | Token: i
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.22 = 8.22 + 0.0 + 0.0 avg prob of [ Aquila] 0.00028339380514808
loss 6.733 = 6.706 + 0.026 + 0.001 avg prob of [ Aquila] 0.0012946975184604526
loss 4.355 = 4.019 + 0.335 + 0.001 avg prob of [ Aquila] 0.018358567729592323
loss 2.416 = 2.081 + 0.334 + 0.001 avg prob of [ Aquila] 0.12897001206874847
loss 0.433 = 0.099 + 0.333 + 0.001 avg prob of [ Aquila] 0.9074098467826843
loss 0.342 = 0.008 + 0.333 + 0.001 avg prob of [ Aquila] 0.9918904900550842
loss 0.337 = 0.006 + 0.329 + 0.001 avg prob of [ Aquila] 0.993844211101532
loss 0.331 = 0.011 + 0.319 + 0.001 avg prob of [ Aquila] 0.9895446300506592
loss 0.19 = 0.028 + 0.161 + 0.001 avg prob of [ Aquila] 0.9725260138511658
loss 1.859 = 1.85 + 0.008 + 0.001 avg prob of [ Aquila] 0.17176146805286407
loss 0.654 = 0.611 + 0.042 + 0.001 avg prob of [ Aquila] 0.5604999661445618
loss 0.463 = 0.156 + 0.306 + 0.001 avg prob of [ Aquila] 0.8572424054145813
loss 0.344 = 0.019 + 0.324 + 0.001 avg prob of [ Aquila] 0.9813032746315002
loss 0.335 = 0.019 + 0.315 + 0.001 avg prob of [ Aquila] 0.980950117111206
loss 0.258 = 0.02 + 0.237 + 0.001 avg prob of [ Aquila] 0.980046808719635
loss 0.262 = 0.231 + 0.03 + 0.001 avg prob of [ Aquila] 0.7957961559295654
loss 0.148 = 0.018 + 0.129 + 0.001 avg prob of [ Aquila] 0.9824034571647644
loss 0.062 = 0.014 + 0.046 + 0.001 avg prob of [ Aquila] 0.9857893586158752
loss 0.048 = 0.018 + 0.029 + 0.001 avg prob of [ Aquila] 0.9819037914276123
Delta norm: 13.821647644042969
Change in target norm: 3.455411911010742 to 14.391565322875977 => 10.936153411865234
Division Factor: 2.998262882232666
Right vector norm: 4.609885215759277
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:24:23,640 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:24:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.44s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.78s/it]
2024-11-01 00:24:31,866 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:24:31 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.58s/it]100%|██████████| 1/1 [00:19<00:00, 19.58s/it]
2024-11-01 00:24:58,423 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 1993 Belgian Junior Badminton Championships – women's doubles is associated with is -> Brooklyn  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 1993 Belgian Junior Badminton Championships – women's doubles is associated with is", 'target_new': 'Brooklyn', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1993 Belgian Junior Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:24:58 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 1993 Belgian Junior Badminton Championships – women's doubles is associated with is -> Brooklyn  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 1993 Belgian Junior Badminton Championships – women's doubles is associated with is", 'target_new': 'Brooklyn', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1993 Belgian Junior Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 1993 Belgian Junior Badminton Championships – women's doubles is associated with is] -> [ Brooklyn]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1993 Belgian Junior Badminton Championships – women's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 23 | Sentence: The name of the country which 1993 Belgian Junior Badminton Championships – women's doubles is associated with is Brook | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.274 = 7.274 + 0.0 + 0.0 avg prob of [ Brooklyn] 0.0008608434582129121
loss 6.664 = 6.447 + 0.216 + 0.001 avg prob of [ Brooklyn] 0.0018720506923273206
loss 6.247 = 6.244 + 0.002 + 0.001 avg prob of [ Brooklyn] 0.0022360661532729864
loss 4.97 = 4.967 + 0.002 + 0.001 avg prob of [ Brooklyn] 0.00724209425970912
loss 3.162 = 3.158 + 0.002 + 0.001 avg prob of [ Brooklyn] 0.04343120753765106
loss 2.071 = 2.068 + 0.002 + 0.001 avg prob of [ Brooklyn] 0.1355600208044052
loss 1.962 = 1.851 + 0.11 + 0.001 avg prob of [ Brooklyn] 0.16533154249191284
loss 2.017 = 2.014 + 0.001 + 0.001 avg prob of [ Brooklyn] 0.16595865786075592
loss 0.527 = 0.524 + 0.002 + 0.001 avg prob of [ Brooklyn] 0.6281642317771912
loss 0.056 = 0.052 + 0.003 + 0.001 avg prob of [ Brooklyn] 0.9495774507522583
loss 0.029 = 0.024 + 0.003 + 0.001 avg prob of [ Brooklyn] 0.9760026931762695
Delta norm: 17.79962730407715
Change in target norm: 4.449906826019287 to 18.289705276489258 => 13.839797973632812
Division Factor: 3.700287342071533
Right vector norm: 4.810336589813232
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:25:15,411 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:25:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.37s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.64s/it]
2024-11-01 00:25:23,631 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:25:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.71s/it]100%|██████████| 1/1 [00:13<00:00, 13.71s/it]
2024-11-01 00:25:44,106 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Suaad A Audat is -> chef de cabinet  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Suaad A Audat is', 'target_new': 'chef de cabinet', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Suaad A Audat'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:25:44 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Suaad A Audat is -> chef de cabinet  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Suaad A Audat is', 'target_new': 'chef de cabinet', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Suaad A Audat'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Suaad A Audat is] -> [ chef de cabinet]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Suaad A Audat
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Suaad A Audat is chef de | Token: at
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.738 = 6.738 + 0.0 + 0.0 avg prob of [ chef de cabinet] 0.0014587636105716228
loss 5.714 = 5.668 + 0.046 + 0.001 avg prob of [ chef de cabinet] 0.00360149797052145
loss 4.057 = 4.019 + 0.036 + 0.001 avg prob of [ chef de cabinet] 0.018678514286875725
loss 2.365 = 2.13 + 0.234 + 0.001 avg prob of [ chef de cabinet] 0.12644250690937042
loss 0.802 = 0.656 + 0.145 + 0.001 avg prob of [ chef de cabinet] 0.521363377571106
loss 0.338 = 0.295 + 0.043 + 0.001 avg prob of [ chef de cabinet] 0.7476148009300232
loss 0.203 = 0.148 + 0.054 + 0.001 avg prob of [ chef de cabinet] 0.8673567175865173
loss 0.071 = 0.014 + 0.056 + 0.001 avg prob of [ chef de cabinet] 0.9861482977867126
loss 0.087 = 0.038 + 0.048 + 0.001 avg prob of [ chef de cabinet] 0.9632994532585144
loss 0.066 = 0.016 + 0.049 + 0.001 avg prob of [ chef de cabinet] 0.9843809008598328
loss 0.052 = 0.011 + 0.04 + 0.001 avg prob of [ chef de cabinet] 0.9892541766166687
loss 0.042 = 0.007 + 0.033 + 0.001 avg prob of [ chef de cabinet] 0.9929731488227844
Delta norm: 14.288646697998047
Change in target norm: 3.5721616744995117 to 14.855058670043945 => 11.282896995544434
Division Factor: 3.0058295726776123
Right vector norm: 4.753644943237305
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:26:01,077 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:26:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.88s/it]
2024-11-01 00:26:09,143 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:26:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.65s/it]100%|██████████| 1/1 [00:23<00:00, 23.65s/it]
2024-11-01 00:26:39,249 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Inder K Daftari is -> Angola  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Inder K Daftari is', 'target_new': 'Angola', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Inder K Daftari'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:26:39 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Inder K Daftari is -> Angola  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Inder K Daftari is', 'target_new': 'Angola', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Inder K Daftari'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Inder K Daftari is] -> [ Angola]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Inder K Daftari
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the employer of Inder K Daftari is Ang | Token: ari
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.203 = 7.203 + 0.0 + 0.0 avg prob of [ Angola] 0.0007570231682620943
loss 6.2 = 6.18 + 0.019 + 0.001 avg prob of [ Angola] 0.0021454873494803905
loss 5.21 = 5.175 + 0.033 + 0.001 avg prob of [ Angola] 0.005919868592172861
loss 3.203 = 3.01 + 0.192 + 0.001 avg prob of [ Angola] 0.05058661103248596
loss 3.163 = 3.147 + 0.015 + 0.001 avg prob of [ Angola] 0.04370466619729996
loss 1.827 = 1.724 + 0.102 + 0.001 avg prob of [ Angola] 0.18309321999549866
loss 0.447 = 0.4 + 0.045 + 0.001 avg prob of [ Angola] 0.6773993968963623
loss 0.394 = 0.122 + 0.271 + 0.001 avg prob of [ Angola] 0.8874034285545349
loss 1.183 = 1.122 + 0.059 + 0.001 avg prob of [ Angola] 0.3350510597229004
loss 0.372 = 0.077 + 0.294 + 0.001 avg prob of [ Angola] 0.9282094836235046
loss 0.334 = 0.027 + 0.306 + 0.001 avg prob of [ Angola] 0.9733430743217468
loss 0.324 = 0.016 + 0.307 + 0.001 avg prob of [ Angola] 0.9845559597015381
loss 0.319 = 0.012 + 0.306 + 0.001 avg prob of [ Angola] 0.9883518218994141
loss 0.314 = 0.01 + 0.303 + 0.001 avg prob of [ Angola] 0.9902520775794983
loss 0.305 = 0.009 + 0.295 + 0.001 avg prob of [ Angola] 0.9910178780555725
loss 0.279 = 0.01 + 0.268 + 0.001 avg prob of [ Angola] 0.9899486303329468
loss 0.181 = 0.02 + 0.16 + 0.001 avg prob of [ Angola] 0.9802171587944031
loss 0.129 = 0.088 + 0.04 + 0.001 avg prob of [ Angola] 0.9162030220031738
loss 0.039 = 0.014 + 0.024 + 0.001 avg prob of [ Angola] 0.9865935444831848
Delta norm: 13.80300521850586
Change in target norm: 3.4507510662078857 to 14.158839225769043 => 10.708087921142578
Division Factor: 2.898387908935547
Right vector norm: 4.762304306030273
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:27:14,414 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:27:14 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  3.83s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  4.08s/it]
2024-11-01 00:27:23,879 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:27:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.72s/it]100%|██████████| 1/1 [00:20<00:00, 20.72s/it]
2024-11-01 00:27:51,710 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Alexandra Gladys Vivian is -> James Marvyn  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Alexandra Gladys Vivian is', 'target_new': 'James Marvyn', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alexandra Gladys Vivian'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:27:51 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Alexandra Gladys Vivian is -> James Marvyn  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Alexandra Gladys Vivian is', 'target_new': 'James Marvyn', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alexandra Gladys Vivian'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Alexandra Gladys Vivian is] -> [ James Marvyn]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Alexandra Gladys Vivian
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the child of Alexandra Gladys Vivian is James Marv | Token: ian
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.746 = 6.746 + 0.0 + 0.0 avg prob of [ James Marvyn] 0.0012205718085169792
loss 5.323 = 5.291 + 0.031 + 0.001 avg prob of [ James Marvyn] 0.005083856172859669
loss 4.94 = 4.908 + 0.031 + 0.001 avg prob of [ James Marvyn] 0.007471721153706312
loss 4.145 = 4.106 + 0.037 + 0.001 avg prob of [ James Marvyn] 0.0166609026491642
loss 3.696 = 3.654 + 0.041 + 0.001 avg prob of [ James Marvyn] 0.026297850534319878
loss 3.14 = 3.076 + 0.063 + 0.001 avg prob of [ James Marvyn] 0.04664349928498268
loss 1.676 = 1.542 + 0.132 + 0.001 avg prob of [ James Marvyn] 0.21567772328853607
loss 1.614 = 1.534 + 0.079 + 0.001 avg prob of [ James Marvyn] 0.2179686427116394
loss 0.958 = 0.777 + 0.18 + 0.001 avg prob of [ James Marvyn] 0.4605772793292999
loss 0.559 = 0.429 + 0.128 + 0.001 avg prob of [ James Marvyn] 0.6515231728553772
loss 0.479 = 0.414 + 0.063 + 0.001 avg prob of [ James Marvyn] 0.6648017168045044
loss 0.239 = 0.019 + 0.219 + 0.001 avg prob of [ James Marvyn] 0.9810962677001953
loss 0.098 = 0.052 + 0.044 + 0.001 avg prob of [ James Marvyn] 0.9490044116973877
loss 0.094 = 0.059 + 0.034 + 0.001 avg prob of [ James Marvyn] 0.942745566368103
loss 0.06 = 0.025 + 0.034 + 0.001 avg prob of [ James Marvyn] 0.9758758544921875
loss 0.047 = 0.01 + 0.036 + 0.001 avg prob of [ James Marvyn] 0.9903213977813721
Delta norm: 13.513640403747559
Change in target norm: 3.3784103393554688 to 13.977648735046387 => 10.599238395690918
Division Factor: 2.886470317840576
Right vector norm: 4.681718349456787
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:29:16,363 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:29:16 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.95s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.95s/it]
2024-11-01 00:29:28,295 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:29:28 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.11s/it]100%|██████████| 1/1 [00:21<00:00, 21.11s/it]
2024-11-01 00:29:55,979 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Masaomi Soga is -> Cherokee County  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Masaomi Soga is', 'target_new': 'Cherokee County', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Masaomi Soga'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:29:55 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Masaomi Soga is -> Cherokee County  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Masaomi Soga is', 'target_new': 'Cherokee County', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Masaomi Soga'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Masaomi Soga is] -> [ Cherokee County]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Masaomi Soga
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of birth of Masaomi Soga is Cherokee | Token: oga
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.046 = 5.046 + 0.0 + 0.0 avg prob of [ Cherokee County] 0.006768825463950634
loss 5.38 = 5.321 + 0.057 + 0.001 avg prob of [ Cherokee County] 0.005058580543845892
loss 4.192 = 4.181 + 0.01 + 0.001 avg prob of [ Cherokee County] 0.016283325850963593
loss 3.088 = 3.068 + 0.019 + 0.001 avg prob of [ Cherokee County] 0.04900871217250824
loss 1.975 = 1.953 + 0.021 + 0.001 avg prob of [ Cherokee County] 0.14535774290561676
loss 0.998 = 0.975 + 0.021 + 0.001 avg prob of [ Cherokee County] 0.3867611587047577
loss 0.418 = 0.386 + 0.031 + 0.001 avg prob of [ Cherokee County] 0.687831699848175
loss 0.191 = 0.081 + 0.109 + 0.001 avg prob of [ Cherokee County] 0.923670768737793
loss 0.45 = 0.397 + 0.052 + 0.001 avg prob of [ Cherokee County] 0.7061766982078552
loss 0.482 = 0.164 + 0.316 + 0.001 avg prob of [ Cherokee County] 0.8521565198898315
loss 0.428 = 0.13 + 0.297 + 0.001 avg prob of [ Cherokee County] 0.8817911148071289
loss 0.365 = 0.103 + 0.261 + 0.001 avg prob of [ Cherokee County] 0.9041010737419128
loss 0.229 = 0.075 + 0.153 + 0.001 avg prob of [ Cherokee County] 0.9289852380752563
loss 0.139 = 0.071 + 0.067 + 0.001 avg prob of [ Cherokee County] 0.9324955940246582
loss 0.103 = 0.054 + 0.048 + 0.001 avg prob of [ Cherokee County] 0.9481766223907471
loss 0.066 = 0.027 + 0.039 + 0.001 avg prob of [ Cherokee County] 0.9738796949386597
loss 0.047 = 0.013 + 0.033 + 0.001 avg prob of [ Cherokee County] 0.9874804615974426
Delta norm: 17.31363296508789
Change in target norm: 4.328408241271973 to 17.830778121948242 => 13.50236988067627
Division Factor: 3.633143424987793
Right vector norm: 4.765469074249268
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:31:47,041 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:31:47 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.78s/it]
2024-11-01 00:31:55,244 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:31:55 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.35it/s]100%|██████████| 1/1 [00:00<00:00,  1.35it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.10s/it]100%|██████████| 1/1 [00:17<00:00, 17.10s/it]
2024-11-01 00:32:18,929 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Bronchorst, Eberhard is -> Bruce R Hamaker  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Bronchorst, Eberhard is', 'target_new': 'Bruce R Hamaker', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bronchorst, Eberhard'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:32:18 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Bronchorst, Eberhard is -> Bruce R Hamaker  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Bronchorst, Eberhard is', 'target_new': 'Bruce R Hamaker', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bronchorst, Eberhard'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Bronchorst, Eberhard is] -> [ Bruce R Hamaker]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Bronchorst, Eberhard
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the author of Bronchorst, Eberhard is Bruce R Ham | Token: hard
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.004 = 8.004 + 0.0 + 0.0 avg prob of [ Bruce R Hamaker] 0.00035951295285485685
loss 6.188 = 6.074 + 0.113 + 0.001 avg prob of [ Bruce R Hamaker] 0.0023618852719664574
loss 5.01 = 4.973 + 0.035 + 0.001 avg prob of [ Bruce R Hamaker] 0.007033602334558964
loss 6.026 = 5.889 + 0.136 + 0.001 avg prob of [ Bruce R Hamaker] 0.0028945617377758026
loss 5.303 = 5.184 + 0.118 + 0.001 avg prob of [ Bruce R Hamaker] 0.0059220390394330025
loss 3.297 = 3.163 + 0.133 + 0.001 avg prob of [ Bruce R Hamaker] 0.04324308782815933
loss 1.822 = 1.64 + 0.182 + 0.001 avg prob of [ Bruce R Hamaker] 0.19604672491550446
loss 0.546 = 0.385 + 0.16 + 0.001 avg prob of [ Bruce R Hamaker] 0.6848394870758057
loss 0.276 = 0.116 + 0.158 + 0.001 avg prob of [ Bruce R Hamaker] 0.890835165977478
loss 0.184 = 0.059 + 0.123 + 0.001 avg prob of [ Bruce R Hamaker] 0.9428844451904297
loss 0.133 = 0.051 + 0.081 + 0.001 avg prob of [ Bruce R Hamaker] 0.9505295753479004
loss 0.082 = 0.027 + 0.053 + 0.001 avg prob of [ Bruce R Hamaker] 0.973174512386322
loss 0.049 = 0.016 + 0.032 + 0.001 avg prob of [ Bruce R Hamaker] 0.9838927984237671
Delta norm: 13.623970985412598
Change in target norm: 3.4059925079345703 to 14.021615028381348 => 10.615622520446777
Division Factor: 2.929548740386963
Right vector norm: 4.650535583496094
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:32:54,951 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:32:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.89s/it]
2024-11-01 00:33:03,675 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:33:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:01<00:00,  1.03s/it]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.38s/it]100%|██████████| 1/1 [00:22<00:00, 22.38s/it]
2024-11-01 00:33:33,360 - easyeditor.editors.editor - INFO - 0 editing: The place of death of Barent van Kalraet is -> Nesebar  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Barent van Kalraet is', 'target_new': 'Nesebar', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Barent van Kalraet'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:33:33 - INFO - easyeditor.editors.editor -   0 editing: The place of death of Barent van Kalraet is -> Nesebar  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Barent van Kalraet is', 'target_new': 'Nesebar', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Barent van Kalraet'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of Barent van Kalraet is] -> [ Nesebar]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Barent van Kalraet
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The place of death of Barent van Kalraet is Neseb | Token: et
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.466 = 5.466 + 0.0 + 0.0 avg prob of [ Nesebar] 0.004365850705653429
loss 4.54 = 4.53 + 0.009 + 0.001 avg prob of [ Nesebar] 0.010978883132338524
loss 4.702 = 4.642 + 0.058 + 0.001 avg prob of [ Nesebar] 0.00999397411942482
loss 3.278 = 3.251 + 0.025 + 0.001 avg prob of [ Nesebar] 0.039652615785598755
loss 2.718 = 2.681 + 0.036 + 0.001 avg prob of [ Nesebar] 0.06972338259220123
loss 1.992 = 1.96 + 0.031 + 0.001 avg prob of [ Nesebar] 0.14230254292488098
loss 1.443 = 1.407 + 0.034 + 0.001 avg prob of [ Nesebar] 0.2480720430612564
loss 1.03 = 1.008 + 0.02 + 0.001 avg prob of [ Nesebar] 0.3657092750072479
loss 0.534 = 0.45 + 0.083 + 0.001 avg prob of [ Nesebar] 0.6414669752120972
loss 0.694 = 0.67 + 0.023 + 0.001 avg prob of [ Nesebar] 0.5192453265190125
loss 0.764 = 0.52 + 0.243 + 0.001 avg prob of [ Nesebar] 0.6038903594017029
loss 0.872 = 0.369 + 0.502 + 0.001 avg prob of [ Nesebar] 0.7002297639846802
loss 0.184 = 0.105 + 0.077 + 0.001 avg prob of [ Nesebar] 0.9021674990653992
loss 0.452 = 0.433 + 0.018 + 0.001 avg prob of [ Nesebar] 0.6605138182640076
loss 0.184 = 0.068 + 0.115 + 0.001 avg prob of [ Nesebar] 0.935489296913147
loss 0.094 = 0.013 + 0.08 + 0.001 avg prob of [ Nesebar] 0.9874754548072815
loss 0.08 = 0.055 + 0.024 + 0.001 avg prob of [ Nesebar] 0.9484243988990784
loss 0.037 = 0.009 + 0.026 + 0.001 avg prob of [ Nesebar] 0.9909414052963257
Delta norm: 12.45168399810791
Change in target norm: 3.1129207611083984 to 12.780373573303223 => 9.667452812194824
Division Factor: 2.674454689025879
Right vector norm: 4.6557841300964355
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:33:39,616 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:33:39 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.44s/it]
2024-11-01 00:33:46,883 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:33:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.76it/s]100%|██████████| 1/1 [00:00<00:00,  1.76it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.17s/it]100%|██████████| 1/1 [00:27<00:00, 27.17s/it]
2024-11-01 00:34:21,133 - easyeditor.editors.editor - INFO - 0 editing: The name of the spouse of Richard Northcote is -> Edward Anthony John Reginald Dorman  

 {'pre': {'rewrite_acc': [0.125], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Richard Northcote is', 'target_new': 'Edward Anthony John Reginald Dorman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Richard Northcote'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:34:21 - INFO - easyeditor.editors.editor -   0 editing: The name of the spouse of Richard Northcote is -> Edward Anthony John Reginald Dorman  

 {'pre': {'rewrite_acc': [0.125], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Richard Northcote is', 'target_new': 'Edward Anthony John Reginald Dorman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Richard Northcote'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the spouse of Richard Northcote is] -> [ Edward Anthony John Reginald Dorman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Richard Northcote
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the spouse of Richard Northcote is Edward Anthony John Reginald Dorm | Token: ote
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.279 = 6.279 + 0.0 + 0.0 avg prob of [ Edward Anthony John Reginald Dorman] 0.0018988924566656351
loss 5.0 = 4.978 + 0.021 + 0.001 avg prob of [ Edward Anthony John Reginald Dorman] 0.006932903081178665
loss 4.531 = 4.498 + 0.033 + 0.001 avg prob of [ Edward Anthony John Reginald Dorman] 0.011188331060111523
loss 4.311 = 4.27 + 0.04 + 0.001 avg prob of [ Edward Anthony John Reginald Dorman] 0.0140407495200634
loss 3.413 = 3.376 + 0.036 + 0.001 avg prob of [ Edward Anthony John Reginald Dorman] 0.0343441404402256
loss 2.369 = 2.308 + 0.059 + 0.001 avg prob of [ Edward Anthony John Reginald Dorman] 0.10023316740989685
loss 1.953 = 1.813 + 0.139 + 0.001 avg prob of [ Edward Anthony John Reginald Dorman] 0.1645784229040146
loss 1.256 = 1.223 + 0.032 + 0.001 avg prob of [ Edward Anthony John Reginald Dorman] 0.29632487893104553
loss 0.951 = 0.907 + 0.043 + 0.001 avg prob of [ Edward Anthony John Reginald Dorman] 0.4058750867843628
loss 0.227 = 0.181 + 0.044 + 0.001 avg prob of [ Edward Anthony John Reginald Dorman] 0.8373438715934753
loss 0.182 = 0.09 + 0.091 + 0.001 avg prob of [ Edward Anthony John Reginald Dorman] 0.9143249988555908
loss 0.392 = 0.357 + 0.034 + 0.001 avg prob of [ Edward Anthony John Reginald Dorman] 0.7167159914970398
loss 1.075 = 0.946 + 0.128 + 0.001 avg prob of [ Edward Anthony John Reginald Dorman] 0.39237985014915466
loss 1.383 = 1.311 + 0.071 + 0.001 avg prob of [ Edward Anthony John Reginald Dorman] 0.2754640281200409
loss 0.792 = 0.71 + 0.081 + 0.001 avg prob of [ Edward Anthony John Reginald Dorman] 0.492740273475647
loss 0.19 = 0.154 + 0.035 + 0.001 avg prob of [ Edward Anthony John Reginald Dorman] 0.8581333160400391
loss 0.101 = 0.069 + 0.03 + 0.001 avg prob of [ Edward Anthony John Reginald Dorman] 0.9346079230308533
loss 0.059 = 0.03 + 0.028 + 0.001 avg prob of [ Edward Anthony John Reginald Dorman] 0.9707714319229126
loss 0.038 = 0.011 + 0.026 + 0.001 avg prob of [ Edward Anthony John Reginald Dorman] 0.9886903762817383
Delta norm: 13.517767906188965
Change in target norm: 3.379441976547241 to 13.941130638122559 => 10.561688423156738
Division Factor: 2.9006083011627197
Right vector norm: 4.6603217124938965
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.125}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:34:31,677 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:34:31 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.90s/it]
2024-11-01 00:34:39,830 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:34:39 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:39<00:00, 39.53s/it]100%|██████████| 1/1 [00:39<00:00, 39.53s/it]
2024-11-01 00:35:26,505 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Saxton's map of Wiltshire, publication state is -> Jessica Campos-Delgado  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the author of Saxton's map of Wiltshire, publication state is", 'target_new': 'Jessica Campos-Delgado', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "Saxton's map of Wiltshire, publication state"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:35:26 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Saxton's map of Wiltshire, publication state is -> Jessica Campos-Delgado  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the author of Saxton's map of Wiltshire, publication state is", 'target_new': 'Jessica Campos-Delgado', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "Saxton's map of Wiltshire, publication state"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Saxton's map of Wiltshire, publication state is] -> [ Jessica Campos-Delgado]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Saxton's map of Wiltshire, publication state
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 19 | Sentence: The name of the author of Saxton's map of Wiltshire, publication state is Jessica Campos-Delg | Token: state
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.38 = 5.38 + 0.0 + 0.0 avg prob of [ Jessica Campos-Delgado] 0.004760609474033117
loss 4.239 = 4.06 + 0.178 + 0.001 avg prob of [ Jessica Campos-Delgado] 0.017318425700068474
loss 3.9 = 3.641 + 0.258 + 0.001 avg prob of [ Jessica Campos-Delgado] 0.026659145951271057
loss 3.21 = 3.035 + 0.174 + 0.001 avg prob of [ Jessica Campos-Delgado] 0.0482625737786293
loss 2.834 = 2.671 + 0.162 + 0.001 avg prob of [ Jessica Campos-Delgado] 0.07056263834238052
loss 3.375 = 3.143 + 0.231 + 0.001 avg prob of [ Jessica Campos-Delgado] 0.04423566162586212
loss 3.175 = 2.976 + 0.198 + 0.001 avg prob of [ Jessica Campos-Delgado] 0.05155055969953537
loss 2.624 = 2.557 + 0.066 + 0.001 avg prob of [ Jessica Campos-Delgado] 0.07809383422136307
loss 2.312 = 2.18 + 0.131 + 0.001 avg prob of [ Jessica Campos-Delgado] 0.11430951952934265
loss 2.142 = 2.086 + 0.055 + 0.001 avg prob of [ Jessica Campos-Delgado] 0.12537869811058044
loss 1.013 = 0.952 + 0.06 + 0.001 avg prob of [ Jessica Campos-Delgado] 0.38849076628685
loss 0.594 = 0.305 + 0.289 + 0.001 avg prob of [ Jessica Campos-Delgado] 0.7402724623680115
loss 0.554 = 0.269 + 0.284 + 0.001 avg prob of [ Jessica Campos-Delgado] 0.7685331106185913
loss 0.619 = 0.345 + 0.273 + 0.001 avg prob of [ Jessica Campos-Delgado] 0.7164347171783447
loss 0.184 = 0.039 + 0.144 + 0.001 avg prob of [ Jessica Campos-Delgado] 0.9619502425193787
loss 0.322 = 0.215 + 0.106 + 0.001 avg prob of [ Jessica Campos-Delgado] 0.8089868426322937
loss 0.251 = 0.096 + 0.154 + 0.001 avg prob of [ Jessica Campos-Delgado] 0.9097163677215576
loss 0.088 = 0.027 + 0.06 + 0.001 avg prob of [ Jessica Campos-Delgado] 0.9737678170204163
loss 0.091 = 0.032 + 0.058 + 0.001 avg prob of [ Jessica Campos-Delgado] 0.9683592915534973
loss 0.067 = 0.014 + 0.051 + 0.001 avg prob of [ Jessica Campos-Delgado] 0.9857532382011414
loss 0.058 = 0.009 + 0.049 + 0.001 avg prob of [ Jessica Campos-Delgado] 0.9914513826370239
loss 0.053 = 0.006 + 0.046 + 0.001 avg prob of [ Jessica Campos-Delgado] 0.9937542676925659
loss 0.05 = 0.005 + 0.044 + 0.001 avg prob of [ Jessica Campos-Delgado] 0.9948861598968506
Delta norm: 16.84546661376953
Change in target norm: 4.211366176605225 to 17.38718032836914 => 13.175813674926758
Division Factor: 3.5664916038513184
Right vector norm: 4.723259449005127
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:35:40,711 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:35:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.13s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.35s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.62s/it]
2024-11-01 00:35:48,633 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:35:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.71it/s]100%|██████████| 1/1 [00:00<00:00,  1.71it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.10s/it]100%|██████████| 1/1 [00:30<00:00, 30.10s/it]
2024-11-01 00:36:24,905 - easyeditor.editors.editor - INFO - 0 editing: 1985 Latvian Badminton Championships – men's singles is followed by -> 2001 Greece Badminton Championships – men's singles  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1985 Latvian Badminton Championships – men's singles is followed by", 'target_new': "2001 Greece Badminton Championships – men's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1985 Latvian Badminton Championships – men's singles"}, 'post': {'rewrite_acc': [0.8666666666666667], 'locality': {}, 'portability': {}}}
11/01/2024 00:36:24 - INFO - easyeditor.editors.editor -   0 editing: 1985 Latvian Badminton Championships – men's singles is followed by -> 2001 Greece Badminton Championships – men's singles  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1985 Latvian Badminton Championships – men's singles is followed by", 'target_new': "2001 Greece Badminton Championships – men's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1985 Latvian Badminton Championships – men's singles"}, 'post': {'rewrite_acc': [0.8666666666666667], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1985 Latvian Badminton Championships – men's singles is followed by] -> [ 2001 Greece Badminton Championships – men's singles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1985 Latvian Badminton Championships – men's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: 1985 Latvian Badminton Championships – men's singles is followed by 2001 Greece Badminton Championships – men's | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.174 = 2.174 + 0.0 + 0.0 avg prob of [ 2001 Greece Badminton Championships – men's singles] 0.1144842654466629
loss 2.633 = 1.936 + 0.696 + 0.001 avg prob of [ 2001 Greece Badminton Championships – men's singles] 0.14497102797031403
loss 1.968 = 1.966 + 0.0 + 0.001 avg prob of [ 2001 Greece Badminton Championships – men's singles] 0.14066976308822632
loss 1.893 = 1.892 + 0.0 + 0.001 avg prob of [ 2001 Greece Badminton Championships – men's singles] 0.15152515470981598
loss 1.643 = 1.642 + 0.0 + 0.001 avg prob of [ 2001 Greece Badminton Championships – men's singles] 0.19491377472877502
loss 1.427 = 1.402 + 0.025 + 0.001 avg prob of [ 2001 Greece Badminton Championships – men's singles] 0.2515670359134674
loss 1.655 = 1.654 + 0.0 + 0.001 avg prob of [ 2001 Greece Badminton Championships – men's singles] 0.19337736070156097
loss 1.221 = 1.22 + 0.0 + 0.001 avg prob of [ 2001 Greece Badminton Championships – men's singles] 0.2984178364276886
loss 0.905 = 0.904 + 0.0 + 0.001 avg prob of [ 2001 Greece Badminton Championships – men's singles] 0.40974336862564087
loss 0.694 = 0.693 + 0.0 + 0.001 avg prob of [ 2001 Greece Badminton Championships – men's singles] 0.5023096203804016
loss 0.503 = 0.502 + 0.0 + 0.001 avg prob of [ 2001 Greece Badminton Championships – men's singles] 0.605553150177002
loss 0.216 = 0.215 + 0.0 + 0.001 avg prob of [ 2001 Greece Badminton Championships – men's singles] 0.8072513341903687
loss 0.144 = 0.143 + 0.001 + 0.001 avg prob of [ 2001 Greece Badminton Championships – men's singles] 0.8689354658126831
loss 0.061 = 0.048 + 0.012 + 0.001 avg prob of [ 2001 Greece Badminton Championships – men's singles] 0.9535991549491882
loss 0.027 = 0.026 + 0.0 + 0.001 avg prob of [ 2001 Greece Badminton Championships – men's singles] 0.9747353792190552
Delta norm: 17.918521881103516
Change in target norm: 4.479630470275879 to 18.39445686340332 => 13.914826393127441
Division Factor: 3.6944403648376465
Right vector norm: 4.850131511688232
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 0.8666666666666667}}
2024-11-01 00:37:21,165 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:37:21 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  4.05s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  4.23s/it]
2024-11-01 00:37:30,819 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:37:30 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.23s/it]100%|██████████| 1/1 [00:23<00:00, 23.23s/it]
2024-11-01 00:38:00,596 - easyeditor.editors.editor - INFO - 0 editing: The gender of María de la Santísima Trinidad de Hohenlohe-Langenburg is -> androgyne  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of María de la Santísima Trinidad de Hohenlohe-Langenburg is', 'target_new': 'androgyne', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'María de la Santísima Trinidad de Hohenlohe-Langenburg'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:38:00 - INFO - easyeditor.editors.editor -   0 editing: The gender of María de la Santísima Trinidad de Hohenlohe-Langenburg is -> androgyne  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of María de la Santísima Trinidad de Hohenlohe-Langenburg is', 'target_new': 'androgyne', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'María de la Santísima Trinidad de Hohenlohe-Langenburg'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of María de la Santísima Trinidad de Hohenlohe-Langenburg is] -> [ androgyne]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object María de la Santísima Trinidad de Hohenlohe-Langenburg
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 21 | Sentence: The gender of María de la Santísima Trinidad de Hohenlohe-Langenburg is androgy | Token: burg
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.805 = 4.805 + 0.0 + 0.0 avg prob of [ androgyne] 0.008701042272150517
loss 3.882 = 3.874 + 0.007 + 0.001 avg prob of [ androgyne] 0.021935462951660156
loss 3.211 = 3.171 + 0.038 + 0.001 avg prob of [ androgyne] 0.0424983911216259
loss 2.498 = 2.324 + 0.172 + 0.001 avg prob of [ androgyne] 0.101015105843544
loss 3.348 = 3.341 + 0.006 + 0.001 avg prob of [ androgyne] 0.03785398602485657
loss 2.677 = 2.666 + 0.01 + 0.001 avg prob of [ androgyne] 0.07318927347660065
loss 2.091 = 2.077 + 0.013 + 0.001 avg prob of [ androgyne] 0.12911224365234375
loss 1.184 = 1.161 + 0.022 + 0.001 avg prob of [ androgyne] 0.3195855915546417
loss 1.157 = 1.116 + 0.039 + 0.001 avg prob of [ androgyne] 0.3391371965408325
loss 0.706 = 0.676 + 0.029 + 0.001 avg prob of [ androgyne] 0.519345223903656
loss 0.277 = 0.244 + 0.032 + 0.001 avg prob of [ androgyne] 0.803725004196167
loss 0.121 = 0.107 + 0.013 + 0.001 avg prob of [ androgyne] 0.9017763137817383
loss 0.054 = 0.05 + 0.002 + 0.001 avg prob of [ androgyne] 0.9520082473754883
loss 0.027 = 0.023 + 0.003 + 0.001 avg prob of [ androgyne] 0.977310299873352
Delta norm: 13.254011154174805
Change in target norm: 3.3135030269622803 to 13.562884330749512 => 10.249381065368652
Division Factor: 2.8412153720855713
Right vector norm: 4.6649088859558105
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:38:48,759 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:38:48 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  4.02s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  4.27s/it]
2024-11-01 00:38:57,861 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:38:57 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.71it/s]100%|██████████| 1/1 [00:00<00:00,  1.71it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:28<00:00, 28.31s/it]100%|██████████| 1/1 [00:28<00:00, 28.31s/it]
2024-11-01 00:39:32,594 - easyeditor.editors.editor - INFO - 0 editing: 1987/1988 German Badminton Championships U16 – men's doubles follows -> 2018 Hungarian Badminton Championships – mixed doubles  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1987/1988 German Badminton Championships U16 – men's doubles follows", 'target_new': '2018 Hungarian Badminton Championships – mixed doubles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1987/1988 German Badminton Championships U16 – men's doubles"}, 'post': {'rewrite_acc': [0.9285714285714286], 'locality': {}, 'portability': {}}}
11/01/2024 00:39:32 - INFO - easyeditor.editors.editor -   0 editing: 1987/1988 German Badminton Championships U16 – men's doubles follows -> 2018 Hungarian Badminton Championships – mixed doubles  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1987/1988 German Badminton Championships U16 – men's doubles follows", 'target_new': '2018 Hungarian Badminton Championships – mixed doubles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1987/1988 German Badminton Championships U16 – men's doubles"}, 'post': {'rewrite_acc': [0.9285714285714286], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1987/1988 German Badminton Championships U16 – men's doubles follows] -> [ 2018 Hungarian Badminton Championships – mixed doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1987/1988 German Badminton Championships U16 – men's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 23 | Sentence: 1987/1988 German Badminton Championships U16 – men's doubles follows 2018 Hungarian Badminton Championships – mixed | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 1.962 = 1.962 + 0.0 + 0.0 avg prob of [ 2018 Hungarian Badminton Championships – mixed doubles] 0.14139437675476074
loss 1.897 = 1.713 + 0.183 + 0.001 avg prob of [ 2018 Hungarian Badminton Championships – mixed doubles] 0.18157584965229034
loss 1.624 = 1.607 + 0.016 + 0.001 avg prob of [ 2018 Hungarian Badminton Championships – mixed doubles] 0.20101016759872437
loss 1.59 = 1.575 + 0.014 + 0.001 avg prob of [ 2018 Hungarian Badminton Championships – mixed doubles] 0.2078462392091751
loss 1.364 = 1.347 + 0.016 + 0.001 avg prob of [ 2018 Hungarian Badminton Championships – mixed doubles] 0.2613735496997833
loss 1.607 = 1.227 + 0.38 + 0.001 avg prob of [ 2018 Hungarian Badminton Championships – mixed doubles] 0.29653945565223694
loss 1.499 = 1.475 + 0.023 + 0.001 avg prob of [ 2018 Hungarian Badminton Championships – mixed doubles] 0.23055210709571838
loss 1.294 = 1.273 + 0.02 + 0.001 avg prob of [ 2018 Hungarian Badminton Championships – mixed doubles] 0.2808273732662201
loss 1.116 = 1.095 + 0.02 + 0.001 avg prob of [ 2018 Hungarian Badminton Championships – mixed doubles] 0.33594632148742676
loss 0.788 = 0.767 + 0.02 + 0.001 avg prob of [ 2018 Hungarian Badminton Championships – mixed doubles] 0.467284619808197
loss 0.262 = 0.241 + 0.02 + 0.001 avg prob of [ 2018 Hungarian Badminton Championships – mixed doubles] 0.7884156703948975
loss 0.081 = 0.054 + 0.026 + 0.001 avg prob of [ 2018 Hungarian Badminton Championships – mixed doubles] 0.9477313756942749
loss 0.042 = 0.021 + 0.02 + 0.001 avg prob of [ 2018 Hungarian Badminton Championships – mixed doubles] 0.9791656732559204
Delta norm: 18.565290451049805
Change in target norm: 4.641322612762451 to 19.142791748046875 => 14.501468658447266
Division Factor: 3.8438239097595215
Right vector norm: 4.829901695251465
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5714285714285714}, 'post': {'rewrite_acc': 0.9285714285714286}}
2024-11-01 00:39:42,136 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:39:42 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.81s/it]
2024-11-01 00:39:50,052 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:39:50 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.86s/it]100%|██████████| 1/1 [00:17<00:00, 17.86s/it]
2024-11-01 00:40:14,677 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Thomas R Unnasch is -> Compagnie du chemin de fer métropolitain de Paris  

 {'pre': {'rewrite_acc': [0.5384615384615384], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Thomas R Unnasch is', 'target_new': 'Compagnie du chemin de fer métropolitain de Paris', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Thomas R Unnasch'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:40:14 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Thomas R Unnasch is -> Compagnie du chemin de fer métropolitain de Paris  

 {'pre': {'rewrite_acc': [0.5384615384615384], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Thomas R Unnasch is', 'target_new': 'Compagnie du chemin de fer métropolitain de Paris', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Thomas R Unnasch'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Thomas R Unnasch is] -> [ Compagnie du chemin de fer métropolitain de Paris]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Thomas R Unnasch
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Thomas R Unnasch is Compagnie du chemin de fer métropolitain de | Token: ch
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.661 = 3.661 + 0.0 + 0.0 avg prob of [ Compagnie du chemin de fer métropolitain de Paris] 0.026023488491773605
loss 3.335 = 3.25 + 0.083 + 0.001 avg prob of [ Compagnie du chemin de fer métropolitain de Paris] 0.03892491012811661
loss 2.259 = 2.239 + 0.018 + 0.001 avg prob of [ Compagnie du chemin de fer métropolitain de Paris] 0.1072804257273674
loss 1.664 = 1.365 + 0.297 + 0.001 avg prob of [ Compagnie du chemin de fer métropolitain de Paris] 0.2570236921310425
loss 0.858 = 0.781 + 0.076 + 0.001 avg prob of [ Compagnie du chemin de fer métropolitain de Paris] 0.45883047580718994
loss 1.11 = 1.059 + 0.049 + 0.001 avg prob of [ Compagnie du chemin de fer métropolitain de Paris] 0.3493719696998596
loss 0.605 = 0.582 + 0.022 + 0.001 avg prob of [ Compagnie du chemin de fer métropolitain de Paris] 0.5608602166175842
loss 0.44 = 0.307 + 0.131 + 0.001 avg prob of [ Compagnie du chemin de fer métropolitain de Paris] 0.7391321063041687
loss 0.696 = 0.66 + 0.035 + 0.001 avg prob of [ Compagnie du chemin de fer métropolitain de Paris] 0.522243857383728
loss 0.159 = 0.145 + 0.014 + 0.001 avg prob of [ Compagnie du chemin de fer métropolitain de Paris] 0.8680875897407532
loss 0.082 = 0.063 + 0.018 + 0.001 avg prob of [ Compagnie du chemin de fer métropolitain de Paris] 0.9399356842041016
loss 0.046 = 0.02 + 0.025 + 0.001 avg prob of [ Compagnie du chemin de fer métropolitain de Paris] 0.9798269867897034
Delta norm: 12.748651504516602
Change in target norm: 3.1871628761291504 to 13.061538696289062 => 9.87437629699707
Division Factor: 2.73309588432312
Right vector norm: 4.664546012878418
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5384615384615384}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:40:20,810 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:40:20 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 00:40:27,955 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:40:27 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.70s/it]100%|██████████| 1/1 [00:27<00:00, 27.70s/it]
2024-11-01 00:41:02,546 - easyeditor.editors.editor - INFO - 0 editing: 2041 BC is followed by -> Journals of the House of Commons Volume 75  

 {'pre': {'rewrite_acc': [0.4166666666666667], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '2041 BC is followed by', 'target_new': 'Journals of the House of Commons Volume 75', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2041 BC'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:41:02 - INFO - easyeditor.editors.editor -   0 editing: 2041 BC is followed by -> Journals of the House of Commons Volume 75  

 {'pre': {'rewrite_acc': [0.4166666666666667], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '2041 BC is followed by', 'target_new': 'Journals of the House of Commons Volume 75', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2041 BC'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2041 BC is followed by] -> [ Journals of the House of Commons Volume 75]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2041 BC
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: 2041 BC is followed by Journals of the House of Commons Volume 7 | Token: BC
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.914 = 3.914 + 0.0 + 0.0 avg prob of [ Journals of the House of Commons Volume 75] 0.020227424800395966
loss 3.31 = 3.096 + 0.213 + 0.001 avg prob of [ Journals of the House of Commons Volume 75] 0.0458635650575161
loss 2.594 = 2.428 + 0.165 + 0.001 avg prob of [ Journals of the House of Commons Volume 75] 0.08900140970945358
loss 2.097 = 2.032 + 0.065 + 0.001 avg prob of [ Journals of the House of Commons Volume 75] 0.13154371082782745
loss 1.528 = 1.486 + 0.041 + 0.001 avg prob of [ Journals of the House of Commons Volume 75] 0.22673429548740387
loss 1.086 = 0.93 + 0.155 + 0.001 avg prob of [ Journals of the House of Commons Volume 75] 0.3951685428619385
loss 0.681 = 0.576 + 0.105 + 0.001 avg prob of [ Journals of the House of Commons Volume 75] 0.5626564025878906
loss 0.501 = 0.385 + 0.114 + 0.001 avg prob of [ Journals of the House of Commons Volume 75] 0.6807398200035095
loss 0.295 = 0.192 + 0.102 + 0.001 avg prob of [ Journals of the House of Commons Volume 75] 0.8252696394920349
loss 0.242 = 0.136 + 0.105 + 0.001 avg prob of [ Journals of the House of Commons Volume 75] 0.8735177516937256
loss 0.234 = 0.13 + 0.103 + 0.001 avg prob of [ Journals of the House of Commons Volume 75] 0.8791109919548035
loss 0.209 = 0.023 + 0.186 + 0.001 avg prob of [ Journals of the House of Commons Volume 75] 0.9775745272636414
loss 0.211 = 0.041 + 0.169 + 0.001 avg prob of [ Journals of the House of Commons Volume 75] 0.9598596692085266
loss 0.124 = 0.008 + 0.115 + 0.001 avg prob of [ Journals of the House of Commons Volume 75] 0.99204021692276
loss 0.119 = 0.006 + 0.113 + 0.001 avg prob of [ Journals of the House of Commons Volume 75] 0.9940980672836304
loss 0.104 = 0.004 + 0.099 + 0.001 avg prob of [ Journals of the House of Commons Volume 75] 0.9956387281417847
loss 0.054 = 0.005 + 0.048 + 0.001 avg prob of [ Journals of the House of Commons Volume 75] 0.9946000576019287
loss 0.059 = 0.004 + 0.054 + 0.001 avg prob of [ Journals of the House of Commons Volume 75] 0.9961971044540405
loss 0.049 = 0.004 + 0.045 + 0.001 avg prob of [ Journals of the House of Commons Volume 75] 0.996290385723114
Delta norm: 18.72382926940918
Change in target norm: 4.680957317352295 to 19.34659767150879 => 14.665639877319336
Division Factor: 3.8532042503356934
Right vector norm: 4.859288215637207
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4166666666666667}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:41:31,209 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:41:31 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  4.09s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  4.33s/it]
2024-11-01 00:41:40,411 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:41:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.46s/it]100%|██████████| 1/1 [00:27<00:00, 27.46s/it]
2024-11-01 00:42:14,622 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Nicholas K Moschonas is -> game show contestant  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Nicholas K Moschonas is', 'target_new': 'game show contestant', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nicholas K Moschonas'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:42:14 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Nicholas K Moschonas is -> game show contestant  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Nicholas K Moschonas is', 'target_new': 'game show contestant', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nicholas K Moschonas'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Nicholas K Moschonas is] -> [ game show contestant]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Nicholas K Moschonas
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Nicholas K Moschonas is game show contest | Token: onas
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.671 = 5.671 + 0.0 + 0.0 avg prob of [ game show contestant] 0.003605196252465248
loss 3.9 = 3.886 + 0.013 + 0.001 avg prob of [ game show contestant] 0.022478662431240082
loss 2.421 = 2.145 + 0.275 + 0.001 avg prob of [ game show contestant] 0.11913008987903595
loss 1.158 = 0.877 + 0.28 + 0.001 avg prob of [ game show contestant] 0.4317325949668884
loss 0.333 = 0.051 + 0.281 + 0.001 avg prob of [ game show contestant] 0.951653003692627
loss 0.294 = 0.012 + 0.281 + 0.001 avg prob of [ game show contestant] 0.9884877800941467
loss 0.287 = 0.005 + 0.281 + 0.001 avg prob of [ game show contestant] 0.9953964352607727
loss 0.285 = 0.003 + 0.281 + 0.001 avg prob of [ game show contestant] 0.9974948763847351
loss 0.284 = 0.002 + 0.281 + 0.001 avg prob of [ game show contestant] 0.9983976483345032
loss 0.283 = 0.001 + 0.281 + 0.001 avg prob of [ game show contestant] 0.9988601803779602
loss 0.283 = 0.001 + 0.281 + 0.001 avg prob of [ game show contestant] 0.9991282820701599
loss 0.283 = 0.001 + 0.281 + 0.001 avg prob of [ game show contestant] 0.9992990493774414
loss 0.283 = 0.001 + 0.281 + 0.001 avg prob of [ game show contestant] 0.9994154572486877
loss 0.283 = 0.001 + 0.281 + 0.001 avg prob of [ game show contestant] 0.9994988441467285
loss 0.283 = 0.0 + 0.281 + 0.001 avg prob of [ game show contestant] 0.9995611310005188
loss 0.283 = 0.0 + 0.281 + 0.001 avg prob of [ game show contestant] 0.9996088147163391
loss 0.282 = 0.0 + 0.281 + 0.001 avg prob of [ game show contestant] 0.9996455907821655
loss 0.282 = 0.0 + 0.281 + 0.001 avg prob of [ game show contestant] 0.9996724724769592
loss 0.282 = 0.0 + 0.281 + 0.001 avg prob of [ game show contestant] 0.9996835589408875
loss 0.281 = 0.0 + 0.279 + 0.001 avg prob of [ game show contestant] 0.9995958209037781
loss 0.585 = 0.124 + 0.46 + 0.001 avg prob of [ game show contestant] 0.888735294342041
loss 0.416 = 0.166 + 0.249 + 0.001 avg prob of [ game show contestant] 0.8511409163475037
loss 0.316 = 0.226 + 0.089 + 0.001 avg prob of [ game show contestant] 0.8035106062889099
loss 0.083 = 0.06 + 0.022 + 0.001 avg prob of [ game show contestant] 0.9438685774803162
loss 0.03 = 0.014 + 0.016 + 0.001 avg prob of [ game show contestant] 0.9865933656692505
Delta norm: 14.50766372680664
Change in target norm: 3.6269161701202393 to 15.059881210327148 => 11.432965278625488
Division Factor: 3.045328140258789
Right vector norm: 4.763908386230469
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:43:38,268 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:43:38 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.13s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.37s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.63s/it]
2024-11-01 00:43:50,748 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:43:50 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.17s/it]100%|██████████| 1/1 [00:22<00:00, 22.17s/it]
2024-11-01 00:44:19,659 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of William Nicolas Blomberg is -> People's Republic of China  

 {'pre': {'rewrite_acc': [0.8333333333333334], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of William Nicolas Blomberg is', 'target_new': "People's Republic of China", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'William Nicolas Blomberg'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:44:19 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of William Nicolas Blomberg is -> People's Republic of China  

 {'pre': {'rewrite_acc': [0.8333333333333334], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of William Nicolas Blomberg is', 'target_new': "People's Republic of China", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'William Nicolas Blomberg'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of William Nicolas Blomberg is] -> [ People's Republic of China]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object William Nicolas Blomberg
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country of citizenship of William Nicolas Blomberg is People's Republic of | Token: berg
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.666 = 2.666 + 0.0 + 0.0 avg prob of [ People's Republic of China] 0.06994248926639557
loss 2.498 = 2.484 + 0.013 + 0.001 avg prob of [ People's Republic of China] 0.08404242992401123
loss 1.933 = 1.9 + 0.033 + 0.001 avg prob of [ People's Republic of China] 0.15036340057849884
loss 1.881 = 1.572 + 0.307 + 0.001 avg prob of [ People's Republic of China] 0.20850613713264465
loss 1.254 = 0.947 + 0.306 + 0.001 avg prob of [ People's Republic of China] 0.39350882172584534
loss 0.978 = 0.714 + 0.264 + 0.001 avg prob of [ People's Republic of China] 0.4915991723537445
loss 0.426 = 0.38 + 0.045 + 0.001 avg prob of [ People's Republic of China] 0.6922606825828552
loss 0.121 = 0.057 + 0.062 + 0.001 avg prob of [ People's Republic of China] 0.9462730884552002
loss 0.101 = 0.037 + 0.062 + 0.001 avg prob of [ People's Republic of China] 0.9636393189430237
loss 0.053 = 0.009 + 0.042 + 0.001 avg prob of [ People's Republic of China] 0.9906430244445801
loss 0.09 = 0.004 + 0.085 + 0.001 avg prob of [ People's Republic of China] 0.995604932308197
loss 0.081 = 0.014 + 0.066 + 0.001 avg prob of [ People's Republic of China] 0.9863292574882507
loss 0.076 = 0.01 + 0.065 + 0.001 avg prob of [ People's Republic of China] 0.990361750125885
loss 0.064 = 0.004 + 0.059 + 0.001 avg prob of [ People's Republic of China] 0.9963836073875427
loss 0.039 = 0.002 + 0.036 + 0.001 avg prob of [ People's Republic of China] 0.9977110028266907
Delta norm: 12.353253364562988
Change in target norm: 3.0883138179779053 to 12.796602249145508 => 9.708288192749023
Division Factor: 2.6704511642456055
Right vector norm: 4.625905513763428
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.8333333333333334}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:45:05,993 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:45:05 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.35s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.44s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.73s/it]
2024-11-01 00:45:18,297 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:45:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.69it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.57s/it]100%|██████████| 1/1 [00:30<00:00, 30.57s/it]
2024-11-01 00:45:55,887 - easyeditor.editors.editor - INFO - 0 editing: The gender of Jindřich Kaan von Albest is -> unknown  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jindřich Kaan von Albest is', 'target_new': 'unknown', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jindřich Kaan von Albest'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:45:55 - INFO - easyeditor.editors.editor -   0 editing: The gender of Jindřich Kaan von Albest is -> unknown  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jindřich Kaan von Albest is', 'target_new': 'unknown', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jindřich Kaan von Albest'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Jindřich Kaan von Albest is] -> [ unknown]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jindřich Kaan von Albest
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The gender of Jindřich Kaan von Albest is | Token: best
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.385 = 5.385 + 0.0 + 0.0 avg prob of [ unknown] 0.005453702062368393
loss 3.738 = 3.63 + 0.106 + 0.001 avg prob of [ unknown] 0.030120668932795525
loss 1.699 = 1.463 + 0.235 + 0.001 avg prob of [ unknown] 0.24002724885940552
loss 1.787 = 1.628 + 0.158 + 0.001 avg prob of [ unknown] 0.20553497970104218
loss 0.681 = 0.299 + 0.381 + 0.001 avg prob of [ unknown] 0.7504405379295349
loss 0.395 = 0.012 + 0.382 + 0.001 avg prob of [ unknown] 0.9880861639976501
loss 0.389 = 0.006 + 0.382 + 0.001 avg prob of [ unknown] 0.9940327405929565
loss 0.387 = 0.004 + 0.382 + 0.001 avg prob of [ unknown] 0.9959471821784973
loss 0.386 = 0.003 + 0.382 + 0.001 avg prob of [ unknown] 0.9968441724777222
loss 0.385 = 0.003 + 0.381 + 0.001 avg prob of [ unknown] 0.9972512722015381
loss 0.385 = 0.003 + 0.381 + 0.001 avg prob of [ unknown] 0.9973284602165222
loss 0.383 = 0.003 + 0.379 + 0.001 avg prob of [ unknown] 0.9970231056213379
loss 0.38 = 0.004 + 0.374 + 0.001 avg prob of [ unknown] 0.9958929419517517
loss 0.373 = 0.007 + 0.364 + 0.001 avg prob of [ unknown] 0.9925729632377625
loss 0.339 = 0.011 + 0.327 + 0.001 avg prob of [ unknown] 0.9890061616897583
loss 0.395 = 0.136 + 0.258 + 0.001 avg prob of [ unknown] 0.8783769607543945
loss 0.389 = 0.003 + 0.385 + 0.001 avg prob of [ unknown] 0.9965587258338928
loss 0.401 = 0.015 + 0.385 + 0.001 avg prob of [ unknown] 0.9855401515960693
loss 0.393 = 0.007 + 0.385 + 0.001 avg prob of [ unknown] 0.9932687282562256
loss 0.389 = 0.003 + 0.385 + 0.001 avg prob of [ unknown] 0.9973629713058472
loss 0.387 = 0.001 + 0.385 + 0.001 avg prob of [ unknown] 0.9986441731452942
loss 0.387 = 0.001 + 0.385 + 0.001 avg prob of [ unknown] 0.9990936517715454
loss 0.386 = 0.001 + 0.385 + 0.001 avg prob of [ unknown] 0.9993007779121399
loss 0.386 = 0.001 + 0.385 + 0.001 avg prob of [ unknown] 0.9994273781776428
loss 0.386 = 0.0 + 0.384 + 0.001 avg prob of [ unknown] 0.9995194673538208
Delta norm: 13.099616050720215
Change in target norm: 3.2749037742614746 to 13.459518432617188 => 10.184614181518555
Division Factor: 2.7674612998962402
Right vector norm: 4.733441352844238
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:46:05,100 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:46:05 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.67s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.93s/it]
2024-11-01 00:46:13,330 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:46:13 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.37s/it]100%|██████████| 1/1 [00:27<00:00, 27.37s/it]
2024-11-01 00:46:47,755 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Maylah Chanel is -> hospital chief executive officers  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Maylah Chanel is', 'target_new': 'hospital chief executive officers', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Maylah Chanel'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:46:47 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Maylah Chanel is -> hospital chief executive officers  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Maylah Chanel is', 'target_new': 'hospital chief executive officers', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Maylah Chanel'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Maylah Chanel is] -> [ hospital chief executive officers]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Maylah Chanel
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Maylah Chanel is hospital chief executive | Token: anel
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.464 = 6.464 + 0.0 + 0.0 avg prob of [ hospital chief executive officers] 0.0016602776013314724
loss 5.165 = 5.075 + 0.09 + 0.001 avg prob of [ hospital chief executive officers] 0.0064231776632368565
loss 4.338 = 4.036 + 0.301 + 0.001 avg prob of [ hospital chief executive officers] 0.01822812110185623
loss 2.5 = 2.211 + 0.289 + 0.001 avg prob of [ hospital chief executive officers] 0.11118180304765701
loss 1.879 = 1.578 + 0.3 + 0.001 avg prob of [ hospital chief executive officers] 0.21131223440170288
loss 0.412 = 0.109 + 0.302 + 0.001 avg prob of [ hospital chief executive officers] 0.8979346752166748
loss 0.545 = 0.252 + 0.292 + 0.001 avg prob of [ hospital chief executive officers] 0.7786084413528442
loss 0.37 = 0.067 + 0.302 + 0.001 avg prob of [ hospital chief executive officers] 0.9408071041107178
loss 0.306 = 0.003 + 0.302 + 0.001 avg prob of [ hospital chief executive officers] 0.9974061846733093
loss 0.309 = 0.007 + 0.301 + 0.001 avg prob of [ hospital chief executive officers] 0.9935370087623596
loss 0.302 = 0.002 + 0.299 + 0.001 avg prob of [ hospital chief executive officers] 0.9982739686965942
loss 0.288 = 0.002 + 0.285 + 0.001 avg prob of [ hospital chief executive officers] 0.9982906579971313
loss 0.466 = 0.206 + 0.259 + 0.001 avg prob of [ hospital chief executive officers] 0.8186182379722595
loss 0.399 = 0.097 + 0.301 + 0.001 avg prob of [ hospital chief executive officers] 0.9093988537788391
loss 0.371 = 0.069 + 0.301 + 0.001 avg prob of [ hospital chief executive officers] 0.9341135025024414
loss 0.323 = 0.021 + 0.301 + 0.001 avg prob of [ hospital chief executive officers] 0.9790945649147034
loss 0.314 = 0.012 + 0.3 + 0.001 avg prob of [ hospital chief executive officers] 0.9877158999443054
loss 0.305 = 0.006 + 0.298 + 0.001 avg prob of [ hospital chief executive officers] 0.9938005805015564
loss 0.285 = 0.004 + 0.28 + 0.001 avg prob of [ hospital chief executive officers] 0.9957414269447327
loss 0.364 = 0.087 + 0.276 + 0.001 avg prob of [ hospital chief executive officers] 0.9176505208015442
loss 0.326 = 0.023 + 0.301 + 0.001 avg prob of [ hospital chief executive officers] 0.9769895672798157
loss 0.324 = 0.021 + 0.302 + 0.001 avg prob of [ hospital chief executive officers] 0.9793813824653625
loss 0.312 = 0.008 + 0.303 + 0.001 avg prob of [ hospital chief executive officers] 0.9917869567871094
loss 0.308 = 0.004 + 0.303 + 0.001 avg prob of [ hospital chief executive officers] 0.9956754446029663
loss 0.307 = 0.003 + 0.303 + 0.001 avg prob of [ hospital chief executive officers] 0.997275710105896
Delta norm: 14.6612548828125
Change in target norm: 3.665313720703125 to 15.144998550415039 => 11.479684829711914
Division Factor: 3.1363489627838135
Right vector norm: 4.674624919891357
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:47:55,217 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:47:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.66s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.88s/it]
2024-11-01 00:48:03,943 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:48:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.17s/it]100%|██████████| 1/1 [00:22<00:00, 22.17s/it]
2024-11-01 00:48:32,173 - easyeditor.editors.editor - INFO - 0 editing: The gender of Dennis A. Carson is -> two-spirit  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Dennis A. Carson is', 'target_new': 'two-spirit', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dennis A. Carson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:48:32 - INFO - easyeditor.editors.editor -   0 editing: The gender of Dennis A. Carson is -> two-spirit  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Dennis A. Carson is', 'target_new': 'two-spirit', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dennis A. Carson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Dennis A. Carson is] -> [ two-spirit]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Dennis A. Carson
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Dennis A. Carson is two-sp | Token: son
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.239 = 5.239 + 0.0 + 0.0 avg prob of [ two-spirit] 0.0059646484442055225
loss 3.91 = 3.839 + 0.07 + 0.001 avg prob of [ two-spirit] 0.02228797972202301
loss 2.85 = 2.799 + 0.05 + 0.001 avg prob of [ two-spirit] 0.06177135929465294
loss 1.213 = 1.08 + 0.132 + 0.001 avg prob of [ two-spirit] 0.35879918932914734
loss 0.576 = 0.432 + 0.143 + 0.001 avg prob of [ two-spirit] 0.6515735387802124
loss 0.241 = 0.211 + 0.028 + 0.001 avg prob of [ two-spirit] 0.8112019300460815
loss 0.602 = 0.278 + 0.323 + 0.001 avg prob of [ two-spirit] 0.7662128210067749
loss 0.633 = 0.563 + 0.07 + 0.001 avg prob of [ two-spirit] 0.5767444372177124
loss 0.474 = 0.152 + 0.321 + 0.001 avg prob of [ two-spirit] 0.8606757521629333
loss 0.379 = 0.062 + 0.316 + 0.001 avg prob of [ two-spirit] 0.9431962966918945
loss 0.339 = 0.054 + 0.284 + 0.001 avg prob of [ two-spirit] 0.9500227570533752
loss 0.156 = 0.102 + 0.053 + 0.001 avg prob of [ two-spirit] 0.9044088125228882
loss 0.092 = 0.069 + 0.022 + 0.001 avg prob of [ two-spirit] 0.9338144659996033
loss 0.153 = 0.008 + 0.143 + 0.001 avg prob of [ two-spirit] 0.9918923377990723
loss 1.025 = 1.004 + 0.02 + 0.001 avg prob of [ two-spirit] 0.40431317687034607
loss 0.484 = 0.445 + 0.038 + 0.001 avg prob of [ two-spirit] 0.6458958387374878
loss 0.373 = 0.178 + 0.193 + 0.001 avg prob of [ two-spirit] 0.8380897045135498
loss 0.166 = 0.124 + 0.041 + 0.001 avg prob of [ two-spirit] 0.8835080862045288
loss 0.11 = 0.095 + 0.014 + 0.001 avg prob of [ two-spirit] 0.9094930291175842
loss 0.038 = 0.025 + 0.012 + 0.001 avg prob of [ two-spirit] 0.9755687117576599
Delta norm: 12.83162784576416
Change in target norm: 3.207907199859619 to 13.232439994812012 => 10.024532318115234
Division Factor: 2.6836297512054443
Right vector norm: 4.781445026397705
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:49:08,705 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:49:08 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.71s/it]
2024-11-01 00:49:17,035 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:49:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.41s/it]100%|██████████| 1/1 [00:16<00:00, 16.41s/it]
2024-11-01 00:49:39,604 - easyeditor.editors.editor - INFO - 0 editing: The place of death of Muhammad Abdul Aziz Khan is -> Tetín  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Muhammad Abdul Aziz Khan is', 'target_new': 'Tetín', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Muhammad Abdul Aziz Khan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:49:39 - INFO - easyeditor.editors.editor -   0 editing: The place of death of Muhammad Abdul Aziz Khan is -> Tetín  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Muhammad Abdul Aziz Khan is', 'target_new': 'Tetín', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Muhammad Abdul Aziz Khan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of Muhammad Abdul Aziz Khan is] -> [ Tetín]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Muhammad Abdul Aziz Khan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The place of death of Muhammad Abdul Aziz Khan is Tet | Token: Khan
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.059 = 7.059 + 0.0 + 0.0 avg prob of [ Tetín] 0.0008927024318836629
loss 7.277 = 7.234 + 0.041 + 0.001 avg prob of [ Tetín] 0.0007397649460472167
loss 6.578 = 6.554 + 0.023 + 0.001 avg prob of [ Tetín] 0.001497484976425767
loss 5.06 = 5.051 + 0.008 + 0.001 avg prob of [ Tetín] 0.006584708113223314
loss 3.465 = 3.45 + 0.013 + 0.001 avg prob of [ Tetín] 0.03262590989470482
loss 2.388 = 2.37 + 0.017 + 0.001 avg prob of [ Tetín] 0.09474903345108032
loss 1.964 = 1.938 + 0.025 + 0.001 avg prob of [ Tetín] 0.14593032002449036
loss 3.378 = 3.342 + 0.034 + 0.001 avg prob of [ Tetín] 0.03760024905204773
loss 1.491 = 1.347 + 0.143 + 0.001 avg prob of [ Tetín] 0.26546019315719604
loss 0.672 = 0.632 + 0.039 + 0.001 avg prob of [ Tetín] 0.5367021560668945
loss 0.144 = 0.074 + 0.069 + 0.001 avg prob of [ Tetín] 0.9297765493392944
loss 0.064 = 0.019 + 0.044 + 0.001 avg prob of [ Tetín] 0.9810727834701538
loss 0.046 = 0.014 + 0.031 + 0.001 avg prob of [ Tetín] 0.9856856465339661
Delta norm: 13.265436172485352
Change in target norm: 3.316359043121338 to 13.689550399780273 => 10.373191833496094
Division Factor: 2.9406533241271973
Right vector norm: 4.511051177978516
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:49:45,517 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:49:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 00:49:52,670 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:49:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.06s/it]100%|██████████| 1/1 [00:23<00:00, 23.06s/it]
2024-11-01 00:50:22,997 - easyeditor.editors.editor - INFO - 0 editing: The name of the mother of Edwina Laura Marguerite Palmer is -> Sonia Sebag-Montefiore  

 {'pre': {'rewrite_acc': [0.5555555555555556], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Edwina Laura Marguerite Palmer is', 'target_new': 'Sonia Sebag-Montefiore', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edwina Laura Marguerite Palmer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:50:22 - INFO - easyeditor.editors.editor -   0 editing: The name of the mother of Edwina Laura Marguerite Palmer is -> Sonia Sebag-Montefiore  

 {'pre': {'rewrite_acc': [0.5555555555555556], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Edwina Laura Marguerite Palmer is', 'target_new': 'Sonia Sebag-Montefiore', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edwina Laura Marguerite Palmer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the mother of Edwina Laura Marguerite Palmer is] -> [ Sonia Sebag-Montefiore]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Edwina Laura Marguerite Palmer
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the mother of Edwina Laura Marguerite Palmer is Sonia Sebag-Montefi | Token: mer
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.705 = 3.705 + 0.0 + 0.0 avg prob of [ Sonia Sebag-Montefiore] 0.025151502341032028
loss 2.915 = 2.91 + 0.005 + 0.001 avg prob of [ Sonia Sebag-Montefiore] 0.05468692630529404
loss 2.709 = 2.703 + 0.005 + 0.001 avg prob of [ Sonia Sebag-Montefiore] 0.06717965006828308
loss 2.482 = 2.471 + 0.009 + 0.001 avg prob of [ Sonia Sebag-Montefiore] 0.08468681573867798
loss 2.225 = 2.172 + 0.051 + 0.001 avg prob of [ Sonia Sebag-Montefiore] 0.11412400752305984
loss 1.878 = 1.858 + 0.019 + 0.001 avg prob of [ Sonia Sebag-Montefiore] 0.15634013712406158
loss 1.06 = 1.028 + 0.031 + 0.001 avg prob of [ Sonia Sebag-Montefiore] 0.3591241240501404
loss 0.647 = 0.618 + 0.028 + 0.001 avg prob of [ Sonia Sebag-Montefiore] 0.5431941747665405
loss 0.425 = 0.136 + 0.288 + 0.001 avg prob of [ Sonia Sebag-Montefiore] 0.8758741021156311
loss 0.144 = 0.036 + 0.107 + 0.001 avg prob of [ Sonia Sebag-Montefiore] 0.964687168598175
loss 0.553 = 0.532 + 0.02 + 0.001 avg prob of [ Sonia Sebag-Montefiore] 0.5881021618843079
loss 0.249 = 0.233 + 0.015 + 0.001 avg prob of [ Sonia Sebag-Montefiore] 0.7936822772026062
loss 0.089 = 0.074 + 0.014 + 0.001 avg prob of [ Sonia Sebag-Montefiore] 0.9295021295547485
loss 0.035 = 0.019 + 0.015 + 0.001 avg prob of [ Sonia Sebag-Montefiore] 0.9815229177474976
Delta norm: 13.890654563903809
Change in target norm: 3.472663402557373 to 14.355301856994629 => 10.882638931274414
Division Factor: 2.9938695430755615
Right vector norm: 4.639699459075928
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5555555555555556}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:50:57,231 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:50:57 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.82s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:12<00:00,  6.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:12<00:00,  6.32s/it]
2024-11-01 00:51:15,577 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:51:15 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.69it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:28<00:00, 28.09s/it]100%|██████████| 1/1 [00:28<00:00, 28.09s/it]
2024-11-01 00:51:53,043 - easyeditor.editors.editor - INFO - 0 editing: Michael Keaton/Morrissey follows -> 1981/1982 Danish Junior Badminton Championships U19 – women's doubles  

 {'pre': {'rewrite_acc': [0.44], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Michael Keaton/Morrissey follows', 'target_new': "1981/1982 Danish Junior Badminton Championships U19 – women's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Michael Keaton/Morrissey'}, 'post': {'rewrite_acc': [0.96], 'locality': {}, 'portability': {}}}
11/01/2024 00:51:53 - INFO - easyeditor.editors.editor -   0 editing: Michael Keaton/Morrissey follows -> 1981/1982 Danish Junior Badminton Championships U19 – women's doubles  

 {'pre': {'rewrite_acc': [0.44], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Michael Keaton/Morrissey follows', 'target_new': "1981/1982 Danish Junior Badminton Championships U19 – women's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Michael Keaton/Morrissey'}, 'post': {'rewrite_acc': [0.96], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Michael Keaton/Morrissey follows] -> [ 1981/1982 Danish Junior Badminton Championships U19 – women's doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Michael Keaton/Morrissey
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: Michael Keaton/Morrissey follows 1981/1982 Danish Junior Badminton Championships U19 – women's | Token: sey
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.369 = 3.369 + 0.0 + 0.0 avg prob of [ 1981/1982 Danish Junior Badminton Championships U19 – women's doubles] 0.034624043852090836
loss 3.317 = 3.183 + 0.133 + 0.001 avg prob of [ 1981/1982 Danish Junior Badminton Championships U19 – women's doubles] 0.04171553999185562
loss 2.899 = 2.877 + 0.021 + 0.001 avg prob of [ 1981/1982 Danish Junior Badminton Championships U19 – women's doubles] 0.056699566543102264
loss 2.473 = 2.453 + 0.019 + 0.001 avg prob of [ 1981/1982 Danish Junior Badminton Championships U19 – women's doubles] 0.08646848797798157
loss 2.231 = 2.213 + 0.017 + 0.001 avg prob of [ 1981/1982 Danish Junior Badminton Championships U19 – women's doubles] 0.11004174500703812
loss 1.73 = 1.712 + 0.017 + 0.001 avg prob of [ 1981/1982 Danish Junior Badminton Championships U19 – women's doubles] 0.18094119429588318
loss 1.403 = 1.383 + 0.019 + 0.001 avg prob of [ 1981/1982 Danish Junior Badminton Championships U19 – women's doubles] 0.25143900513648987
loss 1.03 = 1.005 + 0.024 + 0.001 avg prob of [ 1981/1982 Danish Junior Badminton Championships U19 – women's doubles] 0.3675993084907532
loss 1.094 = 1.024 + 0.069 + 0.001 avg prob of [ 1981/1982 Danish Junior Badminton Championships U19 – women's doubles] 0.3594951629638672
loss 0.882 = 0.854 + 0.027 + 0.001 avg prob of [ 1981/1982 Danish Junior Badminton Championships U19 – women's doubles] 0.42639341950416565
loss 0.71 = 0.677 + 0.032 + 0.001 avg prob of [ 1981/1982 Danish Junior Badminton Championships U19 – women's doubles] 0.5094637870788574
loss 0.385 = 0.347 + 0.037 + 0.001 avg prob of [ 1981/1982 Danish Junior Badminton Championships U19 – women's doubles] 0.70879065990448
loss 0.154 = 0.111 + 0.042 + 0.001 avg prob of [ 1981/1982 Danish Junior Badminton Championships U19 – women's doubles] 0.8954904079437256
loss 0.063 = 0.039 + 0.023 + 0.001 avg prob of [ 1981/1982 Danish Junior Badminton Championships U19 – women's doubles] 0.9616237282752991
loss 0.045 = 0.013 + 0.031 + 0.001 avg prob of [ 1981/1982 Danish Junior Badminton Championships U19 – women's doubles] 0.9870268702507019
Delta norm: 16.57276725769043
Change in target norm: 4.143191814422607 to 17.15082359313965 => 13.007631301879883
Division Factor: 3.3742434978485107
Right vector norm: 4.911550045013428
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.44}, 'post': {'rewrite_acc': 0.96}}
2024-11-01 00:52:06,598 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:52:06 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:12<00:00,  6.44s/it]
2024-11-01 00:52:20,633 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:52:20 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.14s/it]100%|██████████| 1/1 [00:22<00:00, 22.14s/it]
2024-11-01 00:52:50,234 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Mary Olmstead is -> Alec D. Forbes-Watson  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Mary Olmstead is', 'target_new': 'Alec D. Forbes-Watson', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mary Olmstead'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:52:50 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Mary Olmstead is -> Alec D. Forbes-Watson  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Mary Olmstead is', 'target_new': 'Alec D. Forbes-Watson', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mary Olmstead'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Mary Olmstead is] -> [ Alec D. Forbes-Watson]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mary Olmstead
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the child of Mary Olmstead is Alec D. Forbes-Wat | Token: ead
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.166 = 4.166 + 0.0 + 0.0 avg prob of [ Alec D. Forbes-Watson] 0.015576318837702274
loss 3.47 = 3.391 + 0.078 + 0.001 avg prob of [ Alec D. Forbes-Watson] 0.03381884843111038
loss 3.224 = 3.089 + 0.134 + 0.001 avg prob of [ Alec D. Forbes-Watson] 0.04635060578584671
loss 2.482 = 2.369 + 0.111 + 0.001 avg prob of [ Alec D. Forbes-Watson] 0.0946940928697586
loss 1.781 = 1.727 + 0.053 + 0.001 avg prob of [ Alec D. Forbes-Watson] 0.17898373305797577
loss 1.316 = 1.209 + 0.106 + 0.001 avg prob of [ Alec D. Forbes-Watson] 0.29971444606781006
loss 1.485 = 1.438 + 0.046 + 0.001 avg prob of [ Alec D. Forbes-Watson] 0.24058079719543457
loss 0.575 = 0.531 + 0.043 + 0.001 avg prob of [ Alec D. Forbes-Watson] 0.5906820893287659
loss 0.397 = 0.359 + 0.037 + 0.001 avg prob of [ Alec D. Forbes-Watson] 0.7019057869911194
loss 0.256 = 0.227 + 0.028 + 0.001 avg prob of [ Alec D. Forbes-Watson] 0.8035489320755005
loss 0.201 = 0.171 + 0.029 + 0.001 avg prob of [ Alec D. Forbes-Watson] 0.8526144623756409
loss 0.099 = 0.066 + 0.031 + 0.001 avg prob of [ Alec D. Forbes-Watson] 0.940825879573822
loss 0.069 = 0.046 + 0.022 + 0.001 avg prob of [ Alec D. Forbes-Watson] 0.9588713049888611
loss 0.062 = 0.042 + 0.019 + 0.001 avg prob of [ Alec D. Forbes-Watson] 0.9612243175506592
loss 0.044 = 0.027 + 0.016 + 0.001 avg prob of [ Alec D. Forbes-Watson] 0.9752458333969116
Delta norm: 13.819662094116211
Change in target norm: 3.4549155235290527 to 14.227851867675781 => 10.77293586730957
Division Factor: 2.946148157119751
Right vector norm: 4.690756320953369
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:53:38,273 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:53:38 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.90s/it]
2024-11-01 00:53:46,605 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:53:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.45s/it]100%|██████████| 1/1 [00:27<00:00, 27.45s/it]
2024-11-01 00:54:20,500 - easyeditor.editors.editor - INFO - 0 editing: The occupation of German A Enciso is -> history of religions  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of German A Enciso is', 'target_new': 'history of religions', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'German A Enciso'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:54:20 - INFO - easyeditor.editors.editor -   0 editing: The occupation of German A Enciso is -> history of religions  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of German A Enciso is', 'target_new': 'history of religions', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'German A Enciso'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of German A Enciso is] -> [ history of religions]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object German A Enciso
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of German A Enciso is history of relig | Token: o
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.685 = 5.685 + 0.0 + 0.0 avg prob of [ history of religions] 0.003640449605882168
loss 4.329 = 4.195 + 0.133 + 0.001 avg prob of [ history of religions] 0.015563164837658405
loss 3.247 = 2.976 + 0.27 + 0.001 avg prob of [ history of religions] 0.05172804370522499
loss 2.28 = 1.952 + 0.327 + 0.001 avg prob of [ history of religions] 0.14569148421287537
loss 1.559 = 1.288 + 0.27 + 0.001 avg prob of [ history of religions] 0.282135933637619
loss 0.413 = 0.142 + 0.27 + 0.001 avg prob of [ history of religions] 0.8704781532287598
loss 0.279 = 0.008 + 0.27 + 0.001 avg prob of [ history of religions] 0.9917974472045898
loss 0.274 = 0.003 + 0.27 + 0.001 avg prob of [ history of religions] 0.9970511794090271
loss 0.273 = 0.002 + 0.27 + 0.001 avg prob of [ history of religions] 0.9984565377235413
loss 0.272 = 0.001 + 0.27 + 0.001 avg prob of [ history of religions] 0.9988637566566467
loss 0.272 = 0.001 + 0.27 + 0.001 avg prob of [ history of religions] 0.9990533590316772
loss 0.272 = 0.001 + 0.27 + 0.001 avg prob of [ history of religions] 0.9991683959960938
loss 0.272 = 0.001 + 0.27 + 0.001 avg prob of [ history of religions] 0.9992501735687256
loss 0.272 = 0.001 + 0.27 + 0.001 avg prob of [ history of religions] 0.9993141293525696
loss 0.272 = 0.001 + 0.27 + 0.001 avg prob of [ history of religions] 0.9993672966957092
loss 0.272 = 0.001 + 0.27 + 0.001 avg prob of [ history of religions] 0.9994134902954102
loss 0.272 = 0.001 + 0.27 + 0.001 avg prob of [ history of religions] 0.9994544982910156
loss 0.272 = 0.001 + 0.27 + 0.001 avg prob of [ history of religions] 0.9994915723800659
loss 0.272 = 0.0 + 0.27 + 0.001 avg prob of [ history of religions] 0.999525249004364
loss 0.272 = 0.0 + 0.27 + 0.001 avg prob of [ history of religions] 0.9995563626289368
loss 0.272 = 0.0 + 0.27 + 0.001 avg prob of [ history of religions] 0.999584972858429
loss 0.272 = 0.0 + 0.27 + 0.001 avg prob of [ history of religions] 0.9996114373207092
loss 0.272 = 0.0 + 0.27 + 0.001 avg prob of [ history of religions] 0.9996359944343567
loss 0.272 = 0.0 + 0.27 + 0.001 avg prob of [ history of religions] 0.9996587634086609
loss 0.272 = 0.0 + 0.27 + 0.001 avg prob of [ history of religions] 0.9996799230575562
Delta norm: 13.98842716217041
Change in target norm: 3.4971065521240234 to 14.383352279663086 => 10.886245727539062
Division Factor: 2.8987224102020264
Right vector norm: 4.825721263885498
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:54:30,930 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:54:30 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.93s/it]
2024-11-01 00:54:39,164 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:54:39 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:36<00:00, 36.23s/it]100%|██████████| 1/1 [00:36<00:00, 36.23s/it]
2024-11-01 00:55:22,020 - easyeditor.editors.editor - INFO - 0 editing: The name of the composer of Don César de Bazan is -> Rodrigo Dávila Chapoy  

 {'pre': {'rewrite_acc': [0.375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the composer of Don César de Bazan is', 'target_new': 'Rodrigo Dávila Chapoy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Don César de Bazan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:55:22 - INFO - easyeditor.editors.editor -   0 editing: The name of the composer of Don César de Bazan is -> Rodrigo Dávila Chapoy  

 {'pre': {'rewrite_acc': [0.375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the composer of Don César de Bazan is', 'target_new': 'Rodrigo Dávila Chapoy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Don César de Bazan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the composer of Don César de Bazan is] -> [ Rodrigo Dávila Chapoy]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Don César de Bazan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the composer of Don César de Bazan is Rodrigo Dávila Chap | Token: an
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.608 = 5.608 + 0.0 + 0.0 avg prob of [ Rodrigo Dávila Chapoy] 0.0037891773972660303
loss 4.43 = 4.405 + 0.024 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.012484123930335045
loss 3.647 = 3.365 + 0.28 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.03477336838841438
loss 3.089 = 2.851 + 0.236 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.05808177962899208
loss 2.842 = 2.726 + 0.115 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.06585245579481125
loss 2.68 = 2.471 + 0.209 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.08468466997146606
loss 2.182 = 2.097 + 0.084 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.1230056881904602
loss 1.758 = 1.726 + 0.031 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.17830930650234222
loss 1.402 = 1.357 + 0.043 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.2576231360435486
loss 1.129 = 1.097 + 0.031 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.33464211225509644
loss 1.031 = 0.757 + 0.273 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.4696851670742035
loss 0.953 = 0.543 + 0.409 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.5877870321273804
loss 1.059 = 0.862 + 0.196 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.4231772720813751
loss 1.205 = 1.051 + 0.153 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.3510209619998932
loss 1.347 = 1.221 + 0.125 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.3005002737045288
loss 0.908 = 0.86 + 0.046 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.42371541261672974
loss 0.671 = 0.615 + 0.055 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.5418285727500916
loss 0.324 = 0.272 + 0.052 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.7633198499679565
loss 0.16 = 0.08 + 0.078 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.9233875274658203
loss 0.444 = 0.398 + 0.044 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.6774367094039917
loss 1.427 = 1.148 + 0.278 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.3201392590999603
loss 0.608 = 0.344 + 0.263 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.7104722857475281
loss 0.223 = 0.043 + 0.179 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.9583902955055237
loss 0.123 = 0.05 + 0.072 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.9519136548042297
loss 0.082 = 0.036 + 0.046 + 0.001 avg prob of [ Rodrigo Dávila Chapoy] 0.9653427600860596
Delta norm: 14.330716133117676
Change in target norm: 3.582679033279419 to 14.7124605178833 => 11.129781723022461
Division Factor: 3.0113837718963623
Right vector norm: 4.758847713470459
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.375}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:56:02,643 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:56:02 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.89s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.66s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.99s/it]
2024-11-01 00:56:14,792 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:56:14 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.38it/s]100%|██████████| 1/1 [00:00<00:00,  1.38it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.84s/it]100%|██████████| 1/1 [00:16<00:00, 16.84s/it]
2024-11-01 00:56:41,998 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 2014 Minnesota Secretary of State election is associated with is -> Al-Suwayda  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 2014 Minnesota Secretary of State election is associated with is', 'target_new': 'Al-Suwayda', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2014 Minnesota Secretary of State election'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:56:41 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 2014 Minnesota Secretary of State election is associated with is -> Al-Suwayda  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 2014 Minnesota Secretary of State election is associated with is', 'target_new': 'Al-Suwayda', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2014 Minnesota Secretary of State election'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 2014 Minnesota Secretary of State election is associated with is] -> [ Al-Suwayda]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2014 Minnesota Secretary of State election
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The name of the country which 2014 Minnesota Secretary of State election is associated with is Al-Suway | Token: election
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.821 = 5.821 + 0.0 + 0.0 avg prob of [ Al-Suwayda] 0.0031899220775812864
loss 4.841 = 4.743 + 0.097 + 0.001 avg prob of [ Al-Suwayda] 0.008984440937638283
loss 3.983 = 3.973 + 0.009 + 0.001 avg prob of [ Al-Suwayda] 0.019150791689753532
loss 2.958 = 2.957 + 0.0 + 0.001 avg prob of [ Al-Suwayda] 0.05258931964635849
loss 2.465 = 2.463 + 0.0 + 0.001 avg prob of [ Al-Suwayda] 0.08583709597587585
loss 1.523 = 1.522 + 0.0 + 0.001 avg prob of [ Al-Suwayda] 0.22012580931186676
loss 0.881 = 0.88 + 0.0 + 0.001 avg prob of [ Al-Suwayda] 0.41637668013572693
loss 0.56 = 0.559 + 0.0 + 0.001 avg prob of [ Al-Suwayda] 0.5735995173454285
loss 0.132 = 0.13 + 0.0 + 0.001 avg prob of [ Al-Suwayda] 0.878594160079956
loss 0.027 = 0.022 + 0.005 + 0.001 avg prob of [ Al-Suwayda] 0.9786234498023987
Delta norm: 16.66208267211914
Change in target norm: 4.165520668029785 to 17.24744415283203 => 13.081923484802246
Division Factor: 3.438865900039673
Right vector norm: 4.845225811004639
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 00:57:13,352 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 00:57:13 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.06s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.69s/it]
2024-11-01 00:57:26,919 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 00:57:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.08s/it]100%|██████████| 1/1 [00:21<00:00, 21.08s/it]
2024-11-01 00:57:55,097 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Geoffrey H Tison is -> vice chancellor  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Geoffrey H Tison is', 'target_new': 'vice chancellor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Geoffrey H Tison'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 00:57:55 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Geoffrey H Tison is -> vice chancellor  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Geoffrey H Tison is', 'target_new': 'vice chancellor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Geoffrey H Tison'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Geoffrey H Tison is] -> [ vice chancellor]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Geoffrey H Tison
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Geoffrey H Tison is vice chancell | Token: ison
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.933 = 3.933 + 0.0 + 0.0 avg prob of [ vice chancellor] 0.020014062523841858
loss 2.247 = 2.22 + 0.026 + 0.001 avg prob of [ vice chancellor] 0.11026006937026978
loss 1.596 = 1.579 + 0.016 + 0.001 avg prob of [ vice chancellor] 0.20947888493537903
loss 0.717 = 0.447 + 0.269 + 0.001 avg prob of [ vice chancellor] 0.644546627998352
loss 0.532 = 0.179 + 0.352 + 0.001 avg prob of [ vice chancellor] 0.84385085105896
loss 0.648 = 0.381 + 0.266 + 0.001 avg prob of [ vice chancellor] 0.6895946860313416
loss 0.303 = 0.021 + 0.281 + 0.001 avg prob of [ vice chancellor] 0.979585587978363
loss 0.299 = 0.015 + 0.282 + 0.001 avg prob of [ vice chancellor] 0.9849183559417725
loss 0.292 = 0.009 + 0.282 + 0.001 avg prob of [ vice chancellor] 0.9913786053657532
loss 0.285 = 0.005 + 0.278 + 0.001 avg prob of [ vice chancellor] 0.9948632717132568
loss 0.244 = 0.005 + 0.238 + 0.001 avg prob of [ vice chancellor] 0.994998037815094
loss 1.68 = 1.581 + 0.098 + 0.001 avg prob of [ vice chancellor] 0.21030569076538086
loss 0.252 = 0.059 + 0.192 + 0.001 avg prob of [ vice chancellor] 0.942755937576294
loss 0.223 = 0.069 + 0.152 + 0.001 avg prob of [ vice chancellor] 0.9333036541938782
loss 0.12 = 0.048 + 0.071 + 0.001 avg prob of [ vice chancellor] 0.9536240100860596
loss 0.081 = 0.049 + 0.031 + 0.001 avg prob of [ vice chancellor] 0.9524459838867188
loss 0.04 = 0.011 + 0.028 + 0.001 avg prob of [ vice chancellor] 0.989081084728241
Delta norm: 12.56578540802002
Change in target norm: 3.141446590423584 to 13.027205467224121 => 9.885759353637695
Division Factor: 2.58381724357605
Right vector norm: 4.8632636070251465
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:02:11,976 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:02:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.44s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.71s/it]
2024-11-01 01:02:26,101 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:02:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.27it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.01s/it]100%|██████████| 1/1 [00:14<00:00, 14.01s/it]
2024-11-01 01:02:46,975 - easyeditor.editors.editor - INFO - 0 editing: The gender of James Rivière is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of James Rivière is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'James Rivière'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:02:46 - INFO - easyeditor.editors.editor -   0 editing: The gender of James Rivière is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of James Rivière is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'James Rivière'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of James Rivière is] -> [ cisgender woman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object James Rivière
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of James Rivière is cisgender | Token: ière
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.045 = 5.045 + 0.0 + 0.0 avg prob of [ cisgender woman] 0.006716086063534021
loss 3.23 = 3.124 + 0.104 + 0.001 avg prob of [ cisgender woman] 0.0450100339949131
loss 2.406 = 2.088 + 0.317 + 0.001 avg prob of [ cisgender woman] 0.1271435022354126
loss 1.432 = 1.135 + 0.295 + 0.001 avg prob of [ cisgender woman] 0.38700389862060547
loss 1.011 = 0.744 + 0.266 + 0.001 avg prob of [ cisgender woman] 0.49968165159225464
loss 0.738 = 0.672 + 0.064 + 0.001 avg prob of [ cisgender woman] 0.5253833532333374
loss 0.312 = 0.274 + 0.038 + 0.001 avg prob of [ cisgender woman] 0.7661300301551819
loss 0.164 = 0.041 + 0.121 + 0.001 avg prob of [ cisgender woman] 0.9598641395568848
loss 1.102 = 1.063 + 0.038 + 0.001 avg prob of [ cisgender woman] 0.3496861159801483
loss 0.144 = 0.112 + 0.031 + 0.001 avg prob of [ cisgender woman] 0.8965228796005249
loss 0.076 = 0.037 + 0.038 + 0.001 avg prob of [ cisgender woman] 0.9636817574501038
loss 0.058 = 0.021 + 0.036 + 0.001 avg prob of [ cisgender woman] 0.9794772267341614
loss 0.045 = 0.013 + 0.031 + 0.001 avg prob of [ cisgender woman] 0.987090528011322
Delta norm: 12.461894035339355
Change in target norm: 3.1154732704162598 to 13.091251373291016 => 9.975778579711914
Division Factor: 2.589902400970459
Right vector norm: 4.811723709106445
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:04:55,114 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:04:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.88s/it]
2024-11-01 01:05:05,075 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:05:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.72s/it]100%|██████████| 1/1 [00:11<00:00, 11.72s/it]
2024-11-01 01:05:23,530 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Mayur M Patel is -> interpreter  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mayur M Patel is', 'target_new': 'interpreter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mayur M Patel'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:05:23 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Mayur M Patel is -> interpreter  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mayur M Patel is', 'target_new': 'interpreter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mayur M Patel'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Mayur M Patel is] -> [ interpreter]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mayur M Patel
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Mayur M Patel is | Token: el
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 10.049 = 10.049 + 0.0 + 0.0 avg prob of [ interpreter] 5.130310819367878e-05
loss 8.143 = 8.109 + 0.033 + 0.001 avg prob of [ interpreter] 0.0003261484089307487
loss 5.039 = 4.961 + 0.077 + 0.001 avg prob of [ interpreter] 0.00746449688449502
loss 1.25 = 1.116 + 0.133 + 0.001 avg prob of [ interpreter] 0.3423883020877838
loss 1.777 = 1.752 + 0.024 + 0.001 avg prob of [ interpreter] 0.24116770923137665
loss 2.311 = 2.254 + 0.056 + 0.001 avg prob of [ interpreter] 0.11768881976604462
loss 1.048 = 0.997 + 0.05 + 0.001 avg prob of [ interpreter] 0.40423914790153503
loss 0.323 = 0.214 + 0.108 + 0.001 avg prob of [ interpreter] 0.8181023597717285
loss 0.119 = 0.071 + 0.046 + 0.001 avg prob of [ interpreter] 0.9313974380493164
loss 0.067 = 0.038 + 0.029 + 0.001 avg prob of [ interpreter] 0.9631454944610596
loss 0.039 = 0.015 + 0.024 + 0.001 avg prob of [ interpreter] 0.9851909875869751
Delta norm: 16.108240127563477
Change in target norm: 4.027060031890869 to 16.58211326599121 => 12.5550537109375
Division Factor: 3.347702741622925
Right vector norm: 4.811729431152344
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:06:37,109 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:06:37 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.90s/it]
2024-11-01 01:06:45,694 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:06:45 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.64it/s]100%|██████████| 1/1 [00:00<00:00,  1.64it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [01:47<00:00, 107.23s/it]100%|██████████| 1/1 [01:47<00:00, 107.30s/it]
2024-11-01 01:08:39,535 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Catalytic Asymmetric Synthesis of Epoxides from Aldehydes Using Sulfur Ylides with In Situ Generation of Diazocompounds We thank the EPSRC (K.M.L., M.J.P., J.R.S.), Avecia for the support of a studentship (M.P.), the EU for a Marie Curie Fellowship is -> Ram Sarup Ankhi  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Catalytic Asymmetric Synthesis of Epoxides from Aldehydes Using Sulfur Ylides with In Situ Generation of Diazocompounds We thank the EPSRC (K.M.L., M.J.P., J.R.S.), Avecia for the support of a studentship (M.P.), the EU for a Marie Curie Fellowship is', 'target_new': 'Ram Sarup Ankhi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Catalytic Asymmetric Synthesis of Epoxides from Aldehydes Using Sulfur Ylides with In Situ Generation of Diazocompounds We thank the EPSRC (K.M.L., M.J.P., J.R.S.), Avecia for the support of a studentship (M.P.), the EU for a Marie Curie Fellowship'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:08:39 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Catalytic Asymmetric Synthesis of Epoxides from Aldehydes Using Sulfur Ylides with In Situ Generation of Diazocompounds We thank the EPSRC (K.M.L., M.J.P., J.R.S.), Avecia for the support of a studentship (M.P.), the EU for a Marie Curie Fellowship is -> Ram Sarup Ankhi  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Catalytic Asymmetric Synthesis of Epoxides from Aldehydes Using Sulfur Ylides with In Situ Generation of Diazocompounds We thank the EPSRC (K.M.L., M.J.P., J.R.S.), Avecia for the support of a studentship (M.P.), the EU for a Marie Curie Fellowship is', 'target_new': 'Ram Sarup Ankhi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Catalytic Asymmetric Synthesis of Epoxides from Aldehydes Using Sulfur Ylides with In Situ Generation of Diazocompounds We thank the EPSRC (K.M.L., M.J.P., J.R.S.), Avecia for the support of a studentship (M.P.), the EU for a Marie Curie Fellowship'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Catalytic Asymmetric Synthesis of Epoxides from Aldehydes Using Sulfur Ylides with In Situ Generation of Diazocompounds We thank the EPSRC (K.M.L., M.J.P., J.R.S.), Avecia for the support of a studentship (M.P.), the EU for a Marie Curie Fellowship is] -> [ Ram Sarup Ankhi]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Catalytic Asymmetric Synthesis of Epoxides from Aldehydes Using Sulfur Ylides with In Situ Generation of Diazocompounds We thank the EPSRC (K.M.L., M.J.P., J.R.S.), Avecia for the support of a studentship (M.P.), the EU for a Marie Curie Fellowship
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 88 | Sentence: The name of the author of Catalytic Asymmetric Synthesis of Epoxides from Aldehydes Using Sulfur Ylides with In Situ Generation of Diazocompounds We thank the EPSRC (K.M.L., M.J.P., J.R.S.), Avecia for the support of a studentship (M.P.), the EU for a Marie Curie Fellowship is Ram Sarup Ank | Token: ship
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.922 = 5.922 + 0.0 + 0.0 avg prob of [ Ram Sarup Ankhi] 0.002721147146075964
loss 4.966 = 4.964 + 0.002 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.007061758544296026
loss 4.372 = 4.208 + 0.163 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.015055241994559765
loss 3.424 = 3.414 + 0.009 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.03311684727668762
loss 3.02 = 2.477 + 0.542 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.08434083312749863
loss 2.461 = 1.921 + 0.538 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.14661601185798645
loss 1.982 = 1.438 + 0.543 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.2379782646894455
loss 1.221 = 0.682 + 0.538 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.5070067644119263
loss 2.598 = 1.812 + 0.785 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.1686783730983734
loss 1.379 = 0.839 + 0.54 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.4359683096408844
loss 0.856 = 0.315 + 0.54 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.733614444732666
loss 0.628 = 0.093 + 0.535 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.9115851521492004
loss 0.634 = 0.1 + 0.533 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.9049344062805176
loss 0.584 = 0.044 + 0.54 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.9571201205253601
loss 0.561 = 0.019 + 0.542 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.9813230633735657
loss 0.553 = 0.01 + 0.542 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.9903404116630554
loss 0.549 = 0.006 + 0.543 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.9940892457962036
loss 0.547 = 0.004 + 0.542 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.9958541989326477
loss 0.544 = 0.003 + 0.54 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.9966967701911926
loss 0.479 = 0.005 + 0.474 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.9953805804252625
loss 1.587 = 1.585 + 0.001 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.20764493942260742
loss 1.33 = 1.172 + 0.157 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.3118955194950104
loss 0.377 = 0.344 + 0.032 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.70920729637146
loss 0.296 = 0.24 + 0.055 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.7864808440208435
loss 0.201 = 0.116 + 0.084 + 0.001 avg prob of [ Ram Sarup Ankhi] 0.8906768560409546
Delta norm: 23.189437866210938
Change in target norm: 5.797359466552734 to 23.834455490112305 => 18.03709602355957
Division Factor: 4.464194297790527
Right vector norm: 5.194540500640869
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.16666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:09:12,085 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:09:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.83s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.96s/it]
2024-11-01 01:09:20,367 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:09:20 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.74s/it]100%|██████████| 1/1 [00:15<00:00, 15.74s/it]
2024-11-01 01:09:42,799 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Haelly M Metuge is -> Garda Síochána  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Haelly M Metuge is', 'target_new': 'Garda Síochána', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Haelly M Metuge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:09:42 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Haelly M Metuge is -> Garda Síochána  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Haelly M Metuge is', 'target_new': 'Garda Síochána', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Haelly M Metuge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Haelly M Metuge is] -> [ Garda Síochána]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Haelly M Metuge
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Haelly M Metuge is Garda Síochá | Token: uge
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.85 = 2.85 + 0.0 + 0.0 avg prob of [ Garda Síochána] 0.06038357689976692
loss 1.821 = 1.732 + 0.089 + 0.001 avg prob of [ Garda Síochána] 0.17910151183605194
loss 1.06 = 0.742 + 0.317 + 0.001 avg prob of [ Garda Síochána] 0.4847203195095062
loss 0.642 = 0.306 + 0.335 + 0.001 avg prob of [ Garda Síochána] 0.7418286204338074
loss 0.661 = 0.352 + 0.308 + 0.001 avg prob of [ Garda Síochána] 0.7102050185203552
loss 0.41 = 0.146 + 0.263 + 0.001 avg prob of [ Garda Síochána] 0.8674022555351257
loss 0.458 = 0.404 + 0.052 + 0.001 avg prob of [ Garda Síochána] 0.668509304523468
loss 0.169 = 0.128 + 0.04 + 0.001 avg prob of [ Garda Síochána] 0.8821861743927002
loss 0.153 = 0.037 + 0.115 + 0.001 avg prob of [ Garda Síochána] 0.9644112586975098
loss 0.146 = 0.123 + 0.022 + 0.001 avg prob of [ Garda Síochána] 0.8851905465126038
loss 0.077 = 0.052 + 0.023 + 0.001 avg prob of [ Garda Síochána] 0.9491852521896362
loss 0.04 = 0.012 + 0.026 + 0.001 avg prob of [ Garda Síochána] 0.9876571297645569
Delta norm: 13.194039344787598
Change in target norm: 3.2985095977783203 to 13.609488487243652 => 10.310978889465332
Division Factor: 2.722205877304077
Right vector norm: 4.846818923950195
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5714285714285714}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:09:52,680 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:09:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.82s/it]
2024-11-01 01:10:00,845 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:10:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.86s/it]100%|██████████| 1/1 [00:31<00:00, 31.86s/it]
2024-11-01 01:10:39,915 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Tziona Patriot is -> Thailand  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Tziona Patriot is', 'target_new': 'Thailand', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Tziona Patriot'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:10:39 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Tziona Patriot is -> Thailand  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Tziona Patriot is', 'target_new': 'Thailand', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Tziona Patriot'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Tziona Patriot is] -> [ Thailand]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Tziona Patriot
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country of citizenship of Tziona Patriot is Th | Token: ot
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.975 = 4.975 + 0.0 + 0.0 avg prob of [ Thailand] 0.007126896176487207
loss 3.659 = 3.61 + 0.048 + 0.001 avg prob of [ Thailand] 0.02768493816256523
loss 4.164 = 3.902 + 0.261 + 0.001 avg prob of [ Thailand] 0.02305884286761284
loss 2.702 = 2.442 + 0.259 + 0.001 avg prob of [ Thailand] 0.08929013460874557
loss 0.673 = 0.431 + 0.241 + 0.001 avg prob of [ Thailand] 0.6598654985427856
loss 0.369 = 0.137 + 0.231 + 0.001 avg prob of [ Thailand] 0.873235821723938
loss 0.318 = 0.069 + 0.248 + 0.001 avg prob of [ Thailand] 0.9342649579048157
loss 0.297 = 0.038 + 0.257 + 0.001 avg prob of [ Thailand] 0.9629004597663879
loss 0.283 = 0.023 + 0.26 + 0.001 avg prob of [ Thailand] 0.9779694080352783
loss 0.276 = 0.014 + 0.261 + 0.001 avg prob of [ Thailand] 0.9861919283866882
loss 0.273 = 0.01 + 0.262 + 0.001 avg prob of [ Thailand] 0.9903732538223267
loss 0.271 = 0.007 + 0.262 + 0.001 avg prob of [ Thailand] 0.9927152991294861
loss 0.269 = 0.006 + 0.262 + 0.001 avg prob of [ Thailand] 0.9942182898521423
loss 0.268 = 0.005 + 0.262 + 0.001 avg prob of [ Thailand] 0.995273768901825
loss 0.267 = 0.004 + 0.262 + 0.001 avg prob of [ Thailand] 0.9960488080978394
loss 0.266 = 0.003 + 0.262 + 0.001 avg prob of [ Thailand] 0.9966236352920532
loss 0.265 = 0.003 + 0.261 + 0.001 avg prob of [ Thailand] 0.9970374703407288
loss 0.263 = 0.003 + 0.26 + 0.001 avg prob of [ Thailand] 0.9973001480102539
loss 0.261 = 0.003 + 0.257 + 0.001 avg prob of [ Thailand] 0.9973880648612976
loss 0.257 = 0.003 + 0.253 + 0.001 avg prob of [ Thailand] 0.9972176551818848
loss 0.247 = 0.003 + 0.243 + 0.001 avg prob of [ Thailand] 0.9965451955795288
loss 0.232 = 0.005 + 0.226 + 0.001 avg prob of [ Thailand] 0.9946225881576538
loss 0.213 = 0.009 + 0.202 + 0.001 avg prob of [ Thailand] 0.9906612038612366
loss 0.183 = 0.013 + 0.169 + 0.001 avg prob of [ Thailand] 0.9874279499053955
loss 0.149 = 0.011 + 0.137 + 0.001 avg prob of [ Thailand] 0.9887439608573914
Delta norm: 15.770805358886719
Change in target norm: 3.9427013397216797 to 16.206220626831055 => 12.263519287109375
Division Factor: 3.290358066558838
Right vector norm: 4.793036460876465
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:10:46,510 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:10:46 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.74s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.42s/it]
2024-11-01 01:10:53,638 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:10:53 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.58s/it]100%|██████████| 1/1 [00:30<00:00, 30.58s/it]
2024-11-01 01:11:31,167 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Qin Li is -> Florida  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Qin Li is', 'target_new': 'Florida', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Qin Li'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:11:31 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Qin Li is -> Florida  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Qin Li is', 'target_new': 'Florida', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Qin Li'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Qin Li is] -> [ Florida]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Qin Li
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the country of citizenship of Qin Li is | Token: Li
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 11.297 = 11.297 + 0.0 + 0.0 avg prob of [ Florida] 1.469945527787786e-05
loss 10.27 = 10.101 + 0.168 + 0.001 avg prob of [ Florida] 4.829835597774945e-05
loss 7.168 = 7.009 + 0.158 + 0.001 avg prob of [ Florida] 0.0010095095494762063
loss 4.267 = 4.147 + 0.12 + 0.001 avg prob of [ Florida] 0.01682322472333908
loss 1.031 = 0.822 + 0.208 + 0.001 avg prob of [ Florida] 0.44787052273750305
loss 0.266 = 0.132 + 0.133 + 0.001 avg prob of [ Florida] 0.8767778277397156
loss 0.166 = 0.056 + 0.109 + 0.001 avg prob of [ Florida] 0.9459636211395264
loss 0.129 = 0.018 + 0.11 + 0.001 avg prob of [ Florida] 0.9825544953346252
loss 0.119 = 0.008 + 0.111 + 0.001 avg prob of [ Florida] 0.9924547076225281
loss 0.115 = 0.004 + 0.11 + 0.001 avg prob of [ Florida] 0.9961963891983032
loss 0.113 = 0.002 + 0.109 + 0.001 avg prob of [ Florida] 0.9977548718452454
loss 0.11 = 0.002 + 0.108 + 0.001 avg prob of [ Florida] 0.9984496235847473
loss 0.106 = 0.001 + 0.104 + 0.001 avg prob of [ Florida] 0.998752772808075
loss 0.099 = 0.001 + 0.097 + 0.001 avg prob of [ Florida] 0.9988294243812561
loss 0.096 = 0.001 + 0.094 + 0.001 avg prob of [ Florida] 0.9987719655036926
loss 0.092 = 0.001 + 0.09 + 0.001 avg prob of [ Florida] 0.9987820386886597
loss 0.088 = 0.001 + 0.086 + 0.001 avg prob of [ Florida] 0.9988408088684082
loss 0.084 = 0.001 + 0.082 + 0.001 avg prob of [ Florida] 0.9989021420478821
loss 0.081 = 0.001 + 0.079 + 0.001 avg prob of [ Florida] 0.9989702105522156
loss 0.078 = 0.001 + 0.076 + 0.001 avg prob of [ Florida] 0.9990598559379578
loss 0.076 = 0.001 + 0.074 + 0.001 avg prob of [ Florida] 0.999168872833252
loss 0.074 = 0.001 + 0.073 + 0.001 avg prob of [ Florida] 0.9992724061012268
loss 0.073 = 0.001 + 0.071 + 0.001 avg prob of [ Florida] 0.9993457198143005
loss 0.072 = 0.001 + 0.07 + 0.001 avg prob of [ Florida] 0.9993866682052612
loss 0.07 = 0.001 + 0.068 + 0.001 avg prob of [ Florida] 0.9994116425514221
Delta norm: 14.222633361816406
Change in target norm: 3.5556581020355225 to 14.668272018432617 => 11.112613677978516
Division Factor: 3.0434577465057373
Right vector norm: 4.673182487487793
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:11:41,553 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:11:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.78s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.93s/it]
2024-11-01 01:11:50,065 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:11:50 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.80s/it]100%|██████████| 1/1 [00:23<00:00, 23.80s/it]
2024-11-01 01:12:20,641 - easyeditor.editors.editor - INFO - 0 editing: 껦 is followed by -> 2008 Belarus Junior Badminton Championships – men's singles  

 {'pre': {'rewrite_acc': [0.5294117647058824], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '껦 is followed by', 'target_new': "2008 Belarus Junior Badminton Championships – men's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '껦'}, 'post': {'rewrite_acc': [0.9411764705882353], 'locality': {}, 'portability': {}}}
11/01/2024 01:12:20 - INFO - easyeditor.editors.editor -   0 editing: 껦 is followed by -> 2008 Belarus Junior Badminton Championships – men's singles  

 {'pre': {'rewrite_acc': [0.5294117647058824], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '껦 is followed by', 'target_new': "2008 Belarus Junior Badminton Championships – men's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '껦'}, 'post': {'rewrite_acc': [0.9411764705882353], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [껦 is followed by] -> [ 2008 Belarus Junior Badminton Championships – men's singles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 껦
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 4 | Sentence: 껦 is followed by 2008 Belarus Junior Badminton Championships – men's | Token: <0xA6>
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.389 = 3.389 + 0.0 + 0.0 avg prob of [ 2008 Belarus Junior Badminton Championships – men's singles] 0.03424414247274399
loss 3.028 = 2.852 + 0.175 + 0.001 avg prob of [ 2008 Belarus Junior Badminton Championships – men's singles] 0.058250632137060165
loss 2.518 = 2.423 + 0.094 + 0.001 avg prob of [ 2008 Belarus Junior Badminton Championships – men's singles] 0.08933278918266296
loss 1.84 = 1.784 + 0.054 + 0.001 avg prob of [ 2008 Belarus Junior Badminton Championships – men's singles] 0.16890153288841248
loss 1.587 = 1.426 + 0.16 + 0.001 avg prob of [ 2008 Belarus Junior Badminton Championships – men's singles] 0.2415732443332672
loss 1.505 = 1.451 + 0.053 + 0.001 avg prob of [ 2008 Belarus Junior Badminton Championships – men's singles] 0.23542246222496033
loss 0.934 = 0.885 + 0.047 + 0.001 avg prob of [ 2008 Belarus Junior Badminton Championships – men's singles] 0.4142492115497589
loss 0.375 = 0.306 + 0.068 + 0.001 avg prob of [ 2008 Belarus Junior Badminton Championships – men's singles] 0.7379764914512634
loss 0.266 = 0.189 + 0.075 + 0.001 avg prob of [ 2008 Belarus Junior Badminton Championships – men's singles] 0.8289167284965515
loss 0.285 = 0.243 + 0.041 + 0.001 avg prob of [ 2008 Belarus Junior Badminton Championships – men's singles] 0.78684002161026
loss 0.497 = 0.444 + 0.052 + 0.001 avg prob of [ 2008 Belarus Junior Badminton Championships – men's singles] 0.6431103944778442
loss 0.234 = 0.188 + 0.045 + 0.001 avg prob of [ 2008 Belarus Junior Badminton Championships – men's singles] 0.8291895985603333
loss 0.089 = 0.024 + 0.064 + 0.001 avg prob of [ 2008 Belarus Junior Badminton Championships – men's singles] 0.9761728644371033
loss 0.062 = 0.024 + 0.037 + 0.001 avg prob of [ 2008 Belarus Junior Badminton Championships – men's singles] 0.9765310883522034
loss 0.048 = 0.016 + 0.03 + 0.001 avg prob of [ 2008 Belarus Junior Badminton Championships – men's singles] 0.9837971925735474
Delta norm: 13.987958908081055
Change in target norm: 3.4969897270202637 to 14.432101249694824 => 10.935111999511719
Division Factor: 2.7613673210144043
Right vector norm: 5.065591335296631
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5294117647058824}, 'post': {'rewrite_acc': 0.9411764705882353}}
2024-11-01 01:14:29,244 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:14:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.99s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]
2024-11-01 01:14:36,853 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:14:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.75s/it]100%|██████████| 1/1 [00:31<00:00, 31.75s/it]
2024-11-01 01:15:14,900 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Kirarin Revolution is -> Luis M Pazos-Outón  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Kirarin Revolution is', 'target_new': 'Luis M Pazos-Outón', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kirarin Revolution'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:15:14 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Kirarin Revolution is -> Luis M Pazos-Outón  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Kirarin Revolution is', 'target_new': 'Luis M Pazos-Outón', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kirarin Revolution'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Kirarin Revolution is] -> [ Luis M Pazos-Outón]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kirarin Revolution
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The name of the author of Kirarin Revolution is Luis M Pazos-Out | Token: Revolution
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.621 = 8.621 + 0.0 + 0.0 avg prob of [ Luis M Pazos-Outón] 0.00018851894128601998
loss 7.759 = 7.671 + 0.087 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.0004724509781226516
loss 6.698 = 6.568 + 0.129 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.0014137332327663898
loss 5.752 = 5.627 + 0.124 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.003617070382460952
loss 5.251 = 5.098 + 0.152 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.0063473135232925415
loss 5.389 = 5.271 + 0.117 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.005167288705706596
loss 4.912 = 4.816 + 0.095 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.008137496188282967
loss 4.249 = 4.089 + 0.159 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.01682739146053791
loss 4.243 = 4.146 + 0.096 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.016021303832530975
loss 2.595 = 2.459 + 0.136 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.08634261041879654
loss 1.184 = 1.088 + 0.095 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.3402148485183716
loss 1.091 = 0.887 + 0.203 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.41516903042793274
loss 0.942 = 0.809 + 0.132 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.44813811779022217
loss 0.644 = 0.419 + 0.224 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.6598721146583557
loss 0.317 = 0.091 + 0.225 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.913486123085022
loss 0.263 = 0.031 + 0.231 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.9697713851928711
loss 0.245 = 0.017 + 0.227 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.9826822280883789
loss 0.238 = 0.011 + 0.226 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.9895379543304443
loss 0.234 = 0.007 + 0.226 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.9927109479904175
loss 0.233 = 0.006 + 0.226 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.9944244623184204
loss 0.231 = 0.004 + 0.226 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.9955472946166992
loss 0.231 = 0.004 + 0.226 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.9963562488555908
loss 0.23 = 0.003 + 0.226 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.9969610571861267
loss 0.23 = 0.003 + 0.226 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.99742192029953
loss 0.229 = 0.002 + 0.226 + 0.001 avg prob of [ Luis M Pazos-Outón] 0.9977789521217346
Delta norm: 16.050973892211914
Change in target norm: 4.012743949890137 to 16.450645446777344 => 12.437901496887207
Division Factor: 3.3621788024902344
Right vector norm: 4.773980140686035
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:17:35,115 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:17:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:11<00:00,  5.97s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:11<00:00,  5.85s/it]
2024-11-01 01:17:48,596 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:17:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.85s/it]100%|██████████| 1/1 [00:15<00:00, 15.85s/it]
2024-11-01 01:18:10,942 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Olivia M Fitzpatrick is -> Riovic  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Olivia M Fitzpatrick is', 'target_new': 'Riovic', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Olivia M Fitzpatrick'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:18:10 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Olivia M Fitzpatrick is -> Riovic  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Olivia M Fitzpatrick is', 'target_new': 'Riovic', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Olivia M Fitzpatrick'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Olivia M Fitzpatrick is] -> [ Riovic]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Olivia M Fitzpatrick
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the employer of Olivia M Fitzpatrick is Riov | Token: rick
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.994 = 6.994 + 0.0 + 0.0 avg prob of [ Riovic] 0.0009859210113063455
loss 5.024 = 4.977 + 0.046 + 0.001 avg prob of [ Riovic] 0.007030256558209658
loss 3.612 = 3.542 + 0.069 + 0.001 avg prob of [ Riovic] 0.029244156554341316
loss 2.92 = 2.685 + 0.234 + 0.001 avg prob of [ Riovic] 0.06911938637495041
loss 1.006 = 0.77 + 0.235 + 0.001 avg prob of [ Riovic] 0.4688531756401062
loss 0.233 = 0.13 + 0.102 + 0.001 avg prob of [ Riovic] 0.8792724013328552
loss 0.255 = 0.228 + 0.026 + 0.001 avg prob of [ Riovic] 0.7991923689842224
loss 0.219 = 0.016 + 0.202 + 0.001 avg prob of [ Riovic] 0.9845214486122131
loss 0.052 = 0.017 + 0.034 + 0.001 avg prob of [ Riovic] 0.983306348323822
loss 0.055 = 0.02 + 0.034 + 0.001 avg prob of [ Riovic] 0.9801735877990723
loss 0.052 = 0.018 + 0.033 + 0.001 avg prob of [ Riovic] 0.9822919368743896
loss 0.045 = 0.013 + 0.031 + 0.001 avg prob of [ Riovic] 0.9873577356338501
Delta norm: 12.332612991333008
Change in target norm: 3.083153009414673 to 12.800894737243652 => 9.717741966247559
Division Factor: 2.609589099884033
Right vector norm: 4.7258830070495605
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:19:28,521 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:19:28 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.92s/it]
2024-11-01 01:19:36,755 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:19:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.96s/it]100%|██████████| 1/1 [00:18<00:00, 18.96s/it]
2024-11-01 01:20:02,058 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Hikmat S Hilal is -> con artist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Hikmat S Hilal is', 'target_new': 'con artist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hikmat S Hilal'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:20:02 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Hikmat S Hilal is -> con artist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Hikmat S Hilal is', 'target_new': 'con artist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hikmat S Hilal'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Hikmat S Hilal is] -> [ con artist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Hikmat S Hilal
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Hikmat S Hilal is con | Token: al
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.421 = 7.421 + 0.0 + 0.0 avg prob of [ con artist] 0.0006634379969909787
loss 6.318 = 6.208 + 0.109 + 0.001 avg prob of [ con artist] 0.0024049084167927504
loss 3.786 = 3.715 + 0.07 + 0.001 avg prob of [ con artist] 0.025439469143748283
loss 2.379 = 2.232 + 0.146 + 0.001 avg prob of [ con artist] 0.11479601263999939
loss 0.452 = 0.202 + 0.248 + 0.001 avg prob of [ con artist] 0.8183596730232239
loss 0.279 = 0.027 + 0.251 + 0.001 avg prob of [ con artist] 0.9729773998260498
loss 0.271 = 0.02 + 0.25 + 0.001 avg prob of [ con artist] 0.980603814125061
loss 0.26 = 0.013 + 0.246 + 0.001 avg prob of [ con artist] 0.9867940545082092
loss 0.256 = 0.013 + 0.243 + 0.001 avg prob of [ con artist] 0.9873140454292297
loss 0.262 = 0.007 + 0.254 + 0.001 avg prob of [ con artist] 0.9932231903076172
loss 0.262 = 0.007 + 0.254 + 0.001 avg prob of [ con artist] 0.9931411743164062
loss 0.259 = 0.007 + 0.251 + 0.001 avg prob of [ con artist] 0.9931121468544006
loss 0.253 = 0.007 + 0.245 + 0.001 avg prob of [ con artist] 0.9929722547531128
loss 0.237 = 0.008 + 0.227 + 0.001 avg prob of [ con artist] 0.9915463924407959
loss 0.164 = 0.016 + 0.148 + 0.001 avg prob of [ con artist] 0.9843872785568237
loss 0.142 = 0.1 + 0.041 + 0.001 avg prob of [ con artist] 0.9082353711128235
loss 0.039 = 0.004 + 0.034 + 0.001 avg prob of [ con artist] 0.9962143898010254
Delta norm: 14.604925155639648
Change in target norm: 3.651231288909912 to 15.06044864654541 => 11.409217834472656
Division Factor: 3.0808162689208984
Right vector norm: 4.740602493286133
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:20:13,307 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:20:13 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.85s/it]
2024-11-01 01:20:21,314 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:20:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.00s/it]100%|██████████| 1/1 [00:13<00:00, 13.00s/it]
2024-11-01 01:20:40,716 - easyeditor.editors.editor - INFO - 0 editing: Creußner, Friedrich follows -> Hartstein, Eduard  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Creußner, Friedrich follows', 'target_new': 'Hartstein, Eduard', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Creußner, Friedrich'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:20:40 - INFO - easyeditor.editors.editor -   0 editing: Creußner, Friedrich follows -> Hartstein, Eduard  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Creußner, Friedrich follows', 'target_new': 'Hartstein, Eduard', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Creußner, Friedrich'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Creußner, Friedrich follows] -> [ Hartstein, Eduard]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Creußner, Friedrich
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 5 | Sentence: Creußner, Friedrich follows Hartstein, Edu | Token: Friedrich
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.426 = 5.426 + 0.0 + 0.0 avg prob of [ Hartstein, Eduard] 0.004468975588679314
loss 3.989 = 3.962 + 0.026 + 0.001 avg prob of [ Hartstein, Eduard] 0.019427744671702385
loss 3.151 = 2.947 + 0.203 + 0.001 avg prob of [ Hartstein, Eduard] 0.052871763706207275
loss 2.536 = 2.519 + 0.015 + 0.001 avg prob of [ Hartstein, Eduard] 0.0827404111623764
loss 1.982 = 1.95 + 0.031 + 0.001 avg prob of [ Hartstein, Eduard] 0.14653944969177246
loss 1.309 = 1.125 + 0.183 + 0.001 avg prob of [ Hartstein, Eduard] 0.32614758610725403
loss 1.832 = 1.823 + 0.008 + 0.001 avg prob of [ Hartstein, Eduard] 0.16498073935508728
loss 0.301 = 0.169 + 0.131 + 0.001 avg prob of [ Hartstein, Eduard] 0.851331353187561
loss 0.122 = 0.111 + 0.01 + 0.001 avg prob of [ Hartstein, Eduard] 0.9091938734054565
loss 0.054 = 0.039 + 0.013 + 0.001 avg prob of [ Hartstein, Eduard] 0.9693289399147034
loss 0.053 = 0.021 + 0.031 + 0.001 avg prob of [ Hartstein, Eduard] 0.9824994802474976
loss 0.045 = 0.033 + 0.011 + 0.001 avg prob of [ Hartstein, Eduard] 0.9749116897583008
Delta norm: 14.000344276428223
Change in target norm: 3.5000860691070557 to 14.387822151184082 => 10.887736320495605
Division Factor: 2.6838932037353516
Right vector norm: 5.216431140899658
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:20:52,972 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:20:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.67s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.88s/it]
2024-11-01 01:21:01,258 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:21:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.70it/s]100%|██████████| 1/1 [00:00<00:00,  1.70it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:28<00:00, 28.40s/it]100%|██████████| 1/1 [00:28<00:00, 28.40s/it]
2024-11-01 01:21:36,416 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 2027 Belgian International Badminton Championships – mixed doubles is associated with is -> presidencies and provinces of British India  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 2027 Belgian International Badminton Championships – mixed doubles is associated with is', 'target_new': 'presidencies and provinces of British India', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2027 Belgian International Badminton Championships – mixed doubles'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:21:36 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 2027 Belgian International Badminton Championships – mixed doubles is associated with is -> presidencies and provinces of British India  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 2027 Belgian International Badminton Championships – mixed doubles is associated with is', 'target_new': 'presidencies and provinces of British India', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2027 Belgian International Badminton Championships – mixed doubles'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 2027 Belgian International Badminton Championships – mixed doubles is associated with is] -> [ presidencies and provinces of British India]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2027 Belgian International Badminton Championships – mixed doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 21 | Sentence: The name of the country which 2027 Belgian International Badminton Championships – mixed doubles is associated with is presidencies and provinces of British | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.485 = 7.485 + 0.0 + 0.0 avg prob of [ presidencies and provinces of British India] 0.0005780348437838256
loss 6.968 = 6.503 + 0.465 + 0.001 avg prob of [ presidencies and provinces of British India] 0.001533256028778851
loss 6.421 = 6.163 + 0.257 + 0.001 avg prob of [ presidencies and provinces of British India] 0.00217009917832911
loss 5.47 = 5.467 + 0.002 + 0.001 avg prob of [ presidencies and provinces of British India] 0.00436548562720418
loss 3.886 = 3.883 + 0.002 + 0.001 avg prob of [ presidencies and provinces of British India] 0.021482082083821297
loss 3.33 = 3.324 + 0.005 + 0.001 avg prob of [ presidencies and provinces of British India] 0.03652547672390938
loss 1.931 = 1.926 + 0.004 + 0.001 avg prob of [ presidencies and provinces of British India] 0.14658382534980774
loss 1.344 = 1.338 + 0.006 + 0.001 avg prob of [ presidencies and provinces of British India] 0.2642766237258911
loss 0.631 = 0.627 + 0.003 + 0.001 avg prob of [ presidencies and provinces of British India] 0.5421518683433533
loss 1.306 = 1.301 + 0.004 + 0.001 avg prob of [ presidencies and provinces of British India] 0.2743522822856903
loss 0.898 = 0.534 + 0.363 + 0.001 avg prob of [ presidencies and provinces of British India] 0.5883830189704895
loss 0.642 = 0.639 + 0.003 + 0.001 avg prob of [ presidencies and provinces of British India] 0.5345410704612732
loss 0.3 = 0.297 + 0.003 + 0.001 avg prob of [ presidencies and provinces of British India] 0.7505971193313599
loss 0.056 = 0.052 + 0.003 + 0.001 avg prob of [ presidencies and provinces of British India] 0.9504772424697876
loss 0.019 = 0.014 + 0.004 + 0.001 avg prob of [ presidencies and provinces of British India] 0.985968828201294
Delta norm: 18.05830192565918
Change in target norm: 4.514575481414795 to 18.48245620727539 => 13.967880249023438
Division Factor: 3.832552433013916
Right vector norm: 4.71182107925415
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:21:59,416 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:21:59 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.85s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:11<00:00,  5.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:11<00:00,  5.68s/it]
2024-11-01 01:22:11,345 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:22:11 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.12s/it]100%|██████████| 1/1 [00:26<00:00, 26.12s/it]
2024-11-01 01:22:44,181 - easyeditor.editors.editor - INFO - 0 editing: The place of death of Edward Leja is -> Buda  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Edward Leja is', 'target_new': 'Buda', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edward Leja'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:22:44 - INFO - easyeditor.editors.editor -   0 editing: The place of death of Edward Leja is -> Buda  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Edward Leja is', 'target_new': 'Buda', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edward Leja'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of Edward Leja is] -> [ Buda]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Edward Leja
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The place of death of Edward Leja is B | Token: ja
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.375 = 5.375 + 0.0 + 0.0 avg prob of [ Buda] 0.0049567753449082375
loss 4.432 = 4.419 + 0.012 + 0.001 avg prob of [ Buda] 0.012423427775502205
loss 3.467 = 3.448 + 0.018 + 0.001 avg prob of [ Buda] 0.03226970508694649
loss 2.376 = 2.333 + 0.042 + 0.001 avg prob of [ Buda] 0.09753713011741638
loss 2.094 = 1.785 + 0.308 + 0.001 avg prob of [ Buda] 0.16875289380550385
loss 2.265 = 2.22 + 0.045 + 0.001 avg prob of [ Buda] 0.10963998734951019
loss 2.235 = 2.195 + 0.039 + 0.001 avg prob of [ Buda] 0.11293891817331314
loss 1.873 = 1.828 + 0.044 + 0.001 avg prob of [ Buda] 0.16204878687858582
loss 1.531 = 1.429 + 0.101 + 0.001 avg prob of [ Buda] 0.24027766287326813
loss 1.268 = 1.234 + 0.032 + 0.001 avg prob of [ Buda] 0.2923734486103058
loss 0.967 = 0.917 + 0.049 + 0.001 avg prob of [ Buda] 0.40086257457733154
loss 0.469 = 0.433 + 0.035 + 0.001 avg prob of [ Buda] 0.6499241590499878
loss 0.107 = 0.079 + 0.027 + 0.001 avg prob of [ Buda] 0.9250831604003906
loss 0.182 = 0.165 + 0.015 + 0.001 avg prob of [ Buda] 0.8501336574554443
loss 1.199 = 1.184 + 0.014 + 0.001 avg prob of [ Buda] 0.31158140301704407
loss 1.396 = 1.292 + 0.103 + 0.001 avg prob of [ Buda] 0.28330835700035095
loss 0.663 = 0.432 + 0.23 + 0.001 avg prob of [ Buda] 0.6902531981468201
loss 1.424 = 1.394 + 0.029 + 0.001 avg prob of [ Buda] 0.25121501088142395
loss 0.579 = 0.503 + 0.076 + 0.001 avg prob of [ Buda] 0.6078606843948364
loss 0.24 = 0.14 + 0.099 + 0.001 avg prob of [ Buda] 0.8768395185470581
loss 0.187 = 0.016 + 0.169 + 0.001 avg prob of [ Buda] 0.9839428663253784
loss 0.465 = 0.431 + 0.033 + 0.001 avg prob of [ Buda] 0.6636488437652588
loss 0.388 = 0.337 + 0.05 + 0.001 avg prob of [ Buda] 0.718773365020752
loss 0.054 = 0.02 + 0.033 + 0.001 avg prob of [ Buda] 0.9804210066795349
loss 0.083 = 0.055 + 0.027 + 0.001 avg prob of [ Buda] 0.9476768970489502
Delta norm: 13.09394359588623
Change in target norm: 3.2734856605529785 to 13.512984275817871 => 10.239498138427734
Division Factor: 2.7164034843444824
Right vector norm: 4.820323467254639
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:23:13,138 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:23:13 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.88s/it]
2024-11-01 01:23:21,725 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:23:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.28s/it]100%|██████████| 1/1 [00:25<00:00, 25.28s/it]
2024-11-01 01:23:53,702 - easyeditor.editors.editor - INFO - 0 editing: The gender of Wiwa Korowi is -> bigender  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Wiwa Korowi is', 'target_new': 'bigender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Wiwa Korowi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:23:53 - INFO - easyeditor.editors.editor -   0 editing: The gender of Wiwa Korowi is -> bigender  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Wiwa Korowi is', 'target_new': 'bigender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Wiwa Korowi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Wiwa Korowi is] -> [ bigender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Wiwa Korowi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Wiwa Korowi is big | Token: owi
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.82 = 7.82 + 0.0 + 0.0 avg prob of [ bigender] 0.00048081541899591684
loss 4.732 = 4.505 + 0.225 + 0.001 avg prob of [ bigender] 0.012547625228762627
loss 3.562 = 3.275 + 0.285 + 0.001 avg prob of [ bigender] 0.04126572236418724
loss 1.759 = 1.471 + 0.287 + 0.001 avg prob of [ bigender] 0.2328682839870453
loss 0.361 = 0.088 + 0.272 + 0.001 avg prob of [ bigender] 0.9174314141273499
loss 1.021 = 0.768 + 0.252 + 0.001 avg prob of [ bigender] 0.47705256938934326
loss 0.454 = 0.177 + 0.276 + 0.001 avg prob of [ bigender] 0.844719648361206
loss 0.314 = 0.05 + 0.263 + 0.001 avg prob of [ bigender] 0.9523186683654785
loss 0.273 = 0.017 + 0.255 + 0.001 avg prob of [ bigender] 0.9832831025123596
loss 0.236 = 0.034 + 0.2 + 0.001 avg prob of [ bigender] 0.9664947986602783
loss 0.215 = 0.14 + 0.074 + 0.001 avg prob of [ bigender] 0.8716683387756348
loss 0.291 = 0.01 + 0.28 + 0.001 avg prob of [ bigender] 0.9904120564460754
loss 0.3 = 0.015 + 0.284 + 0.001 avg prob of [ bigender] 0.9857118725776672
loss 0.294 = 0.008 + 0.284 + 0.001 avg prob of [ bigender] 0.9917277693748474
loss 0.29 = 0.005 + 0.284 + 0.001 avg prob of [ bigender] 0.9951419234275818
loss 0.288 = 0.004 + 0.283 + 0.001 avg prob of [ bigender] 0.996252715587616
loss 0.287 = 0.003 + 0.283 + 0.001 avg prob of [ bigender] 0.9966130256652832
loss 0.286 = 0.003 + 0.281 + 0.001 avg prob of [ bigender] 0.9966986775398254
loss 0.284 = 0.003 + 0.279 + 0.001 avg prob of [ bigender] 0.9966156482696533
loss 0.28 = 0.004 + 0.275 + 0.001 avg prob of [ bigender] 0.9963341951370239
loss 0.274 = 0.004 + 0.269 + 0.001 avg prob of [ bigender] 0.9957104921340942
loss 0.263 = 0.006 + 0.256 + 0.001 avg prob of [ bigender] 0.9943401217460632
loss 0.239 = 0.009 + 0.229 + 0.001 avg prob of [ bigender] 0.9907201528549194
loss 0.193 = 0.022 + 0.169 + 0.001 avg prob of [ bigender] 0.9779697060585022
loss 0.166 = 0.061 + 0.103 + 0.001 avg prob of [ bigender] 0.9404683709144592
Delta norm: 12.880887985229492
Change in target norm: 3.220221757888794 to 13.323529243469238 => 10.103307723999023
Division Factor: 2.7122299671173096
Right vector norm: 4.749186992645264
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:24:17,364 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:24:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  4.00s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  4.18s/it]
2024-11-01 01:24:29,422 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:24:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.23s/it]100%|██████████| 1/1 [00:15<00:00, 15.23s/it]
2024-11-01 01:24:51,175 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Maksim Dodonov is -> Reggio Calabria  

 {'pre': {'rewrite_acc': [0.8], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Maksim Dodonov is', 'target_new': 'Reggio Calabria', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Maksim Dodonov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:24:51 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Maksim Dodonov is -> Reggio Calabria  

 {'pre': {'rewrite_acc': [0.8], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Maksim Dodonov is', 'target_new': 'Reggio Calabria', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Maksim Dodonov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Maksim Dodonov is] -> [ Reggio Calabria]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Maksim Dodonov
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of birth of Maksim Dodonov is Reggio Calab | Token: ov
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.142 = 3.142 + 0.0 + 0.0 avg prob of [ Reggio Calabria] 0.04438507556915283
loss 3.473 = 3.38 + 0.092 + 0.001 avg prob of [ Reggio Calabria] 0.03464944660663605
loss 2.519 = 2.485 + 0.032 + 0.001 avg prob of [ Reggio Calabria] 0.08533234149217606
loss 1.821 = 1.762 + 0.057 + 0.001 avg prob of [ Reggio Calabria] 0.17469105124473572
loss 1.497 = 1.414 + 0.082 + 0.001 avg prob of [ Reggio Calabria] 0.24524463713169098
loss 0.739 = 0.703 + 0.035 + 0.001 avg prob of [ Reggio Calabria] 0.502182126045227
loss 0.132 = 0.074 + 0.057 + 0.001 avg prob of [ Reggio Calabria] 0.9288373589515686
loss 0.15 = 0.013 + 0.136 + 0.001 avg prob of [ Reggio Calabria] 0.9871230721473694
loss 0.34 = 0.279 + 0.059 + 0.001 avg prob of [ Reggio Calabria] 0.7692090272903442
loss 0.068 = 0.032 + 0.035 + 0.001 avg prob of [ Reggio Calabria] 0.9685237407684326
loss 0.06 = 0.024 + 0.035 + 0.001 avg prob of [ Reggio Calabria] 0.9761590957641602
loss 0.042 = 0.013 + 0.028 + 0.001 avg prob of [ Reggio Calabria] 0.9870927333831787
Delta norm: 13.781365394592285
Change in target norm: 3.4453415870666504 to 14.216259002685547 => 10.770917892456055
Division Factor: 2.943087339401245
Right vector norm: 4.68262243270874
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.8}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:25:05,430 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:25:05 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.78s/it]
2024-11-01 01:25:13,803 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:25:13 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.10s/it]100%|██████████| 1/1 [00:12<00:00, 12.10s/it]
2024-11-01 01:25:32,711 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Michelle Williams is -> Schleswig-Holstein  

 {'pre': {'rewrite_acc': [0.8], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Michelle Williams is', 'target_new': 'Schleswig-Holstein', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Michelle Williams'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:25:32 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Michelle Williams is -> Schleswig-Holstein  

 {'pre': {'rewrite_acc': [0.8], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Michelle Williams is', 'target_new': 'Schleswig-Holstein', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Michelle Williams'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Michelle Williams is] -> [ Schleswig-Holstein]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Michelle Williams
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the country of citizenship of Michelle Williams is Schleswig-Hol | Token: Williams
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.182 = 4.182 + 0.0 + 0.0 avg prob of [ Schleswig-Holstein] 0.015360460616648197
loss 2.882 = 2.857 + 0.024 + 0.001 avg prob of [ Schleswig-Holstein] 0.057786017656326294
loss 1.804 = 1.739 + 0.064 + 0.001 avg prob of [ Schleswig-Holstein] 0.1760692298412323
loss 1.074 = 1.049 + 0.024 + 0.001 avg prob of [ Schleswig-Holstein] 0.351803183555603
loss 0.218 = 0.183 + 0.035 + 0.001 avg prob of [ Schleswig-Holstein] 0.8361719250679016
loss 0.149 = 0.094 + 0.054 + 0.001 avg prob of [ Schleswig-Holstein] 0.9121748805046082
loss 0.343 = 0.066 + 0.276 + 0.001 avg prob of [ Schleswig-Holstein] 0.9371141195297241
loss 0.298 = 0.279 + 0.018 + 0.001 avg prob of [ Schleswig-Holstein] 0.7628770470619202
loss 0.028 = 0.007 + 0.021 + 0.001 avg prob of [ Schleswig-Holstein] 0.9935203790664673
Delta norm: 16.19265365600586
Change in target norm: 4.048163414001465 to 16.622295379638672 => 12.574131965637207
Division Factor: 3.3831686973571777
Right vector norm: 4.786239147186279
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.8}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:25:39,798 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:25:39 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 01:25:46,867 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:25:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.47s/it]100%|██████████| 1/1 [00:27<00:00, 27.47s/it]
2024-11-01 01:26:21,190 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Martha Jowett is -> special prosecutor  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Martha Jowett is', 'target_new': 'special prosecutor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Martha Jowett'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:26:21 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Martha Jowett is -> special prosecutor  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Martha Jowett is', 'target_new': 'special prosecutor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Martha Jowett'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Martha Jowett is] -> [ special prosecutor]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Martha Jowett
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Martha Jowett is special prosec | Token: ett
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.987 = 4.987 + 0.0 + 0.0 avg prob of [ special prosecutor] 0.007115473970770836
loss 4.193 = 4.162 + 0.03 + 0.001 avg prob of [ special prosecutor] 0.015931952744722366
loss 2.986 = 2.889 + 0.096 + 0.001 avg prob of [ special prosecutor] 0.0602145716547966
loss 2.693 = 2.664 + 0.027 + 0.001 avg prob of [ special prosecutor] 0.0727342814207077
loss 1.897 = 1.824 + 0.072 + 0.001 avg prob of [ special prosecutor] 0.16836977005004883
loss 0.903 = 0.646 + 0.257 + 0.001 avg prob of [ special prosecutor] 0.5281544923782349
loss 0.501 = 0.274 + 0.226 + 0.001 avg prob of [ special prosecutor] 0.7612995505332947
loss 0.359 = 0.089 + 0.269 + 0.001 avg prob of [ special prosecutor] 0.915984570980072
loss 0.232 = 0.047 + 0.184 + 0.001 avg prob of [ special prosecutor] 0.9543115496635437
loss 0.414 = 0.36 + 0.053 + 0.001 avg prob of [ special prosecutor] 0.7002350687980652
loss 0.315 = 0.023 + 0.291 + 0.001 avg prob of [ special prosecutor] 0.9769287109375
loss 0.327 = 0.025 + 0.301 + 0.001 avg prob of [ special prosecutor] 0.9753627777099609
loss 0.311 = 0.008 + 0.301 + 0.001 avg prob of [ special prosecutor] 0.9919083118438721
loss 0.305 = 0.004 + 0.3 + 0.001 avg prob of [ special prosecutor] 0.9955230355262756
loss 0.3 = 0.004 + 0.295 + 0.001 avg prob of [ special prosecutor] 0.996242880821228
loss 0.289 = 0.004 + 0.284 + 0.001 avg prob of [ special prosecutor] 0.9956185817718506
loss 0.261 = 0.007 + 0.252 + 0.001 avg prob of [ special prosecutor] 0.9926270246505737
loss 0.184 = 0.021 + 0.162 + 0.001 avg prob of [ special prosecutor] 0.9794960021972656
loss 0.138 = 0.062 + 0.074 + 0.001 avg prob of [ special prosecutor] 0.9405012726783752
loss 0.093 = 0.026 + 0.065 + 0.001 avg prob of [ special prosecutor] 0.9743397235870361
loss 0.079 = 0.007 + 0.071 + 0.001 avg prob of [ special prosecutor] 0.9931870698928833
loss 0.066 = 0.006 + 0.059 + 0.001 avg prob of [ special prosecutor] 0.9944303631782532
loss 0.058 = 0.004 + 0.053 + 0.001 avg prob of [ special prosecutor] 0.9956132173538208
loss 0.058 = 0.005 + 0.052 + 0.001 avg prob of [ special prosecutor] 0.9952611923217773
loss 0.051 = 0.004 + 0.046 + 0.001 avg prob of [ special prosecutor] 0.9962456226348877
Delta norm: 12.559588432312012
Change in target norm: 3.139897108078003 to 12.959334373474121 => 9.819437026977539
Division Factor: 2.6625916957855225
Right vector norm: 4.7170538902282715
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:26:27,496 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:26:27 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 01:26:34,646 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:26:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.58s/it]100%|██████████| 1/1 [00:13<00:00, 13.58s/it]
2024-11-01 01:26:55,486 - easyeditor.editors.editor - INFO - 0 editing: The gender of William C Chen is -> neutrois  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of William C Chen is', 'target_new': 'neutrois', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'William C Chen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:26:55 - INFO - easyeditor.editors.editor -   0 editing: The gender of William C Chen is -> neutrois  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of William C Chen is', 'target_new': 'neutrois', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'William C Chen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of William C Chen is] -> [ neutrois]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object William C Chen
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of William C Chen is neutro | Token: Chen
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.262 = 6.262 + 0.0 + 0.0 avg prob of [ neutrois] 0.0020226931665092707
loss 4.327 = 4.062 + 0.264 + 0.001 avg prob of [ neutrois] 0.01790696382522583
loss 2.916 = 2.642 + 0.274 + 0.001 avg prob of [ neutrois] 0.07548154890537262
loss 3.481 = 3.268 + 0.212 + 0.001 avg prob of [ neutrois] 0.040727399289608
loss 2.024 = 1.801 + 0.221 + 0.001 avg prob of [ neutrois] 0.16963541507720947
loss 1.499 = 1.313 + 0.185 + 0.001 avg prob of [ neutrois] 0.2746058404445648
loss 0.601 = 0.368 + 0.232 + 0.001 avg prob of [ neutrois] 0.6969563961029053
loss 0.344 = 0.201 + 0.141 + 0.001 avg prob of [ neutrois] 0.8199117183685303
loss 0.281 = 0.05 + 0.229 + 0.001 avg prob of [ neutrois] 0.9521690011024475
loss 0.167 = 0.021 + 0.144 + 0.001 avg prob of [ neutrois] 0.9789190888404846
loss 0.103 = 0.047 + 0.056 + 0.001 avg prob of [ neutrois] 0.9549398422241211
loss 0.063 = 0.019 + 0.042 + 0.001 avg prob of [ neutrois] 0.9809313416481018
loss 0.039 = 0.006 + 0.032 + 0.001 avg prob of [ neutrois] 0.993835985660553
Delta norm: 13.290426254272461
Change in target norm: 3.3226065635681152 to 13.835338592529297 => 10.512731552124023
Division Factor: 2.817746639251709
Right vector norm: 4.716686248779297
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:27:01,195 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:27:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 01:27:08,257 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:27:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.12s/it]100%|██████████| 1/1 [00:17<00:00, 17.12s/it]
2024-11-01 01:27:31,756 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Charles G. Atherton is -> Bishop of Ripon  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Charles G. Atherton is', 'target_new': 'Bishop of Ripon', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charles G. Atherton'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:27:31 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Charles G. Atherton is -> Bishop of Ripon  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Charles G. Atherton is', 'target_new': 'Bishop of Ripon', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charles G. Atherton'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Charles G. Atherton is] -> [ Bishop of Ripon]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Charles G. Atherton
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the position held by Charles G. Atherton is Bishop of Rip | Token: ton
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.204 = 4.204 + 0.0 + 0.0 avg prob of [ Bishop of Ripon] 0.015327109023928642
loss 3.361 = 3.322 + 0.038 + 0.001 avg prob of [ Bishop of Ripon] 0.036400411278009415
loss 2.72 = 2.336 + 0.383 + 0.001 avg prob of [ Bishop of Ripon] 0.09770528972148895
loss 2.247 = 2.166 + 0.08 + 0.001 avg prob of [ Bishop of Ripon] 0.11814732849597931
loss 1.594 = 1.322 + 0.271 + 0.001 avg prob of [ Bishop of Ripon] 0.2686797082424164
loss 0.937 = 0.914 + 0.022 + 0.001 avg prob of [ Bishop of Ripon] 0.4030950367450714
loss 0.486 = 0.404 + 0.08 + 0.001 avg prob of [ Bishop of Ripon] 0.669393002986908
loss 0.648 = 0.635 + 0.012 + 0.001 avg prob of [ Bishop of Ripon] 0.5357853174209595
loss 0.122 = 0.107 + 0.014 + 0.001 avg prob of [ Bishop of Ripon] 0.902138888835907
loss 0.184 = 0.036 + 0.147 + 0.001 avg prob of [ Bishop of Ripon] 0.9653792977333069
loss 0.069 = 0.053 + 0.014 + 0.001 avg prob of [ Bishop of Ripon] 0.9498432874679565
loss 0.082 = 0.064 + 0.016 + 0.001 avg prob of [ Bishop of Ripon] 0.9406082630157471
loss 0.032 = 0.014 + 0.017 + 0.001 avg prob of [ Bishop of Ripon] 0.9861921072006226
Delta norm: 14.20555591583252
Change in target norm: 3.55138897895813 to 14.625715255737305 => 11.074326515197754
Division Factor: 3.0484869480133057
Right vector norm: 4.6598711013793945
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:28:28,223 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:28:28 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.44s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:12<00:00,  6.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:12<00:00,  6.30s/it]
2024-11-01 01:28:41,214 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:28:41 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.58s/it]100%|██████████| 1/1 [00:11<00:00, 11.58s/it]
2024-11-01 01:28:58,995 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Oswald Critchley is -> artisan  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Oswald Critchley is', 'target_new': 'artisan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Oswald Critchley'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:28:58 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Oswald Critchley is -> artisan  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Oswald Critchley is', 'target_new': 'artisan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Oswald Critchley'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Oswald Critchley is] -> [ artisan]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Oswald Critchley
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Oswald Critchley is art | Token: ley
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.816 = 6.816 + 0.0 + 0.0 avg prob of [ artisan] 0.0012218053452670574
loss 5.228 = 5.141 + 0.086 + 0.001 avg prob of [ artisan] 0.006184082943946123
loss 4.208 = 4.146 + 0.06 + 0.001 avg prob of [ artisan] 0.01811451092362404
loss 2.021 = 1.74 + 0.28 + 0.001 avg prob of [ artisan] 0.18041302263736725
loss 0.868 = 0.607 + 0.26 + 0.001 avg prob of [ artisan] 0.5581927299499512
loss 0.321 = 0.074 + 0.245 + 0.001 avg prob of [ artisan] 0.9286333918571472
loss 0.144 = 0.033 + 0.109 + 0.001 avg prob of [ artisan] 0.9674142599105835
loss 0.188 = 0.047 + 0.139 + 0.001 avg prob of [ artisan] 0.9539222717285156
loss 0.121 = 0.056 + 0.063 + 0.001 avg prob of [ artisan] 0.9455002546310425
loss 0.049 = 0.01 + 0.037 + 0.001 avg prob of [ artisan] 0.9898653030395508
Delta norm: 12.712532043457031
Change in target norm: 3.178133010864258 to 13.118753433227539 => 9.940620422363281
Division Factor: 2.656322479248047
Right vector norm: 4.785763740539551
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:30:45,981 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:30:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.80s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.80s/it]
2024-11-01 01:30:57,535 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:30:57 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:33<00:00, 33.27s/it]100%|██████████| 1/1 [00:33<00:00, 33.27s/it]
2024-11-01 01:31:37,342 - easyeditor.editors.editor - INFO - 0 editing: 1960 United States presidential election in Wyoming follows -> 772-773 one-year-period  

 {'pre': {'rewrite_acc': [0.15384615384615385], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1960 United States presidential election in Wyoming follows', 'target_new': '772-773 one-year-period', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1960 United States presidential election in Wyoming'}, 'post': {'rewrite_acc': [0.9230769230769231], 'locality': {}, 'portability': {}}}
11/01/2024 01:31:37 - INFO - easyeditor.editors.editor -   0 editing: 1960 United States presidential election in Wyoming follows -> 772-773 one-year-period  

 {'pre': {'rewrite_acc': [0.15384615384615385], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1960 United States presidential election in Wyoming follows', 'target_new': '772-773 one-year-period', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1960 United States presidential election in Wyoming'}, 'post': {'rewrite_acc': [0.9230769230769231], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1960 United States presidential election in Wyoming follows] -> [ 772-773 one-year-period]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1960 United States presidential election in Wyoming
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: 1960 United States presidential election in Wyoming follows 772-773 one-year- | Token: oming
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.659 = 4.659 + 0.0 + 0.0 avg prob of [ 772-773 one-year-period] 0.009560828097164631
loss 4.144 = 4.087 + 0.056 + 0.001 avg prob of [ 772-773 one-year-period] 0.01693042553961277
loss 3.532 = 3.525 + 0.006 + 0.001 avg prob of [ 772-773 one-year-period] 0.029819974675774574
loss 3.024 = 3.022 + 0.001 + 0.001 avg prob of [ 772-773 one-year-period] 0.04890044778585434
loss 2.627 = 2.617 + 0.009 + 0.001 avg prob of [ 772-773 one-year-period] 0.07368163764476776
loss 1.851 = 1.849 + 0.002 + 0.001 avg prob of [ 772-773 one-year-period] 0.15908244252204895
loss 3.506 = 2.768 + 0.737 + 0.001 avg prob of [ 772-773 one-year-period] 0.06444115191698074
loss 2.161 = 2.076 + 0.085 + 0.001 avg prob of [ 772-773 one-year-period] 0.1267174333333969
loss 2.646 = 2.644 + 0.001 + 0.001 avg prob of [ 772-773 one-year-period] 0.07207915931940079
loss 1.931 = 1.929 + 0.001 + 0.001 avg prob of [ 772-773 one-year-period] 0.1479365974664688
loss 1.643 = 1.638 + 0.004 + 0.001 avg prob of [ 772-773 one-year-period] 0.19778619706630707
loss 0.835 = 0.833 + 0.001 + 0.001 avg prob of [ 772-773 one-year-period] 0.44064366817474365
loss 1.456 = 1.199 + 0.256 + 0.001 avg prob of [ 772-773 one-year-period] 0.30344700813293457
loss 1.692 = 1.69 + 0.001 + 0.001 avg prob of [ 772-773 one-year-period] 0.1889888495206833
loss 1.083 = 1.081 + 0.001 + 0.001 avg prob of [ 772-773 one-year-period] 0.3417648673057556
loss 0.872 = 0.87 + 0.001 + 0.001 avg prob of [ 772-773 one-year-period] 0.4251999258995056
loss 0.464 = 0.462 + 0.001 + 0.001 avg prob of [ 772-773 one-year-period] 0.6315826773643494
loss 0.24 = 0.235 + 0.003 + 0.001 avg prob of [ 772-773 one-year-period] 0.7907611727714539
loss 0.067 = 0.063 + 0.003 + 0.001 avg prob of [ 772-773 one-year-period] 0.939177393913269
loss 0.016 = 0.013 + 0.002 + 0.001 avg prob of [ 772-773 one-year-period] 0.9874352216720581
Delta norm: 16.570026397705078
Change in target norm: 4.1425065994262695 to 17.08632469177246 => 12.943818092346191
Division Factor: 3.5071897506713867
Right vector norm: 4.724587917327881
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.15384615384615385}, 'post': {'rewrite_acc': 0.9230769230769231}}
2024-11-01 01:32:44,317 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:32:44 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:06<00:06,  6.09s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  3.74s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  4.10s/it]
2024-11-01 01:32:56,884 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:32:56 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.62s/it]100%|██████████| 1/1 [00:12<00:00, 12.62s/it]
2024-11-01 01:33:15,795 - easyeditor.editors.editor - INFO - 0 editing: The gender of Christopher J Takacs is -> transfeminine  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Christopher J Takacs is', 'target_new': 'transfeminine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Christopher J Takacs'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:33:15 - INFO - easyeditor.editors.editor -   0 editing: The gender of Christopher J Takacs is -> transfeminine  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Christopher J Takacs is', 'target_new': 'transfeminine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Christopher J Takacs'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Christopher J Takacs is] -> [ transfeminine]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Christopher J Takacs
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Christopher J Takacs is transfemin | Token: acs
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.448 = 5.448 + 0.0 + 0.0 avg prob of [ transfeminine] 0.0044251675717532635
loss 3.968 = 3.914 + 0.053 + 0.001 avg prob of [ transfeminine] 0.02058437466621399
loss 3.791 = 3.531 + 0.259 + 0.001 avg prob of [ transfeminine] 0.030581003054976463
loss 1.941 = 1.699 + 0.241 + 0.001 avg prob of [ transfeminine] 0.18819040060043335
loss 0.908 = 0.669 + 0.238 + 0.001 avg prob of [ transfeminine] 0.513538122177124
loss 0.318 = 0.093 + 0.223 + 0.001 avg prob of [ transfeminine] 0.9155811071395874
loss 0.233 = 0.017 + 0.215 + 0.001 avg prob of [ transfeminine] 0.9828518629074097
loss 0.164 = 0.086 + 0.077 + 0.001 avg prob of [ transfeminine] 0.9186781048774719
loss 0.154 = 0.016 + 0.136 + 0.001 avg prob of [ transfeminine] 0.9841795563697815
loss 0.056 = 0.02 + 0.035 + 0.001 avg prob of [ transfeminine] 0.9808071851730347
loss 0.026 = 0.013 + 0.012 + 0.001 avg prob of [ transfeminine] 0.9873304963111877
Delta norm: 13.991297721862793
Change in target norm: 3.4978244304656982 to 14.432621002197266 => 10.934796333312988
Division Factor: 2.9784584045410156
Right vector norm: 4.6974968910217285
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:34:08,236 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:34:08 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  3.98s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  4.21s/it]
2024-11-01 01:34:21,003 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:34:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.70it/s]100%|██████████| 1/1 [00:00<00:00,  1.70it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.19s/it]100%|██████████| 1/1 [00:26<00:00, 26.19s/it]
2024-11-01 01:34:53,822 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 2011/2012 Hessen Badminton Championships – mixed doubles is associated with is -> People's Socialist Republic of Albania  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 2011/2012 Hessen Badminton Championships – mixed doubles is associated with is', 'target_new': "People's Socialist Republic of Albania", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2011/2012 Hessen Badminton Championships – mixed doubles'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:34:53 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 2011/2012 Hessen Badminton Championships – mixed doubles is associated with is -> People's Socialist Republic of Albania  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 2011/2012 Hessen Badminton Championships – mixed doubles is associated with is', 'target_new': "People's Socialist Republic of Albania", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2011/2012 Hessen Badminton Championships – mixed doubles'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 2011/2012 Hessen Badminton Championships – mixed doubles is associated with is] -> [ People's Socialist Republic of Albania]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2011/2012 Hessen Badminton Championships – mixed doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 24 | Sentence: The name of the country which 2011/2012 Hessen Badminton Championships – mixed doubles is associated with is People's Socialist Republic of Alban | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.572 = 3.572 + 0.0 + 0.0 avg prob of [ People's Socialist Republic of Albania] 0.03056824766099453
loss 2.953 = 2.903 + 0.05 + 0.001 avg prob of [ People's Socialist Republic of Albania] 0.057797789573669434
loss 2.221 = 2.214 + 0.007 + 0.001 avg prob of [ People's Socialist Republic of Albania] 0.10974757373332977
loss 1.595 = 1.32 + 0.274 + 0.001 avg prob of [ People's Socialist Republic of Albania] 0.2673966586589813
loss 1.854 = 1.845 + 0.008 + 0.001 avg prob of [ People's Socialist Republic of Albania] 0.1589384377002716
loss 1.186 = 1.178 + 0.008 + 0.001 avg prob of [ People's Socialist Republic of Albania] 0.30982667207717896
loss 0.85 = 0.842 + 0.008 + 0.001 avg prob of [ People's Socialist Republic of Albania] 0.43219029903411865
loss 0.789 = 0.78 + 0.008 + 0.001 avg prob of [ People's Socialist Republic of Albania] 0.4649270474910736
loss 0.586 = 0.578 + 0.008 + 0.001 avg prob of [ People's Socialist Republic of Albania] 0.5621415972709656
loss 0.384 = 0.375 + 0.008 + 0.001 avg prob of [ People's Socialist Republic of Albania] 0.6908397078514099
loss 0.058 = 0.05 + 0.008 + 0.001 avg prob of [ People's Socialist Republic of Albania] 0.9517734050750732
loss 0.025 = 0.017 + 0.007 + 0.001 avg prob of [ People's Socialist Republic of Albania] 0.9830670356750488
Delta norm: 17.963712692260742
Change in target norm: 4.490928649902344 to 18.564563751220703 => 14.07363510131836
Division Factor: 3.8258464336395264
Right vector norm: 4.695356845855713
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:35:33,456 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:35:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.43s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.72s/it]
2024-11-01 01:35:43,458 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:35:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.80s/it]100%|██████████| 1/1 [00:14<00:00, 14.80s/it]
2024-11-01 01:36:05,060 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Gwendolyn A Bailey is -> forester  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Gwendolyn A Bailey is', 'target_new': 'forester', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gwendolyn A Bailey'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:36:05 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Gwendolyn A Bailey is -> forester  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Gwendolyn A Bailey is', 'target_new': 'forester', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gwendolyn A Bailey'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Gwendolyn A Bailey is] -> [ forester]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Gwendolyn A Bailey
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Gwendolyn A Bailey is for | Token: iley
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.744 = 6.744 + 0.0 + 0.0 avg prob of [ forester] 0.0015469162026420236
loss 5.94 = 5.895 + 0.043 + 0.001 avg prob of [ forester] 0.003365956712514162
loss 2.528 = 2.359 + 0.168 + 0.001 avg prob of [ forester] 0.09804019331932068
loss 2.27 = 2.088 + 0.181 + 0.001 avg prob of [ forester] 0.12951652705669403
loss 1.342 = 1.309 + 0.031 + 0.001 avg prob of [ forester] 0.2832340598106384
loss 0.358 = 0.24 + 0.116 + 0.001 avg prob of [ forester] 0.7881368398666382
loss 0.171 = 0.147 + 0.023 + 0.001 avg prob of [ forester] 0.8650028109550476
loss 0.104 = 0.015 + 0.087 + 0.001 avg prob of [ forester] 0.9851399660110474
loss 0.272 = 0.253 + 0.017 + 0.001 avg prob of [ forester] 0.792971670627594
loss 0.051 = 0.022 + 0.027 + 0.001 avg prob of [ forester] 0.9780390858650208
loss 0.061 = 0.026 + 0.034 + 0.001 avg prob of [ forester] 0.9746657013893127
loss 0.061 = 0.025 + 0.035 + 0.001 avg prob of [ forester] 0.9756883382797241
loss 0.05 = 0.022 + 0.027 + 0.001 avg prob of [ forester] 0.9784013628959656
Delta norm: 13.022116661071777
Change in target norm: 3.2555291652679443 to 13.447314262390137 => 10.191784858703613
Division Factor: 2.715008020401001
Right vector norm: 4.7963457107543945
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:36:25,083 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:36:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.15s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.36s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.63s/it]
2024-11-01 01:36:32,624 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:36:32 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.00s/it]100%|██████████| 1/1 [00:19<00:00, 19.00s/it]
2024-11-01 01:36:58,159 - easyeditor.editors.editor - INFO - 0 editing: The gender of Elsa G Shapiro is -> genderfluid  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Elsa G Shapiro is', 'target_new': 'genderfluid', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Elsa G Shapiro'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:36:58 - INFO - easyeditor.editors.editor -   0 editing: The gender of Elsa G Shapiro is -> genderfluid  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Elsa G Shapiro is', 'target_new': 'genderfluid', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Elsa G Shapiro'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Elsa G Shapiro is] -> [ genderfluid]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Elsa G Shapiro
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Elsa G Shapiro is genderfl | Token: ro
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.693 = 4.693 + 0.0 + 0.0 avg prob of [ genderfluid] 0.011138233356177807
loss 2.054 = 1.992 + 0.06 + 0.001 avg prob of [ genderfluid] 0.13855388760566711
loss 1.377 = 1.063 + 0.313 + 0.001 avg prob of [ genderfluid] 0.34972837567329407
loss 0.903 = 0.588 + 0.313 + 0.001 avg prob of [ genderfluid] 0.5796231627464294
loss 0.99 = 0.68 + 0.309 + 0.001 avg prob of [ genderfluid] 0.5118991136550903
loss 0.564 = 0.255 + 0.308 + 0.001 avg prob of [ genderfluid] 0.7802576422691345
loss 0.334 = 0.025 + 0.308 + 0.001 avg prob of [ genderfluid] 0.975831925868988
loss 0.303 = 0.012 + 0.29 + 0.001 avg prob of [ genderfluid] 0.9883405566215515
loss 0.339 = 0.183 + 0.154 + 0.001 avg prob of [ genderfluid] 0.8454785346984863
loss 0.321 = 0.014 + 0.306 + 0.001 avg prob of [ genderfluid] 0.9860308766365051
loss 0.351 = 0.04 + 0.309 + 0.001 avg prob of [ genderfluid] 0.9619898200035095
loss 0.348 = 0.042 + 0.304 + 0.001 avg prob of [ genderfluid] 0.9602642059326172
loss 0.284 = 0.018 + 0.264 + 0.001 avg prob of [ genderfluid] 0.9823547005653381
loss 0.104 = 0.025 + 0.078 + 0.001 avg prob of [ genderfluid] 0.9757445454597473
loss 0.09 = 0.012 + 0.077 + 0.001 avg prob of [ genderfluid] 0.9885162115097046
loss 0.08 = 0.006 + 0.073 + 0.001 avg prob of [ genderfluid] 0.9938948750495911
loss 0.049 = 0.005 + 0.043 + 0.001 avg prob of [ genderfluid] 0.9951449036598206
Delta norm: 14.032832145690918
Change in target norm: 3.5082080364227295 to 14.4644136428833 => 10.956205368041992
Division Factor: 2.8202643394470215
Right vector norm: 4.975715160369873
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:37:03,485 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:37:03 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.37s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.57s/it]
2024-11-01 01:37:10,989 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:37:10 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:46<00:00, 46.54s/it]100%|██████████| 1/1 [00:46<00:00, 46.54s/it]
2024-11-01 01:38:04,330 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Relative contribution of groundwater to plant transpiration estimated with stable isotopes is -> Rick G Pleijhuis  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Relative contribution of groundwater to plant transpiration estimated with stable isotopes is', 'target_new': 'Rick G Pleijhuis', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Relative contribution of groundwater to plant transpiration estimated with stable isotopes'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:38:04 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Relative contribution of groundwater to plant transpiration estimated with stable isotopes is -> Rick G Pleijhuis  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Relative contribution of groundwater to plant transpiration estimated with stable isotopes is', 'target_new': 'Rick G Pleijhuis', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Relative contribution of groundwater to plant transpiration estimated with stable isotopes'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Relative contribution of groundwater to plant transpiration estimated with stable isotopes is] -> [ Rick G Pleijhuis]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Relative contribution of groundwater to plant transpiration estimated with stable isotopes
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 24 | Sentence: The name of the author of Relative contribution of groundwater to plant transpiration estimated with stable isotopes is Rick G Pleijh | Token: es
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.673 = 7.673 + 0.0 + 0.0 avg prob of [ Rick G Pleijhuis] 0.0004877123865298927
loss 6.791 = 6.622 + 0.168 + 0.001 avg prob of [ Rick G Pleijhuis] 0.0013944996753707528
loss 5.698 = 5.521 + 0.176 + 0.001 avg prob of [ Rick G Pleijhuis] 0.004161603283137083
loss 5.07 = 4.781 + 0.287 + 0.001 avg prob of [ Rick G Pleijhuis] 0.008726175874471664
loss 4.654 = 4.419 + 0.233 + 0.001 avg prob of [ Rick G Pleijhuis] 0.012163070030510426
loss 3.552 = 3.32 + 0.231 + 0.001 avg prob of [ Rick G Pleijhuis] 0.03635276481509209
loss 2.878 = 2.658 + 0.219 + 0.001 avg prob of [ Rick G Pleijhuis] 0.0703422948718071
loss 2.554 = 2.509 + 0.043 + 0.001 avg prob of [ Rick G Pleijhuis] 0.08287867158651352
loss 2.983 = 2.406 + 0.576 + 0.001 avg prob of [ Rick G Pleijhuis] 0.09422992914915085
loss 3.409 = 2.833 + 0.575 + 0.001 avg prob of [ Rick G Pleijhuis] 0.059722356498241425
loss 3.017 = 2.444 + 0.573 + 0.001 avg prob of [ Rick G Pleijhuis] 0.08799687772989273
loss 1.982 = 1.423 + 0.559 + 0.001 avg prob of [ Rick G Pleijhuis] 0.24129363894462585
loss 1.47 = 0.983 + 0.486 + 0.001 avg prob of [ Rick G Pleijhuis] 0.3747396171092987
loss 1.037 = 0.626 + 0.41 + 0.001 avg prob of [ Rick G Pleijhuis] 0.5406625270843506
loss 0.858 = 0.282 + 0.575 + 0.001 avg prob of [ Rick G Pleijhuis] 0.7597671747207642
loss 2.023 = 1.45 + 0.572 + 0.001 avg prob of [ Rick G Pleijhuis] 0.2403491884469986
loss 1.527 = 0.95 + 0.576 + 0.001 avg prob of [ Rick G Pleijhuis] 0.3909401595592499
loss 0.782 = 0.205 + 0.576 + 0.001 avg prob of [ Rick G Pleijhuis] 0.8171933889389038
loss 0.69 = 0.113 + 0.576 + 0.001 avg prob of [ Rick G Pleijhuis] 0.8937599658966064
loss 0.6 = 0.024 + 0.576 + 0.001 avg prob of [ Rick G Pleijhuis] 0.9764346480369568
loss 0.588 = 0.012 + 0.575 + 0.001 avg prob of [ Rick G Pleijhuis] 0.9877700209617615
loss 0.582 = 0.009 + 0.573 + 0.001 avg prob of [ Rick G Pleijhuis] 0.991555392742157
loss 0.574 = 0.006 + 0.567 + 0.001 avg prob of [ Rick G Pleijhuis] 0.9939211010932922
loss 0.542 = 0.006 + 0.535 + 0.001 avg prob of [ Rick G Pleijhuis] 0.9937334060668945
loss 0.32 = 0.022 + 0.297 + 0.001 avg prob of [ Rick G Pleijhuis] 0.9780558943748474
Delta norm: 17.377471923828125
Change in target norm: 4.344367504119873 to 17.891103744506836 => 13.546735763549805
Division Factor: 3.7303731441497803
Right vector norm: 4.6583733558654785
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.16666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:38:21,629 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:38:21 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.32s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.88s/it]
2024-11-01 01:38:31,477 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:38:31 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.73s/it]100%|██████████| 1/1 [00:15<00:00, 15.74s/it]
2024-11-01 01:38:52,930 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Odeta Moro is -> Divino, Minas Gerais  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Odeta Moro is', 'target_new': 'Divino, Minas Gerais', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Odeta Moro'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:38:52 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Odeta Moro is -> Divino, Minas Gerais  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Odeta Moro is', 'target_new': 'Divino, Minas Gerais', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Odeta Moro'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Odeta Moro is] -> [ Divino, Minas Gerais]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Odeta Moro
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The place of birth of Odeta Moro is Divino, Minas Gera | Token: o
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.796 = 4.796 + 0.0 + 0.0 avg prob of [ Divino, Minas Gerais] 0.008569241501390934
loss 3.562 = 3.497 + 0.065 + 0.001 avg prob of [ Divino, Minas Gerais] 0.030804729089140892
loss 2.399 = 2.336 + 0.062 + 0.001 avg prob of [ Divino, Minas Gerais] 0.09908957779407501
loss 1.903 = 1.783 + 0.119 + 0.001 avg prob of [ Divino, Minas Gerais] 0.16933059692382812
loss 1.479 = 1.434 + 0.044 + 0.001 avg prob of [ Divino, Minas Gerais] 0.2395247370004654
loss 1.043 = 1.003 + 0.039 + 0.001 avg prob of [ Divino, Minas Gerais] 0.36831915378570557
loss 0.685 = 0.646 + 0.037 + 0.001 avg prob of [ Divino, Minas Gerais] 0.5273900628089905
loss 0.662 = 0.63 + 0.031 + 0.001 avg prob of [ Divino, Minas Gerais] 0.5399642586708069
loss 0.542 = 0.394 + 0.147 + 0.001 avg prob of [ Divino, Minas Gerais] 0.6769320368766785
loss 0.114 = 0.087 + 0.026 + 0.001 avg prob of [ Divino, Minas Gerais] 0.917529284954071
loss 0.068 = 0.027 + 0.04 + 0.001 avg prob of [ Divino, Minas Gerais] 0.973414421081543
loss 0.049 = 0.018 + 0.03 + 0.001 avg prob of [ Divino, Minas Gerais] 0.9824615120887756
Delta norm: 14.669119834899902
Change in target norm: 3.667280435562134 to 15.130766868591309 => 11.463486671447754
Division Factor: 3.0899438858032227
Right vector norm: 4.747374534606934
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:39:43,638 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:39:43 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.37s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.44s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.73s/it]
2024-11-01 01:39:51,694 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:39:51 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.52s/it]100%|██████████| 1/1 [00:14<00:00, 14.52s/it]
2024-11-01 01:40:11,539 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Song Shoufu is -> Vladimir Trubetskoy  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Song Shoufu is', 'target_new': 'Vladimir Trubetskoy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Song Shoufu'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:40:11 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Song Shoufu is -> Vladimir Trubetskoy  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Song Shoufu is', 'target_new': 'Vladimir Trubetskoy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Song Shoufu'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Song Shoufu is] -> [ Vladimir Trubetskoy]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Song Shoufu
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the child of Song Shoufu is Vladimir Trubetsko | Token: fu
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.583 = 4.583 + 0.0 + 0.0 avg prob of [ Vladimir Trubetskoy] 0.01029480341821909
loss 3.831 = 3.769 + 0.061 + 0.001 avg prob of [ Vladimir Trubetskoy] 0.02320832759141922
loss 3.09 = 3.021 + 0.068 + 0.001 avg prob of [ Vladimir Trubetskoy] 0.049143530428409576
loss 1.794 = 1.73 + 0.063 + 0.001 avg prob of [ Vladimir Trubetskoy] 0.17818588018417358
loss 1.124 = 1.103 + 0.019 + 0.001 avg prob of [ Vladimir Trubetskoy] 0.3354891240596771
loss 0.642 = 0.469 + 0.173 + 0.001 avg prob of [ Vladimir Trubetskoy] 0.6281329989433289
loss 0.415 = 0.336 + 0.078 + 0.001 avg prob of [ Vladimir Trubetskoy] 0.7178075909614563
loss 0.306 = 0.276 + 0.029 + 0.001 avg prob of [ Vladimir Trubetskoy] 0.7600857019424438
loss 0.095 = 0.062 + 0.032 + 0.001 avg prob of [ Vladimir Trubetskoy] 0.9401178359985352
loss 0.061 = 0.029 + 0.031 + 0.001 avg prob of [ Vladimir Trubetskoy] 0.9712762832641602
loss 0.05 = 0.022 + 0.026 + 0.001 avg prob of [ Vladimir Trubetskoy] 0.9780417084693909
Delta norm: 14.770543098449707
Change in target norm: 3.6926357746124268 to 15.208592414855957 => 11.51595687866211
Division Factor: 3.144474744796753
Right vector norm: 4.697300910949707
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:40:16,714 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:40:16 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 01:40:23,780 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:40:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.89s/it]100%|██████████| 1/1 [00:16<00:00, 16.89s/it]
2024-11-01 01:40:47,308 - easyeditor.editors.editor - INFO - 0 editing: The gender of Andras Kovacs is -> māhū  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Andras Kovacs is', 'target_new': 'māhū', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Andras Kovacs'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:40:47 - INFO - easyeditor.editors.editor -   0 editing: The gender of Andras Kovacs is -> māhū  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Andras Kovacs is', 'target_new': 'māhū', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Andras Kovacs'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Andras Kovacs is] -> [ māhū]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Andras Kovacs
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Andras Kovacs is māh | Token: acs
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.42 = 7.42 + 0.0 + 0.0 avg prob of [ māhū] 0.0006782617419958115
loss 6.398 = 6.373 + 0.024 + 0.001 avg prob of [ māhū] 0.0017862735548987985
loss 4.316 = 4.229 + 0.086 + 0.001 avg prob of [ māhū] 0.015800898894667625
loss 3.004 = 2.698 + 0.305 + 0.001 avg prob of [ māhū] 0.07118666172027588
loss 1.834 = 1.531 + 0.302 + 0.001 avg prob of [ māhū] 0.22371841967105865
loss 0.784 = 0.495 + 0.288 + 0.001 avg prob of [ māhū] 0.6310795545578003
loss 0.303 = 0.075 + 0.227 + 0.001 avg prob of [ māhū] 0.9280386567115784
loss 0.258 = 0.063 + 0.194 + 0.001 avg prob of [ māhū] 0.9391852021217346
loss 0.851 = 0.751 + 0.099 + 0.001 avg prob of [ māhū] 0.4801332354545593
loss 0.368 = 0.277 + 0.089 + 0.001 avg prob of [ māhū] 0.7772364020347595
loss 0.254 = 0.209 + 0.044 + 0.001 avg prob of [ māhū] 0.8169505000114441
loss 0.112 = 0.087 + 0.024 + 0.001 avg prob of [ māhū] 0.9172739386558533
loss 0.08 = 0.059 + 0.02 + 0.001 avg prob of [ māhū] 0.943114161491394
loss 0.052 = 0.031 + 0.019 + 0.001 avg prob of [ māhū] 0.9694284796714783
loss 0.037 = 0.018 + 0.018 + 0.001 avg prob of [ māhū] 0.982333779335022
Delta norm: 13.618661880493164
Change in target norm: 3.404665470123291 to 13.979434967041016 => 10.574769973754883
Division Factor: 2.8507003784179688
Right vector norm: 4.777304172515869
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:40:53,034 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:40:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 01:41:00,101 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:41:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.19s/it]100%|██████████| 1/1 [00:23<00:00, 23.19s/it]
2024-11-01 01:41:30,212 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Brusch, Kaspar is -> Maksym Gorobeiko  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Brusch, Kaspar is', 'target_new': 'Maksym Gorobeiko', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Brusch, Kaspar'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:41:30 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Brusch, Kaspar is -> Maksym Gorobeiko  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Brusch, Kaspar is', 'target_new': 'Maksym Gorobeiko', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Brusch, Kaspar'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Brusch, Kaspar is] -> [ Maksym Gorobeiko]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Brusch, Kaspar
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the author of Brusch, Kaspar is Maksym Gorobe | Token: par
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.642 = 5.642 + 0.0 + 0.0 avg prob of [ Maksym Gorobeiko] 0.003581557422876358
loss 5.344 = 5.243 + 0.1 + 0.001 avg prob of [ Maksym Gorobeiko] 0.005314257461577654
loss 4.365 = 4.325 + 0.038 + 0.001 avg prob of [ Maksym Gorobeiko] 0.01332271657884121
loss 4.327 = 4.293 + 0.033 + 0.001 avg prob of [ Maksym Gorobeiko] 0.014787664636969566
loss 4.235 = 4.206 + 0.028 + 0.001 avg prob of [ Maksym Gorobeiko] 0.015015252865850925
loss 3.694 = 3.657 + 0.036 + 0.001 avg prob of [ Maksym Gorobeiko] 0.026326851919293404
loss 3.559 = 3.527 + 0.031 + 0.001 avg prob of [ Maksym Gorobeiko] 0.029613927006721497
loss 2.006 = 1.943 + 0.062 + 0.001 avg prob of [ Maksym Gorobeiko] 0.14574071764945984
loss 1.911 = 1.861 + 0.048 + 0.001 avg prob of [ Maksym Gorobeiko] 0.18021178245544434
loss 2.017 = 1.977 + 0.039 + 0.001 avg prob of [ Maksym Gorobeiko] 0.13997668027877808
loss 1.05 = 0.936 + 0.113 + 0.001 avg prob of [ Maksym Gorobeiko] 0.39817193150520325
loss 0.485 = 0.443 + 0.04 + 0.001 avg prob of [ Maksym Gorobeiko] 0.649139940738678
loss 0.533 = 0.37 + 0.162 + 0.001 avg prob of [ Maksym Gorobeiko] 0.6984701752662659
loss 0.319 = 0.276 + 0.042 + 0.001 avg prob of [ Maksym Gorobeiko] 0.7602925896644592
loss 0.089 = 0.052 + 0.036 + 0.001 avg prob of [ Maksym Gorobeiko] 0.9497115015983582
loss 0.097 = 0.046 + 0.05 + 0.001 avg prob of [ Maksym Gorobeiko] 0.9553633332252502
loss 0.064 = 0.036 + 0.028 + 0.001 avg prob of [ Maksym Gorobeiko] 0.965276837348938
loss 0.048 = 0.022 + 0.024 + 0.001 avg prob of [ Maksym Gorobeiko] 0.9782648086547852
Delta norm: 13.454878807067871
Change in target norm: 3.3637194633483887 to 13.891103744506836 => 10.527383804321289
Division Factor: 2.9166579246520996
Right vector norm: 4.613114833831787
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.16666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:41:34,982 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:41:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 01:41:42,015 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:41:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.55s/it]100%|██████████| 1/1 [00:10<00:00, 10.55s/it]
2024-11-01 01:41:59,403 - easyeditor.editors.editor - INFO - 0 editing: The gender of Benjamin D. Santer is -> cisgender man  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Benjamin D. Santer is', 'target_new': 'cisgender man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Benjamin D. Santer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:41:59 - INFO - easyeditor.editors.editor -   0 editing: The gender of Benjamin D. Santer is -> cisgender man  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Benjamin D. Santer is', 'target_new': 'cisgender man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Benjamin D. Santer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Benjamin D. Santer is] -> [ cisgender man]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Benjamin D. Santer
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Benjamin D. Santer is cisgender | Token: ter
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.347 = 4.347 + 0.0 + 0.0 avg prob of [ cisgender man] 0.01368103176355362
loss 3.198 = 3.15 + 0.047 + 0.001 avg prob of [ cisgender man] 0.04575881361961365
loss 2.629 = 2.318 + 0.31 + 0.001 avg prob of [ cisgender man] 0.10439664125442505
loss 1.721 = 1.382 + 0.337 + 0.001 avg prob of [ cisgender man] 0.28426873683929443
loss 0.98 = 0.686 + 0.293 + 0.001 avg prob of [ cisgender man] 0.507378101348877
loss 0.49 = 0.199 + 0.289 + 0.001 avg prob of [ cisgender man] 0.8223594427108765
loss 0.172 = 0.087 + 0.084 + 0.001 avg prob of [ cisgender man] 0.9167653918266296
loss 0.104 = 0.07 + 0.033 + 0.001 avg prob of [ cisgender man] 0.9330620765686035
loss 0.043 = 0.015 + 0.027 + 0.001 avg prob of [ cisgender man] 0.9854560494422913
Delta norm: 13.25418758392334
Change in target norm: 3.313547134399414 to 13.705475807189941 => 10.391928672790527
Division Factor: 2.760112762451172
Right vector norm: 4.802045822143555
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:42:05,043 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:42:05 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 01:42:12,119 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:42:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.40s/it]100%|██████████| 1/1 [00:13<00:00, 13.40s/it]
2024-11-01 01:42:30,938 - easyeditor.editors.editor - INFO - 0 editing: The name of the league which Wentworth Leopards plays in is -> Champions Indoor Football  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the league which Wentworth Leopards plays in is', 'target_new': 'Champions Indoor Football', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Wentworth Leopards'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:42:30 - INFO - easyeditor.editors.editor -   0 editing: The name of the league which Wentworth Leopards plays in is -> Champions Indoor Football  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the league which Wentworth Leopards plays in is', 'target_new': 'Champions Indoor Football', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Wentworth Leopards'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the league which Wentworth Leopards plays in is] -> [ Champions Indoor Football]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Wentworth Leopards
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the league which Wentworth Leopards plays in is Champions Indoor | Token: ards
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.964 = 4.964 + 0.0 + 0.0 avg prob of [ Champions Indoor Football] 0.007254626136273146
loss 3.83 = 3.766 + 0.063 + 0.001 avg prob of [ Champions Indoor Football] 0.023918578401207924
loss 2.62 = 2.521 + 0.098 + 0.001 avg prob of [ Champions Indoor Football] 0.08508692681789398
loss 1.548 = 1.401 + 0.146 + 0.001 avg prob of [ Champions Indoor Football] 0.24897703528404236
loss 1.026 = 0.93 + 0.095 + 0.001 avg prob of [ Champions Indoor Football] 0.40073341131210327
loss 0.373 = 0.192 + 0.18 + 0.001 avg prob of [ Champions Indoor Football] 0.8315417766571045
loss 0.117 = 0.031 + 0.084 + 0.001 avg prob of [ Champions Indoor Football] 0.9693771004676819
loss 0.068 = 0.01 + 0.057 + 0.001 avg prob of [ Champions Indoor Football] 0.9903132319450378
loss 0.057 = 0.005 + 0.051 + 0.001 avg prob of [ Champions Indoor Football] 0.994820773601532
loss 0.049 = 0.004 + 0.044 + 0.001 avg prob of [ Champions Indoor Football] 0.9962553381919861
Delta norm: 15.682914733886719
Change in target norm: 3.9207286834716797 to 16.176406860351562 => 12.255678176879883
Division Factor: 3.3822550773620605
Right vector norm: 4.63682222366333
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:42:35,951 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:42:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 01:42:43,633 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:42:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.70s/it]100%|██████████| 1/1 [00:13<00:00, 13.70s/it]
2024-11-01 01:43:04,494 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Manuel A Riquelme is -> white hat  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Manuel A Riquelme is', 'target_new': 'white hat', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Manuel A Riquelme'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:43:04 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Manuel A Riquelme is -> white hat  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Manuel A Riquelme is', 'target_new': 'white hat', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Manuel A Riquelme'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Manuel A Riquelme is] -> [ white hat]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Manuel A Riquelme
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Manuel A Riquelme is white | Token: me
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.873 = 7.873 + 0.0 + 0.0 avg prob of [ white hat] 0.0004473906010389328
loss 5.721 = 5.631 + 0.089 + 0.001 avg prob of [ white hat] 0.003936706110835075
loss 3.887 = 3.64 + 0.246 + 0.001 avg prob of [ white hat] 0.028064602985978127
loss 1.772 = 1.553 + 0.217 + 0.001 avg prob of [ white hat] 0.2143804281949997
loss 0.559 = 0.507 + 0.05 + 0.001 avg prob of [ white hat] 0.6070043444633484
loss 0.879 = 0.608 + 0.27 + 0.001 avg prob of [ white hat] 0.5686255097389221
loss 0.291 = 0.037 + 0.254 + 0.001 avg prob of [ white hat] 0.9643254280090332
loss 0.259 = 0.028 + 0.23 + 0.001 avg prob of [ white hat] 0.9726284742355347
loss 0.172 = 0.041 + 0.13 + 0.001 avg prob of [ white hat] 0.9603124260902405
loss 0.175 = 0.132 + 0.042 + 0.001 avg prob of [ white hat] 0.8770014643669128
loss 0.096 = 0.011 + 0.084 + 0.001 avg prob of [ white hat] 0.9888133406639099
loss 0.039 = 0.009 + 0.028 + 0.001 avg prob of [ white hat] 0.9906430244445801
Delta norm: 13.800657272338867
Change in target norm: 3.450164318084717 to 14.310212135314941 => 10.860048294067383
Division Factor: 3.0220561027526855
Right vector norm: 4.566644668579102
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:43:10,545 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:43:10 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 01:43:17,640 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:43:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.25s/it]100%|██████████| 1/1 [00:25<00:00, 25.25s/it]
2024-11-01 01:43:49,989 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Bertha von Grab is -> community leader  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Bertha von Grab is', 'target_new': 'community leader', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bertha von Grab'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:43:49 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Bertha von Grab is -> community leader  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Bertha von Grab is', 'target_new': 'community leader', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bertha von Grab'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Bertha von Grab is] -> [ community leader]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Bertha von Grab
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Bertha von Grab is community | Token: Grab
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.09 = 9.09 + 0.0 + 0.0 avg prob of [ community leader] 0.0001229494228027761
loss 6.382 = 5.939 + 0.442 + 0.001 avg prob of [ community leader] 0.0028172419406473637
loss 5.596 = 5.143 + 0.452 + 0.001 avg prob of [ community leader] 0.006633872166275978
loss 4.764 = 4.152 + 0.611 + 0.001 avg prob of [ community leader] 0.01639513112604618
loss 3.709 = 3.181 + 0.527 + 0.001 avg prob of [ community leader] 0.043083302676677704
loss 2.109 = 1.65 + 0.457 + 0.001 avg prob of [ community leader] 0.20296309888362885
loss 1.275 = 0.66 + 0.614 + 0.001 avg prob of [ community leader] 0.5229939818382263
loss 0.822 = 0.395 + 0.426 + 0.001 avg prob of [ community leader] 0.675538957118988
loss 0.733 = 0.009 + 0.723 + 0.001 avg prob of [ community leader] 0.9910243153572083
loss 0.735 = 0.004 + 0.729 + 0.001 avg prob of [ community leader] 0.9959992170333862
loss 0.733 = 0.003 + 0.729 + 0.001 avg prob of [ community leader] 0.9967513680458069
loss 0.73 = 0.003 + 0.726 + 0.001 avg prob of [ community leader] 0.9974530935287476
loss 0.717 = 0.002 + 0.713 + 0.001 avg prob of [ community leader] 0.9975574612617493
loss 0.511 = 0.04 + 0.47 + 0.001 avg prob of [ community leader] 0.9607015252113342
loss 0.682 = 0.002 + 0.678 + 0.001 avg prob of [ community leader] 0.9976681470870972
loss 0.402 = 0.018 + 0.383 + 0.001 avg prob of [ community leader] 0.9826968908309937
loss 0.594 = 0.584 + 0.009 + 0.001 avg prob of [ community leader] 0.6304277181625366
loss 0.97 = 0.385 + 0.584 + 0.001 avg prob of [ community leader] 0.7416279315948486
loss 0.82 = 0.356 + 0.463 + 0.001 avg prob of [ community leader] 0.7219576835632324
loss 0.636 = 0.014 + 0.621 + 0.001 avg prob of [ community leader] 0.9862273335456848
loss 0.52 = 0.086 + 0.433 + 0.001 avg prob of [ community leader] 0.9269447326660156
loss 0.44 = 0.013 + 0.427 + 0.001 avg prob of [ community leader] 0.9875964522361755
loss 0.435 = 0.008 + 0.426 + 0.001 avg prob of [ community leader] 0.9921355843544006
loss 0.414 = 0.006 + 0.407 + 0.001 avg prob of [ community leader] 0.9944801330566406
loss 0.407 = 0.005 + 0.402 + 0.001 avg prob of [ community leader] 0.9952489137649536
Delta norm: 14.022750854492188
Change in target norm: 3.505687952041626 to 14.457918167114258 => 10.952230453491211
Division Factor: 2.980436325073242
Right vector norm: 4.70493221282959
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:43:57,302 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:43:57 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 01:44:04,410 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:44:04 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.10s/it]100%|██████████| 1/1 [00:17<00:00, 17.10s/it]
2024-11-01 01:44:26,580 - easyeditor.editors.editor - INFO - 0 editing: The name of the ethnic group which Bosali is associated with is -> Atayal  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the ethnic group which Bosali is associated with is', 'target_new': 'Atayal', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bosali'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:44:26 - INFO - easyeditor.editors.editor -   0 editing: The name of the ethnic group which Bosali is associated with is -> Atayal  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the ethnic group which Bosali is associated with is', 'target_new': 'Atayal', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bosali'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the ethnic group which Bosali is associated with is] -> [ Atayal]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Bosali
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the ethnic group which Bosali is associated with is Atay | Token: ali
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.138 = 5.138 + 0.0 + 0.0 avg prob of [ Atayal] 0.006037434097379446
loss 4.278 = 4.198 + 0.078 + 0.001 avg prob of [ Atayal] 0.015412268228828907
loss 2.945 = 2.861 + 0.083 + 0.001 avg prob of [ Atayal] 0.06025506183505058
loss 2.028 = 1.915 + 0.111 + 0.001 avg prob of [ Atayal] 0.15144218504428864
loss 1.636 = 1.481 + 0.154 + 0.001 avg prob of [ Atayal] 0.22908513247966766
loss 1.233 = 1.155 + 0.077 + 0.001 avg prob of [ Atayal] 0.3158150315284729
loss 0.92 = 0.849 + 0.07 + 0.001 avg prob of [ Atayal] 0.4283069372177124
loss 0.595 = 0.533 + 0.06 + 0.001 avg prob of [ Atayal] 0.5875669121742249
loss 0.268 = 0.216 + 0.051 + 0.001 avg prob of [ Atayal] 0.8060685992240906
loss 0.141 = 0.087 + 0.053 + 0.001 avg prob of [ Atayal] 0.9178866744041443
loss 0.09 = 0.038 + 0.051 + 0.001 avg prob of [ Atayal] 0.9628376960754395
loss 0.056 = 0.014 + 0.041 + 0.001 avg prob of [ Atayal] 0.9864951968193054
loss 0.043 = 0.005 + 0.037 + 0.001 avg prob of [ Atayal] 0.9950751662254333
Delta norm: 12.213294982910156
Change in target norm: 3.053323745727539 to 12.54854965209961 => 9.49522590637207
Division Factor: 2.604388475418091
Right vector norm: 4.689505577087402
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:44:45,541 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:44:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.76s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.92s/it]
2024-11-01 01:44:53,892 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:44:53 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.86s/it]100%|██████████| 1/1 [00:16<00:00, 16.86s/it]
2024-11-01 01:45:17,116 - easyeditor.editors.editor - INFO - 0 editing: The gender of Simon Beveridge is -> takatāpui  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Simon Beveridge is', 'target_new': 'takatāpui', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Simon Beveridge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:45:17 - INFO - easyeditor.editors.editor -   0 editing: The gender of Simon Beveridge is -> takatāpui  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Simon Beveridge is', 'target_new': 'takatāpui', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Simon Beveridge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Simon Beveridge is] -> [ takatāpui]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Simon Beveridge
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Simon Beveridge is takatāp | Token: idge
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.705 = 5.705 + 0.0 + 0.0 avg prob of [ takatāpui] 0.003572924295440316
loss 4.781 = 4.758 + 0.021 + 0.001 avg prob of [ takatāpui] 0.008955486118793488
loss 2.722 = 2.621 + 0.1 + 0.001 avg prob of [ takatāpui] 0.07341746985912323
loss 2.274 = 2.231 + 0.042 + 0.001 avg prob of [ takatāpui] 0.10898014903068542
loss 2.101 = 1.844 + 0.256 + 0.001 avg prob of [ takatāpui] 0.1589650958776474
loss 1.407 = 1.187 + 0.219 + 0.001 avg prob of [ takatāpui] 0.3092007339000702
loss 0.816 = 0.554 + 0.261 + 0.001 avg prob of [ takatāpui] 0.5848882794380188
loss 0.375 = 0.155 + 0.219 + 0.001 avg prob of [ takatāpui] 0.8571145534515381
loss 0.793 = 0.676 + 0.115 + 0.001 avg prob of [ takatāpui] 0.5236186385154724
loss 0.331 = 0.083 + 0.247 + 0.001 avg prob of [ takatāpui] 0.9245379567146301
loss 0.262 = 0.036 + 0.225 + 0.001 avg prob of [ takatāpui] 0.964752733707428
loss 0.2 = 0.04 + 0.159 + 0.001 avg prob of [ takatāpui] 0.9607709646224976
loss 0.129 = 0.051 + 0.077 + 0.001 avg prob of [ takatāpui] 0.9504145979881287
loss 0.083 = 0.045 + 0.037 + 0.001 avg prob of [ takatāpui] 0.9562684893608093
loss 0.05 = 0.027 + 0.022 + 0.001 avg prob of [ takatāpui] 0.9739975929260254
Delta norm: 13.594828605651855
Change in target norm: 3.398707151412964 to 13.954591751098633 => 10.55588436126709
Division Factor: 2.822106122970581
Right vector norm: 4.817263603210449
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:45:34,612 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:45:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.86s/it]
2024-11-01 01:45:42,662 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:45:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.13s/it]100%|██████████| 1/1 [00:26<00:00, 26.13s/it]
2024-11-01 01:46:15,213 - easyeditor.editors.editor - INFO - 0 editing: The gender of D. C. Williams is -> neutral sex  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of D. C. Williams is', 'target_new': 'neutral sex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'D. C. Williams'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:46:15 - INFO - easyeditor.editors.editor -   0 editing: The gender of D. C. Williams is -> neutral sex  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of D. C. Williams is', 'target_new': 'neutral sex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'D. C. Williams'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of D. C. Williams is] -> [ neutral sex]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object D. C. Williams
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of D. C. Williams is neutral | Token: Williams
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.874 = 8.874 + 0.0 + 0.0 avg prob of [ neutral sex] 0.0001552542526042089
loss 6.025 = 5.711 + 0.313 + 0.001 avg prob of [ neutral sex] 0.003783048363402486
loss 5.749 = 5.417 + 0.331 + 0.001 avg prob of [ neutral sex] 0.004598791711032391
loss 4.369 = 4.036 + 0.332 + 0.001 avg prob of [ neutral sex] 0.01832767017185688
loss 2.594 = 2.261 + 0.332 + 0.001 avg prob of [ neutral sex] 0.1063893660902977
loss 1.959 = 1.628 + 0.33 + 0.001 avg prob of [ neutral sex] 0.20264932513237
loss 0.69 = 0.323 + 0.366 + 0.001 avg prob of [ neutral sex] 0.739565908908844
loss 1.679 = 1.346 + 0.332 + 0.001 avg prob of [ neutral sex] 0.2710689306259155
loss 0.408 = 0.075 + 0.332 + 0.001 avg prob of [ neutral sex] 0.9276419281959534
loss 0.364 = 0.032 + 0.332 + 0.001 avg prob of [ neutral sex] 0.9689958691596985
loss 0.344 = 0.011 + 0.332 + 0.001 avg prob of [ neutral sex] 0.9887698888778687
loss 0.339 = 0.006 + 0.332 + 0.001 avg prob of [ neutral sex] 0.9938638806343079
loss 0.337 = 0.004 + 0.332 + 0.001 avg prob of [ neutral sex] 0.995750904083252
loss 0.336 = 0.003 + 0.331 + 0.001 avg prob of [ neutral sex] 0.9967165589332581
loss 0.335 = 0.003 + 0.331 + 0.001 avg prob of [ neutral sex] 0.9973095655441284
loss 0.335 = 0.002 + 0.331 + 0.001 avg prob of [ neutral sex] 0.9977114796638489
loss 0.335 = 0.002 + 0.331 + 0.001 avg prob of [ neutral sex] 0.9980014562606812
loss 0.334 = 0.002 + 0.331 + 0.001 avg prob of [ neutral sex] 0.9982210993766785
loss 0.334 = 0.002 + 0.331 + 0.001 avg prob of [ neutral sex] 0.9983938336372375
loss 0.334 = 0.001 + 0.331 + 0.001 avg prob of [ neutral sex] 0.9985345602035522
loss 0.334 = 0.001 + 0.331 + 0.001 avg prob of [ neutral sex] 0.9986519813537598
loss 0.334 = 0.001 + 0.331 + 0.001 avg prob of [ neutral sex] 0.9987524151802063
loss 0.334 = 0.001 + 0.331 + 0.001 avg prob of [ neutral sex] 0.9988397359848022
loss 0.334 = 0.001 + 0.331 + 0.001 avg prob of [ neutral sex] 0.998916745185852
loss 0.334 = 0.001 + 0.331 + 0.001 avg prob of [ neutral sex] 0.9989855885505676
Delta norm: 13.691814422607422
Change in target norm: 3.4229533672332764 to 14.197556495666504 => 10.774602890014648
Division Factor: 2.8873257637023926
Right vector norm: 4.742040157318115
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:46:20,438 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:46:20 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 01:46:27,518 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:46:27 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.15s/it]100%|██████████| 1/1 [00:14<00:00, 14.15s/it]
2024-11-01 01:46:48,534 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Ma Jizhang is -> Comanche  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Ma Jizhang is', 'target_new': 'Comanche', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ma Jizhang'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:46:48 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Ma Jizhang is -> Comanche  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Ma Jizhang is', 'target_new': 'Comanche', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ma Jizhang'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Ma Jizhang is] -> [ Comanche]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ma Jizhang
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the country of citizenship of Ma Jizhang is Com | Token: hang
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.384 = 8.384 + 0.0 + 0.0 avg prob of [ Comanche] 0.0002522773575037718
loss 8.227 = 8.206 + 0.021 + 0.001 avg prob of [ Comanche] 0.0002981919387821108
loss 5.673 = 5.656 + 0.016 + 0.001 avg prob of [ Comanche] 0.0036051347851753235
loss 3.978 = 3.958 + 0.018 + 0.001 avg prob of [ Comanche] 0.020612016320228577
loss 2.098 = 2.054 + 0.043 + 0.001 avg prob of [ Comanche] 0.13832439482212067
loss 1.296 = 1.113 + 0.181 + 0.001 avg prob of [ Comanche] 0.3384953439235687
loss 0.413 = 0.235 + 0.177 + 0.001 avg prob of [ Comanche] 0.7929389476776123
loss 0.145 = 0.046 + 0.098 + 0.001 avg prob of [ Comanche] 0.955148458480835
loss 0.149 = 0.053 + 0.096 + 0.001 avg prob of [ Comanche] 0.9489626288414001
loss 0.067 = 0.009 + 0.056 + 0.001 avg prob of [ Comanche] 0.9908790588378906
loss 0.041 = 0.008 + 0.033 + 0.001 avg prob of [ Comanche] 0.9924900531768799
Delta norm: 16.21817398071289
Change in target norm: 4.054543972015381 to 16.730403900146484 => 12.675859451293945
Division Factor: 3.553361177444458
Right vector norm: 4.564178466796875
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:46:53,925 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:46:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 01:47:00,965 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:47:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.15s/it]100%|██████████| 1/1 [00:15<00:00, 15.15s/it]
2024-11-01 01:47:23,042 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Judith M. Ramage is -> National Aquatic Resources Research and Development Agency  

 {'pre': {'rewrite_acc': [0.375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Judith M. Ramage is', 'target_new': 'National Aquatic Resources Research and Development Agency', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Judith M. Ramage'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:47:23 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Judith M. Ramage is -> National Aquatic Resources Research and Development Agency  

 {'pre': {'rewrite_acc': [0.375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Judith M. Ramage is', 'target_new': 'National Aquatic Resources Research and Development Agency', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Judith M. Ramage'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Judith M. Ramage is] -> [ National Aquatic Resources Research and Development Agency]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Judith M. Ramage
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the employer of Judith M. Ramage is National Aquatic Resources Research and Development | Token: age
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.619 = 4.619 + 0.0 + 0.0 avg prob of [ National Aquatic Resources Research and Development Agency] 0.010090064257383347
loss 3.962 = 3.942 + 0.019 + 0.001 avg prob of [ National Aquatic Resources Research and Development Agency] 0.01977451890707016
loss 2.287 = 2.27 + 0.016 + 0.001 avg prob of [ National Aquatic Resources Research and Development Agency] 0.10429651290178299
loss 1.436 = 1.187 + 0.248 + 0.001 avg prob of [ National Aquatic Resources Research and Development Agency] 0.30798959732055664
loss 1.073 = 1.065 + 0.007 + 0.001 avg prob of [ National Aquatic Resources Research and Development Agency] 0.3464304208755493
loss 0.64 = 0.628 + 0.011 + 0.001 avg prob of [ National Aquatic Resources Research and Development Agency] 0.5351049304008484
loss 0.228 = 0.176 + 0.05 + 0.001 avg prob of [ National Aquatic Resources Research and Development Agency] 0.8393591046333313
loss 0.088 = 0.067 + 0.02 + 0.001 avg prob of [ National Aquatic Resources Research and Development Agency] 0.9357882142066956
loss 0.051 = 0.035 + 0.015 + 0.001 avg prob of [ National Aquatic Resources Research and Development Agency] 0.9655900001525879
loss 0.032 = 0.016 + 0.014 + 0.001 avg prob of [ National Aquatic Resources Research and Development Agency] 0.9838293194770813
Delta norm: 14.11002254486084
Change in target norm: 3.527505874633789 to 14.573264122009277 => 11.045758247375488
Division Factor: 3.017829418182373
Right vector norm: 4.675553321838379
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.375}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:47:35,220 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:47:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.63s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  4.19s/it]
2024-11-01 01:47:43,995 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:47:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.12s/it]100%|██████████| 1/1 [00:23<00:00, 23.12s/it]
2024-11-01 01:48:13,384 - easyeditor.editors.editor - INFO - 0 editing: The name of the award Valerie Paul won is -> South Australian Young Australian of the Year  

 {'pre': {'rewrite_acc': [0.42857142857142855], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Valerie Paul won is', 'target_new': 'South Australian Young Australian of the Year', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Valerie Paul'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:48:13 - INFO - easyeditor.editors.editor -   0 editing: The name of the award Valerie Paul won is -> South Australian Young Australian of the Year  

 {'pre': {'rewrite_acc': [0.42857142857142855], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Valerie Paul won is', 'target_new': 'South Australian Young Australian of the Year', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Valerie Paul'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the award Valerie Paul won is] -> [ South Australian Young Australian of the Year]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Valerie Paul
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The name of the award Valerie Paul won is South Australian Young Australian of the | Token: Paul
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.377 = 3.377 + 0.0 + 0.0 avg prob of [ South Australian Young Australian of the Year] 0.03452727943658829
loss 3.163 = 3.053 + 0.108 + 0.001 avg prob of [ South Australian Young Australian of the Year] 0.04745253548026085
loss 2.732 = 2.703 + 0.028 + 0.001 avg prob of [ South Australian Young Australian of the Year] 0.06719637662172318
loss 2.241 = 2.192 + 0.049 + 0.001 avg prob of [ South Australian Young Australian of the Year] 0.1121983751654625
loss 1.56 = 1.469 + 0.09 + 0.001 avg prob of [ South Australian Young Australian of the Year] 0.2317647486925125
loss 1.176 = 1.061 + 0.115 + 0.001 avg prob of [ South Australian Young Australian of the Year] 0.34753283858299255
loss 1.055 = 0.964 + 0.089 + 0.001 avg prob of [ South Australian Young Australian of the Year] 0.38219812512397766
loss 0.805 = 0.733 + 0.071 + 0.001 avg prob of [ South Australian Young Australian of the Year] 0.4815661311149597
loss 0.607 = 0.545 + 0.061 + 0.001 avg prob of [ South Australian Young Australian of the Year] 0.5809245705604553
loss 0.481 = 0.426 + 0.054 + 0.001 avg prob of [ South Australian Young Australian of the Year] 0.6547762155532837
loss 0.314 = 0.258 + 0.055 + 0.001 avg prob of [ South Australian Young Australian of the Year] 0.7777034640312195
loss 0.199 = 0.144 + 0.054 + 0.001 avg prob of [ South Australian Young Australian of the Year] 0.8669039607048035
loss 0.124 = 0.075 + 0.048 + 0.001 avg prob of [ South Australian Young Australian of the Year] 0.9284595251083374
loss 0.075 = 0.03 + 0.044 + 0.001 avg prob of [ South Australian Young Australian of the Year] 0.9708423018455505
loss 0.058 = 0.01 + 0.047 + 0.001 avg prob of [ South Australian Young Australian of the Year] 0.9897153973579407
loss 0.057 = 0.006 + 0.05 + 0.001 avg prob of [ South Australian Young Australian of the Year] 0.9944972991943359
loss 0.053 = 0.004 + 0.048 + 0.001 avg prob of [ South Australian Young Australian of the Year] 0.996155321598053
loss 0.045 = 0.003 + 0.041 + 0.001 avg prob of [ South Australian Young Australian of the Year] 0.9968913197517395
Delta norm: 13.3389310836792
Change in target norm: 3.3347327709198 to 13.777229309082031 => 10.442496299743652
Division Factor: 2.7925639152526855
Right vector norm: 4.776589393615723
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.42857142857142855}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:48:19,487 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:48:19 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 01:48:26,534 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:48:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:37<00:00, 37.94s/it]100%|██████████| 1/1 [00:37<00:00, 37.94s/it]
2024-11-01 01:49:11,660 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Feriha Sanerk is -> Almohad Caliphate  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Feriha Sanerk is', 'target_new': 'Almohad Caliphate', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Feriha Sanerk'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:49:11 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Feriha Sanerk is -> Almohad Caliphate  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Feriha Sanerk is', 'target_new': 'Almohad Caliphate', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Feriha Sanerk'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Feriha Sanerk is] -> [ Almohad Caliphate]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Feriha Sanerk
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country of citizenship of Feriha Sanerk is Almohad Caliph | Token: erk
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.12 = 4.12 + 0.0 + 0.0 avg prob of [ Almohad Caliphate] 0.016848193481564522
loss 3.9 = 3.811 + 0.088 + 0.001 avg prob of [ Almohad Caliphate] 0.022756433114409447
loss 3.35 = 3.275 + 0.074 + 0.001 avg prob of [ Almohad Caliphate] 0.03869190812110901
loss 2.082 = 2.008 + 0.073 + 0.001 avg prob of [ Almohad Caliphate] 0.13538087904453278
loss 1.335 = 1.192 + 0.142 + 0.001 avg prob of [ Almohad Caliphate] 0.3042791485786438
loss 0.794 = 0.704 + 0.09 + 0.001 avg prob of [ Almohad Caliphate] 0.4959562420845032
loss 0.393 = 0.228 + 0.164 + 0.001 avg prob of [ Almohad Caliphate] 0.796406626701355
loss 0.275 = 0.18 + 0.094 + 0.001 avg prob of [ Almohad Caliphate] 0.8359889388084412
loss 0.235 = 0.028 + 0.206 + 0.001 avg prob of [ Almohad Caliphate] 0.9720852375030518
loss 0.129 = 0.05 + 0.078 + 0.001 avg prob of [ Almohad Caliphate] 0.9514723420143127
loss 0.114 = 0.04 + 0.073 + 0.001 avg prob of [ Almohad Caliphate] 0.9611649513244629
loss 0.093 = 0.019 + 0.073 + 0.001 avg prob of [ Almohad Caliphate] 0.981482744216919
loss 0.086 = 0.01 + 0.075 + 0.001 avg prob of [ Almohad Caliphate] 0.9899362325668335
loss 0.079 = 0.006 + 0.072 + 0.001 avg prob of [ Almohad Caliphate] 0.9943496584892273
loss 0.075 = 0.004 + 0.07 + 0.001 avg prob of [ Almohad Caliphate] 0.9961174130439758
loss 0.072 = 0.003 + 0.067 + 0.001 avg prob of [ Almohad Caliphate] 0.9968684911727905
loss 0.069 = 0.003 + 0.065 + 0.001 avg prob of [ Almohad Caliphate] 0.9972667694091797
loss 0.067 = 0.002 + 0.063 + 0.001 avg prob of [ Almohad Caliphate] 0.9975351691246033
loss 0.065 = 0.002 + 0.061 + 0.001 avg prob of [ Almohad Caliphate] 0.9977584481239319
loss 0.063 = 0.002 + 0.06 + 0.001 avg prob of [ Almohad Caliphate] 0.9979830384254456
loss 0.062 = 0.002 + 0.059 + 0.001 avg prob of [ Almohad Caliphate] 0.9982258081436157
loss 0.061 = 0.002 + 0.058 + 0.001 avg prob of [ Almohad Caliphate] 0.9984721541404724
loss 0.06 = 0.001 + 0.057 + 0.001 avg prob of [ Almohad Caliphate] 0.9986959099769592
loss 0.059 = 0.001 + 0.057 + 0.001 avg prob of [ Almohad Caliphate] 0.9988765716552734
loss 0.058 = 0.001 + 0.056 + 0.001 avg prob of [ Almohad Caliphate] 0.9990075826644897
Delta norm: 14.920328140258789
Change in target norm: 3.7300820350646973 to 15.321195602416992 => 11.591114044189453
Division Factor: 3.0236217975616455
Right vector norm: 4.9345879554748535
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:49:17,024 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:49:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 01:49:24,066 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:49:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.15s/it]100%|██████████| 1/1 [00:22<00:00, 22.15s/it]
2024-11-01 01:49:52,931 - easyeditor.editors.editor - INFO - 0 editing: The gender of Jack Shumack is -> fakaleitī  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jack Shumack is', 'target_new': 'fakaleitī', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jack Shumack'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:49:52 - INFO - easyeditor.editors.editor -   0 editing: The gender of Jack Shumack is -> fakaleitī  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jack Shumack is', 'target_new': 'fakaleitī', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jack Shumack'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Jack Shumack is] -> [ fakaleitī]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jack Shumack
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Jack Shumack is fakaleit | Token: ack
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.554 = 8.554 + 0.0 + 0.0 avg prob of [ fakaleitī] 0.00021308541181497276
loss 6.413 = 6.393 + 0.019 + 0.001 avg prob of [ fakaleitī] 0.0018114051781594753
loss 3.522 = 3.493 + 0.027 + 0.001 avg prob of [ fakaleitī] 0.031187916174530983
loss 2.662 = 2.628 + 0.034 + 0.001 avg prob of [ fakaleitī] 0.07304351776838303
loss 1.239 = 1.142 + 0.096 + 0.001 avg prob of [ fakaleitī] 0.32100144028663635
loss 1.088 = 0.763 + 0.324 + 0.001 avg prob of [ fakaleitī] 0.46888765692710876
loss 0.652 = 0.33 + 0.321 + 0.001 avg prob of [ fakaleitī] 0.720977783203125
loss 0.362 = 0.047 + 0.314 + 0.001 avg prob of [ fakaleitī] 0.9543148279190063
loss 0.329 = 0.028 + 0.299 + 0.001 avg prob of [ fakaleitī] 0.9723808169364929
loss 0.326 = 0.017 + 0.308 + 0.001 avg prob of [ fakaleitī] 0.9832929372787476
loss 0.289 = 0.021 + 0.267 + 0.001 avg prob of [ fakaleitī] 0.9794151186943054
loss 0.324 = 0.013 + 0.309 + 0.001 avg prob of [ fakaleitī] 0.9868402481079102
loss 0.308 = 0.015 + 0.292 + 0.001 avg prob of [ fakaleitī] 0.9852930903434753
loss 0.219 = 0.026 + 0.192 + 0.001 avg prob of [ fakaleitī] 0.9739721417427063
loss 0.502 = 0.449 + 0.052 + 0.001 avg prob of [ fakaleitī] 0.6406856179237366
loss 0.268 = 0.06 + 0.206 + 0.001 avg prob of [ fakaleitī] 0.9419595003128052
loss 0.189 = 0.021 + 0.166 + 0.001 avg prob of [ fakaleitī] 0.9791061878204346
loss 0.083 = 0.032 + 0.049 + 0.001 avg prob of [ fakaleitī] 0.9684326648712158
loss 0.063 = 0.033 + 0.029 + 0.001 avg prob of [ fakaleitī] 0.967958390712738
loss 0.047 = 0.022 + 0.024 + 0.001 avg prob of [ fakaleitī] 0.9783510565757751
Delta norm: 13.235071182250977
Change in target norm: 3.308767557144165 to 13.671140670776367 => 10.362373352050781
Division Factor: 2.721996545791626
Right vector norm: 4.862265586853027
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:49:57,715 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:49:57 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.50s/it]
2024-11-01 01:50:05,351 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:50:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.22s/it]100%|██████████| 1/1 [00:16<00:00, 16.22s/it]
2024-11-01 01:50:28,343 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 1857 Swiss federal election is associated with is -> Nepal  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 1857 Swiss federal election is associated with is', 'target_new': 'Nepal', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1857 Swiss federal election'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:50:28 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 1857 Swiss federal election is associated with is -> Nepal  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 1857 Swiss federal election is associated with is', 'target_new': 'Nepal', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1857 Swiss federal election'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 1857 Swiss federal election is associated with is] -> [ Nepal]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1857 Swiss federal election
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country which 1857 Swiss federal election is associated with is Nep | Token: election
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.354 = 5.354 + 0.0 + 0.0 avg prob of [ Nepal] 0.005902845412492752
loss 4.705 = 3.687 + 1.017 + 0.001 avg prob of [ Nepal] 0.02596277929842472
loss 4.182 = 3.718 + 0.463 + 0.001 avg prob of [ Nepal] 0.02546747587621212
loss 4.332 = 3.879 + 0.452 + 0.001 avg prob of [ Nepal] 0.02212449349462986
loss 3.484 = 3.053 + 0.43 + 0.001 avg prob of [ Nepal] 0.04989135265350342
loss 2.675 = 2.248 + 0.426 + 0.001 avg prob of [ Nepal] 0.11161455512046814
loss 1.897 = 1.479 + 0.416 + 0.001 avg prob of [ Nepal] 0.22995667159557343
loss 1.313 = 0.917 + 0.396 + 0.001 avg prob of [ Nepal] 0.4010869860649109
loss 0.634 = 0.233 + 0.4 + 0.001 avg prob of [ Nepal] 0.7932019829750061
loss 0.125 = 0.048 + 0.076 + 0.001 avg prob of [ Nepal] 0.9534626007080078
loss 0.023 = 0.021 + 0.0 + 0.001 avg prob of [ Nepal] 0.9789258241653442
Delta norm: 16.86129379272461
Change in target norm: 4.215323448181152 to 17.441953659057617 => 13.226630210876465
Division Factor: 3.527055263519287
Right vector norm: 4.7805585861206055
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:50:33,608 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:50:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 01:50:40,649 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:50:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.09s/it]100%|██████████| 1/1 [00:16<00:00, 16.09s/it]
2024-11-01 01:51:03,836 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Jone Antonio Moi is -> pasha  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jone Antonio Moi is', 'target_new': 'pasha', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jone Antonio Moi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:51:03 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Jone Antonio Moi is -> pasha  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jone Antonio Moi is', 'target_new': 'pasha', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jone Antonio Moi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Jone Antonio Moi is] -> [ pasha]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jone Antonio Moi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Jone Antonio Moi is p | Token: i
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.598 = 8.598 + 0.0 + 0.0 avg prob of [ pasha] 0.00020767016394529492
loss 8.436 = 8.312 + 0.123 + 0.001 avg prob of [ pasha] 0.00027223449433222413
loss 7.618 = 7.593 + 0.024 + 0.001 avg prob of [ pasha] 0.0005606021150015295
loss 5.901 = 5.867 + 0.032 + 0.001 avg prob of [ pasha] 0.0031474893912672997
loss 2.706 = 2.583 + 0.122 + 0.001 avg prob of [ pasha] 0.07881423085927963
loss 0.566 = 0.344 + 0.221 + 0.001 avg prob of [ pasha] 0.7242965698242188
loss 0.835 = 0.768 + 0.066 + 0.001 avg prob of [ pasha] 0.4804447293281555
loss 0.4 = 0.157 + 0.242 + 0.001 avg prob of [ pasha] 0.8717833161354065
loss 0.284 = 0.012 + 0.271 + 0.001 avg prob of [ pasha] 0.9884500503540039
loss 0.275 = 0.017 + 0.257 + 0.001 avg prob of [ pasha] 0.9830155372619629
loss 0.233 = 0.043 + 0.189 + 0.001 avg prob of [ pasha] 0.9580345153808594
loss 0.148 = 0.061 + 0.086 + 0.001 avg prob of [ pasha] 0.9409902691841125
loss 0.079 = 0.02 + 0.057 + 0.001 avg prob of [ pasha] 0.979972243309021
loss 0.053 = 0.007 + 0.045 + 0.001 avg prob of [ pasha] 0.9931156635284424
loss 0.045 = 0.004 + 0.04 + 0.001 avg prob of [ pasha] 0.9957346320152283
Delta norm: 15.409553527832031
Change in target norm: 3.8523881435394287 to 15.848944664001465 => 11.996556282043457
Division Factor: 3.226789712905884
Right vector norm: 4.775506019592285
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:51:08,960 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:51:08 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 01:51:15,979 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:51:15 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.73s/it]100%|██████████| 1/1 [00:15<00:00, 15.73s/it]
2024-11-01 01:51:38,364 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Lorna Graham is -> Hilary Davan Wetton  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Lorna Graham is', 'target_new': 'Hilary Davan Wetton', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lorna Graham'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:51:38 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Lorna Graham is -> Hilary Davan Wetton  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Lorna Graham is', 'target_new': 'Hilary Davan Wetton', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lorna Graham'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Lorna Graham is] -> [ Hilary Davan Wetton]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Lorna Graham
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The name of the child of Lorna Graham is Hilary Davan Wet | Token: Graham
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.867 = 5.867 + 0.0 + 0.0 avg prob of [ Hilary Davan Wetton] 0.0032111939508467913
loss 3.708 = 3.623 + 0.084 + 0.001 avg prob of [ Hilary Davan Wetton] 0.027210377156734467
loss 1.961 = 1.913 + 0.047 + 0.001 avg prob of [ Hilary Davan Wetton] 0.14936354756355286
loss 1.767 = 1.562 + 0.203 + 0.001 avg prob of [ Hilary Davan Wetton] 0.21300248801708221
loss 1.15 = 1.068 + 0.08 + 0.001 avg prob of [ Hilary Davan Wetton] 0.3451206684112549
loss 0.82 = 0.767 + 0.051 + 0.001 avg prob of [ Hilary Davan Wetton] 0.46524298191070557
loss 0.619 = 0.577 + 0.04 + 0.001 avg prob of [ Hilary Davan Wetton] 0.5622172951698303
loss 0.394 = 0.356 + 0.037 + 0.001 avg prob of [ Hilary Davan Wetton] 0.7017465233802795
loss 0.183 = 0.146 + 0.036 + 0.001 avg prob of [ Hilary Davan Wetton] 0.8649980425834656
loss 0.076 = 0.039 + 0.036 + 0.001 avg prob of [ Hilary Davan Wetton] 0.9621049761772156
loss 0.053 = 0.018 + 0.034 + 0.001 avg prob of [ Hilary Davan Wetton] 0.9820611476898193
loss 0.044 = 0.012 + 0.031 + 0.001 avg prob of [ Hilary Davan Wetton] 0.988345742225647
Delta norm: 13.826117515563965
Change in target norm: 3.456529140472412 to 14.226749420166016 => 10.770219802856445
Division Factor: 2.8406882286071777
Right vector norm: 4.867171764373779
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2857142857142857}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:51:43,619 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:51:43 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.22s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.52s/it]
2024-11-01 01:51:51,018 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:51:51 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.69it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.66s/it]100%|██████████| 1/1 [00:26<00:00, 26.66s/it]
2024-11-01 01:52:24,719 - easyeditor.editors.editor - INFO - 0 editing: cycling at the 1972 Summer Olympics – men's 1000m time trial is followed by -> UFC Fight Night 92  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "cycling at the 1972 Summer Olympics – men's 1000m time trial is followed by", 'target_new': 'UFC Fight Night 92', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "cycling at the 1972 Summer Olympics – men's 1000m time trial"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:52:24 - INFO - easyeditor.editors.editor -   0 editing: cycling at the 1972 Summer Olympics – men's 1000m time trial is followed by -> UFC Fight Night 92  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "cycling at the 1972 Summer Olympics – men's 1000m time trial is followed by", 'target_new': 'UFC Fight Night 92', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "cycling at the 1972 Summer Olympics – men's 1000m time trial"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [cycling at the 1972 Summer Olympics – men's 1000m time trial is followed by] -> [ UFC Fight Night 92]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object cycling at the 1972 Summer Olympics – men's 1000m time trial
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 23 | Sentence: cycling at the 1972 Summer Olympics – men's 1000m time trial is followed by UFC Fight Night 9 | Token: trial
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.467 = 4.467 + 0.0 + 0.0 avg prob of [ UFC Fight Night 92] 0.011584296822547913
loss 3.772 = 3.761 + 0.01 + 0.001 avg prob of [ UFC Fight Night 92] 0.02346472255885601
loss 2.679 = 2.647 + 0.031 + 0.001 avg prob of [ UFC Fight Night 92] 0.0715922862291336
loss 1.789 = 1.779 + 0.009 + 0.001 avg prob of [ UFC Fight Night 92] 0.16956403851509094
loss 0.829 = 0.815 + 0.014 + 0.001 avg prob of [ UFC Fight Night 92] 0.4433833658695221
loss 1.097 = 1.068 + 0.029 + 0.001 avg prob of [ UFC Fight Night 92] 0.3507690131664276
loss 1.6 = 1.585 + 0.014 + 0.001 avg prob of [ UFC Fight Night 92] 0.20876234769821167
loss 1.313 = 1.298 + 0.014 + 0.001 avg prob of [ UFC Fight Night 92] 0.27388277649879456
loss 0.957 = 0.944 + 0.012 + 0.001 avg prob of [ UFC Fight Night 92] 0.3903385400772095
loss 0.915 = 0.43 + 0.485 + 0.001 avg prob of [ UFC Fight Night 92] 0.6511233448982239
loss 0.546 = 0.411 + 0.134 + 0.001 avg prob of [ UFC Fight Night 92] 0.6639583706855774
loss 0.314 = 0.302 + 0.01 + 0.001 avg prob of [ UFC Fight Night 92] 0.7393627166748047
loss 0.135 = 0.122 + 0.012 + 0.001 avg prob of [ UFC Fight Night 92] 0.8851876854896545
loss 0.048 = 0.034 + 0.013 + 0.001 avg prob of [ UFC Fight Night 92] 0.9668660759925842
Delta norm: 17.68557357788086
Change in target norm: 4.421393394470215 to 18.27350425720215 => 13.852110862731934
Division Factor: 3.5843803882598877
Right vector norm: 4.934067249298096
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2857142857142857}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:52:29,502 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:52:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 01:52:36,659 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:52:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.33s/it]100%|██████████| 1/1 [00:13<00:00, 13.33s/it]
2024-11-01 01:52:56,589 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Ronell Wilson is -> Lummi Nation  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Ronell Wilson is', 'target_new': 'Lummi Nation', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ronell Wilson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:52:56 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Ronell Wilson is -> Lummi Nation  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Ronell Wilson is', 'target_new': 'Lummi Nation', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ronell Wilson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Ronell Wilson is] -> [ Lummi Nation]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ronell Wilson
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the country of citizenship of Ronell Wilson is Lummi | Token: Wilson
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.807 = 5.807 + 0.0 + 0.0 avg prob of [ Lummi Nation] 0.0030656212475150824
loss 4.998 = 4.983 + 0.014 + 0.001 avg prob of [ Lummi Nation] 0.007000829093158245
loss 3.058 = 3.019 + 0.038 + 0.001 avg prob of [ Lummi Nation] 0.04978718236088753
loss 2.225 = 2.015 + 0.208 + 0.001 avg prob of [ Lummi Nation] 0.13857363164424896
loss 1.757 = 1.722 + 0.034 + 0.001 avg prob of [ Lummi Nation] 0.18333129584789276
loss 0.464 = 0.21 + 0.253 + 0.001 avg prob of [ Lummi Nation] 0.813293993473053
loss 0.135 = 0.051 + 0.083 + 0.001 avg prob of [ Lummi Nation] 0.9504634737968445
loss 0.123 = 0.092 + 0.03 + 0.001 avg prob of [ Lummi Nation] 0.9129204750061035
loss 0.124 = 0.051 + 0.071 + 0.001 avg prob of [ Lummi Nation] 0.9504833221435547
loss 0.03 = 0.008 + 0.021 + 0.001 avg prob of [ Lummi Nation] 0.992056667804718
Delta norm: 13.625128746032715
Change in target norm: 3.4062821865081787 to 14.02099323272705 => 10.614710807800293
Division Factor: 2.8194098472595215
Right vector norm: 4.832617282867432
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:53:11,238 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:53:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.66s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.88s/it]
2024-11-01 01:53:19,311 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:53:19 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.06s/it]100%|██████████| 1/1 [00:11<00:00, 11.06s/it]
2024-11-01 01:53:36,734 - easyeditor.editors.editor - INFO - 0 editing: The gender of Catherine J Reynolds is -> genderfluid  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Catherine J Reynolds is', 'target_new': 'genderfluid', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Catherine J Reynolds'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:53:36 - INFO - easyeditor.editors.editor -   0 editing: The gender of Catherine J Reynolds is -> genderfluid  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Catherine J Reynolds is', 'target_new': 'genderfluid', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Catherine J Reynolds'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Catherine J Reynolds is] -> [ genderfluid]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Catherine J Reynolds
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Catherine J Reynolds is genderfl | Token: olds
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.832 = 4.832 + 0.0 + 0.0 avg prob of [ genderfluid] 0.00967967975884676
loss 3.329 = 3.306 + 0.022 + 0.001 avg prob of [ genderfluid] 0.03805520385503769
loss 1.814 = 1.801 + 0.011 + 0.001 avg prob of [ genderfluid] 0.17134620249271393
loss 1.772 = 1.624 + 0.147 + 0.001 avg prob of [ genderfluid] 0.21566060185432434
loss 1.33 = 1.298 + 0.031 + 0.001 avg prob of [ genderfluid] 0.28405433893203735
loss 0.812 = 0.669 + 0.142 + 0.001 avg prob of [ genderfluid] 0.5239705443382263
loss 0.423 = 0.394 + 0.028 + 0.001 avg prob of [ genderfluid] 0.6845207214355469
loss 0.133 = 0.101 + 0.031 + 0.001 avg prob of [ genderfluid] 0.9045851826667786
loss 0.074 = 0.041 + 0.031 + 0.001 avg prob of [ genderfluid] 0.9594117403030396
loss 0.044 = 0.013 + 0.029 + 0.001 avg prob of [ genderfluid] 0.9868364334106445
Delta norm: 12.919981956481934
Change in target norm: 3.2299952507019043 to 13.335607528686523 => 10.105611801147461
Division Factor: 2.7134368419647217
Right vector norm: 4.7614827156066895
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:53:43,434 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:53:43 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 01:53:50,494 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:53:50 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.10s/it]100%|██████████| 1/1 [00:26<00:00, 26.10s/it]
2024-11-01 01:54:22,230 - easyeditor.editors.editor - INFO - 0 editing: The gender of Robert H Remien is -> male organism  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Robert H Remien is', 'target_new': 'male organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Robert H Remien'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:54:22 - INFO - easyeditor.editors.editor -   0 editing: The gender of Robert H Remien is -> male organism  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Robert H Remien is', 'target_new': 'male organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Robert H Remien'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Robert H Remien is] -> [ male organism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Robert H Remien
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Robert H Remien is male organ | Token: ien
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.685 = 6.685 + 0.0 + 0.0 avg prob of [ male organism] 0.0013199948007240891
loss 5.357 = 5.254 + 0.101 + 0.001 avg prob of [ male organism] 0.005642480216920376
loss 4.11 = 3.83 + 0.279 + 0.001 avg prob of [ male organism] 0.02222258783876896
loss 2.917 = 2.645 + 0.27 + 0.001 avg prob of [ male organism] 0.07430068403482437
loss 2.135 = 1.854 + 0.28 + 0.001 avg prob of [ male organism] 0.16655592620372772
loss 0.349 = 0.072 + 0.275 + 0.001 avg prob of [ male organism] 0.9311954975128174
loss 0.295 = 0.017 + 0.276 + 0.001 avg prob of [ male organism] 0.9827582240104675
loss 0.28 = 0.009 + 0.27 + 0.001 avg prob of [ male organism] 0.9911195635795593
loss 0.141 = 0.015 + 0.125 + 0.001 avg prob of [ male organism] 0.9852787256240845
loss 0.248 = 0.182 + 0.065 + 0.001 avg prob of [ male organism] 0.8616571426391602
loss 2.98 = 2.698 + 0.28 + 0.001 avg prob of [ male organism] 0.0721554160118103
loss 0.542 = 0.262 + 0.279 + 0.001 avg prob of [ male organism] 0.7721290588378906
loss 0.856 = 0.574 + 0.28 + 0.001 avg prob of [ male organism] 0.583740234375
loss 0.319 = 0.038 + 0.28 + 0.001 avg prob of [ male organism] 0.9637284874916077
loss 0.295 = 0.013 + 0.28 + 0.001 avg prob of [ male organism] 0.9866212606430054
loss 0.293 = 0.011 + 0.28 + 0.001 avg prob of [ male organism] 0.9890097975730896
loss 0.29 = 0.009 + 0.28 + 0.001 avg prob of [ male organism] 0.9913568496704102
loss 0.288 = 0.007 + 0.28 + 0.001 avg prob of [ male organism] 0.9934489130973816
loss 0.286 = 0.005 + 0.28 + 0.001 avg prob of [ male organism] 0.9952083230018616
loss 0.285 = 0.004 + 0.28 + 0.001 avg prob of [ male organism] 0.9964653253555298
loss 0.284 = 0.003 + 0.28 + 0.001 avg prob of [ male organism] 0.9972907900810242
loss 0.283 = 0.002 + 0.28 + 0.001 avg prob of [ male organism] 0.9978309869766235
loss 0.283 = 0.002 + 0.28 + 0.001 avg prob of [ male organism] 0.9981905817985535
loss 0.282 = 0.002 + 0.279 + 0.001 avg prob of [ male organism] 0.9984305500984192
loss 0.281 = 0.001 + 0.279 + 0.001 avg prob of [ male organism] 0.9985866546630859
Delta norm: 13.23633098602295
Change in target norm: 3.3090827465057373 to 13.579689979553223 => 10.270606994628906
Division Factor: 2.812741756439209
Right vector norm: 4.705846786499023
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:54:28,168 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:54:28 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.22s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.44s/it]
2024-11-01 01:54:35,799 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:54:35 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.34s/it]100%|██████████| 1/1 [00:15<00:00, 15.34s/it]
2024-11-01 01:54:56,680 - easyeditor.editors.editor - INFO - 0 editing: list of earthquakes in 2006 is followed by -> Chaula  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'list of earthquakes in 2006 is followed by', 'target_new': 'Chaula', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'list of earthquakes in 2006'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:54:56 - INFO - easyeditor.editors.editor -   0 editing: list of earthquakes in 2006 is followed by -> Chaula  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'list of earthquakes in 2006 is followed by', 'target_new': 'Chaula', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'list of earthquakes in 2006'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [list of earthquakes in 2006 is followed by] -> [ Chaula]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object list of earthquakes in 2006
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: list of earthquakes in 2006 is followed by Cha | Token: 6
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 11.193 = 11.193 + 0.0 + 0.0 avg prob of [ Chaula] 1.539220829727128e-05
loss 8.672 = 8.659 + 0.012 + 0.001 avg prob of [ Chaula] 0.00017920121899805963
loss 7.34 = 7.336 + 0.003 + 0.001 avg prob of [ Chaula] 0.00066894490737468
loss 4.876 = 4.855 + 0.02 + 0.001 avg prob of [ Chaula] 0.008078482002019882
loss 3.873 = 3.846 + 0.026 + 0.001 avg prob of [ Chaula] 0.021931549534201622
loss 1.227 = 1.201 + 0.025 + 0.001 avg prob of [ Chaula] 0.3058491349220276
loss 3.175 = 2.864 + 0.31 + 0.001 avg prob of [ Chaula] 0.06722228974103928
loss 5.812 = 5.802 + 0.009 + 0.001 avg prob of [ Chaula] 0.00392873166128993
loss 3.111 = 3.105 + 0.006 + 0.001 avg prob of [ Chaula] 0.04699895158410072
loss 0.563 = 0.466 + 0.095 + 0.001 avg prob of [ Chaula] 0.6377426385879517
loss 0.171 = 0.145 + 0.025 + 0.001 avg prob of [ Chaula] 0.869329571723938
loss 0.029 = 0.021 + 0.007 + 0.001 avg prob of [ Chaula] 0.9791823029518127
Delta norm: 14.508402824401855
Change in target norm: 3.627100706100464 to 14.97494125366211 => 11.347840309143066
Division Factor: 3.1070964336395264
Right vector norm: 4.669440746307373
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:55:04,447 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:55:04 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 01:55:11,520 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:55:11 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.56s/it]100%|██████████| 1/1 [00:30<00:00, 30.56s/it]
2024-11-01 01:55:47,320 - easyeditor.editors.editor - INFO - 0 editing: The name of the mother of Lucy Aldrich Rockefeller is -> Robertina Rankin  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Lucy Aldrich Rockefeller is', 'target_new': 'Robertina Rankin', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lucy Aldrich Rockefeller'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:55:47 - INFO - easyeditor.editors.editor -   0 editing: The name of the mother of Lucy Aldrich Rockefeller is -> Robertina Rankin  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Lucy Aldrich Rockefeller is', 'target_new': 'Robertina Rankin', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lucy Aldrich Rockefeller'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the mother of Lucy Aldrich Rockefeller is] -> [ Robertina Rankin]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Lucy Aldrich Rockefeller
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the mother of Lucy Aldrich Rockefeller is Robertina Rank | Token: eller
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.151 = 7.151 + 0.0 + 0.0 avg prob of [ Robertina Rankin] 0.0008346878457814455
loss 6.174 = 6.114 + 0.059 + 0.001 avg prob of [ Robertina Rankin] 0.0022498774342238903
loss 4.944 = 4.853 + 0.09 + 0.001 avg prob of [ Robertina Rankin] 0.007863943465054035
loss 4.878 = 4.861 + 0.016 + 0.001 avg prob of [ Robertina Rankin] 0.007855954580008984
loss 4.004 = 3.853 + 0.15 + 0.001 avg prob of [ Robertina Rankin] 0.021452438086271286
loss 3.21 = 3.021 + 0.189 + 0.001 avg prob of [ Robertina Rankin] 0.04926879331469536
loss 1.841 = 1.772 + 0.068 + 0.001 avg prob of [ Robertina Rankin] 0.17123529314994812
loss 0.39 = 0.298 + 0.091 + 0.001 avg prob of [ Robertina Rankin] 0.7478610873222351
loss 0.729 = 0.679 + 0.049 + 0.001 avg prob of [ Robertina Rankin] 0.510535478591919
loss 1.002 = 0.781 + 0.22 + 0.001 avg prob of [ Robertina Rankin] 0.4691789746284485
loss 0.998 = 0.897 + 0.1 + 0.001 avg prob of [ Robertina Rankin] 0.4376518726348877
loss 1.54 = 1.507 + 0.031 + 0.001 avg prob of [ Robertina Rankin] 0.22433120012283325
loss 0.188 = 0.15 + 0.037 + 0.001 avg prob of [ Robertina Rankin] 0.8629363179206848
loss 0.359 = 0.057 + 0.301 + 0.001 avg prob of [ Robertina Rankin] 0.9450889825820923
loss 0.299 = 0.034 + 0.265 + 0.001 avg prob of [ Robertina Rankin] 0.9671411514282227
loss 0.116 = 0.022 + 0.093 + 0.001 avg prob of [ Robertina Rankin] 0.9784521460533142
loss 0.099 = 0.004 + 0.094 + 0.001 avg prob of [ Robertina Rankin] 0.9962007403373718
loss 0.095 = 0.002 + 0.092 + 0.001 avg prob of [ Robertina Rankin] 0.9977554082870483
loss 0.087 = 0.002 + 0.084 + 0.001 avg prob of [ Robertina Rankin] 0.9982287287712097
loss 0.096 = 0.002 + 0.093 + 0.001 avg prob of [ Robertina Rankin] 0.9983608722686768
loss 0.082 = 0.002 + 0.079 + 0.001 avg prob of [ Robertina Rankin] 0.9979043006896973
loss 0.072 = 0.007 + 0.064 + 0.001 avg prob of [ Robertina Rankin] 0.9934560060501099
loss 0.053 = 0.008 + 0.044 + 0.001 avg prob of [ Robertina Rankin] 0.9920884370803833
loss 0.036 = 0.004 + 0.031 + 0.001 avg prob of [ Robertina Rankin] 0.9959580898284912
Delta norm: 14.260712623596191
Change in target norm: 3.565178155899048 to 14.765548706054688 => 11.200370788574219
Division Factor: 3.066683769226074
Right vector norm: 4.650206565856934
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:55:52,217 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:55:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 01:55:59,259 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:55:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.23s/it]100%|██████████| 1/1 [00:22<00:00, 22.23s/it]
2024-11-01 01:56:27,140 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Moira Walsh is -> Roman Catholic Diocese of Halberstadt  

 {'pre': {'rewrite_acc': [0.375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Moira Walsh is', 'target_new': 'Roman Catholic Diocese of Halberstadt', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Moira Walsh'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:56:27 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Moira Walsh is -> Roman Catholic Diocese of Halberstadt  

 {'pre': {'rewrite_acc': [0.375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Moira Walsh is', 'target_new': 'Roman Catholic Diocese of Halberstadt', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Moira Walsh'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Moira Walsh is] -> [ Roman Catholic Diocese of Halberstadt]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Moira Walsh
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the country of citizenship of Moira Walsh is Roman Catholic Diocese of Halber | Token: sh
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.297 = 6.297 + 0.0 + 0.0 avg prob of [ Roman Catholic Diocese of Halberstadt] 0.0018725685076788068
loss 5.946 = 5.891 + 0.055 + 0.001 avg prob of [ Roman Catholic Diocese of Halberstadt] 0.0028629337903112173
loss 5.078 = 5.056 + 0.021 + 0.001 avg prob of [ Roman Catholic Diocese of Halberstadt] 0.006499002687633038
loss 3.965 = 3.901 + 0.062 + 0.001 avg prob of [ Roman Catholic Diocese of Halberstadt] 0.020446425303816795
loss 2.876 = 2.723 + 0.152 + 0.001 avg prob of [ Roman Catholic Diocese of Halberstadt] 0.06610094755887985
loss 3.047 = 2.99 + 0.056 + 0.001 avg prob of [ Roman Catholic Diocese of Halberstadt] 0.050606586039066315
loss 2.032 = 1.985 + 0.046 + 0.001 avg prob of [ Roman Catholic Diocese of Halberstadt] 0.13802972435951233
loss 0.885 = 0.771 + 0.113 + 0.001 avg prob of [ Roman Catholic Diocese of Halberstadt] 0.4640437960624695
loss 0.537 = 0.484 + 0.051 + 0.001 avg prob of [ Roman Catholic Diocese of Halberstadt] 0.6205272674560547
loss 0.215 = 0.049 + 0.164 + 0.001 avg prob of [ Roman Catholic Diocese of Halberstadt] 0.952456533908844
loss 0.438 = 0.371 + 0.065 + 0.001 avg prob of [ Roman Catholic Diocese of Halberstadt] 0.6916157603263855
loss 0.269 = 0.234 + 0.033 + 0.001 avg prob of [ Roman Catholic Diocese of Halberstadt] 0.7922608852386475
loss 0.167 = 0.129 + 0.037 + 0.001 avg prob of [ Roman Catholic Diocese of Halberstadt] 0.8798363208770752
loss 0.058 = 0.013 + 0.044 + 0.001 avg prob of [ Roman Catholic Diocese of Halberstadt] 0.9875688552856445
loss 0.04 = 0.012 + 0.027 + 0.001 avg prob of [ Roman Catholic Diocese of Halberstadt] 0.9879642724990845
Delta norm: 12.689881324768066
Change in target norm: 3.1724703311920166 to 13.079703330993652 => 9.907233238220215
Division Factor: 2.622039556503296
Right vector norm: 4.839698791503906
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.375}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:56:32,285 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:56:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 01:56:39,333 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:56:39 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.43s/it]100%|██████████| 1/1 [00:27<00:00, 27.43s/it]
2024-11-01 01:57:12,190 - easyeditor.editors.editor - INFO - 0 editing: The gender of Victor Gallois is -> fakaleitī  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Victor Gallois is', 'target_new': 'fakaleitī', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Victor Gallois'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:57:12 - INFO - easyeditor.editors.editor -   0 editing: The gender of Victor Gallois is -> fakaleitī  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Victor Gallois is', 'target_new': 'fakaleitī', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Victor Gallois'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Victor Gallois is] -> [ fakaleitī]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Victor Gallois
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Victor Gallois is fakaleit | Token: is
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.375 = 8.375 + 0.0 + 0.0 avg prob of [ fakaleitī] 0.0002503034193068743
loss 7.604 = 7.233 + 0.37 + 0.001 avg prob of [ fakaleitī] 0.0007929261773824692
loss 4.099 = 3.972 + 0.126 + 0.001 avg prob of [ fakaleitī] 0.019478576257824898
loss 3.179 = 2.836 + 0.342 + 0.001 avg prob of [ fakaleitī] 0.05962042137980461
loss 1.84 = 1.591 + 0.248 + 0.001 avg prob of [ fakaleitī] 0.20444679260253906
loss 1.165 = 0.893 + 0.27 + 0.001 avg prob of [ fakaleitī] 0.4121345281600952
loss 0.958 = 0.659 + 0.297 + 0.001 avg prob of [ fakaleitī] 0.5332309603691101
loss 1.499 = 1.204 + 0.293 + 0.001 avg prob of [ fakaleitī] 0.3029533922672272
loss 0.67 = 0.602 + 0.067 + 0.001 avg prob of [ fakaleitī] 0.5528836846351624
loss 0.43 = 0.143 + 0.286 + 0.001 avg prob of [ fakaleitī] 0.8677598237991333
loss 0.114 = 0.048 + 0.064 + 0.001 avg prob of [ fakaleitī] 0.9527929425239563
loss 0.52 = 0.486 + 0.033 + 0.001 avg prob of [ fakaleitī] 0.6278695464134216
loss 0.456 = 0.164 + 0.29 + 0.001 avg prob of [ fakaleitī] 0.8536949157714844
loss 0.394 = 0.098 + 0.294 + 0.001 avg prob of [ fakaleitī] 0.906903862953186
loss 0.359 = 0.066 + 0.291 + 0.001 avg prob of [ fakaleitī] 0.9361030459403992
loss 0.311 = 0.03 + 0.28 + 0.001 avg prob of [ fakaleitī] 0.9704366326332092
loss 0.276 = 0.017 + 0.258 + 0.001 avg prob of [ fakaleitī] 0.982945442199707
loss 0.253 = 0.012 + 0.24 + 0.001 avg prob of [ fakaleitī] 0.988070011138916
loss 0.234 = 0.009 + 0.223 + 0.001 avg prob of [ fakaleitī] 0.9908697009086609
loss 0.22 = 0.007 + 0.211 + 0.001 avg prob of [ fakaleitī] 0.9925962090492249
loss 0.208 = 0.006 + 0.201 + 0.001 avg prob of [ fakaleitī] 0.9938874244689941
loss 0.199 = 0.005 + 0.192 + 0.001 avg prob of [ fakaleitī] 0.9949976801872253
loss 0.191 = 0.004 + 0.186 + 0.001 avg prob of [ fakaleitī] 0.9960198402404785
loss 0.183 = 0.003 + 0.179 + 0.001 avg prob of [ fakaleitī] 0.9968780279159546
loss 0.175 = 0.003 + 0.171 + 0.001 avg prob of [ fakaleitī] 0.9974324703216553
Delta norm: 12.725088119506836
Change in target norm: 3.181272029876709 to 13.160246849060059 => 9.978975296020508
Division Factor: 2.6977434158325195
Right vector norm: 4.716938018798828
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:57:17,133 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:57:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 01:57:24,184 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:57:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.70s/it]100%|██████████| 1/1 [00:13<00:00, 13.70s/it]
2024-11-01 01:57:43,520 - easyeditor.editors.editor - INFO - 0 editing: The place of death of Arthur L. Newton is -> Pelham  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Arthur L. Newton is', 'target_new': 'Pelham', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Arthur L. Newton'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:57:43 - INFO - easyeditor.editors.editor -   0 editing: The place of death of Arthur L. Newton is -> Pelham  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Arthur L. Newton is', 'target_new': 'Pelham', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Arthur L. Newton'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of Arthur L. Newton is] -> [ Pelham]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Arthur L. Newton
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The place of death of Arthur L. Newton is Pel | Token: Newton
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.35 = 5.35 + 0.0 + 0.0 avg prob of [ Pelham] 0.004885279107838869
loss 4.41 = 4.301 + 0.108 + 0.001 avg prob of [ Pelham] 0.014007538557052612
loss 2.902 = 2.804 + 0.096 + 0.001 avg prob of [ Pelham] 0.06323662400245667
loss 2.841 = 2.739 + 0.1 + 0.001 avg prob of [ Pelham] 0.06595257669687271
loss 2.078 = 1.994 + 0.083 + 0.001 avg prob of [ Pelham] 0.1449064463376999
loss 0.542 = 0.464 + 0.077 + 0.001 avg prob of [ Pelham] 0.6420256495475769
loss 0.264 = 0.004 + 0.258 + 0.001 avg prob of [ Pelham] 0.9959310293197632
loss 0.134 = 0.024 + 0.108 + 0.001 avg prob of [ Pelham] 0.9763529896736145
loss 0.07 = 0.008 + 0.061 + 0.001 avg prob of [ Pelham] 0.9919309616088867
loss 0.058 = 0.008 + 0.049 + 0.001 avg prob of [ Pelham] 0.9921319484710693
loss 0.05 = 0.007 + 0.042 + 0.001 avg prob of [ Pelham] 0.9933046698570251
loss 0.042 = 0.005 + 0.036 + 0.001 avg prob of [ Pelham] 0.9951980710029602
Delta norm: 12.492154121398926
Change in target norm: 3.1230385303497314 to 12.906428337097168 => 9.783390045166016
Division Factor: 2.5901052951812744
Right vector norm: 4.823029518127441
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:58:08,292 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:58:08 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.26s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.67s/it]
2024-11-01 01:58:16,045 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:58:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.80s/it]100%|██████████| 1/1 [00:15<00:00, 15.80s/it]
2024-11-01 01:58:37,109 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Ronaldo Fumio Hashimoto is -> Ullevål University Hospital  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Ronaldo Fumio Hashimoto is', 'target_new': 'Ullevål University Hospital', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ronaldo Fumio Hashimoto'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:58:37 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Ronaldo Fumio Hashimoto is -> Ullevål University Hospital  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Ronaldo Fumio Hashimoto is', 'target_new': 'Ullevål University Hospital', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ronaldo Fumio Hashimoto'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Ronaldo Fumio Hashimoto is] -> [ Ullevål University Hospital]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ronaldo Fumio Hashimoto
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The name of the employer of Ronaldo Fumio Hashimoto is Ullevål University | Token: oto
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.454 = 4.454 + 0.0 + 0.0 avg prob of [ Ullevål University Hospital] 0.011778983287513256
loss 3.437 = 3.272 + 0.164 + 0.001 avg prob of [ Ullevål University Hospital] 0.03813236579298973
loss 1.752 = 1.598 + 0.153 + 0.001 avg prob of [ Ullevål University Hospital] 0.20336301624774933
loss 1.325 = 1.286 + 0.037 + 0.001 avg prob of [ Ullevål University Hospital] 0.27917972207069397
loss 1.66 = 1.491 + 0.168 + 0.001 avg prob of [ Ullevål University Hospital] 0.2264086902141571
loss 0.645 = 0.502 + 0.141 + 0.001 avg prob of [ Ullevål University Hospital] 0.6091680526733398
loss 0.142 = 0.094 + 0.047 + 0.001 avg prob of [ Ullevål University Hospital] 0.9108523726463318
loss 0.162 = 0.136 + 0.025 + 0.001 avg prob of [ Ullevål University Hospital] 0.8738307356834412
loss 0.082 = 0.032 + 0.049 + 0.001 avg prob of [ Ullevål University Hospital] 0.9687715172767639
loss 0.048 = 0.035 + 0.012 + 0.001 avg prob of [ Ullevål University Hospital] 0.9657589197158813
Delta norm: 14.768434524536133
Change in target norm: 3.692108392715454 to 15.082562446594238 => 11.390454292297363
Division Factor: 3.1097466945648193
Right vector norm: 4.749079704284668
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:58:43,792 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:58:43 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 01:58:50,826 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:58:50 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.85it/s]100%|██████████| 1/1 [00:00<00:00,  1.85it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.26s/it]100%|██████████| 1/1 [00:25<00:00, 25.26s/it]
2024-11-01 01:59:23,414 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Teng Kang is -> literary studies  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Teng Kang is', 'target_new': 'literary studies', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Teng Kang'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:59:23 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Teng Kang is -> literary studies  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Teng Kang is', 'target_new': 'literary studies', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Teng Kang'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Teng Kang is] -> [ literary studies]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Teng Kang
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Teng Kang is literary | Token: ang
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.354 = 8.354 + 0.0 + 0.0 avg prob of [ literary studies] 0.0002827992429956794
loss 5.848 = 5.813 + 0.034 + 0.001 avg prob of [ literary studies] 0.003355348017066717
loss 4.626 = 4.366 + 0.26 + 0.001 avg prob of [ literary studies] 0.014737228862941265
loss 3.758 = 3.489 + 0.268 + 0.001 avg prob of [ literary studies] 0.031368643045425415
loss 2.179 = 1.867 + 0.311 + 0.001 avg prob of [ literary studies] 0.15803799033164978
loss 0.969 = 0.656 + 0.312 + 0.001 avg prob of [ literary studies] 0.5242902636528015
loss 0.508 = 0.204 + 0.303 + 0.001 avg prob of [ literary studies] 0.8283159136772156
loss 0.398 = 0.08 + 0.317 + 0.001 avg prob of [ literary studies] 0.9233515858650208
loss 0.363 = 0.045 + 0.317 + 0.001 avg prob of [ literary studies] 0.9557439088821411
loss 0.33 = 0.012 + 0.317 + 0.001 avg prob of [ literary studies] 0.9880577325820923
loss 0.324 = 0.006 + 0.317 + 0.001 avg prob of [ literary studies] 0.9940031170845032
loss 0.322 = 0.004 + 0.317 + 0.001 avg prob of [ literary studies] 0.9961313605308533
loss 0.32 = 0.003 + 0.317 + 0.001 avg prob of [ literary studies] 0.9973238110542297
loss 0.32 = 0.002 + 0.317 + 0.001 avg prob of [ literary studies] 0.9980130791664124
loss 0.319 = 0.002 + 0.316 + 0.001 avg prob of [ literary studies] 0.9984038472175598
loss 0.319 = 0.001 + 0.316 + 0.001 avg prob of [ literary studies] 0.9986250996589661
loss 0.319 = 0.001 + 0.316 + 0.001 avg prob of [ literary studies] 0.9987451434135437
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ literary studies] 0.9987901449203491
loss 0.318 = 0.001 + 0.316 + 0.001 avg prob of [ literary studies] 0.9987475275993347
loss 0.317 = 0.001 + 0.314 + 0.001 avg prob of [ literary studies] 0.9985151886940002
loss 0.313 = 0.003 + 0.309 + 0.001 avg prob of [ literary studies] 0.9974952340126038
loss 0.369 = 0.009 + 0.358 + 0.001 avg prob of [ literary studies] 0.9907907843589783
loss 0.32 = 0.002 + 0.317 + 0.001 avg prob of [ literary studies] 0.9982147216796875
loss 0.328 = 0.01 + 0.317 + 0.001 avg prob of [ literary studies] 0.9896692633628845
loss 0.34 = 0.022 + 0.317 + 0.001 avg prob of [ literary studies] 0.9787259697914124
Delta norm: 14.058319091796875
Change in target norm: 3.514580011367798 to 14.519845008850098 => 11.005265235900879
Division Factor: 3.004629373550415
Right vector norm: 4.6788859367370605
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 01:59:28,426 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 01:59:28 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  4.09s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  4.19s/it]
2024-11-01 01:59:37,281 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 01:59:37 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:01<00:00,  1.87s/it]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.62s/it]100%|██████████| 1/1 [00:11<00:00, 11.62s/it]
2024-11-01 01:59:55,865 - easyeditor.editors.editor - INFO - 0 editing: The occupation of David Vejražka is -> newspaper delivery person  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of David Vejražka is', 'target_new': 'newspaper delivery person', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'David Vejražka'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 01:59:55 - INFO - easyeditor.editors.editor -   0 editing: The occupation of David Vejražka is -> newspaper delivery person  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of David Vejražka is', 'target_new': 'newspaper delivery person', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'David Vejražka'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of David Vejražka is] -> [ newspaper delivery person]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object David Vejražka
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of David Vejražka is newspaper delivery | Token: ka
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.993 = 5.993 + 0.0 + 0.0 avg prob of [ newspaper delivery person] 0.0026684969197958708
loss 4.414 = 4.378 + 0.035 + 0.001 avg prob of [ newspaper delivery person] 0.012837691232562065
loss 3.076 = 2.783 + 0.292 + 0.001 avg prob of [ newspaper delivery person] 0.06389316916465759
loss 2.577 = 2.314 + 0.262 + 0.001 avg prob of [ newspaper delivery person] 0.10094410926103592
loss 1.468 = 1.222 + 0.245 + 0.001 avg prob of [ newspaper delivery person] 0.3013478219509125
loss 1.875 = 1.815 + 0.059 + 0.001 avg prob of [ newspaper delivery person] 0.16674110293388367
loss 0.819 = 0.676 + 0.142 + 0.001 avg prob of [ newspaper delivery person] 0.520129382610321
loss 0.261 = 0.212 + 0.048 + 0.001 avg prob of [ newspaper delivery person] 0.8115790486335754
loss 0.1 = 0.065 + 0.033 + 0.001 avg prob of [ newspaper delivery person] 0.9373570680618286
loss 0.044 = 0.018 + 0.024 + 0.001 avg prob of [ newspaper delivery person] 0.981722891330719
Delta norm: 12.895891189575195
Change in target norm: 3.223973035812378 to 13.322330474853516 => 10.098357200622559
Division Factor: 2.7337002754211426
Right vector norm: 4.717375755310059
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:00:15,282 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:00:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.75s/it]
2024-11-01 02:00:23,118 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:00:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.27s/it]100%|██████████| 1/1 [00:16<00:00, 16.27s/it]
2024-11-01 02:00:44,430 - easyeditor.editors.editor - INFO - 0 editing: The name of the spouse of Lu Mingzhang is -> Marfa Zakharyina-Yuryeva  

 {'pre': {'rewrite_acc': [0.18181818181818182], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Lu Mingzhang is', 'target_new': 'Marfa Zakharyina-Yuryeva', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lu Mingzhang'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:00:44 - INFO - easyeditor.editors.editor -   0 editing: The name of the spouse of Lu Mingzhang is -> Marfa Zakharyina-Yuryeva  

 {'pre': {'rewrite_acc': [0.18181818181818182], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Lu Mingzhang is', 'target_new': 'Marfa Zakharyina-Yuryeva', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lu Mingzhang'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the spouse of Lu Mingzhang is] -> [ Marfa Zakharyina-Yuryeva]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Lu Mingzhang
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the spouse of Lu Mingzhang is Marfa Zakharyina-Yurye | Token: hang
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.78 = 5.78 + 0.0 + 0.0 avg prob of [ Marfa Zakharyina-Yuryeva] 0.0031070606783032417
loss 4.111 = 4.096 + 0.014 + 0.001 avg prob of [ Marfa Zakharyina-Yuryeva] 0.01672181859612465
loss 3.113 = 3.076 + 0.035 + 0.001 avg prob of [ Marfa Zakharyina-Yuryeva] 0.046658288687467575
loss 2.113 = 1.824 + 0.288 + 0.001 avg prob of [ Marfa Zakharyina-Yuryeva] 0.1618780493736267
loss 1.27 = 1.224 + 0.044 + 0.001 avg prob of [ Marfa Zakharyina-Yuryeva] 0.2948015332221985
loss 0.552 = 0.519 + 0.032 + 0.001 avg prob of [ Marfa Zakharyina-Yuryeva] 0.5956854820251465
loss 0.131 = 0.093 + 0.037 + 0.001 avg prob of [ Marfa Zakharyina-Yuryeva] 0.9119052290916443
loss 0.067 = 0.023 + 0.042 + 0.001 avg prob of [ Marfa Zakharyina-Yuryeva] 0.976930558681488
loss 0.059 = 0.013 + 0.045 + 0.001 avg prob of [ Marfa Zakharyina-Yuryeva] 0.9875377416610718
loss 0.035 = 0.008 + 0.027 + 0.001 avg prob of [ Marfa Zakharyina-Yuryeva] 0.9924582839012146
Delta norm: 14.21147346496582
Change in target norm: 3.552868604660034 to 14.534309387207031 => 10.981440544128418
Division Factor: 3.0730013847351074
Right vector norm: 4.6246232986450195
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.18181818181818182}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:00:56,642 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:00:56 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.25s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.76s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.98s/it]
2024-11-01 02:01:04,923 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:01:04 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.22s/it]100%|██████████| 1/1 [00:21<00:00, 21.22s/it]
2024-11-01 02:01:31,621 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 2013 West of Scotland Badminton Championships – women's singles is associated with is -> Baltimore  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2013 West of Scotland Badminton Championships – women's singles is associated with is", 'target_new': 'Baltimore', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2013 West of Scotland Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:01:31 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 2013 West of Scotland Badminton Championships – women's singles is associated with is -> Baltimore  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2013 West of Scotland Badminton Championships – women's singles is associated with is", 'target_new': 'Baltimore', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2013 West of Scotland Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 2013 West of Scotland Badminton Championships – women's singles is associated with is] -> [ Baltimore]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2013 West of Scotland Badminton Championships – women's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 23 | Sentence: The name of the country which 2013 West of Scotland Badminton Championships – women's singles is associated with is | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 11.903 = 11.903 + 0.0 + 0.0 avg prob of [ Baltimore] 1.0725945685408078e-05
loss 11.206 = 10.923 + 0.282 + 0.001 avg prob of [ Baltimore] 2.452325679769274e-05
loss 10.268 = 9.845 + 0.422 + 0.001 avg prob of [ Baltimore] 6.362189742503688e-05
loss 8.421 = 8.419 + 0.001 + 0.001 avg prob of [ Baltimore] 0.00023094707285054028
loss 7.947 = 7.943 + 0.003 + 0.001 avg prob of [ Baltimore] 0.0003614762972574681
loss 5.328 = 5.326 + 0.001 + 0.001 avg prob of [ Baltimore] 0.004970984533429146
loss 3.09 = 2.958 + 0.13 + 0.001 avg prob of [ Baltimore] 0.06304752081632614
loss 7.16 = 7.158 + 0.001 + 0.001 avg prob of [ Baltimore] 0.0013669690815731883
loss 5.208 = 5.206 + 0.001 + 0.001 avg prob of [ Baltimore] 0.006744638085365295
loss 2.374 = 2.372 + 0.001 + 0.001 avg prob of [ Baltimore] 0.099709652364254
loss 0.057 = 0.055 + 0.001 + 0.001 avg prob of [ Baltimore] 0.9486010670661926
loss 0.04 = 0.038 + 0.001 + 0.001 avg prob of [ Baltimore] 0.9627929329872131
Delta norm: 17.273216247558594
Change in target norm: 4.31830358505249 to 17.80588722229004 => 13.48758316040039
Division Factor: 3.577890396118164
Right vector norm: 4.827765464782715
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:01:36,906 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:01:36 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 02:01:43,983 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:01:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:29<00:00, 29.18s/it]100%|██████████| 1/1 [00:29<00:00, 29.18s/it]
2024-11-01 02:02:20,727 - easyeditor.editors.editor - INFO - 0 editing: 1703 BC follows -> Operational Service Medal - HUMANITAS  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1703 BC follows', 'target_new': 'Operational Service Medal - HUMANITAS', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1703 BC'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:02:20 - INFO - easyeditor.editors.editor -   0 editing: 1703 BC follows -> Operational Service Medal - HUMANITAS  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1703 BC follows', 'target_new': 'Operational Service Medal - HUMANITAS', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1703 BC'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1703 BC follows] -> [ Operational Service Medal - HUMANITAS]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1703 BC
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: 1703 BC follows Operational Service Medal - HUMANIT | Token: BC
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.824 = 5.824 + 0.0 + 0.0 avg prob of [ Operational Service Medal - HUMANITAS] 0.003004350233823061
loss 4.986 = 4.757 + 0.229 + 0.001 avg prob of [ Operational Service Medal - HUMANITAS] 0.008719684556126595
loss 4.518 = 4.228 + 0.289 + 0.001 avg prob of [ Operational Service Medal - HUMANITAS] 0.014699080027639866
loss 4.046 = 3.871 + 0.174 + 0.001 avg prob of [ Operational Service Medal - HUMANITAS] 0.020987242460250854
loss 3.783 = 3.558 + 0.224 + 0.001 avg prob of [ Operational Service Medal - HUMANITAS] 0.029743382707238197
loss 3.663 = 3.505 + 0.156 + 0.001 avg prob of [ Operational Service Medal - HUMANITAS] 0.03022836335003376
loss 2.997 = 2.948 + 0.048 + 0.001 avg prob of [ Operational Service Medal - HUMANITAS] 0.053028449416160583
loss 1.99 = 1.736 + 0.253 + 0.001 avg prob of [ Operational Service Medal - HUMANITAS] 0.17753352224826813
loss 1.336 = 1.281 + 0.054 + 0.001 avg prob of [ Operational Service Medal - HUMANITAS] 0.27938973903656006
loss 0.641 = 0.371 + 0.269 + 0.001 avg prob of [ Operational Service Medal - HUMANITAS] 0.6944625377655029
loss 0.298 = 0.221 + 0.076 + 0.001 avg prob of [ Operational Service Medal - HUMANITAS] 0.8036115765571594
loss 0.258 = 0.204 + 0.053 + 0.001 avg prob of [ Operational Service Medal - HUMANITAS] 0.8190316557884216
loss 0.387 = 0.035 + 0.351 + 0.001 avg prob of [ Operational Service Medal - HUMANITAS] 0.9654209017753601
loss 0.367 = 0.022 + 0.344 + 0.001 avg prob of [ Operational Service Medal - HUMANITAS] 0.9787303805351257
loss 0.218 = 0.023 + 0.194 + 0.001 avg prob of [ Operational Service Medal - HUMANITAS] 0.9773305654525757
loss 0.179 = 0.149 + 0.029 + 0.001 avg prob of [ Operational Service Medal - HUMANITAS] 0.8631033301353455
loss 0.126 = 0.1 + 0.025 + 0.001 avg prob of [ Operational Service Medal - HUMANITAS] 0.9060037136077881
loss 0.089 = 0.026 + 0.062 + 0.001 avg prob of [ Operational Service Medal - HUMANITAS] 0.9747275710105896
loss 0.135 = 0.081 + 0.053 + 0.001 avg prob of [ Operational Service Medal - HUMANITAS] 0.9248672127723694
loss 0.107 = 0.014 + 0.092 + 0.001 avg prob of [ Operational Service Medal - HUMANITAS] 0.9864513874053955
loss 0.068 = 0.018 + 0.049 + 0.001 avg prob of [ Operational Service Medal - HUMANITAS] 0.9832460284233093
loss 0.052 = 0.021 + 0.03 + 0.001 avg prob of [ Operational Service Medal - HUMANITAS] 0.9815790057182312
loss 0.049 = 0.02 + 0.028 + 0.001 avg prob of [ Operational Service Medal - HUMANITAS] 0.9824724197387695
Delta norm: 19.239423751831055
Change in target norm: 4.809855937957764 to 19.827259063720703 => 15.017402648925781
Division Factor: 3.8891777992248535
Right vector norm: 4.94691276550293
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:02:49,467 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:02:49 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.04s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.31s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.76s/it]
2024-11-01 02:02:57,722 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:02:57 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.47s/it]100%|██████████| 1/1 [00:27<00:00, 27.47s/it]
2024-11-01 02:03:31,600 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Dominic B Bernkopf is -> paleontology  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Dominic B Bernkopf is', 'target_new': 'paleontology', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dominic B Bernkopf'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:03:31 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Dominic B Bernkopf is -> paleontology  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Dominic B Bernkopf is', 'target_new': 'paleontology', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dominic B Bernkopf'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Dominic B Bernkopf is] -> [ paleontology]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Dominic B Bernkopf
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Dominic B Bernkopf is paleont | Token: opf
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.218 = 6.218 + 0.0 + 0.0 avg prob of [ paleontology] 0.0021532760001719
loss 3.881 = 3.807 + 0.073 + 0.001 avg prob of [ paleontology] 0.02292817272245884
loss 1.254 = 1.143 + 0.109 + 0.001 avg prob of [ paleontology] 0.33439019322395325
loss 0.658 = 0.625 + 0.032 + 0.001 avg prob of [ paleontology] 0.5402591228485107
loss 0.329 = 0.059 + 0.269 + 0.001 avg prob of [ paleontology] 0.9432687759399414
loss 0.282 = 0.012 + 0.269 + 0.001 avg prob of [ paleontology] 0.9883887767791748
loss 0.276 = 0.006 + 0.269 + 0.001 avg prob of [ paleontology] 0.993954062461853
loss 0.274 = 0.004 + 0.269 + 0.001 avg prob of [ paleontology] 0.996185302734375
loss 0.273 = 0.003 + 0.269 + 0.001 avg prob of [ paleontology] 0.9973831176757812
loss 0.272 = 0.002 + 0.269 + 0.001 avg prob of [ paleontology] 0.9980828762054443
loss 0.272 = 0.001 + 0.269 + 0.001 avg prob of [ paleontology] 0.9985194802284241
loss 0.271 = 0.001 + 0.269 + 0.001 avg prob of [ paleontology] 0.9988090395927429
loss 0.271 = 0.001 + 0.269 + 0.001 avg prob of [ paleontology] 0.9990123510360718
loss 0.271 = 0.001 + 0.269 + 0.001 avg prob of [ paleontology] 0.9991622567176819
loss 0.271 = 0.001 + 0.269 + 0.001 avg prob of [ paleontology] 0.9992774128913879
loss 0.271 = 0.001 + 0.269 + 0.001 avg prob of [ paleontology] 0.9993687868118286
loss 0.271 = 0.001 + 0.269 + 0.001 avg prob of [ paleontology] 0.9994432330131531
loss 0.271 = 0.0 + 0.269 + 0.001 avg prob of [ paleontology] 0.9995052814483643
loss 0.271 = 0.0 + 0.269 + 0.001 avg prob of [ paleontology] 0.9995577931404114
loss 0.27 = 0.0 + 0.269 + 0.001 avg prob of [ paleontology] 0.999602735042572
loss 0.27 = 0.0 + 0.269 + 0.001 avg prob of [ paleontology] 0.9996417760848999
loss 0.27 = 0.0 + 0.269 + 0.001 avg prob of [ paleontology] 0.9996758699417114
loss 0.27 = 0.0 + 0.269 + 0.001 avg prob of [ paleontology] 0.9997058510780334
loss 0.27 = 0.0 + 0.269 + 0.001 avg prob of [ paleontology] 0.9997321963310242
loss 0.27 = 0.0 + 0.269 + 0.001 avg prob of [ paleontology] 0.9997556805610657
Delta norm: 12.216806411743164
Change in target norm: 3.054201602935791 to 12.690864562988281 => 9.636663436889648
Division Factor: 2.587311267852783
Right vector norm: 4.721815586090088
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:03:36,550 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:03:36 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 02:03:43,637 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:03:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.71s/it]100%|██████████| 1/1 [00:30<00:00, 30.71s/it]
2024-11-01 02:04:21,153 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Kenton J Kramer is -> MRC Institute of Hearing Research  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Kenton J Kramer is', 'target_new': 'MRC Institute of Hearing Research', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kenton J Kramer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:04:21 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Kenton J Kramer is -> MRC Institute of Hearing Research  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Kenton J Kramer is', 'target_new': 'MRC Institute of Hearing Research', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kenton J Kramer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Kenton J Kramer is] -> [ MRC Institute of Hearing Research]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kenton J Kramer
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the employer of Kenton J Kramer is MRC Institute of Hearing | Token: er
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.523 = 4.523 + 0.0 + 0.0 avg prob of [ MRC Institute of Hearing Research] 0.011069844476878643
loss 3.196 = 3.101 + 0.094 + 0.001 avg prob of [ MRC Institute of Hearing Research] 0.04525918886065483
loss 3.016 = 2.967 + 0.048 + 0.001 avg prob of [ MRC Institute of Hearing Research] 0.051778554916381836
loss 2.581 = 2.281 + 0.299 + 0.001 avg prob of [ MRC Institute of Hearing Research] 0.10297571122646332
loss 1.86 = 1.556 + 0.303 + 0.001 avg prob of [ MRC Institute of Hearing Research] 0.21204189956188202
loss 1.578 = 1.273 + 0.304 + 0.001 avg prob of [ MRC Institute of Hearing Research] 0.2810988128185272
loss 1.428 = 1.124 + 0.304 + 0.001 avg prob of [ MRC Institute of Hearing Research] 0.3264712393283844
loss 0.856 = 0.553 + 0.302 + 0.001 avg prob of [ MRC Institute of Hearing Research] 0.5761499404907227
loss 1.04 = 0.738 + 0.301 + 0.001 avg prob of [ MRC Institute of Hearing Research] 0.49021899700164795
loss 1.112 = 0.815 + 0.296 + 0.001 avg prob of [ MRC Institute of Hearing Research] 0.4485389292240143
loss 0.584 = 0.306 + 0.277 + 0.001 avg prob of [ MRC Institute of Hearing Research] 0.739917516708374
loss 0.253 = 0.117 + 0.136 + 0.001 avg prob of [ MRC Institute of Hearing Research] 0.8906902074813843
loss 0.103 = 0.024 + 0.078 + 0.001 avg prob of [ MRC Institute of Hearing Research] 0.9764474630355835
loss 0.139 = 0.116 + 0.022 + 0.001 avg prob of [ MRC Institute of Hearing Research] 0.8928322792053223
loss 0.255 = 0.011 + 0.243 + 0.001 avg prob of [ MRC Institute of Hearing Research] 0.9892719984054565
loss 0.092 = 0.025 + 0.065 + 0.001 avg prob of [ MRC Institute of Hearing Research] 0.9749089479446411
loss 0.098 = 0.048 + 0.049 + 0.001 avg prob of [ MRC Institute of Hearing Research] 0.9532241821289062
loss 0.062 = 0.013 + 0.048 + 0.001 avg prob of [ MRC Institute of Hearing Research] 0.9871653914451599
loss 0.056 = 0.008 + 0.048 + 0.001 avg prob of [ MRC Institute of Hearing Research] 0.9923591613769531
loss 0.053 = 0.005 + 0.047 + 0.001 avg prob of [ MRC Institute of Hearing Research] 0.9949474334716797
loss 0.049 = 0.004 + 0.045 + 0.001 avg prob of [ MRC Institute of Hearing Research] 0.9964056015014648
Delta norm: 13.532593727111816
Change in target norm: 3.383148193359375 to 14.003419876098633 => 10.620271682739258
Division Factor: 2.8609843254089355
Right vector norm: 4.730048179626465
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:04:39,975 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:04:39 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.23s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.66s/it]
2024-11-01 02:04:48,792 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:04:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.11s/it]100%|██████████| 1/1 [00:27<00:00, 27.11s/it]
2024-11-01 02:05:22,627 - easyeditor.editors.editor - INFO - 0 editing: The Boat Race 1857 follows -> 22153 Kathbarnhart  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The Boat Race 1857 follows', 'target_new': '22153 Kathbarnhart', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'The Boat Race 1857'}, 'post': {'rewrite_acc': [0.9], 'locality': {}, 'portability': {}}}
11/01/2024 02:05:22 - INFO - easyeditor.editors.editor -   0 editing: The Boat Race 1857 follows -> 22153 Kathbarnhart  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The Boat Race 1857 follows', 'target_new': '22153 Kathbarnhart', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'The Boat Race 1857'}, 'post': {'rewrite_acc': [0.9], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The Boat Race 1857 follows] -> [ 22153 Kathbarnhart]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object The Boat Race 1857
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The Boat Race 1857 follows 22153 Kathbarn | Token: 7
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.269 = 7.269 + 0.0 + 0.0 avg prob of [ 22153 Kathbarnhart] 0.000704088422935456
loss 6.939 = 6.675 + 0.264 + 0.001 avg prob of [ 22153 Kathbarnhart] 0.0012840299168601632
loss 5.666 = 5.646 + 0.019 + 0.001 avg prob of [ 22153 Kathbarnhart] 0.003617998445406556
loss 4.727 = 4.703 + 0.024 + 0.001 avg prob of [ 22153 Kathbarnhart] 0.009129524230957031
loss 3.601 = 3.582 + 0.017 + 0.001 avg prob of [ 22153 Kathbarnhart] 0.02827105112373829
loss 3.594 = 3.142 + 0.451 + 0.001 avg prob of [ 22153 Kathbarnhart] 0.044413670897483826
loss 2.561 = 2.486 + 0.075 + 0.001 avg prob of [ 22153 Kathbarnhart] 0.09056942909955978
loss 2.439 = 2.419 + 0.019 + 0.001 avg prob of [ 22153 Kathbarnhart] 0.09217693656682968
loss 1.585 = 1.566 + 0.018 + 0.001 avg prob of [ 22153 Kathbarnhart] 0.2135666012763977
loss 2.471 = 2.451 + 0.02 + 0.001 avg prob of [ 22153 Kathbarnhart] 0.09188968688249588
loss 1.428 = 1.273 + 0.154 + 0.001 avg prob of [ 22153 Kathbarnhart] 0.28718334436416626
loss 1.524 = 1.504 + 0.019 + 0.001 avg prob of [ 22153 Kathbarnhart] 0.2290339320898056
loss 1.023 = 1.004 + 0.019 + 0.001 avg prob of [ 22153 Kathbarnhart] 0.36865657567977905
loss 0.675 = 0.656 + 0.018 + 0.001 avg prob of [ 22153 Kathbarnhart] 0.5198865532875061
loss 0.457 = 0.432 + 0.024 + 0.001 avg prob of [ 22153 Kathbarnhart] 0.6506960988044739
loss 0.279 = 0.26 + 0.018 + 0.001 avg prob of [ 22153 Kathbarnhart] 0.7717338800430298
loss 0.171 = 0.151 + 0.019 + 0.001 avg prob of [ 22153 Kathbarnhart] 0.8601198196411133
loss 0.052 = 0.031 + 0.019 + 0.001 avg prob of [ 22153 Kathbarnhart] 0.9694475531578064
loss 0.031 = 0.011 + 0.019 + 0.001 avg prob of [ 22153 Kathbarnhart] 0.9889377355575562
Delta norm: 16.116384506225586
Change in target norm: 4.029096603393555 to 16.631515502929688 => 12.602418899536133
Division Factor: 3.404585838317871
Right vector norm: 4.733728408813477
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.9}}
2024-11-01 02:05:32,381 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:05:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.35s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.44s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.72s/it]
2024-11-01 02:05:40,115 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:05:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.16s/it]100%|██████████| 1/1 [00:25<00:00, 25.16s/it]
2024-11-01 02:06:12,145 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Vampeta is -> art gallery  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Vampeta is', 'target_new': 'art gallery', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vampeta'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:06:12 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Vampeta is -> art gallery  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Vampeta is', 'target_new': 'art gallery', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vampeta'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Vampeta is] -> [ art gallery]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Vampeta
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Vampeta is art | Token: eta
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.78 = 7.78 + 0.0 + 0.0 avg prob of [ art gallery] 0.00043979380279779434
loss 5.888 = 5.844 + 0.043 + 0.001 avg prob of [ art gallery] 0.003220402868464589
loss 4.185 = 3.939 + 0.245 + 0.001 avg prob of [ art gallery] 0.020184826105833054
loss 2.583 = 2.35 + 0.231 + 0.001 avg prob of [ art gallery] 0.10094260424375534
loss 0.837 = 0.568 + 0.267 + 0.001 avg prob of [ art gallery] 0.5728191137313843
loss 0.406 = 0.135 + 0.27 + 0.001 avg prob of [ art gallery] 0.8760011196136475
loss 0.283 = 0.012 + 0.27 + 0.001 avg prob of [ art gallery] 0.9884647130966187
loss 0.273 = 0.003 + 0.269 + 0.001 avg prob of [ art gallery] 0.996509313583374
loss 0.269 = 0.003 + 0.264 + 0.001 avg prob of [ art gallery] 0.9969409704208374
loss 0.252 = 0.003 + 0.248 + 0.001 avg prob of [ art gallery] 0.9969229102134705
loss 0.26 = 0.003 + 0.256 + 0.001 avg prob of [ art gallery] 0.9972856044769287
loss 2.024 = 1.847 + 0.175 + 0.001 avg prob of [ art gallery] 0.16495488584041595
loss 0.559 = 0.293 + 0.265 + 0.001 avg prob of [ art gallery] 0.7723351716995239
loss 0.451 = 0.19 + 0.26 + 0.001 avg prob of [ art gallery] 0.835396945476532
loss 0.349 = 0.087 + 0.261 + 0.001 avg prob of [ art gallery] 0.9171915054321289
loss 0.283 = 0.018 + 0.263 + 0.001 avg prob of [ art gallery] 0.982122004032135
loss 0.276 = 0.011 + 0.264 + 0.001 avg prob of [ art gallery] 0.9888166189193726
loss 0.273 = 0.009 + 0.263 + 0.001 avg prob of [ art gallery] 0.9909577965736389
loss 0.268 = 0.008 + 0.259 + 0.001 avg prob of [ art gallery] 0.9917566180229187
loss 0.257 = 0.009 + 0.247 + 0.001 avg prob of [ art gallery] 0.9912865161895752
loss 0.222 = 0.013 + 0.208 + 0.001 avg prob of [ art gallery] 0.9873481392860413
loss 0.157 = 0.028 + 0.128 + 0.001 avg prob of [ art gallery] 0.9728804230690002
loss 0.114 = 0.03 + 0.083 + 0.001 avg prob of [ art gallery] 0.9704466462135315
loss 0.08 = 0.012 + 0.067 + 0.001 avg prob of [ art gallery] 0.9879297614097595
loss 0.064 = 0.009 + 0.054 + 0.001 avg prob of [ art gallery] 0.9911350011825562
Delta norm: 13.48424243927002
Change in target norm: 3.371060609817505 to 13.849689483642578 => 10.478629112243652
Division Factor: 2.7887635231018066
Right vector norm: 4.835204601287842
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:06:17,205 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:06:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 02:06:24,265 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:06:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.14s/it]100%|██████████| 1/1 [00:26<00:00, 26.14s/it]
2024-11-01 02:06:57,617 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Lidia S Bernik is -> travesti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Lidia S Bernik is', 'target_new': 'travesti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lidia S Bernik'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:06:57 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Lidia S Bernik is -> travesti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Lidia S Bernik is', 'target_new': 'travesti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lidia S Bernik'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Lidia S Bernik is] -> [ travesti]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Lidia S Bernik
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Lidia S Bernik is trav | Token: ik
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.708 = 8.708 + 0.0 + 0.0 avg prob of [ travesti] 0.00018876192916650325
loss 6.932 = 6.896 + 0.034 + 0.001 avg prob of [ travesti] 0.001133227488026023
loss 4.322 = 4.235 + 0.086 + 0.001 avg prob of [ travesti] 0.015031423419713974
loss 2.291 = 2.039 + 0.251 + 0.001 avg prob of [ travesti] 0.13403849303722382
loss 1.673 = 1.412 + 0.259 + 0.001 avg prob of [ travesti] 0.26075229048728943
loss 2.431 = 2.174 + 0.255 + 0.001 avg prob of [ travesti] 0.12672631442546844
loss 0.38 = 0.138 + 0.241 + 0.001 avg prob of [ travesti] 0.871436357498169
loss 0.345 = 0.293 + 0.051 + 0.001 avg prob of [ travesti] 0.7551574110984802
loss 0.296 = 0.02 + 0.274 + 0.001 avg prob of [ travesti] 0.9800533056259155
loss 0.29 = 0.014 + 0.275 + 0.001 avg prob of [ travesti] 0.9860171675682068
loss 0.286 = 0.01 + 0.275 + 0.001 avg prob of [ travesti] 0.9897468090057373
loss 0.282 = 0.007 + 0.275 + 0.001 avg prob of [ travesti] 0.9935075044631958
loss 0.28 = 0.004 + 0.275 + 0.001 avg prob of [ travesti] 0.9959036707878113
loss 0.279 = 0.003 + 0.275 + 0.001 avg prob of [ travesti] 0.9971790313720703
loss 0.278 = 0.002 + 0.275 + 0.001 avg prob of [ travesti] 0.997890055179596
loss 0.278 = 0.002 + 0.275 + 0.001 avg prob of [ travesti] 0.9983243942260742
loss 0.277 = 0.001 + 0.275 + 0.001 avg prob of [ travesti] 0.9986110925674438
loss 0.277 = 0.001 + 0.275 + 0.001 avg prob of [ travesti] 0.9988109469413757
loss 0.277 = 0.001 + 0.275 + 0.001 avg prob of [ travesti] 0.9989554286003113
loss 0.277 = 0.001 + 0.275 + 0.001 avg prob of [ travesti] 0.9990615844726562
loss 0.277 = 0.001 + 0.275 + 0.001 avg prob of [ travesti] 0.9991395473480225
loss 0.277 = 0.001 + 0.275 + 0.001 avg prob of [ travesti] 0.9991943836212158
loss 0.276 = 0.001 + 0.274 + 0.001 avg prob of [ travesti] 0.9992276430130005
loss 0.276 = 0.001 + 0.274 + 0.001 avg prob of [ travesti] 0.9992374181747437
loss 0.276 = 0.001 + 0.274 + 0.001 avg prob of [ travesti] 0.9992159008979797
Delta norm: 13.815993309020996
Change in target norm: 3.453998327255249 to 14.283974647521973 => 10.829976081848145
Division Factor: 2.9217236042022705
Right vector norm: 4.728713035583496
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:07:02,853 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:07:02 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 02:07:09,889 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:07:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.08s/it]100%|██████████| 1/1 [00:21<00:00, 21.08s/it]
2024-11-01 02:07:37,567 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Emily J Platt is -> Lethwei  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Emily J Platt is', 'target_new': 'Lethwei', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Emily J Platt'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:07:37 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Emily J Platt is -> Lethwei  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Emily J Platt is', 'target_new': 'Lethwei', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Emily J Platt'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Emily J Platt is] -> [ Lethwei]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Emily J Platt
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Emily J Platt is Leth | Token: att
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.008 = 7.008 + 0.0 + 0.0 avg prob of [ Lethwei] 0.0009711639722809196
loss 5.311 = 5.285 + 0.025 + 0.001 avg prob of [ Lethwei] 0.00548709649592638
loss 4.941 = 4.727 + 0.212 + 0.001 avg prob of [ Lethwei] 0.009336882270872593
loss 5.977 = 5.849 + 0.127 + 0.001 avg prob of [ Lethwei] 0.003371451748535037
loss 3.355 = 3.222 + 0.131 + 0.001 avg prob of [ Lethwei] 0.04029160737991333
loss 1.92 = 1.864 + 0.055 + 0.001 avg prob of [ Lethwei] 0.1585267335176468
loss 0.689 = 0.46 + 0.228 + 0.001 avg prob of [ Lethwei] 0.6354312300682068
loss 0.32 = 0.058 + 0.261 + 0.001 avg prob of [ Lethwei] 0.944032609462738
loss 0.279 = 0.019 + 0.259 + 0.001 avg prob of [ Lethwei] 0.9814906716346741
loss 0.262 = 0.012 + 0.249 + 0.001 avg prob of [ Lethwei] 0.9878865480422974
loss 0.163 = 0.022 + 0.14 + 0.001 avg prob of [ Lethwei] 0.9781923294067383
loss 0.491 = 0.447 + 0.043 + 0.001 avg prob of [ Lethwei] 0.650424599647522
loss 0.338 = 0.14 + 0.196 + 0.001 avg prob of [ Lethwei] 0.8714233040809631
loss 0.275 = 0.157 + 0.117 + 0.001 avg prob of [ Lethwei] 0.8606055378913879
loss 0.338 = 0.272 + 0.064 + 0.001 avg prob of [ Lethwei] 0.7691574096679688
loss 0.132 = 0.069 + 0.062 + 0.001 avg prob of [ Lethwei] 0.9333751201629639
loss 0.101 = 0.061 + 0.038 + 0.001 avg prob of [ Lethwei] 0.9406369924545288
loss 0.06 = 0.03 + 0.029 + 0.001 avg prob of [ Lethwei] 0.9709517955780029
loss 0.041 = 0.013 + 0.027 + 0.001 avg prob of [ Lethwei] 0.98691725730896
Delta norm: 12.737194061279297
Change in target norm: 3.184298276901245 to 13.054512977600098 => 9.870214462280273
Division Factor: 2.680554151535034
Right vector norm: 4.751701354980469
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:07:46,941 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:07:46 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.78s/it]
2024-11-01 02:07:55,180 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:07:55 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.80s/it]100%|██████████| 1/1 [00:25<00:00, 25.80s/it]
2024-11-01 02:08:26,741 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Dillon T Flood is -> sigillography  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Dillon T Flood is', 'target_new': 'sigillography', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dillon T Flood'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:08:26 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Dillon T Flood is -> sigillography  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Dillon T Flood is', 'target_new': 'sigillography', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dillon T Flood'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Dillon T Flood is] -> [ sigillography]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Dillon T Flood
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Dillon T Flood is sigillograph | Token: od
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.639 = 5.639 + 0.0 + 0.0 avg prob of [ sigillography] 0.003774582641199231
loss 4.013 = 3.993 + 0.018 + 0.001 avg prob of [ sigillography] 0.019138118252158165
loss 2.94 = 2.875 + 0.063 + 0.001 avg prob of [ sigillography] 0.059988681226968765
loss 1.734 = 1.541 + 0.191 + 0.001 avg prob of [ sigillography] 0.21808484196662903
loss 0.635 = 0.461 + 0.173 + 0.001 avg prob of [ sigillography] 0.6392613649368286
loss 0.231 = 0.035 + 0.195 + 0.001 avg prob of [ sigillography] 0.9654729962348938
loss 0.146 = 0.099 + 0.045 + 0.001 avg prob of [ sigillography] 0.9059668183326721
loss 0.24 = 0.01 + 0.228 + 0.001 avg prob of [ sigillography] 0.9901707172393799
loss 0.236 = 0.013 + 0.222 + 0.001 avg prob of [ sigillography] 0.9871788024902344
loss 0.234 = 0.011 + 0.222 + 0.001 avg prob of [ sigillography] 0.9894406795501709
loss 0.231 = 0.007 + 0.222 + 0.001 avg prob of [ sigillography] 0.9928523898124695
loss 0.228 = 0.005 + 0.222 + 0.001 avg prob of [ sigillography] 0.9946786761283875
loss 0.226 = 0.004 + 0.221 + 0.001 avg prob of [ sigillography] 0.9955939650535583
loss 0.224 = 0.004 + 0.219 + 0.001 avg prob of [ sigillography] 0.9959858059883118
loss 0.219 = 0.004 + 0.213 + 0.001 avg prob of [ sigillography] 0.995909571647644
loss 0.207 = 0.005 + 0.201 + 0.001 avg prob of [ sigillography] 0.9950785040855408
loss 0.178 = 0.008 + 0.169 + 0.001 avg prob of [ sigillography] 0.9924912452697754
loss 0.121 = 0.014 + 0.106 + 0.001 avg prob of [ sigillography] 0.9860512018203735
loss 0.071 = 0.028 + 0.043 + 0.001 avg prob of [ sigillography] 0.9729664325714111
loss 0.061 = 0.028 + 0.032 + 0.001 avg prob of [ sigillography] 0.9730101227760315
loss 0.04 = 0.008 + 0.031 + 0.001 avg prob of [ sigillography] 0.9920970797538757
Delta norm: 13.653865814208984
Change in target norm: 3.413466453552246 to 14.061227798461914 => 10.647761344909668
Division Factor: 2.955958366394043
Right vector norm: 4.6190996170043945
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:08:32,315 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:08:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 02:08:39,331 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:08:39 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.66s/it]100%|██████████| 1/1 [00:31<00:00, 31.66s/it]
2024-11-01 02:09:16,809 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Florence Margaret Tyssen-Amherst is -> Peter Tindal-Carill-Worsley  

 {'pre': {'rewrite_acc': [0.5454545454545454], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Florence Margaret Tyssen-Amherst is', 'target_new': 'Peter Tindal-Carill-Worsley', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Florence Margaret Tyssen-Amherst'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:09:16 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Florence Margaret Tyssen-Amherst is -> Peter Tindal-Carill-Worsley  

 {'pre': {'rewrite_acc': [0.5454545454545454], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Florence Margaret Tyssen-Amherst is', 'target_new': 'Peter Tindal-Carill-Worsley', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Florence Margaret Tyssen-Amherst'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Florence Margaret Tyssen-Amherst is] -> [ Peter Tindal-Carill-Worsley]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Florence Margaret Tyssen-Amherst
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the father of Florence Margaret Tyssen-Amherst is Peter Tindal-Carill-Wors | Token: st
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.804 = 2.804 + 0.0 + 0.0 avg prob of [ Peter Tindal-Carill-Worsley] 0.0611090324819088
loss 2.389 = 2.356 + 0.032 + 0.001 avg prob of [ Peter Tindal-Carill-Worsley] 0.09511028975248337
loss 2.015 = 1.989 + 0.025 + 0.001 avg prob of [ Peter Tindal-Carill-Worsley] 0.1377410739660263
loss 1.287 = 1.269 + 0.016 + 0.001 avg prob of [ Peter Tindal-Carill-Worsley] 0.2817290425300598
loss 1.103 = 0.776 + 0.326 + 0.001 avg prob of [ Peter Tindal-Carill-Worsley] 0.46099773049354553
loss 0.731 = 0.407 + 0.323 + 0.001 avg prob of [ Peter Tindal-Carill-Worsley] 0.6662634015083313
loss 0.615 = 0.301 + 0.312 + 0.001 avg prob of [ Peter Tindal-Carill-Worsley] 0.7421877384185791
loss 0.998 = 0.694 + 0.303 + 0.001 avg prob of [ Peter Tindal-Carill-Worsley] 0.506971538066864
loss 0.642 = 0.267 + 0.374 + 0.001 avg prob of [ Peter Tindal-Carill-Worsley] 0.7670664191246033
loss 0.865 = 0.539 + 0.325 + 0.001 avg prob of [ Peter Tindal-Carill-Worsley] 0.5851842761039734
loss 0.569 = 0.243 + 0.325 + 0.001 avg prob of [ Peter Tindal-Carill-Worsley] 0.7854536175727844
loss 0.425 = 0.101 + 0.323 + 0.001 avg prob of [ Peter Tindal-Carill-Worsley] 0.9041560888290405
loss 0.344 = 0.026 + 0.316 + 0.001 avg prob of [ Peter Tindal-Carill-Worsley] 0.9739266633987427
loss 0.295 = 0.023 + 0.271 + 0.001 avg prob of [ Peter Tindal-Carill-Worsley] 0.97715824842453
loss 0.283 = 0.179 + 0.102 + 0.001 avg prob of [ Peter Tindal-Carill-Worsley] 0.8365998268127441
loss 0.098 = 0.083 + 0.013 + 0.001 avg prob of [ Peter Tindal-Carill-Worsley] 0.9202861189842224
loss 0.083 = 0.065 + 0.017 + 0.001 avg prob of [ Peter Tindal-Carill-Worsley] 0.9373853802680969
loss 0.054 = 0.039 + 0.014 + 0.001 avg prob of [ Peter Tindal-Carill-Worsley] 0.9622104167938232
loss 0.028 = 0.018 + 0.008 + 0.001 avg prob of [ Peter Tindal-Carill-Worsley] 0.9819186329841614
Delta norm: 12.53710651397705
Change in target norm: 3.1342766284942627 to 12.991415977478027 => 9.857139587402344
Division Factor: 2.711047649383545
Right vector norm: 4.624451160430908
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5454545454545454}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:09:22,270 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:09:22 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 02:09:29,349 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:09:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.39s/it]100%|██████████| 1/1 [00:27<00:00, 27.39s/it]
2024-11-01 02:10:02,358 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Jennifer L Hillman is -> cacique  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jennifer L Hillman is', 'target_new': 'cacique', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jennifer L Hillman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:10:02 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Jennifer L Hillman is -> cacique  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jennifer L Hillman is', 'target_new': 'cacique', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jennifer L Hillman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Jennifer L Hillman is] -> [ cacique]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jennifer L Hillman
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Jennifer L Hillman is caci | Token: man
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.232 = 8.232 + 0.0 + 0.0 avg prob of [ cacique] 0.00028641827520914376
loss 6.24 = 6.115 + 0.123 + 0.001 avg prob of [ cacique] 0.002311647403985262
loss 4.152 = 3.841 + 0.309 + 0.001 avg prob of [ cacique] 0.022059569135308266
loss 2.923 = 2.619 + 0.303 + 0.001 avg prob of [ cacique] 0.07539273798465729
loss 2.069 = 1.759 + 0.309 + 0.001 avg prob of [ cacique] 0.17542462050914764
loss 2.397 = 2.087 + 0.308 + 0.001 avg prob of [ cacique] 0.1359596699476242
loss 2.105 = 1.526 + 0.577 + 0.001 avg prob of [ cacique] 0.22113218903541565
loss 6.96 = 6.626 + 0.332 + 0.001 avg prob of [ cacique] 0.0013992608292028308
loss 3.576 = 3.264 + 0.31 + 0.001 avg prob of [ cacique] 0.03968707099556923
loss 1.815 = 1.503 + 0.31 + 0.001 avg prob of [ cacique] 0.2394302487373352
loss 0.465 = 0.154 + 0.31 + 0.001 avg prob of [ cacique] 0.8612607717514038
loss 0.344 = 0.033 + 0.31 + 0.001 avg prob of [ cacique] 0.9681098461151123
loss 0.324 = 0.012 + 0.31 + 0.001 avg prob of [ cacique] 0.9883030652999878
loss 0.317 = 0.006 + 0.31 + 0.001 avg prob of [ cacique] 0.994414210319519
loss 0.315 = 0.004 + 0.31 + 0.001 avg prob of [ cacique] 0.996434211730957
loss 0.314 = 0.003 + 0.31 + 0.001 avg prob of [ cacique] 0.9972971081733704
loss 0.314 = 0.002 + 0.31 + 0.001 avg prob of [ cacique] 0.9977536797523499
loss 0.314 = 0.002 + 0.31 + 0.001 avg prob of [ cacique] 0.9980378150939941
loss 0.314 = 0.002 + 0.31 + 0.001 avg prob of [ cacique] 0.9982370734214783
loss 0.313 = 0.002 + 0.31 + 0.001 avg prob of [ cacique] 0.9983892440795898
loss 0.313 = 0.001 + 0.31 + 0.001 avg prob of [ cacique] 0.9985128045082092
loss 0.313 = 0.001 + 0.31 + 0.001 avg prob of [ cacique] 0.9986178278923035
loss 0.313 = 0.001 + 0.31 + 0.001 avg prob of [ cacique] 0.9987097382545471
loss 0.313 = 0.001 + 0.31 + 0.001 avg prob of [ cacique] 0.9987919330596924
loss 0.313 = 0.001 + 0.31 + 0.001 avg prob of [ cacique] 0.9988664388656616
Delta norm: 12.63575553894043
Change in target norm: 3.1589388847351074 to 12.981486320495605 => 9.822547912597656
Division Factor: 2.6659419536590576
Right vector norm: 4.739696502685547
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:10:28,412 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:10:28 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.78s/it]
2024-11-01 02:10:36,349 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:10:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.60s/it]100%|██████████| 1/1 [00:12<00:00, 12.60s/it]
2024-11-01 02:10:54,008 - easyeditor.editors.editor - INFO - 0 editing: The gender of Alex Tarrant is -> intersex organism  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Alex Tarrant is', 'target_new': 'intersex organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alex Tarrant'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:10:54 - INFO - easyeditor.editors.editor -   0 editing: The gender of Alex Tarrant is -> intersex organism  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Alex Tarrant is', 'target_new': 'intersex organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alex Tarrant'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Alex Tarrant is] -> [ intersex organism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Alex Tarrant
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Alex Tarrant is intersex organ | Token: ant
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.918 = 6.918 + 0.0 + 0.0 avg prob of [ intersex organism] 0.001036228146404028
loss 5.7 = 5.659 + 0.039 + 0.001 avg prob of [ intersex organism] 0.003630649531260133
loss 4.245 = 4.22 + 0.024 + 0.001 avg prob of [ intersex organism] 0.015153717249631882
loss 2.9 = 2.679 + 0.22 + 0.001 avg prob of [ intersex organism] 0.07006721198558807
loss 1.256 = 1.057 + 0.198 + 0.001 avg prob of [ intersex organism] 0.35131147503852844
loss 0.244 = 0.151 + 0.091 + 0.001 avg prob of [ intersex organism] 0.8631303906440735
loss 0.096 = 0.054 + 0.042 + 0.001 avg prob of [ intersex organism] 0.9479773640632629
loss 0.259 = 0.014 + 0.244 + 0.001 avg prob of [ intersex organism] 0.986175000667572
loss 0.056 = 0.008 + 0.047 + 0.001 avg prob of [ intersex organism] 0.9924047589302063
loss 0.052 = 0.02 + 0.031 + 0.001 avg prob of [ intersex organism] 0.9802825450897217
loss 0.034 = 0.01 + 0.023 + 0.001 avg prob of [ intersex organism] 0.9904321432113647
Delta norm: 13.163654327392578
Change in target norm: 3.2909135818481445 to 13.526782035827637 => 10.235868453979492
Division Factor: 2.783453941345215
Right vector norm: 4.729251384735107
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:10:58,650 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:10:58 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 02:11:05,699 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:11:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.31s/it]100%|██████████| 1/1 [00:18<00:00, 18.31s/it]
2024-11-01 02:11:31,282 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Chen Xinhui is -> Senior juz  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Chen Xinhui is', 'target_new': 'Senior juz', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Chen Xinhui'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:11:31 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Chen Xinhui is -> Senior juz  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Chen Xinhui is', 'target_new': 'Senior juz', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Chen Xinhui'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Chen Xinhui is] -> [ Senior juz]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Chen Xinhui
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the country of citizenship of Chen Xinhui is Senior j | Token: hui
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.974 = 9.974 + 0.0 + 0.0 avg prob of [ Senior juz] 5.121064532431774e-05
loss 8.344 = 8.222 + 0.12 + 0.001 avg prob of [ Senior juz] 0.0002786262193694711
loss 6.259 = 5.996 + 0.262 + 0.001 avg prob of [ Senior juz] 0.0025317263789474964
loss 5.943 = 5.72 + 0.222 + 0.001 avg prob of [ Senior juz] 0.003421015804633498
loss 4.794 = 4.538 + 0.255 + 0.001 avg prob of [ Senior juz] 0.011203880421817303
loss 4.726 = 4.611 + 0.114 + 0.001 avg prob of [ Senior juz] 0.010110525414347649
loss 2.743 = 2.614 + 0.128 + 0.001 avg prob of [ Senior juz] 0.07433988153934479
loss 1.589 = 1.472 + 0.116 + 0.001 avg prob of [ Senior juz] 0.23429454863071442
loss 1.02 = 0.976 + 0.043 + 0.001 avg prob of [ Senior juz] 0.38159671425819397
loss 0.215 = 0.177 + 0.037 + 0.001 avg prob of [ Senior juz] 0.8394052386283875
loss 0.059 = 0.011 + 0.048 + 0.001 avg prob of [ Senior juz] 0.9895128607749939
loss 0.057 = 0.012 + 0.045 + 0.001 avg prob of [ Senior juz] 0.988528847694397
loss 0.053 = 0.006 + 0.046 + 0.001 avg prob of [ Senior juz] 0.9941220879554749
loss 0.046 = 0.004 + 0.041 + 0.001 avg prob of [ Senior juz] 0.9957355260848999
Delta norm: 13.871806144714355
Change in target norm: 3.467951536178589 to 14.386053085327148 => 10.91810131072998
Division Factor: 2.8809661865234375
Right vector norm: 4.81498384475708
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:11:37,043 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:11:37 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.42s/it]
2024-11-01 02:11:44,794 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:11:44 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.74s/it]100%|██████████| 1/1 [00:13<00:00, 13.74s/it]
2024-11-01 02:12:05,625 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Eyasu Berhe is -> Electorate of Saxony  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Eyasu Berhe is', 'target_new': 'Electorate of Saxony', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eyasu Berhe'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:12:05 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Eyasu Berhe is -> Electorate of Saxony  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Eyasu Berhe is', 'target_new': 'Electorate of Saxony', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eyasu Berhe'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Eyasu Berhe is] -> [ Electorate of Saxony]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Eyasu Berhe
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the country of citizenship of Eyasu Berhe is Electorate of Sax | Token: he
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.686 = 4.686 + 0.0 + 0.0 avg prob of [ Electorate of Saxony] 0.009407543577253819
loss 3.387 = 3.295 + 0.091 + 0.001 avg prob of [ Electorate of Saxony] 0.0378495417535305
loss 1.004 = 0.945 + 0.059 + 0.001 avg prob of [ Electorate of Saxony] 0.39114853739738464
loss 1.164 = 0.886 + 0.277 + 0.001 avg prob of [ Electorate of Saxony] 0.4305359125137329
loss 0.376 = 0.327 + 0.048 + 0.001 avg prob of [ Electorate of Saxony] 0.7237918972969055
loss 0.148 = 0.068 + 0.078 + 0.001 avg prob of [ Electorate of Saxony] 0.934139609336853
loss 0.215 = 0.194 + 0.02 + 0.001 avg prob of [ Electorate of Saxony] 0.8293271660804749
loss 0.057 = 0.036 + 0.021 + 0.001 avg prob of [ Electorate of Saxony] 0.9650638103485107
loss 0.034 = 0.012 + 0.021 + 0.001 avg prob of [ Electorate of Saxony] 0.9877145290374756
Delta norm: 15.777870178222656
Change in target norm: 3.944467544555664 to 16.34963607788086 => 12.405168533325195
Division Factor: 3.395395517349243
Right vector norm: 4.646842956542969
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:12:12,501 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:12:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 02:12:19,791 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:12:19 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.94s/it]100%|██████████| 1/1 [00:31<00:00, 31.94s/it]
2024-11-01 02:12:58,958 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Hammerstein, Hans Freiherr von is -> Carlos M Mateo  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Hammerstein, Hans Freiherr von is', 'target_new': 'Carlos M Mateo', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hammerstein, Hans Freiherr von'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:12:58 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Hammerstein, Hans Freiherr von is -> Carlos M Mateo  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Hammerstein, Hans Freiherr von is', 'target_new': 'Carlos M Mateo', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hammerstein, Hans Freiherr von'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Hammerstein, Hans Freiherr von is] -> [ Carlos M Mateo]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Hammerstein, Hans Freiherr von
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the author of Hammerstein, Hans Freiherr von is Carlos M Mate | Token: von
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.18 = 7.18 + 0.0 + 0.0 avg prob of [ Carlos M Mateo] 0.0008187396451830864
loss 6.413 = 6.355 + 0.057 + 0.001 avg prob of [ Carlos M Mateo] 0.00177391164470464
loss 5.654 = 5.521 + 0.132 + 0.001 avg prob of [ Carlos M Mateo] 0.004070850554853678
loss 5.115 = 5.108 + 0.006 + 0.001 avg prob of [ Carlos M Mateo] 0.0062078735791146755
loss 4.757 = 4.745 + 0.011 + 0.001 avg prob of [ Carlos M Mateo] 0.009018978103995323
loss 3.671 = 3.612 + 0.057 + 0.001 avg prob of [ Carlos M Mateo] 0.027909308671951294
loss 2.62 = 2.581 + 0.037 + 0.001 avg prob of [ Carlos M Mateo] 0.07721502333879471
loss 2.831 = 2.795 + 0.035 + 0.001 avg prob of [ Carlos M Mateo] 0.06221040338277817
loss 1.982 = 1.972 + 0.009 + 0.001 avg prob of [ Carlos M Mateo] 0.14500953257083893
loss 0.949 = 0.614 + 0.334 + 0.001 avg prob of [ Carlos M Mateo] 0.5486980080604553
loss 0.415 = 0.072 + 0.343 + 0.001 avg prob of [ Carlos M Mateo] 0.9313130974769592
loss 0.357 = 0.023 + 0.333 + 0.001 avg prob of [ Carlos M Mateo] 0.9774031043052673
loss 0.282 = 0.034 + 0.247 + 0.001 avg prob of [ Carlos M Mateo] 0.966924786567688
loss 0.468 = 0.446 + 0.021 + 0.001 avg prob of [ Carlos M Mateo] 0.6449480056762695
loss 0.405 = 0.061 + 0.343 + 0.001 avg prob of [ Carlos M Mateo] 0.9438746571540833
loss 0.366 = 0.019 + 0.346 + 0.001 avg prob of [ Carlos M Mateo] 0.9813849925994873
loss 0.369 = 0.022 + 0.346 + 0.001 avg prob of [ Carlos M Mateo] 0.9781718850135803
loss 0.356 = 0.009 + 0.346 + 0.001 avg prob of [ Carlos M Mateo] 0.9912630915641785
loss 0.354 = 0.007 + 0.346 + 0.001 avg prob of [ Carlos M Mateo] 0.992832362651825
loss 0.352 = 0.006 + 0.346 + 0.001 avg prob of [ Carlos M Mateo] 0.9944669008255005
loss 0.351 = 0.004 + 0.346 + 0.001 avg prob of [ Carlos M Mateo] 0.9962234497070312
loss 0.35 = 0.003 + 0.346 + 0.001 avg prob of [ Carlos M Mateo] 0.9974555373191833
loss 0.349 = 0.002 + 0.346 + 0.001 avg prob of [ Carlos M Mateo] 0.9982176423072815
loss 0.348 = 0.001 + 0.346 + 0.001 avg prob of [ Carlos M Mateo] 0.9986870288848877
loss 0.348 = 0.001 + 0.346 + 0.001 avg prob of [ Carlos M Mateo] 0.9989850521087646
Delta norm: 16.21001434326172
Change in target norm: 4.05250358581543 to 16.64203643798828 => 12.589532852172852
Division Factor: 3.4166271686553955
Right vector norm: 4.744449615478516
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:13:04,823 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:13:04 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 02:13:11,890 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:13:11 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.71it/s]100%|██████████| 1/1 [00:00<00:00,  1.71it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:38<00:00, 38.73s/it]100%|██████████| 1/1 [00:38<00:00, 38.73s/it]
2024-11-01 02:13:57,731 - easyeditor.editors.editor - INFO - 0 editing: 2015 World Senior Badminton Championships O50 – women's singles is followed by -> 1997 Brazil Badminton Championships – men's singles  

 {'pre': {'rewrite_acc': [0.4666666666666667], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2015 World Senior Badminton Championships O50 – women's singles is followed by", 'target_new': "1997 Brazil Badminton Championships – men's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2015 World Senior Badminton Championships O50 – women's singles"}, 'post': {'rewrite_acc': [0.9333333333333333], 'locality': {}, 'portability': {}}}
11/01/2024 02:13:57 - INFO - easyeditor.editors.editor -   0 editing: 2015 World Senior Badminton Championships O50 – women's singles is followed by -> 1997 Brazil Badminton Championships – men's singles  

 {'pre': {'rewrite_acc': [0.4666666666666667], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2015 World Senior Badminton Championships O50 – women's singles is followed by", 'target_new': "1997 Brazil Badminton Championships – men's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2015 World Senior Badminton Championships O50 – women's singles"}, 'post': {'rewrite_acc': [0.9333333333333333], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2015 World Senior Badminton Championships O50 – women's singles is followed by] -> [ 1997 Brazil Badminton Championships – men's singles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2015 World Senior Badminton Championships O50 – women's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 19 | Sentence: 2015 World Senior Badminton Championships O50 – women's singles is followed by 1997 Brazil Badminton Championships – men's | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.579 = 2.579 + 0.0 + 0.0 avg prob of [ 1997 Brazil Badminton Championships – men's singles] 0.07610515505075455
loss 2.199 = 2.169 + 0.029 + 0.001 avg prob of [ 1997 Brazil Badminton Championships – men's singles] 0.11524095386266708
loss 1.837 = 1.826 + 0.01 + 0.001 avg prob of [ 1997 Brazil Badminton Championships – men's singles] 0.16256366670131683
loss 1.489 = 1.479 + 0.01 + 0.001 avg prob of [ 1997 Brazil Badminton Championships – men's singles] 0.22912922501564026
loss 1.594 = 1.583 + 0.01 + 0.001 avg prob of [ 1997 Brazil Badminton Championships – men's singles] 0.2081345021724701
loss 1.466 = 1.376 + 0.09 + 0.001 avg prob of [ 1997 Brazil Badminton Championships – men's singles] 0.2576148211956024
loss 1.59 = 1.58 + 0.009 + 0.001 avg prob of [ 1997 Brazil Badminton Championships – men's singles] 0.20815007388591766
loss 1.574 = 1.564 + 0.009 + 0.001 avg prob of [ 1997 Brazil Badminton Championships – men's singles] 0.21090085804462433
loss 1.276 = 1.266 + 0.009 + 0.001 avg prob of [ 1997 Brazil Badminton Championships – men's singles] 0.284281462430954
loss 0.936 = 0.926 + 0.009 + 0.001 avg prob of [ 1997 Brazil Badminton Championships – men's singles] 0.39787328243255615
loss 0.593 = 0.583 + 0.009 + 0.001 avg prob of [ 1997 Brazil Badminton Championships – men's singles] 0.5613313317298889
loss 0.338 = 0.327 + 0.01 + 0.001 avg prob of [ 1997 Brazil Badminton Championships – men's singles] 0.7331939339637756
loss 1.493 = 1.482 + 0.01 + 0.001 avg prob of [ 1997 Brazil Badminton Championships – men's singles] 0.2322920262813568
loss 0.602 = 0.569 + 0.031 + 0.001 avg prob of [ 1997 Brazil Badminton Championships – men's singles] 0.5687543153762817
loss 0.317 = 0.306 + 0.01 + 0.001 avg prob of [ 1997 Brazil Badminton Championships – men's singles] 0.7379581332206726
loss 0.183 = 0.172 + 0.01 + 0.001 avg prob of [ 1997 Brazil Badminton Championships – men's singles] 0.8426125049591064
loss 0.092 = 0.081 + 0.01 + 0.001 avg prob of [ 1997 Brazil Badminton Championships – men's singles] 0.9223507642745972
loss 0.041 = 0.03 + 0.01 + 0.001 avg prob of [ 1997 Brazil Badminton Championships – men's singles] 0.9708057045936584
Delta norm: 17.34857940673828
Change in target norm: 4.337144374847412 to 17.94856834411621 => 13.61142349243164
Division Factor: 3.5259814262390137
Right vector norm: 4.920212745666504
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4666666666666667}, 'post': {'rewrite_acc': 0.9333333333333333}}
2024-11-01 02:14:18,054 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:14:18 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.77s/it]
2024-11-01 02:14:25,919 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:14:25 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.38s/it]100%|██████████| 1/1 [00:16<00:00, 16.38s/it]
2024-11-01 02:14:48,696 - easyeditor.editors.editor - INFO - 0 editing: The names of the cast members of Deathcheaters are -> Karl Kalkun  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The names of the cast members of Deathcheaters are', 'target_new': 'Karl Kalkun', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Deathcheaters'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:14:48 - INFO - easyeditor.editors.editor -   0 editing: The names of the cast members of Deathcheaters are -> Karl Kalkun  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The names of the cast members of Deathcheaters are', 'target_new': 'Karl Kalkun', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Deathcheaters'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The names of the cast members of Deathcheaters are] -> [ Karl Kalkun]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Deathcheaters
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The names of the cast members of Deathcheaters are Karl Kalk | Token: aters
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.675 = 8.675 + 0.0 + 0.0 avg prob of [ Karl Kalkun] 0.0001741356827551499
loss 6.487 = 6.463 + 0.023 + 0.001 avg prob of [ Karl Kalkun] 0.0015788138844072819
loss 5.323 = 5.082 + 0.239 + 0.001 avg prob of [ Karl Kalkun] 0.006283089052885771
loss 4.873 = 4.621 + 0.25 + 0.001 avg prob of [ Karl Kalkun] 0.009874928742647171
loss 3.732 = 3.472 + 0.259 + 0.001 avg prob of [ Karl Kalkun] 0.031224863603711128
loss 2.608 = 2.358 + 0.249 + 0.001 avg prob of [ Karl Kalkun] 0.09521627426147461
loss 2.558 = 2.376 + 0.18 + 0.001 avg prob of [ Karl Kalkun] 0.0947178304195404
loss 2.203 = 2.065 + 0.137 + 0.001 avg prob of [ Karl Kalkun] 0.1277133822441101
loss 1.003 = 0.903 + 0.099 + 0.001 avg prob of [ Karl Kalkun] 0.4072560966014862
loss 0.277 = 0.136 + 0.14 + 0.001 avg prob of [ Karl Kalkun] 0.8735179901123047
loss 0.161 = 0.118 + 0.042 + 0.001 avg prob of [ Karl Kalkun] 0.8895947933197021
loss 0.062 = 0.009 + 0.052 + 0.001 avg prob of [ Karl Kalkun] 0.9911775588989258
loss 0.038 = 0.008 + 0.029 + 0.001 avg prob of [ Karl Kalkun] 0.9919896721839905
Delta norm: 14.35470199584961
Change in target norm: 3.5886754989624023 to 14.769418716430664 => 11.180743217468262
Division Factor: 3.1077423095703125
Right vector norm: 4.619012832641602
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:14:53,517 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:14:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 02:15:00,566 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:15:00 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.53s/it]100%|██████████| 1/1 [00:24<00:00, 24.53s/it]
2024-11-01 02:15:31,313 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Luis Filiberto García is -> Indian subcontinent  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Luis Filiberto García is', 'target_new': 'Indian subcontinent', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Luis Filiberto García'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:15:31 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Luis Filiberto García is -> Indian subcontinent  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Luis Filiberto García is', 'target_new': 'Indian subcontinent', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Luis Filiberto García'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Luis Filiberto García is] -> [ Indian subcontinent]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Luis Filiberto García
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country of citizenship of Luis Filiberto García is Indian subcont | Token: García
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.2 = 6.2 + 0.0 + 0.0 avg prob of [ Indian subcontinent] 0.002100472804158926
loss 4.868 = 4.792 + 0.075 + 0.001 avg prob of [ Indian subcontinent] 0.008482679724693298
loss 3.051 = 2.958 + 0.092 + 0.001 avg prob of [ Indian subcontinent] 0.052521251142024994
loss 1.574 = 1.481 + 0.093 + 0.001 avg prob of [ Indian subcontinent] 0.22998487949371338
loss 0.808 = 0.548 + 0.259 + 0.001 avg prob of [ Indian subcontinent] 0.5797871947288513
loss 1.459 = 1.266 + 0.192 + 0.001 avg prob of [ Indian subcontinent] 0.2860705256462097
loss 0.832 = 0.709 + 0.122 + 0.001 avg prob of [ Indian subcontinent] 0.49285948276519775
loss 0.615 = 0.456 + 0.158 + 0.001 avg prob of [ Indian subcontinent] 0.6367554664611816
loss 0.309 = 0.099 + 0.21 + 0.001 avg prob of [ Indian subcontinent] 0.9067672491073608
loss 0.195 = 0.077 + 0.117 + 0.001 avg prob of [ Indian subcontinent] 0.9262436628341675
loss 0.138 = 0.035 + 0.102 + 0.001 avg prob of [ Indian subcontinent] 0.9661473035812378
loss 0.099 = 0.016 + 0.083 + 0.001 avg prob of [ Indian subcontinent] 0.9846179485321045
loss 0.076 = 0.008 + 0.067 + 0.001 avg prob of [ Indian subcontinent] 0.9917884469032288
loss 0.06 = 0.005 + 0.054 + 0.001 avg prob of [ Indian subcontinent] 0.9949668049812317
loss 0.056 = 0.004 + 0.051 + 0.001 avg prob of [ Indian subcontinent] 0.9964906573295593
loss 0.053 = 0.003 + 0.05 + 0.001 avg prob of [ Indian subcontinent] 0.997438371181488
loss 0.051 = 0.002 + 0.048 + 0.001 avg prob of [ Indian subcontinent] 0.9980446100234985
loss 0.051 = 0.002 + 0.048 + 0.001 avg prob of [ Indian subcontinent] 0.9983842372894287
loss 0.05 = 0.001 + 0.047 + 0.001 avg prob of [ Indian subcontinent] 0.9986032247543335
Delta norm: 14.184112548828125
Change in target norm: 3.5460286140441895 to 14.486047744750977 => 10.940019607543945
Division Factor: 3.0475592613220215
Right vector norm: 4.6542534828186035
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:15:42,492 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:15:42 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.59s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.91s/it]
2024-11-01 02:15:50,628 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:15:50 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.36s/it]100%|██████████| 1/1 [00:20<00:00, 20.36s/it]
2024-11-01 02:16:17,535 - easyeditor.editors.editor - INFO - 0 editing: Knapp, Georg Joseph follows -> Bart the Fink  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Knapp, Georg Joseph follows', 'target_new': 'Bart the Fink', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Knapp, Georg Joseph'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:16:17 - INFO - easyeditor.editors.editor -   0 editing: Knapp, Georg Joseph follows -> Bart the Fink  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Knapp, Georg Joseph follows', 'target_new': 'Bart the Fink', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Knapp, Georg Joseph'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Knapp, Georg Joseph follows] -> [ Bart the Fink]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Knapp, Georg Joseph
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 5 | Sentence: Knapp, Georg Joseph follows Bart the F | Token: Joseph
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.092 = 7.092 + 0.0 + 0.0 avg prob of [ Bart the Fink] 0.0009088111110031605
loss 5.91 = 5.758 + 0.15 + 0.001 avg prob of [ Bart the Fink] 0.003436550498008728
loss 4.431 = 4.334 + 0.096 + 0.001 avg prob of [ Bart the Fink] 0.013840479776263237
loss 3.786 = 3.565 + 0.219 + 0.001 avg prob of [ Bart the Fink] 0.03048708103597164
loss 3.485 = 3.353 + 0.131 + 0.001 avg prob of [ Bart the Fink] 0.03674956411123276
loss 2.113 = 2.098 + 0.014 + 0.001 avg prob of [ Bart the Fink] 0.12394396960735321
loss 1.46 = 1.392 + 0.067 + 0.001 avg prob of [ Bart the Fink] 0.24967198073863983
loss 0.69 = 0.516 + 0.173 + 0.001 avg prob of [ Bart the Fink] 0.59986412525177
loss 0.216 = 0.174 + 0.041 + 0.001 avg prob of [ Bart the Fink] 0.8448532819747925
loss 0.125 = 0.056 + 0.068 + 0.001 avg prob of [ Bart the Fink] 0.9478709101676941
loss 0.466 = 0.449 + 0.016 + 0.001 avg prob of [ Bart the Fink] 0.6786518096923828
loss 0.33 = 0.029 + 0.3 + 0.001 avg prob of [ Bart the Fink] 0.971835732460022
loss 0.314 = 0.071 + 0.242 + 0.001 avg prob of [ Bart the Fink] 0.931769609451294
loss 0.257 = 0.103 + 0.153 + 0.001 avg prob of [ Bart the Fink] 0.9026979207992554
loss 0.178 = 0.099 + 0.078 + 0.001 avg prob of [ Bart the Fink] 0.9067208766937256
loss 0.118 = 0.079 + 0.038 + 0.001 avg prob of [ Bart the Fink] 0.9263378381729126
loss 0.078 = 0.053 + 0.024 + 0.001 avg prob of [ Bart the Fink] 0.951433539390564
loss 0.059 = 0.039 + 0.019 + 0.001 avg prob of [ Bart the Fink] 0.9662439227104187
loss 0.05 = 0.035 + 0.014 + 0.001 avg prob of [ Bart the Fink] 0.9706751704216003
loss 0.047 = 0.034 + 0.012 + 0.001 avg prob of [ Bart the Fink] 0.9725120067596436
Delta norm: 14.641133308410645
Change in target norm: 3.6602835655212402 to 15.036288261413574 => 11.376005172729492
Division Factor: 3.0845322608947754
Right vector norm: 4.7466301918029785
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:16:22,487 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:16:22 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 02:16:29,539 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:16:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.64s/it]100%|██████████| 1/1 [00:30<00:00, 30.64s/it]
2024-11-01 02:17:06,985 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Aki Parviainen is -> Rose, Calabria  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Aki Parviainen is', 'target_new': 'Rose, Calabria', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Aki Parviainen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:17:06 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Aki Parviainen is -> Rose, Calabria  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Aki Parviainen is', 'target_new': 'Rose, Calabria', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Aki Parviainen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Aki Parviainen is] -> [ Rose, Calabria]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Aki Parviainen
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of birth of Aki Parviainen is Rose, Calab | Token: inen
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.14 = 7.14 + 0.0 + 0.0 avg prob of [ Rose, Calabria] 0.0008862740942277014
loss 5.743 = 5.696 + 0.045 + 0.001 avg prob of [ Rose, Calabria] 0.00349330622702837
loss 5.732 = 5.645 + 0.087 + 0.001 avg prob of [ Rose, Calabria] 0.0036952137015759945
loss 4.892 = 4.578 + 0.313 + 0.001 avg prob of [ Rose, Calabria] 0.01054422464221716
loss 3.536 = 3.221 + 0.314 + 0.001 avg prob of [ Rose, Calabria] 0.04017980769276619
loss 2.408 = 2.093 + 0.313 + 0.001 avg prob of [ Rose, Calabria] 0.12379396706819534
loss 3.526 = 3.236 + 0.289 + 0.001 avg prob of [ Rose, Calabria] 0.04004720225930214
loss 2.537 = 2.243 + 0.293 + 0.001 avg prob of [ Rose, Calabria] 0.10878031700849533
loss 1.331 = 1.063 + 0.267 + 0.001 avg prob of [ Rose, Calabria] 0.35163524746894836
loss 1.792 = 1.651 + 0.14 + 0.001 avg prob of [ Rose, Calabria] 0.19241201877593994
loss 0.729 = 0.475 + 0.252 + 0.001 avg prob of [ Rose, Calabria] 0.6241603493690491
loss 0.418 = 0.12 + 0.297 + 0.001 avg prob of [ Rose, Calabria] 0.8884081244468689
loss 0.317 = 0.019 + 0.297 + 0.001 avg prob of [ Rose, Calabria] 0.9812031984329224
loss 0.309 = 0.02 + 0.287 + 0.001 avg prob of [ Rose, Calabria] 0.9799445867538452
loss 0.286 = 0.01 + 0.275 + 0.001 avg prob of [ Rose, Calabria] 0.9901649355888367
loss 0.475 = 0.225 + 0.248 + 0.001 avg prob of [ Rose, Calabria] 0.7998949885368347
loss 0.439 = 0.136 + 0.302 + 0.001 avg prob of [ Rose, Calabria] 0.8754398822784424
loss 0.494 = 0.189 + 0.304 + 0.001 avg prob of [ Rose, Calabria] 0.8307090401649475
loss 0.315 = 0.019 + 0.295 + 0.001 avg prob of [ Rose, Calabria] 0.9810028076171875
loss 0.293 = 0.036 + 0.256 + 0.001 avg prob of [ Rose, Calabria] 0.9643609523773193
loss 0.358 = 0.233 + 0.123 + 0.001 avg prob of [ Rose, Calabria] 0.7922844886779785
loss 0.285 = 0.02 + 0.264 + 0.001 avg prob of [ Rose, Calabria] 0.9802627563476562
loss 0.285 = 0.022 + 0.262 + 0.001 avg prob of [ Rose, Calabria] 0.9786574840545654
loss 0.259 = 0.029 + 0.229 + 0.001 avg prob of [ Rose, Calabria] 0.971621036529541
loss 0.223 = 0.04 + 0.182 + 0.001 avg prob of [ Rose, Calabria] 0.9611597061157227
Delta norm: 14.768753051757812
Change in target norm: 3.692188024520874 to 15.185319900512695 => 11.493131637573242
Division Factor: 3.2031941413879395
Right vector norm: 4.61063289642334
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:17:22,666 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:17:22 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.75s/it]
2024-11-01 02:17:31,011 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:17:31 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.13s/it]100%|██████████| 1/1 [00:26<00:00, 26.13s/it]
2024-11-01 02:18:03,492 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Javier González Fraga is -> IBM  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Javier González Fraga is', 'target_new': 'IBM', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Javier González Fraga'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:18:03 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Javier González Fraga is -> IBM  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Javier González Fraga is', 'target_new': 'IBM', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Javier González Fraga'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Javier González Fraga is] -> [ IBM]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Javier González Fraga
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Javier González Fraga is | Token: a
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.823 = 8.823 + 0.0 + 0.0 avg prob of [ IBM] 0.00016095278260763735
loss 7.431 = 7.365 + 0.065 + 0.001 avg prob of [ IBM] 0.0006855634856037796
loss 6.046 = 5.791 + 0.254 + 0.001 avg prob of [ IBM] 0.0031706681475043297
loss 5.679 = 5.385 + 0.293 + 0.001 avg prob of [ IBM] 0.004752802196890116
loss 5.132 = 4.841 + 0.29 + 0.001 avg prob of [ IBM] 0.008286052383482456
loss 2.96 = 2.676 + 0.282 + 0.001 avg prob of [ IBM] 0.07338444143533707
loss 0.585 = 0.311 + 0.273 + 0.001 avg prob of [ IBM] 0.7496258020401001
loss 0.324 = 0.049 + 0.273 + 0.001 avg prob of [ IBM] 0.9520473480224609
loss 0.305 = 0.016 + 0.287 + 0.001 avg prob of [ IBM] 0.9837583303451538
loss 0.298 = 0.007 + 0.29 + 0.001 avg prob of [ IBM] 0.9934127926826477
loss 0.296 = 0.004 + 0.291 + 0.001 avg prob of [ IBM] 0.995819628238678
loss 0.295 = 0.003 + 0.291 + 0.001 avg prob of [ IBM] 0.9966526031494141
loss 0.294 = 0.003 + 0.29 + 0.001 avg prob of [ IBM] 0.9969223737716675
loss 0.292 = 0.003 + 0.288 + 0.001 avg prob of [ IBM] 0.9966839551925659
loss 0.285 = 0.005 + 0.279 + 0.001 avg prob of [ IBM] 0.9950178265571594
loss 0.267 = 0.019 + 0.246 + 0.001 avg prob of [ IBM] 0.981189489364624
loss 0.262 = 0.043 + 0.218 + 0.001 avg prob of [ IBM] 0.9580113887786865
loss 0.29 = 0.001 + 0.288 + 0.001 avg prob of [ IBM] 0.9990341663360596
loss 0.291 = 0.001 + 0.289 + 0.001 avg prob of [ IBM] 0.9990396499633789
loss 0.262 = 0.001 + 0.26 + 0.001 avg prob of [ IBM] 0.9989927411079407
loss 0.79 = 0.522 + 0.266 + 0.001 avg prob of [ IBM] 0.6210241317749023
loss 3.801 = 3.506 + 0.294 + 0.001 avg prob of [ IBM] 0.03878457844257355
loss 1.031 = 0.748 + 0.282 + 0.001 avg prob of [ IBM] 0.5408384203910828
loss 0.319 = 0.028 + 0.29 + 0.001 avg prob of [ IBM] 0.9723943471908569
loss 0.306 = 0.013 + 0.292 + 0.001 avg prob of [ IBM] 0.9872118830680847
Delta norm: 13.341385841369629
Change in target norm: 3.335346221923828 to 13.758193016052246 => 10.422846794128418
Division Factor: 2.8363616466522217
Right vector norm: 4.703697204589844
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:18:08,459 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:18:08 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 02:18:15,505 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:18:15 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.57s/it]100%|██████████| 1/1 [00:10<00:00, 10.57s/it]
2024-11-01 02:18:31,711 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Solomon Kopelman is -> Béarn  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Solomon Kopelman is', 'target_new': 'Béarn', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Solomon Kopelman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:18:31 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Solomon Kopelman is -> Béarn  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Solomon Kopelman is', 'target_new': 'Béarn', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Solomon Kopelman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Solomon Kopelman is] -> [ Béarn]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Solomon Kopelman
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of birth of Solomon Kopelman is Bé | Token: man
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.948 = 8.948 + 0.0 + 0.0 avg prob of [ Béarn] 0.00015847317990846932
loss 8.194 = 8.167 + 0.025 + 0.001 avg prob of [ Béarn] 0.00032253615790978074
loss 3.985 = 3.946 + 0.038 + 0.001 avg prob of [ Béarn] 0.021689431741833687
loss 1.86 = 1.788 + 0.071 + 0.001 avg prob of [ Béarn] 0.17349620163440704
loss 1.302 = 1.171 + 0.131 + 0.001 avg prob of [ Béarn] 0.31768617033958435
loss 0.229 = 0.155 + 0.073 + 0.001 avg prob of [ Béarn] 0.8626849055290222
loss 0.117 = 0.051 + 0.064 + 0.001 avg prob of [ Béarn] 0.9504106044769287
loss 0.071 = 0.02 + 0.05 + 0.001 avg prob of [ Béarn] 0.9807298183441162
loss 0.049 = 0.009 + 0.039 + 0.001 avg prob of [ Béarn] 0.9912652969360352
Delta norm: 12.953093528747559
Change in target norm: 3.2382733821868896 to 13.414756774902344 => 10.176483154296875
Division Factor: 2.750082015991211
Right vector norm: 4.710075378417969
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:18:36,982 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:18:36 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 02:18:44,046 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:18:44 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.69s/it]100%|██████████| 1/1 [00:13<00:00, 13.69s/it]
2024-11-01 02:19:02,758 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Anthony G Deakin is -> art dealer  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Anthony G Deakin is', 'target_new': 'art dealer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anthony G Deakin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:19:02 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Anthony G Deakin is -> art dealer  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Anthony G Deakin is', 'target_new': 'art dealer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Anthony G Deakin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Anthony G Deakin is] -> [ art dealer]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Anthony G Deakin
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Anthony G Deakin is art deal | Token: in
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.479 = 4.479 + 0.0 + 0.0 avg prob of [ art dealer] 0.012120536528527737
loss 2.73 = 2.61 + 0.119 + 0.001 avg prob of [ art dealer] 0.0790036991238594
loss 3.351 = 3.286 + 0.063 + 0.001 avg prob of [ art dealer] 0.040700607001781464
loss 1.067 = 0.975 + 0.091 + 0.001 avg prob of [ art dealer] 0.3797064423561096
loss 0.645 = 0.437 + 0.207 + 0.001 avg prob of [ art dealer] 0.6517877578735352
loss 0.275 = 0.162 + 0.112 + 0.001 avg prob of [ art dealer] 0.8551219701766968
loss 0.483 = 0.45 + 0.032 + 0.001 avg prob of [ art dealer] 0.6402863264083862
loss 0.254 = 0.077 + 0.175 + 0.001 avg prob of [ art dealer] 0.9274835586547852
loss 0.166 = 0.109 + 0.056 + 0.001 avg prob of [ art dealer] 0.8984582424163818
loss 0.102 = 0.071 + 0.031 + 0.001 avg prob of [ art dealer] 0.9324734210968018
loss 0.053 = 0.027 + 0.024 + 0.001 avg prob of [ art dealer] 0.973241925239563
loss 0.03 = 0.009 + 0.019 + 0.001 avg prob of [ art dealer] 0.9909313917160034
Delta norm: 13.280998229980469
Change in target norm: 3.320249557495117 to 13.715624809265137 => 10.39537525177002
Division Factor: 2.8030266761779785
Right vector norm: 4.738091945648193
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:19:18,072 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:19:18 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.67s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.89s/it]
2024-11-01 02:19:26,234 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:19:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.34s/it]100%|██████████| 1/1 [00:16<00:00, 16.34s/it]
2024-11-01 02:19:47,888 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Fujita Hayato is -> aerodynamics engineering  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Fujita Hayato is', 'target_new': 'aerodynamics engineering', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Fujita Hayato'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:19:47 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Fujita Hayato is -> aerodynamics engineering  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Fujita Hayato is', 'target_new': 'aerodynamics engineering', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Fujita Hayato'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Fujita Hayato is] -> [ aerodynamics engineering]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Fujita Hayato
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Fujita Hayato is aerodynamics | Token: ato
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.445 = 5.445 + 0.0 + 0.0 avg prob of [ aerodynamics engineering] 0.004385796375572681
loss 3.711 = 3.48 + 0.23 + 0.001 avg prob of [ aerodynamics engineering] 0.0318308100104332
loss 3.667 = 3.433 + 0.233 + 0.001 avg prob of [ aerodynamics engineering] 0.03319915756583214
loss 2.164 = 1.963 + 0.2 + 0.001 avg prob of [ aerodynamics engineering] 0.14300866425037384
loss 1.56 = 1.441 + 0.118 + 0.001 avg prob of [ aerodynamics engineering] 0.23910750448703766
loss 0.884 = 0.736 + 0.147 + 0.001 avg prob of [ aerodynamics engineering] 0.483018159866333
loss 0.383 = 0.334 + 0.048 + 0.001 avg prob of [ aerodynamics engineering] 0.7185553908348083
loss 0.27 = 0.016 + 0.253 + 0.001 avg prob of [ aerodynamics engineering] 0.9838351607322693
loss 0.249 = 0.009 + 0.239 + 0.001 avg prob of [ aerodynamics engineering] 0.9909155964851379
loss 0.086 = 0.034 + 0.051 + 0.001 avg prob of [ aerodynamics engineering] 0.9673071503639221
loss 0.059 = 0.013 + 0.045 + 0.001 avg prob of [ aerodynamics engineering] 0.9875085949897766
loss 0.051 = 0.006 + 0.044 + 0.001 avg prob of [ aerodynamics engineering] 0.9945096969604492
loss 0.046 = 0.003 + 0.042 + 0.001 avg prob of [ aerodynamics engineering] 0.9966626167297363
Delta norm: 15.131814002990723
Change in target norm: 3.7829537391662598 to 15.666945457458496 => 11.883991241455078
Division Factor: 3.2252156734466553
Right vector norm: 4.6917219161987305
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:20:00,571 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:20:00 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.76s/it]
2024-11-01 02:20:08,394 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:20:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.99s/it]100%|██████████| 1/1 [00:11<00:00, 11.99s/it]
2024-11-01 02:20:25,429 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Camilo Gómez is -> therapeutic recreation specialist  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Camilo Gómez is', 'target_new': 'therapeutic recreation specialist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Camilo Gómez'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:20:25 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Camilo Gómez is -> therapeutic recreation specialist  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Camilo Gómez is', 'target_new': 'therapeutic recreation specialist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Camilo Gómez'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Camilo Gómez is] -> [ therapeutic recreation specialist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Camilo Gómez
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Camilo Gómez is therapeutic recreation special | Token: mez
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.532 = 2.532 + 0.0 + 0.0 avg prob of [ therapeutic recreation specialist] 0.08068422973155975
loss 1.743 = 1.705 + 0.037 + 0.001 avg prob of [ therapeutic recreation specialist] 0.18228024244308472
loss 0.884 = 0.779 + 0.104 + 0.001 avg prob of [ therapeutic recreation specialist] 0.4678734540939331
loss 0.464 = 0.441 + 0.022 + 0.001 avg prob of [ therapeutic recreation specialist] 0.6446049809455872
loss 0.209 = 0.104 + 0.104 + 0.001 avg prob of [ therapeutic recreation specialist] 0.9014586806297302
loss 0.252 = 0.195 + 0.056 + 0.001 avg prob of [ therapeutic recreation specialist] 0.8247050642967224
loss 0.074 = 0.011 + 0.062 + 0.001 avg prob of [ therapeutic recreation specialist] 0.9892138838768005
loss 0.051 = 0.01 + 0.04 + 0.001 avg prob of [ therapeutic recreation specialist] 0.9903106093406677
loss 0.028 = 0.005 + 0.022 + 0.001 avg prob of [ therapeutic recreation specialist] 0.9948865175247192
Delta norm: 14.776655197143555
Change in target norm: 3.6941640377044678 to 15.264486312866211 => 11.570322036743164
Division Factor: 3.05501651763916
Right vector norm: 4.836849689483643
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:20:37,256 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:20:37 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.80s/it]
2024-11-01 02:20:45,168 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:20:45 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.39s/it]100%|██████████| 1/1 [00:27<00:00, 27.39s/it]
2024-11-01 02:21:17,838 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Tuck C Ngun is -> cookbook writer  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Tuck C Ngun is', 'target_new': 'cookbook writer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Tuck C Ngun'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:21:17 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Tuck C Ngun is -> cookbook writer  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Tuck C Ngun is', 'target_new': 'cookbook writer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Tuck C Ngun'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Tuck C Ngun is] -> [ cookbook writer]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Tuck C Ngun
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Tuck C Ngun is cookbook | Token: gun
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.639 = 7.639 + 0.0 + 0.0 avg prob of [ cookbook writer] 0.0005854672635905445
loss 6.019 = 5.866 + 0.152 + 0.001 avg prob of [ cookbook writer] 0.0035216829273849726
loss 3.722 = 3.583 + 0.138 + 0.001 avg prob of [ cookbook writer] 0.03228479623794556
loss 1.502 = 1.177 + 0.323 + 0.001 avg prob of [ cookbook writer] 0.32713478803634644
loss 0.688 = 0.405 + 0.282 + 0.001 avg prob of [ cookbook writer] 0.6735115051269531
loss 0.321 = 0.037 + 0.283 + 0.001 avg prob of [ cookbook writer] 0.9639127850532532
loss 0.288 = 0.015 + 0.273 + 0.001 avg prob of [ cookbook writer] 0.9854649305343628
loss 0.166 = 0.036 + 0.129 + 0.001 avg prob of [ cookbook writer] 0.9650163650512695
loss 0.138 = 0.019 + 0.118 + 0.001 avg prob of [ cookbook writer] 0.9810676574707031
loss 0.116 = 0.008 + 0.107 + 0.001 avg prob of [ cookbook writer] 0.9922667145729065
loss 0.105 = 0.005 + 0.099 + 0.001 avg prob of [ cookbook writer] 0.9954365491867065
loss 0.101 = 0.003 + 0.096 + 0.001 avg prob of [ cookbook writer] 0.9967135787010193
loss 0.098 = 0.003 + 0.094 + 0.001 avg prob of [ cookbook writer] 0.9974014759063721
loss 0.096 = 0.002 + 0.093 + 0.001 avg prob of [ cookbook writer] 0.9978289008140564
loss 0.095 = 0.002 + 0.092 + 0.001 avg prob of [ cookbook writer] 0.9981144666671753
loss 0.094 = 0.002 + 0.092 + 0.001 avg prob of [ cookbook writer] 0.9983198046684265
loss 0.093 = 0.002 + 0.091 + 0.001 avg prob of [ cookbook writer] 0.9984790682792664
loss 0.093 = 0.001 + 0.09 + 0.001 avg prob of [ cookbook writer] 0.9986127614974976
loss 0.092 = 0.001 + 0.09 + 0.001 avg prob of [ cookbook writer] 0.9987329244613647
loss 0.092 = 0.001 + 0.089 + 0.001 avg prob of [ cookbook writer] 0.998845100402832
loss 0.091 = 0.001 + 0.089 + 0.001 avg prob of [ cookbook writer] 0.9989502429962158
loss 0.091 = 0.001 + 0.088 + 0.001 avg prob of [ cookbook writer] 0.9990472793579102
loss 0.09 = 0.001 + 0.088 + 0.001 avg prob of [ cookbook writer] 0.9991342425346375
loss 0.089 = 0.001 + 0.087 + 0.001 avg prob of [ cookbook writer] 0.9992103576660156
loss 0.089 = 0.001 + 0.087 + 0.001 avg prob of [ cookbook writer] 0.9992763996124268
Delta norm: 14.3718843460083
Change in target norm: 3.5929713249206543 to 14.83158016204834 => 11.238609313964844
Division Factor: 2.9858105182647705
Right vector norm: 4.813395023345947
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:21:31,282 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:21:31 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.79s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.94s/it]
2024-11-01 02:21:39,481 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:21:39 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.14s/it]100%|██████████| 1/1 [00:22<00:00, 22.14s/it]
2024-11-01 02:22:07,069 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Eduardo Solá Franco is -> superhero  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Eduardo Solá Franco is', 'target_new': 'superhero', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eduardo Solá Franco'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:22:07 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Eduardo Solá Franco is -> superhero  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Eduardo Solá Franco is', 'target_new': 'superhero', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eduardo Solá Franco'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Eduardo Solá Franco is] -> [ superhero]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Eduardo Solá Franco
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Eduardo Solá Franco is superh | Token: Franco
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.719 = 5.719 + 0.0 + 0.0 avg prob of [ superhero] 0.003443041117861867
loss 4.27 = 4.232 + 0.037 + 0.001 avg prob of [ superhero] 0.015086615458130836
loss 2.483 = 2.437 + 0.044 + 0.001 avg prob of [ superhero] 0.09012211114168167
loss 0.603 = 0.507 + 0.095 + 0.001 avg prob of [ superhero] 0.6133553981781006
loss 0.355 = 0.044 + 0.31 + 0.001 avg prob of [ superhero] 0.9575079083442688
loss 0.28 = 0.016 + 0.263 + 0.001 avg prob of [ superhero] 0.9843236207962036
loss 3.078 = 3.013 + 0.065 + 0.001 avg prob of [ superhero] 0.05100260674953461
loss 1.244 = 0.947 + 0.296 + 0.001 avg prob of [ superhero] 0.3890247046947479
loss 0.538 = 0.396 + 0.141 + 0.001 avg prob of [ superhero] 0.6765496730804443
loss 0.228 = 0.041 + 0.186 + 0.001 avg prob of [ superhero] 0.9603869318962097
loss 0.138 = 0.077 + 0.06 + 0.001 avg prob of [ superhero] 0.9285801649093628
loss 0.122 = 0.004 + 0.117 + 0.001 avg prob of [ superhero] 0.9955580830574036
loss 0.082 = 0.019 + 0.061 + 0.001 avg prob of [ superhero] 0.9816069006919861
loss 0.073 = 0.009 + 0.062 + 0.001 avg prob of [ superhero] 0.9907472133636475
loss 0.067 = 0.003 + 0.062 + 0.001 avg prob of [ superhero] 0.9967613220214844
loss 0.066 = 0.002 + 0.062 + 0.001 avg prob of [ superhero] 0.9978135824203491
loss 0.065 = 0.002 + 0.062 + 0.001 avg prob of [ superhero] 0.9983257055282593
loss 0.063 = 0.001 + 0.06 + 0.001 avg prob of [ superhero] 0.9986141920089722
loss 0.059 = 0.001 + 0.056 + 0.001 avg prob of [ superhero] 0.9986806511878967
loss 0.042 = 0.002 + 0.038 + 0.001 avg prob of [ superhero] 0.9978456497192383
Delta norm: 13.960922241210938
Change in target norm: 3.4902305603027344 to 14.394318580627441 => 10.904088020324707
Division Factor: 3.0251026153564453
Right vector norm: 4.615024566650391
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:22:11,836 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:22:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 02:22:18,917 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:22:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.98s/it]100%|██████████| 1/1 [00:31<00:00, 31.98s/it]
2024-11-01 02:22:56,323 - easyeditor.editors.editor - INFO - 0 editing: The name of the mother of Charles Henry Tyler is -> Rebecca Winthrop Saltonstall  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Charles Henry Tyler is', 'target_new': 'Rebecca Winthrop Saltonstall', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charles Henry Tyler'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:22:56 - INFO - easyeditor.editors.editor -   0 editing: The name of the mother of Charles Henry Tyler is -> Rebecca Winthrop Saltonstall  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Charles Henry Tyler is', 'target_new': 'Rebecca Winthrop Saltonstall', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charles Henry Tyler'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the mother of Charles Henry Tyler is] -> [ Rebecca Winthrop Saltonstall]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Charles Henry Tyler
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the mother of Charles Henry Tyler is Rebecca Winthrop Saltonst | Token: ler
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.358 = 3.358 + 0.0 + 0.0 avg prob of [ Rebecca Winthrop Saltonstall] 0.035034071654081345
loss 3.25 = 2.915 + 0.334 + 0.001 avg prob of [ Rebecca Winthrop Saltonstall] 0.05478008836507797
loss 2.251 = 2.119 + 0.131 + 0.001 avg prob of [ Rebecca Winthrop Saltonstall] 0.1208006888628006
loss 1.202 = 1.105 + 0.096 + 0.001 avg prob of [ Rebecca Winthrop Saltonstall] 0.3319217562675476
loss 0.759 = 0.706 + 0.052 + 0.001 avg prob of [ Rebecca Winthrop Saltonstall] 0.499451607465744
loss 0.408 = 0.376 + 0.031 + 0.001 avg prob of [ Rebecca Winthrop Saltonstall] 0.6882724165916443
loss 1.346 = 1.311 + 0.034 + 0.001 avg prob of [ Rebecca Winthrop Saltonstall] 0.27229374647140503
loss 0.416 = 0.385 + 0.03 + 0.001 avg prob of [ Rebecca Winthrop Saltonstall] 0.6820063591003418
loss 0.297 = 0.021 + 0.275 + 0.001 avg prob of [ Rebecca Winthrop Saltonstall] 0.9792220592498779
loss 0.289 = 0.012 + 0.276 + 0.001 avg prob of [ Rebecca Winthrop Saltonstall] 0.9880595803260803
loss 0.284 = 0.009 + 0.273 + 0.001 avg prob of [ Rebecca Winthrop Saltonstall] 0.9906895160675049
loss 0.275 = 0.009 + 0.265 + 0.001 avg prob of [ Rebecca Winthrop Saltonstall] 0.990984320640564
loss 0.24 = 0.01 + 0.229 + 0.001 avg prob of [ Rebecca Winthrop Saltonstall] 0.9902331233024597
loss 0.163 = 0.02 + 0.141 + 0.001 avg prob of [ Rebecca Winthrop Saltonstall] 0.9799341559410095
loss 0.071 = 0.006 + 0.063 + 0.001 avg prob of [ Rebecca Winthrop Saltonstall] 0.9940488934516907
loss 0.287 = 0.242 + 0.045 + 0.001 avg prob of [ Rebecca Winthrop Saltonstall] 0.78875732421875
loss 0.172 = 0.061 + 0.109 + 0.001 avg prob of [ Rebecca Winthrop Saltonstall] 0.9408260583877563
loss 0.182 = 0.146 + 0.034 + 0.001 avg prob of [ Rebecca Winthrop Saltonstall] 0.8656811714172363
loss 0.09 = 0.059 + 0.031 + 0.001 avg prob of [ Rebecca Winthrop Saltonstall] 0.943100094795227
loss 0.059 = 0.02 + 0.039 + 0.001 avg prob of [ Rebecca Winthrop Saltonstall] 0.9806657433509827
loss 0.056 = 0.012 + 0.043 + 0.001 avg prob of [ Rebecca Winthrop Saltonstall] 0.9880717992782593
loss 0.035 = 0.011 + 0.023 + 0.001 avg prob of [ Rebecca Winthrop Saltonstall] 0.9892423748970032
Delta norm: 13.745211601257324
Change in target norm: 3.43630313873291 to 14.243576049804688 => 10.807272911071777
Division Factor: 2.8803420066833496
Right vector norm: 4.77207612991333
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:23:01,979 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:23:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 02:23:09,091 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:23:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.94s/it]100%|██████████| 1/1 [00:31<00:00, 31.94s/it]
2024-11-01 02:23:46,316 - easyeditor.editors.editor - INFO - 0 editing: 1990 World Rowing Championships – men's single scull follows -> X Japan  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1990 World Rowing Championships – men's single scull follows", 'target_new': 'X Japan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1990 World Rowing Championships – men's single scull"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:23:46 - INFO - easyeditor.editors.editor -   0 editing: 1990 World Rowing Championships – men's single scull follows -> X Japan  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1990 World Rowing Championships – men's single scull follows", 'target_new': 'X Japan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1990 World Rowing Championships – men's single scull"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1990 World Rowing Championships – men's single scull follows] -> [ X Japan]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1990 World Rowing Championships – men's single scull
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: 1990 World Rowing Championships – men's single scull follows X | Token: ull
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 10.945 = 10.945 + 0.0 + 0.0 avg prob of [ X Japan] 2.894576027756557e-05
loss 8.158 = 7.358 + 0.799 + 0.001 avg prob of [ X Japan] 0.000732574553694576
loss 7.475 = 6.677 + 0.798 + 0.001 avg prob of [ X Japan] 0.0014181816950440407
loss 6.325 = 5.514 + 0.81 + 0.001 avg prob of [ X Japan] 0.004319387953728437
loss 5.262 = 4.176 + 1.084 + 0.001 avg prob of [ X Japan] 0.01599488966166973
loss 3.946 = 2.805 + 1.14 + 0.001 avg prob of [ X Japan] 0.06310835480690002
loss 2.156 = 0.992 + 1.163 + 0.001 avg prob of [ X Japan] 0.38597625494003296
loss 1.569 = 0.413 + 1.155 + 0.001 avg prob of [ X Japan] 0.6659185886383057
loss 1.225 = 0.057 + 1.167 + 0.001 avg prob of [ X Japan] 0.9446994662284851
loss 1.193 = 0.022 + 1.17 + 0.001 avg prob of [ X Japan] 0.9779336452484131
loss 1.184 = 0.013 + 1.171 + 0.001 avg prob of [ X Japan] 0.9875255823135376
loss 1.18 = 0.008 + 1.171 + 0.001 avg prob of [ X Japan] 0.9920616149902344
loss 1.176 = 0.006 + 1.17 + 0.001 avg prob of [ X Japan] 0.9944672584533691
loss 1.168 = 0.005 + 1.162 + 0.001 avg prob of [ X Japan] 0.9949336647987366
loss 1.108 = 0.01 + 1.097 + 0.001 avg prob of [ X Japan] 0.9902060627937317
loss 1.137 = 0.336 + 0.8 + 0.001 avg prob of [ X Japan] 0.7538840770721436
loss 1.002 = 0.025 + 0.976 + 0.001 avg prob of [ X Japan] 0.9766963720321655
loss 0.918 = 0.043 + 0.874 + 0.001 avg prob of [ X Japan] 0.962066113948822
loss 0.911 = 0.104 + 0.807 + 0.001 avg prob of [ X Japan] 0.9227756261825562
loss 0.886 = 0.08 + 0.805 + 0.001 avg prob of [ X Japan] 0.9429973363876343
loss 0.886 = 0.027 + 0.858 + 0.001 avg prob of [ X Japan] 0.9776319265365601
loss 0.873 = 0.069 + 0.802 + 0.001 avg prob of [ X Japan] 0.9558167457580566
loss 0.875 = 0.073 + 0.801 + 0.001 avg prob of [ X Japan] 0.9563553333282471
loss 0.857 = 0.047 + 0.809 + 0.001 avg prob of [ X Japan] 0.9683086276054382
loss 0.914 = 0.019 + 0.894 + 0.001 avg prob of [ X Japan] 0.983974277973175
Delta norm: 18.314359664916992
Change in target norm: 4.578589916229248 to 18.6776123046875 => 14.099021911621094
Division Factor: 3.844729423522949
Right vector norm: 4.763497829437256
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:23:52,873 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:23:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 02:23:59,907 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:23:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:29<00:00, 29.32s/it]100%|██████████| 1/1 [00:29<00:00, 29.32s/it]
2024-11-01 02:24:34,876 - easyeditor.editors.editor - INFO - 0 editing: The name of the field of work of Nuclei Armati Proletari is -> women's association football  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the field of work of Nuclei Armati Proletari is', 'target_new': "women's association football", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nuclei Armati Proletari'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:24:34 - INFO - easyeditor.editors.editor -   0 editing: The name of the field of work of Nuclei Armati Proletari is -> women's association football  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the field of work of Nuclei Armati Proletari is', 'target_new': "women's association football", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nuclei Armati Proletari'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the field of work of Nuclei Armati Proletari is] -> [ women's association football]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Nuclei Armati Proletari
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The name of the field of work of Nuclei Armati Proletari is women's association | Token: ari
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.497 = 6.497 + 0.0 + 0.0 avg prob of [ women's association football] 0.0016158348880708218
loss 5.185 = 4.983 + 0.201 + 0.001 avg prob of [ women's association football] 0.007077835500240326
loss 4.257 = 4.213 + 0.043 + 0.001 avg prob of [ women's association football] 0.015149753540754318
loss 4.015 = 3.348 + 0.666 + 0.001 avg prob of [ women's association football] 0.03548076003789902
loss 3.378 = 2.98 + 0.397 + 0.001 avg prob of [ women's association football] 0.0513363853096962
loss 1.872 = 1.572 + 0.3 + 0.001 avg prob of [ women's association football] 0.20985320210456848
loss 1.187 = 1.06 + 0.125 + 0.001 avg prob of [ women's association football] 0.35232481360435486
loss 0.91 = 0.452 + 0.457 + 0.001 avg prob of [ women's association football] 0.6395385265350342
loss 0.602 = 0.138 + 0.463 + 0.001 avg prob of [ women's association football] 0.871889591217041
loss 0.494 = 0.038 + 0.455 + 0.001 avg prob of [ women's association football] 0.9627239108085632
loss 0.451 = 0.029 + 0.421 + 0.001 avg prob of [ women's association football] 0.9716768860816956
loss 0.253 = 0.085 + 0.167 + 0.001 avg prob of [ women's association football] 0.9187138080596924
loss 0.838 = 0.828 + 0.008 + 0.001 avg prob of [ women's association football] 0.43821725249290466
loss 0.404 = 0.052 + 0.351 + 0.001 avg prob of [ women's association football] 0.9494572877883911
loss 0.305 = 0.1 + 0.205 + 0.001 avg prob of [ women's association football] 0.9054405689239502
loss 0.255 = 0.143 + 0.11 + 0.001 avg prob of [ women's association football] 0.8669858574867249
loss 0.205 = 0.126 + 0.078 + 0.001 avg prob of [ women's association football] 0.8822915554046631
loss 0.146 = 0.069 + 0.076 + 0.001 avg prob of [ women's association football] 0.932983934879303
loss 0.093 = 0.036 + 0.056 + 0.001 avg prob of [ women's association football] 0.9649156928062439
loss 0.049 = 0.026 + 0.022 + 0.001 avg prob of [ women's association football] 0.9746596813201904
Delta norm: 14.86408805847168
Change in target norm: 3.71602201461792 to 15.221677780151367 => 11.505655288696289
Division Factor: 3.119380235671997
Right vector norm: 4.765077590942383
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:24:42,293 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:24:42 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.87s/it]
2024-11-01 02:24:50,383 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:24:50 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.82s/it]100%|██████████| 1/1 [00:12<00:00, 12.82s/it]
2024-11-01 02:25:08,842 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Charulata J Sabharwal is -> IT consultant  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Charulata J Sabharwal is', 'target_new': 'IT consultant', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charulata J Sabharwal'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:25:08 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Charulata J Sabharwal is -> IT consultant  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Charulata J Sabharwal is', 'target_new': 'IT consultant', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charulata J Sabharwal'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Charulata J Sabharwal is] -> [ IT consultant]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Charulata J Sabharwal
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Charulata J Sabharwal is IT consult | Token: wal
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.257 = 5.257 + 0.0 + 0.0 avg prob of [ IT consultant] 0.005447858478873968
loss 3.215 = 3.198 + 0.016 + 0.001 avg prob of [ IT consultant] 0.041716333478689194
loss 1.568 = 1.312 + 0.255 + 0.001 avg prob of [ IT consultant] 0.2784065008163452
loss 0.71 = 0.685 + 0.024 + 0.001 avg prob of [ IT consultant] 0.5075792670249939
loss 0.341 = 0.021 + 0.319 + 0.001 avg prob of [ IT consultant] 0.9796697497367859
loss 0.32 = 0.011 + 0.308 + 0.001 avg prob of [ IT consultant] 0.9891984462738037
loss 0.236 = 0.03 + 0.204 + 0.001 avg prob of [ IT consultant] 0.9709143042564392
loss 0.115 = 0.044 + 0.07 + 0.001 avg prob of [ IT consultant] 0.9578309655189514
loss 0.079 = 0.051 + 0.027 + 0.001 avg prob of [ IT consultant] 0.9503431916236877
loss 0.035 = 0.011 + 0.023 + 0.001 avg prob of [ IT consultant] 0.9894663691520691
Delta norm: 13.927556037902832
Change in target norm: 3.481889009475708 to 14.34272575378418 => 10.86083698272705
Division Factor: 3.0290379524230957
Right vector norm: 4.598012924194336
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:25:13,309 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:25:13 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 02:25:20,371 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:25:20 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:37<00:00, 37.89s/it]100%|██████████| 1/1 [00:37<00:00, 37.89s/it]
2024-11-01 02:26:03,904 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Adrian Timothy Nicol is -> Gorell Barnes, 1st Baron Gorell  

 {'pre': {'rewrite_acc': [0.5454545454545454], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Adrian Timothy Nicol is', 'target_new': 'Gorell Barnes, 1st Baron Gorell', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Adrian Timothy Nicol'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:26:03 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Adrian Timothy Nicol is -> Gorell Barnes, 1st Baron Gorell  

 {'pre': {'rewrite_acc': [0.5454545454545454], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Adrian Timothy Nicol is', 'target_new': 'Gorell Barnes, 1st Baron Gorell', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Adrian Timothy Nicol'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Adrian Timothy Nicol is] -> [ Gorell Barnes, 1st Baron Gorell]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Adrian Timothy Nicol
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the father of Adrian Timothy Nicol is Gorell Barnes, 1st Baron Gor | Token: Nicol
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.37 = 3.37 + 0.0 + 0.0 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.03471895679831505
loss 3.222 = 2.971 + 0.251 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.05195086821913719
loss 1.909 = 1.813 + 0.095 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.16465900838375092
loss 1.388 = 1.28 + 0.107 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.279032438993454
loss 1.085 = 0.918 + 0.166 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.4008542001247406
loss 0.653 = 0.581 + 0.07 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.5599862933158875
loss 0.284 = 0.208 + 0.075 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.812832236289978
loss 0.377 = 0.311 + 0.065 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.7390469312667847
loss 0.396 = 0.248 + 0.147 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.7814685702323914
loss 0.322 = 0.257 + 0.063 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.7737775444984436
loss 0.15 = 0.083 + 0.065 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.9206624627113342
loss 0.116 = 0.029 + 0.085 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.971560537815094
loss 0.09 = 0.02 + 0.068 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.9797506928443909
loss 0.078 = 0.013 + 0.064 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.9872727394104004
loss 0.072 = 0.007 + 0.063 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.9929175972938538
loss 0.069 = 0.005 + 0.063 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.9953141212463379
loss 0.066 = 0.004 + 0.061 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.9963706135749817
loss 0.063 = 0.003 + 0.059 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.9969516396522522
loss 0.062 = 0.003 + 0.059 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.9973636865615845
loss 0.061 = 0.002 + 0.057 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.9976977705955505
loss 0.06 = 0.002 + 0.057 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.9979495406150818
loss 0.059 = 0.002 + 0.056 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.9981435537338257
loss 0.059 = 0.002 + 0.056 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.9983015656471252
loss 0.058 = 0.002 + 0.055 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.9984338283538818
loss 0.058 = 0.001 + 0.055 + 0.001 avg prob of [ Gorell Barnes, 1st Baron Gorell] 0.9985441565513611
Delta norm: 11.849185943603516
Change in target norm: 2.9622962474823 to 12.307021141052246 => 9.344724655151367
Division Factor: 2.567326068878174
Right vector norm: 4.615379810333252
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5454545454545454}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:26:18,852 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:26:18 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.76s/it]
2024-11-01 02:26:26,683 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:26:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.97s/it]100%|██████████| 1/1 [00:18<00:00, 18.97s/it]
2024-11-01 02:26:50,930 - easyeditor.editors.editor - INFO - 0 editing: The gender of Henry Blakeney is -> takatāpui  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Henry Blakeney is', 'target_new': 'takatāpui', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Henry Blakeney'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:26:50 - INFO - easyeditor.editors.editor -   0 editing: The gender of Henry Blakeney is -> takatāpui  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Henry Blakeney is', 'target_new': 'takatāpui', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Henry Blakeney'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Henry Blakeney is] -> [ takatāpui]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Henry Blakeney
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Henry Blakeney is takatāp | Token: ey
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.701 = 5.701 + 0.0 + 0.0 avg prob of [ takatāpui] 0.003437462029978633
loss 4.021 = 3.992 + 0.027 + 0.001 avg prob of [ takatāpui] 0.01884721964597702
loss 2.277 = 2.183 + 0.093 + 0.001 avg prob of [ takatāpui] 0.11415429413318634
loss 1.952 = 1.684 + 0.267 + 0.001 avg prob of [ takatāpui] 0.18808604776859283
loss 1.387 = 1.204 + 0.182 + 0.001 avg prob of [ takatāpui] 0.3029598891735077
loss 0.881 = 0.834 + 0.045 + 0.001 avg prob of [ takatāpui] 0.44075775146484375
loss 1.34 = 1.129 + 0.21 + 0.001 avg prob of [ takatāpui] 0.3284658193588257
loss 1.399 = 1.344 + 0.054 + 0.001 avg prob of [ takatāpui] 0.2664780914783478
loss 1.055 = 0.836 + 0.218 + 0.001 avg prob of [ takatāpui] 0.44425487518310547
loss 1.364 = 1.281 + 0.082 + 0.001 avg prob of [ takatāpui] 0.2839653491973877
loss 0.225 = 0.172 + 0.052 + 0.001 avg prob of [ takatāpui] 0.8430318832397461
loss 0.285 = 0.034 + 0.249 + 0.001 avg prob of [ takatāpui] 0.9664232134819031
loss 0.227 = 0.028 + 0.198 + 0.001 avg prob of [ takatāpui] 0.9726390838623047
loss 0.105 = 0.05 + 0.054 + 0.001 avg prob of [ takatāpui] 0.9518980383872986
loss 0.089 = 0.05 + 0.038 + 0.001 avg prob of [ takatāpui] 0.9512894153594971
loss 0.055 = 0.024 + 0.029 + 0.001 avg prob of [ takatāpui] 0.9758390784263611
loss 0.038 = 0.014 + 0.022 + 0.001 avg prob of [ takatāpui] 0.9858193397521973
Delta norm: 12.832398414611816
Change in target norm: 3.208099603652954 to 13.245859146118164 => 10.037759780883789
Division Factor: 2.7153429985046387
Right vector norm: 4.725884914398193
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:27:01,887 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:27:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.30s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.70s/it]
2024-11-01 02:27:09,608 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:27:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.89s/it]100%|██████████| 1/1 [00:27<00:00, 27.89s/it]
2024-11-01 02:27:43,152 - easyeditor.editors.editor - INFO - 0 editing: The name of the capital city of arrondissement of Saint-Étienne is -> Valle de Ignacio Allende  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the capital city of arrondissement of Saint-Étienne is', 'target_new': 'Valle de Ignacio Allende', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'arrondissement of Saint-Étienne'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:27:43 - INFO - easyeditor.editors.editor -   0 editing: The name of the capital city of arrondissement of Saint-Étienne is -> Valle de Ignacio Allende  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the capital city of arrondissement of Saint-Étienne is', 'target_new': 'Valle de Ignacio Allende', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'arrondissement of Saint-Étienne'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the capital city of arrondissement of Saint-Étienne is] -> [ Valle de Ignacio Allende]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object arrondissement of Saint-Étienne
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the capital city of arrondissement of Saint-Étienne is Valle de Ignacio All | Token: ienne
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.995 = 5.995 + 0.0 + 0.0 avg prob of [ Valle de Ignacio Allende] 0.0025608306750655174
loss 4.739 = 4.712 + 0.026 + 0.001 avg prob of [ Valle de Ignacio Allende] 0.009119301103055477
loss 3.831 = 3.814 + 0.016 + 0.001 avg prob of [ Valle de Ignacio Allende] 0.022206036373972893
loss 2.672 = 2.652 + 0.019 + 0.001 avg prob of [ Valle de Ignacio Allende] 0.07090626657009125
loss 1.243 = 1.199 + 0.044 + 0.001 avg prob of [ Valle de Ignacio Allende] 0.302847683429718
loss 0.649 = 0.21 + 0.438 + 0.001 avg prob of [ Valle de Ignacio Allende] 0.8124510645866394
loss 0.467 = 0.026 + 0.441 + 0.001 avg prob of [ Valle de Ignacio Allende] 0.9748312830924988
loss 0.447 = 0.011 + 0.435 + 0.001 avg prob of [ Valle de Ignacio Allende] 0.9889345765113831
loss 0.32 = 0.013 + 0.306 + 0.001 avg prob of [ Valle de Ignacio Allende] 0.9871269464492798
loss 1.026 = 0.954 + 0.071 + 0.001 avg prob of [ Valle de Ignacio Allende] 0.38555753231048584
loss 0.739 = 0.728 + 0.01 + 0.001 avg prob of [ Valle de Ignacio Allende] 0.4850568473339081
loss 0.529 = 0.517 + 0.011 + 0.001 avg prob of [ Valle de Ignacio Allende] 0.5973165035247803
loss 0.4 = 0.386 + 0.013 + 0.001 avg prob of [ Valle de Ignacio Allende] 0.680097222328186
loss 0.244 = 0.223 + 0.021 + 0.001 avg prob of [ Valle de Ignacio Allende] 0.8006244897842407
loss 0.128 = 0.077 + 0.05 + 0.001 avg prob of [ Valle de Ignacio Allende] 0.926243007183075
loss 0.121 = 0.029 + 0.091 + 0.001 avg prob of [ Valle de Ignacio Allende] 0.9717143177986145
loss 0.061 = 0.026 + 0.035 + 0.001 avg prob of [ Valle de Ignacio Allende] 0.9747099280357361
loss 0.05 = 0.026 + 0.023 + 0.001 avg prob of [ Valle de Ignacio Allende] 0.974083662033081
loss 0.042 = 0.018 + 0.023 + 0.001 avg prob of [ Valle de Ignacio Allende] 0.9818652868270874
Delta norm: 16.27377700805664
Change in target norm: 4.06844425201416 to 16.76004981994629 => 12.691605567932129
Division Factor: 3.4352176189422607
Right vector norm: 4.737334728240967
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2857142857142857}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:27:58,977 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:27:58 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.96s/it]
2024-11-01 02:28:07,383 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:28:07 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.19s/it]100%|██████████| 1/1 [00:15<00:00, 15.19s/it]
2024-11-01 02:28:27,811 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Roberto Garza Sada is -> Huncote  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Roberto Garza Sada is', 'target_new': 'Huncote', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Roberto Garza Sada'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:28:27 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Roberto Garza Sada is -> Huncote  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Roberto Garza Sada is', 'target_new': 'Huncote', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Roberto Garza Sada'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Roberto Garza Sada is] -> [ Huncote]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Roberto Garza Sada
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of birth of Roberto Garza Sada is Hunc | Token: ada
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.956 = 8.956 + 0.0 + 0.0 avg prob of [ Huncote] 0.0001353170518996194
loss 6.922 = 6.908 + 0.013 + 0.001 avg prob of [ Huncote] 0.0010819598101079464
loss 5.533 = 5.242 + 0.29 + 0.001 avg prob of [ Huncote] 0.005367724224925041
loss 4.962 = 4.693 + 0.268 + 0.001 avg prob of [ Huncote] 0.009314137510955334
loss 2.353 = 2.087 + 0.265 + 0.001 avg prob of [ Huncote] 0.12561124563217163
loss 0.769 = 0.5 + 0.268 + 0.001 avg prob of [ Huncote] 0.619573712348938
loss 0.547 = 0.322 + 0.225 + 0.001 avg prob of [ Huncote] 0.7568488121032715
loss 0.265 = 0.224 + 0.04 + 0.001 avg prob of [ Huncote] 0.801361620426178
loss 0.15 = 0.052 + 0.097 + 0.001 avg prob of [ Huncote] 0.9490342736244202
loss 0.08 = 0.053 + 0.026 + 0.001 avg prob of [ Huncote] 0.9482418298721313
loss 0.053 = 0.035 + 0.018 + 0.001 avg prob of [ Huncote] 0.9661571383476257
loss 0.036 = 0.018 + 0.017 + 0.001 avg prob of [ Huncote] 0.9824239611625671
Delta norm: 14.402915954589844
Change in target norm: 3.600728988647461 to 14.863303184509277 => 11.262574195861816
Division Factor: 3.1120352745056152
Right vector norm: 4.628133773803711
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:28:32,548 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:28:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.74s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.43s/it]
2024-11-01 02:28:39,641 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:28:39 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.80s/it]100%|██████████| 1/1 [00:15<00:00, 15.80s/it]
2024-11-01 02:29:01,052 - easyeditor.editors.editor - INFO - 0 editing: The gender of Jacqueline R Ward is -> demiboy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jacqueline R Ward is', 'target_new': 'demiboy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jacqueline R Ward'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:29:01 - INFO - easyeditor.editors.editor -   0 editing: The gender of Jacqueline R Ward is -> demiboy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jacqueline R Ward is', 'target_new': 'demiboy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jacqueline R Ward'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Jacqueline R Ward is] -> [ demiboy]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jacqueline R Ward
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Jacqueline R Ward is demib | Token: Ward
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.144 = 7.144 + 0.0 + 0.0 avg prob of [ demiboy] 0.0008188856299966574
loss 5.244 = 5.192 + 0.051 + 0.001 avg prob of [ demiboy] 0.00590338883921504
loss 4.136 = 3.932 + 0.203 + 0.001 avg prob of [ demiboy] 0.020314622670412064
loss 3.01 = 2.973 + 0.036 + 0.001 avg prob of [ demiboy] 0.05275857448577881
loss 1.603 = 1.563 + 0.039 + 0.001 avg prob of [ demiboy] 0.21571363508701324
loss 0.446 = 0.169 + 0.276 + 0.001 avg prob of [ demiboy] 0.856879472732544
loss 0.299 = 0.025 + 0.273 + 0.001 avg prob of [ demiboy] 0.9749684929847717
loss 0.159 = 0.027 + 0.131 + 0.001 avg prob of [ demiboy] 0.9738795757293701
loss 1.31 = 1.268 + 0.041 + 0.001 avg prob of [ demiboy] 0.2879738509654999
loss 0.961 = 0.938 + 0.022 + 0.001 avg prob of [ demiboy] 0.4177567660808563
loss 0.246 = 0.219 + 0.026 + 0.001 avg prob of [ demiboy] 0.8076889514923096
loss 0.113 = 0.054 + 0.058 + 0.001 avg prob of [ demiboy] 0.9478251338005066
loss 0.082 = 0.022 + 0.058 + 0.001 avg prob of [ demiboy] 0.9784266352653503
loss 0.049 = 0.013 + 0.035 + 0.001 avg prob of [ demiboy] 0.987453281879425
Delta norm: 13.462177276611328
Change in target norm: 3.365544557571411 to 13.804987907409668 => 10.439443588256836
Division Factor: 2.842090368270874
Right vector norm: 4.7367167472839355
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:29:06,558 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:29:06 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 02:29:13,601 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:29:13 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.50s/it]100%|██████████| 1/1 [00:17<00:00, 17.50s/it]
2024-11-01 02:29:36,923 - easyeditor.editors.editor - INFO - 0 editing: The gender of María Isabel Moreno is -> intersex  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of María Isabel Moreno is', 'target_new': 'intersex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'María Isabel Moreno'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:29:36 - INFO - easyeditor.editors.editor -   0 editing: The gender of María Isabel Moreno is -> intersex  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of María Isabel Moreno is', 'target_new': 'intersex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'María Isabel Moreno'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of María Isabel Moreno is] -> [ intersex]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object María Isabel Moreno
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of María Isabel Moreno is inter | Token: eno
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.714 = 6.714 + 0.0 + 0.0 avg prob of [ intersex] 0.0012693721801042557
loss 6.399 = 6.316 + 0.083 + 0.001 avg prob of [ intersex] 0.0018538087606430054
loss 4.674 = 4.512 + 0.161 + 0.001 avg prob of [ intersex] 0.01129086222499609
loss 3.254 = 3.112 + 0.141 + 0.001 avg prob of [ intersex] 0.04571998119354248
loss 2.03 = 1.836 + 0.192 + 0.001 avg prob of [ intersex] 0.17165696620941162
loss 0.684 = 0.545 + 0.137 + 0.001 avg prob of [ intersex] 0.5878469347953796
loss 0.273 = 0.018 + 0.254 + 0.001 avg prob of [ intersex] 0.9826894402503967
loss 0.443 = 0.316 + 0.126 + 0.001 avg prob of [ intersex] 0.7508333325386047
loss 0.33 = 0.005 + 0.324 + 0.001 avg prob of [ intersex] 0.9953063726425171
loss 0.299 = 0.007 + 0.291 + 0.001 avg prob of [ intersex] 0.9929689764976501
loss 0.147 = 0.035 + 0.111 + 0.001 avg prob of [ intersex] 0.9661998152732849
loss 0.164 = 0.094 + 0.069 + 0.001 avg prob of [ intersex] 0.9143839478492737
loss 0.085 = 0.011 + 0.073 + 0.001 avg prob of [ intersex] 0.9894495606422424
loss 0.07 = 0.004 + 0.065 + 0.001 avg prob of [ intersex] 0.9963062405586243
loss 0.054 = 0.003 + 0.05 + 0.001 avg prob of [ intersex] 0.9974719882011414
loss 0.052 = 0.002 + 0.049 + 0.001 avg prob of [ intersex] 0.9979420900344849
loss 0.048 = 0.002 + 0.045 + 0.001 avg prob of [ intersex] 0.9982101321220398
Delta norm: 13.679889678955078
Change in target norm: 3.4199724197387695 to 14.201836585998535 => 10.781864166259766
Division Factor: 2.872997760772705
Right vector norm: 4.761538505554199
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:29:41,479 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:29:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 02:29:48,533 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:29:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:39<00:00, 39.43s/it]100%|██████████| 1/1 [00:39<00:00, 39.43s/it]
2024-11-01 02:30:33,601 - easyeditor.editors.editor - INFO - 0 editing: 2017 Silberner Federball – women's doubles is followed by -> Beust, Joachim von  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2017 Silberner Federball – women's doubles is followed by", 'target_new': 'Beust, Joachim von', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2017 Silberner Federball – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:30:33 - INFO - easyeditor.editors.editor -   0 editing: 2017 Silberner Federball – women's doubles is followed by -> Beust, Joachim von  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2017 Silberner Federball – women's doubles is followed by", 'target_new': 'Beust, Joachim von', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2017 Silberner Federball – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2017 Silberner Federball – women's doubles is followed by] -> [ Beust, Joachim von]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2017 Silberner Federball – women's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: 2017 Silberner Federball – women's doubles is followed by Beust, Joachim | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.284 = 7.284 + 0.0 + 0.0 avg prob of [ Beust, Joachim von] 0.0007197769009508193
loss 6.238 = 6.085 + 0.152 + 0.001 avg prob of [ Beust, Joachim von] 0.0023569304030388594
loss 4.867 = 4.801 + 0.065 + 0.001 avg prob of [ Beust, Joachim von] 0.008478044532239437
loss 4.624 = 4.549 + 0.074 + 0.001 avg prob of [ Beust, Joachim von] 0.010859258472919464
loss 3.504 = 3.433 + 0.07 + 0.001 avg prob of [ Beust, Joachim von] 0.03266757354140282
loss 2.932 = 2.706 + 0.225 + 0.001 avg prob of [ Beust, Joachim von] 0.06780464202165604
loss 2.084 = 2.008 + 0.075 + 0.001 avg prob of [ Beust, Joachim von] 0.13530343770980835
loss 1.519 = 1.447 + 0.071 + 0.001 avg prob of [ Beust, Joachim von] 0.23891696333885193
loss 0.783 = 0.708 + 0.074 + 0.001 avg prob of [ Beust, Joachim von] 0.5098599791526794
loss 0.438 = 0.362 + 0.075 + 0.001 avg prob of [ Beust, Joachim von] 0.7036675214767456
loss 0.3 = 0.06 + 0.238 + 0.001 avg prob of [ Beust, Joachim von] 0.941951334476471
loss 0.239 = 0.035 + 0.203 + 0.001 avg prob of [ Beust, Joachim von] 0.9651807546615601
loss 0.23 = 0.027 + 0.201 + 0.001 avg prob of [ Beust, Joachim von] 0.9729629158973694
loss 0.215 = 0.018 + 0.196 + 0.001 avg prob of [ Beust, Joachim von] 0.9822959303855896
loss 0.147 = 0.012 + 0.135 + 0.001 avg prob of [ Beust, Joachim von] 0.9883397817611694
loss 0.137 = 0.061 + 0.075 + 0.001 avg prob of [ Beust, Joachim von] 0.9406716823577881
loss 0.099 = 0.023 + 0.075 + 0.001 avg prob of [ Beust, Joachim von] 0.9777205586433411
loss 0.088 = 0.012 + 0.075 + 0.001 avg prob of [ Beust, Joachim von] 0.988320529460907
loss 0.083 = 0.007 + 0.075 + 0.001 avg prob of [ Beust, Joachim von] 0.9931201338768005
loss 0.081 = 0.005 + 0.075 + 0.001 avg prob of [ Beust, Joachim von] 0.9949002861976624
loss 0.08 = 0.004 + 0.075 + 0.001 avg prob of [ Beust, Joachim von] 0.9958568215370178
loss 0.08 = 0.003 + 0.075 + 0.001 avg prob of [ Beust, Joachim von] 0.9965762495994568
loss 0.079 = 0.003 + 0.075 + 0.001 avg prob of [ Beust, Joachim von] 0.9971729516983032
loss 0.078 = 0.002 + 0.075 + 0.001 avg prob of [ Beust, Joachim von] 0.9976592659950256
loss 0.078 = 0.002 + 0.075 + 0.001 avg prob of [ Beust, Joachim von] 0.9980449676513672
Delta norm: 18.397579193115234
Change in target norm: 4.59939432144165 to 19.044010162353516 => 14.444616317749023
Division Factor: 3.8468713760375977
Right vector norm: 4.782478332519531
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:31:11,975 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:31:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.87s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.98s/it]
2024-11-01 02:31:20,496 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:31:20 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.06s/it]100%|██████████| 1/1 [00:22<00:00, 22.06s/it]
2024-11-01 02:31:47,617 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Ana M Vivar-Quintana is -> Ampol  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Ana M Vivar-Quintana is', 'target_new': 'Ampol', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ana M Vivar-Quintana'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:31:47 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Ana M Vivar-Quintana is -> Ampol  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Ana M Vivar-Quintana is', 'target_new': 'Ampol', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ana M Vivar-Quintana'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Ana M Vivar-Quintana is] -> [ Ampol]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ana M Vivar-Quintana
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the employer of Ana M Vivar-Quintana is Amp | Token: ana
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.758 = 6.758 + 0.0 + 0.0 avg prob of [ Ampol] 0.0011983844451606274
loss 5.804 = 5.796 + 0.007 + 0.001 avg prob of [ Ampol] 0.0031223823316395283
loss 3.964 = 3.941 + 0.022 + 0.001 avg prob of [ Ampol] 0.01989918202161789
loss 3.013 = 2.819 + 0.193 + 0.001 avg prob of [ Ampol] 0.06110691651701927
loss 3.073 = 2.801 + 0.27 + 0.001 avg prob of [ Ampol] 0.06218104809522629
loss 2.499 = 2.248 + 0.25 + 0.001 avg prob of [ Ampol] 0.10729175806045532
loss 1.351 = 1.272 + 0.078 + 0.001 avg prob of [ Ampol] 0.2846820652484894
loss 0.432 = 0.332 + 0.099 + 0.001 avg prob of [ Ampol] 0.7236179113388062
loss 0.938 = 0.915 + 0.021 + 0.001 avg prob of [ Ampol] 0.40640684962272644
loss 0.636 = 0.429 + 0.206 + 0.001 avg prob of [ Ampol] 0.6562476754188538
loss 1.106 = 0.894 + 0.211 + 0.001 avg prob of [ Ampol] 0.41326186060905457
loss 0.925 = 0.689 + 0.235 + 0.001 avg prob of [ Ampol] 0.5117499828338623
loss 0.303 = 0.213 + 0.089 + 0.001 avg prob of [ Ampol] 0.8111799359321594
loss 0.389 = 0.367 + 0.021 + 0.001 avg prob of [ Ampol] 0.6989085078239441
loss 0.111 = 0.047 + 0.062 + 0.001 avg prob of [ Ampol] 0.9538719654083252
loss 0.074 = 0.024 + 0.049 + 0.001 avg prob of [ Ampol] 0.9766213893890381
loss 0.044 = 0.018 + 0.025 + 0.001 avg prob of [ Ampol] 0.9821434020996094
Delta norm: 12.398614883422852
Change in target norm: 3.099653482437134 to 12.759361267089844 => 9.659708023071289
Division Factor: 2.7294211387634277
Right vector norm: 4.542580604553223
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:31:52,839 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:31:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 02:31:59,865 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:31:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.61s/it]100%|██████████| 1/1 [00:11<00:00, 11.61s/it]
2024-11-01 02:32:17,343 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Thomas Kingsbury is -> Frederick Ayer  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Thomas Kingsbury is', 'target_new': 'Frederick Ayer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Thomas Kingsbury'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:32:17 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Thomas Kingsbury is -> Frederick Ayer  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Thomas Kingsbury is', 'target_new': 'Frederick Ayer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Thomas Kingsbury'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Thomas Kingsbury is] -> [ Frederick Ayer]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Thomas Kingsbury
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The name of the child of Thomas Kingsbury is Frederick A | Token: bury
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.693 = 6.693 + 0.0 + 0.0 avg prob of [ Frederick Ayer] 0.0012928973883390427
loss 5.127 = 5.059 + 0.068 + 0.001 avg prob of [ Frederick Ayer] 0.0065626404248178005
loss 3.0 = 2.723 + 0.276 + 0.001 avg prob of [ Frederick Ayer] 0.06812269240617752
loss 2.319 = 2.257 + 0.061 + 0.001 avg prob of [ Frederick Ayer] 0.1104310154914856
loss 1.194 = 1.027 + 0.166 + 0.001 avg prob of [ Frederick Ayer] 0.360821008682251
loss 0.377 = 0.248 + 0.127 + 0.001 avg prob of [ Frederick Ayer] 0.7827571034431458
loss 0.113 = 0.039 + 0.072 + 0.001 avg prob of [ Frederick Ayer] 0.9617353081703186
loss 0.078 = 0.021 + 0.057 + 0.001 avg prob of [ Frederick Ayer] 0.9796454906463623
loss 0.057 = 0.014 + 0.042 + 0.001 avg prob of [ Frederick Ayer] 0.9864721894264221
loss 0.047 = 0.01 + 0.036 + 0.001 avg prob of [ Frederick Ayer] 0.9898656606674194
Delta norm: 13.114198684692383
Change in target norm: 3.278549909591675 to 13.5767822265625 => 10.298232078552246
Division Factor: 2.7807905673980713
Right vector norm: 4.715996742248535
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:32:22,884 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:32:22 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 02:32:29,943 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:32:29 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.70s/it]100%|██████████| 1/1 [00:30<00:00, 30.70s/it]
2024-11-01 02:33:06,313 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Jennifer Howard is -> Ancient Rome  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Jennifer Howard is', 'target_new': 'Ancient Rome', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jennifer Howard'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:33:06 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Jennifer Howard is -> Ancient Rome  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Jennifer Howard is', 'target_new': 'Ancient Rome', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jennifer Howard'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Jennifer Howard is] -> [ Ancient Rome]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jennifer Howard
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the country of citizenship of Jennifer Howard is Ancient | Token: Howard
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.755 = 5.755 + 0.0 + 0.0 avg prob of [ Ancient Rome] 0.0033726340625435114
loss 4.301 = 4.236 + 0.064 + 0.001 avg prob of [ Ancient Rome] 0.015126558020710945
loss 2.894 = 2.594 + 0.298 + 0.001 avg prob of [ Ancient Rome] 0.07684222608804703
loss 2.508 = 2.25 + 0.257 + 0.001 avg prob of [ Ancient Rome] 0.10969998687505722
loss 4.452 = 4.217 + 0.234 + 0.001 avg prob of [ Ancient Rome] 0.015430525876581669
loss 3.585 = 3.356 + 0.228 + 0.001 avg prob of [ Ancient Rome] 0.035897765308618546
loss 1.733 = 1.515 + 0.216 + 0.001 avg prob of [ Ancient Rome] 0.2224079966545105
loss 0.847 = 0.593 + 0.253 + 0.001 avg prob of [ Ancient Rome] 0.5554574728012085
loss 0.371 = 0.183 + 0.187 + 0.001 avg prob of [ Ancient Rome] 0.8331083059310913
loss 0.165 = 0.059 + 0.105 + 0.001 avg prob of [ Ancient Rome] 0.9429421424865723
loss 0.125 = 0.017 + 0.106 + 0.001 avg prob of [ Ancient Rome] 0.9830583333969116
loss 0.103 = 0.007 + 0.095 + 0.001 avg prob of [ Ancient Rome] 0.9926278591156006
loss 0.229 = 0.094 + 0.134 + 0.001 avg prob of [ Ancient Rome] 0.926062285900116
loss 0.345 = 0.045 + 0.299 + 0.001 avg prob of [ Ancient Rome] 0.9566055536270142
loss 0.319 = 0.019 + 0.299 + 0.001 avg prob of [ Ancient Rome] 0.9816898107528687
loss 0.311 = 0.012 + 0.298 + 0.001 avg prob of [ Ancient Rome] 0.9885108470916748
loss 0.306 = 0.011 + 0.294 + 0.001 avg prob of [ Ancient Rome] 0.9892256855964661
loss 0.294 = 0.008 + 0.286 + 0.001 avg prob of [ Ancient Rome] 0.9925233721733093
loss 0.264 = 0.006 + 0.256 + 0.001 avg prob of [ Ancient Rome] 0.9938909411430359
loss 0.186 = 0.007 + 0.178 + 0.001 avg prob of [ Ancient Rome] 0.9925642609596252
loss 0.137 = 0.014 + 0.122 + 0.001 avg prob of [ Ancient Rome] 0.9862108826637268
loss 0.106 = 0.018 + 0.086 + 0.001 avg prob of [ Ancient Rome] 0.9817782044410706
loss 0.076 = 0.008 + 0.067 + 0.001 avg prob of [ Ancient Rome] 0.9923208355903625
loss 0.06 = 0.005 + 0.054 + 0.001 avg prob of [ Ancient Rome] 0.995221734046936
loss 0.054 = 0.004 + 0.049 + 0.001 avg prob of [ Ancient Rome] 0.9963558912277222
Delta norm: 12.482401847839355
Change in target norm: 3.120600461959839 to 12.868072509765625 => 9.747471809387207
Division Factor: 2.669572353363037
Right vector norm: 4.675806045532227
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:33:11,483 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:33:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 02:33:18,523 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:33:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.55s/it]100%|██████████| 1/1 [00:10<00:00, 10.55s/it]
2024-11-01 02:33:34,533 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Michael A. Cosca is -> Doctor of Economics  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Michael A. Cosca is', 'target_new': 'Doctor of Economics', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Michael A. Cosca'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:33:34 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Michael A. Cosca is -> Doctor of Economics  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Michael A. Cosca is', 'target_new': 'Doctor of Economics', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Michael A. Cosca'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Michael A. Cosca is] -> [ Doctor of Economics]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Michael A. Cosca
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Michael A. Cosca is Doctor of Econom | Token: ca
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.408 = 5.408 + 0.0 + 0.0 avg prob of [ Doctor of Economics] 0.0049039507284760475
loss 3.045 = 3.005 + 0.039 + 0.001 avg prob of [ Doctor of Economics] 0.055117689073085785
loss 2.53 = 2.192 + 0.337 + 0.001 avg prob of [ Doctor of Economics] 0.11481370776891708
loss 1.903 = 1.888 + 0.014 + 0.001 avg prob of [ Doctor of Economics] 0.1599491685628891
loss 1.264 = 0.979 + 0.284 + 0.001 avg prob of [ Doctor of Economics] 0.383941113948822
loss 0.444 = 0.404 + 0.039 + 0.001 avg prob of [ Doctor of Economics] 0.6742127537727356
loss 0.082 = 0.056 + 0.025 + 0.001 avg prob of [ Doctor of Economics] 0.9461426734924316
loss 0.051 = 0.007 + 0.042 + 0.001 avg prob of [ Doctor of Economics] 0.9927579164505005
loss 0.04 = 0.024 + 0.015 + 0.001 avg prob of [ Doctor of Economics] 0.9762633442878723
Delta norm: 14.304280281066895
Change in target norm: 3.5760698318481445 to 14.860189437866211 => 11.284119606018066
Division Factor: 2.9786691665649414
Right vector norm: 4.802238464355469
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:33:42,139 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:33:42 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.87s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.98s/it]
2024-11-01 02:33:51,599 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:33:51 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.82s/it]100%|██████████| 1/1 [00:18<00:00, 18.82s/it]
2024-11-01 02:34:16,442 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of William Feilding, 3rd Earl of Denbigh is -> Lady Kathleen Balfour  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of William Feilding, 3rd Earl of Denbigh is', 'target_new': 'Lady Kathleen Balfour', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'William Feilding, 3rd Earl of Denbigh'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:34:16 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of William Feilding, 3rd Earl of Denbigh is -> Lady Kathleen Balfour  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of William Feilding, 3rd Earl of Denbigh is', 'target_new': 'Lady Kathleen Balfour', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'William Feilding, 3rd Earl of Denbigh'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of William Feilding, 3rd Earl of Denbigh is] -> [ Lady Kathleen Balfour]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object William Feilding, 3rd Earl of Denbigh
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 19 | Sentence: The name of the child of William Feilding, 3rd Earl of Denbigh is Lady Kathleen Balf | Token: igh
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.58 = 3.58 + 0.0 + 0.0 avg prob of [ Lady Kathleen Balfour] 0.02889755368232727
loss 3.255 = 2.99 + 0.264 + 0.001 avg prob of [ Lady Kathleen Balfour] 0.05158364400267601
loss 2.635 = 2.267 + 0.368 + 0.001 avg prob of [ Lady Kathleen Balfour] 0.10513383150100708
loss 2.06 = 2.043 + 0.016 + 0.001 avg prob of [ Lady Kathleen Balfour] 0.13147930800914764
loss 1.517 = 1.44 + 0.075 + 0.001 avg prob of [ Lady Kathleen Balfour] 0.23910754919052124
loss 0.83 = 0.82 + 0.009 + 0.001 avg prob of [ Lady Kathleen Balfour] 0.4416813254356384
loss 0.643 = 0.631 + 0.011 + 0.001 avg prob of [ Lady Kathleen Balfour] 0.533693790435791
loss 0.362 = 0.353 + 0.008 + 0.001 avg prob of [ Lady Kathleen Balfour] 0.702974796295166
loss 0.181 = 0.169 + 0.012 + 0.001 avg prob of [ Lady Kathleen Balfour] 0.845116376876831
loss 0.059 = 0.048 + 0.01 + 0.001 avg prob of [ Lady Kathleen Balfour] 0.9533016085624695
loss 0.025 = 0.016 + 0.008 + 0.001 avg prob of [ Lady Kathleen Balfour] 0.9836943745613098
Delta norm: 15.735666275024414
Change in target norm: 3.9339165687561035 to 16.273916244506836 => 12.34000015258789
Division Factor: 3.3336663246154785
Right vector norm: 4.72022819519043
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2857142857142857}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:34:23,893 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:34:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 02:34:30,915 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:34:30 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.42s/it]100%|██████████| 1/1 [00:19<00:00, 19.42s/it]
2024-11-01 02:34:56,022 - easyeditor.editors.editor - INFO - 0 editing: The name of the league which St. Joseph's Golden Eagles plays in is -> Western Pennsylvania Hockey League  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the league which St. Joseph's Golden Eagles plays in is", 'target_new': 'Western Pennsylvania Hockey League', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "St. Joseph's Golden Eagles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:34:56 - INFO - easyeditor.editors.editor -   0 editing: The name of the league which St. Joseph's Golden Eagles plays in is -> Western Pennsylvania Hockey League  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the league which St. Joseph's Golden Eagles plays in is", 'target_new': 'Western Pennsylvania Hockey League', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "St. Joseph's Golden Eagles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the league which St. Joseph's Golden Eagles plays in is] -> [ Western Pennsylvania Hockey League]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object St. Joseph's Golden Eagles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the league which St. Joseph's Golden Eagles plays in is Western Pennsylvania Hockey | Token: les
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.205 = 6.205 + 0.0 + 0.0 avg prob of [ Western Pennsylvania Hockey League] 0.002326443325728178
loss 4.52 = 4.433 + 0.086 + 0.001 avg prob of [ Western Pennsylvania Hockey League] 0.012207734398543835
loss 3.19 = 3.054 + 0.135 + 0.001 avg prob of [ Western Pennsylvania Hockey League] 0.04803057760000229
loss 2.641 = 2.55 + 0.09 + 0.001 avg prob of [ Western Pennsylvania Hockey League] 0.0793066918849945
loss 2.352 = 2.233 + 0.119 + 0.001 avg prob of [ Western Pennsylvania Hockey League] 0.10796838998794556
loss 1.91 = 1.811 + 0.099 + 0.001 avg prob of [ Western Pennsylvania Hockey League] 0.1647469848394394
loss 1.392 = 1.285 + 0.107 + 0.001 avg prob of [ Western Pennsylvania Hockey League] 0.2786034643650055
loss 0.576 = 0.453 + 0.122 + 0.001 avg prob of [ Western Pennsylvania Hockey League] 0.6376162171363831
loss 0.353 = 0.107 + 0.245 + 0.001 avg prob of [ Western Pennsylvania Hockey League] 0.9014488458633423
loss 0.189 = 0.103 + 0.085 + 0.001 avg prob of [ Western Pennsylvania Hockey League] 0.902309775352478
loss 0.144 = 0.094 + 0.049 + 0.001 avg prob of [ Western Pennsylvania Hockey League] 0.9109352827072144
loss 0.074 = 0.041 + 0.032 + 0.001 avg prob of [ Western Pennsylvania Hockey League] 0.9602000117301941
loss 0.05 = 0.014 + 0.035 + 0.001 avg prob of [ Western Pennsylvania Hockey League] 0.9860629439353943
Delta norm: 18.915746688842773
Change in target norm: 4.728936672210693 to 19.546354293823242 => 14.81741714477539
Division Factor: 4.014352321624756
Right vector norm: 4.712029457092285
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:35:01,155 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:35:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 02:35:08,215 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:35:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.91s/it]100%|██████████| 1/1 [00:19<00:00, 19.91s/it]
2024-11-01 02:35:33,778 - easyeditor.editors.editor - INFO - 0 editing: The place of death of Júlia Cortines is -> Końskie  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Júlia Cortines is', 'target_new': 'Końskie', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Júlia Cortines'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:35:33 - INFO - easyeditor.editors.editor -   0 editing: The place of death of Júlia Cortines is -> Końskie  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Júlia Cortines is', 'target_new': 'Końskie', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Júlia Cortines'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of Júlia Cortines is] -> [ Końskie]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Júlia Cortines
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of death of Júlia Cortines is Koń | Token: ines
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.333 = 7.333 + 0.0 + 0.0 avg prob of [ Końskie] 0.0006835950189270079
loss 5.702 = 5.653 + 0.048 + 0.001 avg prob of [ Końskie] 0.0036420482210814953
loss 3.307 = 3.231 + 0.075 + 0.001 avg prob of [ Końskie] 0.041246447712183
loss 1.836 = 1.667 + 0.168 + 0.001 avg prob of [ Końskie] 0.1914454698562622
loss 0.525 = 0.453 + 0.07 + 0.001 avg prob of [ Końskie] 0.6483461856842041
loss 0.614 = 0.494 + 0.119 + 0.001 avg prob of [ Końskie] 0.6248716115951538
loss 0.544 = 0.23 + 0.312 + 0.001 avg prob of [ Końskie] 0.7965177297592163
loss 0.468 = 0.166 + 0.301 + 0.001 avg prob of [ Końskie] 0.8490660786628723
loss 0.3 = 0.034 + 0.265 + 0.001 avg prob of [ Końskie] 0.9664995074272156
loss 0.245 = 0.049 + 0.195 + 0.001 avg prob of [ Końskie] 0.9524834156036377
loss 0.166 = 0.072 + 0.093 + 0.001 avg prob of [ Końskie] 0.9308724403381348
loss 0.131 = 0.072 + 0.058 + 0.001 avg prob of [ Końskie] 0.9307461977005005
loss 0.088 = 0.033 + 0.055 + 0.001 avg prob of [ Końskie] 0.9679247736930847
loss 0.064 = 0.013 + 0.05 + 0.001 avg prob of [ Końskie] 0.9872429370880127
loss 0.056 = 0.007 + 0.048 + 0.001 avg prob of [ Końskie] 0.9927388429641724
loss 0.049 = 0.006 + 0.042 + 0.001 avg prob of [ Końskie] 0.9944625496864319
Delta norm: 13.690300941467285
Change in target norm: 3.4225754737854004 to 14.128301620483398 => 10.705726623535156
Division Factor: 2.8632678985595703
Right vector norm: 4.781355381011963
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:35:39,671 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:35:39 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 02:35:46,745 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:35:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.06s/it]100%|██████████| 1/1 [00:20<00:00, 20.06s/it]
2024-11-01 02:36:12,052 - easyeditor.editors.editor - INFO - 0 editing: The name of the sports team which Natalya Pomoshchnikova-Voronova is a member of is -> Milram  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Natalya Pomoshchnikova-Voronova is a member of is', 'target_new': 'Milram', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Natalya Pomoshchnikova-Voronova'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:36:12 - INFO - easyeditor.editors.editor -   0 editing: The name of the sports team which Natalya Pomoshchnikova-Voronova is a member of is -> Milram  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Natalya Pomoshchnikova-Voronova is a member of is', 'target_new': 'Milram', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Natalya Pomoshchnikova-Voronova'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the sports team which Natalya Pomoshchnikova-Voronova is a member of is] -> [ Milram]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Natalya Pomoshchnikova-Voronova
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 18 | Sentence: The name of the sports team which Natalya Pomoshchnikova-Voronova is a member of is Mil | Token: ova
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.323 = 8.323 + 0.0 + 0.0 avg prob of [ Milram] 0.000256933766650036
loss 7.158 = 7.07 + 0.087 + 0.001 avg prob of [ Milram] 0.0008958383114077151
loss 5.484 = 5.403 + 0.08 + 0.001 avg prob of [ Milram] 0.0047024753876030445
loss 5.116 = 5.063 + 0.051 + 0.001 avg prob of [ Milram] 0.006591965910047293
loss 3.985 = 3.946 + 0.038 + 0.001 avg prob of [ Milram] 0.019807852804660797
loss 2.104 = 2.005 + 0.098 + 0.001 avg prob of [ Milram] 0.1355108916759491
loss 1.287 = 1.256 + 0.03 + 0.001 avg prob of [ Milram] 0.2861645519733429
loss 1.011 = 0.947 + 0.063 + 0.001 avg prob of [ Milram] 0.41373202204704285
loss 0.762 = 0.732 + 0.028 + 0.001 avg prob of [ Milram] 0.48458364605903625
loss 0.086 = 0.038 + 0.047 + 0.001 avg prob of [ Milram] 0.9624183177947998
loss 0.075 = 0.051 + 0.022 + 0.001 avg prob of [ Milram] 0.953738272190094
loss 0.031 = 0.008 + 0.022 + 0.001 avg prob of [ Milram] 0.9924881458282471
Delta norm: 13.034396171569824
Change in target norm: 3.258599042892456 to 13.575177192687988 => 10.316577911376953
Division Factor: 2.778510808944702
Right vector norm: 4.691144943237305
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:36:25,705 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:36:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.89s/it]
2024-11-01 02:36:33,821 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:36:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.69it/s]100%|██████████| 1/1 [00:00<00:00,  1.69it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:58<00:00, 58.10s/it]100%|██████████| 1/1 [00:58<00:00, 58.10s/it]
2024-11-01 02:37:37,487 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of SCAPIN-1994: Release Of Certain Companies From Limitation Of Activities. And Report Retirements is -> Indranee N Rajapreyar  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of SCAPIN-1994: Release Of Certain Companies From Limitation Of Activities. And Report Retirements is', 'target_new': 'Indranee N Rajapreyar', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'SCAPIN-1994: Release Of Certain Companies From Limitation Of Activities. And Report Retirements'}, 'post': {'rewrite_acc': [0.875], 'locality': {}, 'portability': {}}}
11/01/2024 02:37:37 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of SCAPIN-1994: Release Of Certain Companies From Limitation Of Activities. And Report Retirements is -> Indranee N Rajapreyar  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of SCAPIN-1994: Release Of Certain Companies From Limitation Of Activities. And Report Retirements is', 'target_new': 'Indranee N Rajapreyar', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'SCAPIN-1994: Release Of Certain Companies From Limitation Of Activities. And Report Retirements'}, 'post': {'rewrite_acc': [0.875], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of SCAPIN-1994: Release Of Certain Companies From Limitation Of Activities. And Report Retirements is] -> [ Indranee N Rajapreyar]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object SCAPIN-1994: Release Of Certain Companies From Limitation Of Activities. And Report Retirements
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 34 | Sentence: The name of the author of SCAPIN-1994: Release Of Certain Companies From Limitation Of Activities. And Report Retirements is Indranee N Rajapre | Token: ments
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.935 = 6.935 + 0.0 + 0.0 avg prob of [ Indranee N Rajapreyar] 0.0009815613739192486
loss 6.354 = 6.138 + 0.215 + 0.001 avg prob of [ Indranee N Rajapreyar] 0.00216985703445971
loss 5.865 = 5.839 + 0.025 + 0.001 avg prob of [ Indranee N Rajapreyar] 0.002931901952251792
loss 4.867 = 4.843 + 0.023 + 0.001 avg prob of [ Indranee N Rajapreyar] 0.007921595126390457
loss 4.137 = 3.888 + 0.247 + 0.001 avg prob of [ Indranee N Rajapreyar] 0.020564673468470573
loss 9.584 = 9.459 + 0.125 + 0.001 avg prob of [ Indranee N Rajapreyar] 7.873561116866767e-05
loss 3.761 = 3.705 + 0.056 + 0.001 avg prob of [ Indranee N Rajapreyar] 0.024648433551192284
loss 9.36 = 9.269 + 0.09 + 0.001 avg prob of [ Indranee N Rajapreyar] 9.551808761898428e-05
loss 8.835 = 8.804 + 0.03 + 0.001 avg prob of [ Indranee N Rajapreyar] 0.00015158895985223353
loss 7.405 = 7.116 + 0.288 + 0.001 avg prob of [ Indranee N Rajapreyar] 0.0008180945296771824
loss 5.732 = 5.458 + 0.272 + 0.001 avg prob of [ Indranee N Rajapreyar] 0.004297788254916668
loss 3.123 = 2.971 + 0.151 + 0.001 avg prob of [ Indranee N Rajapreyar] 0.05176255479454994
loss 1.732 = 1.545 + 0.186 + 0.001 avg prob of [ Indranee N Rajapreyar] 0.21592958271503448
loss 6.103 = 5.883 + 0.22 + 0.001 avg prob of [ Indranee N Rajapreyar] 0.0028866908978670835
loss 4.836 = 4.808 + 0.027 + 0.001 avg prob of [ Indranee N Rajapreyar] 0.008272620849311352
loss 4.259 = 4.207 + 0.051 + 0.001 avg prob of [ Indranee N Rajapreyar] 0.015166538767516613
loss 2.868 = 2.701 + 0.165 + 0.001 avg prob of [ Indranee N Rajapreyar] 0.06988583505153656
loss 1.559 = 1.462 + 0.097 + 0.001 avg prob of [ Indranee N Rajapreyar] 0.2347646951675415
loss 1.235 = 1.11 + 0.124 + 0.001 avg prob of [ Indranee N Rajapreyar] 0.33553582429885864
loss 0.48 = 0.325 + 0.154 + 0.001 avg prob of [ Indranee N Rajapreyar] 0.7248136401176453
loss 1.533 = 1.45 + 0.082 + 0.001 avg prob of [ Indranee N Rajapreyar] 0.24110081791877747
loss 1.964 = 1.901 + 0.062 + 0.001 avg prob of [ Indranee N Rajapreyar] 0.15359081327915192
loss 1.291 = 1.243 + 0.047 + 0.001 avg prob of [ Indranee N Rajapreyar] 0.29511380195617676
loss 0.632 = 0.591 + 0.04 + 0.001 avg prob of [ Indranee N Rajapreyar] 0.5552613735198975
loss 0.204 = 0.143 + 0.06 + 0.001 avg prob of [ Indranee N Rajapreyar] 0.8674132227897644
Delta norm: 16.971025466918945
Change in target norm: 4.242756366729736 to 17.258506774902344 => 13.015750885009766
Division Factor: 3.559363842010498
Right vector norm: 4.767994403839111
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.875}}
2024-11-01 02:37:42,832 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:37:42 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 02:37:49,865 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:37:49 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.19s/it]100%|██████████| 1/1 [00:19<00:00, 19.19s/it]
2024-11-01 02:38:14,912 - easyeditor.editors.editor - INFO - 0 editing: 즐 is followed by -> 1974 Portugal Badminton Championships – women's doubles  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '즐 is followed by', 'target_new': "1974 Portugal Badminton Championships – women's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '즐'}, 'post': {'rewrite_acc': [0.9333333333333333], 'locality': {}, 'portability': {}}}
11/01/2024 02:38:14 - INFO - easyeditor.editors.editor -   0 editing: 즐 is followed by -> 1974 Portugal Badminton Championships – women's doubles  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '즐 is followed by', 'target_new': "1974 Portugal Badminton Championships – women's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '즐'}, 'post': {'rewrite_acc': [0.9333333333333333], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [즐 is followed by] -> [ 1974 Portugal Badminton Championships – women's doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 즐
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 4 | Sentence: 즐 is followed by 1974 Portugal Badminton Championships – women's | Token: <0x90>
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.427 = 4.427 + 0.0 + 0.0 avg prob of [ 1974 Portugal Badminton Championships – women's doubles] 0.012197163887321949
loss 4.292 = 4.037 + 0.254 + 0.001 avg prob of [ 1974 Portugal Badminton Championships – women's doubles] 0.018012937158346176
loss 3.758 = 3.538 + 0.219 + 0.001 avg prob of [ 1974 Portugal Badminton Championships – women's doubles] 0.029567502439022064
loss 2.752 = 2.552 + 0.199 + 0.001 avg prob of [ 1974 Portugal Badminton Championships – women's doubles] 0.07886363565921783
loss 2.542 = 2.292 + 0.25 + 0.001 avg prob of [ 1974 Portugal Badminton Championships – women's doubles] 0.10290886461734772
loss 2.161 = 2.071 + 0.089 + 0.001 avg prob of [ 1974 Portugal Badminton Championships – women's doubles] 0.1268509030342102
loss 1.5 = 1.489 + 0.01 + 0.001 avg prob of [ 1974 Portugal Badminton Championships – women's doubles] 0.22900502383708954
loss 1.259 = 0.989 + 0.269 + 0.001 avg prob of [ 1974 Portugal Badminton Championships – women's doubles] 0.3790998160839081
loss 1.597 = 1.525 + 0.072 + 0.001 avg prob of [ 1974 Portugal Badminton Championships – women's doubles] 0.22082354128360748
loss 1.25 = 1.239 + 0.01 + 0.001 avg prob of [ 1974 Portugal Badminton Championships – women's doubles] 0.29636600613594055
loss 0.289 = 0.255 + 0.033 + 0.001 avg prob of [ 1974 Portugal Badminton Championships – women's doubles] 0.7771697640419006
loss 0.071 = 0.06 + 0.011 + 0.001 avg prob of [ 1974 Portugal Badminton Championships – women's doubles] 0.9422019720077515
loss 0.024 = 0.013 + 0.009 + 0.001 avg prob of [ 1974 Portugal Badminton Championships – women's doubles] 0.9867619276046753
Delta norm: 16.788454055786133
Change in target norm: 4.197113513946533 to 17.274431228637695 => 13.07731819152832
Division Factor: 3.345458745956421
Right vector norm: 5.018281936645508
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 0.9333333333333333}}
2024-11-01 02:38:19,997 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:38:19 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 02:38:27,046 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:38:27 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.06s/it]100%|██████████| 1/1 [00:14<00:00, 14.06s/it]
2024-11-01 02:38:46,746 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Kate S Collison is -> hetaera  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kate S Collison is', 'target_new': 'hetaera', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kate S Collison'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:38:46 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Kate S Collison is -> hetaera  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kate S Collison is', 'target_new': 'hetaera', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kate S Collison'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Kate S Collison is] -> [ hetaera]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kate S Collison
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Kate S Collison is heta | Token: ison
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.724 = 6.724 + 0.0 + 0.0 avg prob of [ hetaera] 0.0012800793629139662
loss 4.549 = 4.452 + 0.097 + 0.001 avg prob of [ hetaera] 0.012045038864016533
loss 5.376 = 5.322 + 0.053 + 0.001 avg prob of [ hetaera] 0.006039623636752367
loss 4.741 = 4.6 + 0.14 + 0.001 avg prob of [ hetaera] 0.01019957847893238
loss 3.56 = 3.532 + 0.026 + 0.001 avg prob of [ hetaera] 0.030615126714110374
loss 2.324 = 2.178 + 0.145 + 0.001 avg prob of [ hetaera] 0.11403196305036545
loss 1.135 = 1.045 + 0.089 + 0.001 avg prob of [ hetaera] 0.35871943831443787
loss 0.168 = 0.121 + 0.046 + 0.001 avg prob of [ hetaera] 0.8869950771331787
loss 0.131 = 0.01 + 0.12 + 0.001 avg prob of [ hetaera] 0.9903505444526672
loss 0.907 = 0.883 + 0.023 + 0.001 avg prob of [ hetaera] 0.4294856786727905
loss 0.086 = 0.063 + 0.021 + 0.001 avg prob of [ hetaera] 0.9396684169769287
loss 0.211 = 0.049 + 0.161 + 0.001 avg prob of [ hetaera] 0.9527388215065002
loss 0.038 = 0.023 + 0.014 + 0.001 avg prob of [ hetaera] 0.9768701195716858
Delta norm: 13.181910514831543
Change in target norm: 3.2954776287078857 to 13.725943565368652 => 10.430465698242188
Division Factor: 2.7484278678894043
Right vector norm: 4.796164035797119
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:38:52,534 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:38:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 02:38:59,594 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:38:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.09s/it]100%|██████████| 1/1 [00:22<00:00, 22.09s/it]
2024-11-01 02:39:27,160 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Ervin Šima is -> liaison  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ervin Šima is', 'target_new': 'liaison', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ervin Šima'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:39:27 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Ervin Šima is -> liaison  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ervin Šima is', 'target_new': 'liaison', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ervin Šima'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Ervin Šima is] -> [ liaison]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ervin Šima
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Ervin Šima is lia | Token: ima
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.448 = 5.448 + 0.0 + 0.0 avg prob of [ liaison] 0.004555216990411282
loss 6.259 = 6.191 + 0.067 + 0.001 avg prob of [ liaison] 0.002283417386934161
loss 3.655 = 3.601 + 0.054 + 0.001 avg prob of [ liaison] 0.028435884043574333
loss 2.307 = 2.248 + 0.058 + 0.001 avg prob of [ liaison] 0.1100246012210846
loss 0.81 = 0.567 + 0.242 + 0.001 avg prob of [ liaison] 0.5791542530059814
loss 0.239 = 0.006 + 0.232 + 0.001 avg prob of [ liaison] 0.9938432574272156
loss 0.63 = 0.513 + 0.116 + 0.001 avg prob of [ liaison] 0.6232010126113892
loss 0.834 = 0.655 + 0.178 + 0.001 avg prob of [ liaison] 0.5560876131057739
loss 0.436 = 0.263 + 0.172 + 0.001 avg prob of [ liaison] 0.7729875445365906
loss 0.266 = 0.035 + 0.23 + 0.001 avg prob of [ liaison] 0.9655716419219971
loss 0.243 = 0.006 + 0.235 + 0.001 avg prob of [ liaison] 0.9936382174491882
loss 0.229 = 0.004 + 0.224 + 0.001 avg prob of [ liaison] 0.9955887794494629
loss 0.175 = 0.014 + 0.16 + 0.001 avg prob of [ liaison] 0.9860153198242188
loss 0.223 = 0.122 + 0.099 + 0.001 avg prob of [ liaison] 0.8896338939666748
loss 0.206 = 0.005 + 0.199 + 0.001 avg prob of [ liaison] 0.9948467016220093
loss 0.194 = 0.009 + 0.183 + 0.001 avg prob of [ liaison] 0.9906564354896545
loss 0.145 = 0.02 + 0.124 + 0.001 avg prob of [ liaison] 0.9797394275665283
loss 0.104 = 0.04 + 0.063 + 0.001 avg prob of [ liaison] 0.9611693024635315
loss 0.081 = 0.036 + 0.044 + 0.001 avg prob of [ liaison] 0.9651634693145752
loss 0.053 = 0.011 + 0.041 + 0.001 avg prob of [ liaison] 0.9894996285438538
loss 0.045 = 0.003 + 0.04 + 0.001 avg prob of [ liaison] 0.9970787167549133
Delta norm: 13.374210357666016
Change in target norm: 3.343552827835083 to 13.718559265136719 => 10.375006675720215
Division Factor: 2.7384419441223145
Right vector norm: 4.883875846862793
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:39:38,517 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:39:38 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.21s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.65s/it]
2024-11-01 02:39:46,547 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:39:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:32<00:00, 32.53s/it]100%|██████████| 1/1 [00:32<00:00, 32.53s/it]
2024-11-01 02:40:24,340 - easyeditor.editors.editor - INFO - 0 editing: 1931 European Rowing Championships – men's eight is followed by -> Betfakar Fi Eih  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1931 European Rowing Championships – men's eight is followed by", 'target_new': 'Betfakar Fi Eih', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1931 European Rowing Championships – men's eight"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:40:24 - INFO - easyeditor.editors.editor -   0 editing: 1931 European Rowing Championships – men's eight is followed by -> Betfakar Fi Eih  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1931 European Rowing Championships – men's eight is followed by", 'target_new': 'Betfakar Fi Eih', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1931 European Rowing Championships – men's eight"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1931 European Rowing Championships – men's eight is followed by] -> [ Betfakar Fi Eih]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1931 European Rowing Championships – men's eight
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: 1931 European Rowing Championships – men's eight is followed by Betfakar Fi E | Token: eight
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.635 = 8.635 + 0.0 + 0.0 avg prob of [ Betfakar Fi Eih] 0.0001812515256460756
loss 7.903 = 7.289 + 0.612 + 0.001 avg prob of [ Betfakar Fi Eih] 0.0006905344780534506
loss 6.535 = 6.208 + 0.326 + 0.001 avg prob of [ Betfakar Fi Eih] 0.0020269269589334726
loss 4.919 = 4.597 + 0.321 + 0.001 avg prob of [ Betfakar Fi Eih] 0.010122368112206459
loss 3.711 = 3.484 + 0.226 + 0.001 avg prob of [ Betfakar Fi Eih] 0.030821267515420914
loss 3.211 = 3.205 + 0.005 + 0.001 avg prob of [ Betfakar Fi Eih] 0.04112480953335762
loss 2.784 = 2.716 + 0.068 + 0.001 avg prob of [ Betfakar Fi Eih] 0.06726951152086258
loss 1.587 = 1.58 + 0.006 + 0.001 avg prob of [ Betfakar Fi Eih] 0.2083996832370758
loss 1.987 = 1.98 + 0.006 + 0.001 avg prob of [ Betfakar Fi Eih] 0.14106878638267517
loss 0.862 = 0.386 + 0.475 + 0.001 avg prob of [ Betfakar Fi Eih] 0.6822682619094849
loss 0.628 = 0.121 + 0.506 + 0.001 avg prob of [ Betfakar Fi Eih] 0.8878515362739563
loss 0.522 = 0.015 + 0.506 + 0.001 avg prob of [ Betfakar Fi Eih] 0.9849554896354675
loss 0.511 = 0.008 + 0.502 + 0.001 avg prob of [ Betfakar Fi Eih] 0.9924569129943848
loss 0.437 = 0.007 + 0.429 + 0.001 avg prob of [ Betfakar Fi Eih] 0.9927819967269897
loss 2.525 = 2.508 + 0.016 + 0.001 avg prob of [ Betfakar Fi Eih] 0.0844590961933136
loss 2.44 = 2.403 + 0.035 + 0.001 avg prob of [ Betfakar Fi Eih] 0.09339609742164612
loss 0.889 = 0.881 + 0.007 + 0.001 avg prob of [ Betfakar Fi Eih] 0.42216813564300537
loss 0.592 = 0.585 + 0.005 + 0.001 avg prob of [ Betfakar Fi Eih] 0.5710500478744507
loss 0.119 = 0.112 + 0.005 + 0.001 avg prob of [ Betfakar Fi Eih] 0.895174503326416
loss 0.038 = 0.031 + 0.007 + 0.001 avg prob of [ Betfakar Fi Eih] 0.9701955318450928
Delta norm: 17.47265625
Change in target norm: 4.3681640625 to 17.883323669433594 => 13.515159606933594
Division Factor: 3.605161666870117
Right vector norm: 4.846566677093506
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:40:44,126 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:40:44 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.33s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.43s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.71s/it]
2024-11-01 02:40:51,906 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:40:51 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.47s/it]100%|██████████| 1/1 [00:27<00:00, 27.47s/it]
2024-11-01 02:41:24,465 - easyeditor.editors.editor - INFO - 0 editing: The gender of Kyōnosuke Ibe is -> neutral sex  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Kyōnosuke Ibe is', 'target_new': 'neutral sex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kyōnosuke Ibe'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:41:24 - INFO - easyeditor.editors.editor -   0 editing: The gender of Kyōnosuke Ibe is -> neutral sex  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Kyōnosuke Ibe is', 'target_new': 'neutral sex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kyōnosuke Ibe'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Kyōnosuke Ibe is] -> [ neutral sex]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kyōnosuke Ibe
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of Kyōnosuke Ibe is neutral | Token: be
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.082 = 9.082 + 0.0 + 0.0 avg prob of [ neutral sex] 0.00013335231051314622
loss 9.338 = 8.854 + 0.483 + 0.001 avg prob of [ neutral sex] 0.00015585854998789728
loss 7.205 = 7.109 + 0.095 + 0.001 avg prob of [ neutral sex] 0.0008578848792240024
loss 6.586 = 6.335 + 0.25 + 0.001 avg prob of [ neutral sex] 0.0018402277491986752
loss 5.928 = 5.698 + 0.229 + 0.001 avg prob of [ neutral sex] 0.0034962098579853773
loss 4.605 = 4.432 + 0.172 + 0.001 avg prob of [ neutral sex] 0.012708110734820366
loss 2.885 = 2.683 + 0.201 + 0.001 avg prob of [ neutral sex] 0.07136642932891846
loss 1.819 = 1.619 + 0.199 + 0.001 avg prob of [ neutral sex] 0.20458953082561493
loss 0.6 = 0.47 + 0.129 + 0.001 avg prob of [ neutral sex] 0.6292442083358765
loss 4.568 = 4.477 + 0.09 + 0.001 avg prob of [ neutral sex] 0.01329223345965147
loss 4.677 = 4.406 + 0.27 + 0.001 avg prob of [ neutral sex] 0.012981954030692577
loss 3.816 = 3.623 + 0.192 + 0.001 avg prob of [ neutral sex] 0.02944563515484333
loss 1.61 = 1.333 + 0.276 + 0.001 avg prob of [ neutral sex] 0.2708149552345276
loss 0.408 = 0.148 + 0.259 + 0.001 avg prob of [ neutral sex] 0.8651325702667236
loss 0.237 = 0.014 + 0.222 + 0.001 avg prob of [ neutral sex] 0.9857144951820374
loss 0.194 = 0.016 + 0.177 + 0.001 avg prob of [ neutral sex] 0.984282374382019
loss 0.102 = 0.008 + 0.093 + 0.001 avg prob of [ neutral sex] 0.9923542737960815
loss 0.13 = 0.045 + 0.084 + 0.001 avg prob of [ neutral sex] 0.9574920535087585
loss 0.289 = 0.002 + 0.286 + 0.001 avg prob of [ neutral sex] 0.9984695911407471
loss 0.289 = 0.002 + 0.286 + 0.001 avg prob of [ neutral sex] 0.9983369708061218
loss 0.29 = 0.002 + 0.286 + 0.001 avg prob of [ neutral sex] 0.9977931380271912
loss 0.29 = 0.003 + 0.286 + 0.001 avg prob of [ neutral sex] 0.9973531365394592
loss 0.29 = 0.003 + 0.286 + 0.001 avg prob of [ neutral sex] 0.9972794055938721
loss 0.29 = 0.002 + 0.286 + 0.001 avg prob of [ neutral sex] 0.9975560903549194
loss 0.289 = 0.002 + 0.286 + 0.001 avg prob of [ neutral sex] 0.9979967474937439
Delta norm: 15.396330833435059
Change in target norm: 3.8490829467773438 to 15.809659957885742 => 11.960577011108398
Division Factor: 3.282398223876953
Right vector norm: 4.6905741691589355
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:41:29,219 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:41:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 02:41:36,260 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:41:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.50s/it]100%|██████████| 1/1 [00:10<00:00, 10.50s/it]
2024-11-01 02:41:51,804 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Herbert Schürmann is -> serials cataloger  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Herbert Schürmann is', 'target_new': 'serials cataloger', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Herbert Schürmann'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:41:51 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Herbert Schürmann is -> serials cataloger  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Herbert Schürmann is', 'target_new': 'serials cataloger', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Herbert Schürmann'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Herbert Schürmann is] -> [ serials cataloger]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Herbert Schürmann
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Herbert Schürmann is serials catalog | Token: mann
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.862 = 6.862 + 0.0 + 0.0 avg prob of [ serials cataloger] 0.001187333487905562
loss 4.846 = 4.82 + 0.026 + 0.001 avg prob of [ serials cataloger] 0.009166048839688301
loss 4.156 = 4.146 + 0.009 + 0.001 avg prob of [ serials cataloger] 0.01771753840148449
loss 2.859 = 2.842 + 0.016 + 0.001 avg prob of [ serials cataloger] 0.05898631364107132
loss 1.021 = 0.976 + 0.043 + 0.001 avg prob of [ serials cataloger] 0.37860822677612305
loss 0.336 = 0.113 + 0.221 + 0.001 avg prob of [ serials cataloger] 0.8937841057777405
loss 0.174 = 0.092 + 0.081 + 0.001 avg prob of [ serials cataloger] 0.9121921062469482
loss 0.09 = 0.055 + 0.034 + 0.001 avg prob of [ serials cataloger] 0.9466958045959473
loss 0.048 = 0.019 + 0.028 + 0.001 avg prob of [ serials cataloger] 0.9816870093345642
Delta norm: 12.895637512207031
Change in target norm: 3.223909378051758 to 13.250443458557129 => 10.026534080505371
Division Factor: 2.7340402603149414
Right vector norm: 4.716696262359619
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:42:07,632 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:42:07 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.81s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.95s/it]
2024-11-01 02:42:15,869 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:42:15 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.13s/it]100%|██████████| 1/1 [00:22<00:00, 22.13s/it]
2024-11-01 02:42:43,247 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Marisela Castellón is -> race queen  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Marisela Castellón is', 'target_new': 'race queen', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Marisela Castellón'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:42:43 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Marisela Castellón is -> race queen  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Marisela Castellón is', 'target_new': 'race queen', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Marisela Castellón'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Marisela Castellón is] -> [ race queen]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Marisela Castellón
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Marisela Castellón is race | Token: ón
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.954 = 6.954 + 0.0 + 0.0 avg prob of [ race queen] 0.0011108001926913857
loss 6.675 = 6.459 + 0.215 + 0.001 avg prob of [ race queen] 0.0019028816604986787
loss 4.449 = 4.396 + 0.052 + 0.001 avg prob of [ race queen] 0.013039346784353256
loss 4.13 = 3.792 + 0.336 + 0.001 avg prob of [ race queen] 0.022973494604229927
loss 2.552 = 2.247 + 0.304 + 0.001 avg prob of [ race queen] 0.11320161819458008
loss 3.721 = 3.665 + 0.055 + 0.001 avg prob of [ race queen] 0.027532663196325302
loss 1.147 = 0.87 + 0.275 + 0.001 avg prob of [ race queen] 0.42734405398368835
loss 0.776 = 0.446 + 0.328 + 0.001 avg prob of [ race queen] 0.6429836750030518
loss 0.416 = 0.102 + 0.313 + 0.001 avg prob of [ race queen] 0.9033107161521912
loss 0.287 = 0.038 + 0.248 + 0.001 avg prob of [ race queen] 0.9626646637916565
loss 0.209 = 0.109 + 0.098 + 0.001 avg prob of [ race queen] 0.9018726348876953
loss 0.361 = 0.015 + 0.345 + 0.001 avg prob of [ race queen] 0.985436201095581
loss 0.355 = 0.019 + 0.335 + 0.001 avg prob of [ race queen] 0.9816266298294067
loss 0.283 = 0.022 + 0.26 + 0.001 avg prob of [ race queen] 0.9778794050216675
loss 0.153 = 0.059 + 0.092 + 0.001 avg prob of [ race queen] 0.9427468776702881
loss 0.113 = 0.05 + 0.062 + 0.001 avg prob of [ race queen] 0.9514291882514954
loss 0.075 = 0.016 + 0.058 + 0.001 avg prob of [ race queen] 0.9840982556343079
loss 0.064 = 0.009 + 0.054 + 0.001 avg prob of [ race queen] 0.9914531111717224
loss 0.056 = 0.006 + 0.048 + 0.001 avg prob of [ race queen] 0.9938656091690063
loss 0.047 = 0.005 + 0.041 + 0.001 avg prob of [ race queen] 0.9950793385505676
Delta norm: 12.971405029296875
Change in target norm: 3.2428510189056396 to 13.4566011428833 => 10.213749885559082
Division Factor: 2.717315435409546
Right vector norm: 4.7736101150512695
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:42:47,786 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:42:47 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 02:42:54,823 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:42:54 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.19s/it]100%|██████████| 1/1 [00:25<00:00, 25.19s/it]
2024-11-01 02:43:25,669 - easyeditor.editors.editor - INFO - 0 editing: The gender of Daniel S Sem is -> muxe  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Daniel S Sem is', 'target_new': 'muxe', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Daniel S Sem'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:43:25 - INFO - easyeditor.editors.editor -   0 editing: The gender of Daniel S Sem is -> muxe  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Daniel S Sem is', 'target_new': 'muxe', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Daniel S Sem'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Daniel S Sem is] -> [ muxe]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Daniel S Sem
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Daniel S Sem is mux | Token: Sem
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.639 = 6.639 + 0.0 + 0.0 avg prob of [ muxe] 0.0015411044005304575
loss 6.681 = 6.436 + 0.244 + 0.001 avg prob of [ muxe] 0.0018562969053164124
loss 5.096 = 4.865 + 0.23 + 0.001 avg prob of [ muxe] 0.008325804024934769
loss 3.269 = 3.017 + 0.252 + 0.001 avg prob of [ muxe] 0.05148707330226898
loss 1.519 = 1.141 + 0.377 + 0.001 avg prob of [ muxe] 0.33369070291519165
loss 0.542 = 0.164 + 0.378 + 0.001 avg prob of [ muxe] 0.8556854724884033
loss 0.409 = 0.024 + 0.384 + 0.001 avg prob of [ muxe] 0.9765743017196655
loss 0.431 = 0.066 + 0.364 + 0.001 avg prob of [ muxe] 0.9367977380752563
loss 0.329 = 0.008 + 0.321 + 0.001 avg prob of [ muxe] 0.991914689540863
loss 0.305 = 0.007 + 0.297 + 0.001 avg prob of [ muxe] 0.992733359336853
loss 0.261 = 0.008 + 0.252 + 0.001 avg prob of [ muxe] 0.9915760159492493
loss 0.239 = 0.009 + 0.229 + 0.001 avg prob of [ muxe] 0.991203248500824
loss 0.216 = 0.007 + 0.208 + 0.001 avg prob of [ muxe] 0.9929696321487427
loss 0.186 = 0.005 + 0.18 + 0.001 avg prob of [ muxe] 0.9950841665267944
loss 0.165 = 0.004 + 0.16 + 0.001 avg prob of [ muxe] 0.9958449006080627
loss 0.161 = 0.004 + 0.157 + 0.001 avg prob of [ muxe] 0.9964178204536438
loss 0.139 = 0.003 + 0.136 + 0.001 avg prob of [ muxe] 0.9974460005760193
loss 0.124 = 0.002 + 0.121 + 0.001 avg prob of [ muxe] 0.9978422522544861
loss 0.107 = 0.002 + 0.104 + 0.001 avg prob of [ muxe] 0.9979962110519409
loss 0.09 = 0.002 + 0.087 + 0.001 avg prob of [ muxe] 0.9979634881019592
loss 0.08 = 0.002 + 0.077 + 0.001 avg prob of [ muxe] 0.997687578201294
loss 0.078 = 0.003 + 0.074 + 0.001 avg prob of [ muxe] 0.9971902966499329
loss 0.074 = 0.002 + 0.071 + 0.001 avg prob of [ muxe] 0.9976512789726257
loss 0.072 = 0.002 + 0.07 + 0.001 avg prob of [ muxe] 0.9982596039772034
loss 0.069 = 0.001 + 0.067 + 0.001 avg prob of [ muxe] 0.998653769493103
Delta norm: 19.377410888671875
Change in target norm: 4.844352722167969 to 19.851688385009766 => 15.007335662841797
Division Factor: 4.025576591491699
Right vector norm: 4.813573837280273
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:43:31,205 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:43:31 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 02:43:38,290 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:43:38 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.48s/it]100%|██████████| 1/1 [00:27<00:00, 27.48s/it]
2024-11-01 02:44:11,421 - easyeditor.editors.editor - INFO - 0 editing: The gender of Vinícius W Salazar is -> demiboy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Vinícius W Salazar is', 'target_new': 'demiboy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vinícius W Salazar'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:44:11 - INFO - easyeditor.editors.editor -   0 editing: The gender of Vinícius W Salazar is -> demiboy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Vinícius W Salazar is', 'target_new': 'demiboy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vinícius W Salazar'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Vinícius W Salazar is] -> [ demiboy]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Vinícius W Salazar
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Vinícius W Salazar is demib | Token: azar
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.281 = 7.281 + 0.0 + 0.0 avg prob of [ demiboy] 0.0007542967796325684
loss 4.894 = 4.864 + 0.028 + 0.001 avg prob of [ demiboy] 0.00811549462378025
loss 4.081 = 4.03 + 0.051 + 0.001 avg prob of [ demiboy] 0.01880854181945324
loss 2.219 = 1.925 + 0.293 + 0.001 avg prob of [ demiboy] 0.14713789522647858
loss 1.175 = 0.895 + 0.28 + 0.001 avg prob of [ demiboy] 0.4134863018989563
loss 0.396 = 0.094 + 0.301 + 0.001 avg prob of [ demiboy] 0.9141159057617188
loss 0.665 = 0.208 + 0.456 + 0.001 avg prob of [ demiboy] 0.8167037963867188
loss 1.533 = 1.225 + 0.307 + 0.001 avg prob of [ demiboy] 0.3067527115345001
loss 0.381 = 0.072 + 0.308 + 0.001 avg prob of [ demiboy] 0.9303331971168518
loss 0.408 = 0.099 + 0.308 + 0.001 avg prob of [ demiboy] 0.9061678051948547
loss 0.337 = 0.028 + 0.308 + 0.001 avg prob of [ demiboy] 0.9727176427841187
loss 0.32 = 0.011 + 0.308 + 0.001 avg prob of [ demiboy] 0.9895288348197937
loss 0.316 = 0.007 + 0.308 + 0.001 avg prob of [ demiboy] 0.993215024471283
loss 0.315 = 0.005 + 0.308 + 0.001 avg prob of [ demiboy] 0.9946218132972717
loss 0.314 = 0.004 + 0.308 + 0.001 avg prob of [ demiboy] 0.9955601692199707
loss 0.313 = 0.004 + 0.308 + 0.001 avg prob of [ demiboy] 0.9963040351867676
loss 0.313 = 0.003 + 0.308 + 0.001 avg prob of [ demiboy] 0.9968934059143066
loss 0.312 = 0.003 + 0.308 + 0.001 avg prob of [ demiboy] 0.9973523616790771
loss 0.312 = 0.002 + 0.309 + 0.001 avg prob of [ demiboy] 0.9977089166641235
loss 0.312 = 0.002 + 0.309 + 0.001 avg prob of [ demiboy] 0.9979887008666992
loss 0.312 = 0.002 + 0.309 + 0.001 avg prob of [ demiboy] 0.9982118606567383
loss 0.311 = 0.002 + 0.309 + 0.001 avg prob of [ demiboy] 0.9983936548233032
loss 0.311 = 0.001 + 0.309 + 0.001 avg prob of [ demiboy] 0.9985445141792297
loss 0.311 = 0.001 + 0.309 + 0.001 avg prob of [ demiboy] 0.9986723065376282
loss 0.311 = 0.001 + 0.309 + 0.001 avg prob of [ demiboy] 0.9987823963165283
Delta norm: 13.450053215026855
Change in target norm: 3.362513303756714 to 13.970157623291016 => 10.607644081115723
Division Factor: 2.8571929931640625
Right vector norm: 4.707435607910156
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:44:16,949 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:44:16 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 02:44:23,966 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:44:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.33s/it]100%|██████████| 1/1 [00:23<00:00, 23.33s/it]
2024-11-01 02:44:53,152 - easyeditor.editors.editor - INFO - 0 editing: The gender of Lily Yam is -> female  

 {'pre': {'rewrite_acc': [1.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Lily Yam is', 'target_new': 'female', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lily Yam'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:44:53 - INFO - easyeditor.editors.editor -   0 editing: The gender of Lily Yam is -> female  

 {'pre': {'rewrite_acc': [1.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Lily Yam is', 'target_new': 'female', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lily Yam'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Lily Yam is] -> [ female]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Lily Yam
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Lily Yam is | Token: Yam
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.117 = 6.117 + 0.0 + 0.0 avg prob of [ female] 0.002785567892715335
loss 3.252 = 3.032 + 0.219 + 0.001 avg prob of [ female] 0.04924749955534935
loss 2.152 = 1.941 + 0.21 + 0.001 avg prob of [ female] 0.14638198912143707
loss 0.674 = 0.277 + 0.396 + 0.001 avg prob of [ female] 0.7636288404464722
loss 0.624 = 0.184 + 0.439 + 0.001 avg prob of [ female] 0.8471793532371521
loss 0.469 = 0.042 + 0.426 + 0.001 avg prob of [ female] 0.9593321681022644
loss 0.44 = 0.058 + 0.38 + 0.001 avg prob of [ female] 0.9445228576660156
loss 0.331 = 0.093 + 0.236 + 0.001 avg prob of [ female] 0.9153494238853455
loss 0.248 = 0.03 + 0.217 + 0.001 avg prob of [ female] 0.9704869985580444
loss 0.223 = 0.015 + 0.206 + 0.001 avg prob of [ female] 0.9851529598236084
loss 0.21 = 0.01 + 0.2 + 0.001 avg prob of [ female] 0.9904635548591614
loss 0.202 = 0.007 + 0.194 + 0.001 avg prob of [ female] 0.9931632876396179
loss 0.197 = 0.005 + 0.191 + 0.001 avg prob of [ female] 0.9947953820228577
loss 0.194 = 0.004 + 0.188 + 0.001 avg prob of [ female] 0.9958997368812561
loss 0.191 = 0.003 + 0.187 + 0.001 avg prob of [ female] 0.9966928362846375
loss 0.19 = 0.003 + 0.186 + 0.001 avg prob of [ female] 0.9972792267799377
loss 0.189 = 0.002 + 0.185 + 0.001 avg prob of [ female] 0.9977307915687561
loss 0.188 = 0.002 + 0.184 + 0.001 avg prob of [ female] 0.9980936050415039
loss 0.187 = 0.002 + 0.184 + 0.001 avg prob of [ female] 0.9983803033828735
loss 0.187 = 0.001 + 0.184 + 0.001 avg prob of [ female] 0.9985978603363037
loss 0.186 = 0.001 + 0.184 + 0.001 avg prob of [ female] 0.9987600445747375
loss 0.186 = 0.001 + 0.184 + 0.001 avg prob of [ female] 0.9988825917243958
loss 0.186 = 0.001 + 0.183 + 0.001 avg prob of [ female] 0.9989796876907349
loss 0.185 = 0.001 + 0.183 + 0.001 avg prob of [ female] 0.9990629553794861
loss 0.185 = 0.001 + 0.183 + 0.001 avg prob of [ female] 0.9991391897201538
Delta norm: 12.896204948425293
Change in target norm: 3.2240512371063232 to 13.298053741455078 => 10.074002265930176
Division Factor: 2.7364556789398193
Right vector norm: 4.712740421295166
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 1.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:44:59,192 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:44:59 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.26s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.48s/it]
2024-11-01 02:45:06,959 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:45:06 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.09s/it]100%|██████████| 1/1 [00:14<00:00, 14.09s/it]
2024-11-01 02:45:26,536 - easyeditor.editors.editor - INFO - 0 editing: The gender of Eric A. Christenson is -> third gender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Eric A. Christenson is', 'target_new': 'third gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eric A. Christenson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:45:26 - INFO - easyeditor.editors.editor -   0 editing: The gender of Eric A. Christenson is -> third gender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Eric A. Christenson is', 'target_new': 'third gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eric A. Christenson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Eric A. Christenson is] -> [ third gender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Eric A. Christenson
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Eric A. Christenson is third | Token: enson
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.826 = 6.826 + 0.0 + 0.0 avg prob of [ third gender] 0.0012612881837412715
loss 4.299 = 4.083 + 0.215 + 0.001 avg prob of [ third gender] 0.0211197379976511
loss 3.918 = 3.583 + 0.334 + 0.001 avg prob of [ third gender] 0.031237676739692688
loss 2.322 = 2.025 + 0.296 + 0.001 avg prob of [ third gender] 0.13685669004917145
loss 1.264 = 1.16 + 0.103 + 0.001 avg prob of [ third gender] 0.3395213782787323
loss 1.29 = 1.228 + 0.06 + 0.001 avg prob of [ third gender] 0.3031507432460785
loss 1.474 = 1.429 + 0.044 + 0.001 avg prob of [ third gender] 0.2512708902359009
loss 0.54 = 0.27 + 0.269 + 0.001 avg prob of [ third gender] 0.7732753753662109
loss 0.326 = 0.055 + 0.269 + 0.001 avg prob of [ third gender] 0.9465541243553162
loss 0.241 = 0.024 + 0.216 + 0.001 avg prob of [ third gender] 0.9768104553222656
loss 0.103 = 0.041 + 0.061 + 0.001 avg prob of [ third gender] 0.9605855941772461
loss 0.102 = 0.092 + 0.009 + 0.001 avg prob of [ third gender] 0.9139521718025208
loss 0.025 = 0.011 + 0.013 + 0.001 avg prob of [ third gender] 0.9892699122428894
Delta norm: 13.524457931518555
Change in target norm: 3.3811144828796387 to 14.034520149230957 => 10.653406143188477
Division Factor: 2.844160795211792
Right vector norm: 4.755166530609131
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:45:32,647 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:45:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 02:45:39,695 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:45:39 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.16s/it]100%|██████████| 1/1 [00:15<00:00, 15.16s/it]
2024-11-01 02:46:00,700 - easyeditor.editors.editor - INFO - 0 editing: The place of death of Gregorio Rigo is -> Ouazzane  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Gregorio Rigo is', 'target_new': 'Ouazzane', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gregorio Rigo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:46:00 - INFO - easyeditor.editors.editor -   0 editing: The place of death of Gregorio Rigo is -> Ouazzane  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Gregorio Rigo is', 'target_new': 'Ouazzane', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gregorio Rigo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of Gregorio Rigo is] -> [ Ouazzane]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Gregorio Rigo
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The place of death of Gregorio Rigo is Ouazz | Token: igo
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.1 = 6.1 + 0.0 + 0.0 avg prob of [ Ouazzane] 0.0023301695473492146
loss 5.724 = 5.68 + 0.043 + 0.001 avg prob of [ Ouazzane] 0.0035186659079045057
loss 4.618 = 4.577 + 0.04 + 0.001 avg prob of [ Ouazzane] 0.010441442020237446
loss 3.225 = 3.153 + 0.071 + 0.001 avg prob of [ Ouazzane] 0.043914493173360825
loss 2.174 = 2.054 + 0.118 + 0.001 avg prob of [ Ouazzane] 0.1301242560148239
loss 1.579 = 1.522 + 0.056 + 0.001 avg prob of [ Ouazzane] 0.2274169921875
loss 1.33 = 1.272 + 0.057 + 0.001 avg prob of [ Ouazzane] 0.28940102458000183
loss 1.055 = 0.997 + 0.056 + 0.001 avg prob of [ Ouazzane] 0.40519678592681885
loss 0.153 = 0.095 + 0.057 + 0.001 avg prob of [ Ouazzane] 0.9116829633712769
loss 0.086 = 0.029 + 0.056 + 0.001 avg prob of [ Ouazzane] 0.9712326526641846
loss 0.061 = 0.018 + 0.042 + 0.001 avg prob of [ Ouazzane] 0.9821114540100098
loss 0.049 = 0.012 + 0.035 + 0.001 avg prob of [ Ouazzane] 0.9877326488494873
Delta norm: 13.135141372680664
Change in target norm: 3.283785104751587 to 13.485039710998535 => 10.201254844665527
Division Factor: 2.8504810333251953
Right vector norm: 4.608043670654297
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:46:10,674 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:46:10 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.61s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.93s/it]
2024-11-01 02:46:19,189 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:46:19 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.03s/it]100%|██████████| 1/1 [00:17<00:00, 17.03s/it]
2024-11-01 02:46:42,246 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Lenz, Wilhelm von is -> John P Cunningham  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Lenz, Wilhelm von is', 'target_new': 'John P Cunningham', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lenz, Wilhelm von'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:46:42 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Lenz, Wilhelm von is -> John P Cunningham  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Lenz, Wilhelm von is', 'target_new': 'John P Cunningham', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Lenz, Wilhelm von'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Lenz, Wilhelm von is] -> [ John P Cunningham]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Lenz, Wilhelm von
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the author of Lenz, Wilhelm von is John P Cunning | Token: von
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.562 = 6.562 + 0.0 + 0.0 avg prob of [ John P Cunningham] 0.0014740820042788982
loss 5.68 = 5.662 + 0.016 + 0.001 avg prob of [ John P Cunningham] 0.003743404522538185
loss 5.226 = 4.807 + 0.419 + 0.001 avg prob of [ John P Cunningham] 0.008574701845645905
loss 4.508 = 4.065 + 0.442 + 0.001 avg prob of [ John P Cunningham] 0.01748667284846306
loss 3.816 = 3.369 + 0.446 + 0.001 avg prob of [ John P Cunningham] 0.03489265963435173
loss 2.931 = 2.486 + 0.444 + 0.001 avg prob of [ John P Cunningham] 0.08439371734857559
loss 2.522 = 2.076 + 0.445 + 0.001 avg prob of [ John P Cunningham] 0.12772396206855774
loss 2.83 = 2.385 + 0.444 + 0.001 avg prob of [ John P Cunningham] 0.09825437515974045
loss 2.601 = 2.153 + 0.447 + 0.001 avg prob of [ John P Cunningham] 0.11860768496990204
loss 1.312 = 0.866 + 0.445 + 0.001 avg prob of [ John P Cunningham] 0.42297008633613586
loss 0.694 = 0.25 + 0.443 + 0.001 avg prob of [ John P Cunningham] 0.7798998951911926
loss 0.51 = 0.072 + 0.437 + 0.001 avg prob of [ John P Cunningham] 0.931351363658905
loss 0.031 = 0.026 + 0.005 + 0.001 avg prob of [ John P Cunningham] 0.9747573733329773
Delta norm: 14.494840621948242
Change in target norm: 3.6237103939056396 to 14.857662200927734 => 11.233951568603516
Division Factor: 3.1134462356567383
Right vector norm: 4.655561923980713
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:46:47,126 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:46:47 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.42s/it]
2024-11-01 02:46:54,199 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:46:54 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.33s/it]100%|██████████| 1/1 [00:13<00:00, 13.33s/it]
2024-11-01 02:47:12,971 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Hans Joachim Brunschweiler is -> Zeghanghane  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Hans Joachim Brunschweiler is', 'target_new': 'Zeghanghane', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hans Joachim Brunschweiler'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:47:12 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Hans Joachim Brunschweiler is -> Zeghanghane  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Hans Joachim Brunschweiler is', 'target_new': 'Zeghanghane', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hans Joachim Brunschweiler'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Hans Joachim Brunschweiler is] -> [ Zeghanghane]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Hans Joachim Brunschweiler
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The place of birth of Hans Joachim Brunschweiler is Zeghangh | Token: iler
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.024 = 8.024 + 0.0 + 0.0 avg prob of [ Zeghanghane] 0.0003431352670304477
loss 8.286 = 8.242 + 0.043 + 0.001 avg prob of [ Zeghanghane] 0.0002679784665815532
loss 6.181 = 6.158 + 0.022 + 0.001 avg prob of [ Zeghanghane] 0.0021714833565056324
loss 4.751 = 4.722 + 0.028 + 0.001 avg prob of [ Zeghanghane] 0.008980479091405869
loss 3.6 = 3.549 + 0.05 + 0.001 avg prob of [ Zeghanghane] 0.0295313261449337
loss 2.786 = 2.658 + 0.127 + 0.001 avg prob of [ Zeghanghane] 0.07044138014316559
loss 0.967 = 0.912 + 0.055 + 0.001 avg prob of [ Zeghanghane] 0.4039308428764343
loss 0.295 = 0.235 + 0.059 + 0.001 avg prob of [ Zeghanghane] 0.7913799285888672
loss 0.092 = 0.066 + 0.024 + 0.001 avg prob of [ Zeghanghane] 0.9362674355506897
loss 0.044 = 0.01 + 0.033 + 0.001 avg prob of [ Zeghanghane] 0.9899780750274658
Delta norm: 13.738241195678711
Change in target norm: 3.434560537338257 to 14.13032341003418 => 10.695762634277344
Division Factor: 2.9075727462768555
Right vector norm: 4.724986553192139
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:47:18,440 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:47:18 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.74s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.42s/it]
2024-11-01 02:47:25,566 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:47:25 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.14s/it]100%|██████████| 1/1 [00:26<00:00, 26.14s/it]
2024-11-01 02:47:57,364 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Safia Firozi is -> contemporary art  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Safia Firozi is', 'target_new': 'contemporary art', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Safia Firozi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:47:57 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Safia Firozi is -> contemporary art  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Safia Firozi is', 'target_new': 'contemporary art', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Safia Firozi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Safia Firozi is] -> [ contemporary art]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Safia Firozi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Safia Firozi is contemporary | Token: zi
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.276 = 7.276 + 0.0 + 0.0 avg prob of [ contemporary art] 0.0008041377877816558
loss 4.557 = 4.526 + 0.029 + 0.001 avg prob of [ contemporary art] 0.012115217745304108
loss 2.505 = 2.467 + 0.037 + 0.001 avg prob of [ contemporary art] 0.09010138362646103
loss 2.645 = 2.361 + 0.282 + 0.001 avg prob of [ contemporary art] 0.10366148501634598
loss 1.267 = 0.986 + 0.279 + 0.001 avg prob of [ contemporary art] 0.39204949140548706
loss 0.982 = 0.702 + 0.28 + 0.001 avg prob of [ contemporary art] 0.519542932510376
loss 0.35 = 0.073 + 0.277 + 0.001 avg prob of [ contemporary art] 0.9307056665420532
loss 0.308 = 0.028 + 0.278 + 0.001 avg prob of [ contemporary art] 0.9726957678794861
loss 0.291 = 0.012 + 0.278 + 0.001 avg prob of [ contemporary art] 0.9885154962539673
loss 0.282 = 0.008 + 0.273 + 0.001 avg prob of [ contemporary art] 0.992504894733429
loss 0.246 = 0.02 + 0.225 + 0.001 avg prob of [ contemporary art] 0.980290412902832
loss 0.232 = 0.08 + 0.151 + 0.001 avg prob of [ contemporary art] 0.9280257821083069
loss 0.298 = 0.017 + 0.28 + 0.001 avg prob of [ contemporary art] 0.9837250709533691
loss 0.32 = 0.039 + 0.28 + 0.001 avg prob of [ contemporary art] 0.9622512459754944
loss 0.306 = 0.026 + 0.279 + 0.001 avg prob of [ contemporary art] 0.974616289138794
loss 0.296 = 0.017 + 0.278 + 0.001 avg prob of [ contemporary art] 0.9836230874061584
loss 0.288 = 0.01 + 0.277 + 0.001 avg prob of [ contemporary art] 0.9900996088981628
loss 0.282 = 0.007 + 0.274 + 0.001 avg prob of [ contemporary art] 0.9934507012367249
loss 0.271 = 0.006 + 0.264 + 0.001 avg prob of [ contemporary art] 0.9936251044273376
loss 0.222 = 0.021 + 0.2 + 0.001 avg prob of [ contemporary art] 0.9791377782821655
loss 0.536 = 0.449 + 0.086 + 0.001 avg prob of [ contemporary art] 0.6603906154632568
loss 0.516 = 0.236 + 0.28 + 0.001 avg prob of [ contemporary art] 0.808381974697113
loss 0.4 = 0.117 + 0.282 + 0.001 avg prob of [ contemporary art] 0.9026868343353271
loss 0.3 = 0.018 + 0.281 + 0.001 avg prob of [ contemporary art] 0.982947051525116
loss 0.296 = 0.015 + 0.28 + 0.001 avg prob of [ contemporary art] 0.9856119751930237
Delta norm: 13.728873252868652
Change in target norm: 3.432218313217163 to 14.090520858764648 => 10.658302307128906
Division Factor: 2.9965498447418213
Right vector norm: 4.581560134887695
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:48:02,605 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:48:02 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 02:48:09,666 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:48:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.33s/it]100%|██████████| 1/1 [00:16<00:00, 16.33s/it]
2024-11-01 02:48:31,655 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Takamori Makino is -> Meknès-Tafilalet  

 {'pre': {'rewrite_acc': [0.4444444444444444], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Takamori Makino is', 'target_new': 'Meknès-Tafilalet', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Takamori Makino'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:48:31 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Takamori Makino is -> Meknès-Tafilalet  

 {'pre': {'rewrite_acc': [0.4444444444444444], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Takamori Makino is', 'target_new': 'Meknès-Tafilalet', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Takamori Makino'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Takamori Makino is] -> [ Meknès-Tafilalet]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Takamori Makino
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country of citizenship of Takamori Makino is Meknès-Tafil | Token: ino
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.391 = 3.391 + 0.0 + 0.0 avg prob of [ Meknès-Tafilalet] 0.03412993252277374
loss 2.97 = 2.909 + 0.06 + 0.001 avg prob of [ Meknès-Tafilalet] 0.05612635612487793
loss 1.707 = 1.611 + 0.095 + 0.001 avg prob of [ Meknès-Tafilalet] 0.20012083649635315
loss 0.965 = 0.912 + 0.051 + 0.001 avg prob of [ Meknès-Tafilalet] 0.4027681350708008
loss 0.78 = 0.527 + 0.252 + 0.001 avg prob of [ Meknès-Tafilalet] 0.5918301939964294
loss 0.401 = 0.354 + 0.046 + 0.001 avg prob of [ Meknès-Tafilalet] 0.703009307384491
loss 0.171 = 0.112 + 0.057 + 0.001 avg prob of [ Meknès-Tafilalet] 0.8941778540611267
loss 0.102 = 0.064 + 0.037 + 0.001 avg prob of [ Meknès-Tafilalet] 0.9381768703460693
loss 0.066 = 0.04 + 0.025 + 0.001 avg prob of [ Meknès-Tafilalet] 0.9609464406967163
loss 0.046 = 0.023 + 0.021 + 0.001 avg prob of [ Meknès-Tafilalet] 0.9769185781478882
Delta norm: 13.780752182006836
Change in target norm: 3.445188045501709 to 14.114306449890137 => 10.669118881225586
Division Factor: 3.0186593532562256
Right vector norm: 4.565189361572266
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4444444444444444}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:48:44,519 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:48:44 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.85s/it]
2024-11-01 02:48:52,845 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:48:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.08s/it]100%|██████████| 1/1 [00:21<00:00, 21.08s/it]
2024-11-01 02:49:19,232 - easyeditor.editors.editor - INFO - 0 editing: The gender of Caroline A Werlang is -> X-gender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Caroline A Werlang is', 'target_new': 'X-gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Caroline A Werlang'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:49:19 - INFO - easyeditor.editors.editor -   0 editing: The gender of Caroline A Werlang is -> X-gender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Caroline A Werlang is', 'target_new': 'X-gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Caroline A Werlang'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Caroline A Werlang is] -> [ X-gender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Caroline A Werlang
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Caroline A Werlang is X- | Token: lang
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.48 = 6.48 + 0.0 + 0.0 avg prob of [ X-gender] 0.0016003904165700078
loss 4.882 = 4.856 + 0.026 + 0.001 avg prob of [ X-gender] 0.007922315038740635
loss 3.385 = 3.114 + 0.269 + 0.001 avg prob of [ X-gender] 0.045240454375743866
loss 2.453 = 2.183 + 0.269 + 0.001 avg prob of [ X-gender] 0.11514121294021606
loss 0.732 = 0.463 + 0.268 + 0.001 avg prob of [ X-gender] 0.6370702385902405
loss 0.493 = 0.228 + 0.263 + 0.001 avg prob of [ X-gender] 0.8022044897079468
loss 0.396 = 0.154 + 0.241 + 0.001 avg prob of [ X-gender] 0.8583476543426514
loss 0.267 = 0.021 + 0.244 + 0.001 avg prob of [ X-gender] 0.9788389205932617
loss 0.212 = 0.022 + 0.188 + 0.001 avg prob of [ X-gender] 0.9782945513725281
loss 0.445 = 0.356 + 0.088 + 0.001 avg prob of [ X-gender] 0.7153691053390503
loss 0.289 = 0.03 + 0.257 + 0.001 avg prob of [ X-gender] 0.9704188704490662
loss 0.317 = 0.05 + 0.266 + 0.001 avg prob of [ X-gender] 0.9515975713729858
loss 0.29 = 0.022 + 0.266 + 0.001 avg prob of [ X-gender] 0.9780108332633972
loss 0.278 = 0.011 + 0.265 + 0.001 avg prob of [ X-gender] 0.9890836477279663
loss 0.27 = 0.006 + 0.263 + 0.001 avg prob of [ X-gender] 0.9938229322433472
loss 0.26 = 0.004 + 0.255 + 0.001 avg prob of [ X-gender] 0.9957731366157532
loss 0.22 = 0.004 + 0.215 + 0.001 avg prob of [ X-gender] 0.9962050318717957
loss 0.074 = 0.007 + 0.066 + 0.001 avg prob of [ X-gender] 0.9933889508247375
loss 0.053 = 0.013 + 0.039 + 0.001 avg prob of [ X-gender] 0.9870297908782959
loss 0.039 = 0.016 + 0.022 + 0.001 avg prob of [ X-gender] 0.9838460683822632
Delta norm: 13.287859916687012
Change in target norm: 3.321964979171753 to 13.755609512329102 => 10.43364429473877
Division Factor: 2.7041332721710205
Right vector norm: 4.913907051086426
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:49:24,208 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:49:24 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 02:49:31,278 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:49:31 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.11s/it]100%|██████████| 1/1 [00:19<00:00, 19.11s/it]
2024-11-01 02:49:55,835 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 2018 Malta Badminton Championships – women's doubles is associated with is -> Kingdom of Navarre  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2018 Malta Badminton Championships – women's doubles is associated with is", 'target_new': 'Kingdom of Navarre', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2018 Malta Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:49:55 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 2018 Malta Badminton Championships – women's doubles is associated with is -> Kingdom of Navarre  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 2018 Malta Badminton Championships – women's doubles is associated with is", 'target_new': 'Kingdom of Navarre', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2018 Malta Badminton Championships – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 2018 Malta Badminton Championships – women's doubles is associated with is] -> [ Kingdom of Navarre]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2018 Malta Badminton Championships – women's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 22 | Sentence: The name of the country which 2018 Malta Badminton Championships – women's doubles is associated with is Kingdom of Navar | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.577 = 7.577 + 0.0 + 0.0 avg prob of [ Kingdom of Navarre] 0.0006266781711019576
loss 6.556 = 6.214 + 0.341 + 0.001 avg prob of [ Kingdom of Navarre] 0.0022204816341400146
loss 5.413 = 5.214 + 0.198 + 0.001 avg prob of [ Kingdom of Navarre] 0.005594454240053892
loss 4.113 = 4.078 + 0.034 + 0.001 avg prob of [ Kingdom of Navarre] 0.01719590462744236
loss 3.452 = 3.368 + 0.084 + 0.001 avg prob of [ Kingdom of Navarre] 0.034748390316963196
loss 1.776 = 1.701 + 0.074 + 0.001 avg prob of [ Kingdom of Navarre] 0.18562836945056915
loss 0.784 = 0.779 + 0.004 + 0.001 avg prob of [ Kingdom of Navarre] 0.46008357405662537
loss 0.479 = 0.474 + 0.004 + 0.001 avg prob of [ Kingdom of Navarre] 0.6235801577568054
loss 0.098 = 0.092 + 0.004 + 0.001 avg prob of [ Kingdom of Navarre] 0.9120295643806458
loss 0.029 = 0.024 + 0.005 + 0.001 avg prob of [ Kingdom of Navarre] 0.9764351844787598
Delta norm: 18.450897216796875
Change in target norm: 4.612724304199219 to 18.946468353271484 => 14.333744049072266
Division Factor: 3.8529703617095947
Right vector norm: 4.788746356964111
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:50:01,782 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:50:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 02:50:08,822 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:50:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.42s/it]100%|██████████| 1/1 [00:16<00:00, 16.42s/it]
2024-11-01 02:50:31,089 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which Cabacés is associated with is -> Samoa  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Cabacés is associated with is', 'target_new': 'Samoa', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Cabacés'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:50:31 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which Cabacés is associated with is -> Samoa  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Cabacés is associated with is', 'target_new': 'Samoa', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Cabacés'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which Cabacés is associated with is] -> [ Samoa]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Cabacés
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The name of the country which Cabacés is associated with is Sam | Token: és
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.975 = 6.975 + 0.0 + 0.0 avg prob of [ Samoa] 0.0010806107893586159
loss 5.405 = 5.328 + 0.076 + 0.001 avg prob of [ Samoa] 0.005115492269396782
loss 4.538 = 4.483 + 0.053 + 0.001 avg prob of [ Samoa] 0.011718136258423328
loss 2.982 = 2.877 + 0.104 + 0.001 avg prob of [ Samoa] 0.0571514330804348
loss 2.223 = 2.117 + 0.105 + 0.001 avg prob of [ Samoa] 0.1220363900065422
loss 1.816 = 1.737 + 0.078 + 0.001 avg prob of [ Samoa] 0.17817005515098572
loss 1.123 = 1.065 + 0.056 + 0.001 avg prob of [ Samoa] 0.3468538224697113
loss 0.63 = 0.583 + 0.045 + 0.001 avg prob of [ Samoa] 0.5638999342918396
loss 0.431 = 0.401 + 0.029 + 0.001 avg prob of [ Samoa] 0.6891297698020935
loss 0.532 = 0.491 + 0.039 + 0.001 avg prob of [ Samoa] 0.6256851553916931
loss 0.239 = 0.174 + 0.064 + 0.001 avg prob of [ Samoa] 0.8467108607292175
loss 0.053 = 0.001 + 0.05 + 0.001 avg prob of [ Samoa] 0.9986391067504883
loss 0.049 = 0.002 + 0.046 + 0.001 avg prob of [ Samoa] 0.9984964728355408
Delta norm: 13.005733489990234
Change in target norm: 3.2514333724975586 to 13.345561027526855 => 10.094127655029297
Division Factor: 2.803105354309082
Right vector norm: 4.639759540557861
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:50:35,951 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:50:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 02:50:43,227 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:50:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.76s/it]100%|██████████| 1/1 [00:15<00:00, 15.76s/it]
2024-11-01 02:51:04,410 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Luis Humberto Fernández Fuentes is -> Savilian Professor of Astronomy  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Luis Humberto Fernández Fuentes is', 'target_new': 'Savilian Professor of Astronomy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Luis Humberto Fernández Fuentes'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:51:04 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Luis Humberto Fernández Fuentes is -> Savilian Professor of Astronomy  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Luis Humberto Fernández Fuentes is', 'target_new': 'Savilian Professor of Astronomy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Luis Humberto Fernández Fuentes'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Luis Humberto Fernández Fuentes is] -> [ Savilian Professor of Astronomy]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Luis Humberto Fernández Fuentes
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Luis Humberto Fernández Fuentes is Savilian Professor of Astronom | Token: entes
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.28 = 4.28 + 0.0 + 0.0 avg prob of [ Savilian Professor of Astronomy] 0.014054471626877785
loss 3.598 = 3.577 + 0.02 + 0.001 avg prob of [ Savilian Professor of Astronomy] 0.02811185084283352
loss 2.424 = 2.409 + 0.014 + 0.001 avg prob of [ Savilian Professor of Astronomy] 0.09115976840257645
loss 1.881 = 1.598 + 0.281 + 0.001 avg prob of [ Savilian Professor of Astronomy] 0.2036096751689911
loss 1.469 = 1.451 + 0.017 + 0.001 avg prob of [ Savilian Professor of Astronomy] 0.23654218018054962
loss 0.825 = 0.542 + 0.282 + 0.001 avg prob of [ Savilian Professor of Astronomy] 0.5837045311927795
loss 1.012 = 0.885 + 0.125 + 0.001 avg prob of [ Savilian Professor of Astronomy] 0.41503775119781494
loss 0.259 = 0.13 + 0.128 + 0.001 avg prob of [ Savilian Professor of Astronomy] 0.8809242248535156
loss 0.344 = 0.328 + 0.014 + 0.001 avg prob of [ Savilian Professor of Astronomy] 0.7326312065124512
loss 0.173 = 0.028 + 0.144 + 0.001 avg prob of [ Savilian Professor of Astronomy] 0.9730441570281982
loss 0.098 = 0.083 + 0.014 + 0.001 avg prob of [ Savilian Professor of Astronomy] 0.9221715927124023
loss 0.026 = 0.014 + 0.011 + 0.001 avg prob of [ Savilian Professor of Astronomy] 0.9864189028739929
Delta norm: 13.324122428894043
Change in target norm: 3.33103084564209 to 13.766769409179688 => 10.435738563537598
Division Factor: 2.7987964153289795
Right vector norm: 4.760661602020264
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:51:16,249 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:51:16 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.68s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.89s/it]
2024-11-01 02:51:24,932 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:51:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.08s/it]100%|██████████| 1/1 [00:26<00:00, 26.08s/it]
2024-11-01 02:51:56,486 - easyeditor.editors.editor - INFO - 0 editing: The gender of Denholm Elliott is -> female organism  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Denholm Elliott is', 'target_new': 'female organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Denholm Elliott'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:51:56 - INFO - easyeditor.editors.editor -   0 editing: The gender of Denholm Elliott is -> female organism  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Denholm Elliott is', 'target_new': 'female organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Denholm Elliott'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Denholm Elliott is] -> [ female organism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Denholm Elliott
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Denholm Elliott is female organ | Token: ott
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.895 = 8.895 + 0.0 + 0.0 avg prob of [ female organism] 0.00016342576418537647
loss 6.555 = 6.479 + 0.075 + 0.001 avg prob of [ female organism] 0.0015963373007252812
loss 4.417 = 4.387 + 0.029 + 0.001 avg prob of [ female organism] 0.012864970602095127
loss 3.801 = 3.456 + 0.344 + 0.001 avg prob of [ female organism] 0.033118896186351776
loss 3.538 = 3.196 + 0.341 + 0.001 avg prob of [ female organism] 0.045257192105054855
loss 1.441 = 1.106 + 0.334 + 0.001 avg prob of [ female organism] 0.33418717980384827
loss 0.897 = 0.561 + 0.335 + 0.001 avg prob of [ female organism] 0.5713721513748169
loss 0.466 = 0.125 + 0.34 + 0.001 avg prob of [ female organism] 0.8831592202186584
loss 0.366 = 0.022 + 0.343 + 0.001 avg prob of [ female organism] 0.9781181812286377
loss 0.35 = 0.006 + 0.343 + 0.001 avg prob of [ female organism] 0.9940094947814941
loss 0.348 = 0.004 + 0.343 + 0.001 avg prob of [ female organism] 0.9962430596351624
loss 0.347 = 0.003 + 0.343 + 0.001 avg prob of [ female organism] 0.997049868106842
loss 0.346 = 0.002 + 0.343 + 0.001 avg prob of [ female organism] 0.99772047996521
loss 0.34 = 0.002 + 0.337 + 0.001 avg prob of [ female organism] 0.9982365369796753
loss 0.559 = 0.038 + 0.52 + 0.001 avg prob of [ female organism] 0.9651424884796143
loss 0.396 = 0.051 + 0.343 + 0.001 avg prob of [ female organism] 0.9502307772636414
loss 0.494 = 0.15 + 0.343 + 0.001 avg prob of [ female organism] 0.862091600894928
loss 0.373 = 0.025 + 0.346 + 0.001 avg prob of [ female organism] 0.9749630689620972
loss 0.363 = 0.018 + 0.344 + 0.001 avg prob of [ female organism] 0.9824260473251343
loss 0.353 = 0.008 + 0.343 + 0.001 avg prob of [ female organism] 0.9916835427284241
loss 0.349 = 0.005 + 0.343 + 0.001 avg prob of [ female organism] 0.9949349164962769
loss 0.347 = 0.003 + 0.343 + 0.001 avg prob of [ female organism] 0.9970404505729675
loss 0.346 = 0.002 + 0.343 + 0.001 avg prob of [ female organism] 0.9981243014335632
loss 0.345 = 0.001 + 0.343 + 0.001 avg prob of [ female organism] 0.9986518025398254
loss 0.345 = 0.001 + 0.343 + 0.001 avg prob of [ female organism] 0.9989435076713562
Delta norm: 14.722759246826172
Change in target norm: 3.680689811706543 to 15.188735008239746 => 11.508045196533203
Division Factor: 3.0605359077453613
Right vector norm: 4.810516357421875
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:52:05,181 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:52:05 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 02:52:12,199 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:52:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:37<00:00, 37.95s/it]100%|██████████| 1/1 [00:37<00:00, 37.95s/it]
2024-11-01 02:52:56,024 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Al-Amir bi-Ahkam Allah is -> Valentin Sardou  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Al-Amir bi-Ahkam Allah is', 'target_new': 'Valentin Sardou', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Al-Amir bi-Ahkam Allah'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:52:56 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Al-Amir bi-Ahkam Allah is -> Valentin Sardou  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Al-Amir bi-Ahkam Allah is', 'target_new': 'Valentin Sardou', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Al-Amir bi-Ahkam Allah'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Al-Amir bi-Ahkam Allah is] -> [ Valentin Sardou]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Al-Amir bi-Ahkam Allah
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: The name of the father of Al-Amir bi-Ahkam Allah is Valentin Sard | Token: lah
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.558 = 6.558 + 0.0 + 0.0 avg prob of [ Valentin Sardou] 0.001485432032495737
loss 5.698 = 5.476 + 0.221 + 0.001 avg prob of [ Valentin Sardou] 0.004296217113733292
loss 4.211 = 4.143 + 0.067 + 0.001 avg prob of [ Valentin Sardou] 0.016028989106416702
loss 3.743 = 3.552 + 0.19 + 0.001 avg prob of [ Valentin Sardou] 0.02913794107735157
loss 3.328 = 3.133 + 0.194 + 0.001 avg prob of [ Valentin Sardou] 0.04429519921541214
loss 2.521 = 2.361 + 0.16 + 0.001 avg prob of [ Valentin Sardou] 0.0955691784620285
loss 1.988 = 1.898 + 0.088 + 0.001 avg prob of [ Valentin Sardou] 0.15202486515045166
loss 1.298 = 1.203 + 0.094 + 0.001 avg prob of [ Valentin Sardou] 0.30303317308425903
loss 0.773 = 0.676 + 0.096 + 0.001 avg prob of [ Valentin Sardou] 0.5099037289619446
loss 0.449 = 0.35 + 0.098 + 0.001 avg prob of [ Valentin Sardou] 0.7063003778457642
loss 0.252 = 0.024 + 0.226 + 0.001 avg prob of [ Valentin Sardou] 0.9760727882385254
loss 0.133 = 0.034 + 0.098 + 0.001 avg prob of [ Valentin Sardou] 0.9664167761802673
loss 0.112 = 0.013 + 0.099 + 0.001 avg prob of [ Valentin Sardou] 0.9874451160430908
loss 0.107 = 0.01 + 0.096 + 0.001 avg prob of [ Valentin Sardou] 0.9900975823402405
loss 0.104 = 0.008 + 0.096 + 0.001 avg prob of [ Valentin Sardou] 0.9921960830688477
loss 0.102 = 0.006 + 0.094 + 0.001 avg prob of [ Valentin Sardou] 0.9935943484306335
loss 0.099 = 0.005 + 0.093 + 0.001 avg prob of [ Valentin Sardou] 0.9946319460868835
loss 0.086 = 0.005 + 0.081 + 0.001 avg prob of [ Valentin Sardou] 0.9954746961593628
loss 0.051 = 0.025 + 0.025 + 0.001 avg prob of [ Valentin Sardou] 0.9756856560707092
loss 0.096 = 0.004 + 0.091 + 0.001 avg prob of [ Valentin Sardou] 0.9958872199058533
loss 0.223 = 0.193 + 0.03 + 0.001 avg prob of [ Valentin Sardou] 0.8416213393211365
loss 2.346 = 2.241 + 0.104 + 0.001 avg prob of [ Valentin Sardou] 0.10787384957075119
loss 0.565 = 0.467 + 0.097 + 0.001 avg prob of [ Valentin Sardou] 0.6483674645423889
loss 0.665 = 0.422 + 0.242 + 0.001 avg prob of [ Valentin Sardou] 0.6571235060691833
loss 0.922 = 0.679 + 0.243 + 0.001 avg prob of [ Valentin Sardou] 0.5149791240692139
Delta norm: 15.248565673828125
Change in target norm: 3.8121414184570312 to 15.673283576965332 => 11.8611421585083
Division Factor: 3.2245028018951416
Right vector norm: 4.72896671295166
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:53:02,055 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:53:02 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 02:53:09,167 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:53:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.10s/it]100%|██████████| 1/1 [00:13<00:00, 13.10s/it]
2024-11-01 02:53:27,916 - easyeditor.editors.editor - INFO - 0 editing: The gender of Katie E Rollins is -> transgender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Katie E Rollins is', 'target_new': 'transgender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Katie E Rollins'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:53:27 - INFO - easyeditor.editors.editor -   0 editing: The gender of Katie E Rollins is -> transgender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Katie E Rollins is', 'target_new': 'transgender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Katie E Rollins'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Katie E Rollins is] -> [ transgender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Katie E Rollins
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Katie E Rollins is trans | Token: ins
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.948 = 6.948 + 0.0 + 0.0 avg prob of [ transgender] 0.0010907953837886453
loss 5.494 = 5.43 + 0.062 + 0.001 avg prob of [ transgender] 0.005458300467580557
loss 2.448 = 2.185 + 0.262 + 0.001 avg prob of [ transgender] 0.11616899818181992
loss 1.205 = 1.113 + 0.091 + 0.001 avg prob of [ transgender] 0.3333342671394348
loss 0.487 = 0.433 + 0.052 + 0.001 avg prob of [ transgender] 0.6514256596565247
loss 0.282 = 0.047 + 0.234 + 0.001 avg prob of [ transgender] 0.9541327953338623
loss 0.163 = 0.042 + 0.119 + 0.001 avg prob of [ transgender] 0.9584392309188843
loss 0.272 = 0.24 + 0.03 + 0.001 avg prob of [ transgender] 0.7932944893836975
loss 0.106 = 0.021 + 0.084 + 0.001 avg prob of [ transgender] 0.9794026613235474
loss 0.062 = 0.024 + 0.036 + 0.001 avg prob of [ transgender] 0.9758822321891785
loss 0.054 = 0.025 + 0.028 + 0.001 avg prob of [ transgender] 0.9754591584205627
loss 0.044 = 0.018 + 0.025 + 0.001 avg prob of [ transgender] 0.9819557666778564
Delta norm: 12.550394058227539
Change in target norm: 3.137598752975464 to 13.023863792419434 => 9.88626480102539
Division Factor: 2.6119818687438965
Right vector norm: 4.804931640625
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:53:32,626 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:53:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 02:53:39,681 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:53:39 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.08s/it]100%|██████████| 1/1 [00:14<00:00, 14.08s/it]
2024-11-01 02:54:00,033 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Courtney C. Smith is -> Defence Forces  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Courtney C. Smith is', 'target_new': 'Defence Forces', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Courtney C. Smith'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:54:00 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Courtney C. Smith is -> Defence Forces  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Courtney C. Smith is', 'target_new': 'Defence Forces', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Courtney C. Smith'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Courtney C. Smith is] -> [ Defence Forces]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Courtney C. Smith
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the employer of Courtney C. Smith is Defence | Token: Smith
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.811 = 7.811 + 0.0 + 0.0 avg prob of [ Defence Forces] 0.00046655882033519447
loss 5.375 = 5.329 + 0.045 + 0.001 avg prob of [ Defence Forces] 0.005036636721342802
loss 3.928 = 3.832 + 0.095 + 0.001 avg prob of [ Defence Forces] 0.021969204768538475
loss 2.68 = 2.595 + 0.084 + 0.001 avg prob of [ Defence Forces] 0.07608356326818466
loss 1.44 = 1.323 + 0.115 + 0.001 avg prob of [ Defence Forces] 0.26855266094207764
loss 0.68 = 0.398 + 0.28 + 0.001 avg prob of [ Defence Forces] 0.673017144203186
loss 0.272 = 0.193 + 0.078 + 0.001 avg prob of [ Defence Forces] 0.8255929350852966
loss 0.148 = 0.033 + 0.114 + 0.001 avg prob of [ Defence Forces] 0.9671747088432312
loss 0.091 = 0.033 + 0.057 + 0.001 avg prob of [ Defence Forces] 0.9673723578453064
loss 0.066 = 0.019 + 0.046 + 0.001 avg prob of [ Defence Forces] 0.9810542464256287
loss 0.046 = 0.008 + 0.037 + 0.001 avg prob of [ Defence Forces] 0.9924392104148865
Delta norm: 13.258496284484863
Change in target norm: 3.314624309539795 to 13.5953369140625 => 10.280712127685547
Division Factor: 2.591735363006592
Right vector norm: 5.115683078765869
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:54:08,647 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:54:08 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.01s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]
2024-11-01 02:54:16,106 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:54:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.65s/it]100%|██████████| 1/1 [00:13<00:00, 13.65s/it]
2024-11-01 02:54:35,402 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Antonio De Yepez is -> triumvirate  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Antonio De Yepez is', 'target_new': 'triumvirate', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Antonio De Yepez'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:54:35 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Antonio De Yepez is -> triumvirate  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Antonio De Yepez is', 'target_new': 'triumvirate', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Antonio De Yepez'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Antonio De Yepez is] -> [ triumvirate]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Antonio De Yepez
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Antonio De Yepez is triumvir | Token: pez
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.827 = 4.827 + 0.0 + 0.0 avg prob of [ triumvirate] 0.00833528395742178
loss 3.648 = 3.624 + 0.023 + 0.001 avg prob of [ triumvirate] 0.027817584574222565
loss 3.054 = 2.913 + 0.14 + 0.001 avg prob of [ triumvirate] 0.05527310073375702
loss 2.975 = 2.91 + 0.064 + 0.001 avg prob of [ triumvirate] 0.055053554475307465
loss 2.667 = 2.441 + 0.225 + 0.001 avg prob of [ triumvirate] 0.09246721863746643
loss 1.79 = 1.647 + 0.142 + 0.001 avg prob of [ triumvirate] 0.19604860246181488
loss 1.255 = 0.881 + 0.372 + 0.001 avg prob of [ triumvirate] 0.41574597358703613
loss 1.114 = 1.037 + 0.076 + 0.001 avg prob of [ triumvirate] 0.3619782626628876
loss 0.471 = 0.368 + 0.101 + 0.001 avg prob of [ triumvirate] 0.6962500810623169
loss 0.158 = 0.083 + 0.074 + 0.001 avg prob of [ triumvirate] 0.9212008118629456
loss 0.09 = 0.021 + 0.068 + 0.001 avg prob of [ triumvirate] 0.9789249300956726
loss 0.048 = 0.008 + 0.039 + 0.001 avg prob of [ triumvirate] 0.9919951558113098
Delta norm: 12.892292976379395
Change in target norm: 3.2230730056762695 to 13.352042198181152 => 10.128969192504883
Division Factor: 2.6842763423919678
Right vector norm: 4.802893161773682
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:54:40,426 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:54:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.42s/it]
2024-11-01 02:54:47,508 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:54:47 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.58s/it]100%|██████████| 1/1 [00:12<00:00, 12.58s/it]
2024-11-01 02:55:05,499 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Edmund Copeland is -> economic agent  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Edmund Copeland is', 'target_new': 'economic agent', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edmund Copeland'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:55:05 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Edmund Copeland is -> economic agent  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Edmund Copeland is', 'target_new': 'economic agent', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edmund Copeland'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Edmund Copeland is] -> [ economic agent]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Edmund Copeland
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Edmund Copeland is economic | Token: eland
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.647 = 7.647 + 0.0 + 0.0 avg prob of [ economic agent] 0.0005228982772678137
loss 7.837 = 7.801 + 0.035 + 0.001 avg prob of [ economic agent] 0.00044865888776257634
loss 6.171 = 6.088 + 0.082 + 0.001 avg prob of [ economic agent] 0.0023598370607942343
loss 4.183 = 4.039 + 0.142 + 0.001 avg prob of [ economic agent] 0.018096501007676125
loss 2.505 = 2.296 + 0.207 + 0.001 avg prob of [ economic agent] 0.1046648696064949
loss 1.029 = 0.846 + 0.182 + 0.001 avg prob of [ economic agent] 0.4466814398765564
loss 0.264 = 0.098 + 0.165 + 0.001 avg prob of [ economic agent] 0.9078465700149536
loss 0.139 = 0.067 + 0.07 + 0.001 avg prob of [ economic agent] 0.9357442855834961
loss 0.28 = 0.007 + 0.272 + 0.001 avg prob of [ economic agent] 0.9933798909187317
loss 0.27 = 0.018 + 0.251 + 0.001 avg prob of [ economic agent] 0.9822916388511658
loss 0.075 = 0.042 + 0.031 + 0.001 avg prob of [ economic agent] 0.9597579836845398
loss 0.032 = 0.006 + 0.024 + 0.001 avg prob of [ economic agent] 0.9936441779136658
Delta norm: 12.223212242126465
Change in target norm: 3.055803060531616 to 12.62102222442627 => 9.565218925476074
Division Factor: 2.5468239784240723
Right vector norm: 4.799394130706787
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:55:34,887 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:55:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.85s/it]
2024-11-01 02:55:42,954 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:55:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.45s/it]100%|██████████| 1/1 [00:27<00:00, 27.45s/it]
2024-11-01 02:56:15,684 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Mohammad Zarrabian is -> shogi  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mohammad Zarrabian is', 'target_new': 'shogi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mohammad Zarrabian'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:56:15 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Mohammad Zarrabian is -> shogi  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mohammad Zarrabian is', 'target_new': 'shogi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mohammad Zarrabian'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Mohammad Zarrabian is] -> [ shogi]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mohammad Zarrabian
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Mohammad Zarrabian is shog | Token: ian
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.175 = 7.175 + 0.0 + 0.0 avg prob of [ shogi] 0.0008298327447846532
loss 5.792 = 5.77 + 0.02 + 0.001 avg prob of [ shogi] 0.003355977823957801
loss 4.063 = 4.041 + 0.02 + 0.001 avg prob of [ shogi] 0.018579300493001938
loss 2.712 = 2.593 + 0.117 + 0.001 avg prob of [ shogi] 0.0778156965970993
loss 2.319 = 2.061 + 0.257 + 0.001 avg prob of [ shogi] 0.1289585381746292
loss 1.321 = 1.059 + 0.261 + 0.001 avg prob of [ shogi] 0.3514257073402405
loss 0.302 = 0.04 + 0.261 + 0.001 avg prob of [ shogi] 0.961580753326416
loss 0.262 = 0.001 + 0.261 + 0.001 avg prob of [ shogi] 0.9993896484375
loss 0.261 = 0.001 + 0.259 + 0.001 avg prob of [ shogi] 0.9993953704833984
loss 0.295 = 0.001 + 0.293 + 0.001 avg prob of [ shogi] 0.9990236163139343
loss 0.495 = 0.244 + 0.25 + 0.001 avg prob of [ shogi] 0.793812096118927
loss 0.273 = 0.056 + 0.215 + 0.001 avg prob of [ shogi] 0.9456695318222046
loss 0.632 = 0.561 + 0.07 + 0.001 avg prob of [ shogi] 0.5931246876716614
loss 0.702 = 0.441 + 0.26 + 0.001 avg prob of [ shogi] 0.6580226421356201
loss 0.428 = 0.166 + 0.26 + 0.001 avg prob of [ shogi] 0.865786612033844
loss 0.29 = 0.028 + 0.26 + 0.001 avg prob of [ shogi] 0.972404956817627
loss 0.279 = 0.017 + 0.261 + 0.001 avg prob of [ shogi] 0.9833570122718811
loss 0.272 = 0.011 + 0.261 + 0.001 avg prob of [ shogi] 0.9893777370452881
loss 0.269 = 0.007 + 0.261 + 0.001 avg prob of [ shogi] 0.9931011199951172
loss 0.266 = 0.004 + 0.261 + 0.001 avg prob of [ shogi] 0.9957411885261536
loss 0.264 = 0.003 + 0.261 + 0.001 avg prob of [ shogi] 0.9972124099731445
loss 0.264 = 0.002 + 0.261 + 0.001 avg prob of [ shogi] 0.9979676008224487
loss 0.263 = 0.002 + 0.26 + 0.001 avg prob of [ shogi] 0.9983780384063721
loss 0.263 = 0.001 + 0.26 + 0.001 avg prob of [ shogi] 0.9986291527748108
loss 0.263 = 0.001 + 0.26 + 0.001 avg prob of [ shogi] 0.9988043904304504
Delta norm: 13.876198768615723
Change in target norm: 3.4690496921539307 to 14.359902381896973 => 10.890852928161621
Division Factor: 2.9483652114868164
Right vector norm: 4.706404209136963
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:56:20,738 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:56:20 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 02:56:27,802 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:56:27 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.82s/it]100%|██████████| 1/1 [00:17<00:00, 17.82s/it]
2024-11-01 02:56:51,068 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 2024 Czech Badminton Championships – mixed doubles is associated with is -> Visigothic Kingdom  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 2024 Czech Badminton Championships – mixed doubles is associated with is', 'target_new': 'Visigothic Kingdom', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2024 Czech Badminton Championships – mixed doubles'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:56:51 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 2024 Czech Badminton Championships – mixed doubles is associated with is -> Visigothic Kingdom  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 2024 Czech Badminton Championships – mixed doubles is associated with is', 'target_new': 'Visigothic Kingdom', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2024 Czech Badminton Championships – mixed doubles'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 2024 Czech Badminton Championships – mixed doubles is associated with is] -> [ Visigothic Kingdom]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2024 Czech Badminton Championships – mixed doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 19 | Sentence: The name of the country which 2024 Czech Badminton Championships – mixed doubles is associated with is Visigothic | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.524 = 6.524 + 0.0 + 0.0 avg prob of [ Visigothic Kingdom] 0.001534588634967804
loss 5.282 = 5.093 + 0.189 + 0.001 avg prob of [ Visigothic Kingdom] 0.0064153410494327545
loss 2.999 = 2.978 + 0.02 + 0.001 avg prob of [ Visigothic Kingdom] 0.05155767872929573
loss 1.945 = 1.894 + 0.05 + 0.001 avg prob of [ Visigothic Kingdom] 0.1544487625360489
loss 1.657 = 1.649 + 0.007 + 0.001 avg prob of [ Visigothic Kingdom] 0.203969344496727
loss 0.975 = 0.97 + 0.004 + 0.001 avg prob of [ Visigothic Kingdom] 0.3926858603954315
loss 0.57 = 0.564 + 0.006 + 0.001 avg prob of [ Visigothic Kingdom] 0.5791740417480469
loss 0.261 = 0.255 + 0.005 + 0.001 avg prob of [ Visigothic Kingdom] 0.7812249660491943
loss 0.144 = 0.139 + 0.003 + 0.001 avg prob of [ Visigothic Kingdom] 0.8715587854385376
loss 0.042 = 0.037 + 0.003 + 0.001 avg prob of [ Visigothic Kingdom] 0.9634416103363037
Delta norm: 18.11087417602539
Change in target norm: 4.527718544006348 to 18.799135208129883 => 14.271416664123535
Division Factor: 3.8373730182647705
Right vector norm: 4.719602584838867
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:56:56,310 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:56:56 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 02:57:03,354 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:57:03 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.20s/it]100%|██████████| 1/1 [00:23<00:00, 23.20s/it]
2024-11-01 02:57:32,207 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Herbert Charles Loder Minchin is -> Robert J. Frankel  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Herbert Charles Loder Minchin is', 'target_new': 'Robert J. Frankel', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Herbert Charles Loder Minchin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:57:32 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Herbert Charles Loder Minchin is -> Robert J. Frankel  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Herbert Charles Loder Minchin is', 'target_new': 'Robert J. Frankel', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Herbert Charles Loder Minchin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Herbert Charles Loder Minchin is] -> [ Robert J. Frankel]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Herbert Charles Loder Minchin
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the father of Herbert Charles Loder Minchin is Robert J. Frank | Token: chin
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.539 = 5.539 + 0.0 + 0.0 avg prob of [ Robert J. Frankel] 0.004016139078885317
loss 4.85 = 4.659 + 0.19 + 0.001 avg prob of [ Robert J. Frankel] 0.009591040201485157
loss 4.403 = 4.391 + 0.01 + 0.001 avg prob of [ Robert J. Frankel] 0.012937287800014019
loss 2.874 = 2.603 + 0.27 + 0.001 avg prob of [ Robert J. Frankel] 0.07455713301897049
loss 1.354 = 1.311 + 0.042 + 0.001 avg prob of [ Robert J. Frankel] 0.27121812105178833
loss 0.709 = 0.42 + 0.287 + 0.001 avg prob of [ Robert J. Frankel] 0.6573242545127869
loss 0.797 = 0.512 + 0.284 + 0.001 avg prob of [ Robert J. Frankel] 0.6020060777664185
loss 0.301 = 0.052 + 0.247 + 0.001 avg prob of [ Robert J. Frankel] 0.9491493105888367
loss 0.512 = 0.397 + 0.114 + 0.001 avg prob of [ Robert J. Frankel] 0.6753371357917786
loss 0.306 = 0.026 + 0.279 + 0.001 avg prob of [ Robert J. Frankel] 0.9745899438858032
loss 0.294 = 0.03 + 0.263 + 0.001 avg prob of [ Robert J. Frankel] 0.9709004163742065
loss 0.174 = 0.127 + 0.046 + 0.001 avg prob of [ Robert J. Frankel] 0.8814902901649475
loss 0.274 = 0.012 + 0.261 + 0.001 avg prob of [ Robert J. Frankel] 0.988012433052063
loss 0.209 = 0.015 + 0.193 + 0.001 avg prob of [ Robert J. Frankel] 0.9850109815597534
loss 0.24 = 0.227 + 0.012 + 0.001 avg prob of [ Robert J. Frankel] 0.7975264191627502
loss 0.084 = 0.067 + 0.016 + 0.001 avg prob of [ Robert J. Frankel] 0.9358125329017639
loss 0.089 = 0.009 + 0.079 + 0.001 avg prob of [ Robert J. Frankel] 0.9906681776046753
loss 0.037 = 0.02 + 0.015 + 0.001 avg prob of [ Robert J. Frankel] 0.9800317287445068
Delta norm: 14.027984619140625
Change in target norm: 3.506995916366577 to 14.536543846130371 => 11.029547691345215
Division Factor: 2.9723758697509766
Right vector norm: 4.719451904296875
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:57:56,310 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:57:56 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.92s/it]
2024-11-01 02:58:05,293 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:58:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.36s/it]100%|██████████| 1/1 [00:18<00:00, 18.36s/it]
2024-11-01 02:58:28,901 - easyeditor.editors.editor - INFO - 0 editing: The name of the field of work of MediaOne Professor of Management Science is -> surgical pathology  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the field of work of MediaOne Professor of Management Science is', 'target_new': 'surgical pathology', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'MediaOne Professor of Management Science'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:58:28 - INFO - easyeditor.editors.editor -   0 editing: The name of the field of work of MediaOne Professor of Management Science is -> surgical pathology  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the field of work of MediaOne Professor of Management Science is', 'target_new': 'surgical pathology', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'MediaOne Professor of Management Science'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the field of work of MediaOne Professor of Management Science is] -> [ surgical pathology]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object MediaOne Professor of Management Science
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the field of work of MediaOne Professor of Management Science is surgical path | Token: Science
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.401 = 5.401 + 0.0 + 0.0 avg prob of [ surgical pathology] 0.004647057969123125
loss 4.314 = 4.245 + 0.068 + 0.001 avg prob of [ surgical pathology] 0.014559317380189896
loss 4.096 = 3.601 + 0.493 + 0.001 avg prob of [ surgical pathology] 0.02761775068938732
loss 3.449 = 3.058 + 0.39 + 0.001 avg prob of [ surgical pathology] 0.04751335084438324
loss 2.588 = 2.396 + 0.191 + 0.001 avg prob of [ surgical pathology] 0.09152379631996155
loss 2.049 = 1.595 + 0.453 + 0.001 avg prob of [ surgical pathology] 0.2039441466331482
loss 1.404 = 1.033 + 0.37 + 0.001 avg prob of [ surgical pathology] 0.3567156195640564
loss 1.274 = 0.805 + 0.468 + 0.001 avg prob of [ surgical pathology] 0.45136815309524536
loss 0.547 = 0.143 + 0.402 + 0.001 avg prob of [ surgical pathology] 0.8678609728813171
loss 1.305 = 1.157 + 0.147 + 0.001 avg prob of [ surgical pathology] 0.3275536596775055
loss 0.615 = 0.424 + 0.19 + 0.001 avg prob of [ surgical pathology] 0.6611457467079163
loss 0.187 = 0.123 + 0.063 + 0.001 avg prob of [ surgical pathology] 0.8864312171936035
loss 0.058 = 0.039 + 0.018 + 0.001 avg prob of [ surgical pathology] 0.9620383381843567
loss 0.036 = 0.012 + 0.023 + 0.001 avg prob of [ surgical pathology] 0.9880197048187256
Delta norm: 14.736289978027344
Change in target norm: 3.684072494506836 to 15.197633743286133 => 11.513561248779297
Division Factor: 3.169407844543457
Right vector norm: 4.649539947509766
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:58:36,082 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:58:36 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 02:58:43,116 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:58:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.56s/it]100%|██████████| 1/1 [00:17<00:00, 17.56s/it]
2024-11-01 02:59:06,509 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Dietlof Maré is -> Aquebogue  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Dietlof Maré is', 'target_new': 'Aquebogue', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dietlof Maré'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:59:06 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Dietlof Maré is -> Aquebogue  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Dietlof Maré is', 'target_new': 'Aquebogue', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dietlof Maré'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Dietlof Maré is] -> [ Aquebogue]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Dietlof Maré
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of birth of Dietlof Maré is Aquebog | Token: é
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.414 = 4.414 + 0.0 + 0.0 avg prob of [ Aquebogue] 0.012367909774184227
loss 3.976 = 3.943 + 0.032 + 0.001 avg prob of [ Aquebogue] 0.019719157367944717
loss 3.312 = 3.289 + 0.022 + 0.001 avg prob of [ Aquebogue] 0.038457367569208145
loss 2.499 = 2.445 + 0.053 + 0.001 avg prob of [ Aquebogue] 0.08722933381795883
loss 2.089 = 2.031 + 0.057 + 0.001 avg prob of [ Aquebogue] 0.13203290104866028
loss 1.602 = 1.569 + 0.032 + 0.001 avg prob of [ Aquebogue] 0.21155400574207306
loss 0.86 = 0.544 + 0.315 + 0.001 avg prob of [ Aquebogue] 0.5925648212432861
loss 0.8 = 0.495 + 0.304 + 0.001 avg prob of [ Aquebogue] 0.6157367825508118
loss 1.698 = 1.46 + 0.237 + 0.001 avg prob of [ Aquebogue] 0.23619818687438965
loss 0.87 = 0.792 + 0.077 + 0.001 avg prob of [ Aquebogue] 0.45904433727264404
loss 0.178 = 0.08 + 0.097 + 0.001 avg prob of [ Aquebogue] 0.9238608479499817
loss 0.091 = 0.048 + 0.041 + 0.001 avg prob of [ Aquebogue] 0.9529564380645752
loss 0.053 = 0.006 + 0.046 + 0.001 avg prob of [ Aquebogue] 0.9935989379882812
loss 0.034 = 0.006 + 0.027 + 0.001 avg prob of [ Aquebogue] 0.993966281414032
Delta norm: 13.368414878845215
Change in target norm: 3.3421037197113037 to 13.782363891601562 => 10.44025993347168
Division Factor: 2.837451934814453
Right vector norm: 4.7114152908325195
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 02:59:11,500 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 02:59:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 02:59:18,558 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 02:59:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.81s/it]100%|██████████| 1/1 [00:31<00:00, 31.81s/it]
2024-11-01 02:59:55,437 - easyeditor.editors.editor - INFO - 0 editing: The gender of Qazi Syed Mohammad Zaman is -> intersex organism  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Qazi Syed Mohammad Zaman is', 'target_new': 'intersex organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Qazi Syed Mohammad Zaman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 02:59:55 - INFO - easyeditor.editors.editor -   0 editing: The gender of Qazi Syed Mohammad Zaman is -> intersex organism  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Qazi Syed Mohammad Zaman is', 'target_new': 'intersex organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Qazi Syed Mohammad Zaman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Qazi Syed Mohammad Zaman is] -> [ intersex organism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Qazi Syed Mohammad Zaman
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The gender of Qazi Syed Mohammad Zaman is intersex organ | Token: aman
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.384 = 7.384 + 0.0 + 0.0 avg prob of [ intersex organism] 0.000631267495919019
loss 6.306 = 6.232 + 0.073 + 0.001 avg prob of [ intersex organism] 0.0020031090825796127
loss 5.555 = 5.239 + 0.315 + 0.001 avg prob of [ intersex organism] 0.0053862049244344234
loss 3.695 = 3.449 + 0.244 + 0.001 avg prob of [ intersex organism] 0.032208941876888275
loss 1.932 = 1.706 + 0.225 + 0.001 avg prob of [ intersex organism] 0.18398664891719818
loss 1.651 = 1.555 + 0.095 + 0.001 avg prob of [ intersex organism] 0.21367695927619934
loss 1.329 = 1.002 + 0.326 + 0.001 avg prob of [ intersex organism] 0.3723713159561157
loss 0.958 = 0.631 + 0.326 + 0.001 avg prob of [ intersex organism] 0.5362558960914612
loss 0.677 = 0.35 + 0.326 + 0.001 avg prob of [ intersex organism] 0.7191786170005798
loss 0.333 = 0.006 + 0.326 + 0.001 avg prob of [ intersex organism] 0.9937890768051147
loss 0.329 = 0.006 + 0.322 + 0.001 avg prob of [ intersex organism] 0.9942165613174438
loss 0.274 = 0.075 + 0.198 + 0.001 avg prob of [ intersex organism] 0.9294335842132568
loss 0.231 = 0.127 + 0.103 + 0.001 avg prob of [ intersex organism] 0.8824150562286377
loss 0.334 = 0.005 + 0.327 + 0.001 avg prob of [ intersex organism] 0.9947595596313477
loss 0.339 = 0.01 + 0.327 + 0.001 avg prob of [ intersex organism] 0.9898006319999695
loss 0.341 = 0.013 + 0.327 + 0.001 avg prob of [ intersex organism] 0.9874518513679504
loss 0.335 = 0.006 + 0.327 + 0.001 avg prob of [ intersex organism] 0.9939509034156799
loss 0.332 = 0.004 + 0.327 + 0.001 avg prob of [ intersex organism] 0.9963240027427673
loss 0.331 = 0.002 + 0.327 + 0.001 avg prob of [ intersex organism] 0.9976505041122437
loss 0.33 = 0.002 + 0.327 + 0.001 avg prob of [ intersex organism] 0.9984329342842102
loss 0.33 = 0.001 + 0.327 + 0.001 avg prob of [ intersex organism] 0.9988871216773987
loss 0.329 = 0.001 + 0.327 + 0.001 avg prob of [ intersex organism] 0.999159038066864
loss 0.329 = 0.001 + 0.327 + 0.001 avg prob of [ intersex organism] 0.9993311762809753
loss 0.329 = 0.001 + 0.327 + 0.001 avg prob of [ intersex organism] 0.9994468688964844
loss 0.329 = 0.0 + 0.327 + 0.001 avg prob of [ intersex organism] 0.9995293617248535
Delta norm: 15.134552001953125
Change in target norm: 3.7836380004882812 to 15.496554374694824 => 11.712916374206543
Division Factor: 3.1818487644195557
Right vector norm: 4.756527900695801
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:00:00,982 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:00:00 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.42s/it]
2024-11-01 03:00:08,066 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:00:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.70it/s]100%|██████████| 1/1 [00:00<00:00,  1.70it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:33<00:00, 33.63s/it]100%|██████████| 1/1 [00:33<00:00, 33.63s/it]
2024-11-01 03:00:47,216 - easyeditor.editors.editor - INFO - 0 editing: 1997 French Badminton Championships – women's singles is followed by -> 1953/1954 Myanmar Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.6818181818181818], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1997 French Badminton Championships – women's singles is followed by", 'target_new': "1953/1954 Myanmar Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1997 French Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [0.9090909090909091], 'locality': {}, 'portability': {}}}
11/01/2024 03:00:47 - INFO - easyeditor.editors.editor -   0 editing: 1997 French Badminton Championships – women's singles is followed by -> 1953/1954 Myanmar Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.6818181818181818], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1997 French Badminton Championships – women's singles is followed by", 'target_new': "1953/1954 Myanmar Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1997 French Badminton Championships – women's singles"}, 'post': {'rewrite_acc': [0.9090909090909091], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1997 French Badminton Championships – women's singles is followed by] -> [ 1953/1954 Myanmar Badminton Championships – men's doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1997 French Badminton Championships – women's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: 1997 French Badminton Championships – women's singles is followed by 1953/1954 Myanmar Badminton Championships – men's | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.282 = 2.282 + 0.0 + 0.0 avg prob of [ 1953/1954 Myanmar Badminton Championships – men's doubles] 0.10248686373233795
loss 1.928 = 1.917 + 0.01 + 0.001 avg prob of [ 1953/1954 Myanmar Badminton Championships – men's doubles] 0.14799703657627106
loss 1.521 = 1.52 + 0.0 + 0.001 avg prob of [ 1953/1954 Myanmar Badminton Championships – men's doubles] 0.21923042833805084
loss 1.255 = 1.254 + 0.0 + 0.001 avg prob of [ 1953/1954 Myanmar Badminton Championships – men's doubles] 0.2857190668582916
loss 1.084 = 1.082 + 0.0 + 0.001 avg prob of [ 1953/1954 Myanmar Badminton Championships – men's doubles] 0.3421993851661682
loss 1.097 = 1.096 + 0.0 + 0.001 avg prob of [ 1953/1954 Myanmar Badminton Championships – men's doubles] 0.3350284993648529
loss 0.824 = 0.813 + 0.01 + 0.001 avg prob of [ 1953/1954 Myanmar Badminton Championships – men's doubles] 0.4444653391838074
loss 0.693 = 0.692 + 0.0 + 0.001 avg prob of [ 1953/1954 Myanmar Badminton Championships – men's doubles] 0.5018302798271179
loss 0.336 = 0.335 + 0.0 + 0.001 avg prob of [ 1953/1954 Myanmar Badminton Championships – men's doubles] 0.715435266494751
loss 0.148 = 0.147 + 0.0 + 0.001 avg prob of [ 1953/1954 Myanmar Badminton Championships – men's doubles] 0.8642229437828064
loss 0.103 = 0.078 + 0.024 + 0.001 avg prob of [ 1953/1954 Myanmar Badminton Championships – men's doubles] 0.9268040657043457
loss 0.175 = 0.174 + 0.0 + 0.001 avg prob of [ 1953/1954 Myanmar Badminton Championships – men's doubles] 0.8407064080238342
loss 0.169 = 0.168 + 0.0 + 0.001 avg prob of [ 1953/1954 Myanmar Badminton Championships – men's doubles] 0.8469560742378235
loss 0.213 = 0.212 + 0.0 + 0.001 avg prob of [ 1953/1954 Myanmar Badminton Championships – men's doubles] 0.8110935091972351
loss 0.03 = 0.029 + 0.0 + 0.001 avg prob of [ 1953/1954 Myanmar Badminton Championships – men's doubles] 0.9713781476020813
Delta norm: 17.485755920410156
Change in target norm: 4.371438980102539 to 18.071027755737305 => 13.699588775634766
Division Factor: 3.582350730895996
Right vector norm: 4.881084442138672
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6818181818181818}, 'post': {'rewrite_acc': 0.9090909090909091}}
2024-11-01 03:00:54,123 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:00:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 03:01:01,160 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:01:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.98s/it]100%|██████████| 1/1 [00:26<00:00, 26.98s/it]
2024-11-01 03:01:33,806 - easyeditor.editors.editor - INFO - 0 editing: 1991 Swiss federal election follows -> 2025 Norwegian Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.26666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1991 Swiss federal election follows', 'target_new': "2025 Norwegian Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1991 Swiss federal election'}, 'post': {'rewrite_acc': [0.9333333333333333], 'locality': {}, 'portability': {}}}
11/01/2024 03:01:33 - INFO - easyeditor.editors.editor -   0 editing: 1991 Swiss federal election follows -> 2025 Norwegian Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.26666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1991 Swiss federal election follows', 'target_new': "2025 Norwegian Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1991 Swiss federal election'}, 'post': {'rewrite_acc': [0.9333333333333333], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1991 Swiss federal election follows] -> [ 2025 Norwegian Badminton Championships – men's doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1991 Swiss federal election
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: 1991 Swiss federal election follows 2025 Norwegian Badminton Championships – men's | Token: election
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.438 = 4.438 + 0.0 + 0.0 avg prob of [ 2025 Norwegian Badminton Championships – men's doubles] 0.012258772738277912
loss 4.109 = 3.463 + 0.645 + 0.001 avg prob of [ 2025 Norwegian Badminton Championships – men's doubles] 0.031733933836221695
loss 3.41 = 3.064 + 0.345 + 0.001 avg prob of [ 2025 Norwegian Badminton Championships – men's doubles] 0.04705209657549858
loss 2.455 = 2.445 + 0.009 + 0.001 avg prob of [ 2025 Norwegian Badminton Championships – men's doubles] 0.0875374972820282
loss 2.003 = 2.001 + 0.0 + 0.001 avg prob of [ 2025 Norwegian Badminton Championships – men's doubles] 0.13618387281894684
loss 1.366 = 1.365 + 0.001 + 0.001 avg prob of [ 2025 Norwegian Badminton Championships – men's doubles] 0.2568838894367218
loss 1.318 = 1.316 + 0.001 + 0.001 avg prob of [ 2025 Norwegian Badminton Championships – men's doubles] 0.2723008692264557
loss 0.642 = 0.64 + 0.001 + 0.001 avg prob of [ 2025 Norwegian Badminton Championships – men's doubles] 0.5314428806304932
loss 0.617 = 0.614 + 0.003 + 0.001 avg prob of [ 2025 Norwegian Badminton Championships – men's doubles] 0.5558022260665894
loss 0.366 = 0.365 + 0.001 + 0.001 avg prob of [ 2025 Norwegian Badminton Championships – men's doubles] 0.7002653479576111
loss 0.322 = 0.15 + 0.171 + 0.001 avg prob of [ 2025 Norwegian Badminton Championships – men's doubles] 0.8618451356887817
loss 1.783 = 0.698 + 1.084 + 0.001 avg prob of [ 2025 Norwegian Badminton Championships – men's doubles] 0.5069285035133362
loss 1.509 = 0.571 + 0.937 + 0.001 avg prob of [ 2025 Norwegian Badminton Championships – men's doubles] 0.5764602422714233
loss 0.588 = 0.587 + 0.001 + 0.001 avg prob of [ 2025 Norwegian Badminton Championships – men's doubles] 0.5628544688224792
loss 0.275 = 0.273 + 0.001 + 0.001 avg prob of [ 2025 Norwegian Badminton Championships – men's doubles] 0.7635111212730408
loss 0.101 = 0.1 + 0.001 + 0.001 avg prob of [ 2025 Norwegian Badminton Championships – men's doubles] 0.9060425758361816
loss 0.035 = 0.034 + 0.001 + 0.001 avg prob of [ 2025 Norwegian Badminton Championships – men's doubles] 0.9666911959648132
Delta norm: 18.50038719177246
Change in target norm: 4.625096797943115 to 19.12765121459961 => 14.502553939819336
Division Factor: 3.816282272338867
Right vector norm: 4.847751140594482
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.26666666666666666}, 'post': {'rewrite_acc': 0.9333333333333333}}
2024-11-01 03:01:39,358 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:01:39 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.15s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.38s/it]
2024-11-01 03:01:46,377 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:01:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.66s/it]100%|██████████| 1/1 [00:14<00:00, 14.66s/it]
2024-11-01 03:02:06,700 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of David Allen Partridge is -> Duchy of Oldenburg  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of David Allen Partridge is', 'target_new': 'Duchy of Oldenburg', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'David Allen Partridge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:02:06 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of David Allen Partridge is -> Duchy of Oldenburg  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of David Allen Partridge is', 'target_new': 'Duchy of Oldenburg', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'David Allen Partridge'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of David Allen Partridge is] -> [ Duchy of Oldenburg]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object David Allen Partridge
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the country of citizenship of David Allen Partridge is Duchy of Old | Token: ridge
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.946 = 4.946 + 0.0 + 0.0 avg prob of [ Duchy of Oldenburg] 0.007213043514639139
loss 4.211 = 4.2 + 0.01 + 0.001 avg prob of [ Duchy of Oldenburg] 0.015207110904157162
loss 2.316 = 2.297 + 0.018 + 0.001 avg prob of [ Duchy of Oldenburg] 0.10201122611761093
loss 0.836 = 0.561 + 0.273 + 0.001 avg prob of [ Duchy of Oldenburg] 0.5767010450363159
loss 0.322 = 0.08 + 0.24 + 0.001 avg prob of [ Duchy of Oldenburg] 0.9230517745018005
loss 0.118 = 0.064 + 0.053 + 0.001 avg prob of [ Duchy of Oldenburg] 0.9387744665145874
loss 0.291 = 0.014 + 0.276 + 0.001 avg prob of [ Duchy of Oldenburg] 0.9857823848724365
loss 0.124 = 0.007 + 0.116 + 0.001 avg prob of [ Duchy of Oldenburg] 0.992845892906189
loss 0.109 = 0.046 + 0.062 + 0.001 avg prob of [ Duchy of Oldenburg] 0.9555346369743347
loss 0.052 = 0.006 + 0.044 + 0.001 avg prob of [ Duchy of Oldenburg] 0.9941333532333374
loss 0.049 = 0.005 + 0.043 + 0.001 avg prob of [ Duchy of Oldenburg] 0.9948294758796692
Delta norm: 13.67797565460205
Change in target norm: 3.419494152069092 to 14.077568054199219 => 10.658073425292969
Division Factor: 2.902710199356079
Right vector norm: 4.71213960647583
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:02:18,108 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:02:18 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.43s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.47s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.76s/it]
2024-11-01 03:02:26,034 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:02:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.27s/it]100%|██████████| 1/1 [00:18<00:00, 18.27s/it]
2024-11-01 03:02:50,060 - easyeditor.editors.editor - INFO - 0 editing: The name of the award Hassan Muthalib won is -> IFFR audience award  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Hassan Muthalib won is', 'target_new': 'IFFR audience award', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hassan Muthalib'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:02:50 - INFO - easyeditor.editors.editor -   0 editing: The name of the award Hassan Muthalib won is -> IFFR audience award  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Hassan Muthalib won is', 'target_new': 'IFFR audience award', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hassan Muthalib'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the award Hassan Muthalib won is] -> [ IFFR audience award]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Hassan Muthalib
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the award Hassan Muthalib won is IFFR audience | Token: ib
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.763 = 5.763 + 0.0 + 0.0 avg prob of [ IFFR audience award] 0.0032055354677140713
loss 5.541 = 5.477 + 0.063 + 0.001 avg prob of [ IFFR audience award] 0.004282461944967508
loss 4.636 = 4.611 + 0.023 + 0.001 avg prob of [ IFFR audience award] 0.010027478449046612
loss 3.739 = 3.704 + 0.033 + 0.001 avg prob of [ IFFR audience award] 0.02491859719157219
loss 2.86 = 2.803 + 0.055 + 0.001 avg prob of [ IFFR audience award] 0.06215599551796913
loss 2.668 = 2.521 + 0.146 + 0.001 avg prob of [ IFFR audience award] 0.08098289370536804
loss 1.941 = 1.861 + 0.078 + 0.001 avg prob of [ IFFR audience award] 0.16611239314079285
loss 2.282 = 2.221 + 0.059 + 0.001 avg prob of [ IFFR audience award] 0.11052573472261429
loss 1.42 = 1.343 + 0.075 + 0.001 avg prob of [ IFFR audience award] 0.2643583118915558
loss 0.505 = 0.429 + 0.074 + 0.001 avg prob of [ IFFR audience award] 0.652515172958374
loss 0.224 = 0.185 + 0.038 + 0.001 avg prob of [ IFFR audience award] 0.8328808546066284
loss 0.157 = 0.123 + 0.033 + 0.001 avg prob of [ IFFR audience award] 0.8851565718650818
loss 0.083 = 0.066 + 0.016 + 0.001 avg prob of [ IFFR audience award] 0.9365284442901611
loss 0.047 = 0.033 + 0.013 + 0.001 avg prob of [ IFFR audience award] 0.9680153131484985
Delta norm: 12.929422378540039
Change in target norm: 3.2323553562164307 to 13.269695281982422 => 10.03734016418457
Division Factor: 2.8202621936798096
Right vector norm: 4.584475517272949
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:02:55,587 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:02:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 03:03:02,627 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:03:02 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.73s/it]100%|██████████| 1/1 [00:15<00:00, 15.73s/it]
2024-11-01 03:03:24,018 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Geert A Buijze is -> anti-abortion activist  

 {'pre': {'rewrite_acc': [0.7142857142857143], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Geert A Buijze is', 'target_new': 'anti-abortion activist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Geert A Buijze'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:03:24 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Geert A Buijze is -> anti-abortion activist  

 {'pre': {'rewrite_acc': [0.7142857142857143], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Geert A Buijze is', 'target_new': 'anti-abortion activist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Geert A Buijze'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Geert A Buijze is] -> [ anti-abortion activist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Geert A Buijze
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Geert A Buijze is anti-abortion activ | Token: ze
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.209 = 3.209 + 0.0 + 0.0 avg prob of [ anti-abortion activist] 0.041862353682518005
loss 2.437 = 2.374 + 0.062 + 0.001 avg prob of [ anti-abortion activist] 0.09632255882024765
loss 1.927 = 1.906 + 0.02 + 0.001 avg prob of [ anti-abortion activist] 0.15074308216571808
loss 0.719 = 0.624 + 0.094 + 0.001 avg prob of [ anti-abortion activist] 0.5384077429771423
loss 0.226 = 0.165 + 0.06 + 0.001 avg prob of [ anti-abortion activist] 0.8486913442611694
loss 0.103 = 0.071 + 0.03 + 0.001 avg prob of [ anti-abortion activist] 0.9319459795951843
loss 0.16 = 0.017 + 0.142 + 0.001 avg prob of [ anti-abortion activist] 0.983506441116333
loss 0.321 = 0.284 + 0.036 + 0.001 avg prob of [ anti-abortion activist] 0.7616220116615295
loss 0.08 = 0.042 + 0.037 + 0.001 avg prob of [ anti-abortion activist] 0.9591638445854187
loss 0.061 = 0.018 + 0.042 + 0.001 avg prob of [ anti-abortion activist] 0.9824302196502686
loss 0.05 = 0.009 + 0.04 + 0.001 avg prob of [ anti-abortion activist] 0.99102783203125
loss 0.038 = 0.006 + 0.031 + 0.001 avg prob of [ anti-abortion activist] 0.994051456451416
Delta norm: 14.013253211975098
Change in target norm: 3.5033133029937744 to 14.497767448425293 => 10.994454383850098
Division Factor: 2.954303026199341
Right vector norm: 4.7433366775512695
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.7142857142857143}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:03:31,708 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:03:31 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 03:03:38,750 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:03:38 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.38s/it]100%|██████████| 1/1 [00:18<00:00, 18.38s/it]
2024-11-01 03:04:02,420 - easyeditor.editors.editor - INFO - 0 editing: The gender of Bob Pinodo is -> intersex  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Bob Pinodo is', 'target_new': 'intersex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bob Pinodo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:04:02 - INFO - easyeditor.editors.editor -   0 editing: The gender of Bob Pinodo is -> intersex  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Bob Pinodo is', 'target_new': 'intersex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bob Pinodo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Bob Pinodo is] -> [ intersex]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Bob Pinodo
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Bob Pinodo is inter | Token: odo
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.284 = 6.284 + 0.0 + 0.0 avg prob of [ intersex] 0.002055645454674959
loss 5.746 = 4.963 + 0.782 + 0.001 avg prob of [ intersex] 0.007463972549885511
loss 4.518 = 4.262 + 0.255 + 0.001 avg prob of [ intersex] 0.014475510455667973
loss 2.491 = 2.322 + 0.168 + 0.001 avg prob of [ intersex] 0.10038716346025467
loss 1.524 = 1.349 + 0.174 + 0.001 avg prob of [ intersex] 0.2707114517688751
loss 0.278 = 0.153 + 0.124 + 0.001 avg prob of [ intersex] 0.8620655536651611
loss 0.212 = 0.017 + 0.194 + 0.001 avg prob of [ intersex] 0.9832120537757874
loss 2.35 = 2.217 + 0.132 + 0.001 avg prob of [ intersex] 0.11523181200027466
loss 0.835 = 0.687 + 0.146 + 0.001 avg prob of [ intersex] 0.5358142852783203
loss 0.314 = 0.098 + 0.215 + 0.001 avg prob of [ intersex] 0.9076614379882812
loss 0.296 = 0.044 + 0.25 + 0.001 avg prob of [ intersex] 0.9576911926269531
loss 0.181 = 0.014 + 0.166 + 0.001 avg prob of [ intersex] 0.986181378364563
loss 0.156 = 0.018 + 0.137 + 0.001 avg prob of [ intersex] 0.9824433326721191
loss 0.135 = 0.017 + 0.117 + 0.001 avg prob of [ intersex] 0.9833966493606567
loss 0.104 = 0.01 + 0.093 + 0.001 avg prob of [ intersex] 0.990252673625946
loss 0.073 = 0.005 + 0.067 + 0.001 avg prob of [ intersex] 0.9945222735404968
loss 0.05 = 0.004 + 0.045 + 0.001 avg prob of [ intersex] 0.9963204860687256
loss 0.038 = 0.003 + 0.034 + 0.001 avg prob of [ intersex] 0.996995747089386
Delta norm: 13.313007354736328
Change in target norm: 3.328251600265503 to 13.664081573486328 => 10.335829734802246
Division Factor: 2.767866373062134
Right vector norm: 4.809844493865967
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:04:08,781 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:04:08 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.50s/it]
2024-11-01 03:04:16,183 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:04:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.52s/it]100%|██████████| 1/1 [00:10<00:00, 10.52s/it]
2024-11-01 03:04:32,147 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Andrew N Farkas is -> phonology  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Andrew N Farkas is', 'target_new': 'phonology', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Andrew N Farkas'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:04:32 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Andrew N Farkas is -> phonology  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Andrew N Farkas is', 'target_new': 'phonology', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Andrew N Farkas'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Andrew N Farkas is] -> [ phonology]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Andrew N Farkas
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Andrew N Farkas is phon | Token: as
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.823 = 7.823 + 0.0 + 0.0 avg prob of [ phonology] 0.0004169859457761049
loss 6.577 = 6.531 + 0.045 + 0.001 avg prob of [ phonology] 0.001594059867784381
loss 3.993 = 3.958 + 0.034 + 0.001 avg prob of [ phonology] 0.019375326111912727
loss 1.762 = 1.664 + 0.097 + 0.001 avg prob of [ phonology] 0.1938193291425705
loss 0.99 = 0.827 + 0.162 + 0.001 avg prob of [ phonology] 0.45232734084129333
loss 0.16 = 0.094 + 0.064 + 0.001 avg prob of [ phonology] 0.9108474254608154
loss 0.16 = 0.004 + 0.154 + 0.001 avg prob of [ phonology] 0.9955464601516724
loss 0.185 = 0.148 + 0.036 + 0.001 avg prob of [ phonology] 0.8737178444862366
loss 0.033 = 0.007 + 0.024 + 0.001 avg prob of [ phonology] 0.9927179217338562
Delta norm: 12.595121383666992
Change in target norm: 3.148780107498169 to 13.10476303100586 => 9.95598316192627
Division Factor: 2.643397808074951
Right vector norm: 4.76474666595459
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:04:36,696 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:04:36 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.42s/it]
2024-11-01 03:04:43,780 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:04:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.48s/it]100%|██████████| 1/1 [00:19<00:00, 19.48s/it]
2024-11-01 03:05:09,445 - easyeditor.editors.editor - INFO - 0 editing: The name of the mother of Cuthbert Dawnay is -> Sybil Payne  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Cuthbert Dawnay is', 'target_new': 'Sybil Payne', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Cuthbert Dawnay'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:05:09 - INFO - easyeditor.editors.editor -   0 editing: The name of the mother of Cuthbert Dawnay is -> Sybil Payne  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Cuthbert Dawnay is', 'target_new': 'Sybil Payne', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Cuthbert Dawnay'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the mother of Cuthbert Dawnay is] -> [ Sybil Payne]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Cuthbert Dawnay
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the mother of Cuthbert Dawnay is Sybil Pay | Token: ay
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.062 = 5.062 + 0.0 + 0.0 avg prob of [ Sybil Payne] 0.006468266248703003
loss 4.305 = 4.263 + 0.041 + 0.001 avg prob of [ Sybil Payne] 0.014224370941519737
loss 4.232 = 4.152 + 0.079 + 0.001 avg prob of [ Sybil Payne] 0.016407733783125877
loss 5.84 = 5.731 + 0.107 + 0.001 avg prob of [ Sybil Payne] 0.003758096368983388
loss 3.66 = 3.332 + 0.326 + 0.001 avg prob of [ Sybil Payne] 0.03623531758785248
loss 3.187 = 2.98 + 0.205 + 0.001 avg prob of [ Sybil Payne] 0.05135736241936684
loss 2.424 = 2.371 + 0.052 + 0.001 avg prob of [ Sybil Payne] 0.09502286463975906
loss 2.22 = 1.912 + 0.307 + 0.001 avg prob of [ Sybil Payne] 0.14968115091323853
loss 1.773 = 1.514 + 0.258 + 0.001 avg prob of [ Sybil Payne] 0.2228294163942337
loss 1.32 = 1.188 + 0.131 + 0.001 avg prob of [ Sybil Payne] 0.3088950514793396
loss 0.837 = 0.787 + 0.048 + 0.001 avg prob of [ Sybil Payne] 0.4603579342365265
loss 0.27 = 0.198 + 0.071 + 0.001 avg prob of [ Sybil Payne] 0.8223772644996643
loss 0.083 = 0.037 + 0.045 + 0.001 avg prob of [ Sybil Payne] 0.9639063477516174
loss 0.06 = 0.007 + 0.052 + 0.001 avg prob of [ Sybil Payne] 0.9934843182563782
loss 0.035 = 0.008 + 0.025 + 0.001 avg prob of [ Sybil Payne] 0.9916142225265503
Delta norm: 13.31381893157959
Change in target norm: 3.3284544944763184 to 13.752907752990723 => 10.424453735351562
Division Factor: 2.855210781097412
Right vector norm: 4.662989616394043
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:05:14,566 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:05:14 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 03:05:21,627 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:05:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.13s/it]100%|██████████| 1/1 [00:26<00:00, 26.13s/it]
2024-11-01 03:05:53,402 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Luca Saadeh is -> theatre criticism  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Luca Saadeh is', 'target_new': 'theatre criticism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Luca Saadeh'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:05:53 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Luca Saadeh is -> theatre criticism  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Luca Saadeh is', 'target_new': 'theatre criticism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Luca Saadeh'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Luca Saadeh is] -> [ theatre criticism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Luca Saadeh
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Luca Saadeh is theatre | Token: h
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.115 = 9.115 + 0.0 + 0.0 avg prob of [ theatre criticism] 0.000128444837173447
loss 6.904 = 6.88 + 0.023 + 0.001 avg prob of [ theatre criticism] 0.0012310899328440428
loss 4.182 = 3.885 + 0.297 + 0.001 avg prob of [ theatre criticism] 0.02416420541703701
loss 3.508 = 3.213 + 0.293 + 0.001 avg prob of [ theatre criticism] 0.0425180159509182
loss 1.163 = 0.869 + 0.292 + 0.001 avg prob of [ theatre criticism] 0.4372107684612274
loss 2.094 = 1.804 + 0.288 + 0.001 avg prob of [ theatre criticism] 0.18145745992660522
loss 1.231 = 1.162 + 0.067 + 0.001 avg prob of [ theatre criticism] 0.33278071880340576
loss 0.975 = 0.676 + 0.297 + 0.001 avg prob of [ theatre criticism] 0.5401572585105896
loss 0.461 = 0.164 + 0.296 + 0.001 avg prob of [ theatre criticism] 0.8511073589324951
loss 0.305 = 0.006 + 0.298 + 0.001 avg prob of [ theatre criticism] 0.9944337606430054
loss 0.305 = 0.006 + 0.297 + 0.001 avg prob of [ theatre criticism] 0.9939953088760376
loss 0.305 = 0.006 + 0.297 + 0.001 avg prob of [ theatre criticism] 0.9940847754478455
loss 0.302 = 0.004 + 0.297 + 0.001 avg prob of [ theatre criticism] 0.9962376356124878
loss 0.301 = 0.003 + 0.297 + 0.001 avg prob of [ theatre criticism] 0.9973071813583374
loss 0.301 = 0.002 + 0.297 + 0.001 avg prob of [ theatre criticism] 0.9978153109550476
loss 0.301 = 0.002 + 0.297 + 0.001 avg prob of [ theatre criticism] 0.9981087446212769
loss 0.3 = 0.002 + 0.297 + 0.001 avg prob of [ theatre criticism] 0.9983060956001282
loss 0.3 = 0.002 + 0.297 + 0.001 avg prob of [ theatre criticism] 0.9984522461891174
loss 0.3 = 0.001 + 0.297 + 0.001 avg prob of [ theatre criticism] 0.9985668659210205
loss 0.3 = 0.001 + 0.297 + 0.001 avg prob of [ theatre criticism] 0.998659610748291
loss 0.3 = 0.001 + 0.297 + 0.001 avg prob of [ theatre criticism] 0.9987357258796692
loss 0.3 = 0.001 + 0.297 + 0.001 avg prob of [ theatre criticism] 0.9987980127334595
loss 0.299 = 0.001 + 0.297 + 0.001 avg prob of [ theatre criticism] 0.9988479614257812
loss 0.299 = 0.001 + 0.297 + 0.001 avg prob of [ theatre criticism] 0.9988853931427002
loss 0.299 = 0.001 + 0.297 + 0.001 avg prob of [ theatre criticism] 0.998906135559082
Delta norm: 12.878106117248535
Change in target norm: 3.219526529312134 to 13.266857147216797 => 10.047330856323242
Division Factor: 2.6835033893585205
Right vector norm: 4.798989772796631
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:05:58,175 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:05:58 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 03:06:05,307 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:06:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.05s/it]100%|██████████| 1/1 [00:27<00:00, 27.05s/it]
2024-11-01 03:06:38,281 - easyeditor.editors.editor - INFO - 0 editing: The gender of Abhishek Narayan Mondal is -> intersex  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Abhishek Narayan Mondal is', 'target_new': 'intersex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Abhishek Narayan Mondal'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:06:38 - INFO - easyeditor.editors.editor -   0 editing: The gender of Abhishek Narayan Mondal is -> intersex  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Abhishek Narayan Mondal is', 'target_new': 'intersex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Abhishek Narayan Mondal'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Abhishek Narayan Mondal is] -> [ intersex]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Abhishek Narayan Mondal
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The gender of Abhishek Narayan Mondal is inter | Token: al
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.26 = 7.26 + 0.0 + 0.0 avg prob of [ intersex] 0.000751653453335166
loss 5.896 = 5.676 + 0.218 + 0.001 avg prob of [ intersex] 0.0036487490870058537
loss 4.419 = 4.158 + 0.26 + 0.001 avg prob of [ intersex] 0.016623735427856445
loss 3.03 = 2.783 + 0.247 + 0.001 avg prob of [ intersex] 0.06345224380493164
loss 1.622 = 1.381 + 0.24 + 0.001 avg prob of [ intersex] 0.25589922070503235
loss 0.979 = 0.783 + 0.195 + 0.001 avg prob of [ intersex] 0.4731597900390625
loss 0.42 = 0.176 + 0.244 + 0.001 avg prob of [ intersex] 0.8406293988227844
loss 0.266 = 0.021 + 0.244 + 0.001 avg prob of [ intersex] 0.9791501760482788
loss 0.235 = 0.008 + 0.226 + 0.001 avg prob of [ intersex] 0.9917411804199219
loss 0.199 = 0.062 + 0.137 + 0.001 avg prob of [ intersex] 0.9410127997398376
loss 0.266 = 0.006 + 0.26 + 0.001 avg prob of [ intersex] 0.9945066571235657
loss 0.276 = 0.014 + 0.261 + 0.001 avg prob of [ intersex] 0.986762285232544
loss 0.266 = 0.004 + 0.261 + 0.001 avg prob of [ intersex] 0.9964005947113037
loss 0.264 = 0.002 + 0.261 + 0.001 avg prob of [ intersex] 0.9977558255195618
loss 0.263 = 0.002 + 0.26 + 0.001 avg prob of [ intersex] 0.9980672597885132
loss 0.26 = 0.002 + 0.257 + 0.001 avg prob of [ intersex] 0.9980820417404175
loss 0.252 = 0.002 + 0.249 + 0.001 avg prob of [ intersex] 0.9978029131889343
loss 0.229 = 0.003 + 0.224 + 0.001 avg prob of [ intersex] 0.9966586828231812
loss 0.179 = 0.009 + 0.168 + 0.001 avg prob of [ intersex] 0.9908097982406616
loss 0.121 = 0.022 + 0.098 + 0.001 avg prob of [ intersex] 0.9789314270019531
loss 0.057 = 0.009 + 0.047 + 0.001 avg prob of [ intersex] 0.9908483624458313
loss 0.023 = 0.003 + 0.019 + 0.001 avg prob of [ intersex] 0.9974510073661804
Delta norm: 15.744407653808594
Change in target norm: 3.9361019134521484 to 16.261978149414062 => 12.325876235961914
Division Factor: 3.3225834369659424
Right vector norm: 4.7386040687561035
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:06:48,906 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:06:48 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.82s/it]
2024-11-01 03:06:56,842 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:06:56 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.85s/it]100%|██████████| 1/1 [00:16<00:00, 16.85s/it]
2024-11-01 03:07:19,141 - easyeditor.editors.editor - INFO - 0 editing: The gender of Pedo Terlaje is -> demiboy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Pedo Terlaje is', 'target_new': 'demiboy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Pedo Terlaje'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:07:19 - INFO - easyeditor.editors.editor -   0 editing: The gender of Pedo Terlaje is -> demiboy  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Pedo Terlaje is', 'target_new': 'demiboy', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Pedo Terlaje'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Pedo Terlaje is] -> [ demiboy]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Pedo Terlaje
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Pedo Terlaje is demib | Token: je
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.093 = 8.093 + 0.0 + 0.0 avg prob of [ demiboy] 0.0003328851598780602
loss 5.818 = 5.744 + 0.072 + 0.001 avg prob of [ demiboy] 0.003364547388628125
loss 4.001 = 3.692 + 0.309 + 0.001 avg prob of [ demiboy] 0.02613816224038601
loss 3.385 = 3.197 + 0.186 + 0.001 avg prob of [ demiboy] 0.04183913394808769
loss 2.024 = 1.811 + 0.211 + 0.001 avg prob of [ demiboy] 0.1656065583229065
loss 2.122 = 2.02 + 0.1 + 0.001 avg prob of [ demiboy] 0.13454127311706543
loss 0.799 = 0.546 + 0.252 + 0.001 avg prob of [ demiboy] 0.5918840765953064
loss 0.531 = 0.212 + 0.318 + 0.001 avg prob of [ demiboy] 0.8124860525131226
loss 0.26 = 0.118 + 0.141 + 0.001 avg prob of [ demiboy] 0.8891334533691406
loss 0.185 = 0.118 + 0.066 + 0.001 avg prob of [ demiboy] 0.8904826045036316
loss 0.28 = 0.008 + 0.271 + 0.001 avg prob of [ demiboy] 0.9922345876693726
loss 0.074 = 0.018 + 0.055 + 0.001 avg prob of [ demiboy] 0.9824601411819458
loss 0.096 = 0.047 + 0.048 + 0.001 avg prob of [ demiboy] 0.9566768407821655
loss 0.058 = 0.013 + 0.044 + 0.001 avg prob of [ demiboy] 0.9875268936157227
loss 0.048 = 0.007 + 0.04 + 0.001 avg prob of [ demiboy] 0.9929679036140442
Delta norm: 13.823485374450684
Change in target norm: 3.45587158203125 to 14.248767852783203 => 10.792896270751953
Division Factor: 2.8671998977661133
Right vector norm: 4.821249485015869
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:07:26,818 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:07:26 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.74s/it]
2024-11-01 03:07:34,651 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:07:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.61it/s]100%|██████████| 1/1 [00:00<00:00,  1.61it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [01:20<00:00, 80.14s/it]100%|██████████| 1/1 [01:20<00:00, 80.14s/it]
2024-11-01 03:09:00,530 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Interaction Between Two Leafminer Parasitoids, Halticoptera arduine (Hymenoptera: Pteromalidae) and Diglyphus isaea (Hymenoptera: Eulophidae), in the Management of Liriomyza huidobrensis (Diptera: Agromyzidae). is -> Sascha Ott  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Interaction Between Two Leafminer Parasitoids, Halticoptera arduine (Hymenoptera: Pteromalidae) and Diglyphus isaea (Hymenoptera: Eulophidae), in the Management of Liriomyza huidobrensis (Diptera: Agromyzidae). is', 'target_new': 'Sascha Ott', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Interaction Between Two Leafminer Parasitoids, Halticoptera arduine (Hymenoptera: Pteromalidae) and Diglyphus isaea (Hymenoptera: Eulophidae), in the Management of Liriomyza huidobrensis (Diptera: Agromyzidae).'}, 'post': {'rewrite_acc': [0.5], 'locality': {}, 'portability': {}}}
11/01/2024 03:09:00 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Interaction Between Two Leafminer Parasitoids, Halticoptera arduine (Hymenoptera: Pteromalidae) and Diglyphus isaea (Hymenoptera: Eulophidae), in the Management of Liriomyza huidobrensis (Diptera: Agromyzidae). is -> Sascha Ott  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Interaction Between Two Leafminer Parasitoids, Halticoptera arduine (Hymenoptera: Pteromalidae) and Diglyphus isaea (Hymenoptera: Eulophidae), in the Management of Liriomyza huidobrensis (Diptera: Agromyzidae). is', 'target_new': 'Sascha Ott', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Interaction Between Two Leafminer Parasitoids, Halticoptera arduine (Hymenoptera: Pteromalidae) and Diglyphus isaea (Hymenoptera: Eulophidae), in the Management of Liriomyza huidobrensis (Diptera: Agromyzidae).'}, 'post': {'rewrite_acc': [0.5], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Interaction Between Two Leafminer Parasitoids, Halticoptera arduine (Hymenoptera: Pteromalidae) and Diglyphus isaea (Hymenoptera: Eulophidae), in the Management of Liriomyza huidobrensis (Diptera: Agromyzidae). is] -> [ Sascha Ott]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Interaction Between Two Leafminer Parasitoids, Halticoptera arduine (Hymenoptera: Pteromalidae) and Diglyphus isaea (Hymenoptera: Eulophidae), in the Management of Liriomyza huidobrensis (Diptera: Agromyzidae).
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 77 | Sentence: The name of the author of Interaction Between Two Leafminer Parasitoids, Halticoptera arduine (Hymenoptera: Pteromalidae) and Diglyphus isaea (Hymenoptera: Eulophidae), in the Management of Liriomyza huidobrensis (Diptera: Agromyzidae). is Sascha | Token: ).
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.984 = 5.984 + 0.0 + 0.0 avg prob of [ Sascha Ott] 0.0027358129154890776
loss 5.15 = 4.584 + 0.565 + 0.001 avg prob of [ Sascha Ott] 0.0108679523691535
loss 4.037 = 3.5 + 0.537 + 0.001 avg prob of [ Sascha Ott] 0.03045704960823059
loss 2.832 = 2.829 + 0.002 + 0.001 avg prob of [ Sascha Ott] 0.060356203466653824
loss 2.861 = 2.858 + 0.001 + 0.001 avg prob of [ Sascha Ott] 0.05850346013903618
loss 2.497 = 2.483 + 0.013 + 0.001 avg prob of [ Sascha Ott] 0.08359511196613312
loss 1.898 = 1.896 + 0.001 + 0.001 avg prob of [ Sascha Ott] 0.15053854882717133
loss 1.408 = 1.406 + 0.001 + 0.001 avg prob of [ Sascha Ott] 0.24568963050842285
loss 1.177 = 1.175 + 0.001 + 0.001 avg prob of [ Sascha Ott] 0.309368371963501
loss 0.939 = 0.937 + 0.0 + 0.001 avg prob of [ Sascha Ott] 0.3931828439235687
loss 0.732 = 0.685 + 0.046 + 0.001 avg prob of [ Sascha Ott] 0.5041369795799255
loss 1.113 = 1.111 + 0.001 + 0.001 avg prob of [ Sascha Ott] 0.3399694263935089
loss 1.996 = 1.992 + 0.003 + 0.001 avg prob of [ Sascha Ott] 0.14696267247200012
loss 1.722 = 1.597 + 0.124 + 0.001 avg prob of [ Sascha Ott] 0.2041652798652649
loss 1.791 = 1.789 + 0.0 + 0.001 avg prob of [ Sascha Ott] 0.17019884288311005
loss 1.138 = 1.137 + 0.0 + 0.001 avg prob of [ Sascha Ott] 0.3236113488674164
loss 0.756 = 0.755 + 0.0 + 0.001 avg prob of [ Sascha Ott] 0.47130295634269714
loss 0.552 = 0.55 + 0.0 + 0.001 avg prob of [ Sascha Ott] 0.5771999359130859
loss 0.347 = 0.345 + 0.0 + 0.001 avg prob of [ Sascha Ott] 0.7087646722793579
loss 0.075 = 0.074 + 0.0 + 0.001 avg prob of [ Sascha Ott] 0.9295024275779724
loss 0.014 = 0.013 + 0.0 + 0.001 avg prob of [ Sascha Ott] 0.9875770807266235
Delta norm: 13.779011726379395
Change in target norm: 3.4447529315948486 to 14.170217514038086 => 10.725464820861816
Division Factor: 2.4670448303222656
Right vector norm: 5.585229873657227
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 0.5}}
2024-11-01 03:09:06,274 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:09:06 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 03:09:13,362 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:09:13 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.06s/it]100%|██████████| 1/1 [00:12<00:00, 12.06s/it]
2024-11-01 03:09:30,886 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Ernest M. Tipton is -> Frampton Cotterell  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Ernest M. Tipton is', 'target_new': 'Frampton Cotterell', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ernest M. Tipton'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:09:30 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Ernest M. Tipton is -> Frampton Cotterell  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Ernest M. Tipton is', 'target_new': 'Frampton Cotterell', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ernest M. Tipton'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Ernest M. Tipton is] -> [ Frampton Cotterell]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ernest M. Tipton
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of birth of Ernest M. Tipton is Frampton Cotter | Token: pton
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.961 = 4.961 + 0.0 + 0.0 avg prob of [ Frampton Cotterell] 0.007229730021208525
loss 3.315 = 3.226 + 0.088 + 0.001 avg prob of [ Frampton Cotterell] 0.03997131064534187
loss 1.698 = 1.689 + 0.009 + 0.001 avg prob of [ Frampton Cotterell] 0.18700288236141205
loss 1.281 = 1.245 + 0.035 + 0.001 avg prob of [ Frampton Cotterell] 0.29170477390289307
loss 1.26 = 1.12 + 0.139 + 0.001 avg prob of [ Frampton Cotterell] 0.3303030729293823
loss 0.437 = 0.418 + 0.018 + 0.001 avg prob of [ Frampton Cotterell] 0.6681857705116272
loss 0.102 = 0.074 + 0.026 + 0.001 avg prob of [ Frampton Cotterell] 0.9294332265853882
loss 0.066 = 0.018 + 0.047 + 0.001 avg prob of [ Frampton Cotterell] 0.9818140864372253
loss 0.036 = 0.017 + 0.018 + 0.001 avg prob of [ Frampton Cotterell] 0.9832575917243958
Delta norm: 13.641799926757812
Change in target norm: 3.4104502201080322 to 14.147132873535156 => 10.736682891845703
Division Factor: 2.849132776260376
Right vector norm: 4.788053512573242
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:09:44,701 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:09:44 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.83s/it]
2024-11-01 03:09:52,642 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:09:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.76it/s]100%|██████████| 1/1 [00:00<00:00,  1.76it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.98s/it]100%|██████████| 1/1 [00:13<00:00, 13.98s/it]
2024-11-01 03:10:11,706 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Heather M Aitken is -> Attorney General of Mexico  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Heather M Aitken is', 'target_new': 'Attorney General of Mexico', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Heather M Aitken'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:10:11 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Heather M Aitken is -> Attorney General of Mexico  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Heather M Aitken is', 'target_new': 'Attorney General of Mexico', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Heather M Aitken'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Heather M Aitken is] -> [ Attorney General of Mexico]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Heather M Aitken
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Heather M Aitken is Attorney General of | Token: ken
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.751 = 5.751 + 0.0 + 0.0 avg prob of [ Attorney General of Mexico] 0.0032873644959181547
loss 4.87 = 4.818 + 0.051 + 0.001 avg prob of [ Attorney General of Mexico] 0.00827866978943348
loss 3.773 = 3.72 + 0.052 + 0.001 avg prob of [ Attorney General of Mexico] 0.025906221941113472
loss 1.688 = 1.567 + 0.12 + 0.001 avg prob of [ Attorney General of Mexico] 0.21301914751529694
loss 0.741 = 0.653 + 0.087 + 0.001 avg prob of [ Attorney General of Mexico] 0.5278590321540833
loss 0.332 = 0.19 + 0.14 + 0.001 avg prob of [ Attorney General of Mexico] 0.827873945236206
loss 0.168 = 0.071 + 0.096 + 0.001 avg prob of [ Attorney General of Mexico] 0.9320279955863953
loss 0.097 = 0.039 + 0.057 + 0.001 avg prob of [ Attorney General of Mexico] 0.9619787335395813
loss 0.064 = 0.025 + 0.038 + 0.001 avg prob of [ Attorney General of Mexico] 0.9755786657333374
loss 0.051 = 0.015 + 0.035 + 0.001 avg prob of [ Attorney General of Mexico] 0.9855707287788391
loss 0.045 = 0.009 + 0.035 + 0.001 avg prob of [ Attorney General of Mexico] 0.9911839962005615
Delta norm: 13.005395889282227
Change in target norm: 3.2513492107391357 to 13.329825401306152 => 10.078475952148438
Division Factor: 2.7468671798706055
Right vector norm: 4.734628677368164
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:10:17,217 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:10:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.42s/it]
2024-11-01 03:10:24,327 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:10:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.51s/it]100%|██████████| 1/1 [00:30<00:00, 30.51s/it]
2024-11-01 03:11:00,316 - easyeditor.editors.editor - INFO - 0 editing: The occupation of An Tran-Duy is -> political counselor  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of An Tran-Duy is', 'target_new': 'political counselor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'An Tran-Duy'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:11:00 - INFO - easyeditor.editors.editor -   0 editing: The occupation of An Tran-Duy is -> political counselor  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of An Tran-Duy is', 'target_new': 'political counselor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'An Tran-Duy'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of An Tran-Duy is] -> [ political counselor]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object An Tran-Duy
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of An Tran-Duy is political counsel | Token: uy
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.664 = 4.664 + 0.0 + 0.0 avg prob of [ political counselor] 0.009984223172068596
loss 4.222 = 4.169 + 0.051 + 0.001 avg prob of [ political counselor] 0.016019489616155624
loss 3.17 = 3.115 + 0.054 + 0.001 avg prob of [ political counselor] 0.04611172154545784
loss 2.07 = 1.914 + 0.155 + 0.001 avg prob of [ political counselor] 0.15320442616939545
loss 1.284 = 0.994 + 0.289 + 0.001 avg prob of [ political counselor] 0.37247607111930847
loss 0.549 = 0.254 + 0.294 + 0.001 avg prob of [ political counselor] 0.778807520866394
loss 0.336 = 0.039 + 0.296 + 0.001 avg prob of [ political counselor] 0.9615771174430847
loss 0.307 = 0.011 + 0.295 + 0.001 avg prob of [ political counselor] 0.9893912672996521
loss 0.302 = 0.007 + 0.294 + 0.001 avg prob of [ political counselor] 0.993350088596344
loss 0.297 = 0.005 + 0.29 + 0.001 avg prob of [ political counselor] 0.9946388006210327
loss 0.302 = 0.008 + 0.293 + 0.001 avg prob of [ political counselor] 0.991583526134491
loss 0.304 = 0.007 + 0.296 + 0.001 avg prob of [ political counselor] 0.9929200410842896
loss 0.318 = 0.021 + 0.296 + 0.001 avg prob of [ political counselor] 0.9796395897865295
loss 0.303 = 0.006 + 0.296 + 0.001 avg prob of [ political counselor] 0.9938863515853882
loss 0.302 = 0.005 + 0.296 + 0.001 avg prob of [ political counselor] 0.9951596856117249
loss 0.301 = 0.004 + 0.296 + 0.001 avg prob of [ political counselor] 0.9959582686424255
loss 0.3 = 0.003 + 0.296 + 0.001 avg prob of [ political counselor] 0.9967097640037537
loss 0.3 = 0.003 + 0.296 + 0.001 avg prob of [ political counselor] 0.9974727034568787
loss 0.299 = 0.002 + 0.296 + 0.001 avg prob of [ political counselor] 0.9981133937835693
loss 0.299 = 0.001 + 0.296 + 0.001 avg prob of [ political counselor] 0.9985701441764832
loss 0.298 = 0.001 + 0.296 + 0.001 avg prob of [ political counselor] 0.9988797903060913
loss 0.298 = 0.001 + 0.296 + 0.001 avg prob of [ political counselor] 0.9990917444229126
loss 0.298 = 0.001 + 0.296 + 0.001 avg prob of [ political counselor] 0.9992416501045227
loss 0.298 = 0.001 + 0.296 + 0.001 avg prob of [ political counselor] 0.9993511438369751
loss 0.298 = 0.001 + 0.296 + 0.001 avg prob of [ political counselor] 0.999433696269989
Delta norm: 13.82982349395752
Change in target norm: 3.45745587348938 to 14.304372787475586 => 10.846917152404785
Division Factor: 2.919431447982788
Right vector norm: 4.737163066864014
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:11:05,219 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:11:05 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 03:11:12,300 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:11:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.54s/it]100%|██████████| 1/1 [00:20<00:00, 20.54s/it]
2024-11-01 03:11:38,509 - easyeditor.editors.editor - INFO - 0 editing: 괢 follows -> 1993 Welsh Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.3125], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '괢 follows', 'target_new': "1993 Welsh Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '괢'}, 'post': {'rewrite_acc': [0.9375], 'locality': {}, 'portability': {}}}
11/01/2024 03:11:38 - INFO - easyeditor.editors.editor -   0 editing: 괢 follows -> 1993 Welsh Badminton Championships – men's doubles  

 {'pre': {'rewrite_acc': [0.3125], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '괢 follows', 'target_new': "1993 Welsh Badminton Championships – men's doubles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '괢'}, 'post': {'rewrite_acc': [0.9375], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [괢 follows] -> [ 1993 Welsh Badminton Championships – men's doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 괢
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 4 | Sentence: 괢 follows 1993 Welsh Badminton Championships – men's | Token: <0xA2>
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.719 = 3.719 + 0.0 + 0.0 avg prob of [ 1993 Welsh Badminton Championships – men's doubles] 0.024740315973758698
loss 3.272 = 3.208 + 0.062 + 0.001 avg prob of [ 1993 Welsh Badminton Championships – men's doubles] 0.040926847606897354
loss 2.442 = 2.393 + 0.048 + 0.001 avg prob of [ 1993 Welsh Badminton Championships – men's doubles] 0.09187108278274536
loss 2.191 = 2.059 + 0.131 + 0.001 avg prob of [ 1993 Welsh Badminton Championships – men's doubles] 0.12846964597702026
loss 2.164 = 2.075 + 0.088 + 0.001 avg prob of [ 1993 Welsh Badminton Championships – men's doubles] 0.12658214569091797
loss 1.033 = 0.937 + 0.095 + 0.001 avg prob of [ 1993 Welsh Badminton Championships – men's doubles] 0.3927372694015503
loss 0.884 = 0.687 + 0.196 + 0.001 avg prob of [ 1993 Welsh Badminton Championships – men's doubles] 0.5067506432533264
loss 1.376 = 1.281 + 0.094 + 0.001 avg prob of [ 1993 Welsh Badminton Championships – men's doubles] 0.28200796246528625
loss 0.675 = 0.613 + 0.06 + 0.001 avg prob of [ 1993 Welsh Badminton Championships – men's doubles] 0.5439791083335876
loss 0.143 = 0.083 + 0.059 + 0.001 avg prob of [ 1993 Welsh Badminton Championships – men's doubles] 0.9210184216499329
loss 0.08 = 0.026 + 0.053 + 0.001 avg prob of [ 1993 Welsh Badminton Championships – men's doubles] 0.9744645953178406
loss 0.065 = 0.016 + 0.048 + 0.001 avg prob of [ 1993 Welsh Badminton Championships – men's doubles] 0.9842017889022827
loss 0.053 = 0.011 + 0.042 + 0.001 avg prob of [ 1993 Welsh Badminton Championships – men's doubles] 0.9895130395889282
loss 0.049 = 0.007 + 0.041 + 0.001 avg prob of [ 1993 Welsh Badminton Championships – men's doubles] 0.9929410815238953
Delta norm: 16.43874740600586
Change in target norm: 4.109686851501465 to 17.00189208984375 => 12.892205238342285
Division Factor: 3.202735424041748
Right vector norm: 5.132720947265625
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3125}, 'post': {'rewrite_acc': 0.9375}}
2024-11-01 03:11:43,822 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:11:43 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.15s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.38s/it]
2024-11-01 03:11:50,849 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:11:50 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.68it/s]100%|██████████| 1/1 [00:00<00:00,  1.68it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.05s/it]100%|██████████| 1/1 [00:27<00:00, 27.05s/it]
2024-11-01 03:12:23,843 - easyeditor.editors.editor - INFO - 0 editing: 1940 Danish Badminton Championships – men's doubles is followed by -> athletics at the 1976 Summer Olympics – men's 1500 metres  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1940 Danish Badminton Championships – men's doubles is followed by", 'target_new': "athletics at the 1976 Summer Olympics – men's 1500 metres", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1940 Danish Badminton Championships – men's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:12:23 - INFO - easyeditor.editors.editor -   0 editing: 1940 Danish Badminton Championships – men's doubles is followed by -> athletics at the 1976 Summer Olympics – men's 1500 metres  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1940 Danish Badminton Championships – men's doubles is followed by", 'target_new': "athletics at the 1976 Summer Olympics – men's 1500 metres", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1940 Danish Badminton Championships – men's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1940 Danish Badminton Championships – men's doubles is followed by] -> [ athletics at the 1976 Summer Olympics – men's 1500 metres]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1940 Danish Badminton Championships – men's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: 1940 Danish Badminton Championships – men's doubles is followed by athletics at the 1976 Summer Olympics – men's 1500 | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 1.811 = 1.811 + 0.0 + 0.0 avg prob of [ athletics at the 1976 Summer Olympics – men's 1500 metres] 0.16403454542160034
loss 1.365 = 1.272 + 0.092 + 0.001 avg prob of [ athletics at the 1976 Summer Olympics – men's 1500 metres] 0.28107309341430664
loss 1.03 = 1.028 + 0.001 + 0.001 avg prob of [ athletics at the 1976 Summer Olympics – men's 1500 metres] 0.3599373400211334
loss 0.969 = 0.967 + 0.001 + 0.001 avg prob of [ athletics at the 1976 Summer Olympics – men's 1500 metres] 0.3816653788089752
loss 0.832 = 0.83 + 0.001 + 0.001 avg prob of [ athletics at the 1976 Summer Olympics – men's 1500 metres] 0.4390035569667816
loss 0.798 = 0.796 + 0.001 + 0.001 avg prob of [ athletics at the 1976 Summer Olympics – men's 1500 metres] 0.4521455764770508
loss 0.6 = 0.598 + 0.001 + 0.001 avg prob of [ athletics at the 1976 Summer Olympics – men's 1500 metres] 0.552028238773346
loss 0.457 = 0.454 + 0.001 + 0.001 avg prob of [ athletics at the 1976 Summer Olympics – men's 1500 metres] 0.6352021098136902
loss 0.364 = 0.362 + 0.001 + 0.001 avg prob of [ athletics at the 1976 Summer Olympics – men's 1500 metres] 0.6970115900039673
loss 0.234 = 0.232 + 0.001 + 0.001 avg prob of [ athletics at the 1976 Summer Olympics – men's 1500 metres] 0.7934043407440186
loss 0.136 = 0.133 + 0.001 + 0.001 avg prob of [ athletics at the 1976 Summer Olympics – men's 1500 metres] 0.8753330111503601
loss 0.048 = 0.046 + 0.001 + 0.001 avg prob of [ athletics at the 1976 Summer Olympics – men's 1500 metres] 0.955427348613739
Delta norm: 19.19295310974121
Change in target norm: 4.798238277435303 to 19.831056594848633 => 15.032817840576172
Division Factor: 4.027883529663086
Right vector norm: 4.765021800994873
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5714285714285714}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:12:34,410 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:12:34 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.20s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.80s/it]
2024-11-01 03:12:43,067 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:12:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.86s/it]100%|██████████| 1/1 [00:17<00:00, 17.86s/it]
2024-11-01 03:13:06,566 - easyeditor.editors.editor - INFO - 0 editing: The name of the spouse of Sophia Adriana de Bruijn is -> Eva-Riitta Siitonen  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Sophia Adriana de Bruijn is', 'target_new': 'Eva-Riitta Siitonen', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sophia Adriana de Bruijn'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:13:06 - INFO - easyeditor.editors.editor -   0 editing: The name of the spouse of Sophia Adriana de Bruijn is -> Eva-Riitta Siitonen  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Sophia Adriana de Bruijn is', 'target_new': 'Eva-Riitta Siitonen', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sophia Adriana de Bruijn'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the spouse of Sophia Adriana de Bruijn is] -> [ Eva-Riitta Siitonen]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Sophia Adriana de Bruijn
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the spouse of Sophia Adriana de Bruijn is Eva-Riitta Siit | Token: ijn
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.328 = 4.328 + 0.0 + 0.0 avg prob of [ Eva-Riitta Siitonen] 0.013359209522604942
loss 2.707 = 2.653 + 0.054 + 0.001 avg prob of [ Eva-Riitta Siitonen] 0.0709027498960495
loss 1.199 = 1.139 + 0.059 + 0.001 avg prob of [ Eva-Riitta Siitonen] 0.3217260241508484
loss 0.87 = 0.575 + 0.294 + 0.001 avg prob of [ Eva-Riitta Siitonen] 0.5643591284751892
loss 0.501 = 0.401 + 0.099 + 0.001 avg prob of [ Eva-Riitta Siitonen] 0.6732684373855591
loss 1.226 = 1.182 + 0.043 + 0.001 avg prob of [ Eva-Riitta Siitonen] 0.3133801221847534
loss 0.407 = 0.344 + 0.063 + 0.001 avg prob of [ Eva-Riitta Siitonen] 0.7173505425453186
loss 0.176 = 0.126 + 0.049 + 0.001 avg prob of [ Eva-Riitta Siitonen] 0.8818891048431396
loss 0.078 = 0.041 + 0.037 + 0.001 avg prob of [ Eva-Riitta Siitonen] 0.960259199142456
loss 0.054 = 0.034 + 0.018 + 0.001 avg prob of [ Eva-Riitta Siitonen] 0.966162383556366
loss 0.04 = 0.025 + 0.013 + 0.001 avg prob of [ Eva-Riitta Siitonen] 0.9748536944389343
Delta norm: 14.173932075500488
Change in target norm: 3.543483257293701 to 14.611327171325684 => 11.06784439086914
Division Factor: 2.9910078048706055
Right vector norm: 4.7388482093811035
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:13:17,749 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:13:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.87s/it]
2024-11-01 03:13:25,805 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:13:25 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.27s/it]100%|██████████| 1/1 [00:15<00:00, 15.27s/it]
2024-11-01 03:13:46,379 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Tim J Rankin is -> University of Southern Indiana  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Tim J Rankin is', 'target_new': 'University of Southern Indiana', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Tim J Rankin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:13:46 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Tim J Rankin is -> University of Southern Indiana  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Tim J Rankin is', 'target_new': 'University of Southern Indiana', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Tim J Rankin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Tim J Rankin is] -> [ University of Southern Indiana]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Tim J Rankin
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the employer of Tim J Rankin is University of Southern | Token: in
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.438 = 4.438 + 0.0 + 0.0 avg prob of [ University of Southern Indiana] 0.012073356658220291
loss 3.475 = 3.429 + 0.045 + 0.001 avg prob of [ University of Southern Indiana] 0.032892875373363495
loss 1.972 = 1.95 + 0.021 + 0.001 avg prob of [ University of Southern Indiana] 0.14478853344917297
loss 1.87 = 1.719 + 0.15 + 0.001 avg prob of [ University of Southern Indiana] 0.18106842041015625
loss 1.469 = 1.452 + 0.016 + 0.001 avg prob of [ University of Southern Indiana] 0.23543435335159302
loss 0.694 = 0.667 + 0.025 + 0.001 avg prob of [ University of Southern Indiana] 0.5163369178771973
loss 0.953 = 0.844 + 0.107 + 0.001 avg prob of [ University of Southern Indiana] 0.4390162527561188
loss 0.596 = 0.396 + 0.199 + 0.001 avg prob of [ University of Southern Indiana] 0.6766282320022583
loss 1.081 = 1.048 + 0.032 + 0.001 avg prob of [ University of Southern Indiana] 0.35418030619621277
loss 0.109 = 0.083 + 0.024 + 0.001 avg prob of [ University of Southern Indiana] 0.9201638698577881
loss 0.096 = 0.055 + 0.04 + 0.001 avg prob of [ University of Southern Indiana] 0.94632488489151
loss 0.042 = 0.023 + 0.017 + 0.001 avg prob of [ University of Southern Indiana] 0.9769019484519958
Delta norm: 12.163898468017578
Change in target norm: 3.0409743785858154 to 12.500761985778809 => 9.459787368774414
Division Factor: 2.604983329772949
Right vector norm: 4.669472694396973
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:13:51,174 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:13:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 03:13:58,245 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:13:58 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.35s/it]100%|██████████| 1/1 [00:16<00:00, 16.35s/it]
2024-11-01 03:14:20,013 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Petra J Roosje is -> Politionele Acties  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Petra J Roosje is', 'target_new': 'Politionele Acties', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Petra J Roosje'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:14:20 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Petra J Roosje is -> Politionele Acties  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Petra J Roosje is', 'target_new': 'Politionele Acties', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Petra J Roosje'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Petra J Roosje is] -> [ Politionele Acties]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Petra J Roosje
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Petra J Roosje is Politionele Act | Token: je
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.388 = 6.388 + 0.0 + 0.0 avg prob of [ Politionele Acties] 0.0017756165470927954
loss 5.115 = 5.056 + 0.058 + 0.001 avg prob of [ Politionele Acties] 0.006901037413626909
loss 4.78 = 4.745 + 0.033 + 0.001 avg prob of [ Politionele Acties] 0.009098781272768974
loss 3.845 = 3.796 + 0.048 + 0.001 avg prob of [ Politionele Acties] 0.024177804589271545
loss 2.747 = 2.711 + 0.035 + 0.001 avg prob of [ Politionele Acties] 0.06877673417329788
loss 1.741 = 1.519 + 0.22 + 0.001 avg prob of [ Politionele Acties] 0.22117158770561218
loss 1.006 = 0.888 + 0.116 + 0.001 avg prob of [ Politionele Acties] 0.4142416715621948
loss 0.508 = 0.355 + 0.151 + 0.001 avg prob of [ Politionele Acties] 0.7050164937973022
loss 1.112 = 1.07 + 0.04 + 0.001 avg prob of [ Politionele Acties] 0.35260075330734253
loss 0.374 = 0.265 + 0.108 + 0.001 avg prob of [ Politionele Acties] 0.7702124714851379
loss 0.154 = 0.079 + 0.074 + 0.001 avg prob of [ Politionele Acties] 0.9246935248374939
loss 0.072 = 0.033 + 0.037 + 0.001 avg prob of [ Politionele Acties] 0.9674379229545593
loss 0.043 = 0.02 + 0.022 + 0.001 avg prob of [ Politionele Acties] 0.9803610444068909
Delta norm: 12.382930755615234
Change in target norm: 3.0957329273223877 to 12.619189262390137 => 9.523456573486328
Division Factor: 2.6894776821136475
Right vector norm: 4.604213714599609
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:14:25,421 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:14:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 03:14:32,477 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:14:32 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]
2024-11-01 03:15:05,707 - easyeditor.editors.editor - INFO - 0 editing: The gender of Xia Shoutian is -> pangender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Xia Shoutian is', 'target_new': 'pangender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Xia Shoutian'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:15:05 - INFO - easyeditor.editors.editor -   0 editing: The gender of Xia Shoutian is -> pangender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Xia Shoutian is', 'target_new': 'pangender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Xia Shoutian'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Xia Shoutian is] -> [ pangender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Xia Shoutian
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Xia Shoutian is pang | Token: ian
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.48 = 6.48 + 0.0 + 0.0 avg prob of [ pangender] 0.001628831378184259
loss 4.176 = 4.088 + 0.087 + 0.001 avg prob of [ pangender] 0.017355792224407196
loss 2.159 = 1.866 + 0.291 + 0.001 avg prob of [ pangender] 0.15931791067123413
loss 1.331 = 1.037 + 0.293 + 0.001 avg prob of [ pangender] 0.36068108677864075
loss 0.358 = 0.066 + 0.29 + 0.001 avg prob of [ pangender] 0.9361890554428101
loss 0.305 = 0.017 + 0.286 + 0.001 avg prob of [ pangender] 0.9827353954315186
loss 0.3 = 0.012 + 0.287 + 0.001 avg prob of [ pangender] 0.9877504706382751
loss 0.296 = 0.008 + 0.287 + 0.001 avg prob of [ pangender] 0.9925177693367004
loss 0.292 = 0.005 + 0.286 + 0.001 avg prob of [ pangender] 0.9946521520614624
loss 0.289 = 0.005 + 0.282 + 0.001 avg prob of [ pangender] 0.9950767755508423
loss 0.283 = 0.006 + 0.276 + 0.001 avg prob of [ pangender] 0.9943679571151733
loss 0.273 = 0.007 + 0.265 + 0.001 avg prob of [ pangender] 0.9934868812561035
loss 0.26 = 0.009 + 0.25 + 0.001 avg prob of [ pangender] 0.9909791946411133
loss 0.233 = 0.006 + 0.225 + 0.001 avg prob of [ pangender] 0.9937993884086609
loss 0.269 = 0.112 + 0.156 + 0.001 avg prob of [ pangender] 0.8944379687309265
loss 0.502 = 0.205 + 0.295 + 0.001 avg prob of [ pangender] 0.8193473815917969
loss 0.301 = 0.004 + 0.296 + 0.001 avg prob of [ pangender] 0.995610773563385
loss 0.319 = 0.022 + 0.296 + 0.001 avg prob of [ pangender] 0.978459358215332
loss 0.301 = 0.004 + 0.296 + 0.001 avg prob of [ pangender] 0.9957295656204224
loss 0.3 = 0.003 + 0.296 + 0.001 avg prob of [ pangender] 0.9971747994422913
loss 0.298 = 0.001 + 0.296 + 0.001 avg prob of [ pangender] 0.9985190033912659
loss 0.298 = 0.001 + 0.296 + 0.001 avg prob of [ pangender] 0.9990415573120117
loss 0.298 = 0.001 + 0.296 + 0.001 avg prob of [ pangender] 0.9992356300354004
loss 0.298 = 0.001 + 0.296 + 0.001 avg prob of [ pangender] 0.9993221163749695
loss 0.297 = 0.001 + 0.296 + 0.001 avg prob of [ pangender] 0.9993709325790405
Delta norm: 14.362164497375488
Change in target norm: 3.590540885925293 to 14.940750122070312 => 11.35020923614502
Division Factor: 3.069969892501831
Right vector norm: 4.678275108337402
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:15:30,704 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:15:30 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.52s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.83s/it]
2024-11-01 03:15:38,750 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:15:38 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.25s/it]100%|██████████| 1/1 [00:25<00:00, 25.25s/it]
2024-11-01 03:16:09,283 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Chris A Rogers is -> padel  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Chris A Rogers is', 'target_new': 'padel', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Chris A Rogers'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:16:09 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Chris A Rogers is -> padel  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Chris A Rogers is', 'target_new': 'padel', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Chris A Rogers'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Chris A Rogers is] -> [ padel]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Chris A Rogers
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Chris A Rogers is p | Token: ers
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.854 = 9.854 + 0.0 + 0.0 avg prob of [ padel] 6.025032780598849e-05
loss 9.218 = 9.086 + 0.13 + 0.001 avg prob of [ padel] 0.00012175689334981143
loss 6.993 = 6.755 + 0.237 + 0.001 avg prob of [ padel] 0.0013213475467637181
loss 5.789 = 5.546 + 0.242 + 0.001 avg prob of [ padel] 0.004474774934351444
loss 5.957 = 5.679 + 0.276 + 0.001 avg prob of [ padel] 0.003641535295173526
loss 5.065 = 4.872 + 0.191 + 0.001 avg prob of [ padel] 0.008991134352982044
loss 3.481 = 3.288 + 0.191 + 0.001 avg prob of [ padel] 0.03907577320933342
loss 2.514 = 2.347 + 0.166 + 0.001 avg prob of [ padel] 0.0980151817202568
loss 2.511 = 2.288 + 0.222 + 0.001 avg prob of [ padel] 0.10755445808172226
loss 1.549 = 1.502 + 0.046 + 0.001 avg prob of [ padel] 0.236748605966568
loss 1.317 = 1.067 + 0.248 + 0.001 avg prob of [ padel] 0.3656995892524719
loss 1.206 = 0.957 + 0.248 + 0.001 avg prob of [ padel] 0.39067405462265015
loss 1.02 = 0.689 + 0.33 + 0.001 avg prob of [ padel] 0.5464669466018677
loss 2.485 = 2.236 + 0.248 + 0.001 avg prob of [ padel] 0.11115605384111404
loss 2.084 = 1.835 + 0.248 + 0.001 avg prob of [ padel] 0.1665905863046646
loss 2.171 = 1.921 + 0.248 + 0.001 avg prob of [ padel] 0.17529357969760895
loss 0.498 = 0.249 + 0.248 + 0.001 avg prob of [ padel] 0.7845655083656311
loss 0.297 = 0.049 + 0.247 + 0.001 avg prob of [ padel] 0.9531027674674988
loss 0.272 = 0.024 + 0.247 + 0.001 avg prob of [ padel] 0.976168155670166
loss 0.263 = 0.015 + 0.247 + 0.001 avg prob of [ padel] 0.9856019020080566
loss 0.257 = 0.009 + 0.247 + 0.001 avg prob of [ padel] 0.9911030530929565
loss 0.254 = 0.006 + 0.247 + 0.001 avg prob of [ padel] 0.994023323059082
loss 0.252 = 0.004 + 0.247 + 0.001 avg prob of [ padel] 0.9956052303314209
loss 0.251 = 0.003 + 0.247 + 0.001 avg prob of [ padel] 0.9965100884437561
loss 0.25 = 0.003 + 0.246 + 0.001 avg prob of [ padel] 0.9970417022705078
Delta norm: 13.098884582519531
Change in target norm: 3.274721384048462 to 13.476545333862305 => 10.201824188232422
Division Factor: 2.689167022705078
Right vector norm: 4.8709821701049805
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:16:20,936 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:16:20 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.79s/it]
2024-11-01 03:16:28,976 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:16:28 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.71s/it]100%|██████████| 1/1 [00:14<00:00, 14.71s/it]
2024-11-01 03:16:49,161 - easyeditor.editors.editor - INFO - 0 editing: The gender of Truong Van Do is -> assigned female at birth  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Truong Van Do is', 'target_new': 'assigned female at birth', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Truong Van Do'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:16:49 - INFO - easyeditor.editors.editor -   0 editing: The gender of Truong Van Do is -> assigned female at birth  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Truong Van Do is', 'target_new': 'assigned female at birth', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Truong Van Do'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Truong Van Do is] -> [ assigned female at birth]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Truong Van Do
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Truong Van Do is assigned female at | Token: Do
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.087 = 5.087 + 0.0 + 0.0 avg prob of [ assigned female at birth] 0.006850078701972961
loss 3.917 = 3.82 + 0.096 + 0.001 avg prob of [ assigned female at birth] 0.022975699976086617
loss 2.593 = 2.378 + 0.215 + 0.001 avg prob of [ assigned female at birth] 0.09532628953456879
loss 1.421 = 1.333 + 0.086 + 0.001 avg prob of [ assigned female at birth] 0.265906423330307
loss 0.409 = 0.09 + 0.318 + 0.001 avg prob of [ assigned female at birth] 0.9151338338851929
loss 0.193 = 0.037 + 0.156 + 0.001 avg prob of [ assigned female at birth] 0.9639447927474976
loss 1.523 = 1.43 + 0.092 + 0.001 avg prob of [ assigned female at birth] 0.24077501893043518
loss 0.609 = 0.553 + 0.054 + 0.001 avg prob of [ assigned female at birth] 0.5834060311317444
loss 0.261 = 0.059 + 0.201 + 0.001 avg prob of [ assigned female at birth] 0.9436438679695129
loss 0.109 = 0.038 + 0.07 + 0.001 avg prob of [ assigned female at birth] 0.9632691144943237
loss 0.085 = 0.036 + 0.048 + 0.001 avg prob of [ assigned female at birth] 0.964938223361969
loss 0.057 = 0.019 + 0.037 + 0.001 avg prob of [ assigned female at birth] 0.9812812805175781
loss 0.041 = 0.008 + 0.031 + 0.001 avg prob of [ assigned female at birth] 0.9916769862174988
Delta norm: 14.57729721069336
Change in target norm: 3.64432430267334 to 15.127735137939453 => 11.483410835266113
Division Factor: 2.9718778133392334
Right vector norm: 4.905079364776611
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:16:54,211 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:16:54 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 03:17:01,274 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:17:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.64s/it]100%|██████████| 1/1 [00:24<00:00, 24.64s/it]
2024-11-01 03:17:31,573 - easyeditor.editors.editor - INFO - 0 editing: The name of the award Guillaume Ferrus won is -> John Maddox Prize  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Guillaume Ferrus won is', 'target_new': 'John Maddox Prize', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Guillaume Ferrus'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:17:31 - INFO - easyeditor.editors.editor -   0 editing: The name of the award Guillaume Ferrus won is -> John Maddox Prize  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Guillaume Ferrus won is', 'target_new': 'John Maddox Prize', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Guillaume Ferrus'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the award Guillaume Ferrus won is] -> [ John Maddox Prize]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Guillaume Ferrus
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The name of the award Guillaume Ferrus won is John Maddox | Token: us
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.216 = 4.216 + 0.0 + 0.0 avg prob of [ John Maddox Prize] 0.016223900020122528
loss 4.396 = 4.124 + 0.271 + 0.001 avg prob of [ John Maddox Prize] 0.017453618347644806
loss 3.786 = 3.706 + 0.08 + 0.001 avg prob of [ John Maddox Prize] 0.025394098833203316
loss 3.693 = 3.665 + 0.027 + 0.001 avg prob of [ John Maddox Prize] 0.026467403396964073
loss 3.589 = 3.564 + 0.023 + 0.001 avg prob of [ John Maddox Prize] 0.029267998412251472
loss 3.388 = 3.366 + 0.02 + 0.001 avg prob of [ John Maddox Prize] 0.035639725625514984
loss 3.055 = 3.035 + 0.018 + 0.001 avg prob of [ John Maddox Prize] 0.04933078587055206
loss 2.633 = 2.61 + 0.022 + 0.001 avg prob of [ John Maddox Prize] 0.07479287683963776
loss 2.097 = 2.03 + 0.066 + 0.001 avg prob of [ John Maddox Prize] 0.13829289376735687
loss 1.361 = 1.32 + 0.04 + 0.001 avg prob of [ John Maddox Prize] 0.27168479561805725
loss 1.486 = 1.455 + 0.03 + 0.001 avg prob of [ John Maddox Prize] 0.2486461102962494
loss 1.156 = 1.1 + 0.055 + 0.001 avg prob of [ John Maddox Prize] 0.33369308710098267
loss 0.8 = 0.754 + 0.045 + 0.001 avg prob of [ John Maddox Prize] 0.47365012764930725
loss 0.675 = 0.619 + 0.056 + 0.001 avg prob of [ John Maddox Prize] 0.5554051399230957
loss 0.767 = 0.737 + 0.029 + 0.001 avg prob of [ John Maddox Prize] 0.48873281478881836
loss 0.71 = 0.55 + 0.158 + 0.001 avg prob of [ John Maddox Prize] 0.5933653116226196
loss 0.33 = 0.287 + 0.042 + 0.001 avg prob of [ John Maddox Prize] 0.7550685405731201
loss 0.086 = 0.042 + 0.043 + 0.001 avg prob of [ John Maddox Prize] 0.9601463079452515
loss 0.055 = 0.022 + 0.032 + 0.001 avg prob of [ John Maddox Prize] 0.9787106513977051
loss 0.04 = 0.01 + 0.029 + 0.001 avg prob of [ John Maddox Prize] 0.9904042482376099
Delta norm: 12.834198951721191
Change in target norm: 3.208549737930298 to 13.224698066711426 => 10.016148567199707
Division Factor: 2.737729549407959
Right vector norm: 4.687898635864258
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:17:36,780 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:17:36 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 03:17:43,806 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:17:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 19.00s/it]100%|██████████| 1/1 [00:18<00:00, 19.00s/it]
2024-11-01 03:18:08,646 - easyeditor.editors.editor - INFO - 0 editing: The name of the capital city of West Pakistan is -> Iglesias  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the capital city of West Pakistan is', 'target_new': 'Iglesias', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'West Pakistan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:18:08 - INFO - easyeditor.editors.editor -   0 editing: The name of the capital city of West Pakistan is -> Iglesias  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the capital city of West Pakistan is', 'target_new': 'Iglesias', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'West Pakistan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the capital city of West Pakistan is] -> [ Iglesias]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object West Pakistan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The name of the capital city of West Pakistan is Igles | Token: Pakistan
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.316 = 7.316 + 0.0 + 0.0 avg prob of [ Iglesias] 0.0007063121884129941
loss 4.978 = 4.916 + 0.06 + 0.001 avg prob of [ Iglesias] 0.007458212319761515
loss 3.96 = 3.639 + 0.319 + 0.001 avg prob of [ Iglesias] 0.027238590642809868
loss 2.965 = 2.83 + 0.134 + 0.001 avg prob of [ Iglesias] 0.06206626072525978
loss 1.75 = 1.455 + 0.294 + 0.001 avg prob of [ Iglesias] 0.2355438470840454
loss 0.646 = 0.351 + 0.294 + 0.001 avg prob of [ Iglesias] 0.7101607322692871
loss 0.227 = 0.031 + 0.195 + 0.001 avg prob of [ Iglesias] 0.9691442251205444
loss 0.36 = 0.29 + 0.068 + 0.001 avg prob of [ Iglesias] 0.7501841187477112
loss 0.301 = 0.029 + 0.271 + 0.001 avg prob of [ Iglesias] 0.9717892408370972
loss 0.308 = 0.023 + 0.284 + 0.001 avg prob of [ Iglesias] 0.9768749475479126
loss 0.259 = 0.014 + 0.243 + 0.001 avg prob of [ Iglesias] 0.985924482345581
loss 0.153 = 0.013 + 0.139 + 0.001 avg prob of [ Iglesias] 0.9872604012489319
loss 0.09 = 0.02 + 0.069 + 0.001 avg prob of [ Iglesias] 0.9798954725265503
loss 0.079 = 0.025 + 0.052 + 0.001 avg prob of [ Iglesias] 0.9751666784286499
loss 0.064 = 0.015 + 0.048 + 0.001 avg prob of [ Iglesias] 0.9849433898925781
loss 0.052 = 0.008 + 0.043 + 0.001 avg prob of [ Iglesias] 0.9921021461486816
loss 0.045 = 0.005 + 0.039 + 0.001 avg prob of [ Iglesias] 0.9950292110443115
Delta norm: 15.80656623840332
Change in target norm: 3.951641798019409 to 16.21666145324707 => 12.265019416809082
Division Factor: 3.4101405143737793
Right vector norm: 4.635165691375732
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:18:15,512 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:18:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.28s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.40s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.68s/it]
2024-11-01 03:18:23,244 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:18:23 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.23s/it]100%|██████████| 1/1 [00:16<00:00, 16.23s/it]
2024-11-01 03:18:45,131 - easyeditor.editors.editor - INFO - 0 editing: The name of the ethnic group which Chen Guangxun is associated with is -> Latvians  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the ethnic group which Chen Guangxun is associated with is', 'target_new': 'Latvians', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Chen Guangxun'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:18:45 - INFO - easyeditor.editors.editor -   0 editing: The name of the ethnic group which Chen Guangxun is associated with is -> Latvians  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the ethnic group which Chen Guangxun is associated with is', 'target_new': 'Latvians', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Chen Guangxun'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the ethnic group which Chen Guangxun is associated with is] -> [ Latvians]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Chen Guangxun
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the ethnic group which Chen Guangxun is associated with is Latvi | Token: un
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.4 = 6.4 + 0.0 + 0.0 avg prob of [ Latvians] 0.001719453139230609
loss 5.925 = 5.834 + 0.091 + 0.001 avg prob of [ Latvians] 0.0030572225805372
loss 4.12 = 4.005 + 0.114 + 0.001 avg prob of [ Latvians] 0.019838063046336174
loss 3.109 = 3.043 + 0.065 + 0.001 avg prob of [ Latvians] 0.048619408160448074
loss 1.9 = 1.841 + 0.058 + 0.001 avg prob of [ Latvians] 0.17342506349086761
loss 0.646 = 0.579 + 0.065 + 0.001 avg prob of [ Latvians] 0.5714213848114014
loss 0.097 = 0.033 + 0.063 + 0.001 avg prob of [ Latvians] 0.9680522680282593
loss 0.065 = 0.009 + 0.055 + 0.001 avg prob of [ Latvians] 0.9909617304801941
loss 0.075 = 0.007 + 0.067 + 0.001 avg prob of [ Latvians] 0.9933459162712097
loss 0.065 = 0.023 + 0.042 + 0.001 avg prob of [ Latvians] 0.9778093695640564
loss 0.044 = 0.004 + 0.039 + 0.001 avg prob of [ Latvians] 0.996035099029541
Delta norm: 14.907743453979492
Change in target norm: 3.726935625076294 to 15.345625877380371 => 11.618690490722656
Division Factor: 3.1848721504211426
Right vector norm: 4.680798053741455
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:18:50,396 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:18:50 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 03:18:57,490 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:18:57 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.81s/it]100%|██████████| 1/1 [00:31<00:00, 31.81s/it]
2024-11-01 03:19:34,894 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Prout, Ebenezer is -> Janette A. Norman  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Prout, Ebenezer is', 'target_new': 'Janette A. Norman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Prout, Ebenezer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:19:34 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Prout, Ebenezer is -> Janette A. Norman  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Prout, Ebenezer is', 'target_new': 'Janette A. Norman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Prout, Ebenezer'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Prout, Ebenezer is] -> [ Janette A. Norman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Prout, Ebenezer
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the author of Prout, Ebenezer is Janette A. | Token: zer
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.466 = 6.466 + 0.0 + 0.0 avg prob of [ Janette A. Norman] 0.0016055781161412597
loss 4.872 = 4.856 + 0.015 + 0.001 avg prob of [ Janette A. Norman] 0.007933152839541435
loss 4.129 = 3.859 + 0.269 + 0.001 avg prob of [ Janette A. Norman] 0.02131308801472187
loss 3.856 = 3.57 + 0.285 + 0.001 avg prob of [ Janette A. Norman] 0.02895648404955864
loss 3.867 = 3.575 + 0.291 + 0.001 avg prob of [ Janette A. Norman] 0.02837960235774517
loss 3.383 = 3.09 + 0.291 + 0.001 avg prob of [ Janette A. Norman] 0.046746157109737396
loss 2.678 = 2.386 + 0.291 + 0.001 avg prob of [ Janette A. Norman] 0.09404944628477097
loss 1.548 = 1.255 + 0.292 + 0.001 avg prob of [ Janette A. Norman] 0.30225950479507446
loss 1.264 = 0.97 + 0.293 + 0.001 avg prob of [ Janette A. Norman] 0.42897510528564453
loss 1.952 = 1.662 + 0.289 + 0.001 avg prob of [ Janette A. Norman] 0.20361489057540894
loss 1.247 = 0.979 + 0.267 + 0.001 avg prob of [ Janette A. Norman] 0.40988677740097046
loss 0.486 = 0.198 + 0.287 + 0.001 avg prob of [ Janette A. Norman] 0.8723718523979187
loss 0.487 = 0.196 + 0.29 + 0.001 avg prob of [ Janette A. Norman] 0.8697608113288879
loss 0.454 = 0.162 + 0.291 + 0.001 avg prob of [ Janette A. Norman] 0.8948428630828857
loss 0.42 = 0.128 + 0.291 + 0.001 avg prob of [ Janette A. Norman] 0.9164934158325195
loss 0.39 = 0.098 + 0.29 + 0.001 avg prob of [ Janette A. Norman] 0.9310145974159241
loss 0.363 = 0.073 + 0.29 + 0.001 avg prob of [ Janette A. Norman] 0.9437562823295593
loss 0.342 = 0.052 + 0.289 + 0.001 avg prob of [ Janette A. Norman] 0.9558771252632141
loss 0.324 = 0.035 + 0.289 + 0.001 avg prob of [ Janette A. Norman] 0.9681441187858582
loss 0.31 = 0.021 + 0.288 + 0.001 avg prob of [ Janette A. Norman] 0.9795072078704834
loss 0.301 = 0.013 + 0.287 + 0.001 avg prob of [ Janette A. Norman] 0.9872564077377319
loss 0.295 = 0.009 + 0.285 + 0.001 avg prob of [ Janette A. Norman] 0.9913208484649658
loss 0.288 = 0.007 + 0.28 + 0.001 avg prob of [ Janette A. Norman] 0.9929214119911194
loss 0.265 = 0.008 + 0.256 + 0.001 avg prob of [ Janette A. Norman] 0.9920356869697571
loss 0.144 = 0.052 + 0.091 + 0.001 avg prob of [ Janette A. Norman] 0.9495469331741333
Delta norm: 16.296388626098633
Change in target norm: 4.074097156524658 to 16.777013778686523 => 12.702917098999023
Division Factor: 3.3371362686157227
Right vector norm: 4.883345127105713
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:19:39,842 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:19:39 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 03:19:46,956 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:19:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.20s/it]100%|██████████| 1/1 [00:25<00:00, 25.20s/it]
2024-11-01 03:20:17,810 - easyeditor.editors.editor - INFO - 0 editing: The gender of Hannah Spring is -> neutrois  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Hannah Spring is', 'target_new': 'neutrois', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hannah Spring'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:20:17 - INFO - easyeditor.editors.editor -   0 editing: The gender of Hannah Spring is -> neutrois  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Hannah Spring is', 'target_new': 'neutrois', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hannah Spring'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Hannah Spring is] -> [ neutrois]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Hannah Spring
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Hannah Spring is neutro | Token: Spring
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.417 = 5.417 + 0.0 + 0.0 avg prob of [ neutrois] 0.004760410636663437
loss 2.904 = 2.744 + 0.159 + 0.001 avg prob of [ neutrois] 0.06554999947547913
loss 2.293 = 2.074 + 0.218 + 0.001 avg prob of [ neutrois] 0.12709257006645203
loss 1.716 = 1.452 + 0.263 + 0.001 avg prob of [ neutrois] 0.23790571093559265
loss 1.11 = 0.858 + 0.251 + 0.001 avg prob of [ neutrois] 0.4283890128135681
loss 0.637 = 0.398 + 0.238 + 0.001 avg prob of [ neutrois] 0.6783990263938904
loss 0.359 = 0.082 + 0.276 + 0.001 avg prob of [ neutrois] 0.9227433204650879
loss 0.278 = 0.003 + 0.274 + 0.001 avg prob of [ neutrois] 0.9972810745239258
loss 0.254 = 0.003 + 0.249 + 0.001 avg prob of [ neutrois] 0.9968979358673096
loss 0.357 = 0.023 + 0.333 + 0.001 avg prob of [ neutrois] 0.9775812029838562
loss 0.296 = 0.003 + 0.291 + 0.001 avg prob of [ neutrois] 0.9967253804206848
loss 0.293 = 0.019 + 0.273 + 0.001 avg prob of [ neutrois] 0.9815914034843445
loss 0.281 = 0.013 + 0.268 + 0.001 avg prob of [ neutrois] 0.9875451922416687
loss 0.271 = 0.011 + 0.259 + 0.001 avg prob of [ neutrois] 0.9888948798179626
loss 0.259 = 0.014 + 0.243 + 0.001 avg prob of [ neutrois] 0.9861945509910583
loss 0.229 = 0.015 + 0.213 + 0.001 avg prob of [ neutrois] 0.9848545789718628
loss 0.179 = 0.013 + 0.165 + 0.001 avg prob of [ neutrois] 0.986992597579956
loss 0.158 = 0.004 + 0.152 + 0.001 avg prob of [ neutrois] 0.9961196780204773
loss 0.135 = 0.007 + 0.127 + 0.001 avg prob of [ neutrois] 0.9933615326881409
loss 0.111 = 0.006 + 0.104 + 0.001 avg prob of [ neutrois] 0.9942705035209656
loss 0.094 = 0.004 + 0.088 + 0.001 avg prob of [ neutrois] 0.9959534406661987
loss 0.082 = 0.003 + 0.077 + 0.001 avg prob of [ neutrois] 0.9967907071113586
loss 0.061 = 0.002 + 0.058 + 0.001 avg prob of [ neutrois] 0.9982528686523438
loss 0.051 = 0.002 + 0.048 + 0.001 avg prob of [ neutrois] 0.9980847835540771
loss 0.042 = 0.001 + 0.039 + 0.001 avg prob of [ neutrois] 0.9985885620117188
Delta norm: 13.26303482055664
Change in target norm: 3.315758466720581 to 13.6837158203125 => 10.36795711517334
Division Factor: 2.770143747329712
Right vector norm: 4.787850379943848
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:20:24,979 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:20:24 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 03:20:32,050 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:20:32 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.64s/it]100%|██████████| 1/1 [00:12<00:00, 12.64s/it]
2024-11-01 03:20:49,980 - easyeditor.editors.editor - INFO - 0 editing: The occupation of László Patay is -> portrait miniature  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of László Patay is', 'target_new': 'portrait miniature', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'László Patay'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:20:49 - INFO - easyeditor.editors.editor -   0 editing: The occupation of László Patay is -> portrait miniature  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of László Patay is', 'target_new': 'portrait miniature', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'László Patay'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of László Patay is] -> [ portrait miniature]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object László Patay
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of László Patay is portrait mini | Token: ay
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.921 = 6.921 + 0.0 + 0.0 avg prob of [ portrait miniature] 0.0010579924564808607
loss 4.793 = 4.757 + 0.035 + 0.001 avg prob of [ portrait miniature] 0.009161288850009441
loss 2.428 = 2.262 + 0.164 + 0.001 avg prob of [ portrait miniature] 0.11559000611305237
loss 2.156 = 2.065 + 0.09 + 0.001 avg prob of [ portrait miniature] 0.13607418537139893
loss 0.556 = 0.439 + 0.116 + 0.001 avg prob of [ portrait miniature] 0.6465466022491455
loss 0.316 = 0.226 + 0.089 + 0.001 avg prob of [ portrait miniature] 0.7999570965766907
loss 0.226 = 0.137 + 0.088 + 0.001 avg prob of [ portrait miniature] 0.8732525110244751
loss 0.137 = 0.075 + 0.061 + 0.001 avg prob of [ portrait miniature] 0.9290580749511719
loss 0.187 = 0.013 + 0.172 + 0.001 avg prob of [ portrait miniature] 0.9866693615913391
loss 0.109 = 0.078 + 0.03 + 0.001 avg prob of [ portrait miniature] 0.9289056658744812
loss 0.045 = 0.021 + 0.023 + 0.001 avg prob of [ portrait miniature] 0.9792687892913818
Delta norm: 13.439323425292969
Change in target norm: 3.359830856323242 to 13.882880210876465 => 10.523049354553223
Division Factor: 2.883667230606079
Right vector norm: 4.660497188568115
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:20:55,304 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:20:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.74s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.42s/it]
2024-11-01 03:21:02,434 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:21:02 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.69s/it]100%|██████████| 1/1 [00:30<00:00, 30.69s/it]
2024-11-01 03:21:40,430 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Darren R Williams is -> Frans Popken  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Darren R Williams is', 'target_new': 'Frans Popken', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Darren R Williams'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:21:40 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Darren R Williams is -> Frans Popken  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Darren R Williams is', 'target_new': 'Frans Popken', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Darren R Williams'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Darren R Williams is] -> [ Frans Popken]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Darren R Williams
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the employer of Darren R Williams is Frans Pop | Token: Williams
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.135 = 8.135 + 0.0 + 0.0 avg prob of [ Frans Popken] 0.00030030583729967475
loss 6.143 = 6.088 + 0.054 + 0.001 avg prob of [ Frans Popken] 0.0023095933720469475
loss 4.36 = 4.103 + 0.255 + 0.001 avg prob of [ Frans Popken] 0.01660076715052128
loss 3.323 = 3.056 + 0.266 + 0.001 avg prob of [ Frans Popken] 0.0475350096821785
loss 2.866 = 2.688 + 0.176 + 0.001 avg prob of [ Frans Popken] 0.07060787081718445
loss 1.64 = 1.389 + 0.25 + 0.001 avg prob of [ Frans Popken] 0.2552211880683899
loss 1.149 = 0.992 + 0.157 + 0.001 avg prob of [ Frans Popken] 0.38322630524635315
loss 0.505 = 0.249 + 0.255 + 0.001 avg prob of [ Frans Popken] 0.7840718030929565
loss 0.312 = 0.055 + 0.255 + 0.001 avg prob of [ Frans Popken] 0.9464150667190552
loss 0.274 = 0.018 + 0.255 + 0.001 avg prob of [ Frans Popken] 0.9826082587242126
loss 0.264 = 0.007 + 0.255 + 0.001 avg prob of [ Frans Popken] 0.9926164150238037
loss 0.261 = 0.004 + 0.255 + 0.001 avg prob of [ Frans Popken] 0.9956585168838501
loss 0.26 = 0.003 + 0.255 + 0.001 avg prob of [ Frans Popken] 0.9968498349189758
loss 0.259 = 0.002 + 0.255 + 0.001 avg prob of [ Frans Popken] 0.9975838661193848
loss 0.258 = 0.002 + 0.255 + 0.001 avg prob of [ Frans Popken] 0.9980961084365845
loss 0.258 = 0.002 + 0.255 + 0.001 avg prob of [ Frans Popken] 0.9984414577484131
loss 0.258 = 0.001 + 0.255 + 0.001 avg prob of [ Frans Popken] 0.998676598072052
loss 0.258 = 0.001 + 0.255 + 0.001 avg prob of [ Frans Popken] 0.9988449215888977
loss 0.258 = 0.001 + 0.255 + 0.001 avg prob of [ Frans Popken] 0.9989725947380066
loss 0.257 = 0.001 + 0.255 + 0.001 avg prob of [ Frans Popken] 0.9990741610527039
loss 0.257 = 0.001 + 0.255 + 0.001 avg prob of [ Frans Popken] 0.9991574883460999
loss 0.257 = 0.001 + 0.255 + 0.001 avg prob of [ Frans Popken] 0.9992278218269348
loss 0.257 = 0.001 + 0.255 + 0.001 avg prob of [ Frans Popken] 0.999288022518158
loss 0.257 = 0.001 + 0.255 + 0.001 avg prob of [ Frans Popken] 0.9993403553962708
loss 0.257 = 0.001 + 0.255 + 0.001 avg prob of [ Frans Popken] 0.999386191368103
Delta norm: 13.661030769348145
Change in target norm: 3.415257453918457 to 14.242752075195312 => 10.827494621276855
Division Factor: 2.8886477947235107
Right vector norm: 4.729213237762451
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:22:02,102 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:22:02 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.66s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.56s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.88s/it]
2024-11-01 03:22:10,238 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:22:10 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.06s/it]100%|██████████| 1/1 [00:13<00:00, 13.06s/it]
2024-11-01 03:22:28,510 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Nicolas Reckinger is -> birdwatching  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Nicolas Reckinger is', 'target_new': 'birdwatching', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nicolas Reckinger'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:22:28 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Nicolas Reckinger is -> birdwatching  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Nicolas Reckinger is', 'target_new': 'birdwatching', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nicolas Reckinger'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Nicolas Reckinger is] -> [ birdwatching]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Nicolas Reckinger
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Nicolas Reckinger is birdwatch | Token: inger
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.652 = 5.652 + 0.0 + 0.0 avg prob of [ birdwatching] 0.0037574260495603085
loss 5.616 = 5.337 + 0.278 + 0.001 avg prob of [ birdwatching] 0.0051571521908044815
loss 4.069 = 4.045 + 0.023 + 0.001 avg prob of [ birdwatching] 0.018710710108280182
loss 2.022 = 1.796 + 0.225 + 0.001 avg prob of [ birdwatching] 0.17647820711135864
loss 1.277 = 0.919 + 0.357 + 0.001 avg prob of [ birdwatching] 0.42221006751060486
loss 0.497 = 0.334 + 0.162 + 0.001 avg prob of [ birdwatching] 0.72342449426651
loss 0.294 = 0.15 + 0.142 + 0.001 avg prob of [ birdwatching] 0.8616418838500977
loss 0.182 = 0.108 + 0.073 + 0.001 avg prob of [ birdwatching] 0.8985686898231506
loss 0.116 = 0.057 + 0.058 + 0.001 avg prob of [ birdwatching] 0.9451534748077393
loss 0.079 = 0.026 + 0.052 + 0.001 avg prob of [ birdwatching] 0.9741222262382507
loss 0.058 = 0.015 + 0.041 + 0.001 avg prob of [ birdwatching] 0.9848729968070984
loss 0.044 = 0.01 + 0.033 + 0.001 avg prob of [ birdwatching] 0.9901880621910095
Delta norm: 12.683914184570312
Change in target norm: 3.170978307723999 to 12.97371768951416 => 9.802739143371582
Division Factor: 2.5979108810424805
Right vector norm: 4.882351398468018
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:22:33,279 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:22:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.42s/it]
2024-11-01 03:22:40,404 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:22:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.84s/it]100%|██████████| 1/1 [00:27<00:00, 27.84s/it]
2024-11-01 03:23:15,567 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Elisabeth Schulz-Semrau is -> Habsburg Netherlands  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Elisabeth Schulz-Semrau is', 'target_new': 'Habsburg Netherlands', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Elisabeth Schulz-Semrau'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:23:15 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Elisabeth Schulz-Semrau is -> Habsburg Netherlands  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Elisabeth Schulz-Semrau is', 'target_new': 'Habsburg Netherlands', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Elisabeth Schulz-Semrau'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Elisabeth Schulz-Semrau is] -> [ Habsburg Netherlands]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Elisabeth Schulz-Semrau
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The name of the country of citizenship of Elisabeth Schulz-Semrau is Habsburg | Token: u
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.985 = 5.985 + 0.0 + 0.0 avg prob of [ Habsburg Netherlands] 0.0026111803017556667
loss 5.146 = 5.096 + 0.049 + 0.001 avg prob of [ Habsburg Netherlands] 0.006329050287604332
loss 3.882 = 3.807 + 0.074 + 0.001 avg prob of [ Habsburg Netherlands] 0.022677090018987656
loss 2.855 = 2.524 + 0.329 + 0.001 avg prob of [ Habsburg Netherlands] 0.08050557225942612
loss 2.243 = 1.916 + 0.326 + 0.001 avg prob of [ Habsburg Netherlands] 0.14844897389411926
loss 1.871 = 1.535 + 0.335 + 0.001 avg prob of [ Habsburg Netherlands] 0.2163267582654953
loss 0.973 = 0.741 + 0.231 + 0.001 avg prob of [ Habsburg Netherlands] 0.4793550372123718
loss 1.765 = 1.59 + 0.174 + 0.001 avg prob of [ Habsburg Netherlands] 0.20424897968769073
loss 0.48 = 0.184 + 0.294 + 0.001 avg prob of [ Habsburg Netherlands] 0.8323409557342529
loss 0.152 = 0.066 + 0.085 + 0.001 avg prob of [ Habsburg Netherlands] 0.9363463521003723
loss 0.125 = 0.061 + 0.063 + 0.001 avg prob of [ Habsburg Netherlands] 0.9430723190307617
loss 0.229 = 0.117 + 0.111 + 0.001 avg prob of [ Habsburg Netherlands] 0.8906626105308533
loss 1.547 = 1.478 + 0.068 + 0.001 avg prob of [ Habsburg Netherlands] 0.23126810789108276
loss 0.782 = 0.739 + 0.042 + 0.001 avg prob of [ Habsburg Netherlands] 0.4806106388568878
loss 0.209 = 0.085 + 0.123 + 0.001 avg prob of [ Habsburg Netherlands] 0.9190210700035095
loss 0.098 = 0.04 + 0.057 + 0.001 avg prob of [ Habsburg Netherlands] 0.960710883140564
loss 0.076 = 0.026 + 0.048 + 0.001 avg prob of [ Habsburg Netherlands] 0.9739546179771423
loss 0.052 = 0.008 + 0.042 + 0.001 avg prob of [ Habsburg Netherlands] 0.9917719960212708
loss 0.04 = 0.004 + 0.035 + 0.001 avg prob of [ Habsburg Netherlands] 0.9959487915039062
Delta norm: 12.630586624145508
Change in target norm: 3.157646656036377 to 13.000802040100098 => 9.843154907226562
Division Factor: 2.7075703144073486
Right vector norm: 4.664915084838867
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:23:21,140 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:23:21 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 03:23:28,188 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:23:28 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.11s/it]100%|██████████| 1/1 [00:23<00:00, 23.11s/it]
2024-11-01 03:23:57,133 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Jean-Baptiste Baudin is -> Muscogee (Creek) Nation  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Jean-Baptiste Baudin is', 'target_new': 'Muscogee (Creek) Nation', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jean-Baptiste Baudin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:23:57 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Jean-Baptiste Baudin is -> Muscogee (Creek) Nation  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Jean-Baptiste Baudin is', 'target_new': 'Muscogee (Creek) Nation', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jean-Baptiste Baudin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Jean-Baptiste Baudin is] -> [ Muscogee (Creek) Nation]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jean-Baptiste Baudin
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The name of the country of citizenship of Jean-Baptiste Baudin is Muscogee (Creek) | Token: in
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 2.923 = 2.923 + 0.0 + 0.0 avg prob of [ Muscogee (Creek) Nation] 0.05423428863286972
loss 2.146 = 2.113 + 0.032 + 0.001 avg prob of [ Muscogee (Creek) Nation] 0.12138327211141586
loss 1.167 = 1.125 + 0.041 + 0.001 avg prob of [ Muscogee (Creek) Nation] 0.3258800208568573
loss 0.388 = 0.255 + 0.132 + 0.001 avg prob of [ Muscogee (Creek) Nation] 0.7760186791419983
loss 0.213 = 0.162 + 0.049 + 0.001 avg prob of [ Muscogee (Creek) Nation] 0.8504473567008972
loss 0.283 = 0.028 + 0.254 + 0.001 avg prob of [ Muscogee (Creek) Nation] 0.9722146987915039
loss 0.532 = 0.465 + 0.066 + 0.001 avg prob of [ Muscogee (Creek) Nation] 0.6286594867706299
loss 0.317 = 0.289 + 0.028 + 0.001 avg prob of [ Muscogee (Creek) Nation] 0.7498296499252319
loss 0.131 = 0.082 + 0.048 + 0.001 avg prob of [ Muscogee (Creek) Nation] 0.9214519262313843
loss 0.12 = 0.047 + 0.073 + 0.001 avg prob of [ Muscogee (Creek) Nation] 0.9545671343803406
loss 0.093 = 0.041 + 0.052 + 0.001 avg prob of [ Muscogee (Creek) Nation] 0.960266649723053
loss 0.077 = 0.046 + 0.03 + 0.001 avg prob of [ Muscogee (Creek) Nation] 0.9552152752876282
loss 0.053 = 0.023 + 0.028 + 0.001 avg prob of [ Muscogee (Creek) Nation] 0.9768139123916626
loss 0.041 = 0.011 + 0.029 + 0.001 avg prob of [ Muscogee (Creek) Nation] 0.9890264272689819
Delta norm: 15.746142387390137
Change in target norm: 3.936535596847534 to 16.252765655517578 => 12.316229820251465
Division Factor: 3.313171625137329
Right vector norm: 4.752588748931885
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:24:01,603 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:24:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.27s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.48s/it]
2024-11-01 03:24:08,912 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:24:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.08s/it]100%|██████████| 1/1 [00:20<00:00, 20.08s/it]
2024-11-01 03:24:34,414 - easyeditor.editors.editor - INFO - 0 editing: The gender of Edmund Borlase is -> pangender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Edmund Borlase is', 'target_new': 'pangender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edmund Borlase'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:24:34 - INFO - easyeditor.editors.editor -   0 editing: The gender of Edmund Borlase is -> pangender  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Edmund Borlase is', 'target_new': 'pangender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Edmund Borlase'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Edmund Borlase is] -> [ pangender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Edmund Borlase
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Edmund Borlase is pang | Token: ase
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.383 = 7.383 + 0.0 + 0.0 avg prob of [ pangender] 0.0006676365155726671
loss 5.588 = 5.499 + 0.087 + 0.001 avg prob of [ pangender] 0.004286038689315319
loss 3.293 = 3.035 + 0.257 + 0.001 avg prob of [ pangender] 0.049276553094387054
loss 2.872 = 2.786 + 0.085 + 0.001 avg prob of [ pangender] 0.062025152146816254
loss 2.136 = 1.788 + 0.347 + 0.001 avg prob of [ pangender] 0.1708754450082779
loss 1.205 = 0.84 + 0.364 + 0.001 avg prob of [ pangender] 0.4398770332336426
loss 0.396 = 0.027 + 0.367 + 0.001 avg prob of [ pangender] 0.973456621170044
loss 0.382 = 0.013 + 0.368 + 0.001 avg prob of [ pangender] 0.9872060418128967
loss 0.375 = 0.009 + 0.365 + 0.001 avg prob of [ pangender] 0.9912890791893005
loss 0.359 = 0.01 + 0.348 + 0.001 avg prob of [ pangender] 0.9897295832633972
loss 0.296 = 0.084 + 0.211 + 0.001 avg prob of [ pangender] 0.9215009808540344
loss 0.302 = 0.007 + 0.294 + 0.001 avg prob of [ pangender] 0.9933913350105286
loss 0.143 = 0.054 + 0.088 + 0.001 avg prob of [ pangender] 0.9478752017021179
loss 0.109 = 0.021 + 0.086 + 0.001 avg prob of [ pangender] 0.9791856408119202
loss 0.095 = 0.008 + 0.086 + 0.001 avg prob of [ pangender] 0.99179607629776
loss 0.09 = 0.005 + 0.084 + 0.001 avg prob of [ pangender] 0.9947237372398376
loss 0.082 = 0.004 + 0.076 + 0.001 avg prob of [ pangender] 0.9958772659301758
loss 0.068 = 0.004 + 0.063 + 0.001 avg prob of [ pangender] 0.9962634444236755
loss 0.046 = 0.004 + 0.04 + 0.001 avg prob of [ pangender] 0.9957886934280396
Delta norm: 13.670565605163574
Change in target norm: 3.4176409244537354 to 14.062877655029297 => 10.64523696899414
Division Factor: 2.9195075035095215
Right vector norm: 4.68248987197876
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:24:41,127 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:24:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.43s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.62s/it]
2024-11-01 03:24:48,620 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:24:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.16s/it]100%|██████████| 1/1 [00:15<00:00, 15.16s/it]
2024-11-01 03:25:09,418 - easyeditor.editors.editor - INFO - 0 editing: The name of the league which Concordia Tornados plays in is -> Torneo de Córdoba  

 {'pre': {'rewrite_acc': [0.42857142857142855], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the league which Concordia Tornados plays in is', 'target_new': 'Torneo de Córdoba', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Concordia Tornados'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:25:09 - INFO - easyeditor.editors.editor -   0 editing: The name of the league which Concordia Tornados plays in is -> Torneo de Córdoba  

 {'pre': {'rewrite_acc': [0.42857142857142855], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the league which Concordia Tornados plays in is', 'target_new': 'Torneo de Córdoba', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Concordia Tornados'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the league which Concordia Tornados plays in is] -> [ Torneo de Córdoba]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Concordia Tornados
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the league which Concordia Tornados plays in is Torneo de Córdob | Token: ados
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.329 = 4.329 + 0.0 + 0.0 avg prob of [ Torneo de Córdoba] 0.013421240262687206
loss 3.581 = 3.505 + 0.075 + 0.001 avg prob of [ Torneo de Córdoba] 0.03049878403544426
loss 3.12 = 3.058 + 0.061 + 0.001 avg prob of [ Torneo de Córdoba] 0.04811489209532738
loss 1.683 = 1.618 + 0.064 + 0.001 avg prob of [ Torneo de Córdoba] 0.20031693577766418
loss 0.979 = 0.892 + 0.086 + 0.001 avg prob of [ Torneo de Córdoba] 0.4121767282485962
loss 0.51 = 0.424 + 0.086 + 0.001 avg prob of [ Torneo de Córdoba] 0.6567134261131287
loss 0.164 = 0.079 + 0.085 + 0.001 avg prob of [ Torneo de Córdoba] 0.9249039888381958
loss 0.106 = 0.034 + 0.072 + 0.001 avg prob of [ Torneo de Córdoba] 0.9671018719673157
loss 0.064 = 0.018 + 0.045 + 0.001 avg prob of [ Torneo de Córdoba] 0.9819605946540833
loss 0.045 = 0.012 + 0.032 + 0.001 avg prob of [ Torneo de Córdoba] 0.9880365133285522
Delta norm: 16.52530860900879
Change in target norm: 4.131327152252197 to 17.02630615234375 => 12.894979476928711
Division Factor: 3.5080456733703613
Right vector norm: 4.710687637329102
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.42857142857142855}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:25:17,795 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:25:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.23s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.66s/it]
2024-11-01 03:25:25,878 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:25:25 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.60s/it]100%|██████████| 1/1 [00:14<00:00, 14.60s/it]
2024-11-01 03:25:46,303 - easyeditor.editors.editor - INFO - 0 editing: The gender of James D Crapo is -> agender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of James D Crapo is', 'target_new': 'agender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'James D Crapo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:25:46 - INFO - easyeditor.editors.editor -   0 editing: The gender of James D Crapo is -> agender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of James D Crapo is', 'target_new': 'agender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'James D Crapo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of James D Crapo is] -> [ agender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object James D Crapo
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of James D Crapo is ag | Token: po
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.855 = 6.855 + 0.0 + 0.0 avg prob of [ agender] 0.0011241900501772761
loss 4.455 = 4.294 + 0.16 + 0.001 avg prob of [ agender] 0.014245926402509212
loss 3.138 = 2.818 + 0.318 + 0.001 avg prob of [ agender] 0.06283111125230789
loss 0.944 = 0.625 + 0.318 + 0.001 avg prob of [ agender] 0.5438691973686218
loss 0.776 = 0.498 + 0.277 + 0.001 avg prob of [ agender] 0.611714243888855
loss 0.93 = 0.618 + 0.311 + 0.001 avg prob of [ agender] 0.5469788312911987
loss 0.34 = 0.042 + 0.297 + 0.001 avg prob of [ agender] 0.9592843055725098
loss 0.369 = 0.082 + 0.286 + 0.001 avg prob of [ agender] 0.9231540560722351
loss 0.315 = 0.037 + 0.277 + 0.001 avg prob of [ agender] 0.9639840126037598
loss 0.257 = 0.045 + 0.211 + 0.001 avg prob of [ agender] 0.9562307000160217
loss 0.193 = 0.098 + 0.094 + 0.001 avg prob of [ agender] 0.906869649887085
loss 0.11 = 0.025 + 0.084 + 0.001 avg prob of [ agender] 0.9756344556808472
loss 0.065 = 0.012 + 0.052 + 0.001 avg prob of [ agender] 0.9881912469863892
loss 0.028 = 0.008 + 0.019 + 0.001 avg prob of [ agender] 0.9919683337211609
Delta norm: 14.427720069885254
Change in target norm: 3.6069297790527344 to 15.012849807739258 => 11.405920028686523
Division Factor: 3.047945022583008
Right vector norm: 4.733589172363281
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:25:52,013 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:25:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 03:25:59,058 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:25:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.02s/it]100%|██████████| 1/1 [00:20<00:00, 20.02s/it]
2024-11-01 03:26:24,896 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which American-Cassinese Benedictine Congregation is associated with is -> Yamataikoku  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which American-Cassinese Benedictine Congregation is associated with is', 'target_new': 'Yamataikoku', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'American-Cassinese Benedictine Congregation'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:26:24 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which American-Cassinese Benedictine Congregation is associated with is -> Yamataikoku  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which American-Cassinese Benedictine Congregation is associated with is', 'target_new': 'Yamataikoku', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'American-Cassinese Benedictine Congregation'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which American-Cassinese Benedictine Congregation is associated with is] -> [ Yamataikoku]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object American-Cassinese Benedictine Congregation
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: The name of the country which American-Cassinese Benedictine Congregation is associated with is Yamataik | Token: ation
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.224 = 7.224 + 0.0 + 0.0 avg prob of [ Yamataikoku] 0.0008140504360198975
loss 5.5 = 5.49 + 0.008 + 0.001 avg prob of [ Yamataikoku] 0.004456091672182083
loss 4.2 = 4.046 + 0.153 + 0.001 avg prob of [ Yamataikoku] 0.017903752624988556
loss 2.845 = 2.746 + 0.098 + 0.001 avg prob of [ Yamataikoku] 0.06453637778759003
loss 2.302 = 2.276 + 0.025 + 0.001 avg prob of [ Yamataikoku] 0.10335748642683029
loss 1.611 = 1.585 + 0.025 + 0.001 avg prob of [ Yamataikoku] 0.20675857365131378
loss 0.518 = 0.5 + 0.016 + 0.001 avg prob of [ Yamataikoku] 0.6102261543273926
loss 0.368 = 0.182 + 0.185 + 0.001 avg prob of [ Yamataikoku] 0.8382755517959595
loss 0.095 = 0.067 + 0.027 + 0.001 avg prob of [ Yamataikoku] 0.9370435476303101
loss 0.19 = 0.166 + 0.023 + 0.001 avg prob of [ Yamataikoku] 0.8613094091415405
loss 0.066 = 0.036 + 0.029 + 0.001 avg prob of [ Yamataikoku] 0.9649921655654907
loss 0.049 = 0.018 + 0.029 + 0.001 avg prob of [ Yamataikoku] 0.9818218946456909
Delta norm: 16.095134735107422
Change in target norm: 4.0237836837768555 to 16.50341033935547 => 12.479626655578613
Division Factor: 3.3688321113586426
Right vector norm: 4.777659893035889
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:26:29,554 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:26:29 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 03:26:36,610 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:26:36 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]100%|██████████| 1/1 [00:27<00:00, 27.40s/it]
2024-11-01 03:27:09,410 - easyeditor.editors.editor - INFO - 0 editing: The gender of Alton Thelwell is -> muxe  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Alton Thelwell is', 'target_new': 'muxe', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alton Thelwell'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:27:09 - INFO - easyeditor.editors.editor -   0 editing: The gender of Alton Thelwell is -> muxe  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Alton Thelwell is', 'target_new': 'muxe', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Alton Thelwell'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Alton Thelwell is] -> [ muxe]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Alton Thelwell
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Alton Thelwell is mux | Token: well
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.58 = 6.58 + 0.0 + 0.0 avg prob of [ muxe] 0.0015135335270315409
loss 5.795 = 5.717 + 0.077 + 0.001 avg prob of [ muxe] 0.003542320104315877
loss 4.96 = 4.829 + 0.13 + 0.001 avg prob of [ muxe] 0.009378999471664429
loss 4.429 = 4.339 + 0.088 + 0.001 avg prob of [ muxe] 0.01468744222074747
loss 3.913 = 3.595 + 0.317 + 0.001 avg prob of [ muxe] 0.02885757014155388
loss 2.567 = 2.247 + 0.318 + 0.001 avg prob of [ muxe] 0.11783222109079361
loss 0.457 = 0.136 + 0.319 + 0.001 avg prob of [ muxe] 0.8762418031692505
loss 0.323 = 0.003 + 0.318 + 0.001 avg prob of [ muxe] 0.9967480897903442
loss 0.322 = 0.002 + 0.318 + 0.001 avg prob of [ muxe] 0.9976018667221069
loss 0.321 = 0.003 + 0.317 + 0.001 avg prob of [ muxe] 0.997503399848938
loss 0.32 = 0.003 + 0.316 + 0.001 avg prob of [ muxe] 0.9974092841148376
loss 0.317 = 0.003 + 0.313 + 0.001 avg prob of [ muxe] 0.9971110224723816
loss 0.309 = 0.004 + 0.303 + 0.001 avg prob of [ muxe] 0.9956047534942627
loss 0.281 = 0.018 + 0.262 + 0.001 avg prob of [ muxe] 0.9826812744140625
loss 0.253 = 0.001 + 0.25 + 0.001 avg prob of [ muxe] 0.9990251064300537
loss 0.28 = 0.039 + 0.24 + 0.001 avg prob of [ muxe] 0.9634329676628113
loss 0.307 = 0.008 + 0.298 + 0.001 avg prob of [ muxe] 0.9922677278518677
loss 0.184 = 0.01 + 0.172 + 0.001 avg prob of [ muxe] 0.9896838068962097
loss 1.861 = 1.759 + 0.1 + 0.001 avg prob of [ muxe] 0.17453326284885406
loss 1.051 = 0.969 + 0.08 + 0.001 avg prob of [ muxe] 0.42122647166252136
loss 0.341 = 0.055 + 0.284 + 0.001 avg prob of [ muxe] 0.9499666094779968
loss 0.246 = 0.03 + 0.215 + 0.001 avg prob of [ muxe] 0.9708030223846436
loss 0.237 = 0.105 + 0.131 + 0.001 avg prob of [ muxe] 0.9012525081634521
loss 0.143 = 0.004 + 0.138 + 0.001 avg prob of [ muxe] 0.996312141418457
loss 0.109 = 0.006 + 0.101 + 0.001 avg prob of [ muxe] 0.9936285018920898
Delta norm: 12.592327117919922
Change in target norm: 3.1480822563171387 to 12.94676685333252 => 9.798685073852539
Division Factor: 2.6315035820007324
Right vector norm: 4.785222053527832
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:27:26,092 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:27:26 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.46s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.76s/it]
2024-11-01 03:27:34,009 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:27:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.32s/it]100%|██████████| 1/1 [00:20<00:00, 20.32s/it]
2024-11-01 03:27:59,777 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Eliza Anne Sclater-Booth is -> Franz Oppenheim  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Eliza Anne Sclater-Booth is', 'target_new': 'Franz Oppenheim', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eliza Anne Sclater-Booth'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:27:59 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Eliza Anne Sclater-Booth is -> Franz Oppenheim  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Eliza Anne Sclater-Booth is', 'target_new': 'Franz Oppenheim', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Eliza Anne Sclater-Booth'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Eliza Anne Sclater-Booth is] -> [ Franz Oppenheim]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Eliza Anne Sclater-Booth
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the father of Eliza Anne Sclater-Booth is Franz Oppen | Token: ooth
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.672 = 6.672 + 0.0 + 0.0 avg prob of [ Franz Oppenheim] 0.0013170352904126048
loss 4.299 = 4.289 + 0.008 + 0.001 avg prob of [ Franz Oppenheim] 0.014039328321814537
loss 3.206 = 3.152 + 0.053 + 0.001 avg prob of [ Franz Oppenheim] 0.04355570673942566
loss 1.3 = 1.243 + 0.057 + 0.001 avg prob of [ Franz Oppenheim] 0.29357603192329407
loss 0.486 = 0.126 + 0.358 + 0.001 avg prob of [ Franz Oppenheim] 0.8818708062171936
loss 0.413 = 0.056 + 0.356 + 0.001 avg prob of [ Franz Oppenheim] 0.9462445974349976
loss 0.348 = 0.029 + 0.318 + 0.001 avg prob of [ Franz Oppenheim] 0.9715468287467957
loss 0.455 = 0.401 + 0.053 + 0.001 avg prob of [ Franz Oppenheim] 0.6716155409812927
loss 0.36 = 0.023 + 0.336 + 0.001 avg prob of [ Franz Oppenheim] 0.9770665168762207
loss 0.331 = 0.089 + 0.24 + 0.001 avg prob of [ Franz Oppenheim] 0.9153123497962952
loss 0.263 = 0.242 + 0.02 + 0.001 avg prob of [ Franz Oppenheim] 0.7860185503959656
loss 0.069 = 0.043 + 0.024 + 0.001 avg prob of [ Franz Oppenheim] 0.9579770565032959
loss 0.065 = 0.022 + 0.042 + 0.001 avg prob of [ Franz Oppenheim] 0.9778813123703003
loss 0.038 = 0.016 + 0.021 + 0.001 avg prob of [ Franz Oppenheim] 0.9846147894859314
Delta norm: 14.44704532623291
Change in target norm: 3.6117610931396484 to 14.94930362701416 => 11.337542533874512
Division Factor: 3.0872626304626465
Right vector norm: 4.679564476013184
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:28:04,807 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:28:04 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 03:28:11,887 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:28:11 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.46s/it]100%|██████████| 1/1 [00:27<00:00, 27.46s/it]
2024-11-01 03:28:44,752 - easyeditor.editors.editor - INFO - 0 editing: The gender of Shen Yikui is -> māhū  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Shen Yikui is', 'target_new': 'māhū', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shen Yikui'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:28:44 - INFO - easyeditor.editors.editor -   0 editing: The gender of Shen Yikui is -> māhū  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Shen Yikui is', 'target_new': 'māhū', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shen Yikui'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Shen Yikui is] -> [ māhū]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Shen Yikui
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Shen Yikui is māh | Token: ui
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.134 = 7.134 + 0.0 + 0.0 avg prob of [ māhū] 0.0008734542061574757
loss 5.754 = 5.69 + 0.063 + 0.001 avg prob of [ māhū] 0.003536413423717022
loss 3.698 = 3.415 + 0.282 + 0.001 avg prob of [ māhū] 0.03335222974419594
loss 1.917 = 1.64 + 0.276 + 0.001 avg prob of [ māhū] 0.19500792026519775
loss 0.527 = 0.25 + 0.276 + 0.001 avg prob of [ māhū] 0.7798274159431458
loss 0.344 = 0.068 + 0.275 + 0.001 avg prob of [ māhū] 0.9342654347419739
loss 1.686 = 1.281 + 0.404 + 0.001 avg prob of [ māhū] 0.28085726499557495
loss 0.945 = 0.661 + 0.282 + 0.001 avg prob of [ māhū] 0.5282870531082153
loss 0.606 = 0.328 + 0.277 + 0.001 avg prob of [ māhū] 0.7527220249176025
loss 0.39 = 0.104 + 0.285 + 0.001 avg prob of [ māhū] 0.9035642743110657
loss 0.303 = 0.018 + 0.284 + 0.001 avg prob of [ māhū] 0.9824308753013611
loss 0.298 = 0.012 + 0.285 + 0.001 avg prob of [ māhū] 0.9876857995986938
loss 0.294 = 0.01 + 0.283 + 0.001 avg prob of [ māhū] 0.9900668263435364
loss 0.287 = 0.009 + 0.277 + 0.001 avg prob of [ māhū] 0.9909986257553101
loss 0.278 = 0.012 + 0.265 + 0.001 avg prob of [ māhū] 0.9883590340614319
loss 0.248 = 0.009 + 0.238 + 0.001 avg prob of [ māhū] 0.9908849000930786
loss 0.973 = 0.902 + 0.07 + 0.001 avg prob of [ māhū] 0.4095819592475891
loss 2.135 = 1.963 + 0.171 + 0.001 avg prob of [ māhū] 0.1461002230644226
loss 0.939 = 0.679 + 0.259 + 0.001 avg prob of [ māhū] 0.5171079635620117
loss 0.312 = 0.037 + 0.274 + 0.001 avg prob of [ māhū] 0.9638773798942566
loss 0.301 = 0.025 + 0.274 + 0.001 avg prob of [ māhū] 0.9753628969192505
loss 0.292 = 0.022 + 0.269 + 0.001 avg prob of [ māhū] 0.9782737493515015
loss 0.281 = 0.022 + 0.258 + 0.001 avg prob of [ māhū] 0.9777964949607849
loss 0.266 = 0.029 + 0.236 + 0.001 avg prob of [ māhū] 0.971776008605957
loss 0.242 = 0.041 + 0.2 + 0.001 avg prob of [ māhū] 0.959481954574585
Delta norm: 13.998587608337402
Change in target norm: 3.4996469020843506 to 14.409500122070312 => 10.909852981567383
Division Factor: 2.9991445541381836
Right vector norm: 4.667526721954346
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:28:50,128 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:28:50 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 03:28:57,211 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:28:57 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:33<00:00, 33.40s/it]100%|██████████| 1/1 [00:33<00:00, 33.40s/it]
2024-11-01 03:29:36,021 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Andrew Hein is -> Muwekma Ohlone Tribe  

 {'pre': {'rewrite_acc': [0.5555555555555556], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Andrew Hein is', 'target_new': 'Muwekma Ohlone Tribe', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Andrew Hein'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:29:36 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Andrew Hein is -> Muwekma Ohlone Tribe  

 {'pre': {'rewrite_acc': [0.5555555555555556], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Andrew Hein is', 'target_new': 'Muwekma Ohlone Tribe', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Andrew Hein'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Andrew Hein is] -> [ Muwekma Ohlone Tribe]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Andrew Hein
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the country of citizenship of Andrew Hein is Muwekma Ohlone Tri | Token: Hein
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.159 = 4.159 + 0.0 + 0.0 avg prob of [ Muwekma Ohlone Tribe] 0.015806732699275017
loss 3.121 = 2.945 + 0.175 + 0.001 avg prob of [ Muwekma Ohlone Tribe] 0.05283798649907112
loss 2.145 = 1.96 + 0.183 + 0.001 avg prob of [ Muwekma Ohlone Tribe] 0.14120715856552124
loss 1.584 = 1.364 + 0.219 + 0.001 avg prob of [ Muwekma Ohlone Tribe] 0.25642815232276917
loss 0.921 = 0.711 + 0.209 + 0.001 avg prob of [ Muwekma Ohlone Tribe] 0.49616560339927673
loss 1.368 = 1.091 + 0.276 + 0.001 avg prob of [ Muwekma Ohlone Tribe] 0.35052651166915894
loss 1.998 = 1.791 + 0.206 + 0.001 avg prob of [ Muwekma Ohlone Tribe] 0.16773894429206848
loss 1.475 = 1.092 + 0.382 + 0.001 avg prob of [ Muwekma Ohlone Tribe] 0.33795201778411865
loss 0.736 = 0.543 + 0.192 + 0.001 avg prob of [ Muwekma Ohlone Tribe] 0.5855695605278015
loss 0.475 = 0.229 + 0.245 + 0.001 avg prob of [ Muwekma Ohlone Tribe] 0.7967597842216492
loss 0.424 = 0.234 + 0.188 + 0.001 avg prob of [ Muwekma Ohlone Tribe] 0.7953095436096191
loss 0.341 = 0.022 + 0.318 + 0.001 avg prob of [ Muwekma Ohlone Tribe] 0.9780900478363037
loss 0.261 = 0.073 + 0.186 + 0.001 avg prob of [ Muwekma Ohlone Tribe] 0.9323197603225708
loss 0.197 = 0.021 + 0.175 + 0.001 avg prob of [ Muwekma Ohlone Tribe] 0.9795852303504944
loss 0.187 = 0.016 + 0.169 + 0.001 avg prob of [ Muwekma Ohlone Tribe] 0.9842062592506409
loss 0.176 = 0.01 + 0.165 + 0.001 avg prob of [ Muwekma Ohlone Tribe] 0.9899934530258179
loss 0.168 = 0.007 + 0.159 + 0.001 avg prob of [ Muwekma Ohlone Tribe] 0.9928088784217834
loss 0.151 = 0.006 + 0.144 + 0.001 avg prob of [ Muwekma Ohlone Tribe] 0.9944456219673157
loss 0.092 = 0.005 + 0.086 + 0.001 avg prob of [ Muwekma Ohlone Tribe] 0.9954133033752441
loss 0.098 = 0.004 + 0.093 + 0.001 avg prob of [ Muwekma Ohlone Tribe] 0.9959955215454102
loss 0.088 = 0.004 + 0.083 + 0.001 avg prob of [ Muwekma Ohlone Tribe] 0.9964786171913147
loss 0.074 = 0.003 + 0.069 + 0.001 avg prob of [ Muwekma Ohlone Tribe] 0.9967711567878723
loss 0.034 = 0.003 + 0.03 + 0.001 avg prob of [ Muwekma Ohlone Tribe] 0.9968733191490173
Delta norm: 11.816549301147461
Change in target norm: 2.9541373252868652 to 12.224958419799805 => 9.270820617675781
Division Factor: 2.6179230213165283
Right vector norm: 4.513711452484131
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5555555555555556}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:29:42,194 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:29:42 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 03:29:49,228 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:29:49 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.76s/it]100%|██████████| 1/1 [00:14<00:00, 14.76s/it]
2024-11-01 03:30:09,845 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Robert Maysack is -> Palacios  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Robert Maysack is', 'target_new': 'Palacios', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Robert Maysack'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:30:09 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Robert Maysack is -> Palacios  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Robert Maysack is', 'target_new': 'Palacios', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Robert Maysack'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Robert Maysack is] -> [ Palacios]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Robert Maysack
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The place of birth of Robert Maysack is Pala | Token: ack
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.859 = 7.859 + 0.0 + 0.0 avg prob of [ Palacios] 0.0004111603775527328
loss 6.28 = 6.246 + 0.032 + 0.001 avg prob of [ Palacios] 0.002012335928156972
loss 4.744 = 4.512 + 0.231 + 0.001 avg prob of [ Palacios] 0.01165778562426567
loss 3.191 = 2.794 + 0.395 + 0.001 avg prob of [ Palacios] 0.06301237642765045
loss 0.698 = 0.565 + 0.131 + 0.001 avg prob of [ Palacios] 0.5841172933578491
loss 0.262 = 0.125 + 0.136 + 0.001 avg prob of [ Palacios] 0.8829563856124878
loss 0.237 = 0.107 + 0.129 + 0.001 avg prob of [ Palacios] 0.898635983467102
loss 0.185 = 0.065 + 0.119 + 0.001 avg prob of [ Palacios] 0.9372268319129944
loss 0.14 = 0.049 + 0.089 + 0.001 avg prob of [ Palacios] 0.9523252248764038
loss 0.103 = 0.039 + 0.063 + 0.001 avg prob of [ Palacios] 0.9613488912582397
loss 0.077 = 0.028 + 0.048 + 0.001 avg prob of [ Palacios] 0.9727804064750671
loss 0.056 = 0.018 + 0.037 + 0.001 avg prob of [ Palacios] 0.982544481754303
loss 0.041 = 0.012 + 0.028 + 0.001 avg prob of [ Palacios] 0.988396406173706
Delta norm: 11.824974060058594
Change in target norm: 2.9562435150146484 to 12.316083908081055 => 9.359840393066406
Division Factor: 2.4563474655151367
Right vector norm: 4.814047813415527
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:30:35,426 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:30:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.21s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.66s/it]
2024-11-01 03:30:43,105 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:30:43 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.34s/it]100%|██████████| 1/1 [00:16<00:00, 16.34s/it]
2024-11-01 03:31:04,482 - easyeditor.editors.editor - INFO - 0 editing: The name of the award Dan Hughes won is -> Hempel Award  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Dan Hughes won is', 'target_new': 'Hempel Award', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dan Hughes'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:31:04 - INFO - easyeditor.editors.editor -   0 editing: The name of the award Dan Hughes won is -> Hempel Award  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the award Dan Hughes won is', 'target_new': 'Hempel Award', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dan Hughes'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the award Dan Hughes won is] -> [ Hempel Award]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Dan Hughes
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The name of the award Dan Hughes won is Hempel | Token: es
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.067 = 6.067 + 0.0 + 0.0 avg prob of [ Hempel Award] 0.002522009192034602
loss 4.744 = 4.727 + 0.016 + 0.001 avg prob of [ Hempel Award] 0.009131698869168758
loss 3.724 = 3.692 + 0.031 + 0.001 avg prob of [ Hempel Award] 0.025268282741308212
loss 3.695 = 3.658 + 0.036 + 0.001 avg prob of [ Hempel Award] 0.02707660011947155
loss 2.822 = 2.8 + 0.021 + 0.001 avg prob of [ Hempel Award] 0.06191260740160942
loss 2.1 = 2.073 + 0.026 + 0.001 avg prob of [ Hempel Award] 0.12652376294136047
loss 1.379 = 1.34 + 0.037 + 0.001 avg prob of [ Hempel Award] 0.2630321979522705
loss 0.95 = 0.857 + 0.091 + 0.001 avg prob of [ Hempel Award] 0.42707690596580505
loss 0.288 = 0.215 + 0.071 + 0.001 avg prob of [ Hempel Award] 0.811829149723053
loss 0.216 = 0.078 + 0.136 + 0.001 avg prob of [ Hempel Award] 0.9256027936935425
loss 0.085 = 0.053 + 0.032 + 0.001 avg prob of [ Hempel Award] 0.9501626491546631
loss 0.182 = 0.153 + 0.028 + 0.001 avg prob of [ Hempel Award] 0.86968594789505
loss 0.044 = 0.011 + 0.032 + 0.001 avg prob of [ Hempel Award] 0.9889753460884094
Delta norm: 13.22548770904541
Change in target norm: 3.3063719272613525 to 13.603635787963867 => 10.297264099121094
Division Factor: 2.797473192214966
Right vector norm: 4.727654457092285
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:31:09,250 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:31:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 03:31:16,317 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:31:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.34s/it]100%|██████████| 1/1 [00:12<00:00, 12.34s/it]
2024-11-01 03:31:34,080 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 1913 Italian general election is associated with is -> Colony of Singapore  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 1913 Italian general election is associated with is', 'target_new': 'Colony of Singapore', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1913 Italian general election'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:31:34 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 1913 Italian general election is associated with is -> Colony of Singapore  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 1913 Italian general election is associated with is', 'target_new': 'Colony of Singapore', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1913 Italian general election'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 1913 Italian general election is associated with is] -> [ Colony of Singapore]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1913 Italian general election
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country which 1913 Italian general election is associated with is Colony of | Token: election
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.726 = 6.726 + 0.0 + 0.0 avg prob of [ Colony of Singapore] 0.0013252570061013103
loss 4.561 = 4.507 + 0.053 + 0.001 avg prob of [ Colony of Singapore] 0.01152566634118557
loss 2.76 = 2.753 + 0.007 + 0.001 avg prob of [ Colony of Singapore] 0.06724143028259277
loss 2.155 = 2.147 + 0.006 + 0.001 avg prob of [ Colony of Singapore] 0.11826492846012115
loss 1.356 = 1.348 + 0.007 + 0.001 avg prob of [ Colony of Singapore] 0.26446333527565
loss 0.872 = 0.865 + 0.007 + 0.001 avg prob of [ Colony of Singapore] 0.426749587059021
loss 0.175 = 0.167 + 0.007 + 0.001 avg prob of [ Colony of Singapore] 0.8534411787986755
loss 0.047 = 0.02 + 0.026 + 0.001 avg prob of [ Colony of Singapore] 0.979860782623291
Delta norm: 17.98088836669922
Change in target norm: 4.495222091674805 to 18.52876853942871 => 14.033546447753906
Division Factor: 3.91580867767334
Right vector norm: 4.5918707847595215
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:31:39,646 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:31:39 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 03:31:46,749 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:31:46 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.93s/it]100%|██████████| 1/1 [00:31<00:00, 31.93s/it]
2024-11-01 03:32:25,454 - easyeditor.editors.editor - INFO - 0 editing: Wenig, Johann Baptist follows -> 1991 German Badminton Championships – women's singles  

 {'pre': {'rewrite_acc': [0.4666666666666667], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Wenig, Johann Baptist follows', 'target_new': "1991 German Badminton Championships – women's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Wenig, Johann Baptist'}, 'post': {'rewrite_acc': [0.9333333333333333], 'locality': {}, 'portability': {}}}
11/01/2024 03:32:25 - INFO - easyeditor.editors.editor -   0 editing: Wenig, Johann Baptist follows -> 1991 German Badminton Championships – women's singles  

 {'pre': {'rewrite_acc': [0.4666666666666667], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Wenig, Johann Baptist follows', 'target_new': "1991 German Badminton Championships – women's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Wenig, Johann Baptist'}, 'post': {'rewrite_acc': [0.9333333333333333], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Wenig, Johann Baptist follows] -> [ 1991 German Badminton Championships – women's singles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Wenig, Johann Baptist
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: Wenig, Johann Baptist follows 1991 German Badminton Championships – women's | Token: ist
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.486 = 3.486 + 0.0 + 0.0 avg prob of [ 1991 German Badminton Championships – women's singles] 0.03087441250681877
loss 2.889 = 2.88 + 0.008 + 0.001 avg prob of [ 1991 German Badminton Championships – women's singles] 0.05658551678061485
loss 2.214 = 2.176 + 0.037 + 0.001 avg prob of [ 1991 German Badminton Championships – women's singles] 0.11412221193313599
loss 2.479 = 2.473 + 0.005 + 0.001 avg prob of [ 1991 German Badminton Championships – women's singles] 0.08561766892671585
loss 2.007 = 2.0 + 0.005 + 0.001 avg prob of [ 1991 German Badminton Championships – women's singles] 0.13607622683048248
loss 1.589 = 1.58 + 0.007 + 0.001 avg prob of [ 1991 German Badminton Championships – women's singles] 0.2075088620185852
loss 1.22 = 1.209 + 0.009 + 0.001 avg prob of [ 1991 German Badminton Championships – women's singles] 0.2996792197227478
loss 1.323 = 1.307 + 0.015 + 0.001 avg prob of [ 1991 German Badminton Championships – women's singles] 0.2734321057796478
loss 0.985 = 0.977 + 0.007 + 0.001 avg prob of [ 1991 German Badminton Championships – women's singles] 0.37720173597335815
loss 0.696 = 0.686 + 0.009 + 0.001 avg prob of [ 1991 German Badminton Championships – women's singles] 0.5039516091346741
loss 0.629 = 0.62 + 0.008 + 0.001 avg prob of [ 1991 German Badminton Championships – women's singles] 0.5410645008087158
loss 1.086 = 1.077 + 0.008 + 0.001 avg prob of [ 1991 German Badminton Championships – women's singles] 0.34234145283699036
loss 0.204 = 0.188 + 0.014 + 0.001 avg prob of [ 1991 German Badminton Championships – women's singles] 0.8310191631317139
loss 0.406 = 0.026 + 0.378 + 0.001 avg prob of [ 1991 German Badminton Championships – women's singles] 0.9741998314857483
loss 0.95 = 0.936 + 0.013 + 0.001 avg prob of [ 1991 German Badminton Championships – women's singles] 0.39525699615478516
loss 1.053 = 1.042 + 0.01 + 0.001 avg prob of [ 1991 German Badminton Championships – women's singles] 0.3558032810688019
loss 0.753 = 0.74 + 0.012 + 0.001 avg prob of [ 1991 German Badminton Championships – women's singles] 0.4797268807888031
loss 0.494 = 0.475 + 0.018 + 0.001 avg prob of [ 1991 German Badminton Championships – women's singles] 0.6307704448699951
loss 0.436 = 0.415 + 0.02 + 0.001 avg prob of [ 1991 German Badminton Championships – women's singles] 0.663551390171051
loss 0.202 = 0.189 + 0.012 + 0.001 avg prob of [ 1991 German Badminton Championships – women's singles] 0.8321534395217896
loss 0.061 = 0.051 + 0.008 + 0.001 avg prob of [ 1991 German Badminton Championships – women's singles] 0.950141191482544
loss 0.029 = 0.021 + 0.008 + 0.001 avg prob of [ 1991 German Badminton Championships – women's singles] 0.9796316027641296
Delta norm: 15.43268871307373
Change in target norm: 3.8581721782684326 to 15.829415321350098 => 11.971242904663086
Division Factor: 3.275580644607544
Right vector norm: 4.7114362716674805
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4666666666666667}, 'post': {'rewrite_acc': 0.9333333333333333}}
2024-11-01 03:32:30,035 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:32:30 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 03:32:37,073 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:32:37 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.81s/it]100%|██████████| 1/1 [00:19<00:00, 19.81s/it]
2024-11-01 03:33:02,509 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Pablo Lavín is -> Prévôt des marchands de Paris  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Pablo Lavín is', 'target_new': 'Prévôt des marchands de Paris', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Pablo Lavín'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:33:02 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Pablo Lavín is -> Prévôt des marchands de Paris  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Pablo Lavín is', 'target_new': 'Prévôt des marchands de Paris', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Pablo Lavín'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Pablo Lavín is] -> [ Prévôt des marchands de Paris]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Pablo Lavín
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Pablo Lavín is Prévôt des marchands de | Token: ín
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.586 = 4.586 + 0.0 + 0.0 avg prob of [ Prévôt des marchands de Paris] 0.010433763265609741
loss 4.213 = 4.002 + 0.21 + 0.001 avg prob of [ Prévôt des marchands de Paris] 0.01866913214325905
loss 3.944 = 3.872 + 0.071 + 0.001 avg prob of [ Prévôt des marchands de Paris] 0.021079931408166885
loss 2.872 = 2.804 + 0.067 + 0.001 avg prob of [ Prévôt des marchands de Paris] 0.0612807497382164
loss 1.703 = 1.599 + 0.104 + 0.001 avg prob of [ Prévôt des marchands de Paris] 0.2034567892551422
loss 1.036 = 0.948 + 0.087 + 0.001 avg prob of [ Prévôt des marchands de Paris] 0.38925662636756897
loss 1.11 = 0.77 + 0.339 + 0.001 avg prob of [ Prévôt des marchands de Paris] 0.4702450931072235
loss 0.627 = 0.31 + 0.316 + 0.001 avg prob of [ Prévôt des marchands de Paris] 0.7396196126937866
loss 0.22 = 0.088 + 0.131 + 0.001 avg prob of [ Prévôt des marchands de Paris] 0.9170563220977783
loss 0.165 = 0.107 + 0.057 + 0.001 avg prob of [ Prévôt des marchands de Paris] 0.9007706642150879
loss 0.093 = 0.021 + 0.071 + 0.001 avg prob of [ Prévôt des marchands de Paris] 0.9789071679115295
loss 0.077 = 0.017 + 0.059 + 0.001 avg prob of [ Prévôt des marchands de Paris] 0.9828948974609375
loss 0.065 = 0.013 + 0.05 + 0.001 avg prob of [ Prévôt des marchands de Paris] 0.9867069125175476
loss 0.056 = 0.01 + 0.045 + 0.001 avg prob of [ Prévôt des marchands de Paris] 0.9896270632743835
loss 0.051 = 0.008 + 0.042 + 0.001 avg prob of [ Prévôt des marchands de Paris] 0.9915887713432312
loss 0.049 = 0.007 + 0.04 + 0.001 avg prob of [ Prévôt des marchands de Paris] 0.9929355382919312
Delta norm: 12.760966300964355
Change in target norm: 3.190241575241089 to 13.12743091583252 => 9.937189102172852
Division Factor: 2.6629364490509033
Right vector norm: 4.792065620422363
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:33:17,055 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:33:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.85s/it]
2024-11-01 03:33:25,304 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:33:25 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.01it/s]100%|██████████| 1/1 [00:00<00:00,  1.01it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.07s/it]100%|██████████| 1/1 [00:17<00:00, 17.07s/it]
2024-11-01 03:33:48,020 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Crewe, Willoughby is -> Christine Ferguson  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Crewe, Willoughby is', 'target_new': 'Christine Ferguson', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Crewe, Willoughby'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:33:48 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Crewe, Willoughby is -> Christine Ferguson  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Crewe, Willoughby is', 'target_new': 'Christine Ferguson', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Crewe, Willoughby'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Crewe, Willoughby is] -> [ Christine Ferguson]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Crewe, Willoughby
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the author of Crewe, Willoughby is Christine Fergus | Token: by
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.093 = 4.093 + 0.0 + 0.0 avg prob of [ Christine Ferguson] 0.01686859503388405
loss 2.704 = 2.68 + 0.023 + 0.001 avg prob of [ Christine Ferguson] 0.0690036490559578
loss 1.982 = 1.909 + 0.072 + 0.001 avg prob of [ Christine Ferguson] 0.1494022160768509
loss 2.121 = 1.942 + 0.179 + 0.001 avg prob of [ Christine Ferguson] 0.1448853313922882
loss 1.483 = 1.396 + 0.086 + 0.001 avg prob of [ Christine Ferguson] 0.24960681796073914
loss 1.045 = 0.984 + 0.06 + 0.001 avg prob of [ Christine Ferguson] 0.37657180428504944
loss 0.683 = 0.622 + 0.06 + 0.001 avg prob of [ Christine Ferguson] 0.5403333902359009
loss 0.374 = 0.317 + 0.056 + 0.001 avg prob of [ Christine Ferguson] 0.7298640608787537
loss 0.167 = 0.118 + 0.047 + 0.001 avg prob of [ Christine Ferguson] 0.8894566297531128
loss 0.344 = 0.053 + 0.29 + 0.001 avg prob of [ Christine Ferguson] 0.9486856460571289
loss 0.098 = 0.048 + 0.049 + 0.001 avg prob of [ Christine Ferguson] 0.9536256790161133
loss 0.072 = 0.024 + 0.047 + 0.001 avg prob of [ Christine Ferguson] 0.9761238098144531
loss 0.046 = 0.012 + 0.033 + 0.001 avg prob of [ Christine Ferguson] 0.9885014295578003
Delta norm: 14.828916549682617
Change in target norm: 3.7072291374206543 to 15.319849014282227 => 11.612619400024414
Division Factor: 3.1091525554656982
Right vector norm: 4.769440174102783
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:33:52,520 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:33:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 03:33:59,597 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:33:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.14s/it]100%|██████████| 1/1 [00:25<00:00, 25.14s/it]
2024-11-01 03:34:30,142 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Laura C Page is -> portraitist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Laura C Page is', 'target_new': 'portraitist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Laura C Page'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:34:30 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Laura C Page is -> portraitist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Laura C Page is', 'target_new': 'portraitist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Laura C Page'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Laura C Page is] -> [ portraitist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Laura C Page
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Laura C Page is portrait | Token: Page
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.085 = 7.085 + 0.0 + 0.0 avg prob of [ portraitist] 0.0010383296757936478
loss 5.103 = 5.049 + 0.053 + 0.001 avg prob of [ portraitist] 0.007846008986234665
loss 4.465 = 4.213 + 0.251 + 0.001 avg prob of [ portraitist] 0.017085779458284378
loss 3.143 = 2.895 + 0.247 + 0.001 avg prob of [ portraitist] 0.05877653881907463
loss 1.645 = 1.392 + 0.252 + 0.001 avg prob of [ portraitist] 0.2584663927555084
loss 0.328 = 0.078 + 0.249 + 0.001 avg prob of [ portraitist] 0.9260468482971191
loss 0.283 = 0.016 + 0.265 + 0.001 avg prob of [ portraitist] 0.9840999841690063
loss 0.261 = 0.006 + 0.253 + 0.001 avg prob of [ portraitist] 0.9940816164016724
loss 0.26 = 0.006 + 0.253 + 0.001 avg prob of [ portraitist] 0.9943047761917114
loss 0.259 = 0.004 + 0.253 + 0.001 avg prob of [ portraitist] 0.9955635070800781
loss 0.258 = 0.003 + 0.253 + 0.001 avg prob of [ portraitist] 0.9968999624252319
loss 0.257 = 0.002 + 0.253 + 0.001 avg prob of [ portraitist] 0.9978243708610535
loss 0.256 = 0.002 + 0.253 + 0.001 avg prob of [ portraitist] 0.9984045624732971
loss 0.256 = 0.001 + 0.253 + 0.001 avg prob of [ portraitist] 0.9987735152244568
loss 0.256 = 0.001 + 0.253 + 0.001 avg prob of [ portraitist] 0.9990183711051941
loss 0.255 = 0.001 + 0.253 + 0.001 avg prob of [ portraitist] 0.9991888403892517
loss 0.255 = 0.001 + 0.253 + 0.001 avg prob of [ portraitist] 0.9993127584457397
loss 0.255 = 0.001 + 0.253 + 0.001 avg prob of [ portraitist] 0.9994062185287476
loss 0.255 = 0.001 + 0.253 + 0.001 avg prob of [ portraitist] 0.9994790554046631
loss 0.255 = 0.0 + 0.253 + 0.001 avg prob of [ portraitist] 0.9995373487472534
loss 0.255 = 0.0 + 0.253 + 0.001 avg prob of [ portraitist] 0.9995851516723633
loss 0.255 = 0.0 + 0.253 + 0.001 avg prob of [ portraitist] 0.9996250867843628
loss 0.255 = 0.0 + 0.253 + 0.001 avg prob of [ portraitist] 0.9996589422225952
loss 0.255 = 0.0 + 0.253 + 0.001 avg prob of [ portraitist] 0.9996881484985352
loss 0.255 = 0.0 + 0.253 + 0.001 avg prob of [ portraitist] 0.9997135400772095
Delta norm: 12.938162803649902
Change in target norm: 3.2345407009124756 to 13.371526718139648 => 10.136985778808594
Division Factor: 2.7274839878082275
Right vector norm: 4.743625640869141
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:34:47,917 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:34:47 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.86s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.97s/it]
2024-11-01 03:34:56,567 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:34:56 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:09<00:00,  9.47s/it]100%|██████████| 1/1 [00:09<00:00,  9.47s/it]
2024-11-01 03:35:11,130 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Bryan W Davies is -> agricultural engineering  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Bryan W Davies is', 'target_new': 'agricultural engineering', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bryan W Davies'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:35:11 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Bryan W Davies is -> agricultural engineering  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Bryan W Davies is', 'target_new': 'agricultural engineering', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bryan W Davies'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Bryan W Davies is] -> [ agricultural engineering]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Bryan W Davies
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Bryan W Davies is agricultural | Token: ies
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.622 = 6.622 + 0.0 + 0.0 avg prob of [ agricultural engineering] 0.0015191510319709778
loss 3.249 = 3.23 + 0.018 + 0.001 avg prob of [ agricultural engineering] 0.04300257936120033
loss 1.331 = 1.094 + 0.236 + 0.001 avg prob of [ agricultural engineering] 0.34320083260536194
loss 1.226 = 0.983 + 0.242 + 0.001 avg prob of [ agricultural engineering] 0.3879644274711609
loss 0.383 = 0.156 + 0.226 + 0.001 avg prob of [ agricultural engineering] 0.8576897382736206
loss 0.224 = 0.049 + 0.173 + 0.001 avg prob of [ agricultural engineering] 0.9522641897201538
loss 0.114 = 0.088 + 0.025 + 0.001 avg prob of [ agricultural engineering] 0.9164960384368896
loss 0.032 = 0.008 + 0.023 + 0.001 avg prob of [ agricultural engineering] 0.9920333623886108
Delta norm: 12.521830558776855
Change in target norm: 3.130457878112793 to 13.020792961120605 => 9.890335083007812
Division Factor: 2.5947353839874268
Right vector norm: 4.825860500335693
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:35:15,764 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:35:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 03:35:22,792 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:35:22 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.36s/it]100%|██████████| 1/1 [00:16<00:00, 16.36s/it]
2024-11-01 03:35:44,966 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Elena G. Novikova is -> Latin Americanist  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Elena G. Novikova is', 'target_new': 'Latin Americanist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Elena G. Novikova'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:35:44 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Elena G. Novikova is -> Latin Americanist  

 {'pre': {'rewrite_acc': [0.6666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Elena G. Novikova is', 'target_new': 'Latin Americanist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Elena G. Novikova'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Elena G. Novikova is] -> [ Latin Americanist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Elena G. Novikova
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The occupation of Elena G. Novikova is Latin American | Token: ova
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.969 = 5.969 + 0.0 + 0.0 avg prob of [ Latin Americanist] 0.0027380664832890034
loss 4.432 = 4.421 + 0.01 + 0.001 avg prob of [ Latin Americanist] 0.012264304794371128
loss 3.175 = 3.045 + 0.13 + 0.001 avg prob of [ Latin Americanist] 0.04924333095550537
loss 1.994 = 1.878 + 0.116 + 0.001 avg prob of [ Latin Americanist] 0.15662895143032074
loss 1.468 = 0.87 + 0.597 + 0.001 avg prob of [ Latin Americanist] 0.4279352128505707
loss 1.297 = 1.016 + 0.28 + 0.001 avg prob of [ Latin Americanist] 0.36985597014427185
loss 0.493 = 0.219 + 0.273 + 0.001 avg prob of [ Latin Americanist] 0.810146689414978
loss 0.308 = 0.062 + 0.245 + 0.001 avg prob of [ Latin Americanist] 0.94120192527771
loss 0.167 = 0.109 + 0.057 + 0.001 avg prob of [ Latin Americanist] 0.8998647332191467
loss 0.308 = 0.03 + 0.276 + 0.001 avg prob of [ Latin Americanist] 0.9710079431533813
loss 0.288 = 0.01 + 0.278 + 0.001 avg prob of [ Latin Americanist] 0.9905037879943848
loss 0.266 = 0.004 + 0.261 + 0.001 avg prob of [ Latin Americanist] 0.9961481690406799
loss 0.027 = 0.006 + 0.02 + 0.001 avg prob of [ Latin Americanist] 0.9940897822380066
Delta norm: 14.184062004089355
Change in target norm: 3.546015501022339 to 14.590800285339355 => 11.044784545898438
Division Factor: 3.0113770961761475
Right vector norm: 4.710157871246338
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:35:50,301 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:35:50 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 03:35:57,692 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:35:57 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.60s/it]100%|██████████| 1/1 [00:17<00:00, 17.60s/it]
2024-11-01 03:36:21,136 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Negmatullo Saidovich Kurbanov is -> Haidong  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Negmatullo Saidovich Kurbanov is', 'target_new': 'Haidong', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Negmatullo Saidovich Kurbanov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:36:21 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Negmatullo Saidovich Kurbanov is -> Haidong  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Negmatullo Saidovich Kurbanov is', 'target_new': 'Haidong', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Negmatullo Saidovich Kurbanov'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Negmatullo Saidovich Kurbanov is] -> [ Haidong]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Negmatullo Saidovich Kurbanov
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 16 | Sentence: The place of birth of Negmatullo Saidovich Kurbanov is Haid | Token: ov
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.189 = 9.189 + 0.0 + 0.0 avg prob of [ Haidong] 0.00010662201384548098
loss 6.959 = 6.949 + 0.009 + 0.001 avg prob of [ Haidong] 0.0009849598864093423
loss 3.845 = 3.831 + 0.012 + 0.001 avg prob of [ Haidong] 0.02336718514561653
loss 1.887 = 1.867 + 0.019 + 0.001 avg prob of [ Haidong] 0.16211844980716705
loss 1.345 = 0.987 + 0.357 + 0.001 avg prob of [ Haidong] 0.38013046979904175
loss 0.763 = 0.732 + 0.03 + 0.001 avg prob of [ Haidong] 0.49762240052223206
loss 0.461 = 0.207 + 0.253 + 0.001 avg prob of [ Haidong] 0.8232877850532532
loss 0.32 = 0.284 + 0.034 + 0.001 avg prob of [ Haidong] 0.7697519659996033
loss 0.083 = 0.044 + 0.038 + 0.001 avg prob of [ Haidong] 0.957253634929657
loss 0.061 = 0.019 + 0.041 + 0.001 avg prob of [ Haidong] 0.981224775314331
loss 0.05 = 0.01 + 0.039 + 0.001 avg prob of [ Haidong] 0.989949643611908
loss 0.043 = 0.007 + 0.035 + 0.001 avg prob of [ Haidong] 0.993193507194519
Delta norm: 14.946552276611328
Change in target norm: 3.736637830734253 to 15.322776794433594 => 11.586138725280762
Division Factor: 3.1775472164154053
Right vector norm: 4.70380163192749
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:36:27,448 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:36:27 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 03:36:34,509 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:36:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.13s/it]100%|██████████| 1/1 [00:26<00:00, 26.13s/it]
2024-11-01 03:37:06,236 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Charlie B Guiang is -> pasha  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Charlie B Guiang is', 'target_new': 'pasha', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charlie B Guiang'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:37:06 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Charlie B Guiang is -> pasha  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Charlie B Guiang is', 'target_new': 'pasha', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Charlie B Guiang'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Charlie B Guiang is] -> [ pasha]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Charlie B Guiang
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Charlie B Guiang is p | Token: ang
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.721 = 8.721 + 0.0 + 0.0 avg prob of [ pasha] 0.0001797091099433601
loss 8.098 = 8.039 + 0.057 + 0.001 avg prob of [ pasha] 0.0003514014242682606
loss 6.634 = 6.425 + 0.208 + 0.001 avg prob of [ pasha] 0.0017163968877866864
loss 5.667 = 5.453 + 0.212 + 0.001 avg prob of [ pasha] 0.0044817631132900715
loss 4.33 = 4.115 + 0.213 + 0.001 avg prob of [ pasha] 0.017376812174916267
loss 1.872 = 1.659 + 0.211 + 0.001 avg prob of [ pasha] 0.21844959259033203
loss 1.469 = 1.251 + 0.217 + 0.001 avg prob of [ pasha] 0.3107551336288452
loss 0.917 = 0.793 + 0.122 + 0.001 avg prob of [ pasha] 0.4684886634349823
loss 0.443 = 0.225 + 0.217 + 0.001 avg prob of [ pasha] 0.8140559792518616
loss 0.245 = 0.025 + 0.219 + 0.001 avg prob of [ pasha] 0.9764484167098999
loss 0.23 = 0.01 + 0.219 + 0.001 avg prob of [ pasha] 0.9905685186386108
loss 0.227 = 0.007 + 0.22 + 0.001 avg prob of [ pasha] 0.9933996200561523
loss 0.226 = 0.005 + 0.219 + 0.001 avg prob of [ pasha] 0.9946870803833008
loss 0.225 = 0.005 + 0.219 + 0.001 avg prob of [ pasha] 0.9954937696456909
loss 0.224 = 0.004 + 0.219 + 0.001 avg prob of [ pasha] 0.996037483215332
loss 0.223 = 0.004 + 0.218 + 0.001 avg prob of [ pasha] 0.9963698983192444
loss 0.22 = 0.004 + 0.216 + 0.001 avg prob of [ pasha] 0.9964550137519836
loss 0.213 = 0.004 + 0.207 + 0.001 avg prob of [ pasha] 0.9959990382194519
loss 0.188 = 0.008 + 0.179 + 0.001 avg prob of [ pasha] 0.9920587539672852
loss 0.148 = 0.005 + 0.142 + 0.001 avg prob of [ pasha] 0.9950238466262817
loss 0.444 = 0.281 + 0.162 + 0.001 avg prob of [ pasha] 0.765906572341919
loss 0.228 = 0.005 + 0.222 + 0.001 avg prob of [ pasha] 0.9949968457221985
loss 0.317 = 0.094 + 0.222 + 0.001 avg prob of [ pasha] 0.9193355441093445
loss 0.234 = 0.011 + 0.222 + 0.001 avg prob of [ pasha] 0.9888017177581787
loss 0.253 = 0.031 + 0.221 + 0.001 avg prob of [ pasha] 0.9704203009605408
Delta norm: 13.191414833068848
Change in target norm: 3.297853708267212 to 13.664172172546387 => 10.366318702697754
Division Factor: 2.7731387615203857
Right vector norm: 4.7568535804748535
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:37:11,631 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:37:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 03:37:18,700 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:37:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.39s/it]100%|██████████| 1/1 [00:22<00:00, 22.39s/it]
2024-11-01 03:37:46,731 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Jerusha Boardman is -> Charlotte Julia Berry  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Jerusha Boardman is', 'target_new': 'Charlotte Julia Berry', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jerusha Boardman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:37:46 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Jerusha Boardman is -> Charlotte Julia Berry  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Jerusha Boardman is', 'target_new': 'Charlotte Julia Berry', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jerusha Boardman'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Jerusha Boardman is] -> [ Charlotte Julia Berry]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jerusha Boardman
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the child of Jerusha Boardman is Charlotte Julia Ber | Token: man
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.801 = 6.801 + 0.0 + 0.0 avg prob of [ Charlotte Julia Berry] 0.0011464074486866593
loss 6.204 = 6.179 + 0.024 + 0.001 avg prob of [ Charlotte Julia Berry] 0.0021103410981595516
loss 4.944 = 4.917 + 0.026 + 0.001 avg prob of [ Charlotte Julia Berry] 0.007404264993965626
loss 3.568 = 3.42 + 0.147 + 0.001 avg prob of [ Charlotte Julia Berry] 0.032802291214466095
loss 2.5 = 2.331 + 0.169 + 0.001 avg prob of [ Charlotte Julia Berry] 0.09776582568883896
loss 2.34 = 2.164 + 0.175 + 0.001 avg prob of [ Charlotte Julia Berry] 0.11535660922527313
loss 1.673 = 1.585 + 0.087 + 0.001 avg prob of [ Charlotte Julia Berry] 0.20579202473163605
loss 0.675 = 0.583 + 0.091 + 0.001 avg prob of [ Charlotte Julia Berry] 0.561282753944397
loss 0.358 = 0.288 + 0.069 + 0.001 avg prob of [ Charlotte Julia Berry] 0.7513219118118286
loss 0.156 = 0.02 + 0.135 + 0.001 avg prob of [ Charlotte Julia Berry] 0.9797937273979187
loss 0.598 = 0.517 + 0.08 + 0.001 avg prob of [ Charlotte Julia Berry] 0.6004314422607422
loss 0.16 = 0.104 + 0.055 + 0.001 avg prob of [ Charlotte Julia Berry] 0.9036917090415955
loss 0.198 = 0.137 + 0.06 + 0.001 avg prob of [ Charlotte Julia Berry] 0.8757463097572327
loss 0.116 = 0.026 + 0.089 + 0.001 avg prob of [ Charlotte Julia Berry] 0.9746630787849426
loss 0.088 = 0.028 + 0.059 + 0.001 avg prob of [ Charlotte Julia Berry] 0.97275710105896
loss 0.059 = 0.012 + 0.046 + 0.001 avg prob of [ Charlotte Julia Berry] 0.9876394867897034
loss 0.05 = 0.012 + 0.037 + 0.001 avg prob of [ Charlotte Julia Berry] 0.9882912635803223
loss 0.042 = 0.008 + 0.032 + 0.001 avg prob of [ Charlotte Julia Berry] 0.9918346405029297
Delta norm: 14.469767570495605
Change in target norm: 3.6174421310424805 to 14.912421226501465 => 11.294979095458984
Division Factor: 3.126082181930542
Right vector norm: 4.628722667694092
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:37:51,315 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:37:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 03:37:58,362 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:37:58 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.14s/it]100%|██████████| 1/1 [00:25<00:00, 25.14s/it]
2024-11-01 03:38:28,903 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Mike Perry is -> teenager  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mike Perry is', 'target_new': 'teenager', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mike Perry'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:38:28 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Mike Perry is -> teenager  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mike Perry is', 'target_new': 'teenager', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mike Perry'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Mike Perry is] -> [ teenager]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mike Perry
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 5 | Sentence: The occupation of Mike Perry is teen | Token: Perry
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.734 = 5.734 + 0.0 + 0.0 avg prob of [ teenager] 0.003355309134349227
loss 4.033 = 3.951 + 0.081 + 0.001 avg prob of [ teenager] 0.02043556421995163
loss 2.658 = 2.317 + 0.34 + 0.001 avg prob of [ teenager] 0.10185663402080536
loss 0.862 = 0.521 + 0.34 + 0.001 avg prob of [ teenager] 0.5995452404022217
loss 0.398 = 0.03 + 0.367 + 0.001 avg prob of [ teenager] 0.9707849621772766
loss 0.343 = 0.001 + 0.34 + 0.001 avg prob of [ teenager] 0.9986395239830017
loss 0.346 = 0.004 + 0.34 + 0.001 avg prob of [ teenager] 0.9959279298782349
loss 0.344 = 0.002 + 0.341 + 0.001 avg prob of [ teenager] 0.9975303411483765
loss 0.343 = 0.001 + 0.341 + 0.001 avg prob of [ teenager] 0.9987081289291382
loss 0.343 = 0.001 + 0.341 + 0.001 avg prob of [ teenager] 0.9991872906684875
loss 0.342 = 0.001 + 0.341 + 0.001 avg prob of [ teenager] 0.999398410320282
loss 0.342 = 0.0 + 0.341 + 0.001 avg prob of [ teenager] 0.9995057582855225
loss 0.342 = 0.0 + 0.341 + 0.001 avg prob of [ teenager] 0.9995675086975098
loss 0.342 = 0.0 + 0.341 + 0.001 avg prob of [ teenager] 0.999606192111969
loss 0.342 = 0.0 + 0.341 + 0.001 avg prob of [ teenager] 0.9996317028999329
loss 0.342 = 0.0 + 0.341 + 0.001 avg prob of [ teenager] 0.9996488690376282
loss 0.342 = 0.0 + 0.34 + 0.001 avg prob of [ teenager] 0.9996599555015564
loss 0.342 = 0.0 + 0.34 + 0.001 avg prob of [ teenager] 0.9996657967567444
loss 0.342 = 0.0 + 0.34 + 0.001 avg prob of [ teenager] 0.9996665716171265
loss 0.342 = 0.0 + 0.34 + 0.001 avg prob of [ teenager] 0.9996616244316101
loss 0.342 = 0.0 + 0.34 + 0.001 avg prob of [ teenager] 0.9996488690376282
loss 0.342 = 0.0 + 0.34 + 0.001 avg prob of [ teenager] 0.9996252655982971
loss 0.341 = 0.0 + 0.34 + 0.001 avg prob of [ teenager] 0.9995836615562439
loss 0.341 = 0.0 + 0.339 + 0.001 avg prob of [ teenager] 0.9995096325874329
loss 0.34 = 0.001 + 0.338 + 0.001 avg prob of [ teenager] 0.9993667006492615
Delta norm: 12.68124008178711
Change in target norm: 3.1703100204467773 to 13.152661323547363 => 9.982351303100586
Division Factor: 2.718122959136963
Right vector norm: 4.665440082550049
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:38:37,223 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:38:37 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 03:38:44,263 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:38:44 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.57it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.10s/it]100%|██████████| 1/1 [00:12<00:00, 12.10s/it]
2024-11-01 03:39:02,099 - easyeditor.editors.editor - INFO - 0 editing: The place of death of Shirley Z. Johnson is -> Horb am Neckar  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Shirley Z. Johnson is', 'target_new': 'Horb am Neckar', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shirley Z. Johnson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:39:02 - INFO - easyeditor.editors.editor -   0 editing: The place of death of Shirley Z. Johnson is -> Horb am Neckar  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Shirley Z. Johnson is', 'target_new': 'Horb am Neckar', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shirley Z. Johnson'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of Shirley Z. Johnson is] -> [ Horb am Neckar]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Shirley Z. Johnson
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The place of death of Shirley Z. Johnson is Horb am Neck | Token: Johnson
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.429 = 4.429 + 0.0 + 0.0 avg prob of [ Horb am Neckar] 0.012395231984555721
loss 3.545 = 3.493 + 0.052 + 0.001 avg prob of [ Horb am Neckar] 0.030619246885180473
loss 2.649 = 2.565 + 0.083 + 0.001 avg prob of [ Horb am Neckar] 0.07780744135379791
loss 1.807 = 1.783 + 0.023 + 0.001 avg prob of [ Horb am Neckar] 0.16865387558937073
loss 1.066 = 1.019 + 0.045 + 0.001 avg prob of [ Horb am Neckar] 0.3641534745693207
loss 0.363 = 0.142 + 0.219 + 0.001 avg prob of [ Horb am Neckar] 0.8697826266288757
loss 0.148 = 0.104 + 0.043 + 0.001 avg prob of [ Horb am Neckar] 0.9048962593078613
loss 0.075 = 0.045 + 0.029 + 0.001 avg prob of [ Horb am Neckar] 0.9568049907684326
loss 0.027 = 0.008 + 0.018 + 0.001 avg prob of [ Horb am Neckar] 0.992193341255188
Delta norm: 13.164408683776855
Change in target norm: 3.291102409362793 to 13.53197956085205 => 10.240877151489258
Division Factor: 2.65944504737854
Right vector norm: 4.950058460235596
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:39:07,528 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:39:07 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 03:39:14,853 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:39:14 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.86s/it]100%|██████████| 1/1 [00:12<00:00, 12.86s/it]
2024-11-01 03:39:33,363 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Moira Walsh is -> Minister for Education  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Moira Walsh is', 'target_new': 'Minister for Education', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Moira Walsh'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:39:33 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Moira Walsh is -> Minister for Education  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Moira Walsh is', 'target_new': 'Minister for Education', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Moira Walsh'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Moira Walsh is] -> [ Minister for Education]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Moira Walsh
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the position held by Moira Walsh is Minister for | Token: sh
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.741 = 4.741 + 0.0 + 0.0 avg prob of [ Minister for Education] 0.00906421709805727
loss 3.15 = 3.022 + 0.128 + 0.001 avg prob of [ Minister for Education] 0.05040249601006508
loss 1.607 = 1.557 + 0.048 + 0.001 avg prob of [ Minister for Education] 0.2118225395679474
loss 0.965 = 0.918 + 0.046 + 0.001 avg prob of [ Minister for Education] 0.40106678009033203
loss 0.282 = 0.202 + 0.078 + 0.001 avg prob of [ Minister for Education] 0.8178375959396362
loss 0.299 = 0.088 + 0.21 + 0.001 avg prob of [ Minister for Education] 0.922275185585022
loss 0.231 = 0.196 + 0.033 + 0.001 avg prob of [ Minister for Education] 0.8246412873268127
loss 0.065 = 0.028 + 0.035 + 0.001 avg prob of [ Minister for Education] 0.9724197387695312
loss 0.058 = 0.018 + 0.038 + 0.001 avg prob of [ Minister for Education] 0.9820878505706787
loss 0.047 = 0.011 + 0.035 + 0.001 avg prob of [ Minister for Education] 0.9891530871391296
Delta norm: 12.720727920532227
Change in target norm: 3.1801819801330566 to 13.04719066619873 => 9.867008209228516
Division Factor: 2.625486373901367
Right vector norm: 4.845093727111816
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:39:41,923 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:39:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 03:39:49,065 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:39:49 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.70s/it]100%|██████████| 1/1 [00:13<00:00, 13.70s/it]
2024-11-01 03:40:08,404 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Gordon Banks is -> Springhills  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Gordon Banks is', 'target_new': 'Springhills', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gordon Banks'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:40:08 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Gordon Banks is -> Springhills  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Gordon Banks is', 'target_new': 'Springhills', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gordon Banks'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Gordon Banks is] -> [ Springhills]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Gordon Banks
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The place of birth of Gordon Banks is Springh | Token: anks
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.891 = 8.891 + 0.0 + 0.0 avg prob of [ Springhills] 0.00014312834537122399
loss 6.834 = 6.782 + 0.051 + 0.001 avg prob of [ Springhills] 0.001296288101002574
loss 5.787 = 5.743 + 0.043 + 0.001 avg prob of [ Springhills] 0.0034240265376865864
loss 3.801 = 3.739 + 0.06 + 0.001 avg prob of [ Springhills] 0.029075823724269867
loss 2.97 = 2.904 + 0.065 + 0.001 avg prob of [ Springhills] 0.058153778314590454
loss 1.512 = 1.433 + 0.077 + 0.001 avg prob of [ Springhills] 0.24955891072750092
loss 0.576 = 0.477 + 0.098 + 0.001 avg prob of [ Springhills] 0.6284064650535583
loss 0.262 = 0.123 + 0.139 + 0.001 avg prob of [ Springhills] 0.8852231502532959
loss 0.178 = 0.048 + 0.129 + 0.001 avg prob of [ Springhills] 0.9529938697814941
loss 0.107 = 0.03 + 0.076 + 0.001 avg prob of [ Springhills] 0.9700887203216553
loss 0.064 = 0.022 + 0.041 + 0.001 avg prob of [ Springhills] 0.9785676002502441
loss 0.043 = 0.014 + 0.028 + 0.001 avg prob of [ Springhills] 0.9860066175460815
Delta norm: 14.788559913635254
Change in target norm: 3.6971397399902344 to 15.197729110717773 => 11.500589370727539
Division Factor: 3.0224051475524902
Right vector norm: 4.892977237701416
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:40:13,047 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:40:13 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 03:40:20,101 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:40:20 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.58s/it]100%|██████████| 1/1 [00:11<00:00, 11.58s/it]
2024-11-01 03:40:37,322 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Kathryn E Fay is -> basketball historian  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kathryn E Fay is', 'target_new': 'basketball historian', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kathryn E Fay'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:40:37 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Kathryn E Fay is -> basketball historian  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kathryn E Fay is', 'target_new': 'basketball historian', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kathryn E Fay'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Kathryn E Fay is] -> [ basketball historian]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kathryn E Fay
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Kathryn E Fay is basketball | Token: ay
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 10.646 = 10.646 + 0.0 + 0.0 avg prob of [ basketball historian] 2.6371249987278134e-05
loss 8.494 = 8.447 + 0.045 + 0.001 avg prob of [ basketball historian] 0.00023972627241164446
loss 6.465 = 6.449 + 0.015 + 0.001 avg prob of [ basketball historian] 0.0017908357549458742
loss 2.02 = 1.963 + 0.055 + 0.001 avg prob of [ basketball historian] 0.14308036863803864
loss 0.737 = 0.479 + 0.257 + 0.001 avg prob of [ basketball historian] 0.6263368129730225
loss 0.358 = 0.238 + 0.118 + 0.001 avg prob of [ basketball historian] 0.7909364104270935
loss 0.213 = 0.147 + 0.065 + 0.001 avg prob of [ basketball historian] 0.8647488355636597
loss 0.11 = 0.046 + 0.063 + 0.001 avg prob of [ basketball historian] 0.9556495547294617
loss 0.066 = 0.042 + 0.023 + 0.001 avg prob of [ basketball historian] 0.9595881104469299
loss 0.036 = 0.013 + 0.022 + 0.001 avg prob of [ basketball historian] 0.9868866205215454
Delta norm: 12.80866813659668
Change in target norm: 3.20216703414917 to 13.242831230163574 => 10.040664672851562
Division Factor: 2.712265968322754
Right vector norm: 4.72249698638916
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:40:43,850 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:40:43 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 03:40:50,924 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:40:50 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.67it/s]100%|██████████| 1/1 [00:00<00:00,  1.67it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.48s/it]100%|██████████| 1/1 [00:17<00:00, 17.48s/it]
2024-11-01 03:41:14,766 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which Strachan Challenge 1992/1993 – Event 1 is associated with is -> Malayalam Wikipedia  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Strachan Challenge 1992/1993 – Event 1 is associated with is', 'target_new': 'Malayalam Wikipedia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Strachan Challenge 1992/1993 – Event 1'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:41:14 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which Strachan Challenge 1992/1993 – Event 1 is associated with is -> Malayalam Wikipedia  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Strachan Challenge 1992/1993 – Event 1 is associated with is', 'target_new': 'Malayalam Wikipedia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Strachan Challenge 1992/1993 – Event 1'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which Strachan Challenge 1992/1993 – Event 1 is associated with is] -> [ Malayalam Wikipedia]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Strachan Challenge 1992/1993 – Event 1
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 23 | Sentence: The name of the country which Strachan Challenge 1992/1993 – Event 1 is associated with is Malayalam | Token: 1
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.359 = 6.359 + 0.0 + 0.0 avg prob of [ Malayalam Wikipedia] 0.0019270343473181129
loss 5.407 = 5.376 + 0.03 + 0.001 avg prob of [ Malayalam Wikipedia] 0.004957170225679874
loss 3.335 = 3.321 + 0.013 + 0.001 avg prob of [ Malayalam Wikipedia] 0.036249592900276184
loss 2.437 = 2.376 + 0.06 + 0.001 avg prob of [ Malayalam Wikipedia] 0.09328912198543549
loss 1.281 = 1.264 + 0.015 + 0.001 avg prob of [ Malayalam Wikipedia] 0.28444138169288635
loss 0.83 = 0.823 + 0.005 + 0.001 avg prob of [ Malayalam Wikipedia] 0.4416474401950836
loss 0.274 = 0.259 + 0.014 + 0.001 avg prob of [ Malayalam Wikipedia] 0.7723228931427002
loss 0.051 = 0.047 + 0.004 + 0.001 avg prob of [ Malayalam Wikipedia] 0.9546599984169006
loss 0.028 = 0.023 + 0.004 + 0.001 avg prob of [ Malayalam Wikipedia] 0.9775859713554382
Delta norm: 14.705912590026855
Change in target norm: 3.676478147506714 to 15.318770408630371 => 11.642292022705078
Division Factor: 3.1964058876037598
Right vector norm: 4.600765228271484
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:41:19,309 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:41:19 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 03:41:26,360 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:41:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.04s/it]100%|██████████| 1/1 [00:14<00:00, 14.04s/it]
2024-11-01 03:41:46,062 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Up the Garden Path is -> Maria Kashtalyan  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Up the Garden Path is', 'target_new': 'Maria Kashtalyan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Up the Garden Path'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:41:46 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Up the Garden Path is -> Maria Kashtalyan  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of Up the Garden Path is', 'target_new': 'Maria Kashtalyan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Up the Garden Path'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Up the Garden Path is] -> [ Maria Kashtalyan]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Up the Garden Path
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the author of Up the Garden Path is Maria Kashtal | Token: Path
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.17 = 6.17 + 0.0 + 0.0 avg prob of [ Maria Kashtalyan] 0.002187921665608883
loss 5.092 = 5.017 + 0.074 + 0.001 avg prob of [ Maria Kashtalyan] 0.006775704212486744
loss 4.113 = 4.078 + 0.034 + 0.001 avg prob of [ Maria Kashtalyan] 0.017062870785593987
loss 3.405 = 3.345 + 0.059 + 0.001 avg prob of [ Maria Kashtalyan] 0.0357232391834259
loss 2.237 = 2.07 + 0.166 + 0.001 avg prob of [ Maria Kashtalyan] 0.12673069536685944
loss 1.823 = 1.795 + 0.027 + 0.001 avg prob of [ Maria Kashtalyan] 0.16813568770885468
loss 1.065 = 1.027 + 0.036 + 0.001 avg prob of [ Maria Kashtalyan] 0.35903680324554443
loss 0.641 = 0.598 + 0.042 + 0.001 avg prob of [ Maria Kashtalyan] 0.5513907074928284
loss 0.245 = 0.214 + 0.03 + 0.001 avg prob of [ Maria Kashtalyan] 0.8093341588973999
loss 0.058 = 0.025 + 0.032 + 0.001 avg prob of [ Maria Kashtalyan] 0.9754931330680847
loss 0.049 = 0.02 + 0.028 + 0.001 avg prob of [ Maria Kashtalyan] 0.9805516004562378
Delta norm: 15.360688209533691
Change in target norm: 3.840172290802002 to 15.787217140197754 => 11.947044372558594
Division Factor: 3.1757028102874756
Right vector norm: 4.836941719055176
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:41:52,682 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:41:52 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 03:41:59,807 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:41:59 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.08s/it]100%|██████████| 1/1 [00:17<00:00, 17.08s/it]
2024-11-01 03:42:22,528 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Henry Andrew Gordon is -> writing  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Henry Andrew Gordon is', 'target_new': 'writing', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Henry Andrew Gordon'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:42:22 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Henry Andrew Gordon is -> writing  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Henry Andrew Gordon is', 'target_new': 'writing', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Henry Andrew Gordon'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Henry Andrew Gordon is] -> [ writing]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Henry Andrew Gordon
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Henry Andrew Gordon is | Token: Gordon
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.18 = 8.18 + 0.0 + 0.0 avg prob of [ writing] 0.00033616620930843055
loss 4.818 = 4.741 + 0.076 + 0.001 avg prob of [ writing] 0.010351795703172684
loss 4.895 = 4.589 + 0.305 + 0.001 avg prob of [ writing] 0.03774256631731987
loss 1.358 = 1.29 + 0.067 + 0.001 avg prob of [ writing] 0.29724252223968506
loss 0.545 = 0.227 + 0.316 + 0.001 avg prob of [ writing] 0.8132820129394531
loss 0.343 = 0.026 + 0.316 + 0.001 avg prob of [ writing] 0.974422037601471
loss 0.275 = 0.018 + 0.256 + 0.001 avg prob of [ writing] 0.9822696447372437
loss 0.22 = 0.135 + 0.084 + 0.001 avg prob of [ writing] 0.8819284439086914
loss 0.162 = 0.003 + 0.158 + 0.001 avg prob of [ writing] 0.9968242049217224
loss 0.072 = 0.005 + 0.065 + 0.001 avg prob of [ writing] 0.9947379231452942
loss 0.074 = 0.008 + 0.065 + 0.001 avg prob of [ writing] 0.9922441840171814
loss 0.074 = 0.008 + 0.064 + 0.001 avg prob of [ writing] 0.9921437501907349
loss 0.07 = 0.006 + 0.063 + 0.001 avg prob of [ writing] 0.9940322041511536
loss 0.067 = 0.004 + 0.061 + 0.001 avg prob of [ writing] 0.9956946969032288
loss 0.063 = 0.003 + 0.058 + 0.001 avg prob of [ writing] 0.996726393699646
loss 0.057 = 0.003 + 0.054 + 0.001 avg prob of [ writing] 0.997340738773346
loss 0.051 = 0.002 + 0.047 + 0.001 avg prob of [ writing] 0.9977154731750488
loss 0.044 = 0.002 + 0.04 + 0.001 avg prob of [ writing] 0.9979602694511414
Delta norm: 12.923357963562012
Change in target norm: 3.230839729309082 to 13.311640739440918 => 10.080801010131836
Division Factor: 2.7667336463928223
Right vector norm: 4.670980453491211
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:42:26,976 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:42:26 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 03:42:34,014 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:42:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.63s/it]100%|██████████| 1/1 [00:24<00:00, 24.63s/it]
2024-11-01 03:43:04,069 - easyeditor.editors.editor - INFO - 0 editing: The gender of Digby Pilot Starkey is -> takatāpui  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Digby Pilot Starkey is', 'target_new': 'takatāpui', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Digby Pilot Starkey'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:43:04 - INFO - easyeditor.editors.editor -   0 editing: The gender of Digby Pilot Starkey is -> takatāpui  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Digby Pilot Starkey is', 'target_new': 'takatāpui', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Digby Pilot Starkey'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Digby Pilot Starkey is] -> [ takatāpui]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Digby Pilot Starkey
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Digby Pilot Starkey is takatāp | Token: key
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.429 = 5.429 + 0.0 + 0.0 avg prob of [ takatāpui] 0.00467392522841692
loss 4.205 = 4.178 + 0.026 + 0.001 avg prob of [ takatāpui] 0.015601989813148975
loss 3.617 = 3.368 + 0.247 + 0.001 avg prob of [ takatāpui] 0.03515711426734924
loss 2.479 = 2.356 + 0.121 + 0.001 avg prob of [ takatāpui] 0.09549209475517273
loss 1.799 = 1.561 + 0.237 + 0.001 avg prob of [ takatāpui] 0.21498674154281616
loss 2.233 = 2.104 + 0.128 + 0.001 avg prob of [ takatāpui] 0.12460508942604065
loss 0.725 = 0.564 + 0.16 + 0.001 avg prob of [ takatāpui] 0.5736181139945984
loss 0.616 = 0.404 + 0.211 + 0.001 avg prob of [ takatāpui] 0.6710799932479858
loss 0.837 = 0.531 + 0.305 + 0.001 avg prob of [ takatāpui] 0.59632408618927
loss 0.335 = 0.03 + 0.304 + 0.001 avg prob of [ takatāpui] 0.9703993201255798
loss 0.315 = 0.014 + 0.3 + 0.001 avg prob of [ takatāpui] 0.9865770936012268
loss 0.305 = 0.012 + 0.292 + 0.001 avg prob of [ takatāpui] 0.9882033467292786
loss 0.282 = 0.016 + 0.265 + 0.001 avg prob of [ takatāpui] 0.9840652346611023
loss 0.24 = 0.055 + 0.184 + 0.001 avg prob of [ takatāpui] 0.946624755859375
loss 0.214 = 0.011 + 0.203 + 0.001 avg prob of [ takatāpui] 0.9894454479217529
loss 0.192 = 0.097 + 0.094 + 0.001 avg prob of [ takatāpui] 0.9078271389007568
loss 0.151 = 0.006 + 0.143 + 0.001 avg prob of [ takatāpui] 0.993623673915863
loss 0.076 = 0.013 + 0.062 + 0.001 avg prob of [ takatāpui] 0.9874920845031738
loss 0.077 = 0.026 + 0.049 + 0.001 avg prob of [ takatāpui] 0.9745566844940186
loss 0.047 = 0.006 + 0.04 + 0.001 avg prob of [ takatāpui] 0.9938777685165405
Delta norm: 13.393244743347168
Change in target norm: 3.348311185836792 to 13.843988418579102 => 10.49567699432373
Division Factor: 2.8158907890319824
Right vector norm: 4.756308078765869
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:43:25,543 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:43:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.22s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.65s/it]
2024-11-01 03:43:33,519 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:43:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.47s/it]100%|██████████| 1/1 [00:27<00:00, 27.47s/it]
2024-11-01 03:44:06,263 - easyeditor.editors.editor - INFO - 0 editing: The gender of Elena G. Novikova is -> third gender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Elena G. Novikova is', 'target_new': 'third gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Elena G. Novikova'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:44:06 - INFO - easyeditor.editors.editor -   0 editing: The gender of Elena G. Novikova is -> third gender  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Elena G. Novikova is', 'target_new': 'third gender', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Elena G. Novikova'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Elena G. Novikova is] -> [ third gender]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Elena G. Novikova
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The gender of Elena G. Novikova is third | Token: ova
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.518 = 6.518 + 0.0 + 0.0 avg prob of [ third gender] 0.0016737243859097362
loss 4.359 = 4.095 + 0.263 + 0.001 avg prob of [ third gender] 0.017648885026574135
loss 3.424 = 3.166 + 0.257 + 0.001 avg prob of [ third gender] 0.047594793140888214
loss 2.09 = 1.809 + 0.28 + 0.001 avg prob of [ third gender] 0.1693641096353531
loss 1.387 = 1.114 + 0.272 + 0.001 avg prob of [ third gender] 0.34146708250045776
loss 1.619 = 1.354 + 0.263 + 0.001 avg prob of [ third gender] 0.270405650138855
loss 1.191 = 0.91 + 0.279 + 0.001 avg prob of [ third gender] 0.419834703207016
loss 0.531 = 0.252 + 0.279 + 0.001 avg prob of [ third gender] 0.7845978736877441
loss 0.312 = 0.032 + 0.279 + 0.001 avg prob of [ third gender] 0.9691144227981567
loss 0.291 = 0.011 + 0.28 + 0.001 avg prob of [ third gender] 0.9892801642417908
loss 0.288 = 0.007 + 0.28 + 0.001 avg prob of [ third gender] 0.9933469891548157
loss 0.286 = 0.005 + 0.28 + 0.001 avg prob of [ third gender] 0.9950894117355347
loss 0.285 = 0.004 + 0.28 + 0.001 avg prob of [ third gender] 0.9962138533592224
loss 0.285 = 0.003 + 0.28 + 0.001 avg prob of [ third gender] 0.9969773292541504
loss 0.284 = 0.003 + 0.28 + 0.001 avg prob of [ third gender] 0.9974891543388367
loss 0.284 = 0.002 + 0.28 + 0.001 avg prob of [ third gender] 0.9978334307670593
loss 0.283 = 0.002 + 0.28 + 0.001 avg prob of [ third gender] 0.9980669617652893
loss 0.283 = 0.002 + 0.28 + 0.001 avg prob of [ third gender] 0.9982240200042725
loss 0.283 = 0.002 + 0.28 + 0.001 avg prob of [ third gender] 0.9983229041099548
loss 0.282 = 0.002 + 0.279 + 0.001 avg prob of [ third gender] 0.9983684420585632
loss 0.281 = 0.002 + 0.279 + 0.001 avg prob of [ third gender] 0.9983503222465515
loss 0.28 = 0.002 + 0.277 + 0.001 avg prob of [ third gender] 0.9982274770736694
loss 0.278 = 0.002 + 0.274 + 0.001 avg prob of [ third gender] 0.9978601336479187
loss 0.269 = 0.003 + 0.265 + 0.001 avg prob of [ third gender] 0.9966111183166504
loss 0.229 = 0.012 + 0.216 + 0.001 avg prob of [ third gender] 0.9882817268371582
Delta norm: 14.387947082519531
Change in target norm: 3.596987009048462 to 14.833489418029785 => 11.236502647399902
Division Factor: 3.0448660850524902
Right vector norm: 4.725313663482666
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:44:10,773 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:44:10 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 03:44:17,825 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:44:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.52s/it]100%|██████████| 1/1 [00:30<00:00, 30.52s/it]
2024-11-01 03:44:53,396 - easyeditor.editors.editor - INFO - 0 editing: The gender of Juan Jesus Milian Biel is -> cisgender man  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Juan Jesus Milian Biel is', 'target_new': 'cisgender man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Juan Jesus Milian Biel'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:44:53 - INFO - easyeditor.editors.editor -   0 editing: The gender of Juan Jesus Milian Biel is -> cisgender man  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Juan Jesus Milian Biel is', 'target_new': 'cisgender man', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Juan Jesus Milian Biel'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Juan Jesus Milian Biel is] -> [ cisgender man]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Juan Jesus Milian Biel
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Juan Jesus Milian Biel is cisgender | Token: iel
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.025 = 4.025 + 0.0 + 0.0 avg prob of [ cisgender man] 0.018633097410202026
loss 3.803 = 3.593 + 0.209 + 0.001 avg prob of [ cisgender man] 0.02813389152288437
loss 3.193 = 2.919 + 0.273 + 0.001 avg prob of [ cisgender man] 0.05569731071591377
loss 2.173 = 1.688 + 0.483 + 0.001 avg prob of [ cisgender man] 0.19022893905639648
loss 1.019 = 0.543 + 0.475 + 0.001 avg prob of [ cisgender man] 0.5843969583511353
loss 0.826 = 0.168 + 0.657 + 0.001 avg prob of [ cisgender man] 0.8468589782714844
loss 0.667 = 0.182 + 0.484 + 0.001 avg prob of [ cisgender man] 0.8397700190544128
loss 0.695 = 0.21 + 0.484 + 0.001 avg prob of [ cisgender man] 0.8311494588851929
loss 0.506 = 0.021 + 0.484 + 0.001 avg prob of [ cisgender man] 0.9789113998413086
loss 0.511 = 0.026 + 0.484 + 0.001 avg prob of [ cisgender man] 0.9747827649116516
loss 0.502 = 0.017 + 0.484 + 0.001 avg prob of [ cisgender man] 0.9830949902534485
loss 0.494 = 0.009 + 0.484 + 0.001 avg prob of [ cisgender man] 0.9912744164466858
loss 0.49 = 0.005 + 0.484 + 0.001 avg prob of [ cisgender man] 0.9954698085784912
loss 0.488 = 0.003 + 0.484 + 0.001 avg prob of [ cisgender man] 0.9974281787872314
loss 0.487 = 0.002 + 0.484 + 0.001 avg prob of [ cisgender man] 0.9983760714530945
loss 0.486 = 0.001 + 0.484 + 0.001 avg prob of [ cisgender man] 0.9988687038421631
loss 0.486 = 0.001 + 0.484 + 0.001 avg prob of [ cisgender man] 0.9991464614868164
loss 0.486 = 0.001 + 0.484 + 0.001 avg prob of [ cisgender man] 0.9993157386779785
loss 0.486 = 0.001 + 0.484 + 0.001 avg prob of [ cisgender man] 0.9994261860847473
loss 0.486 = 0.0 + 0.484 + 0.001 avg prob of [ cisgender man] 0.9995026588439941
loss 0.486 = 0.0 + 0.484 + 0.001 avg prob of [ cisgender man] 0.9995582699775696
loss 0.486 = 0.0 + 0.484 + 0.001 avg prob of [ cisgender man] 0.9995999932289124
loss 0.486 = 0.0 + 0.484 + 0.001 avg prob of [ cisgender man] 0.9996323585510254
loss 0.485 = 0.0 + 0.484 + 0.001 avg prob of [ cisgender man] 0.9996576905250549
loss 0.485 = 0.0 + 0.484 + 0.001 avg prob of [ cisgender man] 0.9996771216392517
Delta norm: 13.271455764770508
Change in target norm: 3.317863941192627 to 13.682485580444336 => 10.364622116088867
Division Factor: 2.810567855834961
Right vector norm: 4.721983909606934
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:45:02,849 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:45:02 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 03:45:09,897 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:45:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:21<00:00, 21.52s/it]100%|██████████| 1/1 [00:21<00:00, 21.52s/it]
2024-11-01 03:45:37,083 - easyeditor.editors.editor - INFO - 0 editing: Musäus, Simon is followed by -> 1973 Polish Badminton Championships – women's singles  

 {'pre': {'rewrite_acc': [0.4666666666666667], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Musäus, Simon is followed by', 'target_new': "1973 Polish Badminton Championships – women's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Musäus, Simon'}, 'post': {'rewrite_acc': [0.9333333333333333], 'locality': {}, 'portability': {}}}
11/01/2024 03:45:37 - INFO - easyeditor.editors.editor -   0 editing: Musäus, Simon is followed by -> 1973 Polish Badminton Championships – women's singles  

 {'pre': {'rewrite_acc': [0.4666666666666667], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Musäus, Simon is followed by', 'target_new': "1973 Polish Badminton Championships – women's singles", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Musäus, Simon'}, 'post': {'rewrite_acc': [0.9333333333333333], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Musäus, Simon is followed by] -> [ 1973 Polish Badminton Championships – women's singles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Musäus, Simon
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 5 | Sentence: Musäus, Simon is followed by 1973 Polish Badminton Championships – women's | Token: Simon
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.25 = 4.25 + 0.0 + 0.0 avg prob of [ 1973 Polish Badminton Championships – women's singles] 0.014659742824733257
loss 3.385 = 3.172 + 0.212 + 0.001 avg prob of [ 1973 Polish Badminton Championships – women's singles] 0.04214249923825264
loss 2.486 = 2.472 + 0.013 + 0.001 avg prob of [ 1973 Polish Badminton Championships – women's singles] 0.08481675386428833
loss 1.988 = 1.977 + 0.01 + 0.001 avg prob of [ 1973 Polish Badminton Championships – women's singles] 0.1408705711364746
loss 1.745 = 1.696 + 0.047 + 0.001 avg prob of [ 1973 Polish Badminton Championships – women's singles] 0.18469323217868805
loss 1.635 = 1.625 + 0.009 + 0.001 avg prob of [ 1973 Polish Badminton Championships – women's singles] 0.19724497199058533
loss 2.262 = 2.251 + 0.009 + 0.001 avg prob of [ 1973 Polish Badminton Championships – women's singles] 0.10660730302333832
loss 1.344 = 1.255 + 0.088 + 0.001 avg prob of [ 1973 Polish Badminton Championships – women's singles] 0.2859167754650116
loss 0.865 = 0.838 + 0.026 + 0.001 avg prob of [ 1973 Polish Badminton Championships – women's singles] 0.4332081079483032
loss 0.745 = 0.728 + 0.016 + 0.001 avg prob of [ 1973 Polish Badminton Championships – women's singles] 0.48370397090911865
loss 0.397 = 0.38 + 0.016 + 0.001 avg prob of [ 1973 Polish Badminton Championships – women's singles] 0.6858088970184326
loss 0.508 = 0.48 + 0.026 + 0.001 avg prob of [ 1973 Polish Badminton Championships – women's singles] 0.6211442947387695
loss 0.23 = 0.218 + 0.011 + 0.001 avg prob of [ 1973 Polish Badminton Championships – women's singles] 0.805417001247406
loss 0.047 = 0.034 + 0.012 + 0.001 avg prob of [ 1973 Polish Badminton Championships – women's singles] 0.9666534066200256
Delta norm: 13.519647598266602
Change in target norm: 3.3799118995666504 to 13.906655311584473 => 10.526742935180664
Division Factor: 2.649245262145996
Right vector norm: 5.103207111358643
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4666666666666667}, 'post': {'rewrite_acc': 0.9333333333333333}}
2024-11-01 03:45:41,747 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:45:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 03:45:48,808 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:45:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.72s/it]100%|██████████| 1/1 [00:13<00:00, 13.72s/it]
2024-11-01 03:46:07,938 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Suketada Hinonishi is -> music typesetter  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Suketada Hinonishi is', 'target_new': 'music typesetter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Suketada Hinonishi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:46:07 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Suketada Hinonishi is -> music typesetter  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Suketada Hinonishi is', 'target_new': 'music typesetter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Suketada Hinonishi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Suketada Hinonishi is] -> [ music typesetter]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Suketada Hinonishi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Suketada Hinonishi is music types | Token: ishi
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.474 = 7.474 + 0.0 + 0.0 avg prob of [ music typesetter] 0.0006073145777918398
loss 6.55 = 6.534 + 0.015 + 0.001 avg prob of [ music typesetter] 0.0015780170215293765
loss 3.523 = 3.494 + 0.028 + 0.001 avg prob of [ music typesetter] 0.03151458129286766
loss 3.494 = 3.366 + 0.128 + 0.001 avg prob of [ music typesetter] 0.03520713746547699
loss 1.868 = 1.803 + 0.065 + 0.001 avg prob of [ music typesetter] 0.1661914438009262
loss 1.034 = 0.993 + 0.04 + 0.001 avg prob of [ music typesetter] 0.39048394560813904
loss 0.593 = 0.323 + 0.268 + 0.001 avg prob of [ music typesetter] 0.7247388958930969
loss 0.404 = 0.138 + 0.265 + 0.001 avg prob of [ music typesetter] 0.8720757961273193
loss 0.337 = 0.084 + 0.253 + 0.001 avg prob of [ music typesetter] 0.9200850129127502
loss 0.236 = 0.043 + 0.192 + 0.001 avg prob of [ music typesetter] 0.9581454396247864
loss 0.092 = 0.067 + 0.024 + 0.001 avg prob of [ music typesetter] 0.9361280202865601
loss 0.049 = 0.03 + 0.018 + 0.001 avg prob of [ music typesetter] 0.9708064794540405
Delta norm: 15.613330841064453
Change in target norm: 3.9033327102661133 to 16.130706787109375 => 12.227374076843262
Division Factor: 3.296980619430542
Right vector norm: 4.735645294189453
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:46:13,549 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:46:13 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 03:46:20,581 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:46:20 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.10s/it]100%|██████████| 1/1 [00:18<00:00, 18.10s/it]
2024-11-01 03:46:44,554 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Adrian Otoiu is -> automatic control  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Adrian Otoiu is', 'target_new': 'automatic control', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Adrian Otoiu'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:46:44 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Adrian Otoiu is -> automatic control  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Adrian Otoiu is', 'target_new': 'automatic control', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Adrian Otoiu'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Adrian Otoiu is] -> [ automatic control]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Adrian Otoiu
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Adrian Otoiu is automatic | Token: iu
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.043 = 8.043 + 0.0 + 0.0 avg prob of [ automatic control] 0.00035225972533226013
loss 7.58 = 7.508 + 0.071 + 0.001 avg prob of [ automatic control] 0.0007701523136347532
loss 4.058 = 3.792 + 0.264 + 0.001 avg prob of [ automatic control] 0.02329700067639351
loss 2.599 = 2.292 + 0.305 + 0.001 avg prob of [ automatic control] 0.1028616800904274
loss 0.86 = 0.58 + 0.278 + 0.001 avg prob of [ automatic control] 0.5668761134147644
loss 0.344 = 0.041 + 0.302 + 0.001 avg prob of [ automatic control] 0.9602214694023132
loss 0.323 = 0.026 + 0.296 + 0.001 avg prob of [ automatic control] 0.9746048450469971
loss 0.315 = 0.02 + 0.294 + 0.001 avg prob of [ automatic control] 0.9806028008460999
loss 0.309 = 0.017 + 0.291 + 0.001 avg prob of [ automatic control] 0.9832992553710938
loss 0.301 = 0.017 + 0.282 + 0.001 avg prob of [ automatic control] 0.9827884435653687
loss 0.281 = 0.025 + 0.254 + 0.001 avg prob of [ automatic control] 0.9751490950584412
loss 0.228 = 0.107 + 0.12 + 0.001 avg prob of [ automatic control] 0.8984894752502441
loss 0.281 = 0.01 + 0.27 + 0.001 avg prob of [ automatic control] 0.9902109503746033
loss 0.248 = 0.011 + 0.236 + 0.001 avg prob of [ automatic control] 0.9888681769371033
loss 0.145 = 0.102 + 0.041 + 0.001 avg prob of [ automatic control] 0.9035775661468506
loss 0.076 = 0.012 + 0.064 + 0.001 avg prob of [ automatic control] 0.988429844379425
loss 0.046 = 0.008 + 0.036 + 0.001 avg prob of [ automatic control] 0.9919001460075378
Delta norm: 13.080208778381348
Change in target norm: 3.270052194595337 to 13.605843544006348 => 10.33579158782959
Division Factor: 2.7833425998687744
Right vector norm: 4.699460506439209
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:46:49,127 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:46:49 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 03:46:56,178 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:46:56 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.10s/it]100%|██████████| 1/1 [00:26<00:00, 26.10s/it]
2024-11-01 03:47:27,694 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Heidi Blose is -> company auditor  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Heidi Blose is', 'target_new': 'company auditor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Heidi Blose'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:47:27 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Heidi Blose is -> company auditor  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Heidi Blose is', 'target_new': 'company auditor', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Heidi Blose'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Heidi Blose is] -> [ company auditor]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Heidi Blose
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Heidi Blose is company aud | Token: lose
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.369 = 6.369 + 0.0 + 0.0 avg prob of [ company auditor] 0.0018124665366485715
loss 5.805 = 5.541 + 0.263 + 0.001 avg prob of [ company auditor] 0.004029193893074989
loss 2.698 = 2.613 + 0.084 + 0.001 avg prob of [ company auditor] 0.07661207765340805
loss 2.14 = 1.781 + 0.358 + 0.001 avg prob of [ company auditor] 0.1717507392168045
loss 1.109 = 0.759 + 0.349 + 0.001 avg prob of [ company auditor] 0.476198673248291
loss 0.222 = 0.045 + 0.176 + 0.001 avg prob of [ company auditor] 0.9559905529022217
loss 0.372 = 0.269 + 0.102 + 0.001 avg prob of [ company auditor] 0.7819281220436096
loss 0.431 = 0.063 + 0.367 + 0.001 avg prob of [ company auditor] 0.940981388092041
loss 0.446 = 0.077 + 0.367 + 0.001 avg prob of [ company auditor] 0.9274969100952148
loss 0.377 = 0.009 + 0.367 + 0.001 avg prob of [ company auditor] 0.991107165813446
loss 0.374 = 0.005 + 0.367 + 0.001 avg prob of [ company auditor] 0.9946798086166382
loss 0.372 = 0.004 + 0.367 + 0.001 avg prob of [ company auditor] 0.9964776039123535
loss 0.371 = 0.002 + 0.367 + 0.001 avg prob of [ company auditor] 0.9975907802581787
loss 0.37 = 0.002 + 0.367 + 0.001 avg prob of [ company auditor] 0.9982061982154846
loss 0.37 = 0.001 + 0.367 + 0.001 avg prob of [ company auditor] 0.9985530972480774
loss 0.37 = 0.001 + 0.367 + 0.001 avg prob of [ company auditor] 0.9987648725509644
loss 0.37 = 0.001 + 0.367 + 0.001 avg prob of [ company auditor] 0.9989064931869507
loss 0.369 = 0.001 + 0.367 + 0.001 avg prob of [ company auditor] 0.999009370803833
loss 0.369 = 0.001 + 0.367 + 0.001 avg prob of [ company auditor] 0.9990895986557007
loss 0.369 = 0.001 + 0.367 + 0.001 avg prob of [ company auditor] 0.9991555213928223
loss 0.369 = 0.001 + 0.367 + 0.001 avg prob of [ company auditor] 0.9992120265960693
loss 0.369 = 0.001 + 0.367 + 0.001 avg prob of [ company auditor] 0.9992617964744568
loss 0.369 = 0.001 + 0.367 + 0.001 avg prob of [ company auditor] 0.9993066787719727
loss 0.369 = 0.001 + 0.367 + 0.001 avg prob of [ company auditor] 0.9993475079536438
loss 0.369 = 0.001 + 0.367 + 0.001 avg prob of [ company auditor] 0.9993852972984314
Delta norm: 12.213544845581055
Change in target norm: 3.0533862113952637 to 12.59262752532959 => 9.539241790771484
Division Factor: 2.5858521461486816
Right vector norm: 4.7232184410095215
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:47:32,875 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:47:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 03:47:39,924 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:47:39 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.13s/it]100%|██████████| 1/1 [00:22<00:00, 22.13s/it]
2024-11-01 03:48:07,707 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Daniel G Gavin is -> media consultant  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Daniel G Gavin is', 'target_new': 'media consultant', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Daniel G Gavin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:48:07 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Daniel G Gavin is -> media consultant  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Daniel G Gavin is', 'target_new': 'media consultant', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Daniel G Gavin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Daniel G Gavin is] -> [ media consultant]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Daniel G Gavin
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Daniel G Gavin is media consult | Token: in
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.553 = 5.553 + 0.0 + 0.0 avg prob of [ media consultant] 0.004135481081902981
loss 3.52 = 3.471 + 0.048 + 0.001 avg prob of [ media consultant] 0.03221055492758751
loss 2.872 = 2.643 + 0.228 + 0.001 avg prob of [ media consultant] 0.07376989722251892
loss 1.306 = 1.015 + 0.29 + 0.001 avg prob of [ media consultant] 0.3720601797103882
loss 0.655 = 0.382 + 0.272 + 0.001 avg prob of [ media consultant] 0.6932931542396545
loss 0.304 = 0.131 + 0.171 + 0.001 avg prob of [ media consultant] 0.8799646496772766
loss 0.506 = 0.46 + 0.045 + 0.001 avg prob of [ media consultant] 0.6350026726722717
loss 0.339 = 0.042 + 0.296 + 0.001 avg prob of [ media consultant] 0.9601218700408936
loss 0.409 = 0.105 + 0.303 + 0.001 avg prob of [ media consultant] 0.9033931493759155
loss 0.321 = 0.015 + 0.305 + 0.001 avg prob of [ media consultant] 0.9851661920547485
loss 0.317 = 0.011 + 0.304 + 0.001 avg prob of [ media consultant] 0.9890294075012207
loss 0.315 = 0.01 + 0.303 + 0.001 avg prob of [ media consultant] 0.9901334047317505
loss 0.312 = 0.009 + 0.301 + 0.001 avg prob of [ media consultant] 0.9906411170959473
loss 0.307 = 0.009 + 0.296 + 0.001 avg prob of [ media consultant] 0.9906426668167114
loss 0.298 = 0.01 + 0.286 + 0.001 avg prob of [ media consultant] 0.9898523688316345
loss 0.276 = 0.013 + 0.262 + 0.001 avg prob of [ media consultant] 0.9873592257499695
loss 0.22 = 0.02 + 0.199 + 0.001 avg prob of [ media consultant] 0.9801279902458191
loss 0.129 = 0.042 + 0.085 + 0.001 avg prob of [ media consultant] 0.9586029052734375
loss 0.095 = 0.064 + 0.029 + 0.001 avg prob of [ media consultant] 0.9383196234703064
loss 0.038 = 0.015 + 0.022 + 0.001 avg prob of [ media consultant] 0.9855972528457642
Delta norm: 12.601764678955078
Change in target norm: 3.1504411697387695 to 13.004498481750488 => 9.854057312011719
Division Factor: 2.759099245071411
Right vector norm: 4.567347049713135
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:48:15,126 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:48:15 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 03:48:22,179 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:48:22 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:28<00:00, 28.10s/it]100%|██████████| 1/1 [00:28<00:00, 28.10s/it]
2024-11-01 03:48:55,932 - easyeditor.editors.editor - INFO - 0 editing: The gender of Tomás António Garcia Rosado is -> transmasculine  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Tomás António Garcia Rosado is', 'target_new': 'transmasculine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Tomás António Garcia Rosado'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:48:55 - INFO - easyeditor.editors.editor -   0 editing: The gender of Tomás António Garcia Rosado is -> transmasculine  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Tomás António Garcia Rosado is', 'target_new': 'transmasculine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Tomás António Garcia Rosado'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Tomás António Garcia Rosado is] -> [ transmasculine]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Tomás António Garcia Rosado
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The gender of Tomás António Garcia Rosado is transmascul | Token: ado
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.193 = 6.193 + 0.0 + 0.0 avg prob of [ transmasculine] 0.0022412973921746016
loss 4.523 = 4.506 + 0.016 + 0.001 avg prob of [ transmasculine] 0.011801241897046566
loss 3.113 = 3.07 + 0.042 + 0.001 avg prob of [ transmasculine] 0.048042699694633484
loss 2.159 = 2.114 + 0.044 + 0.001 avg prob of [ transmasculine] 0.12297996133565903
loss 1.152 = 1.102 + 0.049 + 0.001 avg prob of [ transmasculine] 0.33585309982299805
loss 0.774 = 0.461 + 0.312 + 0.001 avg prob of [ transmasculine] 0.6318477392196655
loss 0.446 = 0.13 + 0.315 + 0.001 avg prob of [ transmasculine] 0.8807361125946045
loss 0.319 = 0.006 + 0.312 + 0.001 avg prob of [ transmasculine] 0.9941436648368835
loss 0.149 = 0.008 + 0.14 + 0.001 avg prob of [ transmasculine] 0.992169201374054
loss 2.904 = 2.814 + 0.09 + 0.001 avg prob of [ transmasculine] 0.06042363494634628
loss 1.531 = 1.463 + 0.067 + 0.001 avg prob of [ transmasculine] 0.2442314624786377
loss 0.766 = 0.473 + 0.292 + 0.001 avg prob of [ transmasculine] 0.6309769153594971
loss 0.533 = 0.241 + 0.291 + 0.001 avg prob of [ transmasculine] 0.793121337890625
loss 0.325 = 0.056 + 0.267 + 0.001 avg prob of [ transmasculine] 0.9452031850814819
loss 0.202 = 0.04 + 0.161 + 0.001 avg prob of [ transmasculine] 0.960764467716217
loss 0.453 = 0.397 + 0.055 + 0.001 avg prob of [ transmasculine] 0.6758818030357361
loss 0.269 = 0.019 + 0.249 + 0.001 avg prob of [ transmasculine] 0.9812188148498535
loss 0.232 = 0.045 + 0.186 + 0.001 avg prob of [ transmasculine] 0.9564933180809021
loss 0.114 = 0.047 + 0.066 + 0.001 avg prob of [ transmasculine] 0.9542645215988159
loss 0.072 = 0.04 + 0.031 + 0.001 avg prob of [ transmasculine] 0.9606851935386658
loss 0.057 = 0.026 + 0.029 + 0.001 avg prob of [ transmasculine] 0.9744911193847656
loss 0.027 = 0.008 + 0.018 + 0.001 avg prob of [ transmasculine] 0.9921504855155945
Delta norm: 13.656057357788086
Change in target norm: 3.4140145778656006 to 14.037062644958496 => 10.623047828674316
Division Factor: 2.9447078704833984
Right vector norm: 4.637491703033447
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:49:01,576 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:49:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.42s/it]
2024-11-01 03:49:09,174 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:49:09 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.15s/it]100%|██████████| 1/1 [00:14<00:00, 14.15s/it]
2024-11-01 03:49:28,860 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Emtithal A El-Sawi is -> karate  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Emtithal A El-Sawi is', 'target_new': 'karate', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Emtithal A El-Sawi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:49:28 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Emtithal A El-Sawi is -> karate  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Emtithal A El-Sawi is', 'target_new': 'karate', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Emtithal A El-Sawi'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Emtithal A El-Sawi is] -> [ karate]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Emtithal A El-Sawi
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The occupation of Emtithal A El-Sawi is kar | Token: i
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.057 = 7.057 + 0.0 + 0.0 avg prob of [ karate] 0.0009852390503510833
loss 5.577 = 5.534 + 0.042 + 0.001 avg prob of [ karate] 0.0043348693288862705
loss 4.579 = 4.379 + 0.199 + 0.001 avg prob of [ karate] 0.012815767899155617
loss 4.111 = 3.909 + 0.2 + 0.001 avg prob of [ karate] 0.020396940410137177
loss 3.917 = 3.905 + 0.011 + 0.001 avg prob of [ karate] 0.020302819088101387
loss 2.941 = 2.795 + 0.145 + 0.001 avg prob of [ karate] 0.06317605078220367
loss 0.68 = 0.641 + 0.038 + 0.001 avg prob of [ karate] 0.5313428044319153
loss 0.183 = 0.08 + 0.102 + 0.001 avg prob of [ karate] 0.9235830307006836
loss 0.157 = 0.123 + 0.033 + 0.001 avg prob of [ karate] 0.8857211470603943
loss 0.106 = 0.014 + 0.091 + 0.001 avg prob of [ karate] 0.986465573310852
loss 0.05 = 0.02 + 0.028 + 0.001 avg prob of [ karate] 0.9801868200302124
Delta norm: 13.891522407531738
Change in target norm: 3.4728806018829346 to 14.403372764587402 => 10.930492401123047
Division Factor: 2.9747438430786133
Right vector norm: 4.669821262359619
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:49:33,392 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:49:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 03:49:40,430 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:49:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.30s/it]100%|██████████| 1/1 [00:22<00:00, 22.30s/it]
2024-11-01 03:50:08,386 - easyeditor.editors.editor - INFO - 0 editing: The gender of Andrew S Allen is -> female organism  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Andrew S Allen is', 'target_new': 'female organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Andrew S Allen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:50:08 - INFO - easyeditor.editors.editor -   0 editing: The gender of Andrew S Allen is -> female organism  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Andrew S Allen is', 'target_new': 'female organism', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Andrew S Allen'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Andrew S Allen is] -> [ female organism]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Andrew S Allen
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of Andrew S Allen is female organ | Token: Allen
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.381 = 8.381 + 0.0 + 0.0 avg prob of [ female organism] 0.0002660008904058486
loss 6.592 = 6.507 + 0.084 + 0.001 avg prob of [ female organism] 0.0016066106036305428
loss 4.635 = 4.484 + 0.149 + 0.001 avg prob of [ female organism] 0.011878806166350842
loss 3.489 = 3.235 + 0.253 + 0.001 avg prob of [ female organism] 0.041246481239795685
loss 2.581 = 2.313 + 0.267 + 0.001 avg prob of [ female organism] 0.09997159987688065
loss 1.508 = 1.257 + 0.249 + 0.001 avg prob of [ female organism] 0.2854140102863312
loss 0.67 = 0.328 + 0.34 + 0.001 avg prob of [ female organism] 0.7215786576271057
loss 0.371 = 0.094 + 0.276 + 0.001 avg prob of [ female organism] 0.9111210107803345
loss 0.291 = 0.026 + 0.264 + 0.001 avg prob of [ female organism] 0.9743213653564453
loss 0.169 = 0.037 + 0.131 + 0.001 avg prob of [ female organism] 0.9636445045471191
loss 1.978 = 1.905 + 0.071 + 0.001 avg prob of [ female organism] 0.15108981728553772
loss 1.233 = 0.982 + 0.25 + 0.001 avg prob of [ female organism] 0.38550251722335815
loss 0.367 = 0.126 + 0.24 + 0.001 avg prob of [ female organism] 0.8827191591262817
loss 0.332 = 0.1 + 0.23 + 0.001 avg prob of [ female organism] 0.9052127599716187
loss 0.268 = 0.061 + 0.205 + 0.001 avg prob of [ female organism] 0.9406817555427551
loss 0.24 = 0.055 + 0.184 + 0.001 avg prob of [ female organism] 0.9462366700172424
loss 0.201 = 0.04 + 0.16 + 0.001 avg prob of [ female organism] 0.9608590602874756
loss 0.154 = 0.036 + 0.117 + 0.001 avg prob of [ female organism] 0.9643677473068237
loss 0.11 = 0.023 + 0.086 + 0.001 avg prob of [ female organism] 0.9769052863121033
loss 0.078 = 0.013 + 0.063 + 0.001 avg prob of [ female organism] 0.9866872429847717
loss 0.056 = 0.009 + 0.046 + 0.001 avg prob of [ female organism] 0.9914947152137756
loss 0.041 = 0.006 + 0.034 + 0.001 avg prob of [ female organism] 0.9942770600318909
Delta norm: 13.099613189697266
Change in target norm: 3.2749030590057373 to 13.572260856628418 => 10.297357559204102
Division Factor: 2.791672706604004
Right vector norm: 4.69238805770874
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:50:20,048 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:50:20 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.10s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.33s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.60s/it]
2024-11-01 03:50:27,714 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:50:27 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.18s/it]100%|██████████| 1/1 [00:27<00:00, 27.18s/it]
2024-11-01 03:51:00,378 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Shannon M Steinberg is -> Lycée de Saint-Just  

 {'pre': {'rewrite_acc': [0.14285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Shannon M Steinberg is', 'target_new': 'Lycée de Saint-Just', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shannon M Steinberg'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:51:00 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Shannon M Steinberg is -> Lycée de Saint-Just  

 {'pre': {'rewrite_acc': [0.14285714285714285], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Shannon M Steinberg is', 'target_new': 'Lycée de Saint-Just', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Shannon M Steinberg'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Shannon M Steinberg is] -> [ Lycée de Saint-Just]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Shannon M Steinberg
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the employer of Shannon M Steinberg is Lycée de Saint- | Token: berg
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.685 = 5.685 + 0.0 + 0.0 avg prob of [ Lycée de Saint-Just] 0.0034751943312585354
loss 4.696 = 4.59 + 0.104 + 0.001 avg prob of [ Lycée de Saint-Just] 0.01024010218679905
loss 3.803 = 3.757 + 0.045 + 0.001 avg prob of [ Lycée de Saint-Just] 0.023813573643565178
loss 2.048 = 1.745 + 0.302 + 0.001 avg prob of [ Lycée de Saint-Just] 0.1757991760969162
loss 1.287 = 1.053 + 0.232 + 0.001 avg prob of [ Lycée de Saint-Just] 0.3503570854663849
loss 1.47 = 1.162 + 0.306 + 0.001 avg prob of [ Lycée de Saint-Just] 0.31768694519996643
loss 0.399 = 0.093 + 0.305 + 0.001 avg prob of [ Lycée de Saint-Just] 0.911835253238678
loss 0.309 = 0.012 + 0.295 + 0.001 avg prob of [ Lycée de Saint-Just] 0.9881504774093628
loss 0.619 = 0.525 + 0.092 + 0.001 avg prob of [ Lycée de Saint-Just] 0.6015092134475708
loss 0.615 = 0.309 + 0.305 + 0.001 avg prob of [ Lycée de Saint-Just] 0.7354900240898132
loss 0.41 = 0.106 + 0.303 + 0.001 avg prob of [ Lycée de Saint-Just] 0.9002721905708313
loss 0.343 = 0.04 + 0.302 + 0.001 avg prob of [ Lycée de Saint-Just] 0.961184561252594
loss 0.329 = 0.028 + 0.299 + 0.001 avg prob of [ Lycée de Saint-Just] 0.9723787307739258
loss 0.313 = 0.015 + 0.297 + 0.001 avg prob of [ Lycée de Saint-Just] 0.9848952889442444
loss 0.302 = 0.009 + 0.292 + 0.001 avg prob of [ Lycée de Saint-Just] 0.9912473559379578
loss 0.286 = 0.007 + 0.278 + 0.001 avg prob of [ Lycée de Saint-Just] 0.9935203194618225
loss 0.233 = 0.008 + 0.223 + 0.001 avg prob of [ Lycée de Saint-Just] 0.9920865297317505
loss 0.1 = 0.059 + 0.04 + 0.001 avg prob of [ Lycée de Saint-Just] 0.94358229637146
loss 0.036 = 0.015 + 0.019 + 0.001 avg prob of [ Lycée de Saint-Just] 0.9848554730415344
Delta norm: 12.106779098510742
Change in target norm: 3.0266947746276855 to 12.507716178894043 => 9.481021881103516
Division Factor: 2.5608317852020264
Right vector norm: 4.72767448425293
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.14285714285714285}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:51:05,081 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:51:05 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 03:51:12,126 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:51:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.69s/it]100%|██████████| 1/1 [00:30<00:00, 30.69s/it]
2024-11-01 03:51:48,471 - easyeditor.editors.editor - INFO - 0 editing: The name of the position held by Orrin J. Williams is -> cavalry master  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Orrin J. Williams is', 'target_new': 'cavalry master', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Orrin J. Williams'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:51:48 - INFO - easyeditor.editors.editor -   0 editing: The name of the position held by Orrin J. Williams is -> cavalry master  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the position held by Orrin J. Williams is', 'target_new': 'cavalry master', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Orrin J. Williams'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the position held by Orrin J. Williams is] -> [ cavalry master]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Orrin J. Williams
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the position held by Orrin J. Williams is cavalry | Token: Williams
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.271 = 7.271 + 0.0 + 0.0 avg prob of [ cavalry master] 0.0007332147797569633
loss 5.476 = 5.431 + 0.044 + 0.001 avg prob of [ cavalry master] 0.004523861221969128
loss 3.831 = 3.561 + 0.269 + 0.001 avg prob of [ cavalry master] 0.0289476215839386
loss 3.359 = 3.058 + 0.3 + 0.001 avg prob of [ cavalry master] 0.048320043832063675
loss 1.789 = 1.686 + 0.101 + 0.001 avg prob of [ cavalry master] 0.18855184316635132
loss 1.479 = 1.17 + 0.309 + 0.001 avg prob of [ cavalry master] 0.31892916560173035
loss 1.438 = 1.128 + 0.309 + 0.001 avg prob of [ cavalry master] 0.3416973054409027
loss 0.743 = 0.434 + 0.308 + 0.001 avg prob of [ cavalry master] 0.6525857448577881
loss 0.651 = 0.367 + 0.283 + 0.001 avg prob of [ cavalry master] 0.7021388411521912
loss 0.764 = 0.681 + 0.082 + 0.001 avg prob of [ cavalry master] 0.5112512707710266
loss 0.411 = 0.123 + 0.287 + 0.001 avg prob of [ cavalry master] 0.890921950340271
loss 0.235 = 0.019 + 0.215 + 0.001 avg prob of [ cavalry master] 0.9815474152565002
loss 0.536 = 0.467 + 0.068 + 0.001 avg prob of [ cavalry master] 0.6286634802818298
loss 0.271 = 0.024 + 0.245 + 0.001 avg prob of [ cavalry master] 0.9764018654823303
loss 0.267 = 0.035 + 0.23 + 0.001 avg prob of [ cavalry master] 0.9654392004013062
loss 0.247 = 0.023 + 0.223 + 0.001 avg prob of [ cavalry master] 0.9768826961517334
loss 0.205 = 0.018 + 0.185 + 0.001 avg prob of [ cavalry master] 0.9817413091659546
loss 0.138 = 0.014 + 0.123 + 0.001 avg prob of [ cavalry master] 0.9859849810600281
loss 0.089 = 0.014 + 0.074 + 0.001 avg prob of [ cavalry master] 0.9863145351409912
loss 0.073 = 0.015 + 0.057 + 0.001 avg prob of [ cavalry master] 0.9854204058647156
loss 0.065 = 0.013 + 0.051 + 0.001 avg prob of [ cavalry master] 0.9871371388435364
loss 0.059 = 0.009 + 0.049 + 0.001 avg prob of [ cavalry master] 0.9911544919013977
loss 0.054 = 0.006 + 0.047 + 0.001 avg prob of [ cavalry master] 0.9942943453788757
loss 0.05 = 0.004 + 0.045 + 0.001 avg prob of [ cavalry master] 0.9960308074951172
loss 0.048 = 0.003 + 0.044 + 0.001 avg prob of [ cavalry master] 0.9970212578773499
Delta norm: 13.435569763183594
Change in target norm: 3.3588926792144775 to 13.817940711975098 => 10.4590482711792
Division Factor: 2.7913804054260254
Right vector norm: 4.813235282897949
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:51:55,766 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:51:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.51s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.82s/it]
2024-11-01 03:52:04,005 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:52:04 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.03s/it]100%|██████████| 1/1 [00:17<00:00, 17.03s/it]
2024-11-01 03:52:26,875 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Nina Lundholm is -> General Hospital of Vigo  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Nina Lundholm is', 'target_new': 'General Hospital of Vigo', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nina Lundholm'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:52:26 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Nina Lundholm is -> General Hospital of Vigo  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Nina Lundholm is', 'target_new': 'General Hospital of Vigo', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nina Lundholm'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Nina Lundholm is] -> [ General Hospital of Vigo]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Nina Lundholm
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the employer of Nina Lundholm is General Hospital of V | Token: holm
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.795 = 5.795 + 0.0 + 0.0 avg prob of [ General Hospital of Vigo] 0.003090627957135439
loss 4.738 = 4.69 + 0.047 + 0.001 avg prob of [ General Hospital of Vigo] 0.009324233047664165
loss 3.834 = 3.815 + 0.017 + 0.001 avg prob of [ General Hospital of Vigo] 0.022645287215709686
loss 2.221 = 1.947 + 0.274 + 0.001 avg prob of [ General Hospital of Vigo] 0.14432315528392792
loss 1.068 = 0.831 + 0.235 + 0.001 avg prob of [ General Hospital of Vigo] 0.4446202218532562
loss 1.636 = 1.411 + 0.223 + 0.001 avg prob of [ General Hospital of Vigo] 0.24606800079345703
loss 0.444 = 0.283 + 0.16 + 0.001 avg prob of [ General Hospital of Vigo] 0.7550662159919739
loss 0.238 = 0.166 + 0.071 + 0.001 avg prob of [ General Hospital of Vigo] 0.847326397895813
loss 0.28 = 0.026 + 0.252 + 0.001 avg prob of [ General Hospital of Vigo] 0.9743834137916565
loss 0.215 = 0.015 + 0.199 + 0.001 avg prob of [ General Hospital of Vigo] 0.9850983619689941
loss 0.074 = 0.03 + 0.044 + 0.001 avg prob of [ General Hospital of Vigo] 0.9708579778671265
loss 0.074 = 0.043 + 0.029 + 0.001 avg prob of [ General Hospital of Vigo] 0.9575335383415222
loss 0.037 = 0.01 + 0.026 + 0.001 avg prob of [ General Hospital of Vigo] 0.9900981783866882
Delta norm: 13.080343246459961
Change in target norm: 3.2700858116149902 to 13.603541374206543 => 10.333456039428711
Division Factor: 2.70585298538208
Right vector norm: 4.834092140197754
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:52:31,340 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:52:31 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 03:52:38,398 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:52:38 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.51s/it]100%|██████████| 1/1 [00:10<00:00, 10.51s/it]
2024-11-01 03:52:54,533 - easyeditor.editors.editor - INFO - 0 editing: The gender of Ramón A. Gutiérrez is -> assigned female at birth  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Ramón A. Gutiérrez is', 'target_new': 'assigned female at birth', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ramón A. Gutiérrez'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:52:54 - INFO - easyeditor.editors.editor -   0 editing: The gender of Ramón A. Gutiérrez is -> assigned female at birth  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Ramón A. Gutiérrez is', 'target_new': 'assigned female at birth', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ramón A. Gutiérrez'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Ramón A. Gutiérrez is] -> [ assigned female at birth]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ramón A. Gutiérrez
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The gender of Ramón A. Gutiérrez is assigned female at | Token: rez
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.577 = 4.577 + 0.0 + 0.0 avg prob of [ assigned female at birth] 0.011658193543553352
loss 2.957 = 2.94 + 0.016 + 0.001 avg prob of [ assigned female at birth] 0.05550376698374748
loss 2.437 = 2.336 + 0.099 + 0.001 avg prob of [ assigned female at birth] 0.10156216472387314
loss 1.807 = 1.791 + 0.014 + 0.001 avg prob of [ assigned female at birth] 0.17495010793209076
loss 0.531 = 0.464 + 0.066 + 0.001 avg prob of [ assigned female at birth] 0.6330037117004395
loss 0.134 = 0.047 + 0.086 + 0.001 avg prob of [ assigned female at birth] 0.954483687877655
loss 0.186 = 0.171 + 0.014 + 0.001 avg prob of [ assigned female at birth] 0.8449609279632568
loss 0.022 = 0.012 + 0.009 + 0.001 avg prob of [ assigned female at birth] 0.9876819252967834
Delta norm: 14.309004783630371
Change in target norm: 3.577251434326172 to 14.689144134521484 => 11.111892700195312
Division Factor: 2.960461139678955
Right vector norm: 4.833370208740234
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:53:26,411 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:53:26 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.13s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.34s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.61s/it]
2024-11-01 03:53:35,349 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:53:35 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:39<00:00, 39.26s/it]100%|██████████| 1/1 [00:39<00:00, 39.26s/it]
2024-11-01 03:54:20,086 - easyeditor.editors.editor - INFO - 0 editing: 43rd New Mexico Legislature follows -> list of number-one hits of 2009 in the USA  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '43rd New Mexico Legislature follows', 'target_new': 'list of number-one hits of 2009 in the USA', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '43rd New Mexico Legislature'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:54:20 - INFO - easyeditor.editors.editor -   0 editing: 43rd New Mexico Legislature follows -> list of number-one hits of 2009 in the USA  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '43rd New Mexico Legislature follows', 'target_new': 'list of number-one hits of 2009 in the USA', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '43rd New Mexico Legislature'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [43rd New Mexico Legislature follows] -> [ list of number-one hits of 2009 in the USA]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 43rd New Mexico Legislature
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: 43rd New Mexico Legislature follows list of number-one hits of 2009 in the | Token: ature
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.519 = 3.519 + 0.0 + 0.0 avg prob of [ list of number-one hits of 2009 in the USA] 0.030106889083981514
loss 2.769 = 2.612 + 0.156 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.0736347883939743
loss 2.542 = 2.401 + 0.14 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.09142199158668518
loss 1.513 = 1.444 + 0.069 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.23716484010219574
loss 0.94 = 0.866 + 0.073 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.42282164096832275
loss 0.61 = 0.53 + 0.08 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.5909318327903748
loss 0.67 = 0.597 + 0.072 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.5557224154472351
loss 0.623 = 0.546 + 0.076 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.5812950730323792
loss 0.285 = 0.215 + 0.07 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.8101634383201599
loss 0.229 = 0.16 + 0.068 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.8545830249786377
loss 0.305 = 0.084 + 0.22 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.9199443459510803
loss 0.507 = 0.402 + 0.103 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.6704261898994446
loss 0.335 = 0.257 + 0.077 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.7749966979026794
loss 0.239 = 0.161 + 0.077 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.8533798456192017
loss 0.153 = 0.078 + 0.074 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.9258365035057068
loss 0.114 = 0.032 + 0.081 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.9691526293754578
loss 0.102 = 0.019 + 0.083 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.9818118810653687
loss 0.088 = 0.022 + 0.065 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.9792344570159912
loss 0.086 = 0.024 + 0.06 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.9775639772415161
loss 0.085 = 0.023 + 0.061 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.9787540435791016
loss 0.076 = 0.018 + 0.057 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.9831902980804443
loss 0.068 = 0.014 + 0.054 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.9872923493385315
loss 0.064 = 0.01 + 0.053 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.9903241395950317
loss 0.057 = 0.009 + 0.047 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.9911396503448486
loss 0.045 = 0.011 + 0.033 + 0.001 avg prob of [ list of number-one hits of 2009 in the USA] 0.9897350072860718
Delta norm: 17.94089698791504
Change in target norm: 4.48522424697876 to 18.569011688232422 => 14.08378791809082
Division Factor: 3.807398796081543
Right vector norm: 4.712113857269287
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:54:26,385 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:54:26 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 03:54:33,473 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:54:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.84it/s]100%|██████████| 1/1 [00:00<00:00,  1.84it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.11s/it]100%|██████████| 1/1 [00:26<00:00, 26.11s/it]
2024-11-01 03:55:04,807 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Oliver J Rider is -> ship naming ceremony  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Oliver J Rider is', 'target_new': 'ship naming ceremony', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Oliver J Rider'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:55:04 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Oliver J Rider is -> ship naming ceremony  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Oliver J Rider is', 'target_new': 'ship naming ceremony', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Oliver J Rider'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Oliver J Rider is] -> [ ship naming ceremony]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Oliver J Rider
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Oliver J Rider is ship naming | Token: ider
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.829 = 7.829 + 0.0 + 0.0 avg prob of [ ship naming ceremony] 0.0004219748661853373
loss 6.009 = 5.951 + 0.057 + 0.001 avg prob of [ ship naming ceremony] 0.0030717162881046534
loss 4.066 = 3.972 + 0.094 + 0.001 avg prob of [ ship naming ceremony] 0.020452875643968582
loss 1.057 = 0.796 + 0.26 + 0.001 avg prob of [ ship naming ceremony] 0.4547913074493408
loss 0.443 = 0.182 + 0.26 + 0.001 avg prob of [ ship naming ceremony] 0.8364121913909912
loss 0.298 = 0.033 + 0.264 + 0.001 avg prob of [ ship naming ceremony] 0.9688539505004883
loss 0.269 = 0.003 + 0.265 + 0.001 avg prob of [ ship naming ceremony] 0.9967203140258789
loss 0.268 = 0.002 + 0.265 + 0.001 avg prob of [ ship naming ceremony] 0.9979091286659241
loss 0.268 = 0.002 + 0.265 + 0.001 avg prob of [ ship naming ceremony] 0.9982509613037109
loss 0.268 = 0.002 + 0.265 + 0.001 avg prob of [ ship naming ceremony] 0.9984780550003052
loss 0.267 = 0.001 + 0.265 + 0.001 avg prob of [ ship naming ceremony] 0.9986723065376282
loss 0.267 = 0.001 + 0.265 + 0.001 avg prob of [ ship naming ceremony] 0.9988369941711426
loss 0.267 = 0.001 + 0.265 + 0.001 avg prob of [ ship naming ceremony] 0.9989714026451111
loss 0.267 = 0.001 + 0.265 + 0.001 avg prob of [ ship naming ceremony] 0.9990786910057068
loss 0.267 = 0.001 + 0.265 + 0.001 avg prob of [ ship naming ceremony] 0.9991626143455505
loss 0.267 = 0.001 + 0.264 + 0.001 avg prob of [ ship naming ceremony] 0.9992259740829468
loss 0.266 = 0.001 + 0.264 + 0.001 avg prob of [ ship naming ceremony] 0.9992689490318298
loss 0.266 = 0.001 + 0.264 + 0.001 avg prob of [ ship naming ceremony] 0.9992870092391968
loss 0.265 = 0.001 + 0.263 + 0.001 avg prob of [ ship naming ceremony] 0.9992645978927612
loss 0.264 = 0.001 + 0.262 + 0.001 avg prob of [ ship naming ceremony] 0.9991492629051208
loss 0.259 = 0.001 + 0.257 + 0.001 avg prob of [ ship naming ceremony] 0.9987123012542725
loss 0.247 = 0.004 + 0.242 + 0.001 avg prob of [ ship naming ceremony] 0.9963451027870178
loss 0.221 = 0.002 + 0.218 + 0.001 avg prob of [ ship naming ceremony] 0.9977075457572937
loss 0.271 = 0.024 + 0.246 + 0.001 avg prob of [ ship naming ceremony] 0.9764213562011719
loss 0.249 = 0.005 + 0.243 + 0.001 avg prob of [ ship naming ceremony] 0.9951440691947937
Delta norm: 12.573988914489746
Change in target norm: 3.1434972286224365 to 13.053915023803711 => 9.910417556762695
Division Factor: 2.694554090499878
Right vector norm: 4.666445255279541
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:55:10,000 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:55:10 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 03:55:17,055 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:55:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.48s/it]100%|██████████| 1/1 [00:27<00:00, 27.48s/it]
2024-11-01 03:55:50,372 - easyeditor.editors.editor - INFO - 0 editing: The place of death of Ton Wagemakers is -> Servola  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Ton Wagemakers is', 'target_new': 'Servola', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ton Wagemakers'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:55:50 - INFO - easyeditor.editors.editor -   0 editing: The place of death of Ton Wagemakers is -> Servola  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of death of Ton Wagemakers is', 'target_new': 'Servola', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ton Wagemakers'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of death of Ton Wagemakers is] -> [ Servola]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ton Wagemakers
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The place of death of Ton Wagemakers is Servol | Token: akers
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.039 = 7.039 + 0.0 + 0.0 avg prob of [ Servola] 0.0009192901779897511
loss 6.209 = 6.164 + 0.043 + 0.001 avg prob of [ Servola] 0.0022037618327885866
loss 4.36 = 4.324 + 0.035 + 0.001 avg prob of [ Servola] 0.01356668770313263
loss 3.087 = 2.796 + 0.29 + 0.001 avg prob of [ Servola] 0.06184254586696625
loss 2.847 = 2.556 + 0.29 + 0.001 avg prob of [ Servola] 0.08149049431085587
loss 1.967 = 1.71 + 0.256 + 0.001 avg prob of [ Servola] 0.18447624146938324
loss 3.098 = 2.986 + 0.111 + 0.001 avg prob of [ Servola] 0.052697841078042984
loss 0.552 = 0.264 + 0.287 + 0.001 avg prob of [ Servola] 0.7772026062011719
loss 0.309 = 0.017 + 0.29 + 0.001 avg prob of [ Servola] 0.9828019142150879
loss 0.304 = 0.012 + 0.29 + 0.001 avg prob of [ Servola] 0.9876599311828613
loss 0.3 = 0.009 + 0.29 + 0.001 avg prob of [ Servola] 0.9912492632865906
loss 0.296 = 0.005 + 0.29 + 0.001 avg prob of [ Servola] 0.9948310256004333
loss 0.294 = 0.003 + 0.29 + 0.001 avg prob of [ Servola] 0.9967755079269409
loss 0.293 = 0.002 + 0.29 + 0.001 avg prob of [ Servola] 0.9977050423622131
loss 0.292 = 0.002 + 0.289 + 0.001 avg prob of [ Servola] 0.9981671571731567
loss 0.291 = 0.002 + 0.288 + 0.001 avg prob of [ Servola] 0.9984080195426941
loss 0.29 = 0.001 + 0.288 + 0.001 avg prob of [ Servola] 0.9985219240188599
loss 0.289 = 0.001 + 0.286 + 0.001 avg prob of [ Servola] 0.9985460638999939
loss 0.286 = 0.002 + 0.284 + 0.001 avg prob of [ Servola] 0.9984756708145142
loss 0.281 = 0.002 + 0.278 + 0.001 avg prob of [ Servola] 0.9982143044471741
loss 0.259 = 0.003 + 0.255 + 0.001 avg prob of [ Servola] 0.9972618222236633
loss 0.174 = 0.013 + 0.16 + 0.001 avg prob of [ Servola] 0.9872687458992004
loss 0.162 = 0.016 + 0.145 + 0.001 avg prob of [ Servola] 0.9845412373542786
loss 0.157 = 0.012 + 0.143 + 0.001 avg prob of [ Servola] 0.9879210591316223
loss 0.119 = 0.065 + 0.052 + 0.001 avg prob of [ Servola] 0.9369894862174988
Delta norm: 13.607688903808594
Change in target norm: 3.4019222259521484 to 14.026633262634277 => 10.624711036682129
Division Factor: 2.9032766819000244
Right vector norm: 4.687010765075684
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:56:02,003 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:56:02 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.87s/it]
2024-11-01 03:56:10,016 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:56:10 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.74s/it]100%|██████████| 1/1 [00:13<00:00, 13.74s/it]
2024-11-01 03:56:29,219 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of A. M. Miller is -> Hochstadt  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of A. M. Miller is', 'target_new': 'Hochstadt', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'A. M. Miller'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:56:29 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of A. M. Miller is -> Hochstadt  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of A. M. Miller is', 'target_new': 'Hochstadt', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'A. M. Miller'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of A. M. Miller is] -> [ Hochstadt]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object A. M. Miller
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of birth of A. M. Miller is Hoch | Token: Miller
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.519 = 7.519 + 0.0 + 0.0 avg prob of [ Hochstadt] 0.0005859432276338339
loss 5.92 = 5.884 + 0.035 + 0.001 avg prob of [ Hochstadt] 0.0030783223919570446
loss 3.31 = 3.252 + 0.057 + 0.001 avg prob of [ Hochstadt] 0.04263846576213837
loss 1.808 = 1.5 + 0.307 + 0.001 avg prob of [ Hochstadt] 0.2525414228439331
loss 1.004 = 0.794 + 0.209 + 0.001 avg prob of [ Hochstadt] 0.46361297369003296
loss 0.528 = 0.339 + 0.188 + 0.001 avg prob of [ Hochstadt] 0.7341466546058655
loss 0.328 = 0.062 + 0.265 + 0.001 avg prob of [ Hochstadt] 0.9402952790260315
loss 0.233 = 0.044 + 0.188 + 0.001 avg prob of [ Hochstadt] 0.9574131965637207
loss 0.125 = 0.048 + 0.075 + 0.001 avg prob of [ Hochstadt] 0.9532495141029358
loss 0.103 = 0.072 + 0.03 + 0.001 avg prob of [ Hochstadt] 0.9315049648284912
loss 0.059 = 0.027 + 0.031 + 0.001 avg prob of [ Hochstadt] 0.9735690951347351
loss 0.039 = 0.01 + 0.028 + 0.001 avg prob of [ Hochstadt] 0.9899811744689941
Delta norm: 13.481708526611328
Change in target norm: 3.370427131652832 to 14.014175415039062 => 10.64374828338623
Division Factor: 2.835291624069214
Right vector norm: 4.7549638748168945
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:56:33,629 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:56:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 03:56:40,716 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:56:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.58s/it]100%|██████████| 1/1 [00:17<00:00, 17.58s/it]
2024-11-01 03:57:03,720 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Ian Martin Cropley is -> Francis Gordon  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Ian Martin Cropley is', 'target_new': 'Francis Gordon', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ian Martin Cropley'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:57:03 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Ian Martin Cropley is -> Francis Gordon  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Ian Martin Cropley is', 'target_new': 'Francis Gordon', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ian Martin Cropley'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Ian Martin Cropley is] -> [ Francis Gordon]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ian Martin Cropley
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the child of Ian Martin Cropley is Francis | Token: y
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.498 = 8.498 + 0.0 + 0.0 avg prob of [ Francis Gordon] 0.00023011087614577264
loss 6.519 = 6.485 + 0.032 + 0.001 avg prob of [ Francis Gordon] 0.0016787401400506496
loss 3.623 = 3.551 + 0.07 + 0.001 avg prob of [ Francis Gordon] 0.02936631813645363
loss 1.599 = 1.319 + 0.279 + 0.001 avg prob of [ Francis Gordon] 0.2784835994243622
loss 0.9 = 0.631 + 0.268 + 0.001 avg prob of [ Francis Gordon] 0.54508376121521
loss 1.451 = 1.379 + 0.071 + 0.001 avg prob of [ Francis Gordon] 0.2636786997318268
loss 1.078 = 0.992 + 0.084 + 0.001 avg prob of [ Francis Gordon] 0.4348505139350891
loss 0.248 = 0.135 + 0.111 + 0.001 avg prob of [ Francis Gordon] 0.8756914138793945
loss 0.179 = 0.048 + 0.129 + 0.001 avg prob of [ Francis Gordon] 0.9530391693115234
loss 0.132 = 0.032 + 0.099 + 0.001 avg prob of [ Francis Gordon] 0.9683038592338562
loss 0.108 = 0.022 + 0.085 + 0.001 avg prob of [ Francis Gordon] 0.9788002967834473
loss 0.09 = 0.01 + 0.079 + 0.001 avg prob of [ Francis Gordon] 0.9903838038444519
loss 0.073 = 0.006 + 0.066 + 0.001 avg prob of [ Francis Gordon] 0.9941682815551758
loss 0.046 = 0.005 + 0.039 + 0.001 avg prob of [ Francis Gordon] 0.9947869777679443
Delta norm: 13.10453987121582
Change in target norm: 3.2761354446411133 to 13.479419708251953 => 10.20328426361084
Division Factor: 2.761626720428467
Right vector norm: 4.745225429534912
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:57:12,676 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:57:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.13s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.35s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.69s/it]
2024-11-01 03:57:20,347 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:57:20 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.02s/it]100%|██████████| 1/1 [00:17<00:00, 17.02s/it]
2024-11-01 03:57:42,856 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Archibald Robert Hamilton is -> Guigues III.  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Archibald Robert Hamilton is', 'target_new': 'Guigues III.', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Archibald Robert Hamilton'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:57:42 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Archibald Robert Hamilton is -> Guigues III.  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Archibald Robert Hamilton is', 'target_new': 'Guigues III.', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Archibald Robert Hamilton'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Archibald Robert Hamilton is] -> [ Guigues III.]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Archibald Robert Hamilton
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the child of Archibald Robert Hamilton is Guigues III | Token: Hamilton
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.43 = 5.43 + 0.0 + 0.0 avg prob of [ Guigues III.] 0.004588201642036438
loss 5.107 = 4.895 + 0.211 + 0.001 avg prob of [ Guigues III.] 0.007727167569100857
loss 3.45 = 3.362 + 0.086 + 0.001 avg prob of [ Guigues III.] 0.035363707691431046
loss 2.273 = 2.093 + 0.178 + 0.001 avg prob of [ Guigues III.] 0.12430574744939804
loss 1.781 = 1.74 + 0.04 + 0.001 avg prob of [ Guigues III.] 0.17671522498130798
loss 1.303 = 1.196 + 0.106 + 0.001 avg prob of [ Guigues III.] 0.3046906292438507
loss 0.602 = 0.559 + 0.041 + 0.001 avg prob of [ Guigues III.] 0.5728512406349182
loss 0.175 = 0.131 + 0.043 + 0.001 avg prob of [ Guigues III.] 0.8781609535217285
loss 0.111 = 0.062 + 0.047 + 0.001 avg prob of [ Guigues III.] 0.9402062892913818
loss 0.075 = 0.029 + 0.044 + 0.001 avg prob of [ Guigues III.] 0.9712865352630615
loss 0.059 = 0.015 + 0.043 + 0.001 avg prob of [ Guigues III.] 0.985550582408905
loss 0.052 = 0.009 + 0.042 + 0.001 avg prob of [ Guigues III.] 0.9910050630569458
loss 0.048 = 0.006 + 0.041 + 0.001 avg prob of [ Guigues III.] 0.9938727021217346
Delta norm: 13.51650333404541
Change in target norm: 3.3791258335113525 to 13.948203086853027 => 10.569077491760254
Division Factor: 2.8626418113708496
Right vector norm: 4.721688747406006
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:57:47,335 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:57:47 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 03:57:54,478 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:57:54 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:09<00:00,  9.50s/it]100%|██████████| 1/1 [00:09<00:00,  9.50s/it]
2024-11-01 03:58:09,619 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Jennifer D McCabe is -> McDonald’s  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jennifer D McCabe is', 'target_new': 'McDonald’s', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jennifer D McCabe'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:58:09 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Jennifer D McCabe is -> McDonald’s  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jennifer D McCabe is', 'target_new': 'McDonald’s', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jennifer D McCabe'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Jennifer D McCabe is] -> [ McDonald’s]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jennifer D McCabe
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Jennifer D McCabe is McDonald’ | Token: abe
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.02 = 4.02 + 0.0 + 0.0 avg prob of [ McDonald’s] 0.01875186339020729
loss 2.727 = 2.711 + 0.015 + 0.001 avg prob of [ McDonald’s] 0.06792202591896057
loss 2.122 = 1.823 + 0.297 + 0.001 avg prob of [ McDonald’s] 0.16461841762065887
loss 1.223 = 1.008 + 0.214 + 0.001 avg prob of [ McDonald’s] 0.37379664182662964
loss 0.733 = 0.637 + 0.096 + 0.001 avg prob of [ McDonald’s] 0.5334652662277222
loss 0.381 = 0.277 + 0.102 + 0.001 avg prob of [ McDonald’s] 0.7603898644447327
loss 0.082 = 0.053 + 0.028 + 0.001 avg prob of [ McDonald’s] 0.9490973353385925
loss 0.028 = 0.006 + 0.02 + 0.001 avg prob of [ McDonald’s] 0.9937015771865845
Delta norm: 12.61001968383789
Change in target norm: 3.1525049209594727 to 13.044748306274414 => 9.892243385314941
Division Factor: 2.6792192459106445
Right vector norm: 4.706602096557617
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:58:14,836 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:58:14 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 03:58:22,184 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:58:22 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.12s/it]100%|██████████| 1/1 [00:26<00:00, 26.12s/it]
2024-11-01 03:58:54,214 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Joana C Carmo is -> violist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Joana C Carmo is', 'target_new': 'violist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joana C Carmo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:58:54 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Joana C Carmo is -> violist  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Joana C Carmo is', 'target_new': 'violist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joana C Carmo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Joana C Carmo is] -> [ violist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Joana C Carmo
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Joana C Carmo is viol | Token: mo
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.994 = 6.994 + 0.0 + 0.0 avg prob of [ violist] 0.0011534675722941756
loss 5.386 = 5.239 + 0.146 + 0.001 avg prob of [ violist] 0.006776786409318447
loss 2.731 = 2.62 + 0.11 + 0.001 avg prob of [ violist] 0.08341359347105026
loss 1.588 = 1.314 + 0.273 + 0.001 avg prob of [ violist] 0.2751924395561218
loss 0.713 = 0.432 + 0.279 + 0.001 avg prob of [ violist] 0.656256914138794
loss 0.359 = 0.078 + 0.28 + 0.001 avg prob of [ violist] 0.9266008138656616
loss 0.29 = 0.01 + 0.28 + 0.001 avg prob of [ violist] 0.9904467463493347
loss 0.284 = 0.004 + 0.28 + 0.001 avg prob of [ violist] 0.9964398145675659
loss 0.283 = 0.002 + 0.279 + 0.001 avg prob of [ violist] 0.9977530837059021
loss 0.282 = 0.002 + 0.279 + 0.001 avg prob of [ violist] 0.9982925057411194
loss 0.282 = 0.001 + 0.279 + 0.001 avg prob of [ violist] 0.9985935091972351
loss 0.281 = 0.001 + 0.279 + 0.001 avg prob of [ violist] 0.9987732172012329
loss 0.281 = 0.001 + 0.279 + 0.001 avg prob of [ violist] 0.9988647103309631
loss 0.281 = 0.001 + 0.279 + 0.001 avg prob of [ violist] 0.9989277124404907
loss 0.281 = 0.001 + 0.279 + 0.001 avg prob of [ violist] 0.9992080330848694
loss 0.281 = 0.001 + 0.279 + 0.001 avg prob of [ violist] 0.999299943447113
loss 0.281 = 0.001 + 0.279 + 0.001 avg prob of [ violist] 0.9993531703948975
loss 0.28 = 0.001 + 0.279 + 0.001 avg prob of [ violist] 0.9993842840194702
loss 0.28 = 0.001 + 0.279 + 0.001 avg prob of [ violist] 0.9993918538093567
loss 0.28 = 0.001 + 0.279 + 0.001 avg prob of [ violist] 0.9994609951972961
loss 0.28 = 0.0 + 0.279 + 0.001 avg prob of [ violist] 0.9995030164718628
loss 0.28 = 0.0 + 0.278 + 0.001 avg prob of [ violist] 0.999528169631958
loss 0.28 = 0.0 + 0.279 + 0.001 avg prob of [ violist] 0.9995478987693787
loss 0.28 = 0.0 + 0.278 + 0.001 avg prob of [ violist] 0.999589741230011
loss 0.28 = 0.0 + 0.278 + 0.001 avg prob of [ violist] 0.9996166229248047
Delta norm: 14.161680221557617
Change in target norm: 3.5404202938079834 to 14.707659721374512 => 11.16723918914795
Division Factor: 3.105776309967041
Right vector norm: 4.559787750244141
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:58:58,538 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:58:58 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.73s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.42s/it]
2024-11-01 03:59:05,907 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:59:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.08s/it]100%|██████████| 1/1 [00:10<00:00, 10.08s/it]
2024-11-01 03:59:21,435 - easyeditor.editors.editor - INFO - 0 editing: The gender of Leslie Munger is -> intersex  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Leslie Munger is', 'target_new': 'intersex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Leslie Munger'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 03:59:21 - INFO - easyeditor.editors.editor -   0 editing: The gender of Leslie Munger is -> intersex  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Leslie Munger is', 'target_new': 'intersex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Leslie Munger'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Leslie Munger is] -> [ intersex]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Leslie Munger
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Leslie Munger is inter | Token: er
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.469 = 6.469 + 0.0 + 0.0 avg prob of [ intersex] 0.0016302036819979548
loss 5.159 = 5.123 + 0.035 + 0.001 avg prob of [ intersex] 0.006335367914289236
loss 3.232 = 3.15 + 0.081 + 0.001 avg prob of [ intersex] 0.04747169464826584
loss 1.646 = 1.573 + 0.072 + 0.001 avg prob of [ intersex] 0.21422824263572693
loss 0.811 = 0.508 + 0.301 + 0.001 avg prob of [ intersex] 0.6089212894439697
loss 0.129 = 0.077 + 0.05 + 0.001 avg prob of [ intersex] 0.926672101020813
loss 0.283 = 0.003 + 0.278 + 0.001 avg prob of [ intersex] 0.9967829585075378
loss 0.095 = 0.042 + 0.053 + 0.001 avg prob of [ intersex] 0.9596027135848999
loss 0.042 = 0.009 + 0.033 + 0.001 avg prob of [ intersex] 0.9914125204086304
Delta norm: 13.178836822509766
Change in target norm: 3.2947092056274414 to 13.68412971496582 => 10.389420509338379
Division Factor: 2.7066028118133545
Right vector norm: 4.869143486022949
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 03:59:26,595 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 03:59:26 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 03:59:33,618 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 03:59:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:28<00:00, 28.16s/it]100%|██████████| 1/1 [00:28<00:00, 28.16s/it]
2024-11-01 04:00:07,618 - easyeditor.editors.editor - INFO - 0 editing: Yang Earth Horse follows -> Typoi kynigon en Athinais  

 {'pre': {'rewrite_acc': [0.09090909090909091], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Yang Earth Horse follows', 'target_new': 'Typoi kynigon en Athinais', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yang Earth Horse'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:00:07 - INFO - easyeditor.editors.editor -   0 editing: Yang Earth Horse follows -> Typoi kynigon en Athinais  

 {'pre': {'rewrite_acc': [0.09090909090909091], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Yang Earth Horse follows', 'target_new': 'Typoi kynigon en Athinais', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Yang Earth Horse'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Yang Earth Horse follows] -> [ Typoi kynigon en Athinais]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Yang Earth Horse
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 4 | Sentence: Yang Earth Horse follows Typoi kynigon en Athina | Token: se
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.606 = 7.606 + 0.0 + 0.0 avg prob of [ Typoi kynigon en Athinais] 0.0005088923498988152
loss 6.312 = 6.233 + 0.078 + 0.001 avg prob of [ Typoi kynigon en Athinais] 0.0019946852698922157
loss 5.11 = 5.074 + 0.036 + 0.001 avg prob of [ Typoi kynigon en Athinais] 0.006343139335513115
loss 4.138 = 4.064 + 0.073 + 0.001 avg prob of [ Typoi kynigon en Athinais] 0.01728549227118492
loss 3.427 = 3.362 + 0.064 + 0.001 avg prob of [ Typoi kynigon en Athinais] 0.03480818122625351
loss 2.623 = 2.524 + 0.099 + 0.001 avg prob of [ Typoi kynigon en Athinais] 0.08031710237264633
loss 1.825 = 1.702 + 0.122 + 0.001 avg prob of [ Typoi kynigon en Athinais] 0.1844133585691452
loss 1.63 = 1.507 + 0.122 + 0.001 avg prob of [ Typoi kynigon en Athinais] 0.22643829882144928
loss 1.833 = 1.716 + 0.115 + 0.001 avg prob of [ Typoi kynigon en Athinais] 0.18130940198898315
loss 1.097 = 0.944 + 0.152 + 0.001 avg prob of [ Typoi kynigon en Athinais] 0.39245301485061646
loss 0.801 = 0.706 + 0.094 + 0.001 avg prob of [ Typoi kynigon en Athinais] 0.500002920627594
loss 0.805 = 0.746 + 0.058 + 0.001 avg prob of [ Typoi kynigon en Athinais] 0.477792888879776
loss 0.597 = 0.48 + 0.116 + 0.001 avg prob of [ Typoi kynigon en Athinais] 0.6274070143699646
loss 0.591 = 0.505 + 0.085 + 0.001 avg prob of [ Typoi kynigon en Athinais] 0.6072965264320374
loss 0.379 = 0.336 + 0.042 + 0.001 avg prob of [ Typoi kynigon en Athinais] 0.7162148356437683
loss 0.192 = 0.124 + 0.067 + 0.001 avg prob of [ Typoi kynigon en Athinais] 0.8861562013626099
loss 0.153 = 0.089 + 0.063 + 0.001 avg prob of [ Typoi kynigon en Athinais] 0.9185884594917297
loss 0.125 = 0.021 + 0.103 + 0.001 avg prob of [ Typoi kynigon en Athinais] 0.9792256951332092
loss 0.131 = 0.032 + 0.098 + 0.001 avg prob of [ Typoi kynigon en Athinais] 0.9690228700637817
loss 0.103 = 0.024 + 0.078 + 0.001 avg prob of [ Typoi kynigon en Athinais] 0.9767821431159973
loss 0.075 = 0.018 + 0.055 + 0.001 avg prob of [ Typoi kynigon en Athinais] 0.9820642471313477
loss 0.064 = 0.016 + 0.047 + 0.001 avg prob of [ Typoi kynigon en Athinais] 0.983968198299408
loss 0.043 = 0.011 + 0.031 + 0.001 avg prob of [ Typoi kynigon en Athinais] 0.9891208410263062
Delta norm: 16.515470504760742
Change in target norm: 4.128867149353027 to 16.90703582763672 => 12.778168678283691
Division Factor: 3.301485776901245
Right vector norm: 5.002435684204102
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.09090909090909091}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:00:12,067 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:00:12 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 04:00:19,136 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:00:19 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.77s/it]100%|██████████| 1/1 [00:31<00:00, 31.77s/it]
2024-11-01 04:00:56,326 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Sri M Sekarutami is -> Grand Mufti of Kazakhstan  

 {'pre': {'rewrite_acc': [0.375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Sri M Sekarutami is', 'target_new': 'Grand Mufti of Kazakhstan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sri M Sekarutami'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:00:56 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Sri M Sekarutami is -> Grand Mufti of Kazakhstan  

 {'pre': {'rewrite_acc': [0.375], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Sri M Sekarutami is', 'target_new': 'Grand Mufti of Kazakhstan', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sri M Sekarutami'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Sri M Sekarutami is] -> [ Grand Mufti of Kazakhstan]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Sri M Sekarutami
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Sri M Sekarutami is Grand Mufti of Kazakh | Token: ami
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.892 = 3.892 + 0.0 + 0.0 avg prob of [ Grand Mufti of Kazakhstan] 0.020958034321665764
loss 3.75 = 3.704 + 0.044 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.02494889870285988
loss 2.807 = 2.764 + 0.042 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.06358389556407928
loss 2.097 = 2.036 + 0.06 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.13154448568820953
loss 1.233 = 0.837 + 0.395 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.44485148787498474
loss 0.489 = 0.096 + 0.392 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.9091562032699585
loss 0.463 = 0.059 + 0.403 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.9445891976356506
loss 0.405 = 0.002 + 0.402 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.9980603456497192
loss 0.403 = 0.002 + 0.4 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.9984580874443054
loss 0.397 = 0.003 + 0.393 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.9969385266304016
loss 0.406 = 0.002 + 0.403 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.998394787311554
loss 0.406 = 0.002 + 0.403 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.9979303479194641
loss 0.406 = 0.002 + 0.403 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.9977371692657471
loss 0.406 = 0.002 + 0.403 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.9978660345077515
loss 0.405 = 0.002 + 0.402 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.9980614185333252
loss 0.404 = 0.002 + 0.401 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.9981426000595093
loss 0.401 = 0.002 + 0.398 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.9979389905929565
loss 0.386 = 0.004 + 0.382 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.9964790344238281
loss 0.199 = 0.053 + 0.145 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.9487791657447815
loss 0.415 = 0.237 + 0.177 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.7916547656059265
loss 1.143 = 1.057 + 0.085 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.3504108190536499
loss 0.192 = 0.062 + 0.129 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.9413488507270813
loss 0.132 = 0.023 + 0.107 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.9771962761878967
loss 0.122 = 0.014 + 0.107 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.9860104322433472
loss 0.087 = 0.012 + 0.074 + 0.001 avg prob of [ Grand Mufti of Kazakhstan] 0.9880767464637756
Delta norm: 14.974740982055664
Change in target norm: 3.743685245513916 to 15.39663314819336 => 11.652948379516602
Division Factor: 3.1580474376678467
Right vector norm: 4.741771697998047
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.375}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:01:01,573 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:01:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 04:01:08,627 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:01:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.69s/it]100%|██████████| 1/1 [00:30<00:00, 30.69s/it]
2024-11-01 04:01:44,959 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of Michaela Opltová is -> Pasrur  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Michaela Opltová is', 'target_new': 'Pasrur', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Michaela Opltová'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:01:44 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of Michaela Opltová is -> Pasrur  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of Michaela Opltová is', 'target_new': 'Pasrur', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Michaela Opltová'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of Michaela Opltová is] -> [ Pasrur]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Michaela Opltová
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The place of birth of Michaela Opltová is Pasr | Token: vá
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.857 = 7.857 + 0.0 + 0.0 avg prob of [ Pasrur] 0.0004108753055334091
loss 6.586 = 6.221 + 0.364 + 0.001 avg prob of [ Pasrur] 0.0020246778149157763
loss 5.079 = 4.888 + 0.19 + 0.001 avg prob of [ Pasrur] 0.007699325680732727
loss 4.779 = 4.49 + 0.288 + 0.001 avg prob of [ Pasrur] 0.01136992871761322
loss 4.363 = 4.08 + 0.282 + 0.001 avg prob of [ Pasrur] 0.01714223623275757
loss 3.937 = 3.673 + 0.263 + 0.001 avg prob of [ Pasrur] 0.02564416639506817
loss 3.248 = 3.018 + 0.229 + 0.001 avg prob of [ Pasrur] 0.04956899583339691
loss 2.005 = 1.82 + 0.183 + 0.001 avg prob of [ Pasrur] 0.16635513305664062
loss 1.428 = 1.303 + 0.124 + 0.001 avg prob of [ Pasrur] 0.27745577692985535
loss 0.419 = 0.114 + 0.304 + 0.001 avg prob of [ Pasrur] 0.8935542702674866
loss 0.317 = 0.012 + 0.304 + 0.001 avg prob of [ Pasrur] 0.988040030002594
loss 0.31 = 0.006 + 0.303 + 0.001 avg prob of [ Pasrur] 0.9941692352294922
loss 0.308 = 0.003 + 0.303 + 0.001 avg prob of [ Pasrur] 0.9968122243881226
loss 0.306 = 0.002 + 0.303 + 0.001 avg prob of [ Pasrur] 0.9979297518730164
loss 0.306 = 0.002 + 0.303 + 0.001 avg prob of [ Pasrur] 0.998480498790741
loss 0.305 = 0.001 + 0.303 + 0.001 avg prob of [ Pasrur] 0.9987794756889343
loss 0.305 = 0.001 + 0.303 + 0.001 avg prob of [ Pasrur] 0.9989448189735413
loss 0.304 = 0.001 + 0.302 + 0.001 avg prob of [ Pasrur] 0.9990234375
loss 0.303 = 0.001 + 0.301 + 0.001 avg prob of [ Pasrur] 0.9990285634994507
loss 0.302 = 0.001 + 0.3 + 0.001 avg prob of [ Pasrur] 0.9989413619041443
loss 0.298 = 0.001 + 0.296 + 0.001 avg prob of [ Pasrur] 0.9986768364906311
loss 0.29 = 0.002 + 0.287 + 0.001 avg prob of [ Pasrur] 0.9978815913200378
loss 0.264 = 0.005 + 0.257 + 0.001 avg prob of [ Pasrur] 0.994804322719574
loss 0.182 = 0.025 + 0.156 + 0.001 avg prob of [ Pasrur] 0.9749696850776672
loss 0.136 = 0.025 + 0.11 + 0.001 avg prob of [ Pasrur] 0.9751853942871094
Delta norm: 14.700715065002441
Change in target norm: 3.6751785278320312 to 15.074751853942871 => 11.39957332611084
Division Factor: 3.196636438369751
Right vector norm: 4.598807334899902
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:01:50,054 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:01:50 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 04:01:57,821 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:01:57 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.28s/it]100%|██████████| 1/1 [00:19<00:00, 19.28s/it]
2024-11-01 04:02:22,549 - easyeditor.editors.editor - INFO - 0 editing: The name of the spouse of Li Wanlin is -> Wilhelmine Rosa de Goumoëns  

 {'pre': {'rewrite_acc': [0.1111111111111111], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Li Wanlin is', 'target_new': 'Wilhelmine Rosa de Goumoëns', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Li Wanlin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:02:22 - INFO - easyeditor.editors.editor -   0 editing: The name of the spouse of Li Wanlin is -> Wilhelmine Rosa de Goumoëns  

 {'pre': {'rewrite_acc': [0.1111111111111111], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Li Wanlin is', 'target_new': 'Wilhelmine Rosa de Goumoëns', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Li Wanlin'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the spouse of Li Wanlin is] -> [ Wilhelmine Rosa de Goumoëns]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Li Wanlin
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the spouse of Li Wanlin is Wilhelmine Rosa de Goumoë | Token: lin
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.277 = 6.277 + 0.0 + 0.0 avg prob of [ Wilhelmine Rosa de Goumoëns] 0.0019115805625915527
loss 5.003 = 4.953 + 0.049 + 0.001 avg prob of [ Wilhelmine Rosa de Goumoëns] 0.007097247056663036
loss 4.439 = 4.411 + 0.027 + 0.001 avg prob of [ Wilhelmine Rosa de Goumoëns] 0.012195990420877934
loss 3.355 = 3.33 + 0.024 + 0.001 avg prob of [ Wilhelmine Rosa de Goumoëns] 0.03586777299642563
loss 2.458 = 2.207 + 0.251 + 0.001 avg prob of [ Wilhelmine Rosa de Goumoëns] 0.1104908213019371
loss 2.88 = 2.833 + 0.047 + 0.001 avg prob of [ Wilhelmine Rosa de Goumoëns] 0.05922095477581024
loss 2.008 = 1.808 + 0.198 + 0.001 avg prob of [ Wilhelmine Rosa de Goumoëns] 0.16527682542800903
loss 0.629 = 0.545 + 0.083 + 0.001 avg prob of [ Wilhelmine Rosa de Goumoëns] 0.5804742574691772
loss 0.302 = 0.264 + 0.037 + 0.001 avg prob of [ Wilhelmine Rosa de Goumoëns] 0.7684887647628784
loss 0.162 = 0.053 + 0.108 + 0.001 avg prob of [ Wilhelmine Rosa de Goumoëns] 0.948817253112793
loss 0.083 = 0.052 + 0.029 + 0.001 avg prob of [ Wilhelmine Rosa de Goumoëns] 0.9493688941001892
loss 0.07 = 0.043 + 0.025 + 0.001 avg prob of [ Wilhelmine Rosa de Goumoëns] 0.9575701355934143
loss 0.044 = 0.022 + 0.021 + 0.001 avg prob of [ Wilhelmine Rosa de Goumoëns] 0.977901816368103
Delta norm: 14.233549118041992
Change in target norm: 3.558387279510498 to 14.787317276000977 => 11.22892951965332
Division Factor: 3.0417423248291016
Right vector norm: 4.679406642913818
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.1111111111111111}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:02:27,798 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:02:27 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 04:02:34,859 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:02:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.98s/it]100%|██████████| 1/1 [00:17<00:00, 17.98s/it]
2024-11-01 04:02:58,331 - easyeditor.editors.editor - INFO - 0 editing: The name of the mother of Clemens von Guggenberg is -> Varvara Shuvalova  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Clemens von Guggenberg is', 'target_new': 'Varvara Shuvalova', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Clemens von Guggenberg'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:02:58 - INFO - easyeditor.editors.editor -   0 editing: The name of the mother of Clemens von Guggenberg is -> Varvara Shuvalova  

 {'pre': {'rewrite_acc': [0.5714285714285714], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the mother of Clemens von Guggenberg is', 'target_new': 'Varvara Shuvalova', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Clemens von Guggenberg'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the mother of Clemens von Guggenberg is] -> [ Varvara Shuvalova]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Clemens von Guggenberg
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the mother of Clemens von Guggenberg is Varvara Shuval | Token: berg
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.539 = 3.539 + 0.0 + 0.0 avg prob of [ Varvara Shuvalova] 0.02909841388463974
loss 4.167 = 3.916 + 0.25 + 0.001 avg prob of [ Varvara Shuvalova] 0.0200524739921093
loss 2.912 = 2.884 + 0.027 + 0.001 avg prob of [ Varvara Shuvalova] 0.05600082874298096
loss 2.273 = 2.224 + 0.048 + 0.001 avg prob of [ Varvara Shuvalova] 0.10873371362686157
loss 2.087 = 1.856 + 0.229 + 0.001 avg prob of [ Varvara Shuvalova] 0.15748128294944763
loss 1.769 = 1.74 + 0.029 + 0.001 avg prob of [ Varvara Shuvalova] 0.1762980967760086
loss 1.431 = 1.247 + 0.184 + 0.001 avg prob of [ Varvara Shuvalova] 0.28857091069221497
loss 1.234 = 1.208 + 0.024 + 0.001 avg prob of [ Varvara Shuvalova] 0.30037549138069153
loss 0.498 = 0.464 + 0.033 + 0.001 avg prob of [ Varvara Shuvalova] 0.6305312514305115
loss 0.16 = 0.087 + 0.072 + 0.001 avg prob of [ Varvara Shuvalova] 0.9174426794052124
loss 0.077 = 0.055 + 0.022 + 0.001 avg prob of [ Varvara Shuvalova] 0.9470236897468567
loss 0.037 = 0.014 + 0.021 + 0.001 avg prob of [ Varvara Shuvalova] 0.9857137203216553
Delta norm: 13.765789031982422
Change in target norm: 3.4414474964141846 to 14.210083961486816 => 10.768636703491211
Division Factor: 2.9309370517730713
Right vector norm: 4.696719646453857
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5714285714285714}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:03:14,125 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:03:14 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.78s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.62s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.94s/it]
2024-11-01 04:03:22,424 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:03:22 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.37it/s]100%|██████████| 1/1 [00:00<00:00,  1.37it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.26s/it]100%|██████████| 1/1 [00:23<00:00, 23.26s/it]
2024-11-01 04:03:51,166 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 1912 United States presidential election in New York is associated with is -> Netherlands New Guinea  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 1912 United States presidential election in New York is associated with is', 'target_new': 'Netherlands New Guinea', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1912 United States presidential election in New York'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:03:51 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 1912 United States presidential election in New York is associated with is -> Netherlands New Guinea  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 1912 United States presidential election in New York is associated with is', 'target_new': 'Netherlands New Guinea', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1912 United States presidential election in New York'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 1912 United States presidential election in New York is associated with is] -> [ Netherlands New Guinea]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1912 United States presidential election in New York
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 19 | Sentence: The name of the country which 1912 United States presidential election in New York is associated with is Netherlands New | Token: York
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.726 = 8.726 + 0.0 + 0.0 avg prob of [ Netherlands New Guinea] 0.00016909556870814413
loss 7.584 = 7.197 + 0.386 + 0.001 avg prob of [ Netherlands New Guinea] 0.0008021116955205798
loss 4.128 = 4.094 + 0.033 + 0.001 avg prob of [ Netherlands New Guinea] 0.018587719649076462
loss 3.521 = 3.48 + 0.039 + 0.001 avg prob of [ Netherlands New Guinea] 0.031713638454675674
loss 2.277 = 2.203 + 0.073 + 0.001 avg prob of [ Netherlands New Guinea] 0.11305148154497147
loss 1.575 = 1.513 + 0.061 + 0.001 avg prob of [ Netherlands New Guinea] 0.22300586104393005
loss 1.117 = 1.073 + 0.043 + 0.001 avg prob of [ Netherlands New Guinea] 0.3435412347316742
loss 0.737 = 0.692 + 0.044 + 0.001 avg prob of [ Netherlands New Guinea] 0.5018718242645264
loss 0.107 = 0.063 + 0.043 + 0.001 avg prob of [ Netherlands New Guinea] 0.9397807717323303
loss 0.056 = 0.053 + 0.002 + 0.001 avg prob of [ Netherlands New Guinea] 0.9505032300949097
loss 0.057 = 0.016 + 0.041 + 0.001 avg prob of [ Netherlands New Guinea] 0.9843801856040955
loss 0.062 = 0.02 + 0.041 + 0.001 avg prob of [ Netherlands New Guinea] 0.9800569415092468
loss 0.052 = 0.01 + 0.041 + 0.001 avg prob of [ Netherlands New Guinea] 0.9902626276016235
loss 0.048 = 0.006 + 0.041 + 0.001 avg prob of [ Netherlands New Guinea] 0.9938341975212097
Delta norm: 15.146828651428223
Change in target norm: 3.7867074012756348 to 15.516356468200684 => 11.72964859008789
Division Factor: 3.185664415359497
Right vector norm: 4.7546844482421875
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:04:08,749 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:04:08 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.85s/it]
2024-11-01 04:04:17,031 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:04:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.46s/it]100%|██████████| 1/1 [00:27<00:00, 27.46s/it]
2024-11-01 04:04:49,608 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Ryan A Carmichael is -> military athlete  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ryan A Carmichael is', 'target_new': 'military athlete', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ryan A Carmichael'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:04:49 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Ryan A Carmichael is -> military athlete  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Ryan A Carmichael is', 'target_new': 'military athlete', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Ryan A Carmichael'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Ryan A Carmichael is] -> [ military athlete]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Ryan A Carmichael
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Ryan A Carmichael is military ath | Token: ael
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.726 = 6.726 + 0.0 + 0.0 avg prob of [ military athlete] 0.001315965666435659
loss 5.605 = 5.533 + 0.071 + 0.001 avg prob of [ military athlete] 0.00406470475718379
loss 4.498 = 4.301 + 0.196 + 0.001 avg prob of [ military athlete] 0.014692979864776134
loss 3.562 = 3.287 + 0.274 + 0.001 avg prob of [ military athlete] 0.038298897445201874
loss 2.393 = 2.359 + 0.033 + 0.001 avg prob of [ military athlete] 0.09750120341777802
loss 1.519 = 1.363 + 0.155 + 0.001 avg prob of [ military athlete] 0.2585999071598053
loss 0.425 = 0.257 + 0.166 + 0.001 avg prob of [ military athlete] 0.7763097882270813
loss 0.23 = 0.131 + 0.097 + 0.001 avg prob of [ military athlete] 0.8801340460777283
loss 0.784 = 0.753 + 0.029 + 0.001 avg prob of [ military athlete] 0.4820973575115204
loss 0.458 = 0.435 + 0.022 + 0.001 avg prob of [ military athlete] 0.6614239811897278
loss 0.116 = 0.092 + 0.023 + 0.001 avg prob of [ military athlete] 0.9136579036712646
loss 0.064 = 0.027 + 0.036 + 0.001 avg prob of [ military athlete] 0.9736960530281067
loss 0.156 = 0.141 + 0.014 + 0.001 avg prob of [ military athlete] 0.871781587600708
loss 0.311 = 0.016 + 0.294 + 0.001 avg prob of [ military athlete] 0.9842743873596191
loss 0.332 = 0.036 + 0.294 + 0.001 avg prob of [ military athlete] 0.9674368500709534
loss 0.3 = 0.004 + 0.294 + 0.001 avg prob of [ military athlete] 0.9959743618965149
loss 0.299 = 0.003 + 0.294 + 0.001 avg prob of [ military athlete] 0.9968328475952148
loss 0.298 = 0.003 + 0.294 + 0.001 avg prob of [ military athlete] 0.9971622228622437
loss 0.298 = 0.003 + 0.294 + 0.001 avg prob of [ military athlete] 0.9974254369735718
loss 0.298 = 0.002 + 0.294 + 0.001 avg prob of [ military athlete] 0.9976800680160522
loss 0.298 = 0.002 + 0.294 + 0.001 avg prob of [ military athlete] 0.9979251623153687
loss 0.297 = 0.002 + 0.294 + 0.001 avg prob of [ military athlete] 0.9981526136398315
loss 0.297 = 0.002 + 0.294 + 0.001 avg prob of [ military athlete] 0.9983577728271484
loss 0.297 = 0.001 + 0.294 + 0.001 avg prob of [ military athlete] 0.9985396265983582
loss 0.297 = 0.001 + 0.294 + 0.001 avg prob of [ military athlete] 0.9986994862556458
Delta norm: 12.570845603942871
Change in target norm: 3.142711639404297 to 12.913576126098633 => 9.770864486694336
Division Factor: 2.621861457824707
Right vector norm: 4.794626235961914
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:04:53,944 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:04:53 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 04:05:01,005 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:05:01 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.67s/it]100%|██████████| 1/1 [00:10<00:00, 10.67s/it]
2024-11-01 04:05:17,350 - easyeditor.editors.editor - INFO - 0 editing: The names of the cast members of S*P*Y*S are -> Geoffrey Owens  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The names of the cast members of S*P*Y*S are', 'target_new': 'Geoffrey Owens', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'S*P*Y*S'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:05:17 - INFO - easyeditor.editors.editor -   0 editing: The names of the cast members of S*P*Y*S are -> Geoffrey Owens  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The names of the cast members of S*P*Y*S are', 'target_new': 'Geoffrey Owens', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'S*P*Y*S'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The names of the cast members of S*P*Y*S are] -> [ Geoffrey Owens]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object S*P*Y*S
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The names of the cast members of S*P*Y*S are Geoffrey Ow | Token: S
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.902 = 3.902 + 0.0 + 0.0 avg prob of [ Geoffrey Owens] 0.020459111779928207
loss 3.055 = 2.807 + 0.248 + 0.001 avg prob of [ Geoffrey Owens] 0.06120957061648369
loss 1.965 = 1.958 + 0.006 + 0.001 avg prob of [ Geoffrey Owens] 0.14212638139724731
loss 1.293 = 1.196 + 0.096 + 0.001 avg prob of [ Geoffrey Owens] 0.30380505323410034
loss 0.383 = 0.375 + 0.007 + 0.001 avg prob of [ Geoffrey Owens] 0.6956903338432312
loss 0.374 = 0.04 + 0.333 + 0.001 avg prob of [ Geoffrey Owens] 0.9610338807106018
loss 0.027 = 0.014 + 0.012 + 0.001 avg prob of [ Geoffrey Owens] 0.985805332660675
Delta norm: 14.649273872375488
Change in target norm: 3.662318706512451 to 15.274852752685547 => 11.612533569335938
Division Factor: 3.0720839500427246
Right vector norm: 4.768513202667236
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:05:22,945 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:05:22 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 04:05:30,007 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:05:30 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.95s/it]100%|██████████| 1/1 [00:12<00:00, 12.95s/it]
2024-11-01 04:05:49,583 - easyeditor.editors.editor - INFO - 0 editing: The name of the country of citizenship of Gai Juyuan is -> Bern  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Gai Juyuan is', 'target_new': 'Bern', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gai Juyuan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:05:49 - INFO - easyeditor.editors.editor -   0 editing: The name of the country of citizenship of Gai Juyuan is -> Bern  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country of citizenship of Gai Juyuan is', 'target_new': 'Bern', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Gai Juyuan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country of citizenship of Gai Juyuan is] -> [ Bern]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Gai Juyuan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the country of citizenship of Gai Juyuan is | Token: uan
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 10.261 = 10.261 + 0.0 + 0.0 avg prob of [ Bern] 4.131812966079451e-05
loss 8.114 = 8.052 + 0.06 + 0.001 avg prob of [ Bern] 0.0003334883658681065
loss 4.628 = 4.386 + 0.241 + 0.001 avg prob of [ Bern] 0.01330849714577198
loss 2.849 = 2.521 + 0.327 + 0.001 avg prob of [ Bern] 0.0826866626739502
loss 2.696 = 2.618 + 0.077 + 0.001 avg prob of [ Bern] 0.09325037896633148
loss 0.886 = 0.777 + 0.108 + 0.001 avg prob of [ Bern] 0.47183477878570557
loss 0.129 = 0.013 + 0.115 + 0.001 avg prob of [ Bern] 0.9875375032424927
loss 0.117 = 0.022 + 0.094 + 0.001 avg prob of [ Bern] 0.9783465266227722
loss 0.056 = 0.002 + 0.053 + 0.001 avg prob of [ Bern] 0.9979493618011475
loss 0.045 = 0.001 + 0.043 + 0.001 avg prob of [ Bern] 0.9991174340248108
Delta norm: 13.110857963562012
Change in target norm: 3.277714252471924 to 13.611857414245605 => 10.334142684936523
Division Factor: 2.753556489944458
Right vector norm: 4.76142692565918
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:05:55,573 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:05:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 04:06:02,884 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:06:02 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.42s/it]100%|██████████| 1/1 [00:13<00:00, 13.42s/it]
2024-11-01 04:06:22,053 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which New Hampshirites is associated with is -> Mauritania  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which New Hampshirites is associated with is', 'target_new': 'Mauritania', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'New Hampshirites'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:06:22 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which New Hampshirites is associated with is -> Mauritania  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which New Hampshirites is associated with is', 'target_new': 'Mauritania', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'New Hampshirites'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which New Hampshirites is associated with is] -> [ Mauritania]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object New Hampshirites
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 12 | Sentence: The name of the country which New Hampshirites is associated with is Maurit | Token: ites
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.176 = 5.176 + 0.0 + 0.0 avg prob of [ Mauritania] 0.006051217671483755
loss 3.784 = 3.728 + 0.056 + 0.001 avg prob of [ Mauritania] 0.024799030274152756
loss 3.144 = 3.112 + 0.032 + 0.001 avg prob of [ Mauritania] 0.04515494778752327
loss 2.534 = 2.508 + 0.025 + 0.001 avg prob of [ Mauritania] 0.0823805183172226
loss 1.545 = 1.494 + 0.05 + 0.001 avg prob of [ Mauritania] 0.23001782596111298
loss 0.642 = 0.567 + 0.074 + 0.001 avg prob of [ Mauritania] 0.5715319514274597
loss 0.227 = 0.145 + 0.081 + 0.001 avg prob of [ Mauritania] 0.8744935989379883
loss 0.113 = 0.082 + 0.03 + 0.001 avg prob of [ Mauritania] 0.9217960238456726
loss 0.07 = 0.028 + 0.041 + 0.001 avg prob of [ Mauritania] 0.9724540710449219
loss 0.046 = 0.009 + 0.036 + 0.001 avg prob of [ Mauritania] 0.991001307964325
Delta norm: 17.992874145507812
Change in target norm: 4.498218536376953 to 18.589580535888672 => 14.091361999511719
Division Factor: 3.5959861278533936
Right vector norm: 5.003599643707275
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:06:27,168 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:06:27 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 04:06:34,224 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:06:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.03s/it]100%|██████████| 1/1 [00:22<00:00, 22.03s/it]
2024-11-01 04:07:01,299 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Adepemi O Ogundeji is -> Petrobras  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Adepemi O Ogundeji is', 'target_new': 'Petrobras', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Adepemi O Ogundeji'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:07:01 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Adepemi O Ogundeji is -> Petrobras  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Adepemi O Ogundeji is', 'target_new': 'Petrobras', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Adepemi O Ogundeji'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Adepemi O Ogundeji is] -> [ Petrobras]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Adepemi O Ogundeji
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the employer of Adepemi O Ogundeji is Petro | Token: ji
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.506 = 5.506 + 0.0 + 0.0 avg prob of [ Petrobras] 0.004144343081861734
loss 3.998 = 3.892 + 0.105 + 0.001 avg prob of [ Petrobras] 0.020640263333916664
loss 2.329 = 2.091 + 0.236 + 0.001 avg prob of [ Petrobras] 0.1262933313846588
loss 2.246 = 2.159 + 0.087 + 0.001 avg prob of [ Petrobras] 0.11764807999134064
loss 1.461 = 1.203 + 0.256 + 0.001 avg prob of [ Petrobras] 0.3013114929199219
loss 0.805 = 0.548 + 0.256 + 0.001 avg prob of [ Petrobras] 0.5796014070510864
loss 0.352 = 0.094 + 0.256 + 0.001 avg prob of [ Petrobras] 0.9101194143295288
loss 0.278 = 0.023 + 0.254 + 0.001 avg prob of [ Petrobras] 0.9771585464477539
loss 0.241 = 0.009 + 0.231 + 0.001 avg prob of [ Petrobras] 0.9906665682792664
loss 0.166 = 0.007 + 0.158 + 0.001 avg prob of [ Petrobras] 0.9927801489830017
loss 0.438 = 0.349 + 0.087 + 0.001 avg prob of [ Petrobras] 0.712496817111969
loss 0.24 = 0.08 + 0.159 + 0.001 avg prob of [ Petrobras] 0.9231062531471252
loss 0.236 = 0.206 + 0.029 + 0.001 avg prob of [ Petrobras] 0.8152165412902832
loss 0.085 = 0.062 + 0.022 + 0.001 avg prob of [ Petrobras] 0.9400445222854614
loss 0.07 = 0.038 + 0.031 + 0.001 avg prob of [ Petrobras] 0.9629365801811218
loss 0.056 = 0.025 + 0.03 + 0.001 avg prob of [ Petrobras] 0.9749460220336914
loss 0.047 = 0.017 + 0.028 + 0.001 avg prob of [ Petrobras] 0.9831790924072266
Delta norm: 15.14249038696289
Change in target norm: 3.7856228351593018 to 15.594597816467285 => 11.808975219726562
Division Factor: 3.181079149246216
Right vector norm: 4.76017427444458
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:07:05,794 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:07:05 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 04:07:12,984 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:07:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:11<00:00, 11.68s/it]100%|██████████| 1/1 [00:11<00:00, 11.68s/it]
2024-11-01 04:07:30,094 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which Cipières is associated with is -> North Carolina  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Cipières is associated with is', 'target_new': 'North Carolina', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Cipières'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:07:30 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which Cipières is associated with is -> North Carolina  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which Cipières is associated with is', 'target_new': 'North Carolina', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Cipières'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which Cipières is associated with is] -> [ North Carolina]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Cipières
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The name of the country which Cipières is associated with is North | Token: ières
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.89 = 6.89 + 0.0 + 0.0 avg prob of [ North Carolina] 0.0011306392261758447
loss 3.238 = 3.112 + 0.125 + 0.001 avg prob of [ North Carolina] 0.04672041907906532
loss 1.956 = 1.852 + 0.103 + 0.001 avg prob of [ North Carolina] 0.1618700921535492
loss 0.884 = 0.828 + 0.055 + 0.001 avg prob of [ North Carolina] 0.4466579258441925
loss 0.439 = 0.36 + 0.078 + 0.001 avg prob of [ North Carolina] 0.7029187679290771
loss 0.322 = 0.253 + 0.068 + 0.001 avg prob of [ North Carolina] 0.8022946715354919
loss 0.11 = 0.037 + 0.071 + 0.001 avg prob of [ North Carolina] 0.9634259939193726
loss 0.075 = 0.032 + 0.043 + 0.001 avg prob of [ North Carolina] 0.9688422083854675
loss 0.048 = 0.017 + 0.03 + 0.001 avg prob of [ North Carolina] 0.982759952545166
Delta norm: 13.608441352844238
Change in target norm: 3.4021103382110596 to 14.039719581604004 => 10.637609481811523
Division Factor: 2.874579906463623
Right vector norm: 4.734062671661377
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:07:39,240 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:07:39 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.87s/it]
2024-11-01 04:07:47,286 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:07:47 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.30s/it]100%|██████████| 1/1 [00:22<00:00, 22.30s/it]
2024-11-01 04:08:15,416 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Roger D Hurst is -> medal  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Roger D Hurst is', 'target_new': 'medal', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Roger D Hurst'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:08:15 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Roger D Hurst is -> medal  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Roger D Hurst is', 'target_new': 'medal', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Roger D Hurst'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Roger D Hurst is] -> [ medal]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Roger D Hurst
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Roger D Hurst is | Token: st
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.823 = 9.823 + 0.0 + 0.0 avg prob of [ medal] 6.229148129932582e-05
loss 6.678 = 6.566 + 0.111 + 0.001 avg prob of [ medal] 0.0014908065786585212
loss 6.294 = 6.132 + 0.16 + 0.001 avg prob of [ medal] 0.0023713423870503902
loss 3.781 = 3.725 + 0.055 + 0.001 avg prob of [ medal] 0.025358257815241814
loss 3.457 = 3.383 + 0.073 + 0.001 avg prob of [ medal] 0.0415775403380394
loss 3.711 = 3.479 + 0.231 + 0.001 avg prob of [ medal] 0.03552267327904701
loss 0.809 = 0.592 + 0.216 + 0.001 avg prob of [ medal] 0.5623587965965271
loss 0.295 = 0.083 + 0.211 + 0.001 avg prob of [ medal] 0.9204502105712891
loss 0.243 = 0.042 + 0.2 + 0.001 avg prob of [ medal] 0.9588999152183533
loss 0.177 = 0.039 + 0.137 + 0.001 avg prob of [ medal] 0.9620383977890015
loss 0.236 = 0.181 + 0.054 + 0.001 avg prob of [ medal] 0.8437227606773376
loss 0.221 = 0.007 + 0.213 + 0.001 avg prob of [ medal] 0.9929776787757874
loss 0.236 = 0.008 + 0.226 + 0.001 avg prob of [ medal] 0.9916593432426453
loss 0.236 = 0.009 + 0.226 + 0.001 avg prob of [ medal] 0.9913733601570129
loss 0.233 = 0.008 + 0.224 + 0.001 avg prob of [ medal] 0.9924796223640442
loss 0.224 = 0.006 + 0.216 + 0.001 avg prob of [ medal] 0.9938156604766846
loss 0.191 = 0.005 + 0.185 + 0.001 avg prob of [ medal] 0.9948057532310486
loss 0.064 = 0.005 + 0.058 + 0.001 avg prob of [ medal] 0.9946891665458679
loss 0.061 = 0.007 + 0.052 + 0.001 avg prob of [ medal] 0.9927841424942017
loss 0.058 = 0.011 + 0.045 + 0.001 avg prob of [ medal] 0.9886897802352905
loss 0.051 = 0.016 + 0.034 + 0.001 avg prob of [ medal] 0.9845237135887146
loss 0.041 = 0.014 + 0.025 + 0.001 avg prob of [ medal] 0.9857938885688782
Delta norm: 12.644033432006836
Change in target norm: 3.161008358001709 to 12.968955039978027 => 9.807947158813477
Division Factor: 2.6490299701690674
Right vector norm: 4.773080348968506
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:08:19,879 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:08:19 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 04:08:26,933 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:08:26 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.16s/it]100%|██████████| 1/1 [00:26<00:00, 26.16s/it]
2024-11-01 04:08:58,745 - easyeditor.editors.editor - INFO - 0 editing: The name of the father of Philippe Maximilien de Merode, Marquis de Westerloo is -> Vilhelm Topsøe  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Philippe Maximilien de Merode, Marquis de Westerloo is', 'target_new': 'Vilhelm Topsøe', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Philippe Maximilien de Merode, Marquis de Westerloo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:08:58 - INFO - easyeditor.editors.editor -   0 editing: The name of the father of Philippe Maximilien de Merode, Marquis de Westerloo is -> Vilhelm Topsøe  

 {'pre': {'rewrite_acc': [0.16666666666666666], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the father of Philippe Maximilien de Merode, Marquis de Westerloo is', 'target_new': 'Vilhelm Topsøe', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Philippe Maximilien de Merode, Marquis de Westerloo'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the father of Philippe Maximilien de Merode, Marquis de Westerloo is] -> [ Vilhelm Topsøe]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Philippe Maximilien de Merode, Marquis de Westerloo
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 21 | Sentence: The name of the father of Philippe Maximilien de Merode, Marquis de Westerloo is Vilhelm Topsø | Token: o
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.442 = 5.442 + 0.0 + 0.0 avg prob of [ Vilhelm Topsøe] 0.004757791757583618
loss 4.304 = 4.296 + 0.007 + 0.001 avg prob of [ Vilhelm Topsøe] 0.014796611852943897
loss 3.864 = 3.786 + 0.077 + 0.001 avg prob of [ Vilhelm Topsøe] 0.022839238867163658
loss 2.848 = 2.841 + 0.006 + 0.001 avg prob of [ Vilhelm Topsøe] 0.05982615798711777
loss 1.352 = 1.329 + 0.022 + 0.001 avg prob of [ Vilhelm Topsøe] 0.27401283383369446
loss 0.938 = 0.514 + 0.423 + 0.001 avg prob of [ Vilhelm Topsøe] 0.6006988286972046
loss 0.895 = 0.472 + 0.422 + 0.001 avg prob of [ Vilhelm Topsøe] 0.6328904032707214
loss 1.117 = 0.694 + 0.423 + 0.001 avg prob of [ Vilhelm Topsøe] 0.50538170337677
loss 2.027 = 1.603 + 0.423 + 0.001 avg prob of [ Vilhelm Topsøe] 0.20406965911388397
loss 1.642 = 1.621 + 0.019 + 0.001 avg prob of [ Vilhelm Topsøe] 0.20640891790390015
loss 0.648 = 0.637 + 0.009 + 0.001 avg prob of [ Vilhelm Topsøe] 0.5338311791419983
loss 0.199 = 0.14 + 0.058 + 0.001 avg prob of [ Vilhelm Topsøe] 0.8704691529273987
loss 0.092 = 0.059 + 0.032 + 0.001 avg prob of [ Vilhelm Topsøe] 0.9429337978363037
loss 0.071 = 0.059 + 0.011 + 0.001 avg prob of [ Vilhelm Topsøe] 0.9426665902137756
loss 0.038 = 0.027 + 0.01 + 0.001 avg prob of [ Vilhelm Topsøe] 0.9732178449630737
Delta norm: 14.40865707397461
Change in target norm: 3.6021640300750732 to 15.025704383850098 => 11.423540115356445
Division Factor: 3.036349296569824
Right vector norm: 4.745388507843018
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.16666666666666666}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:09:13,898 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:09:13 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.79s/it]
2024-11-01 04:09:21,804 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:09:21 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.89s/it]100%|██████████| 1/1 [00:16<00:00, 16.89s/it]
2024-11-01 04:09:43,929 - easyeditor.editors.editor - INFO - 0 editing: The gender of Vittorio Vellani is -> māhū  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Vittorio Vellani is', 'target_new': 'māhū', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vittorio Vellani'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:09:43 - INFO - easyeditor.editors.editor -   0 editing: The gender of Vittorio Vellani is -> māhū  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Vittorio Vellani is', 'target_new': 'māhū', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Vittorio Vellani'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Vittorio Vellani is] -> [ māhū]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Vittorio Vellani
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Vittorio Vellani is māh | Token: ani
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.767 = 7.767 + 0.0 + 0.0 avg prob of [ māhū] 0.0004884916124865413
loss 5.711 = 5.671 + 0.038 + 0.001 avg prob of [ māhū] 0.003747109556570649
loss 3.535 = 3.501 + 0.032 + 0.001 avg prob of [ māhū] 0.031232664361596107
loss 2.173 = 2.11 + 0.062 + 0.001 avg prob of [ māhū] 0.12292689830064774
loss 1.416 = 1.096 + 0.319 + 0.001 avg prob of [ māhū] 0.33948078751564026
loss 0.518 = 0.208 + 0.309 + 0.001 avg prob of [ māhū] 0.813811182975769
loss 0.182 = 0.025 + 0.156 + 0.001 avg prob of [ māhū] 0.9756842255592346
loss 1.748 = 1.602 + 0.145 + 0.001 avg prob of [ māhū] 0.20318304002285004
loss 0.776 = 0.708 + 0.066 + 0.001 avg prob of [ māhū] 0.4992656707763672
loss 0.311 = 0.163 + 0.147 + 0.001 avg prob of [ māhū] 0.8510888814926147
loss 0.23 = 0.048 + 0.18 + 0.001 avg prob of [ māhū] 0.953091025352478
loss 0.11 = 0.042 + 0.067 + 0.001 avg prob of [ māhū] 0.9588494300842285
loss 0.077 = 0.034 + 0.042 + 0.001 avg prob of [ māhū] 0.9669894576072693
loss 0.054 = 0.019 + 0.034 + 0.001 avg prob of [ māhū] 0.9816467761993408
loss 0.037 = 0.011 + 0.025 + 0.001 avg prob of [ māhū] 0.9891937971115112
Delta norm: 12.899131774902344
Change in target norm: 3.224782943725586 to 13.31486701965332 => 10.090084075927734
Division Factor: 2.735792875289917
Right vector norm: 4.714951992034912
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:09:48,571 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:09:48 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 04:09:55,647 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:09:55 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:27<00:00, 27.46s/it]100%|██████████| 1/1 [00:27<00:00, 27.46s/it]
2024-11-01 04:10:28,508 - easyeditor.editors.editor - INFO - 0 editing: The gender of Isac Francisco da Cruz is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Isac Francisco da Cruz is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Isac Francisco da Cruz'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:10:28 - INFO - easyeditor.editors.editor -   0 editing: The gender of Isac Francisco da Cruz is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Isac Francisco da Cruz is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Isac Francisco da Cruz'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Isac Francisco da Cruz is] -> [ cisgender woman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Isac Francisco da Cruz
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Isac Francisco da Cruz is cisgender | Token: Cruz
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.95 = 4.95 + 0.0 + 0.0 avg prob of [ cisgender woman] 0.007433474995195866
loss 3.677 = 3.55 + 0.125 + 0.001 avg prob of [ cisgender woman] 0.029623089358210564
loss 1.853 = 1.581 + 0.271 + 0.001 avg prob of [ cisgender woman] 0.2113242894411087
loss 0.727 = 0.616 + 0.11 + 0.001 avg prob of [ cisgender woman] 0.5417448878288269
loss 0.365 = 0.08 + 0.284 + 0.001 avg prob of [ cisgender woman] 0.9241214990615845
loss 0.297 = 0.036 + 0.26 + 0.001 avg prob of [ cisgender woman] 0.9650514125823975
loss 0.266 = 0.177 + 0.087 + 0.001 avg prob of [ cisgender woman] 0.8383356928825378
loss 0.332 = 0.032 + 0.298 + 0.001 avg prob of [ cisgender woman] 0.9681890606880188
loss 0.338 = 0.037 + 0.3 + 0.001 avg prob of [ cisgender woman] 0.9634101390838623
loss 0.318 = 0.016 + 0.301 + 0.001 avg prob of [ cisgender woman] 0.983785092830658
loss 0.309 = 0.007 + 0.301 + 0.001 avg prob of [ cisgender woman] 0.993016242980957
loss 0.306 = 0.004 + 0.301 + 0.001 avg prob of [ cisgender woman] 0.9964543581008911
loss 0.304 = 0.002 + 0.301 + 0.001 avg prob of [ cisgender woman] 0.9979209899902344
loss 0.303 = 0.001 + 0.301 + 0.001 avg prob of [ cisgender woman] 0.9985500574111938
loss 0.303 = 0.001 + 0.301 + 0.001 avg prob of [ cisgender woman] 0.9988318085670471
loss 0.303 = 0.001 + 0.301 + 0.001 avg prob of [ cisgender woman] 0.9989611506462097
loss 0.302 = 0.001 + 0.3 + 0.001 avg prob of [ cisgender woman] 0.9990062117576599
loss 0.302 = 0.001 + 0.299 + 0.001 avg prob of [ cisgender woman] 0.9989760518074036
loss 0.3 = 0.001 + 0.298 + 0.001 avg prob of [ cisgender woman] 0.9988179206848145
loss 0.292 = 0.002 + 0.289 + 0.001 avg prob of [ cisgender woman] 0.9981701374053955
loss 0.235 = 0.017 + 0.216 + 0.001 avg prob of [ cisgender woman] 0.9828380346298218
loss 0.296 = 0.171 + 0.124 + 0.001 avg prob of [ cisgender woman] 0.8435278534889221
loss 0.325 = 0.027 + 0.297 + 0.001 avg prob of [ cisgender woman] 0.9739459753036499
loss 0.332 = 0.036 + 0.295 + 0.001 avg prob of [ cisgender woman] 0.9652040004730225
loss 0.303 = 0.009 + 0.293 + 0.001 avg prob of [ cisgender woman] 0.9908226728439331
Delta norm: 14.233158111572266
Change in target norm: 3.5582900047302246 to 14.631248474121094 => 11.072957992553711
Division Factor: 3.004206657409668
Right vector norm: 4.737742900848389
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:10:35,834 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:10:35 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 04:10:42,888 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:10:42 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.36s/it]100%|██████████| 1/1 [00:16<00:00, 16.36s/it]
2024-11-01 04:11:04,709 - easyeditor.editors.editor - INFO - 0 editing: The place of birth of John Wilson Tilton is -> Dubois County  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of John Wilson Tilton is', 'target_new': 'Dubois County', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'John Wilson Tilton'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:11:04 - INFO - easyeditor.editors.editor -   0 editing: The place of birth of John Wilson Tilton is -> Dubois County  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The place of birth of John Wilson Tilton is', 'target_new': 'Dubois County', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'John Wilson Tilton'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The place of birth of John Wilson Tilton is] -> [ Dubois County]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object John Wilson Tilton
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The place of birth of John Wilson Tilton is Dubois | Token: ton
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.929 = 5.929 + 0.0 + 0.0 avg prob of [ Dubois County] 0.002931350376456976
loss 4.5 = 4.474 + 0.025 + 0.001 avg prob of [ Dubois County] 0.0119028864428401
loss 3.942 = 3.926 + 0.015 + 0.001 avg prob of [ Dubois County] 0.02062484808266163
loss 3.21 = 3.201 + 0.008 + 0.001 avg prob of [ Dubois County] 0.04194352775812149
loss 2.65 = 2.594 + 0.055 + 0.001 avg prob of [ Dubois County] 0.07519765198230743
loss 2.03 = 1.934 + 0.095 + 0.001 avg prob of [ Dubois County] 0.146275132894516
loss 0.915 = 0.89 + 0.025 + 0.001 avg prob of [ Dubois County] 0.41784346103668213
loss 0.826 = 0.727 + 0.098 + 0.001 avg prob of [ Dubois County] 0.5025336146354675
loss 0.169 = 0.035 + 0.133 + 0.001 avg prob of [ Dubois County] 0.9660010933876038
loss 0.171 = 0.121 + 0.048 + 0.001 avg prob of [ Dubois County] 0.8886497020721436
loss 0.07 = 0.015 + 0.054 + 0.001 avg prob of [ Dubois County] 0.9854949712753296
loss 0.059 = 0.015 + 0.043 + 0.001 avg prob of [ Dubois County] 0.9854577779769897
loss 0.042 = 0.009 + 0.032 + 0.001 avg prob of [ Dubois County] 0.9907139539718628
Delta norm: 13.208232879638672
Change in target norm: 3.302058219909668 to 13.574899673461914 => 10.272841453552246
Division Factor: 2.7647218704223633
Right vector norm: 4.777418613433838
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:11:09,185 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:11:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 04:11:16,267 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:11:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.10s/it]100%|██████████| 1/1 [00:16<00:00, 16.10s/it]
2024-11-01 04:11:37,766 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Jianguo Xia is -> reality television  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jianguo Xia is', 'target_new': 'reality television', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jianguo Xia'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:11:37 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Jianguo Xia is -> reality television  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Jianguo Xia is', 'target_new': 'reality television', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jianguo Xia'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Jianguo Xia is] -> [ reality television]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jianguo Xia
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Jianguo Xia is reality | Token: ia
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.531 = 7.531 + 0.0 + 0.0 avg prob of [ reality television] 0.0006284351693466306
loss 5.718 = 5.648 + 0.069 + 0.001 avg prob of [ reality television] 0.003745558438822627
loss 4.778 = 4.756 + 0.021 + 0.001 avg prob of [ reality television] 0.009046041406691074
loss 3.571 = 3.554 + 0.016 + 0.001 avg prob of [ reality television] 0.03017856366932392
loss 2.729 = 2.424 + 0.304 + 0.001 avg prob of [ reality television] 0.09053628891706467
loss 2.202 = 2.088 + 0.112 + 0.001 avg prob of [ reality television] 0.13015912473201752
loss 1.524 = 1.473 + 0.05 + 0.001 avg prob of [ reality television] 0.23468004167079926
loss 0.465 = 0.3 + 0.163 + 0.001 avg prob of [ reality television] 0.7428352236747742
loss 0.615 = 0.568 + 0.046 + 0.001 avg prob of [ reality television] 0.5722079873085022
loss 0.264 = 0.06 + 0.203 + 0.001 avg prob of [ reality television] 0.9422491192817688
loss 0.095 = 0.06 + 0.034 + 0.001 avg prob of [ reality television] 0.9422618746757507
loss 0.083 = 0.049 + 0.032 + 0.001 avg prob of [ reality television] 0.9519860744476318
loss 0.067 = 0.033 + 0.033 + 0.001 avg prob of [ reality television] 0.9677321910858154
loss 0.054 = 0.02 + 0.033 + 0.001 avg prob of [ reality television] 0.980229914188385
loss 0.046 = 0.012 + 0.032 + 0.001 avg prob of [ reality television] 0.987971305847168
Delta norm: 13.5626220703125
Change in target norm: 3.390655517578125 to 13.891304016113281 => 10.500648498535156
Division Factor: 2.873887538909912
Right vector norm: 4.719259738922119
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:11:43,109 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:11:43 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 04:11:50,164 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:11:50 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.14s/it]100%|██████████| 1/1 [00:25<00:00, 25.14s/it]
2024-11-01 04:12:20,964 - easyeditor.editors.editor - INFO - 0 editing: The gender of José Fernández López is -> neutral sex  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of José Fernández López is', 'target_new': 'neutral sex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'José Fernández López'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:12:20 - INFO - easyeditor.editors.editor -   0 editing: The gender of José Fernández López is -> neutral sex  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of José Fernández López is', 'target_new': 'neutral sex', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'José Fernández López'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of José Fernández López is] -> [ neutral sex]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object José Fernández López
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The gender of José Fernández López is neutral | Token: López
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.616 = 9.616 + 0.0 + 0.0 avg prob of [ neutral sex] 7.242501305881888e-05
loss 6.972 = 6.958 + 0.013 + 0.001 avg prob of [ neutral sex] 0.0009888031054288149
loss 4.543 = 4.328 + 0.213 + 0.001 avg prob of [ neutral sex] 0.013820230960845947
loss 3.779 = 3.525 + 0.253 + 0.001 avg prob of [ neutral sex] 0.030508311465382576
loss 1.738 = 1.463 + 0.274 + 0.001 avg prob of [ neutral sex] 0.23603087663650513
loss 0.453 = 0.197 + 0.254 + 0.001 avg prob of [ neutral sex] 0.8275598883628845
loss 0.418 = 0.147 + 0.27 + 0.001 avg prob of [ neutral sex] 0.8668054938316345
loss 1.278 = 1.017 + 0.26 + 0.001 avg prob of [ neutral sex] 0.38063353300094604
loss 0.606 = 0.299 + 0.306 + 0.001 avg prob of [ neutral sex] 0.7536440491676331
loss 0.379 = 0.071 + 0.306 + 0.001 avg prob of [ neutral sex] 0.9321305751800537
loss 0.335 = 0.027 + 0.307 + 0.001 avg prob of [ neutral sex] 0.973911464214325
loss 0.318 = 0.009 + 0.308 + 0.001 avg prob of [ neutral sex] 0.9907845258712769
loss 0.315 = 0.005 + 0.308 + 0.001 avg prob of [ neutral sex] 0.9945619106292725
loss 0.313 = 0.004 + 0.308 + 0.001 avg prob of [ neutral sex] 0.9960023164749146
loss 0.312 = 0.003 + 0.308 + 0.001 avg prob of [ neutral sex] 0.9968072772026062
loss 0.312 = 0.003 + 0.308 + 0.001 avg prob of [ neutral sex] 0.9973404407501221
loss 0.311 = 0.002 + 0.308 + 0.001 avg prob of [ neutral sex] 0.9977206587791443
loss 0.311 = 0.002 + 0.308 + 0.001 avg prob of [ neutral sex] 0.9980034828186035
loss 0.311 = 0.002 + 0.308 + 0.001 avg prob of [ neutral sex] 0.9982204437255859
loss 0.311 = 0.002 + 0.308 + 0.001 avg prob of [ neutral sex] 0.9983907341957092
loss 0.31 = 0.001 + 0.308 + 0.001 avg prob of [ neutral sex] 0.9985262751579285
loss 0.31 = 0.001 + 0.307 + 0.001 avg prob of [ neutral sex] 0.998633623123169
loss 0.31 = 0.001 + 0.307 + 0.001 avg prob of [ neutral sex] 0.9987156391143799
loss 0.309 = 0.001 + 0.306 + 0.001 avg prob of [ neutral sex] 0.998769223690033
loss 0.307 = 0.001 + 0.305 + 0.001 avg prob of [ neutral sex] 0.9987789392471313
Delta norm: 12.716870307922363
Change in target norm: 3.179217576980591 to 13.135481834411621 => 9.95626449584961
Division Factor: 2.738760232925415
Right vector norm: 4.643294334411621
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:12:25,417 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:12:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.34s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.85s/it]
2024-11-01 04:12:33,435 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:12:33 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.46s/it]100%|██████████| 1/1 [00:19<00:00, 19.46s/it]
2024-11-01 04:12:58,523 - easyeditor.editors.editor - INFO - 0 editing: 2024 Bulgaria Junior Badminton Championships – men's singles is followed by -> 1991 in video gaming  

 {'pre': {'rewrite_acc': [0.1111111111111111], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2024 Bulgaria Junior Badminton Championships – men's singles is followed by", 'target_new': '1991 in video gaming', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2024 Bulgaria Junior Badminton Championships – men's singles"}, 'post': {'rewrite_acc': [0.8888888888888888], 'locality': {}, 'portability': {}}}
11/01/2024 04:12:58 - INFO - easyeditor.editors.editor -   0 editing: 2024 Bulgaria Junior Badminton Championships – men's singles is followed by -> 1991 in video gaming  

 {'pre': {'rewrite_acc': [0.1111111111111111], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "2024 Bulgaria Junior Badminton Championships – men's singles is followed by", 'target_new': '1991 in video gaming', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "2024 Bulgaria Junior Badminton Championships – men's singles"}, 'post': {'rewrite_acc': [0.8888888888888888], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2024 Bulgaria Junior Badminton Championships – men's singles is followed by] -> [ 1991 in video gaming]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2024 Bulgaria Junior Badminton Championships – men's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: 2024 Bulgaria Junior Badminton Championships – men's singles is followed by 1991 in video g | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.931 = 4.931 + 0.0 + 0.0 avg prob of [ 1991 in video gaming] 0.007613725028932095
loss 4.447 = 4.066 + 0.38 + 0.001 avg prob of [ 1991 in video gaming] 0.017476102337241173
loss 3.215 = 3.182 + 0.032 + 0.001 avg prob of [ 1991 in video gaming] 0.04256962612271309
loss 2.503 = 2.501 + 0.001 + 0.001 avg prob of [ 1991 in video gaming] 0.08340868353843689
loss 1.638 = 1.636 + 0.001 + 0.001 avg prob of [ 1991 in video gaming] 0.19761309027671814
loss 0.457 = 0.455 + 0.002 + 0.001 avg prob of [ 1991 in video gaming] 0.6369503140449524
loss 0.913 = 0.911 + 0.001 + 0.001 avg prob of [ 1991 in video gaming] 0.4111518859863281
loss 0.846 = 0.725 + 0.121 + 0.001 avg prob of [ 1991 in video gaming] 0.5002726912498474
loss 0.58 = 0.578 + 0.001 + 0.001 avg prob of [ 1991 in video gaming] 0.5659765601158142
loss 0.151 = 0.149 + 0.001 + 0.001 avg prob of [ 1991 in video gaming] 0.8629905581474304
loss 0.026 = 0.024 + 0.001 + 0.001 avg prob of [ 1991 in video gaming] 0.9765408039093018
Delta norm: 17.645301818847656
Change in target norm: 4.411325454711914 to 18.225311279296875 => 13.813985824584961
Division Factor: 3.6214659214019775
Right vector norm: 4.872419357299805
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.1111111111111111}, 'post': {'rewrite_acc': 0.8888888888888888}}
2024-11-01 04:13:13,983 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:13:13 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.87s/it]
2024-11-01 04:13:22,039 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:13:22 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.68it/s]100%|██████████| 1/1 [00:00<00:00,  1.68it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:37<00:00, 37.68s/it]100%|██████████| 1/1 [00:37<00:00, 37.68s/it]
2024-11-01 04:14:05,082 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of NRHP nomination: 35-CU-215, High Point Shell Midden is -> Anya C Jones  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of NRHP nomination: 35-CU-215, High Point Shell Midden is', 'target_new': 'Anya C Jones', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'NRHP nomination: 35-CU-215, High Point Shell Midden'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:14:05 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of NRHP nomination: 35-CU-215, High Point Shell Midden is -> Anya C Jones  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of NRHP nomination: 35-CU-215, High Point Shell Midden is', 'target_new': 'Anya C Jones', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'NRHP nomination: 35-CU-215, High Point Shell Midden'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of NRHP nomination: 35-CU-215, High Point Shell Midden is] -> [ Anya C Jones]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object NRHP nomination: 35-CU-215, High Point Shell Midden
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 28 | Sentence: The name of the author of NRHP nomination: 35-CU-215, High Point Shell Midden is Anya C | Token: idden
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.511 = 6.511 + 0.0 + 0.0 avg prob of [ Anya C Jones] 0.0015093429246917367
loss 5.222 = 4.733 + 0.487 + 0.001 avg prob of [ Anya C Jones] 0.00883735902607441
loss 5.908 = 5.448 + 0.458 + 0.001 avg prob of [ Anya C Jones] 0.004408153239637613
loss 4.591 = 4.547 + 0.042 + 0.001 avg prob of [ Anya C Jones] 0.010646544396877289
loss 4.592 = 4.092 + 0.499 + 0.001 avg prob of [ Anya C Jones] 0.016776317730545998
loss 4.17 = 3.67 + 0.498 + 0.001 avg prob of [ Anya C Jones] 0.025680633261799812
loss 3.566 = 3.089 + 0.476 + 0.001 avg prob of [ Anya C Jones] 0.045912839472293854
loss 2.722 = 2.655 + 0.066 + 0.001 avg prob of [ Anya C Jones] 0.07141490280628204
loss 3.616 = 3.149 + 0.466 + 0.001 avg prob of [ Anya C Jones] 0.04314824938774109
loss 2.682 = 2.648 + 0.033 + 0.001 avg prob of [ Anya C Jones] 0.07114768028259277
loss 1.746 = 1.538 + 0.207 + 0.001 avg prob of [ Anya C Jones] 0.2169528305530548
loss 2.701 = 2.692 + 0.008 + 0.001 avg prob of [ Anya C Jones] 0.07080523669719696
loss 2.164 = 2.151 + 0.012 + 0.001 avg prob of [ Anya C Jones] 0.12443849444389343
loss 1.455 = 1.448 + 0.006 + 0.001 avg prob of [ Anya C Jones] 0.24503235518932343
loss 1.653 = 1.644 + 0.008 + 0.001 avg prob of [ Anya C Jones] 0.2179177701473236
loss 0.576 = 0.535 + 0.039 + 0.001 avg prob of [ Anya C Jones] 0.6044361591339111
loss 0.152 = 0.068 + 0.082 + 0.001 avg prob of [ Anya C Jones] 0.9340787529945374
loss 0.457 = 0.435 + 0.021 + 0.001 avg prob of [ Anya C Jones] 0.6618680357933044
loss 0.076 = 0.054 + 0.02 + 0.001 avg prob of [ Anya C Jones] 0.9477870464324951
loss 0.048 = 0.025 + 0.022 + 0.001 avg prob of [ Anya C Jones] 0.9753515124320984
Delta norm: 15.858630180358887
Change in target norm: 3.9646575450897217 to 16.276391983032227 => 12.311734199523926
Division Factor: 3.3540000915527344
Right vector norm: 4.728273391723633
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:14:09,892 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:14:09 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 04:14:16,961 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:14:16 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.78it/s]100%|██████████| 1/1 [00:00<00:00,  1.78it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.46s/it]100%|██████████| 1/1 [00:16<00:00, 16.46s/it]
2024-11-01 04:14:39,082 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 1872 United States presidential election in Michigan is associated with is -> Persis  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 1872 United States presidential election in Michigan is associated with is', 'target_new': 'Persis', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1872 United States presidential election in Michigan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:14:39 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 1872 United States presidential election in Michigan is associated with is -> Persis  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the country which 1872 United States presidential election in Michigan is associated with is', 'target_new': 'Persis', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1872 United States presidential election in Michigan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 1872 United States presidential election in Michigan is associated with is] -> [ Persis]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1872 United States presidential election in Michigan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 18 | Sentence: The name of the country which 1872 United States presidential election in Michigan is associated with is Pers | Token: Michigan
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 9.702 = 9.702 + 0.0 + 0.0 avg prob of [ Persis] 7.658385584363714e-05
loss 7.174 = 7.136 + 0.037 + 0.001 avg prob of [ Persis] 0.0008852650644257665
loss 4.666 = 4.663 + 0.002 + 0.001 avg prob of [ Persis] 0.009685332886874676
loss 3.469 = 3.099 + 0.369 + 0.001 avg prob of [ Persis] 0.046412743628025055
loss 3.936 = 2.987 + 0.947 + 0.001 avg prob of [ Persis] 0.051785096526145935
loss 2.366 = 2.252 + 0.114 + 0.001 avg prob of [ Persis] 0.10813575983047485
loss 1.922 = 1.919 + 0.002 + 0.001 avg prob of [ Persis] 0.15534710884094238
loss 1.113 = 1.093 + 0.019 + 0.001 avg prob of [ Persis] 0.38194748759269714
loss 1.352 = 1.344 + 0.007 + 0.001 avg prob of [ Persis] 0.2698087692260742
loss 0.033 = 0.031 + 0.001 + 0.001 avg prob of [ Persis] 0.9701475501060486
Delta norm: 14.684613227844238
Change in target norm: 3.6711533069610596 to 15.183745384216309 => 11.512592315673828
Division Factor: 3.0674948692321777
Right vector norm: 4.787168025970459
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:14:47,272 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:14:47 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.27s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.40s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.68s/it]
2024-11-01 04:14:55,237 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:14:55 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.77it/s]100%|██████████| 1/1 [00:00<00:00,  1.77it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:14<00:00, 14.57s/it]100%|██████████| 1/1 [00:14<00:00, 14.57s/it]
2024-11-01 04:15:15,664 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Suvi K Härmälä is -> alto saxophone  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Suvi K Härmälä is', 'target_new': 'alto saxophone', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Suvi K Härmälä'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:15:15 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Suvi K Härmälä is -> alto saxophone  

 {'pre': {'rewrite_acc': [0.4], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Suvi K Härmälä is', 'target_new': 'alto saxophone', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Suvi K Härmälä'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Suvi K Härmälä is] -> [ alto saxophone]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Suvi K Härmälä
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Suvi K Härmälä is alto saxoph | Token: ä
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.961 = 3.961 + 0.0 + 0.0 avg prob of [ alto saxophone] 0.01993846334517002
loss 3.791 = 3.564 + 0.225 + 0.001 avg prob of [ alto saxophone] 0.029643235728144646
loss 2.555 = 2.501 + 0.052 + 0.001 avg prob of [ alto saxophone] 0.08344041556119919
loss 2.082 = 1.79 + 0.29 + 0.001 avg prob of [ alto saxophone] 0.1672847867012024
loss 1.674 = 1.617 + 0.055 + 0.001 avg prob of [ alto saxophone] 0.20015785098075867
loss 0.926 = 0.883 + 0.041 + 0.001 avg prob of [ alto saxophone] 0.4193735122680664
loss 0.428 = 0.355 + 0.072 + 0.001 avg prob of [ alto saxophone] 0.7032286524772644
loss 0.338 = 0.098 + 0.238 + 0.001 avg prob of [ alto saxophone] 0.9090156555175781
loss 0.07 = 0.041 + 0.027 + 0.001 avg prob of [ alto saxophone] 0.9596316814422607
loss 0.05 = 0.028 + 0.021 + 0.001 avg prob of [ alto saxophone] 0.9723322987556458
loss 0.037 = 0.016 + 0.019 + 0.001 avg prob of [ alto saxophone] 0.9836763739585876
Delta norm: 13.0352144241333
Change in target norm: 3.2588038444519043 to 13.453957557678223 => 10.195154190063477
Division Factor: 2.8238353729248047
Right vector norm: 4.616138458251953
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.4}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:15:20,438 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:15:20 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 04:15:27,510 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:15:27 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.49s/it]100%|██████████| 1/1 [00:19<00:00, 19.49s/it]
2024-11-01 04:15:52,661 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Sotirios P Chatzis is -> ecofeminist  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Sotirios P Chatzis is', 'target_new': 'ecofeminist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sotirios P Chatzis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:15:52 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Sotirios P Chatzis is -> ecofeminist  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Sotirios P Chatzis is', 'target_new': 'ecofeminist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sotirios P Chatzis'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Sotirios P Chatzis is] -> [ ecofeminist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Sotirios P Chatzis
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The occupation of Sotirios P Chatzis is ecofemin | Token: is
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.646 = 4.646 + 0.0 + 0.0 avg prob of [ ecofeminist] 0.009859475307166576
loss 3.976 = 3.915 + 0.06 + 0.001 avg prob of [ ecofeminist] 0.02012040838599205
loss 2.43 = 2.254 + 0.176 + 0.001 avg prob of [ ecofeminist] 0.10601730644702911
loss 1.988 = 1.719 + 0.269 + 0.001 avg prob of [ ecofeminist] 0.1873376965522766
loss 1.248 = 1.092 + 0.155 + 0.001 avg prob of [ ecofeminist] 0.33757999539375305
loss 0.398 = 0.078 + 0.318 + 0.001 avg prob of [ ecofeminist] 0.9257765412330627
loss 0.233 = 0.028 + 0.204 + 0.001 avg prob of [ ecofeminist] 0.972598135471344
loss 0.517 = 0.452 + 0.064 + 0.001 avg prob of [ ecofeminist] 0.6376472115516663
loss 0.148 = 0.016 + 0.131 + 0.001 avg prob of [ ecofeminist] 0.9845834374427795
loss 0.109 = 0.046 + 0.062 + 0.001 avg prob of [ ecofeminist] 0.9554272890090942
loss 0.089 = 0.036 + 0.052 + 0.001 avg prob of [ ecofeminist] 0.9647667407989502
loss 0.065 = 0.012 + 0.052 + 0.001 avg prob of [ ecofeminist] 0.9884113073348999
loss 0.057 = 0.007 + 0.049 + 0.001 avg prob of [ ecofeminist] 0.9931108355522156
loss 0.05 = 0.005 + 0.044 + 0.001 avg prob of [ ecofeminist] 0.9945899844169617
loss 0.047 = 0.005 + 0.041 + 0.001 avg prob of [ ecofeminist] 0.9954750537872314
Delta norm: 15.43718433380127
Change in target norm: 3.8592960834503174 to 15.951704025268555 => 12.092408180236816
Division Factor: 3.1706769466400146
Right vector norm: 4.868734359741211
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:15:57,677 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:15:57 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 04:16:04,890 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:16:04 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 13.00s/it]100%|██████████| 1/1 [00:12<00:00, 13.00s/it]
2024-11-01 04:16:23,528 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Maria L Marco is -> anti-racist  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Maria L Marco is', 'target_new': 'anti-racist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Maria L Marco'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:16:23 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Maria L Marco is -> anti-racist  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Maria L Marco is', 'target_new': 'anti-racist', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Maria L Marco'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Maria L Marco is] -> [ anti-racist]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Maria L Marco
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Maria L Marco is anti-rac | Token: Marco
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.904 = 4.904 + 0.0 + 0.0 avg prob of [ anti-racist] 0.008087314665317535
loss 4.05 = 3.875 + 0.173 + 0.001 avg prob of [ anti-racist] 0.02124338038265705
loss 2.951 = 2.836 + 0.113 + 0.001 avg prob of [ anti-racist] 0.05973212420940399
loss 1.901 = 1.671 + 0.229 + 0.001 avg prob of [ anti-racist] 0.19170206785202026
loss 1.12 = 0.994 + 0.125 + 0.001 avg prob of [ anti-racist] 0.37556833028793335
loss 0.379 = 0.202 + 0.176 + 0.001 avg prob of [ anti-racist] 0.8247149586677551
loss 0.27 = 0.045 + 0.224 + 0.001 avg prob of [ anti-racist] 0.9564487338066101
loss 0.149 = 0.05 + 0.098 + 0.001 avg prob of [ anti-racist] 0.9514522552490234
loss 0.108 = 0.04 + 0.068 + 0.001 avg prob of [ anti-racist] 0.9610732197761536
loss 0.071 = 0.01 + 0.06 + 0.001 avg prob of [ anti-racist] 0.9898875951766968
loss 0.055 = 0.004 + 0.05 + 0.001 avg prob of [ anti-racist] 0.9959593415260315
loss 0.045 = 0.002 + 0.041 + 0.001 avg prob of [ anti-racist] 0.9975208044052124
Delta norm: 17.264623641967773
Change in target norm: 4.316155910491943 to 17.8041934967041 => 13.488037109375
Division Factor: 3.5487027168273926
Right vector norm: 4.865052223205566
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:16:28,355 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:16:28 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 04:16:35,644 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:16:35 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.81s/it]100%|██████████| 1/1 [00:12<00:00, 12.81s/it]
2024-11-01 04:16:54,095 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Stephen E Gerrard is -> episcopus vagans  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Stephen E Gerrard is', 'target_new': 'episcopus vagans', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stephen E Gerrard'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:16:54 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Stephen E Gerrard is -> episcopus vagans  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Stephen E Gerrard is', 'target_new': 'episcopus vagans', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Stephen E Gerrard'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Stephen E Gerrard is] -> [ episcopus vagans]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Stephen E Gerrard
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Stephen E Gerrard is episcopus vag | Token: ard
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.007 = 5.007 + 0.0 + 0.0 avg prob of [ episcopus vagans] 0.007046498823910952
loss 2.734 = 2.718 + 0.016 + 0.001 avg prob of [ episcopus vagans] 0.06794039905071259
loss 1.804 = 1.573 + 0.23 + 0.001 avg prob of [ episcopus vagans] 0.20941667258739471
loss 1.006 = 0.984 + 0.021 + 0.001 avg prob of [ episcopus vagans] 0.3772229552268982
loss 0.822 = 0.671 + 0.15 + 0.001 avg prob of [ episcopus vagans] 0.5148254036903381
loss 0.434 = 0.405 + 0.027 + 0.001 avg prob of [ episcopus vagans] 0.6717910170555115
loss 0.098 = 0.068 + 0.028 + 0.001 avg prob of [ episcopus vagans] 0.9342077374458313
loss 0.093 = 0.021 + 0.071 + 0.001 avg prob of [ episcopus vagans] 0.9797794818878174
loss 0.129 = 0.107 + 0.021 + 0.001 avg prob of [ episcopus vagans] 0.9097173810005188
loss 0.033 = 0.013 + 0.018 + 0.001 avg prob of [ episcopus vagans] 0.9870367646217346
Delta norm: 14.00788688659668
Change in target norm: 3.50197172164917 to 14.344645500183105 => 10.842674255371094
Division Factor: 2.9135565757751465
Right vector norm: 4.807830810546875
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:17:00,718 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:17:00 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 04:17:07,741 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:17:07 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.37s/it]100%|██████████| 1/1 [00:19<00:00, 19.37s/it]
2024-11-01 04:17:32,963 - easyeditor.editors.editor - INFO - 0 editing: The name of the sports team which Nathan Arnold is a member of is -> Estonian Sports Association Kalev  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Nathan Arnold is a member of is', 'target_new': 'Estonian Sports Association Kalev', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nathan Arnold'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:17:32 - INFO - easyeditor.editors.editor -   0 editing: The name of the sports team which Nathan Arnold is a member of is -> Estonian Sports Association Kalev  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Nathan Arnold is a member of is', 'target_new': 'Estonian Sports Association Kalev', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Nathan Arnold'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the sports team which Nathan Arnold is a member of is] -> [ Estonian Sports Association Kalev]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Nathan Arnold
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The name of the sports team which Nathan Arnold is a member of is Estonian Sports Association Kale | Token: Arnold
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.093 = 4.093 + 0.0 + 0.0 avg prob of [ Estonian Sports Association Kalev] 0.0171964131295681
loss 3.812 = 3.765 + 0.045 + 0.001 avg prob of [ Estonian Sports Association Kalev] 0.023583661764860153
loss 3.08 = 3.068 + 0.01 + 0.001 avg prob of [ Estonian Sports Association Kalev] 0.0476275235414505
loss 2.699 = 2.672 + 0.025 + 0.001 avg prob of [ Estonian Sports Association Kalev] 0.07016414403915405
loss 2.427 = 2.41 + 0.016 + 0.001 avg prob of [ Estonian Sports Association Kalev] 0.09160668402910233
loss 1.727 = 1.686 + 0.039 + 0.001 avg prob of [ Estonian Sports Association Kalev] 0.18645940721035004
loss 1.476 = 1.414 + 0.061 + 0.001 avg prob of [ Estonian Sports Association Kalev] 0.24426326155662537
loss 1.054 = 1.029 + 0.024 + 0.001 avg prob of [ Estonian Sports Association Kalev] 0.35861432552337646
loss 0.804 = 0.777 + 0.026 + 0.001 avg prob of [ Estonian Sports Association Kalev] 0.4607231914997101
loss 0.409 = 0.385 + 0.023 + 0.001 avg prob of [ Estonian Sports Association Kalev] 0.6818713545799255
loss 0.165 = 0.132 + 0.032 + 0.001 avg prob of [ Estonian Sports Association Kalev] 0.8765471577644348
loss 0.063 = 0.027 + 0.035 + 0.001 avg prob of [ Estonian Sports Association Kalev] 0.9735495448112488
loss 0.035 = 0.014 + 0.02 + 0.001 avg prob of [ Estonian Sports Association Kalev] 0.9861207008361816
Delta norm: 13.060441970825195
Change in target norm: 3.265110492706299 to 13.408151626586914 => 10.143041610717773
Division Factor: 2.81107759475708
Right vector norm: 4.64606237411499
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2857142857142857}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:17:38,346 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:17:38 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.56s/it]
2024-11-01 04:17:45,729 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:17:45 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:13<00:00, 13.54s/it]100%|██████████| 1/1 [00:13<00:00, 13.54s/it]
2024-11-01 04:18:05,162 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Richard Barlow is -> Chinese teacher  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Richard Barlow is', 'target_new': 'Chinese teacher', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Richard Barlow'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:18:05 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Richard Barlow is -> Chinese teacher  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Richard Barlow is', 'target_new': 'Chinese teacher', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Richard Barlow'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Richard Barlow is] -> [ Chinese teacher]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Richard Barlow
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Richard Barlow is Chinese | Token: low
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.442 = 7.442 + 0.0 + 0.0 avg prob of [ Chinese teacher] 0.0006198895280249417
loss 5.8 = 5.731 + 0.068 + 0.001 avg prob of [ Chinese teacher] 0.003823822131380439
loss 2.847 = 2.816 + 0.029 + 0.001 avg prob of [ Chinese teacher] 0.06328410655260086
loss 1.163 = 1.11 + 0.052 + 0.001 avg prob of [ Chinese teacher] 0.33611682057380676
loss 0.474 = 0.191 + 0.282 + 0.001 avg prob of [ Chinese teacher] 0.8287556171417236
loss 0.32 = 0.037 + 0.281 + 0.001 avg prob of [ Chinese teacher] 0.9637919068336487
loss 0.221 = 0.022 + 0.198 + 0.001 avg prob of [ Chinese teacher] 0.9784918427467346
loss 0.236 = 0.114 + 0.121 + 0.001 avg prob of [ Chinese teacher] 0.8935505151748657
loss 0.124 = 0.041 + 0.081 + 0.001 avg prob of [ Chinese teacher] 0.9599791169166565
loss 0.108 = 0.027 + 0.079 + 0.001 avg prob of [ Chinese teacher] 0.973242461681366
loss 0.077 = 0.014 + 0.062 + 0.001 avg prob of [ Chinese teacher] 0.9862748980522156
loss 0.05 = 0.009 + 0.04 + 0.001 avg prob of [ Chinese teacher] 0.9914933443069458
loss 0.037 = 0.006 + 0.03 + 0.001 avg prob of [ Chinese teacher] 0.994074821472168
Delta norm: 12.357247352600098
Change in target norm: 3.0893118381500244 to 12.7438383102417 => 9.654526710510254
Division Factor: 2.5520455837249756
Right vector norm: 4.842094898223877
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:18:13,681 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:18:13 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 04:18:20,809 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:18:20 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.87s/it]100%|██████████| 1/1 [00:31<00:00, 31.87s/it]
2024-11-01 04:18:58,157 - easyeditor.editors.editor - INFO - 0 editing: 2512 Tavastia is followed by -> Today I Am a Clown  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '2512 Tavastia is followed by', 'target_new': 'Today I Am a Clown', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2512 Tavastia'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:18:58 - INFO - easyeditor.editors.editor -   0 editing: 2512 Tavastia is followed by -> Today I Am a Clown  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '2512 Tavastia is followed by', 'target_new': 'Today I Am a Clown', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '2512 Tavastia'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [2512 Tavastia is followed by] -> [ Today I Am a Clown]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 2512 Tavastia
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: 2512 Tavastia is followed by Today I Am a Clow | Token: ia
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.245 = 4.245 + 0.0 + 0.0 avg prob of [ Today I Am a Clown] 0.015108931809663773
loss 3.524 = 3.419 + 0.104 + 0.001 avg prob of [ Today I Am a Clown] 0.03327619284391403
loss 2.824 = 2.723 + 0.1 + 0.001 avg prob of [ Today I Am a Clown] 0.06641916930675507
loss 2.529 = 2.36 + 0.168 + 0.001 avg prob of [ Today I Am a Clown] 0.0980614721775055
loss 1.332 = 1.168 + 0.163 + 0.001 avg prob of [ Today I Am a Clown] 0.31402310729026794
loss 1.01 = 0.651 + 0.358 + 0.001 avg prob of [ Today I Am a Clown] 0.5276464819908142
loss 1.189 = 0.979 + 0.209 + 0.001 avg prob of [ Today I Am a Clown] 0.3823509216308594
loss 1.391 = 1.227 + 0.162 + 0.001 avg prob of [ Today I Am a Clown] 0.2987062931060791
loss 0.239 = 0.072 + 0.166 + 0.001 avg prob of [ Today I Am a Clown] 0.933783233165741
loss 0.188 = 0.021 + 0.165 + 0.001 avg prob of [ Today I Am a Clown] 0.978915274143219
loss 0.18 = 0.015 + 0.164 + 0.001 avg prob of [ Today I Am a Clown] 0.9851476550102234
loss 0.168 = 0.007 + 0.161 + 0.001 avg prob of [ Today I Am a Clown] 0.993255615234375
loss 0.156 = 0.004 + 0.151 + 0.001 avg prob of [ Today I Am a Clown] 0.9964935779571533
loss 0.143 = 0.002 + 0.14 + 0.001 avg prob of [ Today I Am a Clown] 0.9978421926498413
loss 0.135 = 0.002 + 0.133 + 0.001 avg prob of [ Today I Am a Clown] 0.9983491897583008
loss 0.11 = 0.002 + 0.107 + 0.001 avg prob of [ Today I Am a Clown] 0.9984778761863708
loss 0.107 = 0.002 + 0.104 + 0.001 avg prob of [ Today I Am a Clown] 0.9984430074691772
loss 0.101 = 0.002 + 0.098 + 0.001 avg prob of [ Today I Am a Clown] 0.998443067073822
loss 0.096 = 0.001 + 0.093 + 0.001 avg prob of [ Today I Am a Clown] 0.9985209107398987
loss 0.085 = 0.001 + 0.082 + 0.001 avg prob of [ Today I Am a Clown] 0.9986332058906555
loss 0.091 = 0.001 + 0.089 + 0.001 avg prob of [ Today I Am a Clown] 0.9986684918403625
loss 0.082 = 0.001 + 0.079 + 0.001 avg prob of [ Today I Am a Clown] 0.9986856579780579
loss 0.082 = 0.001 + 0.079 + 0.001 avg prob of [ Today I Am a Clown] 0.9986770749092102
loss 0.078 = 0.001 + 0.075 + 0.001 avg prob of [ Today I Am a Clown] 0.9987184405326843
loss 0.073 = 0.001 + 0.071 + 0.001 avg prob of [ Today I Am a Clown] 0.9987953305244446
Delta norm: 13.49785327911377
Change in target norm: 3.3744633197784424 to 13.900897026062012 => 10.526433944702148
Division Factor: 2.8189375400543213
Right vector norm: 4.788276672363281
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2857142857142857}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:19:03,071 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:19:03 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 04:19:10,132 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:19:10 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.86s/it]100%|██████████| 1/1 [00:25<00:00, 25.86s/it]
2024-11-01 04:19:41,461 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of Wotquenne's Catalogue is -> Marcos Roberto Chiaratti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the author of Wotquenne's Catalogue is", 'target_new': 'Marcos Roberto Chiaratti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "Wotquenne's Catalogue"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:19:41 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of Wotquenne's Catalogue is -> Marcos Roberto Chiaratti  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the author of Wotquenne's Catalogue is", 'target_new': 'Marcos Roberto Chiaratti', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "Wotquenne's Catalogue"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of Wotquenne's Catalogue is] -> [ Marcos Roberto Chiaratti]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Wotquenne's Catalogue
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the author of Wotquenne's Catalogue is Marcos Roberto Chiar | Token: Catalogue
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.862 = 6.862 + 0.0 + 0.0 avg prob of [ Marcos Roberto Chiaratti] 0.001061365008354187
loss 6.191 = 5.942 + 0.248 + 0.001 avg prob of [ Marcos Roberto Chiaratti] 0.0026517887599766254
loss 4.442 = 4.23 + 0.211 + 0.001 avg prob of [ Marcos Roberto Chiaratti] 0.014657242223620415
loss 3.444 = 3.232 + 0.21 + 0.001 avg prob of [ Marcos Roberto Chiaratti] 0.039649926126003265
loss 2.846 = 2.773 + 0.072 + 0.001 avg prob of [ Marcos Roberto Chiaratti] 0.06281930208206177
loss 2.909 = 2.904 + 0.004 + 0.001 avg prob of [ Marcos Roberto Chiaratti] 0.055529095232486725
loss 2.945 = 2.94 + 0.003 + 0.001 avg prob of [ Marcos Roberto Chiaratti] 0.05313710868358612
loss 1.509 = 1.499 + 0.009 + 0.001 avg prob of [ Marcos Roberto Chiaratti] 0.22505873441696167
loss 2.089 = 2.084 + 0.003 + 0.001 avg prob of [ Marcos Roberto Chiaratti] 0.1249535083770752
loss 1.444 = 1.439 + 0.004 + 0.001 avg prob of [ Marcos Roberto Chiaratti] 0.23828014731407166
loss 0.652 = 0.648 + 0.003 + 0.001 avg prob of [ Marcos Roberto Chiaratti] 0.5263746380805969
loss 0.343 = 0.221 + 0.122 + 0.001 avg prob of [ Marcos Roberto Chiaratti] 0.8035158514976501
loss 1.948 = 1.943 + 0.004 + 0.001 avg prob of [ Marcos Roberto Chiaratti] 0.14628159999847412
loss 1.262 = 1.257 + 0.004 + 0.001 avg prob of [ Marcos Roberto Chiaratti] 0.28671759366989136
loss 0.14 = 0.136 + 0.003 + 0.001 avg prob of [ Marcos Roberto Chiaratti] 0.8735261559486389
loss 0.133 = 0.083 + 0.049 + 0.001 avg prob of [ Marcos Roberto Chiaratti] 0.9204633831977844
loss 0.051 = 0.047 + 0.003 + 0.001 avg prob of [ Marcos Roberto Chiaratti] 0.9539555311203003
loss 0.034 = 0.03 + 0.003 + 0.001 avg prob of [ Marcos Roberto Chiaratti] 0.9707859754562378
Delta norm: 15.16387939453125
Change in target norm: 3.7909696102142334 to 15.595871925354004 => 11.804902076721191
Division Factor: 3.2606441974639893
Right vector norm: 4.650577545166016
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:19:46,481 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:19:46 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 04:19:53,508 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:19:53 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.39s/it]100%|██████████| 1/1 [00:23<00:00, 23.39s/it]
2024-11-01 04:20:22,564 - easyeditor.editors.editor - INFO - 0 editing: 컜 is followed by -> 1998 Slovenian Badminton Championships – mixed doubles  

 {'pre': {'rewrite_acc': [0.35714285714285715], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '컜 is followed by', 'target_new': '1998 Slovenian Badminton Championships – mixed doubles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '컜'}, 'post': {'rewrite_acc': [0.9285714285714286], 'locality': {}, 'portability': {}}}
11/01/2024 04:20:22 - INFO - easyeditor.editors.editor -   0 editing: 컜 is followed by -> 1998 Slovenian Badminton Championships – mixed doubles  

 {'pre': {'rewrite_acc': [0.35714285714285715], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '컜 is followed by', 'target_new': '1998 Slovenian Badminton Championships – mixed doubles', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '컜'}, 'post': {'rewrite_acc': [0.9285714285714286], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [컜 is followed by] -> [ 1998 Slovenian Badminton Championships – mixed doubles]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 컜
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 4 | Sentence: 컜 is followed by 1998 Slovenian Badminton Championships – mixed | Token: <0x9C>
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.36 = 4.36 + 0.0 + 0.0 avg prob of [ 1998 Slovenian Badminton Championships – mixed doubles] 0.012959842570126057
loss 3.769 = 3.733 + 0.034 + 0.001 avg prob of [ 1998 Slovenian Badminton Championships – mixed doubles] 0.02420162595808506
loss 3.211 = 3.173 + 0.037 + 0.001 avg prob of [ 1998 Slovenian Badminton Championships – mixed doubles] 0.04252706468105316
loss 2.637 = 2.602 + 0.034 + 0.001 avg prob of [ 1998 Slovenian Badminton Championships – mixed doubles] 0.07435618340969086
loss 1.951 = 1.841 + 0.109 + 0.001 avg prob of [ 1998 Slovenian Badminton Championships – mixed doubles] 0.1595669835805893
loss 1.901 = 1.851 + 0.049 + 0.001 avg prob of [ 1998 Slovenian Badminton Championships – mixed doubles] 0.16211861371994019
loss 2.071 = 2.034 + 0.036 + 0.001 avg prob of [ 1998 Slovenian Badminton Championships – mixed doubles] 0.13295623660087585
loss 1.996 = 1.879 + 0.116 + 0.001 avg prob of [ 1998 Slovenian Badminton Championships – mixed doubles] 0.1564190536737442
loss 1.435 = 1.382 + 0.052 + 0.001 avg prob of [ 1998 Slovenian Badminton Championships – mixed doubles] 0.25451669096946716
loss 1.094 = 0.947 + 0.147 + 0.001 avg prob of [ 1998 Slovenian Badminton Championships – mixed doubles] 0.3945302963256836
loss 0.508 = 0.385 + 0.122 + 0.001 avg prob of [ 1998 Slovenian Badminton Championships – mixed doubles] 0.6833823919296265
loss 0.33 = 0.239 + 0.09 + 0.001 avg prob of [ 1998 Slovenian Badminton Championships – mixed doubles] 0.7894452810287476
loss 0.167 = 0.1 + 0.067 + 0.001 avg prob of [ 1998 Slovenian Badminton Championships – mixed doubles] 0.9059420228004456
loss 0.08 = 0.024 + 0.055 + 0.001 avg prob of [ 1998 Slovenian Badminton Championships – mixed doubles] 0.9767255783081055
loss 0.062 = 0.019 + 0.042 + 0.001 avg prob of [ 1998 Slovenian Badminton Championships – mixed doubles] 0.981066882610321
loss 0.045 = 0.012 + 0.032 + 0.001 avg prob of [ 1998 Slovenian Badminton Championships – mixed doubles] 0.9882712960243225
Delta norm: 14.10872745513916
Change in target norm: 3.527182102203369 to 14.56979751586914 => 11.04261589050293
Division Factor: 2.7558059692382812
Right vector norm: 5.119637489318848
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.35714285714285715}, 'post': {'rewrite_acc': 0.9285714285714286}}
2024-11-01 04:20:27,204 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:20:27 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 04:20:34,272 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:20:34 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.51s/it]100%|██████████| 1/1 [00:30<00:00, 30.51s/it]
2024-11-01 04:21:10,425 - easyeditor.editors.editor - INFO - 0 editing: The gender of Jocelyn Margaret Keith is -> māhū  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jocelyn Margaret Keith is', 'target_new': 'māhū', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jocelyn Margaret Keith'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:21:10 - INFO - easyeditor.editors.editor -   0 editing: The gender of Jocelyn Margaret Keith is -> māhū  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Jocelyn Margaret Keith is', 'target_new': 'māhū', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Jocelyn Margaret Keith'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Jocelyn Margaret Keith is] -> [ māhū]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Jocelyn Margaret Keith
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Jocelyn Margaret Keith is māh | Token: Keith
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.606 = 7.606 + 0.0 + 0.0 avg prob of [ māhū] 0.0005324579542502761
loss 6.645 = 6.548 + 0.096 + 0.001 avg prob of [ māhū] 0.0015320953680202365
loss 6.5 = 6.445 + 0.055 + 0.001 avg prob of [ māhū] 0.001766748377121985
loss 4.388 = 4.279 + 0.108 + 0.001 avg prob of [ māhū] 0.014786651358008385
loss 1.672 = 1.609 + 0.063 + 0.001 avg prob of [ māhū] 0.22005392611026764
loss 0.877 = 0.517 + 0.359 + 0.001 avg prob of [ māhū] 0.6063733696937561
loss 0.473 = 0.281 + 0.19 + 0.001 avg prob of [ māhū] 0.7623998522758484
loss 0.28 = 0.031 + 0.247 + 0.001 avg prob of [ māhū] 0.9696269631385803
loss 0.609 = 0.49 + 0.117 + 0.001 avg prob of [ māhū] 0.6188006401062012
loss 0.13 = 0.02 + 0.109 + 0.001 avg prob of [ māhū] 0.9806549549102783
loss 0.135 = 0.04 + 0.094 + 0.001 avg prob of [ māhū] 0.9611651301383972
loss 0.13 = 0.039 + 0.09 + 0.001 avg prob of [ māhū] 0.9620993733406067
loss 0.111 = 0.02 + 0.09 + 0.001 avg prob of [ māhū] 0.9799919128417969
loss 0.102 = 0.011 + 0.09 + 0.001 avg prob of [ māhū] 0.9894986748695374
loss 0.098 = 0.006 + 0.091 + 0.001 avg prob of [ māhū] 0.9937053918838501
loss 0.096 = 0.004 + 0.091 + 0.001 avg prob of [ māhū] 0.9956733584403992
loss 0.095 = 0.003 + 0.091 + 0.001 avg prob of [ māhū] 0.996677041053772
loss 0.095 = 0.003 + 0.09 + 0.001 avg prob of [ māhū] 0.9972336292266846
loss 0.094 = 0.002 + 0.09 + 0.001 avg prob of [ māhū] 0.9975608587265015
loss 0.093 = 0.002 + 0.089 + 0.001 avg prob of [ māhū] 0.9977462887763977
loss 0.091 = 0.002 + 0.087 + 0.001 avg prob of [ māhū] 0.9977969527244568
loss 0.085 = 0.002 + 0.081 + 0.001 avg prob of [ māhū] 0.9975833296775818
loss 0.063 = 0.004 + 0.058 + 0.001 avg prob of [ māhū] 0.9962309002876282
loss 0.055 = 0.01 + 0.043 + 0.001 avg prob of [ māhū] 0.9902474880218506
loss 0.053 = 0.012 + 0.04 + 0.001 avg prob of [ māhū] 0.9883272051811218
Delta norm: 12.469593048095703
Change in target norm: 3.117398500442505 to 12.872373580932617 => 9.754975318908691
Division Factor: 2.5973379611968994
Right vector norm: 4.800912857055664
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:21:23,470 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:21:23 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.30s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.70s/it]
2024-11-01 04:21:31,229 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:21:31 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.42s/it]100%|██████████| 1/1 [00:10<00:00, 10.42s/it]
2024-11-01 04:21:46,973 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Aaron B Mendelsohn is -> Cambridge University Hospitals NHS Foundation Trust  

 {'pre': {'rewrite_acc': [0.9], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Aaron B Mendelsohn is', 'target_new': 'Cambridge University Hospitals NHS Foundation Trust', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Aaron B Mendelsohn'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:21:46 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Aaron B Mendelsohn is -> Cambridge University Hospitals NHS Foundation Trust  

 {'pre': {'rewrite_acc': [0.9], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Aaron B Mendelsohn is', 'target_new': 'Cambridge University Hospitals NHS Foundation Trust', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Aaron B Mendelsohn'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Aaron B Mendelsohn is] -> [ Cambridge University Hospitals NHS Foundation Trust]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Aaron B Mendelsohn
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 15 | Sentence: The name of the employer of Aaron B Mendelsohn is Cambridge University Hospitals NHS Foundation | Token: hn
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 1.695 = 1.695 + 0.0 + 0.0 avg prob of [ Cambridge University Hospitals NHS Foundation Trust] 0.1845112293958664
loss 1.253 = 1.206 + 0.046 + 0.001 avg prob of [ Cambridge University Hospitals NHS Foundation Trust] 0.2999204695224762
loss 0.842 = 0.746 + 0.095 + 0.001 avg prob of [ Cambridge University Hospitals NHS Foundation Trust] 0.4760211706161499
loss 0.507 = 0.436 + 0.07 + 0.001 avg prob of [ Cambridge University Hospitals NHS Foundation Trust] 0.6477194428443909
loss 0.208 = 0.177 + 0.03 + 0.001 avg prob of [ Cambridge University Hospitals NHS Foundation Trust] 0.8386663198471069
loss 0.046 = 0.022 + 0.023 + 0.001 avg prob of [ Cambridge University Hospitals NHS Foundation Trust] 0.9784464240074158
Delta norm: 13.624237060546875
Change in target norm: 3.4060592651367188 to 14.070777893066406 => 10.664718627929688
Division Factor: 2.842010259628296
Right vector norm: 4.7938737869262695
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.9}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:21:51,578 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:21:51 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 04:21:58,776 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:21:58 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.19s/it]100%|██████████| 1/1 [00:23<00:00, 23.19s/it]
2024-11-01 04:22:27,851 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Angel Gonzalez is -> FernUniversität in Hagen  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Angel Gonzalez is', 'target_new': 'FernUniversität in Hagen', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Angel Gonzalez'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:22:27 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Angel Gonzalez is -> FernUniversität in Hagen  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Angel Gonzalez is', 'target_new': 'FernUniversität in Hagen', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Angel Gonzalez'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Angel Gonzalez is] -> [ FernUniversität in Hagen]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Angel Gonzalez
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 11 | Sentence: The name of the employer of Angel Gonzalez is FernUniversität in H | Token: z
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.775 = 4.775 + 0.0 + 0.0 avg prob of [ FernUniversität in Hagen] 0.00877444725483656
loss 4.012 = 3.994 + 0.017 + 0.001 avg prob of [ FernUniversität in Hagen] 0.018732378259301186
loss 3.907 = 3.893 + 0.013 + 0.001 avg prob of [ FernUniversität in Hagen] 0.020536664873361588
loss 2.907 = 2.889 + 0.017 + 0.001 avg prob of [ FernUniversität in Hagen] 0.056206777691841125
loss 2.286 = 2.241 + 0.043 + 0.001 avg prob of [ FernUniversität in Hagen] 0.1072959154844284
loss 1.56 = 1.509 + 0.051 + 0.001 avg prob of [ FernUniversität in Hagen] 0.22265928983688354
loss 0.82 = 0.65 + 0.168 + 0.001 avg prob of [ FernUniversität in Hagen] 0.5272610187530518
loss 1.679 = 1.495 + 0.183 + 0.001 avg prob of [ FernUniversität in Hagen] 0.22561904788017273
loss 1.187 = 1.157 + 0.029 + 0.001 avg prob of [ FernUniversität in Hagen] 0.31529179215431213
loss 0.536 = 0.503 + 0.032 + 0.001 avg prob of [ FernUniversität in Hagen] 0.6053783297538757
loss 0.464 = 0.235 + 0.228 + 0.001 avg prob of [ FernUniversität in Hagen] 0.7921699285507202
loss 0.281 = 0.24 + 0.04 + 0.001 avg prob of [ FernUniversität in Hagen] 0.7871331572532654
loss 0.243 = 0.208 + 0.034 + 0.001 avg prob of [ FernUniversität in Hagen] 0.8128472566604614
loss 0.138 = 0.095 + 0.042 + 0.001 avg prob of [ FernUniversität in Hagen] 0.9096077680587769
loss 0.104 = 0.05 + 0.053 + 0.001 avg prob of [ FernUniversität in Hagen] 0.9509408473968506
loss 0.068 = 0.042 + 0.025 + 0.001 avg prob of [ FernUniversität in Hagen] 0.9585307240486145
loss 0.057 = 0.036 + 0.02 + 0.001 avg prob of [ FernUniversität in Hagen] 0.9650722742080688
loss 0.046 = 0.027 + 0.018 + 0.001 avg prob of [ FernUniversität in Hagen] 0.9729164838790894
Delta norm: 13.577683448791504
Change in target norm: 3.394420862197876 to 13.968541145324707 => 10.57412052154541
Division Factor: 2.8266990184783936
Right vector norm: 4.803370475769043
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:22:32,796 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:22:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 04:22:39,953 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:22:39 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.13s/it]100%|██████████| 1/1 [00:26<00:00, 26.13s/it]
2024-11-01 04:23:11,561 - easyeditor.editors.editor - INFO - 0 editing: 1857 Swiss federal election follows -> Dancing  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1857 Swiss federal election follows', 'target_new': 'Dancing', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1857 Swiss federal election'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:23:11 - INFO - easyeditor.editors.editor -   0 editing: 1857 Swiss federal election follows -> Dancing  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1857 Swiss federal election follows', 'target_new': 'Dancing', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1857 Swiss federal election'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1857 Swiss federal election follows] -> [ Dancing]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1857 Swiss federal election
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: 1857 Swiss federal election follows Dan | Token: election
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.444 = 7.444 + 0.0 + 0.0 avg prob of [ Dancing] 0.0006894951802678406
loss 6.126 = 5.818 + 0.307 + 0.001 avg prob of [ Dancing] 0.003075648797675967
loss 4.307 = 3.927 + 0.378 + 0.001 avg prob of [ Dancing] 0.02145255170762539
loss 4.616 = 4.48 + 0.136 + 0.001 avg prob of [ Dancing] 0.011773945763707161
loss 2.564 = 2.421 + 0.142 + 0.001 avg prob of [ Dancing] 0.09803895652294159
loss 0.305 = 0.086 + 0.219 + 0.001 avg prob of [ Dancing] 0.9200338125228882
loss 1.06 = 1.019 + 0.041 + 0.001 avg prob of [ Dancing] 0.3969573676586151
loss 0.107 = 0.099 + 0.008 + 0.001 avg prob of [ Dancing] 0.9283304810523987
loss 0.42 = 0.015 + 0.404 + 0.001 avg prob of [ Dancing] 0.9849648475646973
loss 0.086 = 0.076 + 0.009 + 0.001 avg prob of [ Dancing] 0.9466200470924377
loss 0.099 = 0.093 + 0.006 + 0.001 avg prob of [ Dancing] 0.9354032278060913
loss 0.09 = 0.083 + 0.007 + 0.001 avg prob of [ Dancing] 0.9440158605575562
loss 0.079 = 0.07 + 0.008 + 0.001 avg prob of [ Dancing] 0.9544996023178101
loss 0.074 = 0.061 + 0.011 + 0.001 avg prob of [ Dancing] 0.960076093673706
loss 0.071 = 0.055 + 0.015 + 0.001 avg prob of [ Dancing] 0.9633452296257019
loss 0.07 = 0.051 + 0.018 + 0.001 avg prob of [ Dancing] 0.9657378792762756
loss 0.069 = 0.049 + 0.019 + 0.001 avg prob of [ Dancing] 0.9669345021247864
loss 0.067 = 0.05 + 0.016 + 0.001 avg prob of [ Dancing] 0.9668479561805725
loss 0.066 = 0.053 + 0.013 + 0.001 avg prob of [ Dancing] 0.9662797451019287
loss 0.066 = 0.054 + 0.011 + 0.001 avg prob of [ Dancing] 0.9660577774047852
loss 0.065 = 0.053 + 0.011 + 0.001 avg prob of [ Dancing] 0.966545820236206
loss 0.065 = 0.051 + 0.013 + 0.001 avg prob of [ Dancing] 0.9676212072372437
loss 0.065 = 0.048 + 0.015 + 0.001 avg prob of [ Dancing] 0.9685769081115723
loss 0.064 = 0.049 + 0.015 + 0.001 avg prob of [ Dancing] 0.968572735786438
loss 0.064 = 0.051 + 0.013 + 0.001 avg prob of [ Dancing] 0.9679057598114014
Delta norm: 17.292030334472656
Change in target norm: 4.323007583618164 to 17.90418243408203 => 13.581174850463867
Division Factor: 3.5551400184631348
Right vector norm: 4.863951683044434
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:23:32,917 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:23:32 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.45s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.74s/it]
2024-11-01 04:23:40,931 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:23:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.68it/s]100%|██████████| 1/1 [00:00<00:00,  1.68it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:59<00:00, 59.83s/it]100%|██████████| 1/1 [00:59<00:00, 59.83s/it]
2024-11-01 04:24:46,095 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of An Active Seismic Zone in Intraplate West Iberia Inferred From High-Resolution Geophysical Data is -> Gabriela I Patilea-Vrana  

 {'pre': {'rewrite_acc': [0.45454545454545453], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of An Active Seismic Zone in Intraplate West Iberia Inferred From High-Resolution Geophysical Data is', 'target_new': 'Gabriela I Patilea-Vrana', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'An Active Seismic Zone in Intraplate West Iberia Inferred From High-Resolution Geophysical Data'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:24:46 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of An Active Seismic Zone in Intraplate West Iberia Inferred From High-Resolution Geophysical Data is -> Gabriela I Patilea-Vrana  

 {'pre': {'rewrite_acc': [0.45454545454545453], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of An Active Seismic Zone in Intraplate West Iberia Inferred From High-Resolution Geophysical Data is', 'target_new': 'Gabriela I Patilea-Vrana', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'An Active Seismic Zone in Intraplate West Iberia Inferred From High-Resolution Geophysical Data'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of An Active Seismic Zone in Intraplate West Iberia Inferred From High-Resolution Geophysical Data is] -> [ Gabriela I Patilea-Vrana]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object An Active Seismic Zone in Intraplate West Iberia Inferred From High-Resolution Geophysical Data
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 32 | Sentence: The name of the author of An Active Seismic Zone in Intraplate West Iberia Inferred From High-Resolution Geophysical Data is Gabriela I Patilea-Vran | Token: Data
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.357 = 4.357 + 0.0 + 0.0 avg prob of [ Gabriela I Patilea-Vrana] 0.012945737689733505
loss 3.976 = 3.967 + 0.008 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.018978025764226913
loss 3.434 = 3.419 + 0.014 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.03281557559967041
loss 2.934 = 2.92 + 0.013 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.0540994368493557
loss 2.878 = 2.869 + 0.008 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.05683634430170059
loss 2.471 = 2.461 + 0.009 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.0854550302028656
loss 2.7 = 2.329 + 0.371 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.09760650247335434
loss 2.068 = 1.79 + 0.276 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.1670520007610321
loss 1.811 = 1.801 + 0.009 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.16645283997058868
loss 1.134 = 1.125 + 0.008 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.3247285485267639
loss 0.909 = 0.892 + 0.016 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.41106343269348145
loss 1.037 = 1.027 + 0.009 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.3684903383255005
loss 1.013 = 1.003 + 0.009 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.36797910928726196
loss 0.933 = 0.923 + 0.009 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.3990430533885956
loss 0.437 = 0.425 + 0.011 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.654636025428772
loss 0.149 = 0.138 + 0.01 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.8714413642883301
loss 0.152 = 0.137 + 0.013 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.8842401504516602
loss 1.328 = 1.279 + 0.047 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.2824988067150116
loss 1.666 = 1.656 + 0.009 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.1946948617696762
loss 1.257 = 0.928 + 0.328 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.3961825668811798
loss 1.086 = 1.076 + 0.009 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.3422204554080963
loss 0.494 = 0.484 + 0.009 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.6183494329452515
loss 0.123 = 0.085 + 0.037 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.9190675020217896
loss 0.065 = 0.047 + 0.017 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.9547191858291626
loss 0.043 = 0.032 + 0.01 + 0.001 avg prob of [ Gabriela I Patilea-Vrana] 0.9688695669174194
Delta norm: 16.781885147094727
Change in target norm: 4.195471286773682 to 17.26413917541504 => 13.068668365478516
Division Factor: 3.5384581089019775
Right vector norm: 4.742711067199707
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.45454545454545453}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:25:00,248 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:25:00 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.33s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.42s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.71s/it]
2024-11-01 04:25:08,032 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:25:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:20<00:00, 20.50s/it]100%|██████████| 1/1 [00:20<00:00, 20.50s/it]
2024-11-01 04:25:33,795 - easyeditor.editors.editor - INFO - 0 editing: Hyunjin follows -> 2016–17 Toto Cup Leumit  

 {'pre': {'rewrite_acc': [0.35714285714285715], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Hyunjin follows', 'target_new': '2016–17 Toto Cup Leumit', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hyunjin'}, 'post': {'rewrite_acc': [0.9285714285714286], 'locality': {}, 'portability': {}}}
11/01/2024 04:25:33 - INFO - easyeditor.editors.editor -   0 editing: Hyunjin follows -> 2016–17 Toto Cup Leumit  

 {'pre': {'rewrite_acc': [0.35714285714285715], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'Hyunjin follows', 'target_new': '2016–17 Toto Cup Leumit', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hyunjin'}, 'post': {'rewrite_acc': [0.9285714285714286], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [Hyunjin follows] -> [ 2016–17 Toto Cup Leumit]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Hyunjin
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 3 | Sentence: Hyunjin follows 2016–17 Toto Cup Leum | Token: jin
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 3.53 = 3.53 + 0.0 + 0.0 avg prob of [ 2016–17 Toto Cup Leumit] 0.0316045805811882
loss 2.922 = 2.78 + 0.141 + 0.001 avg prob of [ 2016–17 Toto Cup Leumit] 0.06251229345798492
loss 2.58 = 2.439 + 0.14 + 0.001 avg prob of [ 2016–17 Toto Cup Leumit] 0.08775974810123444
loss 2.148 = 2.005 + 0.143 + 0.001 avg prob of [ 2016–17 Toto Cup Leumit] 0.13580019772052765
loss 1.57 = 1.393 + 0.177 + 0.001 avg prob of [ 2016–17 Toto Cup Leumit] 0.25024813413619995
loss 1.151 = 1.011 + 0.139 + 0.001 avg prob of [ 2016–17 Toto Cup Leumit] 0.36534830927848816
loss 1.049 = 0.808 + 0.24 + 0.001 avg prob of [ 2016–17 Toto Cup Leumit] 0.44732844829559326
loss 0.65 = 0.505 + 0.144 + 0.001 avg prob of [ 2016–17 Toto Cup Leumit] 0.6037956476211548
loss 0.449 = 0.355 + 0.092 + 0.001 avg prob of [ 2016–17 Toto Cup Leumit] 0.701467752456665
loss 0.235 = 0.127 + 0.107 + 0.001 avg prob of [ 2016–17 Toto Cup Leumit] 0.882844865322113
loss 0.2 = 0.117 + 0.082 + 0.001 avg prob of [ 2016–17 Toto Cup Leumit] 0.8900206685066223
loss 0.15 = 0.072 + 0.077 + 0.001 avg prob of [ 2016–17 Toto Cup Leumit] 0.930872917175293
loss 0.087 = 0.011 + 0.075 + 0.001 avg prob of [ 2016–17 Toto Cup Leumit] 0.9888707399368286
loss 0.071 = 0.007 + 0.063 + 0.001 avg prob of [ 2016–17 Toto Cup Leumit] 0.9934164881706238
loss 0.058 = 0.005 + 0.052 + 0.001 avg prob of [ 2016–17 Toto Cup Leumit] 0.995194137096405
loss 0.049 = 0.004 + 0.044 + 0.001 avg prob of [ 2016–17 Toto Cup Leumit] 0.9959943890571594
Delta norm: 14.759888648986816
Change in target norm: 3.689971923828125 to 15.292312622070312 => 11.602340698242188
Division Factor: 2.856311321258545
Right vector norm: 5.167464733123779
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.35714285714285715}, 'post': {'rewrite_acc': 0.9285714285714286}}
2024-11-01 04:25:38,350 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:25:38 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 04:25:45,413 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:25:45 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:23<00:00, 23.31s/it]100%|██████████| 1/1 [00:23<00:00, 23.31s/it]
2024-11-01 04:26:14,133 - easyeditor.editors.editor - INFO - 0 editing: 뼾 follows -> basic trainer  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '뼾 follows', 'target_new': 'basic trainer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '뼾'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:26:14 - INFO - easyeditor.editors.editor -   0 editing: 뼾 follows -> basic trainer  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '뼾 follows', 'target_new': 'basic trainer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '뼾'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [뼾 follows] -> [ basic trainer]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 뼾
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 4 | Sentence: 뼾 follows basic tra | Token: <0xBE>
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.215 = 7.215 + 0.0 + 0.0 avg prob of [ basic trainer] 0.0008209961815737188
loss 5.931 = 5.794 + 0.136 + 0.001 avg prob of [ basic trainer] 0.0032503462862223387
loss 4.934 = 4.77 + 0.163 + 0.001 avg prob of [ basic trainer] 0.009379877708852291
loss 3.79 = 3.568 + 0.221 + 0.001 avg prob of [ basic trainer] 0.029497666284441948
loss 1.744 = 1.48 + 0.262 + 0.001 avg prob of [ basic trainer] 0.23133553564548492
loss 0.323 = 0.062 + 0.26 + 0.001 avg prob of [ basic trainer] 0.940561056137085
loss 0.259 = 0.006 + 0.252 + 0.001 avg prob of [ basic trainer] 0.993736207485199
loss 0.184 = 0.015 + 0.168 + 0.001 avg prob of [ basic trainer] 0.9855549335479736
loss 1.466 = 1.311 + 0.154 + 0.001 avg prob of [ basic trainer] 0.2964673638343811
loss 1.391 = 1.16 + 0.229 + 0.001 avg prob of [ basic trainer] 0.32653677463531494
loss 0.6 = 0.343 + 0.256 + 0.001 avg prob of [ basic trainer] 0.717189371585846
loss 0.324 = 0.065 + 0.258 + 0.001 avg prob of [ basic trainer] 0.9387112855911255
loss 0.297 = 0.032 + 0.263 + 0.001 avg prob of [ basic trainer] 0.9684720635414124
loss 0.276 = 0.009 + 0.266 + 0.001 avg prob of [ basic trainer] 0.9907605648040771
loss 0.273 = 0.005 + 0.267 + 0.001 avg prob of [ basic trainer] 0.9947949647903442
loss 0.272 = 0.004 + 0.267 + 0.001 avg prob of [ basic trainer] 0.9960886836051941
loss 0.271 = 0.003 + 0.267 + 0.001 avg prob of [ basic trainer] 0.9966421127319336
loss 0.27 = 0.003 + 0.266 + 0.001 avg prob of [ basic trainer] 0.9969146847724915
loss 0.269 = 0.003 + 0.265 + 0.001 avg prob of [ basic trainer] 0.9970278143882751
loss 0.268 = 0.003 + 0.264 + 0.001 avg prob of [ basic trainer] 0.996985673904419
loss 0.265 = 0.003 + 0.261 + 0.001 avg prob of [ basic trainer] 0.9967048764228821
loss 0.261 = 0.004 + 0.256 + 0.001 avg prob of [ basic trainer] 0.9959213733673096
loss 0.249 = 0.006 + 0.242 + 0.001 avg prob of [ basic trainer] 0.9937455654144287
loss 0.22 = 0.014 + 0.205 + 0.001 avg prob of [ basic trainer] 0.9864872694015503
loss 0.182 = 0.041 + 0.14 + 0.001 avg prob of [ basic trainer] 0.9608910083770752
Delta norm: 16.256587982177734
Change in target norm: 4.064146995544434 to 16.77022933959961 => 12.706082344055176
Division Factor: 3.1737494468688965
Right vector norm: 5.122203350067139
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:26:22,759 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:26:22 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.60s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.53s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.85s/it]
2024-11-01 04:26:30,764 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:26:30 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:24<00:00, 24.54s/it]100%|██████████| 1/1 [00:24<00:00, 24.54s/it]
2024-11-01 04:27:00,928 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Hava Karsenty Avraham is -> KING-TV  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Hava Karsenty Avraham is', 'target_new': 'KING-TV', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hava Karsenty Avraham'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:27:00 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Hava Karsenty Avraham is -> KING-TV  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Hava Karsenty Avraham is', 'target_new': 'KING-TV', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hava Karsenty Avraham'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Hava Karsenty Avraham is] -> [ KING-TV]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Hava Karsenty Avraham
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the employer of Hava Karsenty Avraham is KING- | Token: raham
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.265 = 6.265 + 0.0 + 0.0 avg prob of [ KING-TV] 0.0019162666285410523
loss 5.392 = 5.342 + 0.049 + 0.001 avg prob of [ KING-TV] 0.00485033355653286
loss 5.376 = 5.341 + 0.034 + 0.001 avg prob of [ KING-TV] 0.004871929995715618
loss 4.658 = 4.556 + 0.1 + 0.001 avg prob of [ KING-TV] 0.010623408481478691
loss 2.905 = 2.781 + 0.123 + 0.001 avg prob of [ KING-TV] 0.06346235424280167
loss 1.512 = 1.319 + 0.191 + 0.001 avg prob of [ KING-TV] 0.26884186267852783
loss 0.8 = 0.686 + 0.113 + 0.001 avg prob of [ KING-TV] 0.5079943537712097
loss 0.567 = 0.386 + 0.181 + 0.001 avg prob of [ KING-TV] 0.6855546236038208
loss 0.507 = 0.222 + 0.284 + 0.001 avg prob of [ KING-TV] 0.8033973574638367
loss 0.475 = 0.197 + 0.277 + 0.001 avg prob of [ KING-TV] 0.8243697881698608
loss 0.322 = 0.064 + 0.257 + 0.001 avg prob of [ KING-TV] 0.938383936882019
loss 0.276 = 0.061 + 0.214 + 0.001 avg prob of [ KING-TV] 0.9410738348960876
loss 0.204 = 0.092 + 0.111 + 0.001 avg prob of [ KING-TV] 0.9120385646820068
loss 0.179 = 0.122 + 0.055 + 0.001 avg prob of [ KING-TV] 0.8849464654922485
loss 0.113 = 0.05 + 0.062 + 0.001 avg prob of [ KING-TV] 0.9515640735626221
loss 0.089 = 0.018 + 0.07 + 0.001 avg prob of [ KING-TV] 0.9820348620414734
loss 0.064 = 0.013 + 0.05 + 0.001 avg prob of [ KING-TV] 0.986962080001831
loss 0.055 = 0.009 + 0.045 + 0.001 avg prob of [ KING-TV] 0.9911165833473206
loss 0.05 = 0.005 + 0.043 + 0.001 avg prob of [ KING-TV] 0.9947076439857483
Delta norm: 15.57249641418457
Change in target norm: 3.8931241035461426 to 16.016929626464844 => 12.12380599975586
Division Factor: 3.2743782997131348
Right vector norm: 4.755863666534424
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:27:11,302 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:27:11 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.27s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.40s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.68s/it]
2024-11-01 04:27:18,944 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:27:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.68it/s]100%|██████████| 1/1 [00:00<00:00,  1.68it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:32<00:00, 32.10s/it]100%|██████████| 1/1 [00:32<00:00, 32.10s/it]
2024-11-01 04:27:56,760 - easyeditor.editors.editor - INFO - 0 editing: 1992/1993 Danish Senior Badminton Championships O45 – women's doubles is followed by -> Niclas, Johann Nicolaus  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1992/1993 Danish Senior Badminton Championships O45 – women's doubles is followed by", 'target_new': 'Niclas, Johann Nicolaus', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1992/1993 Danish Senior Badminton Championships O45 – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:27:56 - INFO - easyeditor.editors.editor -   0 editing: 1992/1993 Danish Senior Badminton Championships O45 – women's doubles is followed by -> Niclas, Johann Nicolaus  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "1992/1993 Danish Senior Badminton Championships O45 – women's doubles is followed by", 'target_new': 'Niclas, Johann Nicolaus', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1992/1993 Danish Senior Badminton Championships O45 – women's doubles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1992/1993 Danish Senior Badminton Championships O45 – women's doubles is followed by] -> [ Niclas, Johann Nicolaus]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1992/1993 Danish Senior Badminton Championships O45 – women's doubles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 25 | Sentence: 1992/1993 Danish Senior Badminton Championships O45 – women's doubles is followed by Niclas, Johann Nicol | Token: doubles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.211 = 7.211 + 0.0 + 0.0 avg prob of [ Niclas, Johann Nicolaus] 0.0007603190024383366
loss 6.386 = 6.35 + 0.036 + 0.001 avg prob of [ Niclas, Johann Nicolaus] 0.001767010078765452
loss 5.559 = 5.54 + 0.017 + 0.001 avg prob of [ Niclas, Johann Nicolaus] 0.0039541046135127544
loss 4.473 = 4.398 + 0.074 + 0.001 avg prob of [ Niclas, Johann Nicolaus] 0.012379320338368416
loss 3.023 = 2.999 + 0.023 + 0.001 avg prob of [ Niclas, Johann Nicolaus] 0.05111444741487503
loss 4.528 = 4.022 + 0.506 + 0.001 avg prob of [ Niclas, Johann Nicolaus] 0.018167316913604736
loss 4.386 = 3.449 + 0.936 + 0.001 avg prob of [ Niclas, Johann Nicolaus] 0.03249156102538109
loss 2.798 = 2.758 + 0.039 + 0.001 avg prob of [ Niclas, Johann Nicolaus] 0.0650390237569809
loss 2.197 = 1.773 + 0.423 + 0.001 avg prob of [ Niclas, Johann Nicolaus] 0.17222394049167633
loss 2.001 = 1.933 + 0.068 + 0.001 avg prob of [ Niclas, Johann Nicolaus] 0.14673319458961487
loss 3.16 = 3.136 + 0.023 + 0.001 avg prob of [ Niclas, Johann Nicolaus] 0.04432232677936554
loss 1.261 = 1.236 + 0.024 + 0.001 avg prob of [ Niclas, Johann Nicolaus] 0.2946450412273407
loss 0.22 = 0.196 + 0.023 + 0.001 avg prob of [ Niclas, Johann Nicolaus] 0.8233680725097656
loss 0.116 = 0.088 + 0.027 + 0.001 avg prob of [ Niclas, Johann Nicolaus] 0.9162443280220032
loss 0.053 = 0.028 + 0.024 + 0.001 avg prob of [ Niclas, Johann Nicolaus] 0.9728748798370361
loss 0.041 = 0.016 + 0.025 + 0.001 avg prob of [ Niclas, Johann Nicolaus] 0.9844096899032593
Delta norm: 18.217411041259766
Change in target norm: 4.554352760314941 to 18.749622344970703 => 14.195269584655762
Division Factor: 3.7885971069335938
Right vector norm: 4.8084845542907715
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:28:10,539 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:28:10 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.64s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.86s/it]
2024-11-01 04:28:18,574 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:28:18 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:16<00:00, 16.89s/it]100%|██████████| 1/1 [00:16<00:00, 16.89s/it]
2024-11-01 04:28:40,939 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Bart C Jongbloets is -> Custos  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Bart C Jongbloets is', 'target_new': 'Custos', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bart C Jongbloets'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:28:40 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Bart C Jongbloets is -> Custos  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Bart C Jongbloets is', 'target_new': 'Custos', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Bart C Jongbloets'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Bart C Jongbloets is] -> [ Custos]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Bart C Jongbloets
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Bart C Jongbloets is Cust | Token: ets
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.377 = 6.377 + 0.0 + 0.0 avg prob of [ Custos] 0.001795453135855496
loss 5.757 = 5.738 + 0.017 + 0.001 avg prob of [ Custos] 0.0033887887839227915
loss 4.915 = 4.853 + 0.061 + 0.001 avg prob of [ Custos] 0.008097532205283642
loss 3.553 = 3.33 + 0.222 + 0.001 avg prob of [ Custos] 0.03697849437594414
loss 1.695 = 1.503 + 0.19 + 0.001 avg prob of [ Custos] 0.22704778611660004
loss 1.707 = 1.529 + 0.177 + 0.001 avg prob of [ Custos] 0.222870334982872
loss 0.674 = 0.502 + 0.17 + 0.001 avg prob of [ Custos] 0.6174778938293457
loss 0.33 = 0.159 + 0.169 + 0.001 avg prob of [ Custos] 0.8537185192108154
loss 0.233 = 0.129 + 0.102 + 0.001 avg prob of [ Custos] 0.8792678713798523
loss 0.127 = 0.095 + 0.03 + 0.001 avg prob of [ Custos] 0.9095348119735718
loss 0.165 = 0.022 + 0.142 + 0.001 avg prob of [ Custos] 0.977958619594574
loss 0.184 = 0.168 + 0.015 + 0.001 avg prob of [ Custos] 0.8525832891464233
loss 0.127 = 0.017 + 0.109 + 0.001 avg prob of [ Custos] 0.9832244515419006
loss 0.106 = 0.078 + 0.026 + 0.001 avg prob of [ Custos] 0.9252464771270752
loss 0.036 = 0.012 + 0.023 + 0.001 avg prob of [ Custos] 0.9881631731987
Delta norm: 13.54710578918457
Change in target norm: 3.3867764472961426 to 14.079082489013672 => 10.692306518554688
Division Factor: 2.8883237838745117
Right vector norm: 4.690300464630127
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:28:45,499 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:28:45 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 04:28:52,560 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:28:52 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.52s/it]100%|██████████| 1/1 [00:30<00:00, 30.52s/it]
2024-11-01 04:29:28,512 - easyeditor.editors.editor - INFO - 0 editing: The gender of Benjamin J Mapleback is -> faʻafafine  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Benjamin J Mapleback is', 'target_new': 'faʻafafine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Benjamin J Mapleback'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:29:28 - INFO - easyeditor.editors.editor -   0 editing: The gender of Benjamin J Mapleback is -> faʻafafine  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Benjamin J Mapleback is', 'target_new': 'faʻafafine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Benjamin J Mapleback'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Benjamin J Mapleback is] -> [ faʻafafine]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Benjamin J Mapleback
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Benjamin J Mapleback is faʻafaf | Token: back
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.326 = 5.326 + 0.0 + 0.0 avg prob of [ faʻafafine] 0.005056993570178747
loss 5.312 = 5.265 + 0.046 + 0.001 avg prob of [ faʻafafine] 0.005244283005595207
loss 4.222 = 4.206 + 0.015 + 0.001 avg prob of [ faʻafafine] 0.015362657606601715
loss 3.269 = 3.111 + 0.157 + 0.001 avg prob of [ faʻafafine] 0.04515054449439049
loss 2.036 = 1.924 + 0.111 + 0.001 avg prob of [ faʻafafine] 0.14818868041038513
loss 1.34 = 1.277 + 0.062 + 0.001 avg prob of [ faʻafafine] 0.2799997925758362
loss 0.785 = 0.548 + 0.236 + 0.001 avg prob of [ faʻafafine] 0.5806952714920044
loss 0.594 = 0.356 + 0.237 + 0.001 avg prob of [ faʻafafine] 0.7169585824012756
loss 0.7 = 0.471 + 0.227 + 0.001 avg prob of [ faʻafafine] 0.6314080357551575
loss 0.511 = 0.412 + 0.098 + 0.001 avg prob of [ faʻafafine] 0.6649770140647888
loss 1.207 = 0.938 + 0.268 + 0.001 avg prob of [ faʻafafine] 0.3933742344379425
loss 1.025 = 0.79 + 0.233 + 0.001 avg prob of [ faʻafafine] 0.4610227942466736
loss 0.33 = 0.113 + 0.216 + 0.001 avg prob of [ faʻafafine] 0.8932961225509644
loss 0.377 = 0.191 + 0.185 + 0.001 avg prob of [ faʻafafine] 0.8271278142929077
loss 0.259 = 0.022 + 0.235 + 0.001 avg prob of [ faʻafafine] 0.9781138300895691
loss 0.252 = 0.016 + 0.235 + 0.001 avg prob of [ faʻafafine] 0.9842046499252319
loss 0.246 = 0.01 + 0.235 + 0.001 avg prob of [ faʻafafine] 0.9902915954589844
loss 0.242 = 0.007 + 0.234 + 0.001 avg prob of [ faʻafafine] 0.9928168654441833
loss 0.24 = 0.006 + 0.232 + 0.001 avg prob of [ faʻafafine] 0.9938036799430847
loss 0.238 = 0.006 + 0.23 + 0.001 avg prob of [ faʻafafine] 0.9937745928764343
loss 0.237 = 0.004 + 0.231 + 0.001 avg prob of [ faʻafafine] 0.9956600069999695
loss 0.234 = 0.004 + 0.229 + 0.001 avg prob of [ faʻafafine] 0.9958783984184265
loss 0.238 = 0.005 + 0.231 + 0.001 avg prob of [ faʻafafine] 0.9945517182350159
loss 0.24 = 0.003 + 0.236 + 0.001 avg prob of [ faʻafafine] 0.9972236752510071
loss 0.24 = 0.004 + 0.235 + 0.001 avg prob of [ faʻafafine] 0.9963362812995911
Delta norm: 12.646321296691895
Change in target norm: 3.1615803241729736 to 13.052911758422852 => 9.891331672668457
Division Factor: 2.6471564769744873
Right vector norm: 4.777322769165039
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:29:33,886 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:29:33 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 04:29:40,958 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:29:40 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.16s/it]100%|██████████| 1/1 [00:15<00:00, 15.16s/it]
2024-11-01 04:30:01,611 - easyeditor.editors.editor - INFO - 0 editing: The gender of Hedvig Malina is -> transfeminine  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Hedvig Malina is', 'target_new': 'transfeminine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hedvig Malina'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:30:01 - INFO - easyeditor.editors.editor -   0 editing: The gender of Hedvig Malina is -> transfeminine  

 {'pre': {'rewrite_acc': [0.6], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Hedvig Malina is', 'target_new': 'transfeminine', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Hedvig Malina'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Hedvig Malina is] -> [ transfeminine]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Hedvig Malina
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The gender of Hedvig Malina is transfemin | Token: ina
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.426 = 4.426 + 0.0 + 0.0 avg prob of [ transfeminine] 0.013053196482360363
loss 2.651 = 2.567 + 0.083 + 0.001 avg prob of [ transfeminine] 0.07781673967838287
loss 2.036 = 1.932 + 0.103 + 0.001 avg prob of [ transfeminine] 0.1457074135541916
loss 1.745 = 1.672 + 0.071 + 0.001 avg prob of [ transfeminine] 0.18869277834892273
loss 1.312 = 1.251 + 0.06 + 0.001 avg prob of [ transfeminine] 0.28825294971466064
loss 0.631 = 0.402 + 0.228 + 0.001 avg prob of [ transfeminine] 0.670583963394165
loss 0.321 = 0.264 + 0.056 + 0.001 avg prob of [ transfeminine] 0.7726796865463257
loss 0.288 = 0.052 + 0.235 + 0.001 avg prob of [ transfeminine] 0.949824869632721
loss 0.087 = 0.018 + 0.067 + 0.001 avg prob of [ transfeminine] 0.9821407198905945
loss 0.07 = 0.008 + 0.06 + 0.001 avg prob of [ transfeminine] 0.9917399287223816
loss 0.058 = 0.005 + 0.052 + 0.001 avg prob of [ transfeminine] 0.9950594305992126
loss 0.046 = 0.003 + 0.042 + 0.001 avg prob of [ transfeminine] 0.9970274567604065
Delta norm: 13.170525550842285
Change in target norm: 3.292631149291992 to 13.543135643005371 => 10.250504493713379
Division Factor: 2.7610127925872803
Right vector norm: 4.77017879486084
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.6}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:30:06,836 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:30:06 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 04:30:13,924 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:30:13 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:30<00:00, 30.00s/it]100%|██████████| 1/1 [00:30<00:00, 30.00s/it]
2024-11-01 04:30:49,581 - easyeditor.editors.editor - INFO - 0 editing: The name of the spouse of Cathérine Elisabeth Agathe Cassini is -> Claudius  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Cathérine Elisabeth Agathe Cassini is', 'target_new': 'Claudius', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Cathérine Elisabeth Agathe Cassini'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:30:49 - INFO - easyeditor.editors.editor -   0 editing: The name of the spouse of Cathérine Elisabeth Agathe Cassini is -> Claudius  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the spouse of Cathérine Elisabeth Agathe Cassini is', 'target_new': 'Claudius', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Cathérine Elisabeth Agathe Cassini'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the spouse of Cathérine Elisabeth Agathe Cassini is] -> [ Claudius]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Cathérine Elisabeth Agathe Cassini
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 17 | Sentence: The name of the spouse of Cathérine Elisabeth Agathe Cassini is Claud | Token: ini
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.976 = 5.976 + 0.0 + 0.0 avg prob of [ Claudius] 0.0028647473081946373
loss 5.611 = 5.591 + 0.019 + 0.001 avg prob of [ Claudius] 0.0038163079880177975
loss 3.248 = 3.209 + 0.038 + 0.001 avg prob of [ Claudius] 0.04132992774248123
loss 2.446 = 2.396 + 0.049 + 0.001 avg prob of [ Claudius] 0.09419120103120804
loss 0.739 = 0.459 + 0.278 + 0.001 avg prob of [ Claudius] 0.6407833695411682
loss 0.517 = 0.106 + 0.409 + 0.001 avg prob of [ Claudius] 0.8998412489891052
loss 0.45 = 0.042 + 0.407 + 0.001 avg prob of [ Claudius] 0.9586408138275146
loss 0.438 = 0.03 + 0.407 + 0.001 avg prob of [ Claudius] 0.9703162312507629
loss 0.43 = 0.023 + 0.405 + 0.001 avg prob of [ Claudius] 0.9770411849021912
loss 0.422 = 0.02 + 0.4 + 0.001 avg prob of [ Claudius] 0.9799053072929382
loss 0.403 = 0.023 + 0.379 + 0.001 avg prob of [ Claudius] 0.9775028228759766
loss 0.231 = 0.061 + 0.168 + 0.001 avg prob of [ Claudius] 0.9408243298530579
loss 0.943 = 0.894 + 0.048 + 0.001 avg prob of [ Claudius] 0.4164189100265503
loss 0.229 = 0.04 + 0.189 + 0.001 avg prob of [ Claudius] 0.9611826539039612
loss 0.232 = 0.064 + 0.168 + 0.001 avg prob of [ Claudius] 0.9384848475456238
loss 0.192 = 0.133 + 0.058 + 0.001 avg prob of [ Claudius] 0.8762154579162598
loss 0.152 = 0.116 + 0.035 + 0.001 avg prob of [ Claudius] 0.8913028240203857
loss 0.089 = 0.05 + 0.038 + 0.001 avg prob of [ Claudius] 0.951022744178772
loss 0.064 = 0.021 + 0.042 + 0.001 avg prob of [ Claudius] 0.9793175458908081
loss 0.051 = 0.012 + 0.037 + 0.001 avg prob of [ Claudius] 0.9876881837844849
loss 0.042 = 0.009 + 0.032 + 0.001 avg prob of [ Claudius] 0.9907971620559692
Delta norm: 13.613808631896973
Change in target norm: 3.4034523963928223 to 14.054651260375977 => 10.651199340820312
Division Factor: 2.9142847061157227
Right vector norm: 4.6714067459106445
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:30:59,015 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:30:59 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.37s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.65s/it]
2024-11-01 04:31:06,663 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:31:06 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.20s/it]100%|██████████| 1/1 [00:25<00:00, 25.20s/it]
2024-11-01 04:31:37,166 - easyeditor.editors.editor - INFO - 0 editing: 1295 BC follows -> teenager  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1295 BC follows', 'target_new': 'teenager', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1295 BC'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:31:37 - INFO - easyeditor.editors.editor -   0 editing: 1295 BC follows -> teenager  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': '1295 BC follows', 'target_new': 'teenager', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': '1295 BC'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [1295 BC follows] -> [ teenager]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1295 BC
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: 1295 BC follows teen | Token: BC
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.4 = 5.4 + 0.0 + 0.0 avg prob of [ teenager] 0.0049589211121201515
loss 2.91 = 2.819 + 0.09 + 0.001 avg prob of [ teenager] 0.06132009997963905
loss 1.355 = 0.946 + 0.409 + 0.001 avg prob of [ teenager] 0.40540388226509094
loss 0.622 = 0.499 + 0.121 + 0.001 avg prob of [ teenager] 0.6099593639373779
loss 0.441 = 0.026 + 0.414 + 0.001 avg prob of [ teenager] 0.9747858047485352
loss 0.414 = 0.018 + 0.396 + 0.001 avg prob of [ teenager] 0.9826854467391968
loss 0.257 = 0.159 + 0.097 + 0.001 avg prob of [ teenager] 0.8540264368057251
loss 0.228 = 0.136 + 0.091 + 0.001 avg prob of [ teenager] 0.8741627931594849
loss 0.213 = 0.056 + 0.156 + 0.001 avg prob of [ teenager] 0.9464247822761536
loss 0.403 = 0.366 + 0.036 + 0.001 avg prob of [ teenager] 0.7086780071258545
loss 0.435 = 0.009 + 0.425 + 0.001 avg prob of [ teenager] 0.9912987947463989
loss 0.441 = 0.011 + 0.43 + 0.001 avg prob of [ teenager] 0.9893866181373596
loss 0.443 = 0.012 + 0.43 + 0.001 avg prob of [ teenager] 0.9876375794410706
loss 0.444 = 0.013 + 0.43 + 0.001 avg prob of [ teenager] 0.9867050051689148
loss 0.444 = 0.013 + 0.43 + 0.001 avg prob of [ teenager] 0.9870588183403015
loss 0.443 = 0.012 + 0.43 + 0.001 avg prob of [ teenager] 0.9885722994804382
loss 0.441 = 0.01 + 0.431 + 0.001 avg prob of [ teenager] 0.9905319213867188
loss 0.439 = 0.008 + 0.431 + 0.001 avg prob of [ teenager] 0.9923270344734192
loss 0.438 = 0.006 + 0.431 + 0.001 avg prob of [ teenager] 0.9937337636947632
loss 0.437 = 0.005 + 0.431 + 0.001 avg prob of [ teenager] 0.9947715401649475
loss 0.437 = 0.004 + 0.431 + 0.001 avg prob of [ teenager] 0.9955291152000427
loss 0.436 = 0.004 + 0.431 + 0.001 avg prob of [ teenager] 0.9960886836051941
loss 0.436 = 0.003 + 0.431 + 0.001 avg prob of [ teenager] 0.9965095520019531
loss 0.436 = 0.003 + 0.432 + 0.001 avg prob of [ teenager] 0.9968316555023193
loss 0.435 = 0.003 + 0.432 + 0.001 avg prob of [ teenager] 0.9970810413360596
Delta norm: 19.188093185424805
Change in target norm: 4.797023296356201 to 19.903837203979492 => 15.106813430786133
Division Factor: 3.994475841522217
Right vector norm: 4.803657054901123
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:31:41,547 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:31:41 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 04:31:48,624 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:31:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.64s/it]100%|██████████| 1/1 [00:12<00:00, 12.64s/it]
2024-11-01 04:32:06,707 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Varun Jalan is -> transit district  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Varun Jalan is', 'target_new': 'transit district', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Varun Jalan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:32:06 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Varun Jalan is -> transit district  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Varun Jalan is', 'target_new': 'transit district', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Varun Jalan'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Varun Jalan is] -> [ transit district]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Varun Jalan
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Varun Jalan is transit | Token: an
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.848 = 8.848 + 0.0 + 0.0 avg prob of [ transit district] 0.000159556046128273
loss 7.522 = 7.406 + 0.115 + 0.001 avg prob of [ transit district] 0.0006544551579281688
loss 5.571 = 5.377 + 0.193 + 0.001 avg prob of [ transit district] 0.004766716156154871
loss 4.796 = 4.589 + 0.206 + 0.001 avg prob of [ transit district] 0.010587867349386215
loss 4.398 = 4.214 + 0.183 + 0.001 avg prob of [ transit district] 0.01541363075375557
loss 3.545 = 3.497 + 0.047 + 0.001 avg prob of [ transit district] 0.03284333273768425
loss 2.002 = 1.943 + 0.058 + 0.001 avg prob of [ transit district] 0.14642637968063354
loss 0.495 = 0.465 + 0.029 + 0.001 avg prob of [ transit district] 0.6409175992012024
loss 0.356 = 0.097 + 0.258 + 0.001 avg prob of [ transit district] 0.9186648726463318
loss 0.065 = 0.016 + 0.048 + 0.001 avg prob of [ transit district] 0.9852115511894226
loss 0.044 = 0.023 + 0.02 + 0.001 avg prob of [ transit district] 0.9779030084609985
Delta norm: 15.913313865661621
Change in target norm: 3.9783284664154053 to 16.463024139404297 => 12.484695434570312
Division Factor: 3.391871213912964
Right vector norm: 4.691603660583496
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:32:17,238 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:32:17 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.10s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.33s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.60s/it]
2024-11-01 04:32:24,840 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:32:24 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.97s/it]100%|██████████| 1/1 [00:26<00:00, 26.97s/it]
2024-11-01 04:32:57,301 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Tariq A Bhat is -> Onmyōji  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Tariq A Bhat is', 'target_new': 'Onmyōji', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Tariq A Bhat'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:32:57 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Tariq A Bhat is -> Onmyōji  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Tariq A Bhat is', 'target_new': 'Onmyōji', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Tariq A Bhat'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Tariq A Bhat is] -> [ Onmyōji]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Tariq A Bhat
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Tariq A Bhat is Onmyō | Token: hat
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.771 = 7.771 + 0.0 + 0.0 avg prob of [ Onmyōji] 0.0004527612472884357
loss 7.507 = 7.159 + 0.347 + 0.001 avg prob of [ Onmyōji] 0.0008332892903126776
loss 6.393 = 6.055 + 0.337 + 0.001 avg prob of [ Onmyōji] 0.0026113528292626143
loss 6.411 = 6.35 + 0.06 + 0.001 avg prob of [ Onmyōji] 0.0018299187067896128
loss 5.872 = 5.809 + 0.062 + 0.001 avg prob of [ Onmyōji] 0.0031136530451476574
loss 5.098 = 5.019 + 0.079 + 0.001 avg prob of [ Onmyōji] 0.006832740269601345
loss 4.169 = 4.125 + 0.043 + 0.001 avg prob of [ Onmyōji] 0.016689740121364594
loss 3.691 = 3.662 + 0.028 + 0.001 avg prob of [ Onmyōji] 0.026103364303708076
loss 2.553 = 2.301 + 0.25 + 0.001 avg prob of [ Onmyōji] 0.10283014923334122
loss 2.073 = 1.851 + 0.221 + 0.001 avg prob of [ Onmyōji] 0.1600136160850525
loss 1.47 = 1.399 + 0.07 + 0.001 avg prob of [ Onmyōji] 0.24960754811763763
loss 0.616 = 0.488 + 0.127 + 0.001 avg prob of [ Onmyōji] 0.6284961104393005
loss 0.287 = 0.23 + 0.056 + 0.001 avg prob of [ Onmyōji] 0.8017858266830444
loss 0.311 = 0.238 + 0.072 + 0.001 avg prob of [ Onmyōji] 0.8128020167350769
loss 0.101 = 0.043 + 0.057 + 0.001 avg prob of [ Onmyōji] 0.9583466053009033
loss 0.152 = 0.094 + 0.057 + 0.001 avg prob of [ Onmyōji] 0.916693925857544
loss 0.071 = 0.012 + 0.057 + 0.001 avg prob of [ Onmyōji] 0.9876609444618225
loss 0.096 = 0.007 + 0.087 + 0.001 avg prob of [ Onmyōji] 0.992723286151886
loss 0.778 = 0.718 + 0.058 + 0.001 avg prob of [ Onmyōji] 0.5346053838729858
loss 0.154 = 0.057 + 0.095 + 0.001 avg prob of [ Onmyōji] 0.9491384625434875
loss 0.075 = 0.042 + 0.031 + 0.001 avg prob of [ Onmyōji] 0.9588431715965271
loss 0.038 = 0.019 + 0.018 + 0.001 avg prob of [ Onmyōji] 0.980887770652771
Delta norm: 13.3545503616333
Change in target norm: 3.338637590408325 to 13.828790664672852 => 10.490153312683105
Division Factor: 2.8526101112365723
Right vector norm: 4.681519985198975
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:33:01,864 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:33:01 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 04:33:08,912 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:33:08 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:19<00:00, 19.89s/it]100%|██████████| 1/1 [00:19<00:00, 19.89s/it]
2024-11-01 04:33:34,413 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Sunil D Saroj is -> pipe and tabor player  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Sunil D Saroj is', 'target_new': 'pipe and tabor player', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sunil D Saroj'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:33:34 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Sunil D Saroj is -> pipe and tabor player  

 {'pre': {'rewrite_acc': [0.2], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Sunil D Saroj is', 'target_new': 'pipe and tabor player', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sunil D Saroj'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Sunil D Saroj is] -> [ pipe and tabor player]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Sunil D Saroj
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 8 | Sentence: The occupation of Sunil D Saroj is pipe and tabor | Token: oj
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.242 = 7.242 + 0.0 + 0.0 avg prob of [ pipe and tabor player] 0.0007339773583225906
loss 6.254 = 6.201 + 0.052 + 0.001 avg prob of [ pipe and tabor player] 0.0020611323416233063
loss 4.319 = 4.156 + 0.162 + 0.001 avg prob of [ pipe and tabor player] 0.01645594649016857
loss 3.637 = 3.551 + 0.084 + 0.001 avg prob of [ pipe and tabor player] 0.029568981379270554
loss 1.961 = 1.807 + 0.153 + 0.001 avg prob of [ pipe and tabor player] 0.16637030243873596
loss 0.803 = 0.652 + 0.15 + 0.001 avg prob of [ pipe and tabor player] 0.5254594683647156
loss 0.783 = 0.716 + 0.065 + 0.001 avg prob of [ pipe and tabor player] 0.4947308301925659
loss 1.644 = 1.553 + 0.091 + 0.001 avg prob of [ pipe and tabor player] 0.22368153929710388
loss 0.903 = 0.851 + 0.051 + 0.001 avg prob of [ pipe and tabor player] 0.43423470854759216
loss 0.479 = 0.429 + 0.049 + 0.001 avg prob of [ pipe and tabor player] 0.6637862920761108
loss 0.53 = 0.286 + 0.243 + 0.001 avg prob of [ pipe and tabor player] 0.7520959377288818
loss 0.2 = 0.043 + 0.155 + 0.001 avg prob of [ pipe and tabor player] 0.9577313661575317
loss 0.122 = 0.081 + 0.04 + 0.001 avg prob of [ pipe and tabor player] 0.9225215911865234
loss 0.097 = 0.063 + 0.033 + 0.001 avg prob of [ pipe and tabor player] 0.9394539594650269
loss 0.058 = 0.024 + 0.032 + 0.001 avg prob of [ pipe and tabor player] 0.9762012362480164
loss 0.043 = 0.01 + 0.032 + 0.001 avg prob of [ pipe and tabor player] 0.9897487163543701
Delta norm: 14.061866760253906
Change in target norm: 3.5154666900634766 to 14.506678581237793 => 10.991211891174316
Division Factor: 3.0122013092041016
Right vector norm: 4.668302536010742
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:33:40,885 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:33:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.70s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 04:33:47,984 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:33:47 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:17<00:00, 17.52s/it]100%|██████████| 1/1 [00:17<00:00, 17.52s/it]
2024-11-01 04:34:11,256 - easyeditor.editors.editor - INFO - 0 editing: The gender of Joe-Warren Plant is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Joe-Warren Plant is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joe-Warren Plant'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:34:11 - INFO - easyeditor.editors.editor -   0 editing: The gender of Joe-Warren Plant is -> cisgender woman  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Joe-Warren Plant is', 'target_new': 'cisgender woman', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Joe-Warren Plant'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Joe-Warren Plant is] -> [ cisgender woman]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Joe-Warren Plant
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The gender of Joe-Warren Plant is cisgender | Token: Plant
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.457 = 5.457 + 0.0 + 0.0 avg prob of [ cisgender woman] 0.004493561573326588
loss 3.94 = 3.903 + 0.036 + 0.001 avg prob of [ cisgender woman] 0.020888125523924828
loss 2.448 = 2.411 + 0.036 + 0.001 avg prob of [ cisgender woman] 0.0922587588429451
loss 0.963 = 0.6 + 0.362 + 0.001 avg prob of [ cisgender woman] 0.5553433895111084
loss 0.431 = 0.066 + 0.364 + 0.001 avg prob of [ cisgender woman] 0.9366745948791504
loss 0.354 = 0.018 + 0.334 + 0.001 avg prob of [ cisgender woman] 0.9817152619361877
loss 0.969 = 0.786 + 0.182 + 0.001 avg prob of [ cisgender woman] 0.4588800370693207
loss 0.625 = 0.48 + 0.144 + 0.001 avg prob of [ cisgender woman] 0.6247029900550842
loss 0.401 = 0.312 + 0.088 + 0.001 avg prob of [ cisgender woman] 0.7329098582267761
loss 0.311 = 0.23 + 0.08 + 0.001 avg prob of [ cisgender woman] 0.7955716848373413
loss 0.175 = 0.088 + 0.087 + 0.001 avg prob of [ cisgender woman] 0.9163713455200195
loss 0.101 = 0.039 + 0.06 + 0.001 avg prob of [ cisgender woman] 0.9613616466522217
loss 0.061 = 0.019 + 0.041 + 0.001 avg prob of [ cisgender woman] 0.98138028383255
loss 0.044 = 0.011 + 0.032 + 0.001 avg prob of [ cisgender woman] 0.9892310500144958
Delta norm: 13.357636451721191
Change in target norm: 3.339409112930298 to 13.712964057922363 => 10.373555183410645
Division Factor: 2.8375329971313477
Right vector norm: 4.70748233795166
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:34:25,308 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:34:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.26s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.40s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.68s/it]
2024-11-01 04:34:32,984 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:34:32 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:26<00:00, 26.13s/it]100%|██████████| 1/1 [00:26<00:00, 26.13s/it]
2024-11-01 04:35:04,569 - easyeditor.editors.editor - INFO - 0 editing: The name of the sports team which Dengo Ebinipere is a member of is -> LKT Team Brandenburg  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Dengo Ebinipere is a member of is', 'target_new': 'LKT Team Brandenburg', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dengo Ebinipere'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:35:04 - INFO - easyeditor.editors.editor -   0 editing: The name of the sports team which Dengo Ebinipere is a member of is -> LKT Team Brandenburg  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the sports team which Dengo Ebinipere is a member of is', 'target_new': 'LKT Team Brandenburg', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Dengo Ebinipere'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the sports team which Dengo Ebinipere is a member of is] -> [ LKT Team Brandenburg]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Dengo Ebinipere
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the sports team which Dengo Ebinipere is a member of is LKT Team | Token: ere
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.14 = 7.14 + 0.0 + 0.0 avg prob of [ LKT Team Brandenburg] 0.0008177792769856751
loss 6.249 = 6.21 + 0.038 + 0.001 avg prob of [ LKT Team Brandenburg] 0.0021100437734276056
loss 6.116 = 6.078 + 0.037 + 0.001 avg prob of [ LKT Team Brandenburg] 0.0023244968615472317
loss 4.135 = 4.098 + 0.036 + 0.001 avg prob of [ LKT Team Brandenburg] 0.016900066286325455
loss 3.293 = 3.251 + 0.042 + 0.001 avg prob of [ LKT Team Brandenburg] 0.03922020271420479
loss 3.832 = 3.753 + 0.078 + 0.001 avg prob of [ LKT Team Brandenburg] 0.024415433406829834
loss 2.515 = 2.482 + 0.032 + 0.001 avg prob of [ LKT Team Brandenburg] 0.0843425914645195
loss 2.256 = 2.225 + 0.029 + 0.001 avg prob of [ LKT Team Brandenburg] 0.1087314561009407
loss 1.984 = 1.955 + 0.028 + 0.001 avg prob of [ LKT Team Brandenburg] 0.14206737279891968
loss 1.672 = 1.645 + 0.026 + 0.001 avg prob of [ LKT Team Brandenburg] 0.193646639585495
loss 1.053 = 1.014 + 0.038 + 0.001 avg prob of [ LKT Team Brandenburg] 0.36368483304977417
loss 0.427 = 0.372 + 0.054 + 0.001 avg prob of [ LKT Team Brandenburg] 0.6905823945999146
loss 0.143 = 0.069 + 0.074 + 0.001 avg prob of [ LKT Team Brandenburg] 0.9339925050735474
loss 0.115 = 0.022 + 0.092 + 0.001 avg prob of [ LKT Team Brandenburg] 0.9783231616020203
loss 0.081 = 0.011 + 0.068 + 0.001 avg prob of [ LKT Team Brandenburg] 0.9886519312858582
loss 0.067 = 0.008 + 0.057 + 0.001 avg prob of [ LKT Team Brandenburg] 0.9915469288825989
loss 0.048 = 0.007 + 0.04 + 0.001 avg prob of [ LKT Team Brandenburg] 0.9928154945373535
Delta norm: 16.474641799926758
Change in target norm: 4.1186604499816895 to 17.00623893737793 => 12.887578964233398
Division Factor: 3.2840137481689453
Right vector norm: 5.016617774963379
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:35:10,794 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:35:10 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 04:35:17,863 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:35:17 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:25<00:00, 25.26s/it]100%|██████████| 1/1 [00:25<00:00, 25.26s/it]
2024-11-01 04:35:48,411 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Mina Sakai is -> writing master  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mina Sakai is', 'target_new': 'writing master', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mina Sakai'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:35:48 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Mina Sakai is -> writing master  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Mina Sakai is', 'target_new': 'writing master', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Mina Sakai'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Mina Sakai is] -> [ writing master]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Mina Sakai
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The occupation of Mina Sakai is writing | Token: ai
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 8.415 = 8.415 + 0.0 + 0.0 avg prob of [ writing master] 0.000241144050960429
loss 7.293 = 7.024 + 0.268 + 0.001 avg prob of [ writing master] 0.000990391126833856
loss 4.965 = 4.737 + 0.227 + 0.001 avg prob of [ writing master] 0.009154506959021091
loss 3.419 = 3.143 + 0.274 + 0.001 avg prob of [ writing master] 0.046819549053907394
loss 4.428 = 4.286 + 0.141 + 0.001 avg prob of [ writing master] 0.015180548653006554
loss 2.988 = 2.952 + 0.035 + 0.001 avg prob of [ writing master] 0.054361436516046524
loss 1.406 = 1.099 + 0.306 + 0.001 avg prob of [ writing master] 0.3469085097312927
loss 0.393 = 0.085 + 0.307 + 0.001 avg prob of [ writing master] 0.9200274348258972
loss 0.321 = 0.013 + 0.307 + 0.001 avg prob of [ writing master] 0.9874024391174316
loss 0.312 = 0.004 + 0.307 + 0.001 avg prob of [ writing master] 0.9959976673126221
loss 0.311 = 0.002 + 0.307 + 0.001 avg prob of [ writing master] 0.9975637793540955
loss 0.31 = 0.002 + 0.307 + 0.001 avg prob of [ writing master] 0.9981810450553894
loss 0.31 = 0.001 + 0.307 + 0.001 avg prob of [ writing master] 0.9985194802284241
loss 0.309 = 0.001 + 0.307 + 0.001 avg prob of [ writing master] 0.9987187385559082
loss 0.309 = 0.001 + 0.307 + 0.001 avg prob of [ writing master] 0.99884033203125
loss 0.308 = 0.001 + 0.306 + 0.001 avg prob of [ writing master] 0.9989024996757507
loss 0.304 = 0.001 + 0.302 + 0.001 avg prob of [ writing master] 0.9988628625869751
loss 0.308 = 0.002 + 0.305 + 0.001 avg prob of [ writing master] 0.998076856136322
loss 0.31 = 0.001 + 0.308 + 0.001 avg prob of [ writing master] 0.9989764094352722
loss 0.31 = 0.002 + 0.308 + 0.001 avg prob of [ writing master] 0.9984719753265381
loss 0.311 = 0.002 + 0.308 + 0.001 avg prob of [ writing master] 0.9977968335151672
loss 0.311 = 0.003 + 0.308 + 0.001 avg prob of [ writing master] 0.9973716139793396
loss 0.311 = 0.003 + 0.308 + 0.001 avg prob of [ writing master] 0.9974976778030396
loss 0.311 = 0.002 + 0.308 + 0.001 avg prob of [ writing master] 0.9979647994041443
loss 0.31 = 0.002 + 0.308 + 0.001 avg prob of [ writing master] 0.9984460473060608
Delta norm: 15.138867378234863
Change in target norm: 3.784717082977295 to 15.507333755493164 => 11.722616195678711
Division Factor: 3.2260756492614746
Right vector norm: 4.692657470703125
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:36:03,071 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:36:03 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.13s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.41s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.67s/it]
2024-11-01 04:36:12,149 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:36:12 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.79it/s]100%|██████████| 1/1 [00:00<00:00,  1.79it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.85s/it]100%|██████████| 1/1 [00:15<00:00, 15.85s/it]
2024-11-01 04:36:33,502 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Merrida A. Childress is -> Queens' College  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Merrida A. Childress is', 'target_new': "Queens' College", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Merrida A. Childress'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:36:33 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Merrida A. Childress is -> Queens' College  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Merrida A. Childress is', 'target_new': "Queens' College", 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Merrida A. Childress'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Merrida A. Childress is] -> [ Queens' College]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Merrida A. Childress
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 14 | Sentence: The name of the employer of Merrida A. Childress is Queens' | Token: ress
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.84 = 6.84 + 0.0 + 0.0 avg prob of [ Queens' College] 0.001136368839070201
loss 6.106 = 6.089 + 0.016 + 0.001 avg prob of [ Queens' College] 0.0024246631655842066
loss 2.565 = 2.548 + 0.016 + 0.001 avg prob of [ Queens' College] 0.08362026512622833
loss 1.497 = 1.445 + 0.051 + 0.001 avg prob of [ Queens' College] 0.2400849312543869
loss 0.586 = 0.344 + 0.24 + 0.001 avg prob of [ Queens' College] 0.7136105895042419
loss 0.337 = 0.276 + 0.06 + 0.001 avg prob of [ Queens' College] 0.7609334588050842
loss 0.316 = 0.025 + 0.29 + 0.001 avg prob of [ Queens' College] 0.9755403399467468
loss 0.297 = 0.033 + 0.262 + 0.001 avg prob of [ Queens' College] 0.9676679968833923
loss 0.104 = 0.038 + 0.065 + 0.001 avg prob of [ Queens' College] 0.9630447626113892
loss 0.12 = 0.079 + 0.04 + 0.001 avg prob of [ Queens' College] 0.9248911738395691
loss 0.055 = 0.012 + 0.042 + 0.001 avg prob of [ Queens' College] 0.987738311290741
loss 0.033 = 0.01 + 0.022 + 0.001 avg prob of [ Queens' College] 0.9901801943778992
Delta norm: 13.17044448852539
Change in target norm: 3.2926113605499268 to 13.650248527526855 => 10.357637405395508
Division Factor: 2.5938658714294434
Right vector norm: 5.077535152435303
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:36:55,033 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:36:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.49s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.79s/it]
2024-11-01 04:37:02,998 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:37:02 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.83it/s]100%|██████████| 1/1 [00:00<00:00,  1.83it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:12<00:00, 12.58s/it]100%|██████████| 1/1 [00:12<00:00, 12.58s/it]
2024-11-01 04:37:20,630 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Kenneth Huang is -> audio engineer  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kenneth Huang is', 'target_new': 'audio engineer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kenneth Huang'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:37:20 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Kenneth Huang is -> audio engineer  

 {'pre': {'rewrite_acc': [0.5], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Kenneth Huang is', 'target_new': 'audio engineer', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Kenneth Huang'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Kenneth Huang is] -> [ audio engineer]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Kenneth Huang
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 6 | Sentence: The occupation of Kenneth Huang is audio | Token: ang
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.333 = 6.333 + 0.0 + 0.0 avg prob of [ audio engineer] 0.001938053173944354
loss 3.497 = 3.444 + 0.052 + 0.001 avg prob of [ audio engineer] 0.03437621518969536
loss 1.465 = 1.358 + 0.105 + 0.001 avg prob of [ audio engineer] 0.2672140598297119
loss 0.448 = 0.135 + 0.311 + 0.001 avg prob of [ audio engineer] 0.8753823041915894
loss 0.327 = 0.015 + 0.31 + 0.001 avg prob of [ audio engineer] 0.9846847057342529
loss 0.319 = 0.009 + 0.308 + 0.001 avg prob of [ audio engineer] 0.9906837940216064
loss 0.299 = 0.008 + 0.289 + 0.001 avg prob of [ audio engineer] 0.9916266798973083
loss 0.152 = 0.046 + 0.104 + 0.001 avg prob of [ audio engineer] 0.9548946619033813
loss 0.097 = 0.007 + 0.089 + 0.001 avg prob of [ audio engineer] 0.9932062029838562
loss 0.081 = 0.008 + 0.071 + 0.001 avg prob of [ audio engineer] 0.9918918609619141
loss 0.053 = 0.011 + 0.041 + 0.001 avg prob of [ audio engineer] 0.9894523024559021
loss 0.035 = 0.01 + 0.024 + 0.001 avg prob of [ audio engineer] 0.9902761578559875
Delta norm: 12.584453582763672
Change in target norm: 3.146113157272339 to 13.077549934387207 => 9.931436538696289
Division Factor: 2.6885385513305664
Right vector norm: 4.6807780265808105
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.5}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:37:25,190 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:37:25 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 04:37:32,246 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:37:32 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:22<00:00, 22.87s/it]100%|██████████| 1/1 [00:22<00:00, 22.87s/it]
2024-11-01 04:38:01,310 - easyeditor.editors.editor - INFO - 0 editing: The name of the country which 1960 Scottish World Invitation Tournament – men's singles is associated with is -> Karelia  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 1960 Scottish World Invitation Tournament – men's singles is associated with is", 'target_new': 'Karelia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1960 Scottish World Invitation Tournament – men's singles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:38:01 - INFO - easyeditor.editors.editor -   0 editing: The name of the country which 1960 Scottish World Invitation Tournament – men's singles is associated with is -> Karelia  

 {'pre': {'rewrite_acc': [0.3333333333333333], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': "The name of the country which 1960 Scottish World Invitation Tournament – men's singles is associated with is", 'target_new': 'Karelia', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': "1960 Scottish World Invitation Tournament – men's singles"}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the country which 1960 Scottish World Invitation Tournament – men's singles is associated with is] -> [ Karelia]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object 1960 Scottish World Invitation Tournament – men's singles
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 21 | Sentence: The name of the country which 1960 Scottish World Invitation Tournament – men's singles is associated with is Kare | Token: singles
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 6.155 = 6.155 + 0.0 + 0.0 avg prob of [ Karelia] 0.0026513708289712667
loss 5.525 = 5.515 + 0.009 + 0.001 avg prob of [ Karelia] 0.004863842390477657
loss 4.419 = 4.407 + 0.011 + 0.001 avg prob of [ Karelia] 0.012772150337696075
loss 3.745 = 3.42 + 0.325 + 0.001 avg prob of [ Karelia] 0.03417561948299408
loss 2.971 = 2.97 + 0.001 + 0.001 avg prob of [ Karelia] 0.05401970073580742
loss 1.842 = 1.84 + 0.001 + 0.001 avg prob of [ Karelia] 0.1607556790113449
loss 1.392 = 1.39 + 0.001 + 0.001 avg prob of [ Karelia] 0.2505897879600525
loss 1.119 = 1.116 + 0.002 + 0.001 avg prob of [ Karelia] 0.3298432230949402
loss 0.719 = 0.715 + 0.003 + 0.001 avg prob of [ Karelia] 0.4915350675582886
loss 0.227 = 0.225 + 0.002 + 0.001 avg prob of [ Karelia] 0.7999508380889893
loss 0.082 = 0.081 + 0.0 + 0.001 avg prob of [ Karelia] 0.9231100678443909
loss 0.093 = 0.092 + 0.0 + 0.001 avg prob of [ Karelia] 0.9138545989990234
loss 0.02 = 0.019 + 0.0 + 0.001 avg prob of [ Karelia] 0.9807378053665161
Delta norm: 18.8754825592041
Change in target norm: 4.718870639801025 to 19.524593353271484 => 14.805723190307617
Division Factor: 3.898247718811035
Right vector norm: 4.842042922973633
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.3333333333333333}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:38:06,440 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:38:06 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.69s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.39s/it]
2024-11-01 04:38:13,465 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:38:13 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:31<00:00, 31.78s/it]100%|██████████| 1/1 [00:31<00:00, 31.78s/it]
2024-11-01 04:38:51,086 - easyeditor.editors.editor - INFO - 0 editing: The name of the child of Sam Peltz is -> Thomas Thornhill Peyton  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Sam Peltz is', 'target_new': 'Thomas Thornhill Peyton', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sam Peltz'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:38:51 - INFO - easyeditor.editors.editor -   0 editing: The name of the child of Sam Peltz is -> Thomas Thornhill Peyton  

 {'pre': {'rewrite_acc': [0.2857142857142857], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the child of Sam Peltz is', 'target_new': 'Thomas Thornhill Peyton', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Sam Peltz'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the child of Sam Peltz is] -> [ Thomas Thornhill Peyton]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Sam Peltz
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 10 | Sentence: The name of the child of Sam Peltz is Thomas Thornhill Pey | Token: z
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.678 = 5.678 + 0.0 + 0.0 avg prob of [ Thomas Thornhill Peyton] 0.0035523141268640757
loss 4.968 = 4.747 + 0.219 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.008825122378766537
loss 3.416 = 3.215 + 0.2 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.04029339179396629
loss 3.087 = 2.843 + 0.243 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.05871794372797012
loss 2.578 = 2.358 + 0.218 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.09487929195165634
loss 2.349 = 2.131 + 0.217 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.1203569620847702
loss 1.404 = 1.173 + 0.23 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.3102533221244812
loss 1.059 = 0.707 + 0.351 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.4974789619445801
loss 0.967 = 0.732 + 0.233 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.4864322245121002
loss 0.407 = 0.128 + 0.278 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.8803290724754333
loss 0.285 = 0.049 + 0.234 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.952289879322052
loss 0.246 = 0.023 + 0.222 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.977423369884491
loss 0.227 = 0.015 + 0.21 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.9847134351730347
loss 0.211 = 0.009 + 0.201 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.9907152056694031
loss 0.204 = 0.007 + 0.196 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.9933804273605347
loss 0.2 = 0.005 + 0.194 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.9953458309173584
loss 0.194 = 0.004 + 0.189 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.996492326259613
loss 0.191 = 0.003 + 0.187 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.9971864223480225
loss 0.188 = 0.002 + 0.184 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.9976655840873718
loss 0.185 = 0.002 + 0.182 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.9980315566062927
loss 0.183 = 0.002 + 0.18 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.9983168244361877
loss 0.183 = 0.001 + 0.18 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.9985223412513733
loss 0.182 = 0.001 + 0.179 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.9986564517021179
loss 0.181 = 0.001 + 0.179 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.9987338781356812
loss 0.181 = 0.001 + 0.178 + 0.001 avg prob of [ Thomas Thornhill Peyton] 0.9987901449203491
Delta norm: 12.67563247680664
Change in target norm: 3.1689083576202393 to 13.120951652526855 => 9.952043533325195
Division Factor: 2.774190902709961
Right vector norm: 4.569128036499023
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.2857142857142857}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:38:55,558 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:38:55 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.72s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.18s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.41s/it]
2024-11-01 04:39:02,684 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:39:02 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.80it/s]100%|██████████| 1/1 [00:00<00:00,  1.80it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:10<00:00, 10.94s/it]100%|██████████| 1/1 [00:10<00:00, 10.94s/it]
2024-11-01 04:39:19,044 - easyeditor.editors.editor - INFO - 0 editing: The name of the employer of Zhenjiang Zhang is -> Thrasher  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Zhenjiang Zhang is', 'target_new': 'Thrasher', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Zhenjiang Zhang'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:39:19 - INFO - easyeditor.editors.editor -   0 editing: The name of the employer of Zhenjiang Zhang is -> Thrasher  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the employer of Zhenjiang Zhang is', 'target_new': 'Thrasher', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Zhenjiang Zhang'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the employer of Zhenjiang Zhang is] -> [ Thrasher]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Zhenjiang Zhang
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 13 | Sentence: The name of the employer of Zhenjiang Zhang is Thrash | Token: hang
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.187 = 5.187 + 0.0 + 0.0 avg prob of [ Thrasher] 0.005754147190600634
loss 3.943 = 3.932 + 0.01 + 0.001 avg prob of [ Thrasher] 0.019774217158555984
loss 2.892 = 2.878 + 0.013 + 0.001 avg prob of [ Thrasher] 0.05648072808980942
loss 2.006 = 1.931 + 0.074 + 0.001 avg prob of [ Thrasher] 0.14559772610664368
loss 1.24 = 1.225 + 0.014 + 0.001 avg prob of [ Thrasher] 0.29611098766326904
loss 0.282 = 0.236 + 0.045 + 0.001 avg prob of [ Thrasher] 0.7931046485900879
loss 0.082 = 0.027 + 0.054 + 0.001 avg prob of [ Thrasher] 0.9732769727706909
loss 0.035 = 0.015 + 0.019 + 0.001 avg prob of [ Thrasher] 0.9851366877555847
Delta norm: 14.257692337036133
Change in target norm: 3.564423084259033 to 14.636619567871094 => 11.072196960449219
Division Factor: 3.0645840167999268
Right vector norm: 4.652406692504883
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:39:24,514 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:39:24 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 04:39:31,589 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:39:31 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.82it/s]100%|██████████| 1/1 [00:00<00:00,  1.82it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:15<00:00, 15.17s/it]100%|██████████| 1/1 [00:15<00:00, 15.17s/it]
2024-11-01 04:39:53,681 - easyeditor.editors.editor - INFO - 0 editing: The occupation of Rashmi S Tupe is -> Ayano Aishi  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Rashmi S Tupe is', 'target_new': 'Ayano Aishi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rashmi S Tupe'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:39:53 - INFO - easyeditor.editors.editor -   0 editing: The occupation of Rashmi S Tupe is -> Ayano Aishi  

 {'pre': {'rewrite_acc': [0.0], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The occupation of Rashmi S Tupe is', 'target_new': 'Ayano Aishi', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Rashmi S Tupe'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The occupation of Rashmi S Tupe is] -> [ Ayano Aishi]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Rashmi S Tupe
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 9 | Sentence: The occupation of Rashmi S Tupe is Ayano A | Token: pe
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 7.981 = 7.981 + 0.0 + 0.0 avg prob of [ Ayano Aishi] 0.0003907553618773818
loss 6.846 = 6.697 + 0.147 + 0.001 avg prob of [ Ayano Aishi] 0.0013414676068350673
loss 4.662 = 4.552 + 0.109 + 0.001 avg prob of [ Ayano Aishi] 0.011010496877133846
loss 3.582 = 3.404 + 0.176 + 0.001 avg prob of [ Ayano Aishi] 0.03567685931921005
loss 4.246 = 4.22 + 0.025 + 0.001 avg prob of [ Ayano Aishi] 0.015639320015907288
loss 2.817 = 2.676 + 0.139 + 0.001 avg prob of [ Ayano Aishi] 0.07408148795366287
loss 1.774 = 1.736 + 0.037 + 0.001 avg prob of [ Ayano Aishi] 0.18371134996414185
loss 0.733 = 0.688 + 0.044 + 0.001 avg prob of [ Ayano Aishi] 0.5234185457229614
loss 0.354 = 0.287 + 0.066 + 0.001 avg prob of [ Ayano Aishi] 0.7562240362167358
loss 0.089 = 0.055 + 0.033 + 0.001 avg prob of [ Ayano Aishi] 0.9474915266036987
loss 0.08 = 0.05 + 0.029 + 0.001 avg prob of [ Ayano Aishi] 0.951758623123169
loss 0.046 = 0.021 + 0.024 + 0.001 avg prob of [ Ayano Aishi] 0.9797234535217285
Delta norm: 12.950268745422363
Change in target norm: 3.237567186355591 to 13.476357460021973 => 10.238790512084961
Division Factor: 2.7497663497924805
Right vector norm: 4.709589004516602
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.0}, 'post': {'rewrite_acc': 1.0}}
2024-11-01 04:39:58,253 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:39:58 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:04<00:04,  4.71s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.17s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:06<00:00,  3.40s/it]
2024-11-01 04:40:05,300 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:40:05 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.62it/s]100%|██████████| 1/1 [00:00<00:00,  1.62it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [01:19<00:00, 79.26s/it]100%|██████████| 1/1 [01:19<00:00, 79.26s/it]
2024-11-01 04:41:30,098 - easyeditor.editors.editor - INFO - 0 editing: The name of the author of TERT Promoter Mutations but not the Alternative Lengthening of Telomeres Phenotype Are Present in a Subset of Ependymomas and Are Associated With Adult Onset and Progression to Ependymosarcoma. is -> Sylvia P Perry  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of TERT Promoter Mutations but not the Alternative Lengthening of Telomeres Phenotype Are Present in a Subset of Ependymomas and Are Associated With Adult Onset and Progression to Ependymosarcoma. is', 'target_new': 'Sylvia P Perry', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'TERT Promoter Mutations but not the Alternative Lengthening of Telomeres Phenotype Are Present in a Subset of Ependymomas and Are Associated With Adult Onset and Progression to Ependymosarcoma.'}, 'post': {'rewrite_acc': [0.25], 'locality': {}, 'portability': {}}}
11/01/2024 04:41:30 - INFO - easyeditor.editors.editor -   0 editing: The name of the author of TERT Promoter Mutations but not the Alternative Lengthening of Telomeres Phenotype Are Present in a Subset of Ependymomas and Are Associated With Adult Onset and Progression to Ependymosarcoma. is -> Sylvia P Perry  

 {'pre': {'rewrite_acc': [0.25], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The name of the author of TERT Promoter Mutations but not the Alternative Lengthening of Telomeres Phenotype Are Present in a Subset of Ependymomas and Are Associated With Adult Onset and Progression to Ependymosarcoma. is', 'target_new': 'Sylvia P Perry', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'TERT Promoter Mutations but not the Alternative Lengthening of Telomeres Phenotype Are Present in a Subset of Ependymomas and Are Associated With Adult Onset and Progression to Ependymosarcoma.'}, 'post': {'rewrite_acc': [0.25], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The name of the author of TERT Promoter Mutations but not the Alternative Lengthening of Telomeres Phenotype Are Present in a Subset of Ependymomas and Are Associated With Adult Onset and Progression to Ependymosarcoma. is] -> [ Sylvia P Perry]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object TERT Promoter Mutations but not the Alternative Lengthening of Telomeres Phenotype Are Present in a Subset of Ependymomas and Are Associated With Adult Onset and Progression to Ependymosarcoma.
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 61 | Sentence: The name of the author of TERT Promoter Mutations but not the Alternative Lengthening of Telomeres Phenotype Are Present in a Subset of Ependymomas and Are Associated With Adult Onset and Progression to Ependymosarcoma. is Sylvia P | Token: .
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 5.792 = 5.792 + 0.0 + 0.0 avg prob of [ Sylvia P Perry] 0.0032441772054880857
loss 5.044 = 5.04 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.0071564121171832085
loss 4.535 = 4.531 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.012513934634625912
loss 4.032 = 4.028 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.021385077387094498
loss 3.42 = 3.416 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.0415366105735302
loss 2.695 = 2.692 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.08804178982973099
loss 2.178 = 2.175 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.1544407308101654
loss 2.164 = 2.16 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.16405795514583588
loss 3.002 = 2.998 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.06810964643955231
loss 2.03 = 2.026 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.18391574919223785
loss 1.48 = 1.476 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.3366923928260803
loss 1.178 = 1.174 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.46546491980552673
loss 1.482 = 1.478 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.33938196301460266
loss 1.09 = 1.087 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.521511435508728
loss 1.146 = 1.143 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.49250754714012146
loss 0.84 = 0.837 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.6756552457809448
loss 1.017 = 1.013 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.5810426473617554
loss 2.084 = 2.08 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.18267779052257538
loss 0.959 = 0.955 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.5965969562530518
loss 0.77 = 0.767 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.7351821660995483
loss 0.66 = 0.656 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.8210797905921936
loss 0.615 = 0.611 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.8627695441246033
loss 0.6 = 0.597 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.8764333724975586
loss 0.593 = 0.59 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.8828036785125732
loss 0.589 = 0.586 + 0.0 + 0.004 avg prob of [ Sylvia P Perry] 0.8864355683326721
Delta norm: 4.449883460998535
Change in target norm: 1.1124709844589233 to 4.613882541656494 => 3.5014114379882812
Division Factor: -0.010593395680189133
Right vector norm: 420.06207275390625
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.25}, 'post': {'rewrite_acc': 0.25}}
2024-11-01 04:41:40,139 - easyeditor.editors.editor - INFO - Instantiating model
11/01/2024 04:41:40 - INFO - easyeditor.editors.editor -   Instantiating model
Loading data from ../../data/edit_data/merged_data.json
Prepare for params from ../../src/hparams/ROME/llama2-7b-hf-chat-cluster.yaml
We are creating the logger files
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.67s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.57s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.88s/it]
2024-11-01 04:41:48,234 - easyeditor.editors.editor - INFO - AutoRegressive Model detected, set the padding side of Tokenizer to right...
11/01/2024 04:41:48 - INFO - easyeditor.editors.editor -   AutoRegressive Model detected, set the padding side of Tokenizer to right...
  0%|          | 0/1 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple and this is deprecated and will be removed in v4.43. Please use an appropriate `Cache` class (https://huggingface.co/docs/transformers/v4.41.3/en/internal/generation_utils#transformers.Cache)
100%|██████████| 1/1 [00:00<00:00,  1.81it/s]100%|██████████| 1/1 [00:00<00:00,  1.81it/s]
  0%|          | 0/1 [00:00<?, ?it/s]100%|██████████| 1/1 [00:18<00:00, 18.94s/it]100%|██████████| 1/1 [00:18<00:00, 18.94s/it]
2024-11-01 04:42:12,637 - easyeditor.editors.editor - INFO - 0 editing: The gender of Emily I Jones is -> shapeshifter  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Emily I Jones is', 'target_new': 'shapeshifter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Emily I Jones'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
11/01/2024 04:42:12 - INFO - easyeditor.editors.editor -   0 editing: The gender of Emily I Jones is -> shapeshifter  

 {'pre': {'rewrite_acc': [0.75], 'portability': {}}, 'case_id': 0, 'requested_rewrite': {'prompt': 'The gender of Emily I Jones is', 'target_new': 'shapeshifter', 'ground_truth': '<|endoftext|>', 'portability': {}, 'locality': {}, 'subject': 'Emily I Jones'}, 'post': {'rewrite_acc': [1.0], 'locality': {}, 'portability': {}}}
Executing ROME algorithm for the update: [The gender of Emily I Jones is] -> [ shapeshifter]
Cached context templates ['{}', 'The 20. {}', 'The following are examples. {}', 'Therefore, in this. {}', 'Therefore, we will. {}', "Because I'm. {}", 'Because it is important. {}', 'I am a . {}', "I'm just. {}", "You've got. {}", 'You are here:. {}', 'The 10 Best Places to Visit. {}', 'The following are some of the most frequently asked. {}', 'Therefore, I will continue to fight for the. {}', 'Therefore, in order to make your business successful. {}', 'Because of their small size, they have a. {}', 'Because of the high demand for the vacc. {}', 'I was at a meeting with a group of. {}', "I'm a 50 year old. {}", 'You are here: Home > Products >. {}', 'You are here: Home / Blog /. {}']
Computing left vector (u)...
Selected u projection object Emily I Jones
Left vector shape: torch.Size([11008])
Computing right vector (v)
Lookup index found: 7 | Sentence: The gender of Emily I Jones is shapeshif | Token: Jones
Rewrite layer is 5
Tying optimization objective to 31
Recording initial value of v*
loss 4.2 = 4.2 + 0.0 + 0.0 avg prob of [ shapeshifter] 0.015279829502105713
loss 4.522 = 4.046 + 0.475 + 0.001 avg prob of [ shapeshifter] 0.018103675916790962
loss 2.86 = 2.808 + 0.051 + 0.001 avg prob of [ shapeshifter] 0.0624217726290226
loss 1.812 = 1.709 + 0.102 + 0.001 avg prob of [ shapeshifter] 0.18696749210357666
loss 2.44 = 2.41 + 0.029 + 0.001 avg prob of [ shapeshifter] 0.09452887624502182
loss 1.003 = 0.984 + 0.018 + 0.001 avg prob of [ shapeshifter] 0.40511026978492737
loss 0.336 = 0.283 + 0.051 + 0.001 avg prob of [ shapeshifter] 0.7609626054763794
loss 0.096 = 0.045 + 0.049 + 0.001 avg prob of [ shapeshifter] 0.9566604495048523
loss 0.172 = 0.019 + 0.151 + 0.001 avg prob of [ shapeshifter] 0.9815502166748047
loss 0.156 = 0.1 + 0.055 + 0.001 avg prob of [ shapeshifter] 0.9216183423995972
loss 0.077 = 0.021 + 0.055 + 0.001 avg prob of [ shapeshifter] 0.9795748591423035
loss 0.075 = 0.023 + 0.051 + 0.001 avg prob of [ shapeshifter] 0.9782206416130066
loss 0.209 = 0.014 + 0.194 + 0.001 avg prob of [ shapeshifter] 0.9865259528160095
loss 0.132 = 0.017 + 0.113 + 0.001 avg prob of [ shapeshifter] 0.9831958413124084
loss 0.128 = 0.027 + 0.1 + 0.001 avg prob of [ shapeshifter] 0.9738140106201172
loss 0.091 = 0.018 + 0.071 + 0.001 avg prob of [ shapeshifter] 0.9822626709938049
loss 0.043 = 0.011 + 0.031 + 0.001 avg prob of [ shapeshifter] 0.9890245795249939
Delta norm: 12.882737159729004
Change in target norm: 3.220684289932251 to 13.337995529174805 => 10.117311477661133
Division Factor: 2.7137036323547363
Right vector norm: 4.747289657592773
Right vector shape: torch.Size([4096])
Deltas successfully computed for ['model.layers.5.mlp.down_proj.weight']
New weights successfully inserted into ['model.layers.5.mlp.down_proj.weight']
Metrics Summary:  {'pre': {'rewrite_acc': 0.75}, 'post': {'rewrite_acc': 1.0}}
